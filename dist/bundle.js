/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t={187:t=>{"use strict";function e(t,e,s){s=s||2;var a,o,l,c,d,f,m,g=e&&e.length,y=g?e[0]*s:t.length,v=n(t,0,y,s,!0),x=[];if(!v||v.next===v.prev)return x;if(g&&(v=function(t,e,i,s){var a,o,l,c=[];for(a=0,o=e.length;a<o;a++)(l=n(t,e[a]*s,a<o-1?e[a+1]*s:t.length,s,!1))===l.next&&(l.steiner=!0),c.push(p(l));for(c.sort(h),a=0;a<c.length;a++)i=r(i=u(c[a],i),i.next);return i}(t,e,v,s)),t.length>80*s){a=l=t[0],o=c=t[1];for(var b=s;b<y;b+=s)(d=t[b])<a&&(a=d),(f=t[b+1])<o&&(o=f),d>l&&(l=d),f>c&&(c=f);m=0!==(m=Math.max(l-a,c-o))?1/m:0}return i(v,x,s,a,o,m),x}function n(t,e,n,r,i){var s,a;if(i===I(t,e,n,r)>0)for(s=e;s<n;s+=r)a=T(s,t[s],t[s+1],a);else for(s=n-r;s>=e;s-=r)a=T(s,t[s],t[s+1],a);return a&&y(a,a.next)&&(E(a),a=a.next),a}function r(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!y(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(E(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function i(t,e,n,h,u,c,p){if(t){!p&&c&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=d(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,s,a,o,l,h=1;do{for(n=t,t=null,s=null,a=0;n;){for(a++,r=n,o=0,e=0;e<h&&(o++,r=r.nextZ);e++);for(l=h;o>0||l>0&&r;)0!==o&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,o--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,h*=2}while(a>1)}(i)}(t,h,u,c);for(var f,m,g=t;t.prev!==t.next;)if(f=t.prev,m=t.next,c?a(t,h,u,c):s(t))e.push(f.i/n),e.push(t.i/n),e.push(m.i/n),E(t),t=m.next,g=m.next;else if((t=m)===g){p?1===p?i(t=o(r(t),e,n),e,n,h,u,c,2):2===p&&l(t,e,n,h,u,c):i(r(t),e,n,h,u,c,1);break}}}function s(t){var e=t.prev,n=t,r=t.next;if(g(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(f(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(t,e,n,r){var i=t.prev,s=t,a=t.next;if(g(i,s,a)>=0)return!1;for(var o=i.x<s.x?i.x<a.x?i.x:a.x:s.x<a.x?s.x:a.x,l=i.y<s.y?i.y<a.y?i.y:a.y:s.y<a.y?s.y:a.y,h=i.x>s.x?i.x>a.x?i.x:a.x:s.x>a.x?s.x:a.x,u=i.y>s.y?i.y>a.y?i.y:a.y:s.y>a.y?s.y:a.y,c=d(o,l,e,n,r),p=d(h,u,e,n,r),m=t.prevZ,y=t.nextZ;m&&m.z>=c&&y&&y.z<=p;){if(m!==t.prev&&m!==t.next&&f(i.x,i.y,s.x,s.y,a.x,a.y,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;if(m=m.prevZ,y!==t.prev&&y!==t.next&&f(i.x,i.y,s.x,s.y,a.x,a.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;m&&m.z>=c;){if(m!==t.prev&&m!==t.next&&f(i.x,i.y,s.x,s.y,a.x,a.y,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;y&&y.z<=p;){if(y!==t.prev&&y!==t.next&&f(i.x,i.y,s.x,s.y,a.x,a.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function o(t,e,n){var i=t;do{var s=i.prev,a=i.next.next;!y(s,a)&&v(s,i,i.next,a)&&w(s,a)&&w(a,s)&&(e.push(s.i/n),e.push(i.i/n),e.push(a.i/n),E(i),E(i.next),i=t=a),i=i.next}while(i!==t);return r(i)}function l(t,e,n,s,a,o){var l=t;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&m(l,h)){var u=_(l,h);return l=r(l,l.next),u=r(u,u.next),i(l,e,n,s,a,o),void i(u,e,n,s,a,o)}h=h.next}l=l.next}while(l!==t)}function h(t,e){return t.x-e.x}function u(t,e){var n=function(t,e){var n,r=e,i=t.x,s=t.y,a=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var o=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=i&&o>a){if(a=o,o===i){if(s===r.y)return r;if(s===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var l,h=n,u=n.x,d=n.y,p=1/0;r=n;do{i>=r.x&&r.x>=u&&i!==r.x&&f(s<d?i:a,s,u,d,s<d?a:i,s,r.x,r.y)&&(l=Math.abs(s-r.y)/(i-r.x),w(r,t)&&(l<p||l===p&&(r.x>n.x||r.x===n.x&&c(n,r)))&&(n=r,p=l)),r=r.next}while(r!==h);return n}(t,e);if(!n)return e;var i=_(n,t),s=r(n,n.next);return r(i,i.next),e===n?s:e}function c(t,e){return g(t.prev,t,e.prev)<0&&g(e.next,t,t.next)<0}function d(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function f(t,e,n,r,i,s,a,o){return(i-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(r-o)-(n-a)*(e-o)>=0&&(n-a)*(s-o)-(i-a)*(r-o)>=0}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&v(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(w(t,e)&&w(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(g(t.prev,t,e.prev)||g(t,e.prev,e))||y(t,e)&&g(t.prev,t,t.next)>0&&g(e.prev,e,e.next)>0)}function g(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function y(t,e){return t.x===e.x&&t.y===e.y}function v(t,e,n,r){var i=b(g(t,e,n)),s=b(g(t,e,r)),a=b(g(n,r,t)),o=b(g(n,r,e));return i!==s&&a!==o||(!(0!==i||!x(t,n,e))||(!(0!==s||!x(t,r,e))||(!(0!==a||!x(n,t,r))||!(0!==o||!x(n,e,r)))))}function x(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function b(t){return t>0?1:t<0?-1:0}function w(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function _(t,e){var n=new S(t.i,t.x,t.y),r=new S(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function T(t,e,n,r){var i=new S(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function E(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function S(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function I(t,e,n,r){for(var i=0,s=e,a=n-r;s<n;s+=r)i+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return i}t.exports=e,t.exports.default=e,e.deviation=function(t,e,n,r){var i=e&&e.length,s=i?e[0]*n:t.length,a=Math.abs(I(t,0,s,n));if(i)for(var o=0,l=e.length;o<l;o++){var h=e[o]*n,u=o<l-1?e[o+1]*n:t.length;a-=Math.abs(I(t,h,u,n))}var c=0;for(o=0;o<r.length;o+=3){var d=r[o]*n,p=r[o+1]*n,f=r[o+2]*n;c+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===a&&0===c?0:Math.abs((c-a)/a)},e.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var a=0;a<e;a++)n.vertices.push(t[i][s][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}},729:t=>{"use strict";var e=Object.prototype.hasOwnProperty,n="~";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(t,e,r,s,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new i(r,s||t,a),l=n?n+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],o]:t._events[l].push(o):(t._events[l]=o,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),o.prototype.eventNames=function(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)e.call(t,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},o.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,a=new Array(s);i<s;i++)a[i]=r[i].fn;return a},o.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},o.prototype.emit=function(t,e,r,i,s,a){var o=n?n+t:t;if(!this._events[o])return!1;var l,h,u=this._events[o],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,r),!0;case 4:return u.fn.call(u.context,e,r,i),!0;case 5:return u.fn.call(u.context,e,r,i,s),!0;case 6:return u.fn.call(u.context,e,r,i,s,a),!0}for(h=1,l=new Array(c-1);h<c;h++)l[h-1]=arguments[h];u.fn.apply(u.context,l)}else{var d,p=u.length;for(h=0;h<p;h++)switch(u[h].once&&this.removeListener(t,u[h].fn,void 0,!0),c){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,e);break;case 3:u[h].fn.call(u[h].context,e,r);break;case 4:u[h].fn.call(u[h].context,e,r,i);break;default:if(!l)for(d=1,l=new Array(c-1);d<c;d++)l[d-1]=arguments[d];u[h].fn.apply(u[h].context,l)}}return!0},o.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},o.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},o.prototype.removeListener=function(t,e,r,i){var s=n?n+t:t;if(!this._events[s])return this;if(!e)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==e||i&&!o.once||r&&o.context!==r||a(this,s);else{for(var l=0,h=[],u=o.length;l<u;l++)(o[l].fn!==e||i&&!o[l].once||r&&o[l].context!==r)&&h.push(o[l]);h.length?this._events[s]=1===h.length?h[0]:h:a(this,s)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&a(this,e)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,t.exports=o},720:t=>{t.exports=n;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function n(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function r(t){return!0===(t&&t.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var i={},s={};function a(t,e){var n,r,a;return e?(a=0<=(t>>>=0)&&t<256)&&(r=s[t])?r:(n=l(t,(0|t)<0?-1:0,!0),a&&(s[t]=n),n):(a=-128<=(t|=0)&&t<128)&&(r=i[t])?r:(n=l(t,t<0?-1:0,!1),a&&(i[t]=n),n)}function o(t,e){if(isNaN(t))return e?y:g;if(e){if(t<0)return y;if(t>=p)return _}else{if(t<=-f)return T;if(t+1>=f)return w}return t<0?o(-t,e).neg():l(t%d|0,t/d|0,e)}function l(t,e,r){return new n(t,e,r)}n.fromInt=a,n.fromNumber=o,n.fromBits=l;var h=Math.pow;function u(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return g;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return u(t.substring(1),e,n).neg();for(var i=o(h(n,8)),s=g,a=0;a<t.length;a+=8){var l=Math.min(8,t.length-a),c=parseInt(t.substring(a,a+l),n);if(l<8){var d=o(h(n,l));s=s.mul(d).add(o(c))}else s=(s=s.mul(i)).add(o(c))}return s.unsigned=e,s}function c(t,e){return"number"==typeof t?o(t,e):"string"==typeof t?u(t,e):l(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}n.fromString=u,n.fromValue=c;var d=4294967296,p=d*d,f=p/2,m=a(1<<24),g=a(0);n.ZERO=g;var y=a(0,!0);n.UZERO=y;var v=a(1);n.ONE=v;var x=a(1,!0);n.UONE=x;var b=a(-1);n.NEG_ONE=b;var w=l(-1,2147483647,!1);n.MAX_VALUE=w;var _=l(-1,-1,!0);n.MAX_UNSIGNED_VALUE=_;var T=l(0,-2147483648,!1);n.MIN_VALUE=T;var E=n.prototype;E.toInt=function(){return this.unsigned?this.low>>>0:this.low},E.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},E.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(T)){var e=o(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=o(h(t,6),this.unsigned),s=this,a="";;){var l=s.div(i),u=(s.sub(l.mul(i)).toInt()>>>0).toString(t);if((s=l).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},E.getHighBits=function(){return this.high},E.getHighBitsUnsigned=function(){return this.high>>>0},E.getLowBits=function(){return this.low},E.getLowBitsUnsigned=function(){return this.low>>>0},E.getNumBitsAbs=function(){if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},E.isZero=function(){return 0===this.high&&0===this.low},E.eqz=E.isZero,E.isNegative=function(){return!this.unsigned&&this.high<0},E.isPositive=function(){return this.unsigned||this.high>=0},E.isOdd=function(){return 1==(1&this.low)},E.isEven=function(){return 0==(1&this.low)},E.equals=function(t){return r(t)||(t=c(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},E.eq=E.equals,E.notEquals=function(t){return!this.eq(t)},E.neq=E.notEquals,E.ne=E.notEquals,E.lessThan=function(t){return this.comp(t)<0},E.lt=E.lessThan,E.lessThanOrEqual=function(t){return this.comp(t)<=0},E.lte=E.lessThanOrEqual,E.le=E.lessThanOrEqual,E.greaterThan=function(t){return this.comp(t)>0},E.gt=E.greaterThan,E.greaterThanOrEqual=function(t){return this.comp(t)>=0},E.gte=E.greaterThanOrEqual,E.ge=E.greaterThanOrEqual,E.compare=function(t){if(r(t)||(t=c(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},E.comp=E.compare,E.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(v)},E.neg=E.negate,E.add=function(t){r(t)||(t=c(t));var e=this.high>>>16,n=65535&this.high,i=this.low>>>16,s=65535&this.low,a=t.high>>>16,o=65535&t.high,h=t.low>>>16,u=0,d=0,p=0,f=0;return p+=(f+=s+(65535&t.low))>>>16,d+=(p+=i+h)>>>16,u+=(d+=n+o)>>>16,u+=e+a,l((p&=65535)<<16|(f&=65535),(u&=65535)<<16|(d&=65535),this.unsigned)},E.subtract=function(t){return r(t)||(t=c(t)),this.add(t.neg())},E.sub=E.subtract,E.multiply=function(t){if(this.isZero())return g;if(r(t)||(t=c(t)),e)return l(e.mul(this.low,this.high,t.low,t.high),e.get_high(),this.unsigned);if(t.isZero())return g;if(this.eq(T))return t.isOdd()?T:g;if(t.eq(T))return this.isOdd()?T:g;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(m)&&t.lt(m))return o(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,i=65535&this.high,s=this.low>>>16,a=65535&this.low,h=t.high>>>16,u=65535&t.high,d=t.low>>>16,p=65535&t.low,f=0,y=0,v=0,x=0;return v+=(x+=a*p)>>>16,y+=(v+=s*p)>>>16,v&=65535,y+=(v+=a*d)>>>16,f+=(y+=i*p)>>>16,y&=65535,f+=(y+=s*d)>>>16,y&=65535,f+=(y+=a*u)>>>16,f+=n*p+i*d+s*u+a*h,l((v&=65535)<<16|(x&=65535),(f&=65535)<<16|(y&=65535),this.unsigned)},E.mul=E.multiply,E.divide=function(t){if(r(t)||(t=c(t)),t.isZero())throw Error("division by zero");var n,i,s;if(e)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?l((this.unsigned?e.div_u:e.div_s)(this.low,this.high,t.low,t.high),e.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:g;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return y;if(t.gt(this.shru(1)))return x;s=y}else{if(this.eq(T))return t.eq(v)||t.eq(b)?T:t.eq(T)?v:(n=this.shr(1).div(t).shl(1)).eq(g)?t.isNegative()?v:b:(i=this.sub(t.mul(n)),s=n.add(i.div(t)));if(t.eq(T))return this.unsigned?y:g;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=g}for(i=this;i.gte(t);){n=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(n)/Math.LN2),u=a<=48?1:h(2,a-48),d=o(n),p=d.mul(t);p.isNegative()||p.gt(i);)p=(d=o(n-=u,this.unsigned)).mul(t);d.isZero()&&(d=v),s=s.add(d),i=i.sub(p)}return s},E.div=E.divide,E.modulo=function(t){return r(t)||(t=c(t)),e?l((this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,t.low,t.high),e.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},E.mod=E.modulo,E.rem=E.modulo,E.not=function(){return l(~this.low,~this.high,this.unsigned)},E.and=function(t){return r(t)||(t=c(t)),l(this.low&t.low,this.high&t.high,this.unsigned)},E.or=function(t){return r(t)||(t=c(t)),l(this.low|t.low,this.high|t.high,this.unsigned)},E.xor=function(t){return r(t)||(t=c(t)),l(this.low^t.low,this.high^t.high,this.unsigned)},E.shiftLeft=function(t){return r(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?l(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):l(0,this.low<<t-32,this.unsigned)},E.shl=E.shiftLeft,E.shiftRight=function(t){return r(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?l(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):l(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},E.shr=E.shiftRight,E.shiftRightUnsigned=function(t){if(r(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;return t<32?l(this.low>>>t|e<<32-t,e>>>t,this.unsigned):l(32===t?e:e>>>t-32,0,this.unsigned)},E.shru=E.shiftRightUnsigned,E.shr_u=E.shiftRightUnsigned,E.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},E.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},E.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},E.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},E.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},n.fromBytes=function(t,e,r){return r?n.fromBytesLE(t,e):n.fromBytesBE(t,e)},n.fromBytesLE=function(t,e){return new n(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},n.fromBytesBE=function(t,e){return new n(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)}},418:t=>{"use strict";var e=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function i(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,s){for(var a,o,l=i(t),h=1;h<arguments.length;h++){for(var u in a=Object(arguments[h]))n.call(a,u)&&(l[u]=a[u]);if(e){o=e(a);for(var c=0;c<o.length;c++)r.call(a,o[c])&&(l[o[c]]=a[o[c]])}}return l}},374:function(t){(function(){var e;(function(e){t.exports=e})(e={linear:function(t,e,n,r){return n*t/r+e},easeInQuad:function(t,e,n,r){return n*(t/=r)*t+e},easeOutQuad:function(t,e,n,r){return-n*(t/=r)*(t-2)+e},easeInOutQuad:function(t,e,n,r){return(t/=r/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,n,r){return n*(t/=r)*t*t+e},easeOutCubic:function(t,e,n,r){return n*((t=t/r-1)*t*t+1)+e},easeInOutCubic:function(t,e,n,r){return(t/=r/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,n,r){return n*(t/=r)*t*t*t+e},easeOutQuart:function(t,e,n,r){return-n*((t=t/r-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,n,r){return(t/=r/2)<1?n/2*t*t*t*t+e:-n/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,n,r){return n*(t/=r)*t*t*t*t+e},easeOutQuint:function(t,e,n,r){return n*((t=t/r-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,n,r){return(t/=r/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,n,r){return-n*Math.cos(t/r*(Math.PI/2))+n+e},easeOutSine:function(t,e,n,r){return n*Math.sin(t/r*(Math.PI/2))+e},easeInOutSine:function(t,e,n,r){return-n/2*(Math.cos(Math.PI*t/r)-1)+e},easeInExpo:function(t,e,n,r){return 0===t?e:n*Math.pow(2,10*(t/r-1))+e},easeOutExpo:function(t,e,n,r){return t===r?e+n:n*(1-Math.pow(2,-10*t/r))+e},easeInOutExpo:function(t,e,n,r){return(t/=r/2)<1?n/2*Math.pow(2,10*(t-1))+e:n/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,n,r){return-n*(Math.sqrt(1-(t/=r)*t)-1)+e},easeOutCirc:function(t,e,n,r){return n*Math.sqrt(1-(t=t/r-1)*t)+e},easeInOutCirc:function(t,e,n,r){return(t/=r/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+e:n/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(t,e,n,r){var i,s,a;return a=1.70158,0===t||(t/=r),(s=0)||(s=.3*r),(i=n)<Math.abs(n)?(i=n,a=s/4):a=s/(2*Math.PI)*Math.asin(n/i),-i*Math.pow(2,10*(t-=1))*Math.sin((t*r-a)*(2*Math.PI)/s)+e},easeOutElastic:function(t,e,n,r){var i,s,a;return a=1.70158,0===t||(t/=r),(s=0)||(s=.3*r),(i=n)<Math.abs(n)?(i=n,a=s/4):a=s/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*t)*Math.sin((t*r-a)*(2*Math.PI)/s)+n+e},easeInOutElastic:function(t,e,n,r){var i,s,a;return a=1.70158,0===t||(t/=r/2),(s=0)||(s=r*(.3*1.5)),(i=n)<Math.abs(n)?(i=n,a=s/4):a=s/(2*Math.PI)*Math.asin(n/i),t<1?i*Math.pow(2,10*(t-=1))*Math.sin((t*r-a)*(2*Math.PI)/s)*-.5+e:i*Math.pow(2,-10*(t-=1))*Math.sin((t*r-a)*(2*Math.PI)/s)*.5+n+e},easeInBack:function(t,e,n,r,i){return void 0===i&&(i=1.70158),n*(t/=r)*t*((i+1)*t-i)+e},easeOutBack:function(t,e,n,r,i){return void 0===i&&(i=1.70158),n*((t=t/r-1)*t*((i+1)*t+i)+1)+e},easeInOutBack:function(t,e,n,r,i){return void 0===i&&(i=1.70158),(t/=r/2)<1?n/2*(t*t*((1+(i*=1.525))*t-i))+e:n/2*((t-=2)*t*((1+(i*=1.525))*t+i)+2)+e},easeInBounce:function(t,n,r,i){return r-e.easeOutBounce(i-t,0,r,i)+n},easeOutBounce:function(t,e,n,r){return(t/=r)<1/2.75?n*(7.5625*t*t)+e:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInOutBounce:function(t,n,r,i){return t<i/2?.5*e.easeInBounce(2*t,0,r,i)+n:.5*e.easeOutBounce(2*t-i,0,r,i)+.5*r+n}})}).call(this)},587:t=>{"use strict";function e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,n,r,i){n=n||"&",r=r||"=";var s={};if("string"!=typeof t||0===t.length)return s;var a=/\+/g;t=t.split(n);var o=1e3;i&&"number"==typeof i.maxKeys&&(o=i.maxKeys);var l=t.length;o>0&&l>o&&(l=o);for(var h=0;h<l;++h){var u,c,d,p,f=t[h].replace(a,"%20"),m=f.indexOf(r);m>=0?(u=f.substr(0,m),c=f.substr(m+1)):(u=f,c=""),d=decodeURIComponent(u),p=decodeURIComponent(c),e(s,d)?Array.isArray(s[d])?s[d].push(p):s[d]=[s[d],p]:s[d]=p}return s}},361:t=>{"use strict";var e=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,n,r,i){return n=n||"&",r=r||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map((function(i){var s=encodeURIComponent(e(i))+r;return Array.isArray(t[i])?t[i].map((function(t){return s+encodeURIComponent(e(t))})).join(n):s+encodeURIComponent(e(t[i]))})).join(n):i?encodeURIComponent(e(i))+r+encodeURIComponent(e(t)):""}},673:(t,e,n)=>{"use strict";e.decode=e.parse=n(587),e.encode=e.stringify=n(361)},377:(t,e,n)=>{var r=n(832),i=n(652),s=n(801),a=n(30),o=n(618),l=n(49),h=n(971);h.alea=r,h.xor128=i,h.xorwow=s,h.xorshift7=a,h.xor4096=o,h.tychei=l,t.exports=h},832:function(t,e,n){var r;!function(t,i,s){function a(t){var e,n=this,r=(e=4022871197,function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}function o(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function l(t,e){var n=new a(t),r=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0===(r=function(){return l}.call(e,n,e,i))||(i.exports=r):this.alea=l}(0,t=n.nmd(t),n.amdD)},49:function(t,e,n){var r;!function(t,i,s){function a(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function o(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function l(t,e){var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0===(r=function(){return l}.call(e,n,e,i))||(i.exports=r):this.tychei=l}(0,t=n.nmd(t),n.amdD)},652:function(t,e,n){var r;!function(t,i,s){function a(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function l(t,e){var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0===(r=function(){return l}.call(e,n,e,i))||(i.exports=r):this.xor128=l}(0,t=n.nmd(t),n.amdD)},618:function(t,e,n){var r;!function(t,i,s){function a(t){var e=this;e.next=function(){var t,n,r=e.w,i=e.X,s=e.i;return e.w=r=r+1640531527|0,n=i[s+34&127],t=i[s=s+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=i[s]=n^t,e.i=s,n+(r^r>>>16)|0},function(t,e){var n,r,i,s,a,o=[],l=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,l=Math.max(l,e.length)),i=0,s=-32;s<l;++s)e&&(r^=e.charCodeAt((s+32)%e.length)),0===s&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,s>=0&&(a=a+1640531527|0,i=0==(n=o[127&s]^=r+a)?i+1:0);for(i>=128&&(o[127&(e&&e.length||0)]=-1),i=127,s=512;s>0;--s)r=o[i+34&127],n=o[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,o[i]=r^n;t.w=a,t.X=o,t.i=i}(e,t)}function o(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function l(t,e){null==t&&(t=+new Date);var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&(r.X&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0===(r=function(){return l}.call(e,n,e,i))||(i.exports=r):this.xor4096=l}(0,t=n.nmd(t),n.amdD)},30:function(t,e,n){var r;!function(t,i,s){function a(t){var e=this;e.next=function(){var t,n,r=e.x,i=e.i;return t=r[i],n=(t^=t>>>7)^t<<24,n^=(t=r[i+1&7])^t>>>10,n^=(t=r[i+3&7])^t>>>3,n^=(t=r[i+4&7])^t<<7,t=r[i+7&7],n^=(t^=t<<13)^t<<9,r[i]=n,e.i=i+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function o(t,e){return e.x=t.x.slice(),e.i=t.i,e}function l(t,e){null==t&&(t=+new Date);var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&(r.x&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0===(r=function(){return l}.call(e,n,e,i))||(i.exports=r):this.xorshift7=l}(0,t=n.nmd(t),n.amdD)},801:function(t,e,n){var r;!function(t,i,s){function a(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function l(t,e){var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0===(r=function(){return l}.call(e,n,e,i))||(i.exports=r):this.xorwow=l}(0,t=n.nmd(t),n.amdD)},971:function(t,e,n){var r;!function(i,s,a){var o,l=256,h=a.pow(l,6),u=a.pow(2,52),c=2*u,d=255;function p(t,e,n){var r=[],d=y(g((e=1==e?{entropy:!0}:e||{}).entropy?[t,v(s)]:null==t?function(){try{var t;return o&&(t=o.randomBytes)?t=t(l):(t=new Uint8Array(l),(i.crypto||i.msCrypto).getRandomValues(t)),v(t)}catch(t){var e=i.navigator,n=e&&e.plugins;return[+new Date,i,n,i.screen,v(s)]}}():t,3),r),p=new f(r),x=function(){for(var t=p.g(6),e=h,n=0;t<u;)t=(t+n)*l,e*=l,n=p.g(1);for(;t>=c;)t/=2,e/=2,n>>>=1;return(t+n)/e};return x.int32=function(){return 0|p.g(4)},x.quick=function(){return p.g(4)/4294967296},x.double=x,y(v(p.S),s),(e.pass||n||function(t,e,n,r){return r&&(r.S&&m(r,p),t.state=function(){return m(p,{})}),n?(a.random=t,e):t})(x,d,"global"in e?e.global:this==a,e.state)}function f(t){var e,n=t.length,r=this,i=0,s=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);i<l;)a[i]=i++;for(i=0;i<l;i++)a[i]=a[s=d&s+t[i%n]+(e=a[i])],a[s]=e;(r.g=function(t){for(var e,n=0,i=r.i,s=r.j,a=r.S;t--;)e=a[i=d&i+1],n=n*l+a[d&(a[i]=a[s=d&s+e])+(a[s]=e)];return r.i=i,r.j=s,n})(l)}function m(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function g(t,e){var n,r=[],i=typeof t;if(e&&"object"==i)for(n in t)try{r.push(g(t[n],e-1))}catch(t){}return r.length?r:"string"==i?t:t+"\0"}function y(t,e){for(var n,r=t+"",i=0;i<r.length;)e[d&i]=d&(n^=19*e[d&i])+r.charCodeAt(i++);return v(e)}function v(t){return String.fromCharCode.apply(0,t)}if(y(a.random(),s),t.exports){t.exports=p;try{o=n(42)}catch(t){}}else void 0===(r=function(){return p}.call(e,n,e,t))||(t.exports=r)}("undefined"!=typeof self?self:this,[],Math)},511:function(t,e,n){var r;t=n.nmd(t),function(i){e&&e.nodeType,t&&t.nodeType;var s="object"==typeof n.g&&n.g;s.global!==s&&s.window!==s&&s.self;var a,o=2147483647,l=36,h=/^xn--/,u=/[^\x20-\x7E]/,c=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,f=String.fromCharCode;function m(t){throw RangeError(d[t])}function g(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function y(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),r+g((t=t.replace(c,".")).split("."),e).join(".")}function v(t){for(var e,n,r=[],i=0,s=t.length;i<s;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<s?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function x(t){return g(t,(function(t){var e="";return t>65535&&(e+=f((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=f(t)})).join("")}function b(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function w(t,e,n){var r=0;for(t=n?p(t/700):t>>1,t+=p(t/e);t>455;r+=l)t=p(t/35);return p(r+36*t/(t+38))}function _(t){var e,n,r,i,s,a,h,u,c,d,f,g=[],y=t.length,v=0,b=128,_=72;for((n=t.lastIndexOf("-"))<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&m("not-basic"),g.push(t.charCodeAt(r));for(i=n>0?n+1:0;i<y;){for(s=v,a=1,h=l;i>=y&&m("invalid-input"),((u=(f=t.charCodeAt(i++))-48<10?f-22:f-65<26?f-65:f-97<26?f-97:l)>=l||u>p((o-v)/a))&&m("overflow"),v+=u*a,!(u<(c=h<=_?1:h>=_+26?26:h-_));h+=l)a>p(o/(d=l-c))&&m("overflow"),a*=d;_=w(v-s,e=g.length+1,0==s),p(v/e)>o-b&&m("overflow"),b+=p(v/e),v%=e,g.splice(v++,0,b)}return x(g)}function T(t){var e,n,r,i,s,a,h,u,c,d,g,y,x,_,T,E=[];for(y=(t=v(t)).length,e=128,n=0,s=72,a=0;a<y;++a)(g=t[a])<128&&E.push(f(g));for(r=i=E.length,i&&E.push("-");r<y;){for(h=o,a=0;a<y;++a)(g=t[a])>=e&&g<h&&(h=g);for(h-e>p((o-n)/(x=r+1))&&m("overflow"),n+=(h-e)*x,e=h,a=0;a<y;++a)if((g=t[a])<e&&++n>o&&m("overflow"),g==e){for(u=n,c=l;!(u<(d=c<=s?1:c>=s+26?26:c-s));c+=l)T=u-d,_=l-d,E.push(f(b(d+T%_,0))),u=p(T/_);E.push(f(b(u,0))),s=w(n,x,r==i),n=0,++r}++n,++e}return E.join("")}a={version:"1.3.2",ucs2:{decode:v,encode:x},decode:_,encode:T,toASCII:function(t){return y(t,(function(t){return u.test(t)?"xn--"+T(t):t}))},toUnicode:function(t){return y(t,(function(t){return h.test(t)?_(t.slice(4).toLowerCase()):t}))}},void 0===(r=function(){return a}.call(e,n,e,t))||(t.exports=r)}()},575:(t,e,n)=>{"use strict";var r=n(511),i=n(502);function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.Qc=x,e.DB=function(t,e){return x(t,!1,!0).resolve(e)},e.WU=function(t){i.isString(t)&&(t=x(t));return t instanceof s?t.format():s.prototype.format.call(t)};var a=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,h=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(h),c=["%","/","?",";","#"].concat(u),d=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=n(673);function x(t,e,n){if(t&&i.isObject(t)&&t instanceof s)return t;var r=new s;return r.parse(t,e,n),r}s.prototype.parse=function(t,e,n){if(!i.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var s=t.indexOf("?"),o=-1!==s&&s<t.indexOf("#")?"?":"#",h=t.split(o);h[0]=h[0].replace(/\\/g,"/");var x=t=h.join(o);if(x=x.trim(),!n&&1===t.split("#").length){var b=l.exec(x);if(b)return this.path=x,this.href=x,this.pathname=b[1],b[2]?(this.search=b[2],this.query=e?v.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var w=a.exec(x);if(w){var _=(w=w[0]).toLowerCase();this.protocol=_,x=x.substr(w.length)}if(n||w||x.match(/^\/\/[^@\/]+@[^@\/]+/)){var T="//"===x.substr(0,2);!T||w&&g[w]||(x=x.substr(2),this.slashes=!0)}if(!g[w]&&(T||w&&!y[w])){for(var E,S,I=-1,k=0;k<d.length;k++){-1!==(C=x.indexOf(d[k]))&&(-1===I||C<I)&&(I=C)}-1!==(S=-1===I?x.lastIndexOf("@"):x.lastIndexOf("@",I))&&(E=x.slice(0,S),x=x.slice(S+1),this.auth=decodeURIComponent(E)),I=-1;for(k=0;k<c.length;k++){var C;-1!==(C=x.indexOf(c[k]))&&(-1===I||C<I)&&(I=C)}-1===I&&(I=x.length),this.host=x.slice(0,I),x=x.slice(I),this.parseHost(),this.hostname=this.hostname||"";var N="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!N)for(var A=this.hostname.split(/\./),R=(k=0,A.length);k<R;k++){var M=A[k];if(M&&!M.match(p)){for(var O="",P=0,D=M.length;P<D;P++)M.charCodeAt(P)>127?O+="x":O+=M[P];if(!O.match(p)){var F=A.slice(0,k),L=A.slice(k+1),B=M.match(f);B&&(F.push(B[1]),L.unshift(B[2])),L.length&&(x="/"+L.join(".")+x),this.hostname=F.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),N||(this.hostname=r.toASCII(this.hostname));var $=this.port?":"+this.port:"",U=this.hostname||"";this.host=U+$,this.href+=this.host,N&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==x[0]&&(x="/"+x))}if(!m[_])for(k=0,R=u.length;k<R;k++){var V=u[k];if(-1!==x.indexOf(V)){var z=encodeURIComponent(V);z===V&&(z=escape(V)),x=x.split(V).join(z)}}var G=x.indexOf("#");-1!==G&&(this.hash=x.substr(G),x=x.slice(0,G));var W=x.indexOf("?");if(-1!==W?(this.search=x.substr(W),this.query=x.substr(W+1),e&&(this.query=v.parse(this.query)),x=x.slice(0,W)):e&&(this.search="",this.query={}),x&&(this.pathname=x),y[_]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){$=this.pathname||"";var X=this.search||"";this.path=$+X}return this.href=this.format(),this},s.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",s=!1,a="";this.host?s=t+this.host:this.hostname&&(s=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(a=v.stringify(this.query));var o=this.search||a&&"?"+a||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||y[e])&&!1!==s?(s="//"+(s||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):s||(s=""),r&&"#"!==r.charAt(0)&&(r="#"+r),o&&"?"!==o.charAt(0)&&(o="?"+o),e+s+(n=n.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(o=o.replace("#","%23"))+r},s.prototype.resolve=function(t){return this.resolveObject(x(t,!1,!0)).format()},s.prototype.resolveObject=function(t){if(i.isString(t)){var e=new s;e.parse(t,!1,!0),t=e}for(var n=new s,r=Object.keys(this),a=0;a<r.length;a++){var o=r[a];n[o]=this[o]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var l=Object.keys(t),h=0;h<l.length;h++){var u=l[h];"protocol"!==u&&(n[u]=t[u])}return y[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!y[t.protocol]){for(var c=Object.keys(t),d=0;d<c.length;d++){var p=c[d];n[p]=t[p]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||g[t.protocol])n.pathname=t.pathname;else{for(var f=(t.pathname||"").split("/");f.length&&!(t.host=f.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),n.pathname=f.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var m=n.pathname||"",v=n.search||"";n.path=m+v}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var x=n.pathname&&"/"===n.pathname.charAt(0),b=t.host||t.pathname&&"/"===t.pathname.charAt(0),w=b||x||n.host&&t.pathname,_=w,T=n.pathname&&n.pathname.split("/")||[],E=(f=t.pathname&&t.pathname.split("/")||[],n.protocol&&!y[n.protocol]);if(E&&(n.hostname="",n.port=null,n.host&&(""===T[0]?T[0]=n.host:T.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===f[0]?f[0]=t.host:f.unshift(t.host)),t.host=null),w=w&&(""===f[0]||""===T[0])),b)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,T=f;else if(f.length)T||(T=[]),T.pop(),T=T.concat(f),n.search=t.search,n.query=t.query;else if(!i.isNullOrUndefined(t.search)){if(E)n.hostname=n.host=T.shift(),(N=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=N.shift(),n.host=n.hostname=N.shift());return n.search=t.search,n.query=t.query,i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!T.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var S=T.slice(-1)[0],I=(n.host||t.host||T.length>1)&&("."===S||".."===S)||""===S,k=0,C=T.length;C>=0;C--)"."===(S=T[C])?T.splice(C,1):".."===S?(T.splice(C,1),k++):k&&(T.splice(C,1),k--);if(!w&&!_)for(;k--;k)T.unshift("..");!w||""===T[0]||T[0]&&"/"===T[0].charAt(0)||T.unshift(""),I&&"/"!==T.join("/").substr(-1)&&T.push("");var N,A=""===T[0]||T[0]&&"/"===T[0].charAt(0);E&&(n.hostname=n.host=A?"":T.length?T.shift():"",(N=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=N.shift(),n.host=n.hostname=N.shift()));return(w=w||n.host&&T.length)&&!A&&T.unshift(""),T.length?n.pathname=T.join("/"):(n.pathname=null,n.path=null),i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},s.prototype.parseHost=function(){var t=this.host,e=o.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},502:t=>{"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},410:()=>{},628:()=>{},601:()=>{},792:()=>{},977:()=>{},42:()=>{}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var s=e[r]={id:r,loaded:!1,exports:{}};return t[r].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{"use strict";var t={};n.r(t),n.d(t,{BaseTextureCache:()=>sn,CanvasRenderTarget:()=>ln,DATA_URI:()=>cn,EventEmitter:()=>Te(),ProgramCache:()=>nn,TextureCache:()=>rn,clearTextureCache:()=>on,correctBlendMode:()=>$e,createIndicesForQuads:()=>Ge,decomposeDataUri:()=>dn,deprecation:()=>en,destroyTextureCache:()=>an,determineCrossOrigin:()=>pn,earcut:()=>Se(),getBufferType:()=>We,getResolutionOfUrl:()=>fn,hex2rgb:()=>Pe,hex2string:()=>De,interleaveTypedArrays:()=>He,isMobile:()=>ee,isPow2:()=>je,isWebGLSupported:()=>Me,log2:()=>qe,nextPow2:()=>Ye,premultiplyBlendMode:()=>Be,premultiplyRgba:()=>Ue,premultiplyTint:()=>Ve,premultiplyTintToRgba:()=>ze,removeItems:()=>Ke,rgb2hex:()=>Le,sayHello:()=>Re,sign:()=>Ze,skipHello:()=>Ae,string2hex:()=>Fe,trimCanvas:()=>hn,uid:()=>Qe,url:()=>ke});var e={};n.r(e),n.d(e,{ALPHA_MODES:()=>fe,AbstractBatchRenderer:()=>Ls,AbstractMultiResource:()=>Mr,AbstractRenderer:()=>Is,AccessibilityManager:()=>ur,AnimatedSprite:()=>yu,AppLoaderPlugin:()=>ma,Application:()=>qs,ArrayResource:()=>Or,Attribute:()=>Zr,BLEND_MODES:()=>se,BUFFER_BITS:()=>ie,BUFFER_TYPE:()=>be,BaseImageResource:()=>Pr,BasePrepare:()=>wl,BaseRenderTexture:()=>Wr,BaseTexture:()=>Rr,BatchDrawCall:()=>Ps,BatchGeometry:()=>$s,BatchPluginFactory:()=>zs,BatchRenderer:()=>Gs,BatchShaderGenerator:()=>Bs,BatchSystem:()=>fi,BatchTextureArray:()=>Ds,BitmapFont:()=>th,BitmapFontData:()=>Xl,BitmapFontLoader:()=>sh,BitmapText:()=>ih,BlobResource:()=>Ia,Bounds:()=>Fn,Buffer:()=>Qr,BufferResource:()=>Nr,CLEAR_MODES:()=>me,CanvasResource:()=>Dr,Circle:()=>bn,CompressedTextureLoader:()=>Ca,CompressedTextureResource:()=>ka,Container:()=>or,ContextSystem:()=>gi,CountLimiter:()=>pl,CubeResource:()=>Fr,DDSLoader:()=>Ya,DEG_TO_RAD:()=>vn,DRAW_MODES:()=>ae,DisplayObject:()=>ir,ENV:()=>ne,Ellipse:()=>wn,Extract:()=>Js,FORMATS:()=>oe,FORMATS_TO_COMPONENTS:()=>oo,FillStyle:()=>xo,Filter:()=>qi,FilterState:()=>hi,FilterSystem:()=>di,Framebuffer:()=>Gr,FramebufferSystem:()=>xi,GC_MODES:()=>ge,GLFramebuffer:()=>yi,GLProgram:()=>ms,GLTexture:()=>_s,GRAPHICS_CURVES:()=>vo,Geometry:()=>ii,GeometrySystem:()=>wi,Graphics:()=>Yo,GraphicsData:()=>Uo,GraphicsGeometry:()=>Go,IGLUniformData:()=>fs,INSTALLED:()=>Tr,INTERNAL_FORMATS:()=>va,INTERNAL_FORMAT_TO_BYTES_PER_PIXEL:()=>ba,ImageBitmapResource:()=>Ur,ImageResource:()=>Lr,InteractionData:()=>fr,InteractionEvent:()=>gr,InteractionManager:()=>wr,InteractionTrackingData:()=>yr,KTXLoader:()=>ho,LINE_CAP:()=>fo,LINE_JOIN:()=>po,LineStyle:()=>Wo,Loader:()=>fa,LoaderResource:()=>la,MASK_TYPES:()=>ve,MIPMAP_MODES:()=>pe,MSAA_QUALITY:()=>xe,MaskData:()=>_i,MaskSystem:()=>Qi,Matrix:()=>In,Mesh:()=>Vl,MeshBatchUvs:()=>Bl,MeshGeometry:()=>Gl,MeshMaterial:()=>zl,NineSlicePlane:()=>mu,ObjectRenderer:()=>pi,ObservablePoint:()=>Sn,PI_2:()=>gn,PRECISION:()=>ye,ParticleContainer:()=>mo,ParticleRenderer:()=>yo,PlaneGeometry:()=>uu,Point:()=>En,Polygon:()=>_n,Prepare:()=>Sl,Program:()=>Hi,ProjectionSystem:()=>is,Quad:()=>si,QuadUv:()=>ai,RAD_TO_DEG:()=>yn,RENDERER_TYPE:()=>re,Rectangle:()=>xn,RenderTexture:()=>qr,RenderTexturePool:()=>Kr,RenderTextureSystem:()=>os,Renderer:()=>Ns,Resource:()=>Cr,RopeGeometry:()=>cu,RoundedRectangle:()=>Tn,Runner:()=>_r,SAMPLER_TYPES:()=>ue,SCALE_MODES:()=>ce,SHAPES:()=>mn,SVGResource:()=>Br,ScissorSystem:()=>ns,Shader:()=>Yi,ShaderSystem:()=>xs,SimpleMesh:()=>fu,SimplePlane:()=>pu,SimpleRope:()=>du,Sprite:()=>Qo,SpriteMaskFilter:()=>Ji,Spritesheet:()=>kl,SpritesheetLoader:()=>Cl,State:()=>ji,StateSystem:()=>bs,StencilSystem:()=>rs,System:()=>Os,TARGETS:()=>le,TEXT_GRADIENT:()=>Ko,TYPES:()=>he,TYPES_TO_BYTES_PER_COMPONENT:()=>ao,TYPES_TO_BYTES_PER_PIXEL:()=>lo,TemporaryDisplayObject:()=>sr,Text:()=>cl,TextMetrics:()=>ol,TextStyle:()=>rl,Texture:()=>Yr,TextureGCSystem:()=>ws,TextureLoader:()=>ga,TextureMatrix:()=>Zi,TextureSystem:()=>Ts,TextureUvs:()=>Xr,Ticker:()=>dr,TickerPlugin:()=>pr,TilingSprite:()=>Ml,TilingSpriteRenderer:()=>Dl,TimeLimiter:()=>Il,Transform:()=>Dn,UPDATE_PRIORITY:()=>hr,UniformGroup:()=>li,VERSION:()=>vu,VideoResource:()=>$r,ViewableBuffer:()=>Fs,WRAP_MODES:()=>de,accessibleTarget:()=>lr,autoDetectRenderer:()=>As,autoDetectResource:()=>Er,checkMaxIfStatementsInShader:()=>Gi,createUBOElements:()=>cs,defaultFilterVertex:()=>Ms,defaultVertex:()=>Rs,filters:()=>xu,generateProgram:()=>gs,generateUniformBufferSync:()=>ps,getTestContext:()=>Ai,getUBOData:()=>ds,graphicsUtils:()=>jo,groupD8:()=>Pn,interactiveTarget:()=>xr,isMobile:()=>ee,resources:()=>Ws,settings:()=>we,systems:()=>Ys,uniformParsers:()=>Li,utils:()=>t});var r={};n.r(r),n.d(r,{arraysEqual:()=>vg,arraysEqualWithNull:()=>yg,assert:()=>dg,assertNonNegativeIntegerDimensions:()=>jg,assertNonNull:()=>fg,assertShapesMatch:()=>pg,bytesFromStringArray:()=>Pg,bytesPerElement:()=>Og,checkConversionForErrors:()=>Ag,clamp:()=>ag,computeStrides:()=>Vg,convertBackendValuesAndArrayBuffer:()=>Wg,createScalarValue:()=>Jb,createShuffledIndices:()=>_g,decodeString:()=>rw,distSquared:()=>cg,encodeString:()=>nw,fetch:()=>ew,fingerPrint64:()=>Zb,flatten:()=>sw,getArrayFromDType:()=>Ng,getTypedArrayFromDType:()=>Cg,hasEncodingLoss:()=>Mg,hexToLong:()=>Ub,indexToLoc:()=>Kg,inferDtype:()=>Bg,inferFromImplicitShape:()=>Sg,isBoolean:()=>Fg,isFunction:()=>$g,isInt:()=>xg,isNumber:()=>Lg,isPromise:()=>Zg,isScalarShape:()=>gg,isString:()=>Dg,isTypedArray:()=>iw,isValidDtype:()=>Rg,locToIndex:()=>qg,makeOnesTypedArray:()=>Xg,makeZerosNestedTypedArray:()=>Yg,makeZerosTypedArray:()=>Hg,nearestDivisor:()=>Ug,nearestLargerEven:()=>og,now:()=>tw,parseAxisParam:()=>Ig,randUniform:()=>ug,repeatedTry:()=>Eg,rightPad:()=>Tg,shuffle:()=>ig,shuffleCombo:()=>sg,sizeFromShape:()=>mg,sizeToSquarishShape:()=>wg,squeezeShape:()=>kg,sum:()=>hg,swap:()=>lg,tanh:()=>bg,toNestedArray:()=>Gg,toTypedArray:()=>Qb});var i={};n.r(i),n.d(i,{assertTypesMatch:()=>Mw,getTensorsInContainer:()=>Pw,isTensorInList:()=>Ow,makeTypesMatch:()=>Rw});var s={};n.r(s),n.d(s,{isBrowser:()=>Xw,isMobile:()=>Ww,mockIsMobile:()=>Gw});var a={};n.r(a),n.d(a,{Serializable:()=>WT,SerializationMap:()=>XT,getRegisteredName:()=>YT,registerClass:()=>HT});var o={};n.r(o),n.d(o,{assertAndGetBroadcastShape:()=>iE,getBroadcastDims:()=>nE,getReductionAxes:()=>rE});var l={};n.r(l),n.d(l,{CompositeArrayBuffer:()=>i_,browserFiles:()=>fE,browserHTTPRequest:()=>TE,concatenateArrayBuffers:()=>u_,copyModel:()=>K_,decodeWeights:()=>a_,encodeWeights:()=>s_,fromMemory:()=>kE,fromMemorySync:()=>CE,getLoadHandlers:()=>__,getModelArtifactsForJSON:()=>f_,getModelArtifactsForJSONSync:()=>p_,getModelArtifactsInfoForJSON:()=>m_,getSaveHandlers:()=>w_,getWeightSpecs:()=>g_,http:()=>_E,isHTTPScheme:()=>bE,listModels:()=>j_,loadWeights:()=>yE,moveModel:()=>Z_,registerLoadRouter:()=>b_,registerSaveRouter:()=>x_,removeModel:()=>q_,weightsLoaderFactory:()=>vE,withSaveHandler:()=>NE,withSaveHandlerSync:()=>AE});var h={};n.r(h),n.d(h,{confusionMatrix:()=>LE});var u={};n.r(u),n.d(u,{draw:()=>HE,fromPixels:()=>YE,fromPixelsAsync:()=>GE,toPixels:()=>XE});var c={};n.r(c),n.d(c,{prepareAndValidate:()=>jE});var d={};n.r(d),n.d(d,{calculateShapes:()=>ZE,validateInput:()=>KE,validateUpdateShape:()=>qE});var p={};n.r(p),n.d(p,{assertParamsValid:()=>JE,computeFlatOffset:()=>cS,computeOutShape:()=>tS,getNormalizedAxes:()=>iS,isSliceContinous:()=>uS,maskToAxes:()=>QE,parseSliceParams:()=>dS,sliceInfo:()=>pS,startForAxis:()=>lS,startIndicesWithElidedDims:()=>sS,stopForAxis:()=>hS,stopIndicesWithElidedDims:()=>aS,stridesForAxis:()=>oS,stridesWithElidedDims:()=>eS});var f={};n.r(f),n.d(f,{TEST_EPSILON_FLOAT16:()=>mS,createVideoElement:()=>IS,encodeStrings:()=>SS,expectArrayBuffersEqual:()=>ES,expectArraysClose:()=>gS,expectArraysEqual:()=>bS,expectNumbersClose:()=>wS,expectPromiseToFail:()=>xS,expectValuesInRange:()=>TS,play:()=>kS,testEpsilon:()=>yS});var m={};n.r(m),n.d(m,{conv2d:()=>MN,depthwiseConv2d:()=>DN,matMul:()=>FN});var g={};n.r(g),n.d(g,{collectGatherOpShapeInfo:()=>GR,computeOutShape:()=>zR,segOpComputeOptimalWindowSize:()=>VR});var y={};n.r(y),n.d(y,{ERF_A1:()=>oR,ERF_A2:()=>lR,ERF_A3:()=>hR,ERF_A4:()=>uR,ERF_A5:()=>cR,ERF_P:()=>aR,PARALLELIZE_THRESHOLD:()=>KA,RowPartitionType:()=>XA,SELU_SCALE:()=>sR,SELU_SCALEALPHA:()=>iR,applyActivation:()=>AN,assertAndGetBroadcastShape:()=>iE,assertAxesAreInnerMostDims:()=>tk,assertParamsConsistent:()=>GA,assignToTypedArray:()=>yR,axesAreInnerMostDims:()=>KI,calculateShapes:()=>ZE,checkEinsumDimSizes:()=>ER,checkPadOnDimRoundingMode:()=>nI,combineLocations:()=>ZI,combineRaggedTensorToTensorShapes:()=>HA,complexWithEvenIndex:()=>fR,complexWithOddIndex:()=>mR,computeConv2DInfo:()=>XS,computeConv3DInfo:()=>HS,computeDefaultPad:()=>YS,computeDilation2DInfo:()=>zS,computeOptimalWindowSize:()=>ZA,computeOutAndReduceShapes:()=>JI,computeOutShape:()=>WA,computePool2DInfo:()=>GS,computePool3DInfo:()=>WS,convertConv2DDataFormat:()=>eI,decodeEinsumEquation:()=>_R,eitherStridesOrDilationsAreOne:()=>QS,expandShapeToKeepDim:()=>QI,exponent:()=>xR,exponents:()=>vR,fromStringArrayToUint8:()=>XR,fromUint8ToStringArray:()=>WR,getAxesPermutation:()=>ek,getBroadcastDims:()=>nE,getComplexWithIndex:()=>gR,getEinsumComputePath:()=>SR,getEinsumPermutation:()=>TR,getFusedBiasGradient:()=>NN,getFusedDyActivation:()=>CN,getImageCenter:()=>JA,getInnerMostAxes:()=>rk,getPermuted:()=>tR,getRaggedRank:()=>jA,getReductionAxes:()=>rE,getReshaped:()=>QA,getReshapedPermuted:()=>eR,getRowPartitionTypesHelper:()=>YA,getSliceBeginCoords:()=>nR,getSliceSize:()=>rR,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>NR,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>AR,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>RR,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>PR,getSparseReshapeInputOutputMismatchErrorMessage:()=>FR,getSparseReshapeInputOutputMultipleErrorMessage:()=>DR,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>MR,getSparseReshapeNegativeOutputDimErrorMessage:()=>OR,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>UR,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>LR,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>BR,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>$R,getUndoAxesPermutation:()=>nk,isIdentityPermutation:()=>IR,log:()=>Sb,mergeRealAndImagArrays:()=>dR,prepareAndValidate:()=>jE,prepareSplitSize:()=>CR,segment_util:()=>g,shouldFuse:()=>RN,slice_util:()=>p,splitRealAndImagArrays:()=>pR,stridesOrDilationsArePositive:()=>tI,tupleValuesAreOne:()=>JS,upcastType:()=>kw,validateDefaultValueShape:()=>qA,validateInput:()=>KE,validateUpdateShape:()=>qE,warn:()=>Eb});var v={};n.r(v),n.d(v,{nonMaxSuppressionV3Impl:()=>qN,nonMaxSuppressionV4Impl:()=>KN,nonMaxSuppressionV5Impl:()=>ZN,whereImpl:()=>gN});var x={};n.r(x),n.d(x,{maxNorm:()=>WD,minMaxNorm:()=>YD,nonNeg:()=>HD,unitNorm:()=>XD});var b={};n.r(b),n.d(b,{constant:()=>KD,glorotNormal:()=>rF,glorotUniform:()=>nF,heNormal:()=>iF,heUniform:()=>sF,identity:()=>tF,leCunNormal:()=>aF,leCunUniform:()=>oF,ones:()=>qD,orthogonal:()=>lF,randomNormal:()=>JD,randomUniform:()=>ZD,truncatedNormal:()=>QD,varianceScaling:()=>eF,zeros:()=>jD});var w={};n.r(w),n.d(w,{Layer:()=>TD,RNN:()=>CB,RNNCell:()=>NB,activation:()=>lU,add:()=>yU,alphaDropout:()=>oV,average:()=>vU,averagePooling1d:()=>kU,averagePooling2d:()=>AU,averagePooling3d:()=>OU,avgPool1d:()=>CU,avgPool2d:()=>RU,avgPool3d:()=>PU,avgPooling1d:()=>NU,avgPooling2d:()=>MU,avgPooling3d:()=>DU,batchNormalization:()=>EU,bidirectional:()=>QU,categoryEncoding:()=>dV,centerCrop:()=>uV,concatenate:()=>xU,conv1d:()=>Q$,conv2d:()=>tU,conv2dTranspose:()=>eU,conv3d:()=>nU,conv3dTranspose:()=>rU,convLstm2d:()=>qU,convLstm2dCell:()=>KU,cropping2D:()=>sU,dense:()=>hU,depthwiseConv2d:()=>oU,dot:()=>TU,dropout:()=>uU,elu:()=>Y$,embedding:()=>gU,flatten:()=>dU,gaussianDropout:()=>aV,gaussianNoise:()=>sV,globalAveragePooling1d:()=>FU,globalAveragePooling2d:()=>LU,globalMaxPool1d:()=>eV,globalMaxPool2d:()=>nV,globalMaxPooling1d:()=>BU,globalMaxPooling2d:()=>$U,gru:()=>GU,gruCell:()=>WU,input:()=>kL,inputLayer:()=>H$,layerNormalization:()=>SU,leakyReLU:()=>q$,lstm:()=>XU,lstmCell:()=>HU,masking:()=>lV,maxPool1d:()=>rV,maxPool2d:()=>iV,maxPooling1d:()=>UU,maxPooling2d:()=>VU,maxPooling3d:()=>zU,maximum:()=>bU,minimum:()=>wU,multiply:()=>_U,permute:()=>mU,prelu:()=>K$,randomWidth:()=>pV,reLU:()=>j$,repeatVector:()=>pU,rescaling:()=>hV,reshape:()=>fU,resizing:()=>cV,rnn:()=>ZU,separableConv2d:()=>iU,simpleRNN:()=>YU,simpleRNNCell:()=>jU,softmax:()=>Z$,spatialDropout1d:()=>cU,stackedRNNCells:()=>JU,thresholdedReLU:()=>J$,timeDistributed:()=>tV,upSampling2d:()=>aU,zeroPadding2d:()=>IU});var _={};n.r(_),n.d(_,{MAPE:()=>EV,MSE:()=>kV,binaryAccuracy:()=>fV,binaryCrossentropy:()=>mV,categoricalAccuracy:()=>yV,categoricalCrossentropy:()=>vV,cosineProximity:()=>wV,mape:()=>SV,meanAbsoluteError:()=>_V,meanAbsolutePercentageError:()=>TV,meanSquaredError:()=>IV,mse:()=>CV,precision:()=>xV,recall:()=>bV,sparseCategoricalAccuracy:()=>gV});var T={};n.r(T),n.d(T,{modelFromJSON:()=>_L});var E={};n.r(E),n.d(E,{l1:()=>AV,l1l2:()=>NV,l2:()=>RV});var S={};n.r(S),n.d(S,{json:()=>ZV});var I={};n.r(I),n.d(I,{json:()=>JV});var k={};n.r(k),n.d(k,{json:()=>QV});var C={};n.r(C),n.d(C,{json:()=>tz});var N={};n.r(N),n.d(N,{json:()=>ez});var A={};n.r(A),n.d(A,{json:()=>nz});var R={};n.r(R),n.d(R,{json:()=>rz});var M={};n.r(M),n.d(M,{json:()=>iz});var O={};n.r(O),n.d(O,{json:()=>sz});var P={};n.r(P),n.d(P,{json:()=>az});var D={};n.r(D),n.d(D,{json:()=>oz});var F={};n.r(F),n.d(F,{json:()=>lz});var L={};n.r(L),n.d(L,{json:()=>hz});var B={};n.r(B),n.d(B,{json:()=>uz});var $={};n.r($),n.d($,{json:()=>cz});var U={};n.r(U),n.d(U,{json:()=>dz});var V={};n.r(V),n.d(V,{json:()=>pz});var z={};n.r(z),n.d(z,{json:()=>fz});var G={};n.r(G),n.d(G,{json:()=>mz});var W={};n.r(W),n.d(W,{OP_SCOPE_SUFFIX:()=>Jw,abs:()=>eE,acos:()=>AS,acosh:()=>RS,add:()=>kT,addN:()=>MS,all:()=>OS,any:()=>PS,argMax:()=>DS,argMin:()=>FS,asin:()=>LS,asinh:()=>BS,atan:()=>$S,atan2:()=>US,atanh:()=>VS,avgPool:()=>iI,avgPool3d:()=>sI,basicLSTMCell:()=>uI,batchNorm:()=>dI,batchNorm2d:()=>pI,batchNorm3d:()=>fI,batchNorm4d:()=>mI,batchToSpaceND:()=>cI,bincount:()=>gI,bitwiseAnd:()=>yI,booleanMaskAsync:()=>vN,broadcastArgs:()=>vI,broadcastTo:()=>xI,buffer:()=>nT,cast:()=>rT,ceil:()=>bI,clipByValue:()=>wI,clone:()=>iT,complex:()=>t_,concat:()=>aI,concat1d:()=>_I,concat2d:()=>TI,concat3d:()=>EI,concat4d:()=>SI,conv1d:()=>kI,conv2d:()=>II,conv2dTranspose:()=>NI,conv3d:()=>AI,conv3dTranspose:()=>MI,cos:()=>OI,cosh:()=>PI,cosineWindow:()=>SN,cumprod:()=>DI,cumsum:()=>FI,denseBincount:()=>LI,depthToSpace:()=>BI,depthwiseConv2d:()=>$I,diag:()=>UI,dilation2d:()=>VI,div:()=>NT,divNoNan:()=>WI,dot:()=>XI,dropout:()=>TN,einsum:()=>HI,elu:()=>YI,enclosingPowerOfTwo:()=>EN,ensureShape:()=>jI,equal:()=>zI,erf:()=>qI,euclideanNorm:()=>hk,exp:()=>uk,expandDims:()=>ck,expm1:()=>dk,eye:()=>fk,fft:()=>HC,fill:()=>KT,floor:()=>mk,floorDiv:()=>CT,fused:()=>m,gather:()=>gk,gatherND:()=>_N,greater:()=>yk,greaterEqual:()=>vk,ifft:()=>YC,imag:()=>OE,image:()=>DA,inTopKAsync:()=>IN,irfft:()=>jC,isFinite:()=>xk,isInf:()=>bk,isNaN:()=>wk,leakyRelu:()=>_k,less:()=>Tk,lessEqual:()=>Ek,linalg:()=>FA,linspace:()=>Sk,localResponseNormalization:()=>Ik,log:()=>kk,log1p:()=>Ck,logSigmoid:()=>Ak,logSoftmax:()=>Rk,logSumExp:()=>Mk,logicalAnd:()=>Ok,logicalNot:()=>Pk,logicalOr:()=>Dk,logicalXor:()=>Fk,losses:()=>LA,lowerBound:()=>$k,matMul:()=>RE,max:()=>ik,maxPool:()=>Uk,maxPool3d:()=>Vk,maxPoolWithArgmax:()=>zk,maximum:()=>sE,mean:()=>Gk,meshgrid:()=>Hk,min:()=>sk,minimum:()=>Yk,mirrorPad:()=>jk,mod:()=>qk,moments:()=>Kk,movingAverage:()=>xN,mul:()=>AT,multiRNNCell:()=>Zk,multinomial:()=>Jk,neg:()=>PE,norm:()=>lk,notEqual:()=>Qk,oneHot:()=>ME,ones:()=>Xk,onesLike:()=>tC,op:()=>Qw,outerProduct:()=>eC,pad:()=>nC,pad1d:()=>rC,pad2d:()=>iC,pad3d:()=>sC,pad4d:()=>aC,pool:()=>lC,pow:()=>JT,prelu:()=>hC,print:()=>sT,prod:()=>uC,raggedGather:()=>cC,raggedRange:()=>dC,raggedTensorToTensor:()=>pC,rand:()=>fC,randomGamma:()=>xC,randomNormal:()=>bC,randomStandardNormal:()=>wC,randomUniform:()=>_C,randomUniformInt:()=>TC,range:()=>EC,real:()=>DE,reciprocal:()=>SC,relu:()=>IC,relu6:()=>kC,reshape:()=>rI,reverse:()=>CC,reverse1d:()=>NC,reverse2d:()=>AC,reverse3d:()=>RC,reverse4d:()=>MC,rfft:()=>KC,round:()=>OC,rsqrt:()=>PC,scalar:()=>VT,scatterND:()=>bN,searchSorted:()=>Bk,selu:()=>DC,separableConv2d:()=>FC,setdiff1dAsync:()=>LC,sigmoid:()=>oI,sign:()=>BC,signal:()=>PA,sin:()=>$C,sinh:()=>UC,slice:()=>lI,slice1d:()=>VC,slice2d:()=>zC,slice3d:()=>GC,slice4d:()=>WC,softmax:()=>XC,softplus:()=>Nk,spaceToBatchND:()=>oC,sparse:()=>BA,sparseToDense:()=>wN,spectral:()=>OA,split:()=>qC,sqrt:()=>RT,square:()=>MT,squaredDifference:()=>ZC,squeeze:()=>JC,stack:()=>QC,step:()=>tN,stridedSlice:()=>eN,string:()=>$A,sub:()=>QT,sum:()=>ak,tan:()=>nN,tanh:()=>hI,tensor:()=>n_,tensor1d:()=>rN,tensor2d:()=>iN,tensor3d:()=>BE,tensor4d:()=>sN,tensor5d:()=>aN,tensor6d:()=>oN,tensorScatterUpdate:()=>lN,tile:()=>pk,topk:()=>hN,transpose:()=>FE,truncatedNormal:()=>uN,unique:()=>cN,unsortedSegmentSum:()=>dN,unstack:()=>pN,upperBound:()=>fN,variable:()=>mN,where:()=>GI,whereAsync:()=>yN,zeros:()=>Wk,zerosLike:()=>OT});var X={};n.r(X),n.d(X,{CSVDataset:()=>jG,Dataset:()=>FG,FileDataSource:()=>oW,TextLineDataset:()=>VG,URLDataSource:()=>lW,array:()=>BG,csv:()=>hW,func:()=>uW,generator:()=>cW,microphone:()=>pW,version_data:()=>fW,webcam:()=>dW,zip:()=>$G});var H={};n.r(H),n.d(H,{addImpl:()=>OW,bincountImpl:()=>LW,bincountReduceImpl:()=>BW,bitwiseAndImpl:()=>$W,castImpl:()=>CW,ceilImpl:()=>XW,concatImpl:()=>jW,equalImpl:()=>qW,expImpl:()=>JW,expm1Impl:()=>eX,floorDivImpl:()=>oX,floorImpl:()=>iX,gatherNdImpl:()=>uX,gatherV2Impl:()=>cX,greaterEqualImpl:()=>mX,greaterImpl:()=>dX,lessEqualImpl:()=>wX,lessImpl:()=>vX,linSpaceImpl:()=>EX,logImpl:()=>SX,maxImpl:()=>CX,maximumImpl:()=>NX,minimumImpl:()=>MX,multiplyImpl:()=>DX,negImpl:()=>$X,notEqualImpl:()=>VX,prodImpl:()=>YX,raggedGatherImpl:()=>JX,raggedRangeImpl:()=>tH,raggedTensorToTensorImpl:()=>sH,rangeImpl:()=>aH,rsqrtImpl:()=>oH,scatterImpl:()=>uH,sigmoidImpl:()=>cH,simpleAbsImpl:()=>vW,sliceImpl:()=>fH,sparseFillEmptyRowsImpl:()=>yH,sparseReshapeImpl:()=>vH,sparseSegmentReductionImpl:()=>xH,sqrtImpl:()=>bH,squaredDifferenceImpl:()=>TH,staticRegexReplaceImpl:()=>IH,stridedSliceImpl:()=>NH,stringNGramsImpl:()=>RH,stringSplitImpl:()=>OH,stringToHashBucketFastImpl:()=>PH,subImpl:()=>DH,tileImpl:()=>$H,topKImpl:()=>zH,transposeImpl:()=>WX,uniqueImpl:()=>GH});var Y={};n.r(Y),n.d(Y,{assertNotComplex:()=>nJ,bindCanvasToFramebuffer:()=>AZ,bindColorTextureToFramebuffer:()=>RZ,bindTextureToProgramUniformSampler:()=>NZ,bindTextureUnit:()=>SZ,bindVertexBufferToProgramAttribute:()=>EZ,callAndCheck:()=>oZ,canBeRepresented:()=>lZ,createFragmentShader:()=>dZ,createFramebuffer:()=>TZ,createProgram:()=>mZ,createStaticIndexBuffer:()=>xZ,createStaticVertexBuffer:()=>vZ,createTexture:()=>wZ,createVertexShader:()=>cZ,getBatchDim:()=>LZ,getExtensionOrThrow:()=>uZ,getFramebufferErrorMessage:()=>PZ,getMaxTexturesInShader:()=>jZ,getNumChannels:()=>bZ,getProgramUniformLocation:()=>CZ,getProgramUniformLocationOrThrow:()=>kZ,getRowsCols:()=>BZ,getShapeAs3D:()=>$Z,getTextureShapeFromLogicalShape:()=>UZ,getWebGLDisjointQueryTimerVersion:()=>qZ,getWebGLErrorMessage:()=>hZ,getWebGLMaxTextureSize:()=>XZ,hasExtension:()=>KZ,isCapableOfRenderingToFloatTexture:()=>JZ,isDownloadFloatTextureEnabled:()=>QZ,isReshapeFree:()=>zZ,isWebGLFenceEnabled:()=>eJ,isWebGLVersionEnabled:()=>ZZ,linkProgram:()=>gZ,logShaderSourceAndInfoLog:()=>fZ,resetMaxTextureSize:()=>HZ,resetMaxTexturesInShader:()=>YZ,unbindColorTextureFromFramebuffer:()=>MZ,unbindTextureUnit:()=>IZ,validateFramebuffer:()=>OZ,validateProgram:()=>yZ,validateTextureSize:()=>_Z});var j={};n.r(j),n.d(j,{bindVertexProgramAttributeStreams:()=>qJ,createBufferFromOutputTexture:()=>JJ,createFloat16MatrixTexture:()=>zJ,createFloat16PackedMatrixTexture:()=>jJ,createFloat32MatrixTexture:()=>UJ,createIndexBuffer:()=>LJ,createPackedMatrixTexture:()=>HJ,createUnsignedBytesMatrixTexture:()=>WJ,createVertexBuffer:()=>FJ,createVertexShader:()=>DJ,downloadByteEncodedFloatMatrixFromOutputTexture:()=>tQ,downloadFloat32MatrixFromBuffer:()=>QJ,downloadMatrixFromPackedOutputTexture:()=>nQ,downloadPackedMatrixFromBuffer:()=>eQ,getInternalFormatForFloat16MatrixTexture:()=>VJ,getInternalFormatForFloat16PackedMatrixTexture:()=>YJ,getInternalFormatForFloat32MatrixTexture:()=>$J,getInternalFormatForPackedMatrixTexture:()=>XJ,getInternalFormatForUnsignedBytesMatrixTexture:()=>GJ,uploadDenseMatrixToTexture:()=>KJ,uploadPixelDataToTexture:()=>ZJ});var q={};n.r(q),n.d(q,{Abs:()=>ay,Acos:()=>oy,Acosh:()=>ly,AdadeltaOptimizer:()=>qT,AdagradOptimizer:()=>ZT,AdamOptimizer:()=>tE,AdamaxOptimizer:()=>aE,Add:()=>hy,AddN:()=>uy,All:()=>cy,Any:()=>dy,ArgMax:()=>py,ArgMin:()=>fy,Asin:()=>my,Asinh:()=>gy,Atan:()=>yy,Atan2:()=>xy,Atanh:()=>vy,AvgPool:()=>by,AvgPool3D:()=>_y,AvgPool3DGrad:()=>Ty,AvgPoolGrad:()=>wy,BatchMatMul:()=>Ey,BatchToSpaceND:()=>Sy,Bincount:()=>Iy,BitwiseAnd:()=>ky,BroadcastArgs:()=>Ny,BroadcastTo:()=>Cy,Callback:()=>MV,CallbackList:()=>pF,Cast:()=>Ay,Ceil:()=>Ry,ClipByValue:()=>My,Complex:()=>Oy,ComplexAbs:()=>Py,Concat:()=>Dy,Conv2D:()=>Fy,Conv2DBackpropFilter:()=>Ly,Conv2DBackpropInput:()=>By,Conv3D:()=>$y,Conv3DBackpropFilterV2:()=>Uy,Conv3DBackpropInputV2:()=>Vy,Cos:()=>zy,Cosh:()=>Gy,CropAndResize:()=>Hy,Cumprod:()=>Wy,Cumsum:()=>Xy,CustomCallback:()=>gF,DataStorage:()=>eg,DenseBincount:()=>Yy,DepthToSpace:()=>jy,DepthwiseConv2dNative:()=>qy,DepthwiseConv2dNativeBackpropFilter:()=>Ky,DepthwiseConv2dNativeBackpropInput:()=>Zy,Diag:()=>Jy,Dilation2D:()=>Qy,Dilation2DBackpropFilter:()=>ev,Dilation2DBackpropInput:()=>tv,Draw:()=>nv,ENV:()=>ry,EarlyStopping:()=>DV,Einsum:()=>iv,Elu:()=>sv,EluGrad:()=>av,Environment:()=>Qg,Equal:()=>lv,Erf:()=>ov,Exp:()=>hv,ExpandDims:()=>uv,Expm1:()=>cv,FFT:()=>dv,Fill:()=>pv,FlipLeftRight:()=>fv,Floor:()=>mv,FloorDiv:()=>gv,FromPixels:()=>xb,FusedBatchNorm:()=>yv,FusedConv2D:()=>_b,FusedDepthwiseConv2D:()=>Tb,GPGPUContext:()=>rQ,GatherNd:()=>xv,GatherV2:()=>vv,GraphModel:()=>eG,Greater:()=>bv,GreaterEqual:()=>wv,History:()=>mF,IFFT:()=>Tv,Identity:()=>_v,Imag:()=>Ev,InputSpec:()=>vD,IsFinite:()=>Sv,IsInf:()=>Iv,IsNan:()=>kv,KernelBackend:()=>ng,LRN:()=>Uv,LRNGrad:()=>Vv,LayerVariable:()=>mD,LayersModel:()=>bL,LeakyRelu:()=>Cv,Less:()=>Nv,LessEqual:()=>Av,LinSpace:()=>Rv,Log:()=>Mv,Log1p:()=>Ov,LogSoftmax:()=>Bv,LogicalAnd:()=>Pv,LogicalNot:()=>Dv,LogicalOr:()=>Fv,LogicalXor:()=>Lv,LowerBound:()=>$v,MathBackendCPU:()=>yW,MathBackendWebGL:()=>m0,MatrixBandPart:()=>zv,Max:()=>Gv,MaxPool:()=>Xv,MaxPool3D:()=>Yv,MaxPool3DGrad:()=>jv,MaxPoolGrad:()=>Hv,MaxPoolWithArgmax:()=>qv,Maximum:()=>Wv,Mean:()=>Kv,Min:()=>Zv,Minimum:()=>Jv,MirrorPad:()=>Qv,Mod:()=>tx,MomentumOptimizer:()=>lE,Multinomial:()=>ex,Multiply:()=>nx,Neg:()=>rx,NonMaxSuppressionV3:()=>sx,NonMaxSuppressionV4:()=>ax,NonMaxSuppressionV5:()=>ox,NotEqual:()=>ix,OP_SCOPE_SUFFIX:()=>Jw,OneHot:()=>hx,OnesLike:()=>lx,Optimizer:()=>jT,OptimizerConstructors:()=>NS,Pack:()=>ux,PadV2:()=>cx,Pool:()=>dx,Pow:()=>px,Prelu:()=>fx,Prod:()=>mx,RMSPropOptimizer:()=>hE,RNN:()=>CB,RaggedGather:()=>gx,RaggedRange:()=>yx,RaggedTensorToTensor:()=>vx,Range:()=>xx,Rank:()=>ww,Real:()=>bx,RealDiv:()=>rv,Reciprocal:()=>wx,Reduction:()=>mA,Relu:()=>_x,Relu6:()=>Cx,Reshape:()=>Tx,ResizeBilinear:()=>Ix,ResizeBilinearGrad:()=>kx,ResizeNearestNeighbor:()=>Ex,ResizeNearestNeighborGrad:()=>Sx,Reverse:()=>Nx,RotateWithOffset:()=>bb,Round:()=>Ax,Rsqrt:()=>Rx,SGDOptimizer:()=>oE,ScatterNd:()=>Mx,SearchSorted:()=>Px,Select:()=>Dx,Selu:()=>Fx,Sequential:()=>EL,Sigmoid:()=>Vx,Sign:()=>Ux,Sin:()=>Bx,Sinh:()=>$x,Slice:()=>Lx,Softmax:()=>Yx,Softplus:()=>zx,SpaceToBatchND:()=>Xx,SparseFillEmptyRows:()=>jx,SparseReshape:()=>qx,SparseSegmentMean:()=>Kx,SparseSegmentSum:()=>Zx,SparseToDense:()=>Jx,SplitV:()=>Hx,Sqrt:()=>Gx,Square:()=>tb,SquaredDifference:()=>Qx,StaticRegexReplace:()=>eb,Step:()=>vb,StridedSlice:()=>nb,StringNGrams:()=>rb,StringSplit:()=>ib,StringToHashBucketFast:()=>sb,Sub:()=>ab,Sum:()=>Wx,SymbolicTensor:()=>xD,Tan:()=>ob,Tanh:()=>lb,Tensor:()=>vw,TensorBuffer:()=>fw,TensorScatterUpdate:()=>Ox,Tile:()=>hb,TopK:()=>ub,Transform:()=>cb,Transpose:()=>db,Unique:()=>pb,Unpack:()=>fb,UnsortedSegmentSum:()=>mb,UpperBound:()=>gb,Variable:()=>bw,ZerosLike:()=>yb,_FusedMatMul:()=>wb,abs:()=>eE,acos:()=>AS,acosh:()=>RS,add:()=>kT,addN:()=>MS,all:()=>OS,any:()=>PS,argMax:()=>DS,argMin:()=>FS,asin:()=>LS,asinh:()=>BS,atan:()=>$S,atan2:()=>US,atanh:()=>VS,avgPool:()=>iI,avgPool3d:()=>sI,backend:()=>ST,backend_util:()=>y,basicLSTMCell:()=>uI,batchNorm:()=>dI,batchNorm2d:()=>pI,batchNorm3d:()=>fI,batchNorm4d:()=>mI,batchToSpaceND:()=>cI,bincount:()=>gI,bitwiseAnd:()=>yI,booleanMaskAsync:()=>vN,broadcastArgs:()=>vI,broadcastTo:()=>xI,broadcast_util:()=>o,browser:()=>u,buffer:()=>nT,callbacks:()=>FV,cast:()=>rT,ceil:()=>bI,clipByValue:()=>wI,clone:()=>iT,complex:()=>t_,concat:()=>aI,concat1d:()=>_I,concat2d:()=>TI,concat3d:()=>EI,concat4d:()=>SI,constraints:()=>x,conv1d:()=>kI,conv2d:()=>II,conv2dTranspose:()=>NI,conv3d:()=>AI,conv3dTranspose:()=>MI,copyRegisteredKernels:()=>Db,cos:()=>OI,cosh:()=>PI,cosineWindow:()=>SN,cumprod:()=>DI,cumsum:()=>FI,customGrad:()=>$T,data:()=>X,denseBincount:()=>LI,deprecationWarn:()=>hT,depthToSpace:()=>BI,depthwiseConv2d:()=>$I,deregisterOp:()=>zV,device_util:()=>s,diag:()=>UI,dilation2d:()=>VI,disableDeprecationWarnings:()=>lT,dispose:()=>mT,disposeVariables:()=>uT,div:()=>NT,divNoNan:()=>WI,dot:()=>XI,dropout:()=>TN,einsum:()=>HI,elu:()=>YI,enableDebugMode:()=>oT,enableProdMode:()=>aT,enclosingPowerOfTwo:()=>EN,engine:()=>cT,ensureShape:()=>jI,env:()=>ey,equal:()=>zI,erf:()=>qI,euclideanNorm:()=>hk,exp:()=>uk,expandDims:()=>ck,expm1:()=>dk,eye:()=>fk,fft:()=>HC,fill:()=>KT,findBackend:()=>_T,findBackendFactory:()=>TT,floor:()=>mk,floorDiv:()=>CT,forceHalfFloat:()=>y0,fused:()=>m,gather:()=>gk,gatherND:()=>_N,gather_util:()=>c,getBackend:()=>bT,getGradient:()=>Nb,getKernel:()=>Cb,getKernelsForBackend:()=>Ab,gpgpu_util:()=>j,grad:()=>PT,grads:()=>DT,greater:()=>yk,greaterEqual:()=>vk,ifft:()=>YC,imag:()=>OE,image:()=>DA,inTopKAsync:()=>IN,initializers:()=>b,input:()=>kL,io:()=>l,irfft:()=>jC,isFinite:()=>xk,isInf:()=>bk,isNaN:()=>wk,keep:()=>gT,kernel_impls:()=>v,layers:()=>w,leakyRelu:()=>_k,less:()=>Tk,lessEqual:()=>Ek,linalg:()=>FA,linspace:()=>Sk,loadGraphModel:()=>nG,loadGraphModelSync:()=>rG,loadLayersModel:()=>TL,localResponseNormalization:()=>Ik,log:()=>kk,log1p:()=>Ck,logSigmoid:()=>Ak,logSoftmax:()=>Rk,logSumExp:()=>Mk,logicalAnd:()=>Ok,logicalNot:()=>Pk,logicalOr:()=>Dk,logicalXor:()=>Fk,losses:()=>LA,lowerBound:()=>$k,matMul:()=>RE,math:()=>h,max:()=>ik,maxPool:()=>Uk,maxPool3d:()=>Vk,maxPoolWithArgmax:()=>zk,maximum:()=>sE,mean:()=>Gk,memory:()=>dT,meshgrid:()=>Hk,metrics:()=>_,min:()=>sk,minimum:()=>Yk,mirrorPad:()=>jk,mod:()=>qk,model:()=>SL,models:()=>T,moments:()=>Kk,movingAverage:()=>xN,mul:()=>AT,multiRNNCell:()=>Zk,multinomial:()=>Jk,neg:()=>PE,nextFrame:()=>zA,norm:()=>lk,notEqual:()=>Qk,oneHot:()=>ME,ones:()=>Xk,onesLike:()=>tC,op:()=>Qw,outerProduct:()=>eC,pad:()=>nC,pad1d:()=>rC,pad2d:()=>iC,pad3d:()=>sC,pad4d:()=>aC,pool:()=>lC,pow:()=>JT,prelu:()=>hC,print:()=>sT,prod:()=>uC,profile:()=>pT,raggedGather:()=>cC,raggedRange:()=>dC,raggedTensorToTensor:()=>pC,rand:()=>fC,randomGamma:()=>xC,randomNormal:()=>bC,randomStandardNormal:()=>wC,randomUniform:()=>_C,randomUniformInt:()=>TC,range:()=>EC,ready:()=>xT,real:()=>DE,reciprocal:()=>SC,registerBackend:()=>ET,registerCallbackConstructor:()=>CL,registerGradient:()=>Mb,registerKernel:()=>Rb,registerOp:()=>UV,regularizers:()=>E,relu:()=>IC,relu6:()=>kC,removeBackend:()=>wT,reshape:()=>rI,reverse:()=>CC,reverse1d:()=>NC,reverse2d:()=>AC,reverse3d:()=>RC,reverse4d:()=>MC,rfft:()=>KC,round:()=>OC,rsqrt:()=>PC,scalar:()=>VT,scatterND:()=>bN,scatter_util:()=>d,searchSorted:()=>Bk,selu:()=>DC,separableConv2d:()=>FC,sequential:()=>IL,serialization:()=>a,setBackend:()=>vT,setPlatform:()=>IT,setWebGLContext:()=>JK,setdiff1dAsync:()=>LC,shared:()=>H,sigmoid:()=>oI,sign:()=>BC,signal:()=>PA,sin:()=>$C,sinh:()=>UC,slice:()=>lI,slice1d:()=>VC,slice2d:()=>zC,slice3d:()=>GC,slice4d:()=>WC,slice_util:()=>p,softmax:()=>XC,softplus:()=>Nk,spaceToBatchND:()=>oC,sparse:()=>BA,sparseToDense:()=>wN,spectral:()=>OA,split:()=>qC,sqrt:()=>RT,square:()=>MT,squaredDifference:()=>ZC,squeeze:()=>JC,stack:()=>QC,step:()=>tN,stridedSlice:()=>eN,string:()=>$A,sub:()=>QT,sum:()=>ak,sumOutType:()=>Cw,tan:()=>nN,tanh:()=>hI,tensor:()=>n_,tensor1d:()=>rN,tensor2d:()=>iN,tensor3d:()=>BE,tensor4d:()=>sN,tensor5d:()=>aN,tensor6d:()=>oN,tensorScatterUpdate:()=>lN,tensor_util:()=>i,test_util:()=>f,tidy:()=>fT,tile:()=>pk,time:()=>yT,topk:()=>hN,train:()=>UA,transpose:()=>FE,truncatedNormal:()=>uN,unique:()=>cN,unregisterGradient:()=>Pb,unregisterKernel:()=>Ob,unsortedSegmentSum:()=>dN,unstack:()=>pN,upcastType:()=>kw,upperBound:()=>fN,util:()=>r,valueAndGrad:()=>FT,valueAndGrads:()=>LT,variable:()=>mN,variableGrads:()=>BT,version:()=>l8,version_converter:()=>iG,version_core:()=>CS,version_cpu:()=>WH,version_layers:()=>tL,version_webgl:()=>g0,webgl:()=>v0,webgl_util:()=>Y,where:()=>GI,whereAsync:()=>yN,zeros:()=>Wk,zerosLike:()=>OT});var K={};n.r(K),n.d(K,{Animation:()=>Y7,AnimationState:()=>dtt,AnimationStateAdapter:()=>gtt,AnimationStateData:()=>ytt,AtlasAttachmentLoader:()=>vtt,Attachment:()=>L7,AttachmentTimeline:()=>ntt,Bone:()=>xtt,BoneData:()=>btt,BoundingBoxAttachment:()=>$7,ClippingAttachment:()=>U7,ColorTimeline:()=>ttt,ConstraintData:()=>wtt,CurveTimeline:()=>q7,DeformTimeline:()=>itt,DrawOrderTimeline:()=>att,Event:()=>_tt,EventData:()=>Ttt,EventQueue:()=>ftt,EventTimeline:()=>stt,EventType:()=>j7,IkConstraint:()=>Ett,IkConstraintData:()=>Stt,IkConstraintTimeline:()=>ott,JitterEffect:()=>X7,MeshAttachment:()=>V7,PathAttachment:()=>z7,PathConstraint:()=>ktt,PathConstraintData:()=>Itt,PathConstraintMixTimeline:()=>ctt,PathConstraintPositionTimeline:()=>htt,PathConstraintSpacingTimeline:()=>utt,PointAttachment:()=>G7,RegionAttachment:()=>W7,RotateTimeline:()=>K7,ScaleTimeline:()=>J7,ShearTimeline:()=>Q7,Skeleton:()=>Att,SkeletonBinary:()=>Ftt,SkeletonBounds:()=>$tt,SkeletonData:()=>Rtt,SkeletonJson:()=>Utt,Skin:()=>Dtt,SkinEntry:()=>Ptt,Slot:()=>Ctt,SlotData:()=>Mtt,SpacingMode:()=>mtt,Spine:()=>ztt,SwirlEffect:()=>H7,TimelineType:()=>F7,TrackEntry:()=>ptt,TransformConstraint:()=>Ntt,TransformConstraintData:()=>Ott,TransformConstraintTimeline:()=>ltt,TranslateTimeline:()=>Z7,TwoColorTimeline:()=>ett,VertexAttachment:()=>B7});var Z={};n.r(Z),n.d(Z,{Animation:()=>net,AnimationState:()=>_et,AnimationStateAdapter2:()=>ket,AnimationStateData:()=>Cet,AtlasAttachmentLoader:()=>Net,Attachment:()=>Htt,AttachmentTimeline:()=>det,Bone:()=>Aet,BoneData:()=>Ret,BoundingBoxAttachment:()=>jtt,ClippingAttachment:()=>qtt,ColorTimeline:()=>uet,CurveTimeline:()=>iet,DeformTimeline:()=>fet,DrawOrderTimeline:()=>get,Event:()=>Met,EventData:()=>Oet,EventQueue:()=>Eet,EventTimeline:()=>met,EventType:()=>ret,IkConstraint:()=>Pet,IkConstraintData:()=>Det,IkConstraintTimeline:()=>yet,JitterEffect:()=>tet,MeshAttachment:()=>Ktt,PathAttachment:()=>Ztt,PathConstraint:()=>Let,PathConstraintData:()=>Fet,PathConstraintMixTimeline:()=>wet,PathConstraintPositionTimeline:()=>xet,PathConstraintSpacingTimeline:()=>bet,PointAttachment:()=>Jtt,RegionAttachment:()=>Qtt,RotateTimeline:()=>set,ScaleTimeline:()=>oet,ShearTimeline:()=>het,Skeleton:()=>Uet,SkeletonBounds:()=>Vet,SkeletonData:()=>zet,SkeletonJson:()=>Het,Skin:()=>Xet,Slot:()=>Bet,SlotData:()=>Get,SpacingMode:()=>Iet,Spine:()=>jet,SwirlEffect:()=>eet,TimelineType:()=>Xtt,TrackEntry:()=>Tet,TransformConstraint:()=>$et,TransformConstraintData:()=>Wet,TransformConstraintTimeline:()=>vet,TranslateTimeline:()=>aet,TwoColorTimeline:()=>cet,VertexAttachment:()=>Ytt});var J={};n.r(J),n.d(J,{AlphaTimeline:()=>Wnt,Animation:()=>lnt,AnimationState:()=>nrt,AnimationStateAdapter:()=>art,AnimationStateData:()=>mrt,AtlasAttachmentLoader:()=>grt,Attachment:()=>Jet,AttachmentTimeline:()=>Ynt,Bone:()=>yrt,BoneData:()=>vrt,BoundingBoxAttachment:()=>tnt,ClippingAttachment:()=>ent,ConstraintData:()=>xrt,CurveTimeline:()=>Nnt,CurveTimeline1:()=>Ant,CurveTimeline2:()=>Rnt,DeformTimeline:()=>jnt,DrawOrderTimeline:()=>Knt,Event:()=>brt,EventData:()=>wrt,EventQueue:()=>irt,EventTimeline:()=>qnt,EventType:()=>Zet,IkConstraint:()=>_rt,IkConstraintData:()=>Trt,IkConstraintTimeline:()=>Znt,JitterEffect:()=>ant,MeshAttachment:()=>nnt,PathAttachment:()=>rnt,PathConstraint:()=>Srt,PathConstraintData:()=>Ert,PathConstraintMixTimeline:()=>ert,PathConstraintPositionTimeline:()=>Qnt,PathConstraintSpacingTimeline:()=>trt,PointAttachment:()=>int,RGB2Timeline:()=>Hnt,RGBA2Timeline:()=>Xnt,RGBATimeline:()=>znt,RGBTimeline:()=>Gnt,RegionAttachment:()=>snt,RotateTimeline:()=>Mnt,ScaleTimeline:()=>Fnt,ScaleXTimeline:()=>Lnt,ScaleYTimeline:()=>Bnt,ShearTimeline:()=>$nt,ShearXTimeline:()=>Unt,ShearYTimeline:()=>Vnt,Skeleton:()=>Crt,SkeletonBinary:()=>Prt,SkeletonBounds:()=>oit,SkeletonData:()=>Nrt,SkeletonJson:()=>lit,Skin:()=>Ort,SkinEntry:()=>Mrt,Slot:()=>Irt,SlotData:()=>Art,SpacingMode:()=>srt,Spine:()=>mit,SwirlEffect:()=>ont,Timeline:()=>Cnt,TrackEntry:()=>rrt,TransformConstraint:()=>krt,TransformConstraintData:()=>Rrt,TransformConstraintTimeline:()=>Jnt,TranslateTimeline:()=>Ont,TranslateXTimeline:()=>Pnt,TranslateYTimeline:()=>Dnt,VertexAttachment:()=>Qet});const Q=function(t){var e=this.constructor;return this.then((function(n){return e.resolve(t()).then((function(){return n}))}),(function(n){return e.resolve(t()).then((function(){return e.reject(n)}))}))};const tt=function(t){return new this((function(e,n){if(!t||void 0===t.length)return n(new TypeError(typeof t+" "+t+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var i=r.length;function s(t,n){if(n&&("object"==typeof n||"function"==typeof n)){var a=n.then;if("function"==typeof a)return void a.call(n,(function(e){s(t,e)}),(function(n){r[t]={status:"rejected",reason:n},0==--i&&e(r)}))}r[t]={status:"fulfilled",value:n},0==--i&&e(r)}for(var a=0;a<r.length;a++)s(a,r[a])}))};var et=setTimeout,nt="undefined"!=typeof setImmediate?setImmediate:null;function rt(t){return Boolean(t&&void 0!==t.length)}function it(){}function st(t){if(!(this instanceof st))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],ct(t,this)}function at(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,st._immediateFn((function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(t){return void lt(e.promise,t)}ot(e.promise,r)}else(1===t._state?ot:lt)(e.promise,t._value)}))):t._deferreds.push(e)}function ot(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof st)return t._state=3,t._value=e,void ht(t);if("function"==typeof n)return void ct((r=n,i=e,function(){r.apply(i,arguments)}),t)}t._state=1,t._value=e,ht(t)}catch(e){lt(t,e)}var r,i}function lt(t,e){t._state=2,t._value=e,ht(t)}function ht(t){2===t._state&&0===t._deferreds.length&&st._immediateFn((function(){t._handled||st._unhandledRejectionFn(t._value)}));for(var e=0,n=t._deferreds.length;e<n;e++)at(t,t._deferreds[e]);t._deferreds=null}function ut(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function ct(t,e){var n=!1;try{t((function(t){n||(n=!0,ot(e,t))}),(function(t){n||(n=!0,lt(e,t))}))}catch(t){if(n)return;n=!0,lt(e,t)}}st.prototype.catch=function(t){return this.then(null,t)},st.prototype.then=function(t,e){var n=new this.constructor(it);return at(this,new ut(t,e,n)),n},st.prototype.finally=Q,st.all=function(t){return new st((function(e,n){if(!rt(t))return n(new TypeError("Promise.all accepts an array"));var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var i=r.length;function s(t,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var o=a.then;if("function"==typeof o)return void o.call(a,(function(e){s(t,e)}),n)}r[t]=a,0==--i&&e(r)}catch(t){n(t)}}for(var a=0;a<r.length;a++)s(a,r[a])}))},st.allSettled=tt,st.resolve=function(t){return t&&"object"==typeof t&&t.constructor===st?t:new st((function(e){e(t)}))},st.reject=function(t){return new st((function(e,n){n(t)}))},st.race=function(t){return new st((function(e,n){if(!rt(t))return n(new TypeError("Promise.race accepts an array"));for(var r=0,i=t.length;r<i;r++)st.resolve(t[r]).then(e,n)}))},st._immediateFn="function"==typeof nt&&function(t){nt(t)}||function(t){et(t,0)},st._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console};const dt=st;var pt=n(418),ft=n.n(pt);self.Promise||(self.Promise=dt),Object.assign||(Object.assign=ft());if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!self.performance||!self.performance.now){var mt=Date.now();self.performance||(self.performance={}),self.performance.now=function(){return Date.now()-mt}}for(var gt=Date.now(),yt=["ms","moz","webkit","o"],vt=0;vt<yt.length&&!self.requestAnimationFrame;++vt){var xt=yt[vt];self.requestAnimationFrame=self[xt+"RequestAnimationFrame"],self.cancelAnimationFrame=self[xt+"CancelAnimationFrame"]||self[xt+"CancelRequestAnimationFrame"]}self.requestAnimationFrame||(self.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),n=16+gt-e;return n<0&&(n=0),gt=e,self.setTimeout((function(){gt=Date.now(),t(performance.now())}),n)}),self.cancelAnimationFrame||(self.cancelAnimationFrame=function(t){return clearTimeout(t)}),Math.sign||(Math.sign=function(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),self.ArrayBuffer||(self.ArrayBuffer=Array),self.Float32Array||(self.Float32Array=Array),self.Uint32Array||(self.Uint32Array=Array),self.Uint16Array||(self.Uint16Array=Array),self.Uint8Array||(self.Uint8Array=Array),self.Int32Array||(self.Int32Array=Array);var bt=/iPhone/i,wt=/iPod/i,_t=/iPad/i,Tt=/\biOS-universal(?:.+)Mac\b/i,Et=/\bAndroid(?:.+)Mobile\b/i,St=/Android/i,It=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,kt=/Silk/i,Ct=/Windows Phone/i,Nt=/\bWindows(?:.+)ARM\b/i,At=/BlackBerry/i,Rt=/BB10/i,Mt=/Opera Mini/i,Ot=/\b(CriOS|Chrome)(?:.+)Mobile/i,Pt=/Mobile(?:.+)Firefox\b/i,Dt=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};var Ft,Lt,Bt,$t,Ut,Vt,zt,Gt,Wt,Xt,Ht,Yt,jt,qt,Kt,Zt,Jt,Qt,te,ee=function(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var n=e.userAgent,r=n.split("[FBAN");void 0!==r[1]&&(n=r[0]),void 0!==(r=n.split("Twitter"))[1]&&(n=r[0]);var i=function(t){return function(e){return e.test(t)}}(n),s={apple:{phone:i(bt)&&!i(Ct),ipod:i(wt),tablet:!i(bt)&&(i(_t)||Dt(e))&&!i(Ct),universal:i(Tt),device:(i(bt)||i(wt)||i(_t)||i(Tt)||Dt(e))&&!i(Ct)},amazon:{phone:i(It),tablet:!i(It)&&i(kt),device:i(It)||i(kt)},android:{phone:!i(Ct)&&i(It)||!i(Ct)&&i(Et),tablet:!i(Ct)&&!i(It)&&!i(Et)&&(i(kt)||i(St)),device:!i(Ct)&&(i(It)||i(kt)||i(Et)||i(St))||i(/\bokhttp\b/i)},windows:{phone:i(Ct),tablet:i(Nt),device:i(Ct)||i(Nt)},other:{blackberry:i(At),blackberry10:i(Rt),opera:i(Mt),firefox:i(Pt),chrome:i(Ot),device:i(At)||i(Rt)||i(Mt)||i(Pt)||i(Ot)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}(self.navigator);!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(Ft||(Ft={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(Lt||(Lt={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(Bt||(Bt={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}($t||($t={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Ut||(Ut={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(Vt||(Vt={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(zt||(zt={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(Gt||(Gt={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(Wt||(Wt={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(Xt||(Xt={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Ht||(Ht={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(Yt||(Yt={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"}(jt||(jt={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(qt||(qt={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(Kt||(Kt={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(Zt||(Zt={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(Jt||(Jt={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(Qt||(Qt={})),function(t){t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(te||(te={}));var ne,re,ie,se,ae,oe,le,he,ue,ce,de,pe,fe,me,ge,ye,ve,xe,be,we={MIPMAP_TEXTURES:Yt.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:Qt.NONE,SPRITE_MAX_TEXTURES:function(t){var e=!0;if(ee.tablet||ee.phone){var n;if(ee.apple.device)if(n=navigator.userAgent.match(/OS (\d+)_(\d+)?/))parseInt(n[1],10)<11&&(e=!1);if(ee.android.device)if(n=navigator.userAgent.match(/Android\s([0-9.]*)/))parseInt(n[1],10)<7&&(e=!1)}return e?t:4}(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:Kt.AUTO,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:Ht.CLAMP,SCALE_MODE:Xt.LINEAR,PRECISION_VERTEX:Zt.HIGH,PRECISION_FRAGMENT:ee.apple.device?Zt.HIGH:Zt.MEDIUM,CAN_UPLOAD_SAME_BUFFER:!ee.apple.device,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},_e=n(729),Te=n.n(_e),Ee=n(187),Se=n.n(Ee),Ie=n(575);!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(ne||(ne={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(re||(re={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(ie||(ie={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(se||(se={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(ae||(ae={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(oe||(oe={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(le||(le={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(he||(he={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(ue||(ue={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(ce||(ce={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(de||(de={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(pe||(pe={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"}(fe||(fe={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(me||(me={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(ge||(ge={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(ye||(ye={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(ve||(ve={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(xe||(xe={})),function(t){t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(be||(be={}));var ke={parse:Ie.Qc,format:Ie.WU,resolve:Ie.DB};we.RETINA_PREFIX=/@([0-9\.]+)x/,we.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Ce,Ne=!1;function Ae(){Ne=!0}function Re(t){var e;if(!Ne){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var n=["\n %c %c %c PixiJS 6.2.0 - ✰ "+t+" ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=self.console).log.apply(e,n)}else self.console&&self.console.log("PixiJS 6.2.0 - "+t+" - http://www.pixijs.com/");Ne=!0}}function Me(){return void 0===Ce&&(Ce=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:we.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!self.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),r=!(!n||!n.getContextAttributes().stencil);if(n){var i=n.getExtension("WEBGL_lose_context");i&&i.loseContext()}return n=null,r}catch(t){return!1}}()),Ce}var Oe={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function Pe(t,e){return void 0===e&&(e=[]),e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e}function De(t){var e=t.toString(16);return"#"+(e="000000".substr(0,6-e.length)+e)}function Fe(t){return"string"==typeof t&&"#"===(t=Oe[t.toLowerCase()]||t)[0]&&(t=t.substr(1)),parseInt(t,16)}function Le(t){return(255*t[0]<<16)+(255*t[1]<<8)+(255*t[2]|0)}var Be=function(){for(var t=[],e=[],n=0;n<32;n++)t[n]=n,e[n]=n;t[se.NORMAL_NPM]=se.NORMAL,t[se.ADD_NPM]=se.ADD,t[se.SCREEN_NPM]=se.SCREEN,e[se.NORMAL]=se.NORMAL_NPM,e[se.ADD]=se.ADD_NPM,e[se.SCREEN]=se.SCREEN_NPM;var r=[];return r.push(e),r.push(t),r}();function $e(t,e){return Be[e?1:0][t]}function Ue(t,e,n,r){return n=n||new Float32Array(4),r||void 0===r?(n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e):(n[0]=t[0],n[1]=t[1],n[2]=t[2]),n[3]=e,n}function Ve(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;var n=t>>16&255,r=t>>8&255,i=255&t;return(255*e<<24)+((n=n*e+.5|0)<<16)+((r=r*e+.5|0)<<8)+(i=i*e+.5|0)}function ze(t,e,n,r){return(n=n||new Float32Array(4))[0]=(t>>16&255)/255,n[1]=(t>>8&255)/255,n[2]=(255&t)/255,(r||void 0===r)&&(n[0]*=e,n[1]*=e,n[2]*=e),n[3]=e,n}function Ge(t,e){void 0===e&&(e=null);var n=6*t;if((e=e||new Uint16Array(n)).length!==n)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+n);for(var r=0,i=0;r<n;r+=6,i+=4)e[r+0]=i+0,e[r+1]=i+1,e[r+2]=i+2,e[r+3]=i+0,e[r+4]=i+2,e[r+5]=i+3;return e}function We(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}var Xe={Float32Array,Uint32Array,Int32Array,Uint8Array};function He(t,e){for(var n=0,r=0,i={},s=0;s<t.length;s++)r+=e[s],n+=t[s].length;var a=new ArrayBuffer(4*n),o=null,l=0;for(s=0;s<t.length;s++){var h=e[s],u=t[s],c=We(u);i[c]||(i[c]=new Xe[c](a)),o=i[c];for(var d=0;d<u.length;d++){o[(d/h|0)*r+l+d%h]=u[d]}l+=h}return new Float32Array(a)}function Ye(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function je(t){return!(t&t-1||!t)}function qe(t){var e=(t>65535?1:0)<<4,n=((t>>>=e)>255?1:0)<<3;return e|=n,e|=n=((t>>>=n)>15?1:0)<<2,(e|=n=((t>>>=n)>3?1:0)<<1)|(t>>>=n)>>1}function Ke(t,e,n){var r,i=t.length;if(!(e>=i||0===n)){var s=i-(n=e+n>i?i-e:n);for(r=e;r<s;++r)t[r]=t[r+n];t.length=s}}function Ze(t){return 0===t?0:t<0?-1:1}var Je=0;function Qe(){return++Je}var tn={};function en(t,e,n){if(void 0===n&&(n=3),!tn[e]){var r=(new Error).stack;void 0===r||(r=r.split("\n").splice(n).join("\n"),console.groupCollapsed),tn[e]=!0}}var nn={},rn=Object.create(null),sn=Object.create(null);function an(){var t;for(t in rn)rn[t].destroy();for(t in sn)sn[t].destroy()}function on(){var t;for(t in rn)delete rn[t];for(t in sn)delete sn[t]}var ln=function(){function t(t,e,n){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=n||we.RESOLUTION,this.resize(t,e)}return t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.resize=function(t,e){this.canvas.width=Math.round(t*this.resolution),this.canvas.height=Math.round(e*this.resolution)},t.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(t.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=Math.round(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=Math.round(t)},enumerable:!1,configurable:!0}),t}();function hn(t){var e,n,r,i=t.width,s=t.height,a=t.getContext("2d"),o=a.getImageData(0,0,i,s).data,l=o.length,h={top:null,left:null,right:null,bottom:null},u=null;for(e=0;e<l;e+=4)0!==o[e+3]&&(n=e/4%i,r=~~(e/4/i),null===h.top&&(h.top=r),(null===h.left||n<h.left)&&(h.left=n),(null===h.right||h.right<n)&&(h.right=n+1),(null===h.bottom||h.bottom<r)&&(h.bottom=r));return null!==h.top&&(i=h.right-h.left,s=h.bottom-h.top+1,u=a.getImageData(h.left,h.top,i,s)),{height:s,width:i,data:u}}var un,cn=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function dn(t){var e=cn.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}}function pn(t,e){if(void 0===e&&(e=self.location),0===t.indexOf("data:"))return"";e=e||self.location,un||(un=document.createElement("a")),un.href=t;var n=ke.parse(un.href),r=!n.port&&""===e.port||n.port===e.port;return n.hostname===e.hostname&&r&&n.protocol===e.protocol?"":"anonymous"}function fn(t,e){var n=we.RETINA_PREFIX.exec(t);return n?parseFloat(n[1]):void 0!==e?e:1}var mn,gn=2*Math.PI,yn=180/Math.PI,vn=Math.PI/180;!function(t){t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC"}(mn||(mn={}));var xn=function(){function t(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=Number(t),this.y=Number(e),this.width=Number(n),this.height=Number(r),this.type=mn.RECT}return Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(t,"EMPTY",{get:function(){return new t(0,0,0,0)},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},t.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)},t.prototype.pad=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},t.prototype.fit=function(t){var e=Math.max(this.x,t.x),n=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),i=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(n-e,0),this.y=r,this.height=Math.max(i-r,0),this},t.prototype.ceil=function(t,e){void 0===t&&(t=1),void 0===e&&(e=.001);var n=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=n-this.x,this.height=r-this.y,this},t.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),n=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),i=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=n-e,this.y=r,this.height=i-r,this},t.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},t}(),bn=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.radius=n,this.type=mn.CIRC}return t.prototype.clone=function(){return new t(this.x,this.y,this.radius)},t.prototype.contains=function(t,e){if(this.radius<=0)return!1;var n=this.radius*this.radius,r=this.x-t,i=this.y-e;return(r*=r)+(i*=i)<=n},t.prototype.getBounds=function(){return new xn(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},t.prototype.toString=function(){return"[@pixi/math:Circle x="+this.x+" y="+this.y+" radius="+this.radius+"]"},t}(),wn=function(){function t(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=t,this.y=e,this.width=n,this.height=r,this.type=mn.ELIP}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var n=(t-this.x)/this.width,r=(e-this.y)/this.height;return(n*=n)+(r*=r)<=1},t.prototype.getBounds=function(){return new xn(this.x-this.width,this.y-this.height,this.width,this.height)},t.prototype.toString=function(){return"[@pixi/math:Ellipse x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},t}(),_n=function(){function t(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];var r=Array.isArray(e[0])?e[0]:e;if("number"!=typeof r[0]){for(var i=[],s=0,a=r.length;s<a;s++)i.push(r[s].x,r[s].y);r=i}this.points=r,this.type=mn.POLY,this.closeStroke=!0}return t.prototype.clone=function(){var e=new t(this.points.slice());return e.closeStroke=this.closeStroke,e},t.prototype.contains=function(t,e){for(var n=!1,r=this.points.length/2,i=0,s=r-1;i<r;s=i++){var a=this.points[2*i],o=this.points[2*i+1],l=this.points[2*s],h=this.points[2*s+1];o>e!=h>e&&t<(e-o)/(h-o)*(l-a)+a&&(n=!n)}return n},t.prototype.toString=function(){return"[@pixi/math:PolygoncloseStroke="+this.closeStroke+"points="+this.points.reduce((function(t,e){return t+", "+e}),"")+"]"},t}(),Tn=function(){function t(t,e,n,r,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=20),this.x=t,this.y=e,this.width=n,this.height=r,this.radius=i,this.type=mn.RREC}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height,this.radius)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){if(e>=this.y+this.radius&&e<=this.y+this.height-this.radius||t>=this.x+this.radius&&t<=this.x+this.width-this.radius)return!0;var n=t-(this.x+this.radius),r=e-(this.y+this.radius),i=this.radius*this.radius;if(n*n+r*r<=i)return!0;if((n=t-(this.x+this.width-this.radius))*n+r*r<=i)return!0;if(n*n+(r=e-(this.y+this.height-this.radius))*r<=i)return!0;if((n=t-(this.x+this.radius))*n+r*r<=i)return!0}return!1},t.prototype.toString=function(){return"[@pixi/math:RoundedRectangle x="+this.x+" y="+this.y+"width="+this.width+" height="+this.height+" radius="+this.radius+"]"},t}(),En=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},t.prototype.copyTo=function(t){return t.set(this.x,this.y),t},t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this},t.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},t}(),Sn=function(){function t(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0),this._x=n,this._y=r,this.cb=t,this.scope=e}return t.prototype.clone=function(e,n){return void 0===e&&(e=this.cb),void 0===n&&(n=this.scope),new t(e,n,this._x,this._y)},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this},t.prototype.copyFrom=function(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},t.prototype.copyTo=function(t){return t.set(this._x,this._y),t},t.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},t.prototype.toString=function(){return"[@pixi/math:ObservablePoint x=0 y=0 scope="+this.scope+"]"},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),t}(),In=function(){function t(t,e,n,r,i,s){void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===i&&(i=0),void 0===s&&(s=0),this.array=null,this.a=t,this.b=e,this.c=n,this.d=r,this.tx=i,this.ty=s}return t.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.prototype.set=function(t,e,n,r,i,s){return this.a=t,this.b=e,this.c=n,this.d=r,this.tx=i,this.ty=s,this},t.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var n=e||this.array;return t?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n},t.prototype.apply=function(t,e){e=e||new En;var n=t.x,r=t.y;return e.x=this.a*n+this.c*r+this.tx,e.y=this.b*n+this.d*r+this.ty,e},t.prototype.applyInverse=function(t,e){e=e||new En;var n=1/(this.a*this.d+this.c*-this.b),r=t.x,i=t.y;return e.x=this.d*n*r+-this.c*n*i+(this.ty*this.c-this.tx*this.d)*n,e.y=this.a*n*i+-this.b*n*r+(-this.ty*this.a+this.tx*this.b)*n,e},t.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),n=Math.sin(t),r=this.a,i=this.c,s=this.tx;return this.a=r*e-this.b*n,this.b=r*n+this.b*e,this.c=i*e-this.d*n,this.d=i*n+this.d*e,this.tx=s*e-this.ty*n,this.ty=s*n+this.ty*e,this},t.prototype.append=function(t){var e=this.a,n=this.b,r=this.c,i=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*n+t.b*i,this.c=t.c*e+t.d*r,this.d=t.c*n+t.d*i,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*n+t.ty*i+this.ty,this},t.prototype.setTransform=function(t,e,n,r,i,s,a,o,l){return this.a=Math.cos(a+l)*i,this.b=Math.sin(a+l)*i,this.c=-Math.sin(a-o)*s,this.d=Math.cos(a-o)*s,this.tx=t-(n*this.a+r*this.c),this.ty=e-(n*this.b+r*this.d),this},t.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var n=this.a,r=this.c;this.a=n*t.a+this.b*t.c,this.b=n*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},t.prototype.decompose=function(t){var e=this.a,n=this.b,r=this.c,i=this.d,s=t.pivot,a=-Math.atan2(-r,i),o=Math.atan2(n,e),l=Math.abs(a+o);return l<1e-5||Math.abs(gn-l)<1e-5?(t.rotation=o,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=o),t.scale.x=Math.sqrt(e*e+n*n),t.scale.y=Math.sqrt(r*r+i*i),t.position.x=this.tx+(s.x*e+s.y*r),t.position.y=this.ty+(s.x*n+s.y*i),t},t.prototype.invert=function(){var t=this.a,e=this.b,n=this.c,r=this.d,i=this.tx,s=t*r-e*n;return this.a=r/s,this.b=-e/s,this.c=-n/s,this.d=t/s,this.tx=(n*this.ty-r*i)/s,this.ty=-(t*this.ty-e*i)/s,this},t.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.prototype.clone=function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},t.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(t,"IDENTITY",{get:function(){return new t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"TEMP_MATRIX",{get:function(){return new t},enumerable:!1,configurable:!0}),t}(),kn=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Cn=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Nn=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],An=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Rn=[],Mn=[],On=Math.sign;!function(){for(var t=0;t<16;t++){var e=[];Rn.push(e);for(var n=0;n<16;n++)for(var r=On(kn[t]*kn[n]+Nn[t]*Cn[n]),i=On(Cn[t]*kn[n]+An[t]*Cn[n]),s=On(kn[t]*Nn[n]+Nn[t]*An[n]),a=On(Cn[t]*Nn[n]+An[t]*An[n]),o=0;o<16;o++)if(kn[o]===r&&Cn[o]===i&&Nn[o]===s&&An[o]===a){e.push(o);break}}for(t=0;t<16;t++){var l=new In;l.set(kn[t],Cn[t],Nn[t],An[t],0,0),Mn.push(l)}}();var Pn={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return kn[t]},uY:function(t){return Cn[t]},vX:function(t){return Nn[t]},vY:function(t){return An[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return Rn[t][e]},sub:function(t,e){return Rn[t][Pn.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?e>=0?Pn.S:Pn.N:2*Math.abs(e)<=Math.abs(t)?t>0?Pn.E:Pn.W:e>0?t>0?Pn.SE:Pn.SW:t>0?Pn.NE:Pn.NW},matrixAppendRotationInv:function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=Mn[Pn.inv(e)];i.tx=n,i.ty=r,t.append(i)}},Dn=function(){function t(){this.worldTransform=new In,this.localTransform=new In,this.position=new Sn(this.onChange,this,0,0),this.scale=new Sn(this.onChange,this,1,1),this.pivot=new Sn(this.onChange,this,0,0),this.skew=new Sn(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return t.prototype.onChange=function(){this._localID++},t.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},t.prototype.toString=function(){return"[@pixi/math:Transform position=("+this.position.x+", "+this.position.y+") rotation="+this.rotation+" scale=("+this.scale.x+", "+this.scale.y+") skew=("+this.skew.x+", "+this.skew.y+") ]"},t.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},t.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var n=t.worldTransform,r=this.worldTransform;r.a=e.a*n.a+e.b*n.c,r.b=e.a*n.b+e.b*n.d,r.c=e.c*n.a+e.d*n.c,r.d=e.c*n.b+e.d*n.d,r.tx=e.tx*n.a+e.ty*n.c+n.tx,r.ty=e.tx*n.b+e.ty*n.d+n.ty,this._parentID=t._worldID,this._worldID++}},t.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!1,configurable:!0}),t.IDENTITY=new t,t}();we.SORTABLE_CHILDREN=!1;var Fn=function(){function t(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return t.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},t.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},t.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?xn.EMPTY:((t=t||new xn(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},t.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},t.prototype.addPointMatrix=function(t,e){var n=t.a,r=t.b,i=t.c,s=t.d,a=t.tx,o=t.ty,l=n*e.x+i*e.y+a,h=r*e.x+s*e.y+o;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,h),this.maxY=Math.max(this.maxY,h)},t.prototype.addQuad=function(t){var e=this.minX,n=this.minY,r=this.maxX,i=this.maxY,s=t[0],a=t[1];e=s<e?s:e,n=a<n?a:n,r=s>r?s:r,i=a>i?a:i,e=(s=t[2])<e?s:e,n=(a=t[3])<n?a:n,r=s>r?s:r,i=a>i?a:i,e=(s=t[4])<e?s:e,n=(a=t[5])<n?a:n,r=s>r?s:r,i=a>i?a:i,e=(s=t[6])<e?s:e,n=(a=t[7])<n?a:n,r=s>r?s:r,i=a>i?a:i,this.minX=e,this.minY=n,this.maxX=r,this.maxY=i},t.prototype.addFrame=function(t,e,n,r,i){this.addFrameMatrix(t.worldTransform,e,n,r,i)},t.prototype.addFrameMatrix=function(t,e,n,r,i){var s=t.a,a=t.b,o=t.c,l=t.d,h=t.tx,u=t.ty,c=this.minX,d=this.minY,p=this.maxX,f=this.maxY,m=s*e+o*n+h,g=a*e+l*n+u;c=m<c?m:c,d=g<d?g:d,p=m>p?m:p,f=g>f?g:f,c=(m=s*r+o*n+h)<c?m:c,d=(g=a*r+l*n+u)<d?g:d,p=m>p?m:p,f=g>f?g:f,c=(m=s*e+o*i+h)<c?m:c,d=(g=a*e+l*i+u)<d?g:d,p=m>p?m:p,f=g>f?g:f,c=(m=s*r+o*i+h)<c?m:c,d=(g=a*r+l*i+u)<d?g:d,p=m>p?m:p,f=g>f?g:f,this.minX=c,this.minY=d,this.maxX=p,this.maxY=f},t.prototype.addVertexData=function(t,e,n){for(var r=this.minX,i=this.minY,s=this.maxX,a=this.maxY,o=e;o<n;o+=2){var l=t[o],h=t[o+1];r=l<r?l:r,i=h<i?h:i,s=l>s?l:s,a=h>a?h:a}this.minX=r,this.minY=i,this.maxX=s,this.maxY=a},t.prototype.addVertices=function(t,e,n,r){this.addVerticesMatrix(t.worldTransform,e,n,r)},t.prototype.addVerticesMatrix=function(t,e,n,r,i,s){void 0===i&&(i=0),void 0===s&&(s=i);for(var a=t.a,o=t.b,l=t.c,h=t.d,u=t.tx,c=t.ty,d=this.minX,p=this.minY,f=this.maxX,m=this.maxY,g=n;g<r;g+=2){var y=e[g],v=e[g+1],x=a*y+l*v+u,b=h*v+o*y+c;d=Math.min(d,x-i),f=Math.max(f,x+i),p=Math.min(p,b-s),m=Math.max(m,b+s)}this.minX=d,this.minY=p,this.maxX=f,this.maxY=m},t.prototype.addBounds=function(t){var e=this.minX,n=this.minY,r=this.maxX,i=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<n?t.minY:n,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>i?t.maxY:i},t.prototype.addBoundsMask=function(t,e){var n=t.minX>e.minX?t.minX:e.minX,r=t.minY>e.minY?t.minY:e.minY,i=t.maxX<e.maxX?t.maxX:e.maxX,s=t.maxY<e.maxY?t.maxY:e.maxY;if(n<=i&&r<=s){var a=this.minX,o=this.minY,l=this.maxX,h=this.maxY;this.minX=n<a?n:a,this.minY=r<o?r:o,this.maxX=i>l?i:l,this.maxY=s>h?s:h}},t.prototype.addBoundsMatrix=function(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)},t.prototype.addBoundsArea=function(t,e){var n=t.minX>e.x?t.minX:e.x,r=t.minY>e.y?t.minY:e.y,i=t.maxX<e.x+e.width?t.maxX:e.x+e.width,s=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(n<=i&&r<=s){var a=this.minX,o=this.minY,l=this.maxX,h=this.maxY;this.minX=n<a?n:a,this.minY=r<o?r:o,this.maxX=i>l?i:l,this.maxY=s>h?s:h}},t.prototype.pad=function(t,e){void 0===t&&(t=0),void 0===e&&(e=t),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)},t.prototype.addFramePad=function(t,e,n,r,i,s){t-=i,e-=s,n+=i,r+=s,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>n?this.maxX:n,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>r?this.maxY:r},t}(),Ln=function(t,e){return Ln=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},Ln(t,e)};function Bn(t,e){function n(){this.constructor=t}Ln(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var $n,Un,Vn,zn,Gn,Wn,Xn,Hn,Yn,jn,qn,Kn,Zn,Jn,Qn,tr,er,nr,rr,ir=function(t){function e(){var e=t.call(this)||this;return e.tempDisplayObjectParent=null,e.transform=new Dn,e.alpha=1,e.visible=!0,e.renderable=!0,e.parent=null,e.worldAlpha=1,e._lastSortedIndex=0,e._zIndex=0,e.filterArea=null,e.filters=null,e._enabledFilters=null,e._bounds=new Fn,e._localBounds=null,e._boundsID=0,e._boundsRect=null,e._localBoundsRect=null,e._mask=null,e._maskRefCount=0,e._destroyed=!1,e.isSprite=!1,e.isMask=!1,e}return Bn(e,t),e.mixin=function(t){for(var n=Object.keys(t),r=0;r<n.length;++r){var i=n[r];Object.defineProperty(e.prototype,i,Object.getOwnPropertyDescriptor(t,i))}},Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new xn),e=this._boundsRect),this._bounds.getRectangle(e)},e.prototype.getLocalBounds=function(t){t||(this._localBoundsRect||(this._localBoundsRect=new xn),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Fn);var e=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var r=this._bounds,i=this._boundsID;this._bounds=this._localBounds;var s=this.getBounds(!1,t);return this.parent=n,this.transform=e,this._bounds=r,this._bounds.updateID+=this._boundsID-i,s},e.prototype.toGlobal=function(t,e,n){return void 0===n&&(n=!1),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},e.prototype.toLocal=function(t,e,n,r){return e&&(t=e.toGlobal(t,n,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,n)},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(t,e,n,r,i,s,a,o,l){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===l&&(l=0),this.position.x=t,this.position.y=e,this.scale.x=n||1,this.scale.y=r||1,this.rotation=i,this.skew.x=s,this.skew.y=a,this.pivot.x=o,this.pivot.y=l,this},e.prototype.destroy=function(t){this.parent&&this.parent.removeChild(this),this.emit("destroyed"),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},Object.defineProperty(e.prototype,"_tempDisplayObjectParent",{get:function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new sr),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),e.prototype.enableTempParent=function(){var t=this.parent;return this.parent=this._tempDisplayObjectParent,t},e.prototype.disableTempParent=function(t){this.parent=t},Object.defineProperty(e.prototype,"x",{get:function(){return this.position.x},set:function(t){this.transform.position.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.position.y},set:function(t){this.transform.position.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.transform.position},set:function(t){this.transform.position.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.transform.scale},set:function(t){this.transform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skew",{get:function(){return this.transform.skew},set:function(t){this.transform.skew.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.transform.rotation*yn},set:function(t){this.transform.rotation=t*vn},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){if(this._mask!==t){var e;if(this._mask)(e=this._mask.maskObject||this._mask)._maskRefCount--,0===e._maskRefCount&&(e.renderable=!0,e.isMask=!1);if(this._mask=t,this._mask)0===(e=this._mask.maskObject||this._mask)._maskRefCount&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++}},enumerable:!1,configurable:!0}),e}(Te()),sr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sortDirty=null,e}return Bn(e,t),e}(ir);function ar(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}ir.prototype.displayObjectUpdateTransform=ir.prototype.updateTransform,function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}($n||($n={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(Un||(Un={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(Vn||(Vn={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(zn||(zn={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Gn||(Gn={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(Wn||(Wn={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(Xn||(Xn={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(Hn||(Hn={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(Yn||(Yn={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(jn||(jn={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(qn||(qn={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(Kn||(Kn={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"}(Zn||(Zn={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(Jn||(Jn={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(Qn||(Qn={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(tr||(tr={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(er||(er={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(nr||(nr={})),function(t){t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(rr||(rr={}));var or=function(t){function e(){var e=t.call(this)||this;return e.children=[],e.sortableChildren=we.SORTABLE_CHILDREN,e.sortDirty=!1,e}return Bn(e,t),e.prototype.onChildrenChange=function(t){},e.prototype.addChild=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];if(e.length>1)for(var r=0;r<e.length;r++)this.addChild(e[r]);else{var i=e[0];i.parent&&i.parent.removeChild(i),i.parent=this,this.sortDirty=!0,i.transform._parentID=-1,this.children.push(i),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",i,this,this.children.length-1),i.emit("added",this)}return e[0]},e.prototype.addChildAt=function(t,e){if(e<0||e>this.children.length)throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t},e.prototype.swapChildren=function(t,e){if(t!==e){var n=this.getChildIndex(t),r=this.getChildIndex(e);this.children[n]=e,this.children[r]=t,this.onChildrenChange(n<r?n:r)}},e.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The index "+e+" supplied is out of bounds "+this.children.length);var n=this.getChildIndex(t);Ke(this.children,n,1),this.children.splice(e,0,t),this.onChildrenChange(e)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];if(e.length>1)for(var r=0;r<e.length;r++)this.removeChild(e[r]);else{var i=e[0],s=this.children.indexOf(i);if(-1===s)return null;i.parent=null,i.transform._parentID=-1,Ke(this.children,s,1),this._boundsID++,this.onChildrenChange(s),i.emit("removed",this),this.emit("childRemoved",i,this,s)}return e[0]},e.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Ke(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e},e.prototype.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.children.length);var n,r=t,i=e-r;if(i>0&&i<=e){n=this.children.splice(r,i);for(var s=0;s<n.length;++s)n[s].parent=null,n[s].transform&&(n[s].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(s=0;s<n.length;++s)n[s].emit("removed",this),this.emit("childRemoved",n[s],this,s);return n}if(0===i&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var t=!1,e=0,n=this.children.length;e<n;++e){var r=this.children[e];r._lastSortedIndex=e,t||0===r.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(ar),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t){var n=this.children[t];n.visible&&n.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){var n=e._mask.maskObject||e._mask;n.calculateBounds(),this._bounds.addBoundsMask(e._bounds,n._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID},e.prototype.getLocalBounds=function(e,n){void 0===n&&(n=!1);var r=t.prototype.getLocalBounds.call(this,e);if(!n)for(var i=0,s=this.children.length;i<s;++i){var a=this.children[i];a.visible&&a.updateTransform()}return r},e.prototype._calculateBounds=function(){},e.prototype.render=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else{this._render(t);for(var e=0,n=this.children.length;e<n;++e)this.children[e].render(t)}},e.prototype.renderAdvanced=function(t){var e=this.filters,n=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var r=0;r<e.length;r++)e[r].enabled&&this._enabledFilters.push(e[r])}var i=e&&this._enabledFilters&&this._enabledFilters.length||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==er.NONE));i&&t.batch.flush(),e&&this._enabledFilters&&this._enabledFilters.length&&t.filter.push(this,this._enabledFilters),n&&t.mask.push(this,this._mask),this._render(t);r=0;for(var s=this.children.length;r<s;r++)this.children[r].render(t);i&&t.batch.flush(),n&&t.mask.pop(this),e&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},e.prototype._render=function(t){},e.prototype.destroy=function(e){t.prototype.destroy.call(this),this.sortDirty=!1;var n="boolean"==typeof e?e:e&&e.children,r=this.removeChildren(0,this.children.length);if(n)for(var i=0;i<r.length;++i)r[i].destroy(e)},Object.defineProperty(e.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t},enumerable:!1,configurable:!0}),e}(ir);or.prototype.containerUpdateTransform=or.prototype.updateTransform;var lr={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};ir.mixin(lr);var hr,ur=function(){function t(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(ee.tablet||ee.phone)&&this.createTouchHook();var e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),self.addEventListener("keydown",this._onKeyDown,!1)}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),t.prototype.createTouchHook=function(){var t=this,e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2..toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",(function(){t._isMobileAccessibility=!0,t.activate(),t.destroyTouchHook()})),document.body.appendChild(e),this._hookDiv=e},t.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},t.prototype.activate=function(){var t;this._isActive||(this._isActive=!0,self.document.addEventListener("mousemove",this._onMouseMove,!0),self.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),null===(t=this.renderer.view.parentNode)||void 0===t||t.appendChild(this.div))},t.prototype.deactivate=function(){var t;this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,self.document.removeEventListener("mousemove",this._onMouseMove,!0),self.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),null===(t=this.div.parentNode)||void 0===t||t.removeChild(this.div))},t.prototype.updateAccessibleObjects=function(t){if(t.visible&&t.accessibleChildren){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);var e=t.children;if(e)for(var n=0;n<e.length;n++)this.updateAccessibleObjects(e[n])}},t.prototype.update=function(){var t=performance.now();if(!(ee.android.device&&t<this.androidUpdateCount)&&(this.androidUpdateCount=t+this.androidUpdateFrequency,this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var e=this.renderer.view.getBoundingClientRect(),n=e.left,r=e.top,i=e.width,s=e.height,a=this.renderer,o=a.width,l=a.height,h=a.resolution,u=i/o*h,c=s/l*h,d=this.div;d.style.left=n+"px",d.style.top=r+"px",d.style.width=o+"px",d.style.height=l+"px";for(var p=0;p<this.children.length;p++){var f=this.children[p];if(f.renderId!==this.renderId)f._accessibleActive=!1,Ke(this.children,p,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,p--;else{d=f._accessibleDiv;var m=f.hitArea,g=f.worldTransform;f.hitArea?(d.style.left=(g.tx+m.x*g.a)*u+"px",d.style.top=(g.ty+m.y*g.d)*c+"px",d.style.width=m.width*g.a*u+"px",d.style.height=m.height*g.d*c+"px"):(m=f.getBounds(),this.capHitArea(m),d.style.left=m.x*u+"px",d.style.top=m.y*c+"px",d.style.width=m.width*u+"px",d.style.height=m.height*c+"px",d.title!==f.accessibleTitle&&null!==f.accessibleTitle&&(d.title=f.accessibleTitle),d.getAttribute("aria-label")!==f.accessibleHint&&null!==f.accessibleHint&&d.setAttribute("aria-label",f.accessibleHint)),f.accessibleTitle===d.title&&f.tabIndex===d.tabIndex||(d.title=f.accessibleTitle,d.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(d))}}this.renderId++}},t.prototype.updateDebugHTML=function(t){t.innerHTML="type: "+t.type+"</br> title : "+t.title+"</br> tabIndex: "+t.tabIndex},t.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);var e=this.renderer,n=e.width,r=e.height;t.x+t.width>n&&(t.width=n-t.x),t.y+t.height>r&&(t.height=r-t.y)},t.prototype.addChild=function(t){var e=this.pool.pop();e||((e=document.createElement("button")).style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title="displayObject "+t.tabIndex),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},t.prototype._onClick=function(t){var e=this.renderer.plugins.interaction,n=t.target.displayObject,r=e.eventData;e.dispatchEvent(n,"click",r),e.dispatchEvent(n,"pointertap",r),e.dispatchEvent(n,"tap",r)},t.prototype._onFocus=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive");var e=this.renderer.plugins.interaction,n=t.target.displayObject,r=e.eventData;e.dispatchEvent(n,"mouseover",r)},t.prototype._onFocusOut=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite");var e=this.renderer.plugins.interaction,n=t.target.displayObject,r=e.eventData;e.dispatchEvent(n,"mouseout",r)},t.prototype._onKeyDown=function(t){9===t.keyCode&&this.activate()},t.prototype._onMouseMove=function(t){0===t.movementX&&0===t.movementY||this.deactivate()},t.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,self.document.removeEventListener("mousemove",this._onMouseMove,!0),self.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},t}();we.TARGET_FPMS=.06,function(t){t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY"}(hr||(hr={}));var cr=function(){function t(t,e,n,r){void 0===e&&(e=null),void 0===n&&(n=0),void 0===r&&(r=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=n,this.once=r}return t.prototype.match=function(t,e){return void 0===e&&(e=null),this.fn===t&&this.context===e},t.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},t.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},t.prototype.destroy=function(t){void 0===t&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},t}(),dr=function(){function t(){var t=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new cr(null,null,1/0),this.deltaMS=1/we.TARGET_FPMS,this.elapsedMS=1/we.TARGET_FPMS,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return t.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},t.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},t.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},t.prototype.add=function(t,e,n){return void 0===n&&(n=hr.NORMAL),this._addListener(new cr(t,e,n))},t.prototype.addOnce=function(t,e,n){return void 0===n&&(n=hr.NORMAL),this._addListener(new cr(t,e,n,!0))},t.prototype._addListener=function(t){var e=this._head.next,n=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(n);break}n=e,e=e.next}t.previous||t.connect(n)}else t.connect(n);return this._startIfPossible(),this},t.prototype.remove=function(t,e){for(var n=this._head.next;n;)n=n.match(t,e)?n.destroy():n.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(t.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},t.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},t.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},t.prototype.update=function(t){var e;if(void 0===t&&(t=performance.now()),t>this.lastTime){if((e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*we.TARGET_FPMS;for(var r=this._head,i=r.next;i;)i=i.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(t.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),n=Math.min(Math.max(0,e)/1e3,we.TARGET_FPMS);this._maxElapsedMS=1/n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(0===t)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"shared",{get:function(){if(!t._shared){var e=t._shared=new t;e.autoStart=!0,e._protected=!0}return t._shared},enumerable:!1,configurable:!0}),Object.defineProperty(t,"system",{get:function(){if(!t._system){var e=t._system=new t;e.autoStart=!0,e._protected=!0}return t._system},enumerable:!1,configurable:!0}),t}(),pr=function(){function t(){}return t.init=function(t){var e=this;t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set:function(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,hr.LOW)},get:function(){return this._ticker}}),this.stop=function(){e._ticker.stop()},this.start=function(){e._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?dr.shared:new dr,t.autoStart&&this.start()},t.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},t}(),fr=function(){function t(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new En,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(t.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),t.prototype.getLocalPosition=function(t,e,n){return t.worldTransform.applyInverse(n||this.global,e)},t.prototype.copyEvent=function(t){"isPrimary"in t&&t.isPrimary&&(this.isPrimary=!0),this.button="button"in t&&t.button;var e="buttons"in t&&t.buttons;this.buttons=Number.isInteger(e)?e:"which"in t&&t.which,this.width="width"in t&&t.width,this.height="height"in t&&t.height,this.tiltX="tiltX"in t&&t.tiltX,this.tiltY="tiltY"in t&&t.tiltY,this.pointerType="pointerType"in t&&t.pointerType,this.pressure="pressure"in t&&t.pressure,this.rotationAngle="rotationAngle"in t&&t.rotationAngle,this.twist="twist"in t&&t.twist||0,this.tangentialPressure="tangentialPressure"in t&&t.tangentialPressure||0},t.prototype.reset=function(){this.isPrimary=!1},t}(),mr=function(t,e){return mr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},mr(t,e)};var gr=function(){function t(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return t.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},t.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},t}(),yr=function(){function t(e){this._pointerId=e,this._flags=t.FLAGS.NONE}return t.prototype._doSet=function(t,e){this._flags=e?this._flags|t:this._flags&~t},Object.defineProperty(t.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"flags",{get:function(){return this._flags},set:function(t){this._flags=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"none",{get:function(){return this._flags===t.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"over",{get:function(){return 0!=(this._flags&t.FLAGS.OVER)},set:function(e){this._doSet(t.FLAGS.OVER,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightDown",{get:function(){return 0!=(this._flags&t.FLAGS.RIGHT_DOWN)},set:function(e){this._doSet(t.FLAGS.RIGHT_DOWN,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftDown",{get:function(){return 0!=(this._flags&t.FLAGS.LEFT_DOWN)},set:function(e){this._doSet(t.FLAGS.LEFT_DOWN,e)},enumerable:!1,configurable:!0}),t.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),t}(),vr=function(){function t(){this._tempPoint=new En}return t.prototype.recursiveFindHit=function(t,e,n,r,i){if(!e||!e.visible)return!1;var s=t.data.global,a=!1,o=i=e.interactive||i,l=!0;if(e.hitArea?(r&&(e.worldTransform.applyInverse(s,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?a=!0:(r=!1,l=!1)),o=!1):e._mask&&r&&(e._mask.containsPoint&&e._mask.containsPoint(s)||(r=!1)),l&&e.interactiveChildren&&e.children)for(var h=e.children,u=h.length-1;u>=0;u--){var c=h[u],d=this.recursiveFindHit(t,c,n,r,o);if(d){if(!c.parent)continue;o=!1,d&&(t.target&&(r=!1),a=!0)}}return i&&(r&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(s)&&(a=!0),e.interactive&&(a&&!t.target&&(t.target=e),n&&n(t,e,!!a))),a},t.prototype.findHit=function(t,e,n,r){this.recursiveFindHit(t,e,n,r,!1)},t}(),xr={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};ir.mixin(xr);var br={target:null,data:{global:null}},wr=function(t){function e(e,n){var r=t.call(this)||this;return n=n||{},r.renderer=e,r.autoPreventDefault=void 0===n.autoPreventDefault||n.autoPreventDefault,r.interactionFrequency=n.interactionFrequency||10,r.mouse=new fr,r.mouse.identifier=1,r.mouse.global.set(-999999),r.activeInteractionData={},r.activeInteractionData[1]=r.mouse,r.interactionDataPool=[],r.eventData=new gr,r.interactionDOMElement=null,r.moveWhenInside=!1,r.eventsAdded=!1,r.tickerAdded=!1,r.mouseOverRenderer=!("PointerEvent"in self),r.supportsTouchEvents="ontouchstart"in self,r.supportsPointerEvents=!!self.PointerEvent,r.onPointerUp=r.onPointerUp.bind(r),r.processPointerUp=r.processPointerUp.bind(r),r.onPointerCancel=r.onPointerCancel.bind(r),r.processPointerCancel=r.processPointerCancel.bind(r),r.onPointerDown=r.onPointerDown.bind(r),r.processPointerDown=r.processPointerDown.bind(r),r.onPointerMove=r.onPointerMove.bind(r),r.processPointerMove=r.processPointerMove.bind(r),r.onPointerOut=r.onPointerOut.bind(r),r.processPointerOverOut=r.processPointerOverOut.bind(r),r.onPointerOver=r.onPointerOver.bind(r),r.cursorStyles={default:"inherit",pointer:"pointer"},r.currentCursorMode=null,r.cursor=null,r.resolution=1,r.delayedEvents=[],r.search=new vr,r._tempDisplayObject=new sr,r._eventListenerOptions={capture:!0,passive:!1},r._useSystemTicker=void 0===n.useSystemTicker||n.useSystemTicker,r.setTargetElement(r.renderer.view,r.renderer.resolution),r}return function(t,e){function n(){this.constructor=t}mr(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),Object.defineProperty(e.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(t){this._useSystemTicker=t,t?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),e.prototype.hitTest=function(t,e){return br.target=null,br.data.global=t,e||(e=this.lastObjectRendered),this.processInteractive(br,e,null,!0),br.target},e.prototype.setTargetElement=function(t,e){void 0===e&&(e=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=t,this.resolution=e,this.addEvents(),this.addTickerListener()},e.prototype.addTickerListener=function(){!this.tickerAdded&&this.interactionDOMElement&&this._useSystemTicker&&(dr.system.add(this.tickerUpdate,this,hr.INTERACTION),this.tickerAdded=!0)},e.prototype.removeTickerListener=function(){this.tickerAdded&&(dr.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},e.prototype.addEvents=function(){if(!this.eventsAdded&&this.interactionDOMElement){var t=this.interactionDOMElement.style;self.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none"),this.supportsPointerEvents?(self.document.addEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),self.addEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),self.addEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(self.document.addEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),self.addEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.eventsAdded=!0}},e.prototype.removeEvents=function(){if(this.eventsAdded&&this.interactionDOMElement){var t=this.interactionDOMElement.style;self.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(self.document.removeEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),self.removeEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),self.removeEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(self.document.removeEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),self.removeEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.interactionDOMElement=null,this.eventsAdded=!1}},e.prototype.tickerUpdate=function(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())},e.prototype.update=function(){if(this.interactionDOMElement)if(this._didMove)this._didMove=!1;else{for(var t in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var e=this.activeInteractionData[t];if(e.originalEvent&&"touch"!==e.pointerType){var n=this.configureInteractionEventForDOMEvent(this.eventData,e.originalEvent,e);this.processInteractive(n,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},e.prototype.setCursorMode=function(t){t=t||"default";var e=!0;if(self.OffscreenCanvas&&this.interactionDOMElement instanceof OffscreenCanvas&&(e=!1),this.currentCursorMode!==t){this.currentCursorMode=t;var n=this.cursorStyles[t];if(n)switch(typeof n){case"string":e&&(this.interactionDOMElement.style.cursor=n);break;case"function":n(t);break;case"object":e&&Object.assign(this.interactionDOMElement.style,n)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.interactionDOMElement.style.cursor=t)}},e.prototype.dispatchEvent=function(t,e,n){n.stopPropagationHint&&t!==n.stopsPropagatingAt||(n.currentTarget=t,n.type=e,t.emit(e,n),t[e]&&t[e](n))},e.prototype.delayDispatchEvent=function(t,e,n){this.delayedEvents.push({displayObject:t,eventString:e,eventData:n})},e.prototype.mapPositionToPoint=function(t,e,n){var r;r=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:this.interactionDOMElement.width,height:this.interactionDOMElement.height,left:0,top:0};var i=1/this.resolution;t.x=(e-r.left)*(this.interactionDOMElement.width/r.width)*i,t.y=(n-r.top)*(this.interactionDOMElement.height/r.height)*i},e.prototype.processInteractive=function(t,e,n,r){var i=this.search.findHit(t,e,n,r),s=this.delayedEvents;if(!s.length)return i;t.stopPropagationHint=!1;var a=s.length;this.delayedEvents=[];for(var o=0;o<a;o++){var l=s[o],h=l.displayObject,u=l.eventString,c=l.eventData;c.stopsPropagatingAt===h&&(c.stopPropagationHint=!0),this.dispatchEvent(h,u,c)}return i},e.prototype.onPointerDown=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);if(this.autoPreventDefault&&e[0].isNormalized)(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(var n=e.length,r=0;r<n;r++){var i=e[r],s=this.getInteractionDataForPointerId(i),a=this.configureInteractionEventForDOMEvent(this.eventData,i,s);if(a.data.originalEvent=t,this.processInteractive(a,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",a),"touch"===i.pointerType)this.emit("touchstart",a);else if("mouse"===i.pointerType||"pen"===i.pointerType){var o=2===i.button;this.emit(o?"rightdown":"mousedown",this.eventData)}}}},e.prototype.processPointerDown=function(t,e,n){var r=t.data,i=t.data.identifier;if(n)if(e.trackedPointers[i]||(e.trackedPointers[i]=new yr(i)),this.dispatchEvent(e,"pointerdown",t),"touch"===r.pointerType)this.dispatchEvent(e,"touchstart",t);else if("mouse"===r.pointerType||"pen"===r.pointerType){var s=2===r.button;s?e.trackedPointers[i].rightDown=!0:e.trackedPointers[i].leftDown=!0,this.dispatchEvent(e,s?"rightdown":"mousedown",t)}},e.prototype.onPointerComplete=function(t,e,n){for(var r=this.normalizeToPointerData(t),i=r.length,s=t.target!==this.interactionDOMElement?"outside":"",a=0;a<i;a++){var o=r[a],l=this.getInteractionDataForPointerId(o),h=this.configureInteractionEventForDOMEvent(this.eventData,o,l);if(h.data.originalEvent=t,this.processInteractive(h,this.lastObjectRendered,n,e||!s),this.emit(e?"pointercancel":"pointerup"+s,h),"mouse"===o.pointerType||"pen"===o.pointerType){var u=2===o.button;this.emit(u?"rightup"+s:"mouseup"+s,h)}else"touch"===o.pointerType&&(this.emit(e?"touchcancel":"touchend"+s,h),this.releaseInteractionDataForPointerId(o.pointerId))}},e.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},e.prototype.processPointerCancel=function(t,e){var n=t.data,r=t.data.identifier;void 0!==e.trackedPointers[r]&&(delete e.trackedPointers[r],this.dispatchEvent(e,"pointercancel",t),"touch"===n.pointerType&&this.dispatchEvent(e,"touchcancel",t))},e.prototype.onPointerUp=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},e.prototype.processPointerUp=function(t,e,n){var r=t.data,i=t.data.identifier,s=e.trackedPointers[i],a="touch"===r.pointerType,o="mouse"===r.pointerType||"pen"===r.pointerType,l=!1;if(o){var h=2===r.button,u=yr.FLAGS,c=h?u.RIGHT_DOWN:u.LEFT_DOWN,d=void 0!==s&&s.flags&c;n?(this.dispatchEvent(e,h?"rightup":"mouseup",t),d&&(this.dispatchEvent(e,h?"rightclick":"click",t),l=!0)):d&&this.dispatchEvent(e,h?"rightupoutside":"mouseupoutside",t),s&&(h?s.rightDown=!1:s.leftDown=!1)}n?(this.dispatchEvent(e,"pointerup",t),a&&this.dispatchEvent(e,"touchend",t),s&&(o&&!l||this.dispatchEvent(e,"pointertap",t),a&&(this.dispatchEvent(e,"tap",t),s.over=!1))):s&&(this.dispatchEvent(e,"pointerupoutside",t),a&&this.dispatchEvent(e,"touchendoutside",t)),s&&s.none&&delete e.trackedPointers[i]},e.prototype.onPointerMove=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"!==e[0].pointerType&&"pen"!==e[0].pointerType||(this._didMove=!0,this.cursor=null);for(var n=e.length,r=0;r<n;r++){var i=e[r],s=this.getInteractionDataForPointerId(i),a=this.configureInteractionEventForDOMEvent(this.eventData,i,s);a.data.originalEvent=t,this.processInteractive(a,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",a),"touch"===i.pointerType&&this.emit("touchmove",a),"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.emit("mousemove",a)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}},e.prototype.processPointerMove=function(t,e,n){var r=t.data,i="touch"===r.pointerType,s="mouse"===r.pointerType||"pen"===r.pointerType;s&&this.processPointerOverOut(t,e,n),this.moveWhenInside&&!n||(this.dispatchEvent(e,"pointermove",t),i&&this.dispatchEvent(e,"touchmove",t),s&&this.dispatchEvent(e,"mousemove",t))},e.prototype.onPointerOut=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var n=this.getInteractionDataForPointerId(e),r=this.configureInteractionEventForDOMEvent(this.eventData,e,n);r.data.originalEvent=e,this.processInteractive(r,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",r),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",r):this.releaseInteractionDataForPointerId(n.identifier)}},e.prototype.processPointerOverOut=function(t,e,n){var r=t.data,i=t.data.identifier,s="mouse"===r.pointerType||"pen"===r.pointerType,a=e.trackedPointers[i];n&&!a&&(a=e.trackedPointers[i]=new yr(i)),void 0!==a&&(n&&this.mouseOverRenderer?(a.over||(a.over=!0,this.delayDispatchEvent(e,"pointerover",t),s&&this.delayDispatchEvent(e,"mouseover",t)),s&&null===this.cursor&&(this.cursor=e.cursor)):a.over&&(a.over=!1,this.dispatchEvent(e,"pointerout",this.eventData),s&&this.dispatchEvent(e,"mouseout",t),a.none&&delete e.trackedPointers[i]))},e.prototype.onPointerOver=function(t){var e=this.normalizeToPointerData(t)[0],n=this.getInteractionDataForPointerId(e),r=this.configureInteractionEventForDOMEvent(this.eventData,e,n);r.data.originalEvent=e,"mouse"===e.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",r),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",r)},e.prototype.getInteractionDataForPointerId=function(t){var e,n=t.pointerId;return 1===n||"mouse"===t.pointerType?e=this.mouse:this.activeInteractionData[n]?e=this.activeInteractionData[n]:((e=this.interactionDataPool.pop()||new fr).identifier=n,this.activeInteractionData[n]=e),e.copyEvent(t),e},e.prototype.releaseInteractionDataForPointerId=function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e.reset(),this.interactionDataPool.push(e))},e.prototype.configureInteractionEventForDOMEvent=function(t,e,n){return t.data=n,this.mapPositionToPoint(n.global,e.clientX,e.clientY),"touch"===e.pointerType&&(e.globalX=n.global.x,e.globalY=n.global.y),n.originalEvent=e,t.reset(),t},e.prototype.normalizeToPointerData=function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var n=0,r=t.changedTouches.length;n<r;n++){var i=t.changedTouches[n];void 0===i.button&&(i.button=t.touches.length?1:0),void 0===i.buttons&&(i.buttons=t.touches.length?1:0),void 0===i.isPrimary&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===i.width&&(i.width=i.radiusX||1),void 0===i.height&&(i.height=i.radiusY||1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="touch"),void 0===i.pointerId&&(i.pointerId=i.identifier||0),void 0===i.pressure&&(i.pressure=i.force||.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),void 0===i.layerX&&(i.layerX=i.offsetX=i.clientX),void 0===i.layerY&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,e.push(i)}else if(self.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof self.PointerEvent))e.push(t);else{var s=t;void 0===s.isPrimary&&(s.isPrimary=!0),void 0===s.width&&(s.width=1),void 0===s.height&&(s.height=1),void 0===s.tiltX&&(s.tiltX=0),void 0===s.tiltY&&(s.tiltY=0),void 0===s.pointerType&&(s.pointerType="mouse"),void 0===s.pointerId&&(s.pointerId=1),void 0===s.pressure&&(s.pressure=.5),void 0===s.twist&&(s.twist=0),void 0===s.tangentialPressure&&(s.tangentialPressure=0),s.isNormalized=!0,e.push(s)}return e},e.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},e}(Te()),_r=function(){function t(t){this.items=[],this._name=t,this._aliasCount=0}return t.prototype.emit=function(t,e,n,r,i,s,a,o){if(arguments.length>8)throw new Error("max arguments reached");var l=this,h=l.name,u=l.items;this._aliasCount++;for(var c=0,d=u.length;c<d;c++)u[c][h](t,e,n,r,i,s,a,o);return u===this.items&&this._aliasCount--,this},t.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},t.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},t.prototype.remove=function(t){var e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},t.prototype.contains=function(t){return-1!==this.items.indexOf(t)},t.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},t.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),t}();Object.defineProperties(_r.prototype,{dispatch:{value:_r.prototype.emit},run:{value:_r.prototype.emit}}),we.PREFER_ENV=ee.any?ne.WEBGL:ne.WEBGL2,we.STRICT_TEXTURE_CACHE=!1;var Tr=[];function Er(t,e){if(!t)return null;var n="";if("string"==typeof t){var r=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);r&&(n=r[1].toLowerCase())}for(var i=Tr.length-1;i>=0;--i){var s=Tr[i];if(s.test&&s.test(t,n))return new s(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}var Sr=function(t,e){return Sr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},Sr(t,e)};function Ir(t,e){function n(){this.constructor=t}Sr(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var kr=function(){return kr=Object.assign||function(t){for(var e,n=arguments,r=1,i=arguments.length;r<i;r++)for(var s in e=n[r])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},kr.apply(this,arguments)};var Cr=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new _r("setRealSize"),this.onUpdate=new _r("update"),this.onError=new _r("onError")}return t.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},t.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},t.prototype.resize=function(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))},Object.defineProperty(t.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.destroyed||this.onUpdate.emit()},t.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),t.prototype.style=function(t,e,n){return!1},t.prototype.dispose=function(){},t.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},t.test=function(t,e){return!1},t}(),Nr=function(t){function e(e,n){var r=this,i=n||{},s=i.width,a=i.height;if(!s||!a)throw new Error("BufferResource width or height invalid");return(r=t.call(this,s,a)||this).data=e,r}return Ir(e,t),e.prototype.upload=function(t,e,n){var r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===fe.UNPACK);var i=e.realWidth,s=e.realHeight;return n.width===i&&n.height===s?r.texSubImage2D(e.target,0,0,0,i,s,e.format,n.type,this.data):(n.width=i,n.height=s,r.texImage2D(e.target,0,n.internalFormat,i,s,0,e.format,n.type,this.data)),!0},e.prototype.dispose=function(){this.data=null},e.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},e}(Cr),Ar={scaleMode:ce.NEAREST,format:oe.RGBA,alphaMode:fe.NPM},Rr=function(t){function e(e,n){void 0===e&&(e=null),void 0===n&&(n=null);var r=t.call(this)||this,i=(n=n||{}).alphaMode,s=n.mipmap,a=n.anisotropicLevel,o=n.scaleMode,l=n.width,h=n.height,u=n.wrapMode,c=n.format,d=n.type,p=n.target,f=n.resolution,m=n.resourceOptions;return!e||e instanceof Cr||((e=Er(e,m)).internal=!0),r.resolution=f||we.RESOLUTION,r.width=Math.round((l||0)*r.resolution)/r.resolution,r.height=Math.round((h||0)*r.resolution)/r.resolution,r._mipmap=void 0!==s?s:we.MIPMAP_TEXTURES,r.anisotropicLevel=void 0!==a?a:we.ANISOTROPIC_LEVEL,r._wrapMode=u||we.WRAP_MODE,r._scaleMode=void 0!==o?o:we.SCALE_MODE,r.format=c||oe.RGBA,r.type=d||he.UNSIGNED_BYTE,r.target=p||le.TEXTURE_2D,r.alphaMode=void 0!==i?i:fe.UNPACK,r.uid=Qe(),r.touched=0,r.isPowerOfTwo=!1,r._refreshPOT(),r._glTextures={},r.dirtyId=0,r.dirtyStyleId=0,r.cacheId=null,r.valid=l>0&&h>0,r.textureCacheIds=[],r.destroyed=!1,r.resource=null,r._batchEnabled=0,r._batchLocation=0,r.parentTextureArray=null,r.setResource(e),r}return Ir(e,t),Object.defineProperty(e.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mipmap",{get:function(){return this._mipmap},set:function(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),e.prototype.setStyle=function(t,e){var n;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,n=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,n=!0),n&&this.dirtyStyleId++,this},e.prototype.setSize=function(t,e,n){return n=n||this.resolution,this.setRealSize(t*n,e*n,n)},e.prototype.setRealSize=function(t,e,n){return this.resolution=n||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this},e.prototype._refreshPOT=function(){this.isPowerOfTwo=je(this.realWidth)&&je(this.realHeight)},e.prototype.setResolution=function(t){var e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this},e.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},e.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},e.prototype.onError=function(t){this.emit("error",this,t)},e.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete sn[this.cacheId],delete rn[this.cacheId],this.cacheId=null),this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.prototype.castToBaseTexture=function(){return this},e.from=function(t,n,r){void 0===r&&(r=we.STRICT_TEXTURE_CACHE);var i="string"==typeof t,s=null;if(i)s=t;else{if(!t._pixiId){var a=n&&n.pixiIdPrefix||"pixiid";t._pixiId=a+"_"+Qe()}s=t._pixiId}var o=sn[s];if(i&&r&&!o)throw new Error('The cacheId "'+s+'" does not exist in BaseTextureCache.');return o||((o=new e(t,n)).cacheId=s,e.addToCache(o,s)),o},e.fromBuffer=function(t,n,r,i){t=t||new Float32Array(n*r*4);var s=new Nr(t,{width:n,height:r}),a=t instanceof Float32Array?he.FLOAT:he.UNSIGNED_BYTE;return new e(s,Object.assign(Ar,i||{width:n,height:r,type:a}))},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),sn[e],sn[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=sn[t];if(e){var n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete sn[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)delete sn[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},e._globalBatch=0,e}(Te()),Mr=function(t){function e(e,n){var r=this,i=n||{},s=i.width,a=i.height;(r=t.call(this,s,a)||this).items=[],r.itemDirtyIds=[];for(var o=0;o<e;o++){var l=new Rr;r.items.push(l),r.itemDirtyIds.push(-2)}return r.length=e,r._load=null,r.baseTexture=null,r}return Ir(e,t),e.prototype.initFromArray=function(t,e){for(var n=0;n<this.length;n++)t[n]&&(t[n].castToBaseTexture?this.addBaseTextureAt(t[n].castToBaseTexture(),n):t[n]instanceof Cr?this.addResourceAt(t[n],n):this.addResourceAt(Er(t[n],e),n))},e.prototype.dispose=function(){for(var t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(t,e){if(!this.items[e])throw new Error("Index "+e+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this},e.prototype.bind=function(e){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");t.prototype.bind.call(this,e);for(var n=0;n<this.length;n++)this.items[n].parentTextureArray=e,this.items[n].on("update",e.update,e)},e.prototype.unbind=function(e){t.prototype.unbind.call(this,e);for(var n=0;n<this.length;n++)this.items[n].parentTextureArray=null,this.items[n].off("update",e.update,e)},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.items.map((function(t){return t.resource})).filter((function(t){return t})).map((function(t){return t.load()}));return this._load=Promise.all(e).then((function(){var e=t.items[0],n=e.realWidth,r=e.realHeight;return t.resize(n,r),Promise.resolve(t)})),this._load},e}(Cr),Or=function(t){function e(e,n){var r,i,s=this,a=n||{},o=a.width,l=a.height;return Array.isArray(e)?(r=e,i=e.length):i=e,s=t.call(this,i,{width:o,height:l})||this,r&&s.initFromArray(r,n),s}return Ir(e,t),e.prototype.addBaseTextureAt=function(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this},e.prototype.bind=function(e){t.prototype.bind.call(this,e),e.target=le.TEXTURE_2D_ARRAY},e.prototype.upload=function(t,e,n){var r=this,i=r.length,s=r.itemDirtyIds,a=r.items,o=t.gl;n.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,i,0,e.format,n.type,null);for(var l=0;l<i;l++){var h=a[l];s[l]<h.dirtyId&&(s[l]=h.dirtyId,h.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,l,h.resource.width,h.resource.height,1,e.format,n.type,h.resource.source))}return!0},e}(Mr),Pr=function(t){function e(e){var n=this,r=e,i=r.naturalWidth||r.videoWidth||r.width,s=r.naturalHeight||r.videoHeight||r.height;return(n=t.call(this,i,s)||this).source=e,n.noSubImage=!1,n}return Ir(e,t),e.crossOrigin=function(t,e,n){void 0===n&&0!==e.indexOf("data:")?t.crossOrigin=pn(e):!1!==n&&(t.crossOrigin="string"==typeof n?n:"anonymous")},e.prototype.upload=function(t,e,n,r){var i=t.gl,s=e.realWidth,a=e.realHeight;return r=r||this.source,i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===fe.UNPACK),this.noSubImage||e.target!==i.TEXTURE_2D||n.width!==s||n.height!==a?(n.width=s,n.height=a,i.texImage2D(e.target,0,n.internalFormat,e.format,n.type,r)):i.texSubImage2D(i.TEXTURE_2D,0,0,0,e.format,n.type,r),!0},e.prototype.update=function(){if(!this.destroyed){var e=this.source,n=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;this.resize(n,r),t.prototype.update.call(this)}},e.prototype.dispose=function(){this.source=null},e}(Cr),Dr=function(t){function e(e){return t.call(this,e)||this}return Ir(e,t),e.test=function(t){var e=self.OffscreenCanvas;return!!(e&&t instanceof e)||self.HTMLCanvasElement&&t instanceof HTMLCanvasElement},e}(Pr),Fr=function(t){function e(n,r){var i=this,s=r||{},a=s.width,o=s.height,l=s.autoLoad,h=s.linkBaseTexture;if(n&&n.length!==e.SIDES)throw new Error("Invalid length. Got "+n.length+", expected 6");i=t.call(this,6,{width:a,height:o})||this;for(var u=0;u<e.SIDES;u++)i.items[u].target=le.TEXTURE_CUBE_MAP_POSITIVE_X+u;return i.linkBaseTexture=!1!==h,n&&i.initFromArray(n,r),!1!==l&&i.load(),i}return Ir(e,t),e.prototype.bind=function(e){t.prototype.bind.call(this,e),e.target=le.TEXTURE_CUBE_MAP},e.prototype.addBaseTextureAt=function(t,e,n){if(void 0===n&&(n=this.linkBaseTexture),!this.items[e])throw new Error("Index "+e+" is out of bounds");if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=le.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this},e.prototype.upload=function(t,n,r){for(var i=this.itemDirtyIds,s=0;s<e.SIDES;s++){var a=this.items[s];i[s]<a.dirtyId&&(a.valid&&a.resource?(a.resource.upload(t,a,r),i[s]=a.dirtyId):i[s]<-1&&(t.gl.texImage2D(a.target,0,r.internalFormat,n.realWidth,n.realHeight,0,n.format,r.type,null),i[s]=-1))}return!0},e.test=function(t){return Array.isArray(t)&&t.length===e.SIDES},e.SIDES=6,e}(Mr),Lr=function(t){function e(e,n){var r=this;if(n=n||{},!(e instanceof HTMLImageElement)){var i=new Image;Pr.crossOrigin(i,e,n.crossorigin),i.src=e,e=i}return r=t.call(this,e)||this,!e.complete&&r._width&&r._height&&(r._width=0,r._height=0),r.url=e.src,r._process=null,r.preserveBitmap=!1,r.createBitmap=(void 0!==n.createBitmap?n.createBitmap:we.CREATE_IMAGE_BITMAP)&&!!self.createImageBitmap,r.alphaMode="number"==typeof n.alphaMode?n.alphaMode:null,r.bitmap=null,r._load=null,!1!==n.autoLoad&&r.load(),r}return Ir(e,t),e.prototype.load=function(t){var e=this;return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise((function(t,n){var r=e.source;e.url=r.src;var i=function(){e.destroyed||(r.onload=null,r.onerror=null,e.resize(r.width,r.height),e._load=null,e.createBitmap?t(e.process()):t(e))};r.complete&&r.src?i():(r.onload=i,r.onerror=function(t){n(t),e.onError.emit(t)})}))),this._load},e.prototype.process=function(){var t=this,e=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!self.createImageBitmap)return Promise.resolve(this);var n=self.createImageBitmap,r=!e.crossOrigin||"anonymous"===e.crossOrigin;return this._process=fetch(e.src,{mode:r?"cors":"no-cors"}).then((function(t){return t.blob()})).then((function(r){return n(r,0,0,e.width,e.height,{premultiplyAlpha:t.alphaMode===fe.UNPACK?"premultiply":"none"})})).then((function(e){return t.destroyed?Promise.reject():(t.bitmap=e,t.update(),t._process=null,Promise.resolve(t))})),this._process},e.prototype.upload=function(e,n,r){if("number"==typeof this.alphaMode&&(n.alphaMode=this.alphaMode),!this.createBitmap)return t.prototype.upload.call(this,e,n,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(t.prototype.upload.call(this,e,n,r,this.bitmap),!this.preserveBitmap){var i=!0,s=n._glTextures;for(var a in s){var o=s[a];if(o!==r&&o.dirtyId!==n.dirtyId){i=!1;break}}i&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},e.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,t.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},e.test=function(t){return"string"==typeof t||t instanceof HTMLImageElement},e}(Pr),Br=function(t){function e(e,n){var r=this;return n=n||{},(r=t.call(this,document.createElement("canvas"))||this)._width=0,r._height=0,r.svg=e,r.scale=n.scale||1,r._overrideWidth=n.width,r._overrideHeight=n.height,r._resolve=null,r._crossorigin=n.crossorigin,r._load=null,!1!==n.autoLoad&&r.load(),r}return Ir(e,t),e.prototype.load=function(){var t=this;return this._load||(this._load=new Promise((function(n){if(t._resolve=function(){t.resize(t.source.width,t.source.height),n(t)},e.SVG_XML.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()}))),this._load},e.prototype._loadSvg=function(){var t=this,e=new Image;Pr.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=function(n){t._resolve&&(e.onerror=null,t.onError.emit(n))},e.onload=function(){if(t._resolve){var n=e.width,r=e.height;if(!n||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var i=n*t.scale,s=r*t.scale;(t._overrideWidth||t._overrideHeight)&&(i=t._overrideWidth||t._overrideHeight/r*n,s=t._overrideHeight||t._overrideWidth/n*r),i=Math.round(i),s=Math.round(s);var a=t.source;a.width=i,a.height=s,a._pixiId="canvas_"+Qe(),a.getContext("2d").drawImage(e,0,0,n,r,0,0,i,s),t._resolve(),t._resolve=null}}},e.getSize=function(t){var n=e.SVG_SIZE.exec(t),r={};return n&&(r[n[1]]=Math.round(parseFloat(n[3])),r[n[5]]=Math.round(parseFloat(n[7]))),r},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(t,n){return"svg"===n||"string"==typeof t&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(t)||"string"==typeof t&&e.SVG_XML.test(t)},e.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e}(Pr),$r=function(t){function e(n,r){var i=this;if(r=r||{},!(n instanceof HTMLVideoElement)){var s=document.createElement("video");s.setAttribute("preload","auto"),s.setAttribute("webkit-playsinline",""),s.setAttribute("playsinline",""),"string"==typeof n&&(n=[n]);var a=n[0].src||n[0];Pr.crossOrigin(s,a,r.crossorigin);for(var o=0;o<n.length;++o){var l=document.createElement("source"),h=n[o],u=h.src,c=h.mime,d=(u=u||n[o]).split("?").shift().toLowerCase(),p=d.substr(d.lastIndexOf(".")+1);c=c||e.MIME_TYPES[p]||"video/"+p,l.src=u,l.type=c,s.appendChild(l)}n=s}return(i=t.call(this,n)||this).noSubImage=!0,i._autoUpdate=!0,i._isConnectedToTicker=!1,i._updateFPS=r.updateFPS||0,i._msToNextUpdate=0,i.autoPlay=!1!==r.autoPlay,i._load=null,i._resolve=null,i._onCanPlay=i._onCanPlay.bind(i),i._onError=i._onError.bind(i),!1!==r.autoLoad&&i.load(),i}return Ir(e,t),e.prototype.update=function(e){if(!this.destroyed){var n=dr.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-n),(!this._updateFPS||this._msToNextUpdate<=0)&&(t.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((function(n){t.valid?n(t):(t._resolve=n,e.load())})),this._load},e.prototype._onError=function(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)},e.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},e.prototype._isSourceReady=function(){var t=this.source;return 3===t.readyState||4===t.readyState},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(dr.shared.add(this.update,this),this._isConnectedToTicker=!0)},e.prototype._onPlayStop=function(){this._isConnectedToTicker&&(dr.shared.remove(this.update,this),this._isConnectedToTicker=!1)},e.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},e.prototype.dispose=function(){this._isConnectedToTicker&&(dr.shared.remove(this.update,this),this._isConnectedToTicker=!1);var e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),t.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(dr.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(dr.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(t){t!==this._updateFPS&&(this._updateFPS=t)},enumerable:!1,configurable:!0}),e.test=function(t,n){return self.HTMLVideoElement&&t instanceof HTMLVideoElement||e.TYPES.indexOf(n)>-1},e.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],e.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},e}(Pr),Ur=function(t){function e(e){return t.call(this,e)||this}return Ir(e,t),e.test=function(t){return!!self.createImageBitmap&&t instanceof ImageBitmap},e}(Pr);Tr.push(Lr,Ur,Dr,$r,Br,Nr,Fr,Or);var Vr={__proto__:null,Resource:Cr,BaseImageResource:Pr,INSTALLED:Tr,autoDetectResource:Er,AbstractMultiResource:Mr,ArrayResource:Or,BufferResource:Nr,CanvasResource:Dr,CubeResource:Fr,ImageResource:Lr,SVGResource:Br,VideoResource:$r,ImageBitmapResource:Ur},zr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ir(e,t),e.prototype.upload=function(t,e,n){var r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===fe.UNPACK);var i=e.realWidth,s=e.realHeight;return n.width===i&&n.height===s?r.texSubImage2D(e.target,0,0,0,i,s,e.format,n.type,this.data):(n.width=i,n.height=s,r.texImage2D(e.target,0,n.internalFormat,i,s,0,e.format,n.type,this.data)),!0},e}(Nr),Gr=function(){function t(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new _r("disposeFramebuffer"),this.multisample=xe.NONE}return Object.defineProperty(t.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),t.prototype.addColorTexture=function(t,e){return void 0===t&&(t=0),this.colorTextures[t]=e||new Rr(null,{scaleMode:ce.NEAREST,resolution:1,mipmap:pe.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},t.prototype.addDepthTexture=function(t){return this.depthTexture=t||new Rr(new zr(null,{width:this.width,height:this.height}),{scaleMode:ce.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:pe.OFF,format:oe.DEPTH_COMPONENT,type:he.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},t.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},t.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},t.prototype.resize=function(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var n=0;n<this.colorTextures.length;n++){var r=this.colorTextures[n],i=r.resolution;r.setSize(t/i,e/i)}if(this.depthTexture){i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},t}(),Wr=function(t){function e(e){var n=this;if("number"==typeof e){var r=arguments[0],i=arguments[1],s=arguments[2],a=arguments[3];e={width:r,height:i,scaleMode:s,resolution:a}}return e.width=e.width||100,e.height=e.height||100,e.multisample=void 0!==e.multisample?e.multisample:xe.NONE,(n=t.call(this,null,e)||this).mipmap=pe.OFF,n.valid=!0,n.clearColor=[0,0,0,0],n.framebuffer=new Gr(n.realWidth,n.realHeight).addColorTexture(0,n),n.framebuffer.multisample=e.multisample,n.maskStack=[],n.filterStack=[{}],n}return Ir(e,t),e.prototype.resize=function(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},e.prototype.dispose=function(){this.framebuffer.dispose(),t.prototype.dispose.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},e}(Rr),Xr=function(){function t(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return t.prototype.set=function(t,e,n){var r=e.width,i=e.height;if(n){var s=t.width/2/r,a=t.height/2/i,o=t.x/r+s,l=t.y/i+a;n=Pn.add(n,Pn.NW),this.x0=o+s*Pn.uX(n),this.y0=l+a*Pn.uY(n),n=Pn.add(n,2),this.x1=o+s*Pn.uX(n),this.y1=l+a*Pn.uY(n),n=Pn.add(n,2),this.x2=o+s*Pn.uX(n),this.y2=l+a*Pn.uY(n),n=Pn.add(n,2),this.x3=o+s*Pn.uX(n),this.y3=l+a*Pn.uY(n)}else this.x0=t.x/r,this.y0=t.y/i,this.x1=(t.x+t.width)/r,this.y1=t.y/i,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/i,this.x3=t.x/r,this.y3=(t.y+t.height)/i;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},t.prototype.toString=function(){return"[@pixi/core:TextureUvs x0="+this.x0+" y0="+this.y0+" x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" y2="+this.y2+" x3="+this.x3+" y3="+this.y3+"]"},t}(),Hr=new Xr,Yr=function(t){function e(n,r,i,s,a,o){var l=t.call(this)||this;if(l.noFrame=!1,r||(l.noFrame=!0,r=new xn(0,0,1,1)),n instanceof e&&(n=n.baseTexture),l.baseTexture=n,l._frame=r,l.trim=s,l.valid=!1,l._uvs=Hr,l.uvMatrix=null,l.orig=i||r,l._rotate=Number(a||0),!0===a)l._rotate=2;else if(l._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return l.defaultAnchor=o?new En(o.x,o.y):new En(0,0),l._updateID=0,l.textureCacheIds=[],n.valid?l.noFrame?n.valid&&l.onBaseTextureUpdated(n):l.frame=r:n.once("loaded",l.onBaseTextureUpdated,l),l.noFrame&&n.on("update",l.onBaseTextureUpdated,l),l}return Ir(e,t),e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(t){if(this.baseTexture){if(t){var n=this.baseTexture.resource;n&&n.url&&rn[n.url]&&e.removeFromCache(n.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){var t=this._frame.clone(),n=this._frame===this.orig?t:this.orig.clone(),r=new e(this.baseTexture,!this.noFrame&&t,n,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(r._frame=t),r},e.prototype.updateUvs=function(){this._uvs===Hr&&(this._uvs=new Xr),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(t,n,r){void 0===n&&(n={}),void 0===r&&(r=we.STRICT_TEXTURE_CACHE);var i="string"==typeof t,s=null;if(i)s=t;else if(t instanceof Rr){if(!t.cacheId){var a=n&&n.pixiIdPrefix||"pixiid";t.cacheId=a+"-"+Qe(),Rr.addToCache(t,t.cacheId)}s=t.cacheId}else{if(!t._pixiId){a=n&&n.pixiIdPrefix||"pixiid";t._pixiId=a+"_"+Qe()}s=t._pixiId}var o=rn[s];if(i&&r&&!o)throw new Error('The cacheId "'+s+'" does not exist in TextureCache.');return o||t instanceof Rr?!o&&t instanceof Rr&&(o=new e(t),e.addToCache(o,s)):(n.resolution||(n.resolution=fn(t)),(o=new e(new Rr(t,n))).baseTexture.cacheId=s,Rr.addToCache(o.baseTexture,s),e.addToCache(o,s)),o},e.fromURL=function(t,n){var r=Object.assign({autoLoad:!1},null==n?void 0:n.resourceOptions),i=e.from(t,Object.assign({resourceOptions:r},n),!1),s=i.baseTexture.resource;return i.baseTexture.valid?Promise.resolve(i):s.load().then((function(){return Promise.resolve(i)}))},e.fromBuffer=function(t,n,r,i){return new e(Rr.fromBuffer(t,n,r,i))},e.fromLoader=function(t,n,r,i){var s=new Rr(t,Object.assign({scaleMode:we.SCALE_MODE,resolution:fn(n)},i)),a=s.resource;a instanceof Lr&&(a.url=n);var o=new e(s);return r||(r=n),Rr.addToCache(o.baseTexture,r),e.addToCache(o,r),r!==n&&(Rr.addToCache(o.baseTexture,n),e.addToCache(o,n)),o.baseTexture.valid?Promise.resolve(o):new Promise((function(t){o.baseTexture.once("loaded",(function(){return t(o)}))}))},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),rn[e],rn[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=rn[t];if(e){var n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete rn[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)rn[t.textureCacheIds[r]]===t&&delete rn[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},Object.defineProperty(e.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var e=t.x,n=t.y,r=t.width,i=t.height,s=e+r>this.baseTexture.width,a=n+i>this.baseTexture.height;if(s||a){var o=s&&a?"and":"or",l="X: "+e+" + "+r+" = "+(e+r)+" > "+this.baseTexture.width,h="Y: "+n+" + "+i+" = "+(n+i)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+l+" "+o+" "+h)}this.valid=r&&i&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotate",{get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),e.prototype.castToBaseTexture=function(){return this.baseTexture},e}(Te());function jr(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}Yr.EMPTY=new Yr(new Rr),jr(Yr.EMPTY),jr(Yr.EMPTY.baseTexture),Yr.WHITE=function(){var t=document.createElement("canvas");t.width=16,t.height=16;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,16,16),new Yr(new Rr(new Dr(t)))}(),jr(Yr.WHITE),jr(Yr.WHITE.baseTexture);var qr=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.valid=!0,r.filterFrame=null,r.filterPoolKey=null,r.updateUvs(),r}return Ir(e,t),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(t){this.framebuffer.multisample=t},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,e,n){void 0===n&&(n=!0);var r=this.baseTexture.resolution,i=Math.round(t*r)/r,s=Math.round(e*r)/r;this.valid=i>0&&s>0,this._frame.width=this.orig.width=i,this._frame.height=this.orig.height=s,n&&this.baseTexture.resize(i,s),this.updateUvs()},e.prototype.setResolution=function(t){var e=this.baseTexture;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))},e.create=function(t){for(var n=arguments,r=[],i=1;i<arguments.length;i++)r[i-1]=n[i];return"number"==typeof t&&(en(0,"Arguments (width, height, scaleMode, resolution) have been deprecated."),t={width:t,height:r[0],scaleMode:r[1],resolution:r[2]}),new e(new Wr(t))},e}(Yr),Kr=function(){function t(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return t.prototype.createTexture=function(t,e,n){void 0===n&&(n=xe.NONE);var r=new Wr(Object.assign({width:t,height:e,resolution:1,multisample:n},this.textureOptions));return new qr(r)},t.prototype.getOptimalTexture=function(t,e,n,r){var i;void 0===n&&(n=1),void 0===r&&(r=xe.NONE),t=Math.ceil(t*n),e=Math.ceil(e*n),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?i=r>1?-r:-1:(i=((65535&(t=Ye(t)))<<16|65535&(e=Ye(e)))>>>0,r>1&&(i+=4294967296*r)),this.texturePool[i]||(this.texturePool[i]=[]);var s=this.texturePool[i].pop();return s||(s=this.createTexture(t,e,r)),s.filterPoolKey=i,s.setResolution(n),s},t.prototype.getFilterTexture=function(t,e,n){var r=this.getOptimalTexture(t.width,t.height,e||t.resolution,n||xe.NONE);return r.filterFrame=t.filterFrame,r},t.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},t.prototype.returnFilterTexture=function(t){this.returnTexture(t)},t.prototype.clear=function(t){if(t=!1!==t)for(var e in this.texturePool){var n=this.texturePool[e];if(n)for(var r=0;r<n.length;r++)n[r].destroy(!0)}this.texturePool={}},t.prototype.setScreenSize=function(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){for(var e in this.enableFullScreen=t.width>0&&t.height>0,this.texturePool)if(Number(e)<0){var n=this.texturePool[e];if(n)for(var r=0;r<n.length;r++)n[r].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}},t.SCREEN_KEY=-1,t}(),Zr=function(){function t(t,e,n,r,i,s,a){void 0===e&&(e=0),void 0===n&&(n=!1),void 0===r&&(r=he.FLOAT),this.buffer=t,this.size=e,this.normalized=n,this.type=r,this.stride=i,this.start=s,this.instance=a}return t.prototype.destroy=function(){this.buffer=null},t.from=function(e,n,r,i,s){return new t(e,n,r,i,s)},t}(),Jr=0,Qr=function(){function t(t,e,n){void 0===e&&(e=!0),void 0===n&&(n=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=n,this.static=e,this.id=Jr++,this.disposeRunner=new _r("disposeBuffer")}return t.prototype.update=function(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(t.prototype,"index",{get:function(){return this.type===be.ELEMENT_ARRAY_BUFFER},set:function(t){this.type=t?be.ELEMENT_ARRAY_BUFFER:be.ARRAY_BUFFER},enumerable:!1,configurable:!0}),t.from=function(e){return e instanceof Array&&(e=new Float32Array(e)),new t(e)},t}(),ti={Float32Array,Uint32Array,Int32Array,Uint8Array};var ei={5126:4,5123:2,5121:1},ni=0,ri={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},ii=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=ni++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new _r("disposeGeometry"),this.refCount=0}return t.prototype.addAttribute=function(t,e,n,r,i,s,a,o){if(void 0===n&&(n=0),void 0===r&&(r=!1),void 0===o&&(o=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Qr||(e instanceof Array&&(e=new Float32Array(e)),e=new Qr(e));var l=t.split("|");if(l.length>1){for(var h=0;h<l.length;h++)this.addAttribute(l[h],e,n,r,i);return this}var u=this.buffers.indexOf(e);return-1===u&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new Zr(u,n,r,i,s,a,o),this.instanced=this.instanced||o,this},t.prototype.getAttribute=function(t){return this.attributes[t]},t.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},t.prototype.addIndex=function(t){return t instanceof Qr||(t instanceof Array&&(t=new Uint16Array(t)),t=new Qr(t)),t.type=be.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,-1===this.buffers.indexOf(t)&&this.buffers.push(t),this},t.prototype.getIndex=function(){return this.indexBuffer},t.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var t,e=[],n=[],r=new Qr;for(t in this.attributes){var i=this.attributes[t],s=this.buffers[i.buffer];e.push(s.data),n.push(i.size*ei[i.type]/4),i.buffer=0}for(r.data=function(t,e){for(var n=0,r=0,i={},s=0;s<t.length;s++)r+=e[s],n+=t[s].length;var a=new ArrayBuffer(4*n),o=null,l=0;for(s=0;s<t.length;s++){var h=e[s],u=t[s],c=We(u);i[c]||(i[c]=new ti[c](a)),o=i[c];for(var d=0;d<u.length;d++)o[(d/h|0)*r+l+d%h]=u[d];l+=h}return new Float32Array(a)}(e,n),t=0;t<this.buffers.length;t++)this.buffers[t]!==this.indexBuffer&&this.buffers[t].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},t.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},t.prototype.clone=function(){for(var e=new t,n=0;n<this.buffers.length;n++)e.buffers[n]=new Qr(this.buffers[n].data.slice(0));for(var n in this.attributes){var r=this.attributes[n];e.attributes[n]=new Zr(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=be.ELEMENT_ARRAY_BUFFER),e},t.merge=function(e){for(var n,r=new t,i=[],s=[],a=[],o=0;o<e.length;o++){n=e[o];for(var l=0;l<n.buffers.length;l++)s[l]=s[l]||0,s[l]+=n.buffers[l].data.length,a[l]=0}for(o=0;o<n.buffers.length;o++)i[o]=new(ri[We(n.buffers[o].data)])(s[o]),r.buffers[o]=new Qr(i[o]);for(o=0;o<e.length;o++){n=e[o];for(l=0;l<n.buffers.length;l++)i[l].set(n.buffers[l].data,a[l]),a[l]+=n.buffers[l].data.length}if(r.attributes=n.attributes,n.indexBuffer){r.indexBuffer=r.buffers[n.buffers.indexOf(n.indexBuffer)],r.indexBuffer.type=be.ELEMENT_ARRAY_BUFFER;var h=0,u=0,c=0,d=0;for(o=0;o<n.buffers.length;o++)if(n.buffers[o]!==n.indexBuffer){d=o;break}for(var o in n.attributes){var p=n.attributes[o];(0|p.buffer)===d&&(u+=p.size*ei[p.type]/4)}for(o=0;o<e.length;o++){var f=e[o].indexBuffer.data;for(l=0;l<f.length;l++)r.indexBuffer.data[l+c]+=h;h+=e[o].buffers[d].data.length/u,c+=f.length}}return r},t}(),si=function(t){function e(){var e=t.call(this)||this;return e.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),e}return Ir(e,t),e}(ii),ai=function(t){function e(){var e=t.call(this)||this;return e.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.vertexBuffer=new Qr(e.vertices),e.uvBuffer=new Qr(e.uvs),e.addAttribute("aVertexPosition",e.vertexBuffer).addAttribute("aTextureCoord",e.uvBuffer).addIndex([0,1,2,0,2,3]),e}return Ir(e,t),e.prototype.map=function(t,e){var n=0,r=0;return this.uvs[0]=n,this.uvs[1]=r,this.uvs[2]=n+e.width/t.width,this.uvs[3]=r,this.uvs[4]=n+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=n,this.uvs[7]=r+e.height/t.height,n=e.x,r=e.y,this.vertices[0]=n,this.vertices[1]=r,this.vertices[2]=n+e.width,this.vertices[3]=r,this.vertices[4]=n+e.width,this.vertices[5]=r+e.height,this.vertices[6]=n,this.vertices[7]=r+e.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e}(ii),oi=0,li=function(){function t(t,e,n){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=oi++,this.static=!!e,this.ubo=!!n,t instanceof Qr?(this.buffer=t,this.buffer.type=be.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Qr(new Float32Array(1)),this.buffer.type=be.UNIFORM_BUFFER,this.autoManage=!0))}return t.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},t.prototype.add=function(e,n,r){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[e]=new t(n,r)},t.from=function(e,n,r){return new t(e,n,r)},t.uboFrom=function(e,n){return new t(e,null==n||n,!0)},t}(),hi=function(){function t(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=xe.NONE,this.sourceFrame=new xn,this.destinationFrame=new xn,this.bindingSourceFrame=new xn,this.bindingDestinationFrame=new xn,this.filters=[],this.transform=null}return t.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},t}(),ui=[new En,new En,new En,new En],ci=new In,di=function(){function t(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Kr,this.texturePool.setScreenSize(t.view),this.statePool=[],this.quad=new si,this.quadUv=new ai,this.tempRect=new xn,this.activeState={},this.globalUniforms=new li({outputFrame:new xn,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}return t.prototype.push=function(t,e){for(var n=this.renderer,r=this.defaultFilterStack,i=this.statePool.pop()||new hi,s=this.renderer.renderTexture,a=e[0].resolution,o=e[0].multisample,l=e[0].padding,h=e[0].autoFit,u=e[0].legacy,c=1;c<e.length;c++){var d=e[c];a=Math.min(a,d.resolution),o=Math.min(o,d.multisample),l=this.useMaxPadding?Math.max(l,d.padding):l+d.padding,h=h&&d.autoFit,u=u||d.legacy}if(1===r.length&&(this.defaultFilterStack[0].renderTexture=s.current),r.push(i),i.resolution=a,i.multisample=o,i.legacy=u,i.target=t,i.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),i.sourceFrame.pad(l),h){var p=this.tempRect.copyFrom(s.sourceFrame);n.projection.transform&&this.transformAABB(ci.copyFrom(n.projection.transform).invert(),p),i.sourceFrame.fit(p)}this.roundFrame(i.sourceFrame,s.current?s.current.resolution:n.resolution,s.sourceFrame,s.destinationFrame,n.projection.transform),i.renderTexture=this.getOptimalFilterTexture(i.sourceFrame.width,i.sourceFrame.height,a,o),i.filters=e,i.destinationFrame.width=i.renderTexture.width,i.destinationFrame.height=i.renderTexture.height;var f=this.tempRect;f.x=0,f.y=0,f.width=i.sourceFrame.width,f.height=i.sourceFrame.height,i.renderTexture.filterFrame=i.sourceFrame,i.bindingSourceFrame.copyFrom(s.sourceFrame),i.bindingDestinationFrame.copyFrom(s.destinationFrame),i.transform=n.projection.transform,n.projection.transform=null,s.bind(i.renderTexture,i.sourceFrame,f),n.framebuffer.clear(0,0,0,0)},t.prototype.pop=function(){var t=this.defaultFilterStack,e=t.pop(),n=e.filters;this.activeState=e;var r=this.globalUniforms.uniforms;r.outputFrame=e.sourceFrame,r.resolution=e.resolution;var i=r.inputSize,s=r.inputPixel,a=r.inputClamp;if(i[0]=e.destinationFrame.width,i[1]=e.destinationFrame.height,i[2]=1/i[0],i[3]=1/i[1],s[0]=Math.round(i[0]*e.resolution),s[1]=Math.round(i[1]*e.resolution),s[2]=1/s[0],s[3]=1/s[1],a[0]=.5*s[2],a[1]=.5*s[3],a[2]=e.sourceFrame.width*i[2]-.5*s[2],a[3]=e.sourceFrame.height*i[3]-.5*s[3],e.legacy){var o=r.filterArea;o[0]=e.destinationFrame.width,o[1]=e.destinationFrame.height,o[2]=e.sourceFrame.x,o[3]=e.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();var l=t[t.length-1];if(this.renderer.framebuffer.blit(),1===n.length)n[0].apply(this,e.renderTexture,l.renderTexture,me.BLEND,e),this.returnFilterTexture(e.renderTexture);else{var h=e.renderTexture,u=this.getOptimalFilterTexture(h.width,h.height,e.resolution);u.filterFrame=h.filterFrame;var c=0;for(c=0;c<n.length-1;++c){1===c&&e.multisample>1&&((u=this.getOptimalFilterTexture(h.width,h.height,e.resolution)).filterFrame=h.filterFrame),n[c].apply(this,h,u,me.CLEAR,e);var d=h;h=u,u=d}n[c].apply(this,h,l.renderTexture,me.BLEND,e),c>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(h),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)},t.prototype.bindAndClear=function(t,e){void 0===e&&(e=me.CLEAR);var n=this.renderer,r=n.renderTexture,i=n.state;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t&&t.filterFrame){var s=this.tempRect;s.x=0,s.y=0,s.width=t.filterFrame.width,s.height=t.filterFrame.height,r.bind(t,t.filterFrame,s)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var a=1&i.stateId||this.forceClear;(e===me.CLEAR||e===me.BLIT&&a)&&this.renderer.framebuffer.clear(0,0,0,0)},t.prototype.applyFilter=function(t,e,n,r){var i=this.renderer;i.state.set(t.state),this.bindAndClear(n,r),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,i.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),i.geometry.bind(this.quadUv),i.geometry.draw(ae.TRIANGLES)):(i.geometry.bind(this.quad),i.geometry.draw(ae.TRIANGLE_STRIP))},t.prototype.calculateSpriteMatrix=function(t,e){var n=this.activeState,r=n.sourceFrame,i=n.destinationFrame,s=e._texture.orig,a=t.set(i.width,0,0,i.height,r.x,r.y),o=e.worldTransform.copyTo(In.TEMP_MATRIX);return o.invert(),a.prepend(o),a.scale(1/s.width,1/s.height),a.translate(e.anchor.x,e.anchor.y),a},t.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},t.prototype.getOptimalFilterTexture=function(t,e,n,r){return void 0===n&&(n=1),void 0===r&&(r=xe.NONE),this.texturePool.getOptimalTexture(t,e,n,r)},t.prototype.getFilterTexture=function(t,e,n){if("number"==typeof t){var r=t;t=e,e=r}t=t||this.activeState.renderTexture;var i=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,n||xe.NONE);return i.filterFrame=t.filterFrame,i},t.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},t.prototype.emptyPool=function(){this.texturePool.clear(!0)},t.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},t.prototype.transformAABB=function(t,e){var n=ui[0],r=ui[1],i=ui[2],s=ui[3];n.set(e.left,e.top),r.set(e.left,e.bottom),i.set(e.right,e.top),s.set(e.right,e.bottom),t.apply(n,n),t.apply(r,r),t.apply(i,i),t.apply(s,s);var a=Math.min(n.x,r.x,i.x,s.x),o=Math.min(n.y,r.y,i.y,s.y),l=Math.max(n.x,r.x,i.x,s.x),h=Math.max(n.y,r.y,i.y,s.y);e.x=a,e.y=o,e.width=l-a,e.height=h-o},t.prototype.roundFrame=function(t,e,n,r,i){if(i){var s=i.a,a=i.b,o=i.c,l=i.d;if((Math.abs(a)>1e-4||Math.abs(o)>1e-4)&&(Math.abs(s)>1e-4||Math.abs(l)>1e-4))return}(i=i?ci.copyFrom(i):ci.identity()).translate(-n.x,-n.y).scale(r.width/n.width,r.height/n.height).translate(r.x,r.y),this.transformAABB(i,t),t.ceil(e),this.transformAABB(i.invert(),t)},t}(),pi=function(){function t(t){this.renderer=t}return t.prototype.flush=function(){},t.prototype.destroy=function(){this.renderer=null},t.prototype.start=function(){},t.prototype.stop=function(){this.flush()},t.prototype.render=function(t){},t}(),fi=function(){function t(t){this.renderer=t,this.emptyRenderer=new pi(t),this.currentRenderer=this.emptyRenderer}return t.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},t.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},t.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},t.prototype.copyBoundTextures=function(t,e){for(var n=this.renderer.texture.boundTextures,r=e-1;r>=0;--r)t[r]=n[r]||null,t[r]&&(t[r]._batchLocation=r)},t.prototype.boundArray=function(t,e,n,r){for(var i=t.elements,s=t.ids,a=t.count,o=0,l=0;l<a;l++){var h=i[l],u=h._batchLocation;if(u>=0&&u<r&&e[u]===h)s[l]=u;else for(;o<r;){var c=e[o];if(!c||c._batchEnabled!==n||c._batchLocation!==o){s[l]=o,h._batchLocation=o,e[o]=h;break}o++}}},t.prototype.destroy=function(){this.renderer=null},t}(),mi=0,gi=function(){function t(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),t.view.addEventListener("webglcontextlost",this.handleContextLost,!1),t.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}return Object.defineProperty(t.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),t.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=mi++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},t.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=mi++,this.renderer.runners.contextChange.emit(t)},t.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},t.prototype.createContext=function(t,e){var n;if(we.PREFER_ENV>=ne.WEBGL2&&(n=t.getContext("webgl2",e)),n)this.webGLVersion=2;else if(this.webGLVersion=1,!(n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),this.gl},t.prototype.getExtensions=function(){var t=this.gl,e={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})},t.prototype.handleContextLost=function(t){t.preventDefault()},t.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},t.prototype.destroy=function(){var t=this.renderer.view;this.renderer=null,t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},t.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},t.prototype.validateContext=function(t){var e=t.getContextAttributes(),n="WebGL2RenderingContext"in self&&t instanceof self.WebGL2RenderingContext;n&&(this.webGLVersion=2),e.stencil;var r=n||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r},t}(),yi=function(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=xe.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0},vi=new xn,xi=function(){function t(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Gr(10,10),this.msaaSamples=null}return t.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new xn,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var e=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;we.PREFER_ENV===ne.WEBGL_LEGACY&&(e=null,n=null),e?t.drawBuffers=function(t){return e.drawBuffersWEBGL(t)}:(this.hasMRT=!1,t.drawBuffers=function(){}),n||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)},t.prototype.bind=function(t,e,n){void 0===n&&(n=0);var r=this.gl;if(t){var i=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,r.bindFramebuffer(r.FRAMEBUFFER,i.framebuffer)),i.mipLevel!==n&&(t.dirtyId++,t.dirtyFormat++,i.mipLevel=n),i.dirtyId!==t.dirtyId&&(i.dirtyId=t.dirtyId,i.dirtyFormat!==t.dirtyFormat?(i.dirtyFormat=t.dirtyFormat,i.dirtySize=t.dirtySize,this.updateFramebuffer(t,n)):i.dirtySize!==t.dirtySize&&(i.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var s=0;s<t.colorTextures.length;s++){var a=t.colorTextures[s];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){var o=e.width>>n,l=e.height>>n,h=o/e.width;this.setViewport(e.x*h,e.y*h,o,l)}else{o=t.width>>n,l=t.height>>n;this.setViewport(0,0,o,l)}}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},t.prototype.setViewport=function(t,e,n,r){var i=this.viewport;t=Math.round(t),e=Math.round(e),n=Math.round(n),r=Math.round(r),i.width===n&&i.height===r&&i.x===t&&i.y===e||(i.x=t,i.y=e,i.width=n,i.height=r,this.gl.viewport(t,e,n,r))},Object.defineProperty(t.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),t.prototype.clear=function(t,e,n,r,i){void 0===i&&(i=ie.COLOR|ie.DEPTH);var s=this.gl;s.clearColor(t,e,n,r),s.clear(i)},t.prototype.initFramebuffer=function(t){var e=this.gl,n=new yi(e.createFramebuffer());return n.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=n,this.managedFramebuffers.push(t),t.disposeRunner.add(this),n},t.prototype.resizeFramebuffer=function(t){var e=this.gl,n=t.glFramebuffers[this.CONTEXT_UID];n.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,n.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,n.multisample,e.RGBA8,t.width,t.height)),n.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,n.stencil),n.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,n.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));var r=t.colorTextures,i=r.length;e.drawBuffers||(i=Math.min(i,1));for(var s=0;s<i;s++){var a=r[s],o=a.parentTextureArray||a;this.renderer.texture.bind(o,0)}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)},t.prototype.updateFramebuffer=function(t,e){var n=this.gl,r=t.glFramebuffers[this.CONTEXT_UID],i=t.colorTextures,s=i.length;n.drawBuffers||(s=Math.min(s,1)),r.multisample>1&&this.canMultisampleFramebuffer(t)?(r.msaaBuffer=r.msaaBuffer||n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,r.msaaBuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,r.multisample,n.RGBA8,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,r.msaaBuffer)):r.msaaBuffer&&(n.deleteRenderbuffer(r.msaaBuffer),r.msaaBuffer=null,r.blitFramebuffer&&(r.blitFramebuffer.dispose(),r.blitFramebuffer=null));for(var a=[],o=0;o<s;o++){var l=i[o],h=l.parentTextureArray||l;this.renderer.texture.bind(h,0),0===o&&r.msaaBuffer||(n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+o,l.target,h._glTextures[this.CONTEXT_UID].texture,e),a.push(n.COLOR_ATTACHMENT0+o))}if((a.length>1&&n.drawBuffers(a),t.depthTexture)&&this.writeDepthTexture){var u=t.depthTexture;this.renderer.texture.bind(u,0),n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,u._glTextures[this.CONTEXT_UID].texture,e)}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?r.stencil&&(n.deleteRenderbuffer(r.stencil),r.stencil=null):(r.stencil=r.stencil||n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,r.stencil),r.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,r.multisample,n.DEPTH24_STENCIL8,t.width,t.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,r.stencil))},t.prototype.canMultisampleFramebuffer=function(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture},t.prototype.detectSamples=function(t){var e=this.msaaSamples,n=xe.NONE;if(t<=1||null===e)return n;for(var r=0;r<e.length;r++)if(e[r]<=t){n=e[r];break}return 1===n&&(n=xe.NONE),n},t.prototype.blit=function(t,e,n){var r=this,i=r.current,s=r.renderer,a=r.gl,o=r.CONTEXT_UID;if(2===s.context.webGLVersion&&i){var l=i.glFramebuffers[o];if(l){if(!t){if(!l.msaaBuffer)return;var h=i.colorTextures[0];if(!h)return;l.blitFramebuffer||(l.blitFramebuffer=new Gr(i.width,i.height),l.blitFramebuffer.addColorTexture(0,h)),(t=l.blitFramebuffer).colorTextures[0]!==h&&(t.colorTextures[0]=h,t.dirtyId++,t.dirtyFormat++),t.width===i.width&&t.height===i.height||(t.width=i.width,t.height=i.height,t.dirtyId++,t.dirtySize++)}e||((e=vi).width=i.width,e.height=i.height),n||(n=e);var u=e.width===n.width&&e.height===n.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,l.framebuffer),a.blitFramebuffer(e.x,e.y,e.width,e.height,n.x,n.y,n.width,n.height,a.COLOR_BUFFER_BIT,u?a.NEAREST:a.LINEAR)}}},t.prototype.disposeFramebuffer=function(t,e){var n=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(n){delete t.glFramebuffers[this.CONTEXT_UID];var i=this.managedFramebuffers.indexOf(t);i>=0&&this.managedFramebuffers.splice(i,1),t.disposeRunner.remove(this),e||(r.deleteFramebuffer(n.framebuffer),n.msaaBuffer&&r.deleteRenderbuffer(n.msaaBuffer),n.stencil&&r.deleteRenderbuffer(n.stencil)),n.blitFramebuffer&&n.blitFramebuffer.dispose()}},t.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var n=0;n<e.length;n++)this.disposeFramebuffer(e[n],t)},t.prototype.forceStencil=function(){var t=this.current;if(t){var e=t.glFramebuffers[this.CONTEXT_UID];if(e&&!e.stencil){t.stencil=!0;var n=t.width,r=t.height,i=this.gl,s=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,s),e.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,e.multisample,i.DEPTH24_STENCIL8,n,r):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,n,r),e.stencil=s,i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,s)}}},t.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new xn},t.prototype.destroy=function(){this.renderer=null},t}(),bi={5126:4,5123:2,5121:1},wi=function(){function t(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}return t.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){var n=this.renderer.context.extensions.vertexArrayObject;we.PREFER_ENV===ne.WEBGL_LEGACY&&(n=null),n?(t.createVertexArray=function(){return n.createVertexArrayOES()},t.bindVertexArray=function(t){return n.bindVertexArrayOES(t)},t.deleteVertexArray=function(t){return n.deleteVertexArrayOES(t)}):(this.hasVao=!1,t.createVertexArray=function(){return null},t.bindVertexArray=function(){return null},t.deleteVertexArray=function(){return null})}if(2!==e.webGLVersion){var r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=function(t,e){return r.vertexAttribDivisorANGLE(t,e)},t.drawElementsInstanced=function(t,e,n,i,s){return r.drawElementsInstancedANGLE(t,e,n,i,s)},t.drawArraysInstanced=function(t,e,n,i){return r.drawArraysInstancedANGLE(t,e,n,i)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex},t.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var n=this.gl,r=t.glVertexArrayObjects[this.CONTEXT_UID],i=!1;r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={},i=!0);var s=r[e.program.id]||this.initGeometryVao(t,e,i);this._activeGeometry=t,this._activeVao!==s&&(this._activeVao=s,this.hasVao?n.bindVertexArray(s):this.activateVao(t,e.program)),this.updateBuffers()},t.prototype.reset=function(){this.unbind()},t.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.renderer.buffer,n=0;n<t.buffers.length;n++){var r=t.buffers[n];e.update(r)}},t.prototype.checkCompatibility=function(t,e){var n=t.attributes,r=e.attributeData;for(var i in r)if(!n[i])throw new Error('shader and geometry incompatible, geometry missing the "'+i+'" attribute')},t.prototype.getSignature=function(t,e){var n=t.attributes,r=e.attributeData,i=["g",t.id];for(var s in n)r[s]&&i.push(s);return i.join("-")},t.prototype.initGeometryVao=function(t,e,n){void 0===n&&(n=!0);var r=this.gl,i=this.CONTEXT_UID,s=this.renderer.buffer,a=e.program;a.glPrograms[i]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);var o=this.getSignature(t,a),l=t.glVertexArrayObjects[this.CONTEXT_UID],h=l[o];if(h)return l[a.id]=h,h;var u=t.buffers,c=t.attributes,d={},p={};for(var f in u)d[f]=0,p[f]=0;for(var f in c)!c[f].size&&a.attributeData[f]?c[f].size=a.attributeData[f].size:c[f].size,d[c[f].buffer]+=c[f].size*bi[c[f].type];for(var f in c){var m=c[f],g=m.size;void 0===m.stride&&(d[m.buffer]===g*bi[m.type]?m.stride=0:m.stride=d[m.buffer]),void 0===m.start&&(m.start=p[m.buffer],p[m.buffer]+=g*bi[m.type])}h=r.createVertexArray(),r.bindVertexArray(h);for(var y=0;y<u.length;y++){var v=u[y];s.bind(v),n&&v._glBuffers[i].refCount++}return this.activateVao(t,a),this._activeVao=h,l[a.id]=h,l[o]=h,h},t.prototype.disposeGeometry=function(t,e){var n;if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var r=t.glVertexArrayObjects[this.CONTEXT_UID],i=this.gl,s=t.buffers,a=null===(n=this.renderer)||void 0===n?void 0:n.buffer;if(t.disposeRunner.remove(this),r){if(a)for(var o=0;o<s.length;o++){var l=s[o]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,0!==l.refCount||e||a.dispose(s[o],e))}if(!e)for(var h in r)if("g"===h[0]){var u=r[h];this._activeVao===u&&this.unbind(),i.deleteVertexArray(u)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},t.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),n=0;n<e.length;n++)this.disposeGeometry(this.managedGeometries[e[n]],t)},t.prototype.activateVao=function(t,e){var n=this.gl,r=this.CONTEXT_UID,i=this.renderer.buffer,s=t.buffers,a=t.attributes;t.indexBuffer&&i.bind(t.indexBuffer);var o=null;for(var l in a){var h=a[l],u=s[h.buffer],c=u._glBuffers[r];if(e.attributeData[l]){o!==c&&(i.bind(u),o=c);var d=e.attributeData[l].location;if(n.enableVertexAttribArray(d),n.vertexAttribPointer(d,h.size,h.type||n.FLOAT,h.normalized,h.stride,h.start),h.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");n.vertexAttribDivisor(d,1)}}}},t.prototype.draw=function(t,e,n,r){var i=this.gl,s=this._activeGeometry;if(s.indexBuffer){var a=s.indexBuffer.data.BYTES_PER_ELEMENT,o=2===a?i.UNSIGNED_SHORT:i.UNSIGNED_INT;(2===a||4===a&&this.canUseUInt32ElementIndex)&&(s.instanced?i.drawElementsInstanced(t,e||s.indexBuffer.data.length,o,(n||0)*a,r||1):i.drawElements(t,e||s.indexBuffer.data.length,o,(n||0)*a))}else s.instanced?i.drawArraysInstanced(t,n,e||s.getSize(),r||1):i.drawArrays(t,n,e||s.getSize());return this},t.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},t.prototype.destroy=function(){this.renderer=null},t}(),_i=function(){function t(t){void 0===t&&(t=null),this.type=ve.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=we.FILTER_MULTISAMPLE,this.enabled=!0,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._target=null}return Object.defineProperty(t.prototype,"filter",{get:function(){return this._filters?this._filters[0]:null},set:function(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=ve.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null},t.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},t}();function Ti(t,e,n){var r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}function Ei(t,e){var n=t.getShaderSource(e).split("\n").map((function(t,e){return e+": "+t})),r=t.getShaderInfoLog(e).split("\n"),i={},s=r.map((function(t){return parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))})).filter((function(t){return!(!t||i[t])&&(i[t]=!0,!0)})),a=[""];s.forEach((function(t){n[t-1]="%c"+n[t-1]+"%c",a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));var o=n.join("\n");a[0]=o}function Si(t){for(var e=new Array(t),n=0;n<e.length;n++)e[n]=!1;return e}function Ii(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return Si(2*e);case"bvec3":return Si(3*e);case"bvec4":return Si(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var ki,Ci={},Ni=Ci;function Ai(){if(Ni===Ci||Ni&&Ni.isContextLost()){var t=document.createElement("canvas"),e=void 0;we.PREFER_ENV>=ne.WEBGL2&&(e=t.getContext("webgl2",{})),e||((e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}))?e.getExtension("WEBGL_draw_buffers"):e=null),Ni=e}return Ni}function Ri(t,e,n){if("precision"!==t.substring(0,9)){var r=e;return e===ye.HIGH&&n!==ye.HIGH&&(r=ye.MEDIUM),"precision "+r+" float;\n"+t}return n!==ye.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}var Mi={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Oi(t){return Mi[t]}var Pi=null,Di={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Fi(t,e){if(!Pi){var n=Object.keys(Di);Pi={};for(var r=0;r<n.length;++r){var i=n[r];Pi[t[i]]=Di[i]}}return Pi[e]}var Li=[{test:function(t){return"float"===t.type&&1===t.size},code:function(t){return'\n            if(uv["'+t+'"] !== ud["'+t+'"].value)\n            {\n                ud["'+t+'"].value = uv["'+t+'"]\n                gl.uniform1f(ud["'+t+'"].location, uv["'+t+'"])\n            }\n            '}},{test:function(t){return("sampler2D"===t.type||"samplerCube"===t.type||"sampler2DArray"===t.type)&&1===t.size&&!t.isArray},code:function(t){return't = syncData.textureCount++;\n\n            renderer.texture.bind(uv["'+t+'"], t);\n\n            if(ud["'+t+'"].value !== t)\n            {\n                ud["'+t+'"].value = t;\n                gl.uniform1i(ud["'+t+'"].location, t);\n; // eslint-disable-line max-len\n            }'}},{test:function(t,e){return"mat3"===t.type&&1===t.size&&void 0!==e.a},code:function(t){return'\n            gl.uniformMatrix3fv(ud["'+t+'"].location, false, uv["'+t+'"].toArray(true));\n            '},codeUbo:function(t){return"\n                var "+t+"_matrix = uv."+t+".toArray(true);\n\n                data[offset] = "+t+"_matrix[0];\n                data[offset+1] = "+t+"_matrix[1];\n                data[offset+2] = "+t+"_matrix[2];\n        \n                data[offset + 4] = "+t+"_matrix[3];\n                data[offset + 5] = "+t+"_matrix[4];\n                data[offset + 6] = "+t+"_matrix[5];\n        \n                data[offset + 8] = "+t+"_matrix[6];\n                data[offset + 9] = "+t+"_matrix[7];\n                data[offset + 10] = "+t+"_matrix[8];\n            "}},{test:function(t,e){return"vec2"===t.type&&1===t.size&&void 0!==e.x},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["'+t+'"].location, v.x, v.y);\n                }'},codeUbo:function(t){return"\n                v = uv."+t+";\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            "}},{test:function(t){return"vec2"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["'+t+'"].location, v[0], v[1]);\n                }\n            '}},{test:function(t,e){return"vec4"===t.type&&1===t.size&&void 0!==e.width},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["'+t+'"].location, v.x, v.y, v.width, v.height)\n                }'},codeUbo:function(t){return"\n                    v = uv."+t+";\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                "}},{test:function(t){return"vec4"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["'+t+'"].location, v[0], v[1], v[2], v[3])\n                }'}}],Bi={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},$i={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};var Ui,Vi=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function zi(t){for(var e="",n=0;n<t;++n)n>0&&(e+="\nelse "),n<t-1&&(e+="if(test == "+n+".0){}");return e}function Gi(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var n=e.createShader(e.FRAGMENT_SHADER);;){var r=Vi.replace(/%forloop%/gi,zi(t));if(e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))break;t=t/2|0}return t}var Wi=0,Xi={},Hi=function(){function t(e,n,r){void 0===r&&(r="pixi-shader"),this.id=Wi++,this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=n||t.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(r=r.replace(/\s+/g,"-"),Xi[r]?(Xi[r]++,r+="-"+Xi[r]):Xi[r]=1,this.vertexSrc="#define SHADER_NAME "+r+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+r+"\n"+this.fragmentSrc,this.vertexSrc=Ri(this.vertexSrc,we.PRECISION_VERTEX,ye.HIGH),this.fragmentSrc=Ri(this.fragmentSrc,we.PRECISION_FRAGMENT,function(){if(!ki){ki=ye.MEDIUM;var t=Ai();if(t&&t.getShaderPrecisionFormat){var e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);ki=e.precision?ye.HIGH:ye.MEDIUM}}return ki}())),this.glPrograms={},this.syncUniforms=null}return Object.defineProperty(t,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},enumerable:!1,configurable:!0}),t.from=function(e,n,r){var i=e+n,s=nn[i];return s||(nn[i]=s=new t(e,n,r)),s},t}(),Yi=function(){function t(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof li?e:new li(e):new li({})}return t.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var n in e.uniforms){var r=e.uniforms[n];if(r.group&&this.checkUniformExists(t,r))return!0}return!1},t.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(t.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),t.from=function(e,n,r){return new t(Hi.from(e,n),r)},t}(),ji=function(){function t(){this.data=0,this.blendMode=se.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(t.prototype,"blend",{get:function(){return!!(1&this.data)},set:function(t){!!(1&this.data)!==t&&(this.data^=1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsets",{get:function(){return!!(2&this.data)},set:function(t){!!(2&this.data)!==t&&(this.data^=2)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"culling",{get:function(){return!!(4&this.data)},set:function(t){!!(4&this.data)!==t&&(this.data^=4)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthTest",{get:function(){return!!(8&this.data)},set:function(t){!!(8&this.data)!==t&&(this.data^=8)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthMask",{get:function(){return!!(32&this.data)},set:function(t){!!(32&this.data)!==t&&(this.data^=32)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clockwiseFrontFace",{get:function(){return!!(16&this.data)},set:function(t){!!(16&this.data)!==t&&(this.data^=16)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){this.blend=t!==se.NONE,this._blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(t){this.offsets=!!t,this._polygonOffset=t},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"[@pixi/core:State blendMode="+this.blendMode+" clockwiseFrontFace="+this.clockwiseFrontFace+" culling="+this.culling+" depthMask="+this.depthMask+" polygonOffset="+this.polygonOffset+"]"},t.for2d=function(){var e=new t;return e.depthTest=!1,e.blend=!0,e},t}(),qi=function(t){function e(n,r,i){var s=this,a=Hi.from(n||e.defaultVertexSrc,r||e.defaultFragmentSrc);return(s=t.call(this,a,i)||this).padding=0,s.resolution=we.FILTER_RESOLUTION,s.multisample=we.FILTER_MULTISAMPLE,s.enabled=!0,s.autoFit=!0,s.state=new ji,s}return Ir(e,t),e.prototype.apply=function(t,e,n,r,i){t.applyFilter(this,e,n,r)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._resolution=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},enumerable:!1,configurable:!0}),e}(Yi),Ki=new In,Zi=function(){function t(t,e){this._texture=t,this.mapCoord=new In,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}return Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._textureID=-1},enumerable:!1,configurable:!0}),t.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var n=this.mapCoord,r=0;r<t.length;r+=2){var i=t[r],s=t[r+1];e[r]=i*n.a+s*n.c+n.tx,e[r+1]=i*n.b+s*n.d+n.ty}return e},t.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;var n=e._uvs;this.mapCoord.set(n.x1-n.x0,n.y1-n.y0,n.x3-n.x0,n.y3-n.y0,n.x0,n.y0);var r=e.orig,i=e.trim;i&&(Ki.set(r.width/i.width,0,0,r.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(Ki));var s=e.baseTexture,a=this.uClampFrame,o=this.clampMargin/s.resolution,l=this.clampOffset;return a[0]=(e._frame.x+o+l)/s.width,a[1]=(e._frame.y+o+l)/s.height,a[2]=(e._frame.x+e._frame.width-o+l)/s.width,a[3]=(e._frame.y+e._frame.height-o+l)/s.height,this.uClampOffset[0]=l/s.realWidth,this.uClampOffset[1]=l/s.realHeight,this.isSimple=e._frame.width===s.width&&e._frame.height===s.height&&0===e.rotate,!0},t}(),Ji=function(t){function e(e,n,r){var i=this,s=null;return"string"!=typeof e&&void 0===n&&void 0===r&&(s=e,e=void 0,n=void 0,r=void 0),(i=t.call(this,e||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",n||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",r)||this).maskSprite=s,i.maskMatrix=new In,i}return Ir(e,t),Object.defineProperty(e.prototype,"maskSprite",{get:function(){return this._maskSprite},set:function(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)},enumerable:!1,configurable:!0}),e.prototype.apply=function(t,e,n,r){var i=this._maskSprite,s=i._texture;s.valid&&(s.uvMatrix||(s.uvMatrix=new Zi(s,0)),s.uvMatrix.update(),this.uniforms.npmAlpha=s.baseTexture.alphaMode?0:1,this.uniforms.mask=s,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,i).prepend(s.uvMatrix.mapCoord),this.uniforms.alpha=i.worldAlpha,this.uniforms.maskClamp=s.uvMatrix.uClampFrame,t.applyFilter(this,e,n,r))},e}(qi),Qi=function(){function t(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return t.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},t.prototype.push=function(t,e){var n=e;if(!n.isMaskData){var r=this.maskDataPool.pop()||new _i;r.pooled=!0,r.maskObject=e,n=r}var i=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(n.copyCountersOrReset(i),n.autoDetect&&this.detect(n),n._target=t,n.type!==ve.SPRITE&&this.maskStack.push(n),n.enabled)switch(n.type){case ve.SCISSOR:this.renderer.scissor.push(n);break;case ve.STENCIL:this.renderer.stencil.push(n);break;case ve.SPRITE:n.copyCountersOrReset(null),this.pushSpriteMask(n)}n.type===ve.SPRITE&&this.maskStack.push(n)},t.prototype.pop=function(t){var e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case ve.SCISSOR:this.renderer.scissor.pop();break;case ve.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case ve.SPRITE:this.popSpriteMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){var n=this.maskStack[this.maskStack.length-1];n.type===ve.SPRITE&&n._filters&&(n._filters[0].maskSprite=n.maskObject)}}},t.prototype.detect=function(t){t.maskObject.isSprite?t.type=ve.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=ve.SCISSOR:t.type=ve.STENCIL},t.prototype.pushSpriteMask=function(t){var e,n,r=t.maskObject,i=t._target,s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex])||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new Ji]);var a,o,l=this.renderer,h=l.renderTexture;if(h.current){var u=h.current;a=t.resolution||u.resolution,o=null!==(e=t.multisample)&&void 0!==e?e:u.multisample}else a=t.resolution||l.resolution,o=null!==(n=t.multisample)&&void 0!==n?n:l.multisample;s[0].resolution=a,s[0].multisample=o,s[0].maskSprite=r;var c=i.filterArea;i.filterArea=r.getBounds(!0),l.filter.push(i,s),i.filterArea=c,t._filters||this.alphaMaskIndex++},t.prototype.popSpriteMask=function(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)},t.prototype.destroy=function(){this.renderer=null},t}(),ts=function(){function t(t){this.renderer=t,this.maskStack=[],this.glConst=0}return t.prototype.getStackLength=function(){return this.maskStack.length},t.prototype.setMaskStack=function(t){var e=this.renderer.gl,n=this.getStackLength();this.maskStack=t;var r=this.getStackLength();r!==n&&(0===r?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))},t.prototype._useCurrent=function(){},t.prototype.destroy=function(){this.renderer=null,this.maskStack=null},t}(),es=new In,ns=function(t){function e(e){var n=t.call(this,e)||this;return n.glConst=WebGLRenderingContext.SCISSOR_TEST,n}return Ir(e,t),e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},e.prototype.calcScissorRect=function(t){if(!t._scissorRectLocal){var e=t._scissorRect,n=t.maskObject,r=this.renderer,i=r.renderTexture;n.renderable=!0;var s=n.getBounds();this.roundFrameToPixels(s,i.current?i.current.resolution:r.resolution,i.sourceFrame,i.destinationFrame,r.projection.transform),n.renderable=!1,e&&s.fit(e),t._scissorRectLocal=s}},e.isMatrixRotated=function(t){if(!t)return!1;var e=t.a,n=t.b,r=t.c,i=t.d;return(Math.abs(n)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(i)>1e-4)},e.prototype.testScissor=function(t){var n=t.maskObject;if(!n.isFastRect||!n.isFastRect())return!1;if(e.isMatrixRotated(n.worldTransform))return!1;if(e.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);var r=t._scissorRectLocal;return r.width>0&&r.height>0},e.prototype.roundFrameToPixels=function(t,n,r,i,s){e.isMatrixRotated(s)||((s=s?es.copyFrom(s):es.identity()).translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.renderer.filter.transformAABB(s,t),t.fit(i),t.x=Math.round(t.x*n),t.y=Math.round(t.y*n),t.width=Math.round(t.width*n),t.height=Math.round(t.height*n))},e.prototype.push=function(t){t._scissorRectLocal||this.calcScissorRect(t);var e=this.renderer.gl;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()},e.prototype.pop=function(){var t=this.renderer.gl;this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)},e.prototype._useCurrent=function(){var t,e=this.maskStack[this.maskStack.length-1]._scissorRect;t=this.renderer.renderTexture.current?e.y:this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)},e}(ts),rs=function(t){function e(e){var n=t.call(this,e)||this;return n.glConst=WebGLRenderingContext.STENCIL_TEST,n}return Ir(e,t),e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},e.prototype.push=function(t){var e=t.maskObject,n=this.renderer.gl,r=t._stencilCounter;0===r&&(this.renderer.framebuffer.forceStencil(),n.enable(n.STENCIL_TEST)),t._stencilCounter++,n.colorMask(!1,!1,!1,!1),n.stencilFunc(n.EQUAL,r,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,this._useCurrent()},e.prototype.pop=function(t){var e=this.renderer.gl;0===this.getStackLength()?(e.disable(e.STENCIL_TEST),e.clearStencil(0),e.clear(e.STENCIL_BUFFER_BIT)):(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent())},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e}(ts),is=function(){function t(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new In,this.transform=null}return t.prototype.update=function(t,e,n,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,r),this.transform&&this.projectionMatrix.append(this.transform);var i=this.renderer;i.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,i.globalUniforms.update(),i.shader.shader&&i.shader.syncUniformGroup(i.shader.shader.uniforms.globals)},t.prototype.calculateProjection=function(t,e,n,r){var i=this.projectionMatrix,s=r?-1:1;i.identity(),i.a=1/e.width*2,i.d=s*(1/e.height*2),i.tx=-1-e.x*i.a,i.ty=-s-e.y*i.d},t.prototype.setTransform=function(t){},t.prototype.destroy=function(){this.renderer=null},t}(),ss=new xn,as=new xn,os=function(){function t(t){this.renderer=t,this.clearColor=t._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new xn,this.destinationFrame=new xn,this.viewportFrame=new xn}return t.prototype.bind=function(t,e,n){void 0===t&&(t=null);var r,i,s,a=this.renderer;this.current=t,t?(s=(r=t.baseTexture).resolution,e||(ss.width=t.frame.width,ss.height=t.frame.height,e=ss),n||(as.x=t.frame.x,as.y=t.frame.y,as.width=e.width,as.height=e.height,n=as),i=r.framebuffer):(s=a.resolution,e||(ss.width=a.screen.width,ss.height=a.screen.height,e=ss),n||((n=ss).width=e.width,n.height=e.height));var o=this.viewportFrame;o.x=n.x*s,o.y=n.y*s,o.width=n.width*s,o.height=n.height*s,t||(o.y=a.view.height-(o.y+o.height)),o.ceil(),this.renderer.framebuffer.bind(i,o),this.renderer.projection.update(n,e,s,!i),t?this.renderer.mask.setMaskStack(r.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(n)},t.prototype.clear=function(t,e){t=this.current?t||this.current.baseTexture.clearColor:t||this.clearColor;var n=this.destinationFrame,r=this.current?this.current.baseTexture:this.renderer.screen,i=n.width!==r.width||n.height!==r.height;if(i){var s=this.viewportFrame,a=s.x,o=s.y,l=s.width,h=s.height;a=Math.round(a),o=Math.round(o),l=Math.round(l),h=Math.round(h),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(a,o,l,h)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),i&&this.renderer.scissor.pop()},t.prototype.resize=function(){this.bind(null)},t.prototype.reset=function(){this.bind(null)},t.prototype.destroy=function(){this.renderer=null},t}();function ls(t,e,n,r,i){n.buffer.update(i)}var hs={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},us={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function cs(t){for(var e=t.map((function(t){return{data:t,offset:0,dataLen:0,dirty:0}})),n=0,r=0,i=0,s=0;s<e.length;s++){var a=e[s];if(n=us[a.data.type],a.data.size>1&&(n=Math.max(n,16)*a.data.size),a.dataLen=n,r%n!=0&&r<16){var o=r%n%16;r+=o,i+=o}r+n>16?(i=16*Math.ceil(i/16),a.offset=i,i+=n,r=n):(a.offset=i,r+=n,i+=n)}return{uboElements:e,size:i=16*Math.ceil(i/16)}}function ds(t,e){var n=[];for(var r in t)e[r]&&n.push(e[r]);return n.sort((function(t,e){return t.index-e.index})),n}function ps(t,e){if(!t.autoManage)return{size:0,syncFunc:ls};for(var n=cs(ds(t.uniforms,e)),r=n.uboElements,i=n.size,s=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "],a=0;a<r.length;a++){for(var o=r[a],l=t.uniforms[o.data.name],h=o.data.name,u=!1,c=0;c<Li.length;c++){var d=Li[c];if(d.codeUbo&&d.test(o.data,l)){s.push("offset = "+o.offset/4+";",Li[c].codeUbo(o.data.name,l)),u=!0;break}}if(!u)if(o.data.size>1){var p=Oi(o.data.type),f=Math.max(us[o.data.type]/16,1),m=p/f,g=(4-m%4)%4;s.push("\n                cv = ud."+h+".value;\n                v = uv."+h+";\n                offset = "+o.offset/4+";\n\n                t = 0;\n\n                for(var i=0; i < "+o.data.size*f+"; i++)\n                {\n                    for(var j = 0; j < "+m+"; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += "+g+";\n                }\n\n                ")}else{var y=hs[o.data.type];s.push("\n                cv = ud."+h+".value;\n                v = uv."+h+";\n                offset = "+o.offset/4+";\n                "+y+";\n                ")}}return s.push("\n       renderer.buffer.update(buffer);\n    "),{size:i,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join("\n"))}}var fs=function(){},ms=function(){function t(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}return t.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},t}();function gs(t,e){var n=Ti(t,t.VERTEX_SHADER,e.vertexSrc),r=Ti(t,t.FRAGMENT_SHADER,e.fragmentSrc),i=t.createProgram();if(t.attachShader(i,n),t.attachShader(i,r),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||function(t,e,n,r){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(n,t.COMPILE_STATUS)||Ei(t,n),t.getShaderParameter(r,t.COMPILE_STATUS)||Ei(t,r),t.getProgramInfoLog(e))}(t,i,n,r),e.attributeData=function(t,e){for(var n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<r;i++){var s=e.getActiveAttrib(t,i);if(0!==s.name.indexOf("gl_")){var a=Fi(e,s.type),o={type:a,name:s.name,size:Oi(a),location:e.getAttribLocation(t,s.name)};n[s.name]=o}}return n}(i,t),e.uniformData=function(t,e){for(var n={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<r;i++){var s=e.getActiveUniform(t,i),a=s.name.replace(/\[.*?\]$/,""),o=!!s.name.match(/\[.*?\]$/),l=Fi(e,s.type);n[a]={name:a,index:i,type:l,size:s.size,isArray:o,value:Ii(l,s.size)}}return n}(i,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){var s=Object.keys(e.attributeData);s.sort((function(t,e){return t>e?1:-1}));for(var a=0;a<s.length;a++)e.attributeData[s[a]].location=a,t.bindAttribLocation(i,a,s[a]);t.linkProgram(i)}t.deleteShader(n),t.deleteShader(r);var o={};for(var a in e.uniformData){var l=e.uniformData[a];o[a]={location:t.getUniformLocation(i,a),value:Ii(l.type,l.size)}}return new ms(i,o)}var ys=0,vs={textureCount:0,uboCount:0},xs=function(){function t(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=ys++}return t.prototype.systemCheck=function(){if(!function(){if("boolean"==typeof Ui)return Ui;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");Ui=!0===t({a:"b"},"a","b")}catch(t){Ui=!1}return Ui}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},t.prototype.contextChange=function(t){this.gl=t,this.reset()},t.prototype.bind=function(t,e){t.uniforms.globals=this.renderer.globalUniforms;var n=t.program,r=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==n&&(this.program=n,this.gl.useProgram(r.program)),e||(vs.textureCount=0,vs.uboCount=0,this.syncUniformGroup(t.uniformGroup,vs)),r},t.prototype.setUniforms=function(t){var e=this.shader.program,n=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(n.uniformData,t,this.renderer)},t.prototype.syncUniformGroup=function(t,e){var n=this.getGlProgram();t.static&&t.dirtyId===n.uniformDirtyGroups[t.id]||(n.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,n,e))},t.prototype.syncUniforms=function(t,e,n){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,n)},t.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){var n,r=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(var i in t.uniforms){var s=e[i];if(s){for(var a=t.uniforms[i],o=!1,l=0;l<Li.length;l++)if(Li[l].test(s,a)){r.push(Li[l].code(i,a)),o=!0;break}if(!o){var h=(1===s.size?Bi:$i)[s.type].replace("location",'ud["'+i+'"].location');r.push('\n            cu = ud["'+i+'"];\n            cv = cu.value;\n            v = uv["'+i+'"];\n            '+h+";")}}else(null===(n=t.uniforms[i])||void 0===n?void 0:n.group)&&(t.uniforms[i].ubo?r.push("\n                        renderer.shader.syncUniformBufferGroup(uv."+i+", '"+i+"');\n                    "):r.push("\n                        renderer.shader.syncUniformGroup(uv."+i+", syncData);\n                    "))}return new Function("ud","uv","renderer","syncData",r.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},t.prototype.syncUniformBufferGroup=function(t,e){var n=this.getGlProgram();if(!t.static||0!==t.dirtyId||!n.uniformGroups[t.id]){t.dirtyId=0;var r=n.uniformGroups[t.id]||this.createSyncBufferGroup(t,n,e);t.buffer.update(),r(n.uniformData,t.uniforms,this.renderer,vs,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,n.uniformBufferBindings[e])},t.prototype.createSyncBufferGroup=function(t,e,n){var r=this.renderer.gl;this.renderer.buffer.bind(t.buffer);var i=this.gl.getUniformBlockIndex(e.program,n);e.uniformBufferBindings[n]=this.shader.uniformBindCount,r.uniformBlockBinding(e.program,i,this.shader.uniformBindCount),this.shader.uniformBindCount++;var s=this.getSignature(t,this.shader.program.uniformData,"ubo"),a=this._uboCache[s];if(a||(a=this._uboCache[s]=ps(t,this.shader.program.uniformData)),t.autoManage){var o=new Float32Array(a.size/4);t.buffer.update(o)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]},t.prototype.getSignature=function(t,e,n){var r=t.uniforms,i=[n+"-"];for(var s in r)i.push(s),e[s]&&i.push(e[s].type);return i.join("-")},t.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},t.prototype.generateProgram=function(t){var e=this.gl,n=t.program,r=gs(e,n);return n.glPrograms[this.renderer.CONTEXT_UID]=r,r},t.prototype.reset=function(){this.program=null,this.shader=null},t.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},t}();var bs=function(){function t(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=se.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new ji,this.defaultState.blend=!0}return t.prototype.contextChange=function(t){this.gl=t,this.blendModes=function(t,e){return void 0===e&&(e=[]),e[se.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.ADD]=[t.ONE,t.ONE],e[se.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.NONE]=[0,0],e[se.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[se.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[se.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[se.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[se.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[se.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[se.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[se.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[se.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[se.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[se.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()},t.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var e=this.stateId^t.data,n=0;e;)1&e&&this.map[n].call(this,!!(t.data&1<<n)),e>>=1,n++;this.stateId=t.data}for(n=0;n<this.checks.length;n++)this.checks[n](this,t)},t.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data},t.prototype.setBlend=function(e){this.updateCheck(t.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)},t.prototype.setOffset=function(e){this.updateCheck(t.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},t.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},t.prototype.setDepthMask=function(t){this.gl.depthMask(t)},t.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},t.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},t.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],n=this.gl;2===e.length?n.blendFunc(e[0],e[1]):n.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,n.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}},t.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},t.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},t.prototype.updateCheck=function(t,e){var n=this.checks.indexOf(t);e&&-1===n?this.checks.push(t):e||-1===n||this.checks.splice(n,1)},t.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},t.checkPolygonOffset=function(t,e){t.setPolygonOffset(1,e.polygonOffset)},t.prototype.destroy=function(){this.gl=null},t}(),ws=function(){function t(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=we.GC_MAX_IDLE,this.checkCountMax=we.GC_MAX_CHECK_COUNT,this.mode=we.GC_MODE}return t.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==ge.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},t.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,n=!1,r=0;r<e.length;r++){var i=e[r];!i.framebuffer&&this.count-i.touched>this.maxIdle&&(t.destroyTexture(i,!0),e[r]=null,n=!0)}if(n){var s=0;for(r=0;r<e.length;r++)null!==e[r]&&(e[s++]=e[r]);e.length=s}},t.prototype.unload=function(t){var e=this.renderer.texture,n=t._texture;n&&!n.framebuffer&&e.destroyTexture(n);for(var r=t.children.length-1;r>=0;r--)this.unload(t.children[r])},t.prototype.destroy=function(){this.renderer=null},t}();var _s=function(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=he.UNSIGNED_BYTE,this.internalFormat=oe.RGBA,this.samplerType=0},Ts=function(){function t(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Rr,this.hasIntegerTextures=!1}return t.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(t){var e,n,r,i,s,a,o,l,h,u,c,d,p,f,m,g,y,v,x,b,w,_,T;return"WebGL2RenderingContext"in self&&t instanceof self.WebGL2RenderingContext?((e={})[he.UNSIGNED_BYTE]=((n={})[oe.RGBA]=t.RGBA8,n[oe.RGB]=t.RGB8,n[oe.RG]=t.RG8,n[oe.RED]=t.R8,n[oe.RGBA_INTEGER]=t.RGBA8UI,n[oe.RGB_INTEGER]=t.RGB8UI,n[oe.RG_INTEGER]=t.RG8UI,n[oe.RED_INTEGER]=t.R8UI,n[oe.ALPHA]=t.ALPHA,n[oe.LUMINANCE]=t.LUMINANCE,n[oe.LUMINANCE_ALPHA]=t.LUMINANCE_ALPHA,n),e[he.BYTE]=((r={})[oe.RGBA]=t.RGBA8_SNORM,r[oe.RGB]=t.RGB8_SNORM,r[oe.RG]=t.RG8_SNORM,r[oe.RED]=t.R8_SNORM,r[oe.RGBA_INTEGER]=t.RGBA8I,r[oe.RGB_INTEGER]=t.RGB8I,r[oe.RG_INTEGER]=t.RG8I,r[oe.RED_INTEGER]=t.R8I,r),e[he.UNSIGNED_SHORT]=((i={})[oe.RGBA_INTEGER]=t.RGBA16UI,i[oe.RGB_INTEGER]=t.RGB16UI,i[oe.RG_INTEGER]=t.RG16UI,i[oe.RED_INTEGER]=t.R16UI,i[oe.DEPTH_COMPONENT]=t.DEPTH_COMPONENT16,i),e[he.SHORT]=((s={})[oe.RGBA_INTEGER]=t.RGBA16I,s[oe.RGB_INTEGER]=t.RGB16I,s[oe.RG_INTEGER]=t.RG16I,s[oe.RED_INTEGER]=t.R16I,s),e[he.UNSIGNED_INT]=((a={})[oe.RGBA_INTEGER]=t.RGBA32UI,a[oe.RGB_INTEGER]=t.RGB32UI,a[oe.RG_INTEGER]=t.RG32UI,a[oe.RED_INTEGER]=t.R32UI,a[oe.DEPTH_COMPONENT]=t.DEPTH_COMPONENT24,a),e[he.INT]=((o={})[oe.RGBA_INTEGER]=t.RGBA32I,o[oe.RGB_INTEGER]=t.RGB32I,o[oe.RG_INTEGER]=t.RG32I,o[oe.RED_INTEGER]=t.R32I,o),e[he.FLOAT]=((l={})[oe.RGBA]=t.RGBA32F,l[oe.RGB]=t.RGB32F,l[oe.RG]=t.RG32F,l[oe.RED]=t.R32F,l[oe.DEPTH_COMPONENT]=t.DEPTH_COMPONENT32F,l),e[he.HALF_FLOAT]=((h={})[oe.RGBA]=t.RGBA16F,h[oe.RGB]=t.RGB16F,h[oe.RG]=t.RG16F,h[oe.RED]=t.R16F,h),e[he.UNSIGNED_SHORT_5_6_5]=((u={})[oe.RGB]=t.RGB565,u),e[he.UNSIGNED_SHORT_4_4_4_4]=((c={})[oe.RGBA]=t.RGBA4,c),e[he.UNSIGNED_SHORT_5_5_5_1]=((d={})[oe.RGBA]=t.RGB5_A1,d),e[he.UNSIGNED_INT_2_10_10_10_REV]=((p={})[oe.RGBA]=t.RGB10_A2,p[oe.RGBA_INTEGER]=t.RGB10_A2UI,p),e[he.UNSIGNED_INT_10F_11F_11F_REV]=((f={})[oe.RGB]=t.R11F_G11F_B10F,f),e[he.UNSIGNED_INT_5_9_9_9_REV]=((m={})[oe.RGB]=t.RGB9_E5,m),e[he.UNSIGNED_INT_24_8]=((g={})[oe.DEPTH_STENCIL]=t.DEPTH24_STENCIL8,g),e[he.FLOAT_32_UNSIGNED_INT_24_8_REV]=((y={})[oe.DEPTH_STENCIL]=t.DEPTH32F_STENCIL8,y),T=e):((v={})[he.UNSIGNED_BYTE]=((x={})[oe.RGBA]=t.RGBA,x[oe.RGB]=t.RGB,x[oe.ALPHA]=t.ALPHA,x[oe.LUMINANCE]=t.LUMINANCE,x[oe.LUMINANCE_ALPHA]=t.LUMINANCE_ALPHA,x),v[he.UNSIGNED_SHORT_5_6_5]=((b={})[oe.RGB]=t.RGB,b),v[he.UNSIGNED_SHORT_4_4_4_4]=((w={})[oe.RGBA]=t.RGBA,w),v[he.UNSIGNED_SHORT_5_5_5_1]=((_={})[oe.RGBA]=t.RGBA,_),T=v),T}(t);var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(var n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};var r=new _s(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new _s(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(n=0;n<this.boundTextures.length;n++)this.bind(null,n)},t.prototype.bind=function(t,e){void 0===e&&(e=0);var n=this.gl;if((t=null==t?void 0:t.castToBaseTexture())&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;var r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId&&(this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),this.updateTexture(t)),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[e]=null},t.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},t.prototype.unbind=function(t){var e=this.gl,n=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var r=0;r<n.length;r++)n[r]===this.unknownTexture&&this.bind(null,r)}for(r=0;r<n.length;r++)n[r]===t&&(this.currentLocation!==r&&(e.activeTexture(e.TEXTURE0+r),this.currentLocation=r),e.bindTexture(t.target,this.emptyTextures[t.target].texture),n[r]=null)},t.prototype.ensureSamplerType=function(t){var e=this,n=e.boundTextures,r=e.hasIntegerTextures,i=e.CONTEXT_UID;if(r)for(var s=t-1;s>=0;--s){var a=n[s];if(a)a._glTextures[i].samplerType!==ue.FLOAT&&this.renderer.texture.unbind(a)}},t.prototype.initTexture=function(t){var e=new _s(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},t.prototype.initTextureType=function(t,e){var n,r;e.internalFormat=null!==(r=null===(n=this.internalFormats[t.type])||void 0===n?void 0:n[t.format])&&void 0!==r?r:t.format,2===this.webGLVersion&&t.type===he.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type},t.prototype.updateTexture=function(t){var e=t._glTextures[this.CONTEXT_UID];if(e){var n=this.renderer;if(this.initTextureType(t,e),t.resource&&t.resource.upload(n,t,e))e.samplerType!==ue.FLOAT&&(this.hasIntegerTextures=!0);else{var r=t.realWidth,i=t.realHeight,s=n.gl;(e.width!==r||e.height!==i||e.dirtyId<0)&&(e.width=r,e.height=i,s.texImage2D(t.target,0,e.internalFormat,r,i,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}},t.prototype.destroyTexture=function(t,e){var n=this.gl;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),n.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var r=this.managedTextures.indexOf(t);-1!==r&&Ke(this.managedTextures,r,1)}},t.prototype.updateTextureStyle=function(t){var e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==pe.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=t.mipmap>=1:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=de.CLAMP,t.resource&&t.resource.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)},t.prototype.setStyle=function(t,e){var n=this.gl;if(e.mipmap&&t.mipmap!==pe.ON_MANUAL&&n.generateMipmap(t.target),n.texParameteri(t.target,n.TEXTURE_WRAP_S,e.wrapMode),n.texParameteri(t.target,n.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===ce.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);var r=this.renderer.context.extensions.anisotropicFiltering;if(r&&t.anisotropicLevel>0&&t.scaleMode===ce.LINEAR){var i=Math.min(t.anisotropicLevel,n.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY_EXT,i)}}else n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===ce.LINEAR?n.LINEAR:n.NEAREST);n.texParameteri(t.target,n.TEXTURE_MAG_FILTER,t.scaleMode===ce.LINEAR?n.LINEAR:n.NEAREST)},t.prototype.destroy=function(){this.renderer=null},t}(),Es={__proto__:null,FilterSystem:di,BatchSystem:fi,ContextSystem:gi,FramebufferSystem:xi,GeometrySystem:wi,MaskSystem:Qi,ScissorSystem:ns,StencilSystem:rs,ProjectionSystem:is,RenderTextureSystem:os,ShaderSystem:xs,StateSystem:bs,TextureGCSystem:ws,TextureSystem:Ts},Ss=new In,Is=function(t){function e(e,n){void 0===e&&(e=re.UNKNOWN);var r=t.call(this)||this;return n=Object.assign({},we.RENDER_OPTIONS,n),r.options=n,r.type=e,r.screen=new xn(0,0,n.width,n.height),r.view=n.view||document.createElement("canvas"),r.resolution=n.resolution||we.RESOLUTION,r.useContextAlpha=n.useContextAlpha,r.autoDensity=!!n.autoDensity,r.preserveDrawingBuffer=n.preserveDrawingBuffer,r.clearBeforeRender=n.clearBeforeRender,r._backgroundColor=0,r._backgroundColorRgba=[0,0,0,1],r._backgroundColorString="#000000",r.backgroundColor=n.backgroundColor||r._backgroundColor,r.backgroundAlpha=n.backgroundAlpha,void 0!==n.transparent&&(en(0,"Option transparent is deprecated, please use backgroundAlpha instead."),r.useContextAlpha=n.transparent,r.backgroundAlpha=n.transparent?0:1),r._lastObjectRendered=null,r.plugins={},r}return Ir(e,t),e.prototype.initPlugins=function(t){for(var e in t)this.plugins[e]=new t[e](this)},Object.defineProperty(e.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,e){this.view.width=Math.round(t*this.resolution),this.view.height=Math.round(e*this.resolution);var n=this.view.width/this.resolution,r=this.view.height/this.resolution;this.screen.width=n,this.screen.height=r,this.autoDensity&&(this.view.style.width=n+"px",this.view.style.height=r+"px"),this.emit("resize",n,r)},e.prototype.generateTexture=function(t,e,n,r){void 0===e&&(e={}),"number"==typeof e&&(en(0,"generateTexture options (scaleMode, resolution, region) are now object options."),e={scaleMode:e,resolution:n,region:r});var i=e.region,s=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&(n[r[i]]=t[r[i]])}return n}(e,["region"]);0===(r=i||t.getLocalBounds(null,!0)).width&&(r.width=1),0===r.height&&(r.height=1);var a=qr.create(kr({width:r.width,height:r.height},s));return Ss.tx=-r.x,Ss.ty=-r.y,this.render(t,{renderTexture:a,clear:!1,transform:Ss,skipUpdateTransform:!!t.parent}),a},e.prototype.destroy=function(t){for(var e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null;t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var n=this;n.plugins=null,n.type=re.UNKNOWN,n.view=null,n.screen=null,n._tempDisplayObjectParent=null,n.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=De(t),Pe(t,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(t){this._backgroundColorRgba[3]=t},enumerable:!1,configurable:!0}),e}(Te()),ks=function(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0},Cs=function(){function t(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}return t.prototype.destroy=function(){this.renderer=null},t.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},t.prototype.bind=function(t){var e=this.gl,n=this.CONTEXT_UID,r=t._glBuffers[n]||this.createGLBuffer(t);e.bindBuffer(t.type,r.buffer)},t.prototype.bindBufferBase=function(t,e){var n=this.gl,r=this.CONTEXT_UID;if(this.boundBufferBases[e]!==t){var i=t._glBuffers[r]||this.createGLBuffer(t);this.boundBufferBases[e]=t,n.bindBufferBase(n.UNIFORM_BUFFER,e,i.buffer)}},t.prototype.bindBufferRange=function(t,e,n){var r=this.gl,i=this.CONTEXT_UID;n=n||0;var s=t._glBuffers[i]||this.createGLBuffer(t);r.bindBufferRange(r.UNIFORM_BUFFER,e||0,s.buffer,256*n,256)},t.prototype.update=function(t){var e=this.gl,n=this.CONTEXT_UID,r=t._glBuffers[n];if(t._updateID!==r.updateID)if(r.updateID=t._updateID,e.bindBuffer(t.type,r.buffer),r.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{var i=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;r.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,i)}},t.prototype.dispose=function(t,e){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var n=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),n&&(e||r.deleteBuffer(n.buffer),delete t._glBuffers[this.CONTEXT_UID])}},t.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedBuffers),n=0;n<e.length;n++)this.dispose(this.managedBuffers[e[n]],t)},t.prototype.createGLBuffer=function(t){var e=this.CONTEXT_UID,n=this.gl;return t._glBuffers[e]=new ks(n.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]},t}(),Ns=function(t){function e(n){var r=t.call(this,re.WEBGL,n)||this;return n=r.options,r.gl=null,r.CONTEXT_UID=0,r.runners={destroy:new _r("destroy"),contextChange:new _r("contextChange"),reset:new _r("reset"),update:new _r("update"),postrender:new _r("postrender"),prerender:new _r("prerender"),resize:new _r("resize")},r.runners.contextChange.add(r),r.globalUniforms=new li({projectionMatrix:new In},!0),r.addSystem(Qi,"mask").addSystem(gi,"context").addSystem(bs,"state").addSystem(xs,"shader").addSystem(Ts,"texture").addSystem(Cs,"buffer").addSystem(wi,"geometry").addSystem(xi,"framebuffer").addSystem(ns,"scissor").addSystem(rs,"stencil").addSystem(is,"projection").addSystem(ws,"textureGC").addSystem(di,"filter").addSystem(os,"renderTexture").addSystem(fi,"batch"),r.initPlugins(e.__plugins),r.multisample=void 0,n.context?r.context.initFromContext(n.context):r.context.initFromOptions({alpha:!!r.useContextAlpha,antialias:n.antialias,premultipliedAlpha:r.useContextAlpha&&"notMultiplied"!==r.useContextAlpha,stencil:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,powerPreference:r.options.powerPreference}),r.renderingToScreen=!0,Re(2===r.context.webGLVersion?"WebGL 2":"WebGL 1"),r.resize(r.options.width,r.options.height),r}return Ir(e,t),e.create=function(t){if(Me())return new e(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},e.prototype.contextChange=function(){var t,e=this.gl;if(1===this.context.webGLVersion){var n=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,n)}else{n=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,n)}t>=xe.HIGH?this.multisample=xe.HIGH:t>=xe.MEDIUM?this.multisample=xe.MEDIUM:t>=xe.LOW?this.multisample=xe.LOW:this.multisample=xe.NONE},e.prototype.addSystem=function(t,e){var n=new t(this);if(this[e])throw new Error('Whoops! The name "'+e+'" is already in use');for(var r in this[e]=n,this.runners)this.runners[r].add(n);return this},e.prototype.render=function(t,e){var n,r,i,s;if(e&&(e instanceof qr?(en(0,"Renderer#render arguments changed, use options instead."),n=e,r=arguments[2],i=arguments[3],s=arguments[4]):(n=e.renderTexture,r=e.clear,i=e.transform,s=e.skipUpdateTransform)),this.renderingToScreen=!n,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=i,!this.context.isLost){if(n||(this._lastObjectRendered=t),!s){var a=t.enableTempParent();t.updateTransform(),t.disableTempParent(a)}this.renderTexture.bind(n),this.batch.currentRenderer.start(),(void 0!==r?r:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),n&&n.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},e.prototype.generateTexture=function(e,n,r,i){void 0===n&&(n={});var s=t.prototype.generateTexture.call(this,e,n,r,i);return this.framebuffer.blit(),s},e.prototype.resize=function(e,n){t.prototype.resize.call(this,e,n),this.runners.resize.emit(this.screen.height,this.screen.width)},e.prototype.reset=function(){return this.runners.reset.emit(),this},e.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},e.prototype.destroy=function(e){for(var n in this.runners.destroy.emit(),this.runners)this.runners[n].destroy();t.prototype.destroy.call(this,e),this.gl=null},Object.defineProperty(e.prototype,"extract",{get:function(){return en(0,"Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),e.registerPlugin=function(t,n){e.__plugins=e.__plugins||{},e.__plugins[t]=n},e}(Is);function As(t){return Ns.create(t)}var Rs="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",Ms="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",Os=function(){function t(t){en(0,"System class is deprecated, implemement ISystem interface instead."),this.renderer=t}return t.prototype.destroy=function(){this.renderer=null},t}(),Ps=function(){this.texArray=null,this.blend=0,this.type=ae.TRIANGLES,this.start=0,this.size=0,this.data=null},Ds=function(){function t(){this.elements=[],this.ids=[],this.count=0}return t.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0},t}(),Fs=function(){function t(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(t.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),t.prototype.view=function(t){return this[t+"View"]},t.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},t.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},t}(),Ls=function(t){function e(e){var n=t.call(this,e)||this;return n.shaderGenerator=null,n.geometryClass=null,n.vertexSize=null,n.state=ji.for2d(),n.size=4*we.SPRITE_BATCH_SIZE,n._vertexCount=0,n._indexCount=0,n._bufferedElements=[],n._bufferedTextures=[],n._bufferSize=0,n._shader=null,n._packedGeometries=[],n._packedGeometryPoolSize=2,n._flushId=0,n._aBuffers={},n._iBuffers={},n.MAX_TEXTURES=1,n.renderer.on("prerender",n.onPrerender,n),e.runners.contextChange.add(n),n._dcIndex=0,n._aIndex=0,n._iIndex=0,n._attributeBuffer=null,n._indexBuffer=null,n._tempBoundTextures=[],n}return Ir(e,t),e.prototype.contextChange=function(){var t=this.renderer.gl;we.PREFER_ENV===ne.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),we.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=Gi(this.MAX_TEXTURES,t)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()},e.prototype.initFlushBuffers=function(){for(var t=e._drawCallPool,n=e._textureArrayPool,r=this.size/4,i=Math.floor(r/this.MAX_TEXTURES)+1;t.length<r;)t.push(new Ps);for(;n.length<i;)n.push(new Ds);for(var s=0;s<this.MAX_TEXTURES;s++)this._tempBoundTextures[s]=null},e.prototype.onPrerender=function(){this._flushId=0},e.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},e.prototype.buildTexturesAndDrawCalls=function(){var t=this._bufferedTextures,n=this.MAX_TEXTURES,r=e._textureArrayPool,i=this.renderer.batch,s=this._tempBoundTextures,a=this.renderer.textureGC.count,o=++Rr._globalBatch,l=0,h=r[0],u=0;i.copyBoundTextures(s,n);for(var c=0;c<this._bufferSize;++c){var d=t[c];t[c]=null,d._batchEnabled!==o&&(h.count>=n&&(i.boundArray(h,s,o,n),this.buildDrawCalls(h,u,c),u=c,h=r[++l],++o),d._batchEnabled=o,d.touched=a,h.elements[h.count++]=d)}h.count>0&&(i.boundArray(h,s,o,n),this.buildDrawCalls(h,u,this._bufferSize),++l,++o);for(c=0;c<s.length;c++)s[c]=null;Rr._globalBatch=o},e.prototype.buildDrawCalls=function(t,n,r){var i=this,s=i._bufferedElements,a=i._attributeBuffer,o=i._indexBuffer,l=i.vertexSize,h=e._drawCallPool,u=this._dcIndex,c=this._aIndex,d=this._iIndex,p=h[u];p.start=this._iIndex,p.texArray=t;for(var f=n;f<r;++f){var m=s[f],g=m._texture.baseTexture,y=Be[g.alphaMode?1:0][m.blendMode];s[f]=null,n<f&&p.blend!==y&&(p.size=d-p.start,n=f,(p=h[++u]).texArray=t,p.start=d),this.packInterleavedGeometry(m,a,o,c,d),c+=m.vertexData.length/2*l,d+=m.indices.length,p.blend=y}n<r&&(p.size=d-p.start,++u),this._dcIndex=u,this._aIndex=c,this._iIndex=d},e.prototype.bindAndClearTexArray=function(t){for(var e=this.renderer.texture,n=0;n<t.count;n++)e.bind(t.elements[n],t.ids[n]),t.elements[n]=null;t.count=0},e.prototype.updateGeometry=function(){var t=this,e=t._packedGeometries,n=t._attributeBuffer,r=t._indexBuffer;we.CAN_UPLOAD_SAME_BUFFER?(e[this._flushId]._buffer.update(n.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(n.rawBinaryData),e[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},e.prototype.drawBatches=function(){for(var t=this._dcIndex,n=this.renderer,r=n.gl,i=n.state,s=e._drawCallPool,a=null,o=0;o<t;o++){var l=s[o],h=l.texArray,u=l.type,c=l.size,d=l.start,p=l.blend;a!==h&&(a=h,this.bindAndClearTexArray(h)),this.state.blendMode=p,i.set(this.state),r.drawElements(u,c,r.UNSIGNED_SHORT,2*d)}},e.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},e.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),we.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),t.prototype.destroy.call(this)},e.prototype.getAttributeBuffer=function(t){var e=Ye(Math.ceil(t/8)),n=qe(e),r=8*e;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);var i=this._aBuffers[r];return i||(this._aBuffers[r]=i=new Fs(r*this.vertexSize*4)),i},e.prototype.getIndexBuffer=function(t){var e=Ye(Math.ceil(t/12)),n=qe(e),r=12*e;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);var i=this._iBuffers[n];return i||(this._iBuffers[n]=i=new Uint16Array(r)),i},e.prototype.packInterleavedGeometry=function(t,e,n,r,i){for(var s=e.uint32View,a=e.float32View,o=r/this.vertexSize,l=t.uvs,h=t.indices,u=t.vertexData,c=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),p=d<1&&t._texture.baseTexture.alphaMode?Ve(t._tintRGB,d):t._tintRGB+(255*d<<24),f=0;f<u.length;f+=2)a[r++]=u[f],a[r++]=u[f+1],a[r++]=l[f],a[r++]=l[f+1],s[r++]=p,a[r++]=c;for(f=0;f<h.length;f++)n[i++]=o+h[f]},e._drawCallPool=[],e._textureArrayPool=[],e}(pi),Bs=function(){function t(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return t.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),n=0;n<t;n++)e[n]=n;this.defaultGroupCache[t]=li.from({uSamplers:e},!0);var r=this.fragTemplate;r=(r=r.replace(/%count%/gi,""+t)).replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Hi(this.vertexSrc,r)}var i={tint:new Float32Array([1,1,1,1]),translationMatrix:new In,default:this.defaultGroupCache[t]};return new Yi(this.programCache[t],i)},t.prototype.generateSampleSrc=function(t){var e="";e+="\n",e+="\n";for(var n=0;n<t;n++)n>0&&(e+="\nelse "),n<t-1&&(e+="if(vTextureId < "+n+".5)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+n+"], vTextureCoord);",e+="\n}";return e+="\n",e+="\n"},t}(),$s=function(t){function e(e){void 0===e&&(e=!1);var n=t.call(this)||this;return n._buffer=new Qr(null,e,!1),n._indexBuffer=new Qr(null,e,!0),n.addAttribute("aVertexPosition",n._buffer,2,!1,he.FLOAT).addAttribute("aTextureCoord",n._buffer,2,!1,he.FLOAT).addAttribute("aColor",n._buffer,4,!0,he.UNSIGNED_BYTE).addAttribute("aTextureId",n._buffer,1,!0,he.FLOAT).addIndex(n._indexBuffer),n}return Ir(e,t),e}(ii),Us="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",Vs="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",zs=function(){function t(){}return t.create=function(t){var e=Object.assign({vertex:Us,fragment:Vs,geometryClass:$s,vertexSize:6},t),n=e.vertex,r=e.fragment,i=e.vertexSize,s=e.geometryClass;return function(t){function e(e){var a=t.call(this,e)||this;return a.shaderGenerator=new Bs(n,r),a.geometryClass=s,a.vertexSize=i,a}return Ir(e,t),e}(Ls)},Object.defineProperty(t,"defaultVertexSrc",{get:function(){return Us},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentTemplate",{get:function(){return Vs},enumerable:!1,configurable:!0}),t}(),Gs=zs.create(),Ws={},Xs=function(t){Object.defineProperty(Ws,t,{get:function(){return en(0,"PIXI.systems."+t+" has moved to PIXI."+t),Vr[t]}})};for(var Hs in Vr)Xs(Hs);var Ys={},js=function(t){Object.defineProperty(Ys,t,{get:function(){return en(0,"PIXI.resources."+t+" has moved to PIXI."+t),Es[t]}})};for(var Hs in Es)js(Hs);var qs=function(){function t(e){var n=this;this.stage=new or,e=Object.assign({forceCanvas:!1},e),this.renderer=As(e),t._plugins.forEach((function(t){t.init.call(n,e)}))}return t.registerPlugin=function(e){t._plugins.push(e)},t.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(t.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),t.prototype.destroy=function(e,n){var r=this,i=t._plugins.slice(0);i.reverse(),i.forEach((function(t){t.destroy.call(r)})),this.stage.destroy(n),this.stage=null,this.renderer.destroy(e),this.renderer=null},t._plugins=[],t}(),Ks=function(){function t(){}return t.init=function(t){var e=this;Object.defineProperty(this,"resizeTo",{set:function(t){self.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(self.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){e._resizeTo&&(e.cancelResize(),e._resizeId=requestAnimationFrame((function(){return e.resize()})))},this.cancelResize=function(){e._resizeId&&(cancelAnimationFrame(e._resizeId),e._resizeId=null)},this.resize=function(){if(e._resizeTo){var t,n;if(e.cancelResize(),e._resizeTo===self)t=self.innerWidth,n=self.innerHeight;else{var r=e._resizeTo;t=r.clientWidth,n=r.clientHeight}e.renderer.resize(t,n)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null},t.destroy=function(){self.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},t}();qs.registerPlugin(Ks);var Zs=new xn,Js=function(){function t(t){this.renderer=t}return t.prototype.image=function(t,e,n){var r=new Image;return r.src=this.base64(t,e,n),r},t.prototype.base64=function(t,e,n){return this.canvas(t).toDataURL(e,n)},t.prototype.canvas=function(e){var n,r,i,s=this.renderer,a=!1,o=!1;e&&(e instanceof qr?i=e:(i=this.renderer.generateTexture(e),o=!0)),i?(n=i.baseTexture.resolution,r=i.frame,a=!1,s.renderTexture.bind(i)):(n=this.renderer.resolution,a=!0,(r=Zs).width=this.renderer.width,r.height=this.renderer.height,s.renderTexture.bind(null));var l=Math.floor(r.width*n+1e-4),h=Math.floor(r.height*n+1e-4),u=new ln(l,h,1),c=new Uint8Array(4*l*h),d=s.gl;d.readPixels(r.x*n,r.y*n,l,h,d.RGBA,d.UNSIGNED_BYTE,c);var p=u.context.getImageData(0,0,l,h);if(t.arrayPostDivide(c,p.data),u.context.putImageData(p,0,0),a){var f=new ln(u.width,u.height,1);f.context.scale(1,-1),f.context.drawImage(u.canvas,0,-h),u.destroy(),u=f}return o&&i.destroy(!0),u.canvas},t.prototype.pixels=function(e){var n,r,i,s=this.renderer,a=!1;e&&(e instanceof qr?i=e:(i=this.renderer.generateTexture(e),a=!0)),i?(n=i.baseTexture.resolution,r=i.frame,s.renderTexture.bind(i)):(n=s.resolution,(r=Zs).width=s.width,r.height=s.height,s.renderTexture.bind(null));var o=r.width*n,l=r.height*n,h=new Uint8Array(4*o*l),u=s.gl;return u.readPixels(r.x*n,r.y*n,o,l,u.RGBA,u.UNSIGNED_BYTE,h),a&&i.destroy(!0),t.arrayPostDivide(h,h),h},t.prototype.destroy=function(){this.renderer=null},t.arrayPostDivide=function(t,e){for(var n=0;n<t.length;n+=4){var r=e[n+3]=t[n+3];0!==r?(e[n]=Math.round(Math.min(255*t[n]/r,255)),e[n+1]=Math.round(Math.min(255*t[n+1]/r,255)),e[n+2]=Math.round(Math.min(255*t[n+2]/r,255))):(e[n]=t[n],e[n+1]=t[n+1],e[n+2]=t[n+2])}},t}(),Qs=function(){function t(t,e,n){void 0===e&&(e=!1),this._fn=t,this._once=e,this._thisArg=n,this._next=this._prev=this._owner=null}return t.prototype.detach=function(){return null!==this._owner&&(this._owner.detach(this),!0)},t}();function ta(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}var ea=function(){function t(){this._head=this._tail=void 0}return t.prototype.handlers=function(t){void 0===t&&(t=!1);var e=this._head;if(t)return!!e;for(var n=[];e;)n.push(e),e=e._next;return n},t.prototype.has=function(t){if(!(t instanceof Qs))throw new Error("MiniSignal#has(): First arg must be a SignalBinding object.");return t._owner===this},t.prototype.dispatch=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];var r=this._head;if(!r)return!1;for(;r;)r._once&&this.detach(r),r._fn.apply(r._thisArg,e),r=r._next;return!0},t.prototype.add=function(t,e){if(void 0===e&&(e=null),"function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return ta(this,new Qs(t,!1,e))},t.prototype.once=function(t,e){if(void 0===e&&(e=null),"function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return ta(this,new Qs(t,!0,e))},t.prototype.detach=function(t){if(!(t instanceof Qs))throw new Error("MiniSignal#detach(): First arg must be a SignalBinding object.");return t._owner!==this||(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null),this},t.prototype.detachAll=function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this},t}();function na(t,e){e=e||{};for(var n={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},r=n.parser[e.strictMode?"strict":"loose"].exec(t),i={},s=14;s--;)i[n.key[s]]=r[s]||"";return i[n.q.name]={},i[n.key[12]].replace(n.q.parser,(function(t,e,r){e&&(i[n.q.name][e]=r)})),i}var ra=!(!self.XDomainRequest||"withCredentials"in new XMLHttpRequest),ia=null;function sa(){}function aa(t,e,n){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=n)}function oa(t){return t.toString().replace("object ","")}var la=function(){function t(e,n,r){if(this._dequeue=sa,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=null,this._boundOnError=null,this._boundOnProgress=null,this._boundOnTimeout=null,this._boundXhrOnError=null,this._boundXhrOnTimeout=null,this._boundXhrOnAbort=null,this._boundXhrOnLoad=null,"string"!=typeof e||"string"!=typeof n)throw new Error("Both name and url are required for constructing a resource.");r=r||{},this._flags=0,this._setFlag(t.STATUS_FLAGS.DATA_URL,0===n.indexOf("data:")),this.name=e,this.url=n,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===r.crossOrigin?"anonymous":r.crossOrigin,this.timeout=r.timeout||0,this.loadType=r.loadType||this._determineLoadType(),this.xhrType=r.xhrType,this.metadata=r.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=t.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=sa,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new ea,this.onProgress=new ea,this.onComplete=new ea,this.onAfterMiddleware=new ea}return t.setExtensionLoadType=function(e,n){aa(t._loadTypeMap,e,n)},t.setExtensionXhrType=function(e,n){aa(t._xhrTypeMap,e,n)},Object.defineProperty(t.prototype,"isDataUrl",{get:function(){return this._hasFlag(t.STATUS_FLAGS.DATA_URL)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isComplete",{get:function(){return this._hasFlag(t.STATUS_FLAGS.COMPLETE)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._hasFlag(t.STATUS_FLAGS.LOADING)},enumerable:!1,configurable:!0}),t.prototype.complete=function(){this._clearEvents(),this._finish()},t.prototype.abort=function(e){if(!this.error){if(this.error=new Error(e),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=t.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},t.prototype.load=function(e){var n=this;if(!this.isLoading)if(this.isComplete)e&&setTimeout((function(){return e(n)}),1);else switch(e&&this.onComplete.once(e),this._setFlag(t.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case t.LOAD_TYPE.IMAGE:this.type=t.TYPE.IMAGE,this._loadElement("image");break;case t.LOAD_TYPE.AUDIO:this.type=t.TYPE.AUDIO,this._loadSourceElement("audio");break;case t.LOAD_TYPE.VIDEO:this.type=t.TYPE.VIDEO,this._loadSourceElement("video");break;case t.LOAD_TYPE.XHR:default:ra&&this.crossOrigin?this._loadXdr():this._loadXhr()}},t.prototype._hasFlag=function(t){return 0!=(this._flags&t)},t.prototype._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},t.prototype._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},t.prototype._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(t.STATUS_FLAGS.COMPLETE,!0),this._setFlag(t.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},t.prototype._loadElement=function(t){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===t&&void 0!==self.Image?this.data=new Image:this.data=document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},t.prototype._loadSourceElement=function(t){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===t&&void 0!==self.Audio?this.data=new Audio:this.data=document.createElement(t),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,n=0;n<this.url.length;++n)this.data.appendChild(this._createSource(t,this.url[n],Array.isArray(e)?e[n]:e));else{e=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(e)?e[0]:e))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+t)},t.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),e.timeout=this.timeout,this.xhrType===t.XHR_RESPONSE_TYPE.JSON||this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT?e.responseType=t.XHR_RESPONSE_TYPE.TEXT:e.responseType=this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("timeout",this._boundXhrOnTimeout,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},t.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new self.XDomainRequest;t.timeout=this.timeout||5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXhrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout((function(){return t.send()}),1)},t.prototype._createSource=function(t,e,n){n||(n=t+"/"+this._getExtension(e));var r=document.createElement("source");return r.src=e,r.type=n,r},t.prototype._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},t.prototype._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},t.prototype._onTimeout=function(){this.abort("Load timed out.")},t.prototype._xhrOnError=function(){var t=this.xhr;this.abort(oa(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},t.prototype._xhrOnTimeout=function(){var t=this.xhr;this.abort(oa(t)+" Request timed out.")},t.prototype._xhrOnAbort=function(){var t=this.xhr;this.abort(oa(t)+" Request was aborted by the user.")},t.prototype._xhrOnLoad=function(){var e=this.xhr,n="",r=void 0===e.status?200:e.status;if(""!==e.responseType&&"text"!==e.responseType&&void 0!==e.responseType||(n=e.responseText),0===r&&(n.length>0||e.responseType===t.XHR_RESPONSE_TYPE.BUFFER)?r=200:1223===r&&(r=204),2===(r/100|0)){if(this.xhrType===t.XHR_RESPONSE_TYPE.TEXT)this.data=n,this.type=t.TYPE.TEXT;else if(this.xhrType===t.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(n),this.type=t.TYPE.JSON}catch(t){return void this.abort("Error trying to parse loaded json: "+t)}else if(this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT)try{if(self.DOMParser){var i=new DOMParser;this.data=i.parseFromString(n,"text/xml")}else{var s=document.createElement("div");s.innerHTML=n,this.data=s}this.type=t.TYPE.XML}catch(t){return void this.abort("Error trying to parse loaded xml: "+t)}else this.data=e.response||n;this.complete()}else this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL)},t.prototype._determineCrossOrigin=function(t,e){if(0===t.indexOf("data:"))return"";if(self.origin!==self.location.origin)return"anonymous";e=e||self.location,ia||(ia=document.createElement("a")),ia.href=t;var n=na(ia.href,{strictMode:!0}),r=!n.port&&""===e.port||n.port===e.port,i=n.protocol?n.protocol+":":"";return n.host===e.hostname&&r&&i===e.protocol?"":"anonymous"},t.prototype._determineXhrType=function(){return t._xhrTypeMap[this.extension]||t.XHR_RESPONSE_TYPE.TEXT},t.prototype._determineLoadType=function(){return t._loadTypeMap[this.extension]||t.LOAD_TYPE.XHR},t.prototype._getExtension=function(t){void 0===t&&(t=this.url);var e="";if(this.isDataUrl){var n=t.indexOf("/");e=t.substring(n+1,t.indexOf(";",n))}else{var r=t.indexOf("?"),i=t.indexOf("#"),s=Math.min(r>-1?r:t.length,i>-1?i:t.length);e=(t=t.substring(0,s)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},t.prototype._getMimeFromXhrType=function(e){switch(e){case t.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case t.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case t.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case t.XHR_RESPONSE_TYPE.JSON:return"application/json";case t.XHR_RESPONSE_TYPE.DEFAULT:case t.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},t}();function ha(){}function ua(t){return function(){for(var e=arguments,n=[],r=0;r<arguments.length;r++)n[r]=e[r];if(null===t)throw new Error("Callback was already called.");var i=t;t=null,i.apply(this,n)}}!function(t){!function(t){t[t.NONE=0]="NONE",t[t.DATA_URL=1]="DATA_URL",t[t.COMPLETE=2]="COMPLETE",t[t.LOADING=4]="LOADING"}(t.STATUS_FLAGS||(t.STATUS_FLAGS={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.JSON=1]="JSON",t[t.XML=2]="XML",t[t.IMAGE=3]="IMAGE",t[t.AUDIO=4]="AUDIO",t[t.VIDEO=5]="VIDEO",t[t.TEXT=6]="TEXT"}(t.TYPE||(t.TYPE={})),function(t){t[t.XHR=1]="XHR",t[t.IMAGE=2]="IMAGE",t[t.AUDIO=3]="AUDIO",t[t.VIDEO=4]="VIDEO"}(t.LOAD_TYPE||(t.LOAD_TYPE={})),function(t){t.DEFAULT="text",t.BUFFER="arraybuffer",t.BLOB="blob",t.DOCUMENT="document",t.JSON="json",t.TEXT="text"}(t.XHR_RESPONSE_TYPE||(t.XHR_RESPONSE_TYPE={})),t._loadTypeMap={gif:t.LOAD_TYPE.IMAGE,png:t.LOAD_TYPE.IMAGE,bmp:t.LOAD_TYPE.IMAGE,jpg:t.LOAD_TYPE.IMAGE,jpeg:t.LOAD_TYPE.IMAGE,tif:t.LOAD_TYPE.IMAGE,tiff:t.LOAD_TYPE.IMAGE,webp:t.LOAD_TYPE.IMAGE,tga:t.LOAD_TYPE.IMAGE,svg:t.LOAD_TYPE.IMAGE,"svg+xml":t.LOAD_TYPE.IMAGE,mp3:t.LOAD_TYPE.AUDIO,ogg:t.LOAD_TYPE.AUDIO,wav:t.LOAD_TYPE.AUDIO,mp4:t.LOAD_TYPE.VIDEO,webm:t.LOAD_TYPE.VIDEO},t._xhrTypeMap={xhtml:t.XHR_RESPONSE_TYPE.DOCUMENT,html:t.XHR_RESPONSE_TYPE.DOCUMENT,htm:t.XHR_RESPONSE_TYPE.DOCUMENT,xml:t.XHR_RESPONSE_TYPE.DOCUMENT,tmx:t.XHR_RESPONSE_TYPE.DOCUMENT,svg:t.XHR_RESPONSE_TYPE.DOCUMENT,tsx:t.XHR_RESPONSE_TYPE.DOCUMENT,gif:t.XHR_RESPONSE_TYPE.BLOB,png:t.XHR_RESPONSE_TYPE.BLOB,bmp:t.XHR_RESPONSE_TYPE.BLOB,jpg:t.XHR_RESPONSE_TYPE.BLOB,jpeg:t.XHR_RESPONSE_TYPE.BLOB,tif:t.XHR_RESPONSE_TYPE.BLOB,tiff:t.XHR_RESPONSE_TYPE.BLOB,webp:t.XHR_RESPONSE_TYPE.BLOB,tga:t.XHR_RESPONSE_TYPE.BLOB,json:t.XHR_RESPONSE_TYPE.JSON,text:t.XHR_RESPONSE_TYPE.TEXT,txt:t.XHR_RESPONSE_TYPE.TEXT,ttf:t.XHR_RESPONSE_TYPE.BUFFER,otf:t.XHR_RESPONSE_TYPE.BUFFER},t.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="}(la||(la={}));var ca=function(t,e){this.data=t,this.callback=e},da=function(){function t(t,e){var n=this;if(void 0===e&&(e=1),this.workers=0,this.saturated=ha,this.unsaturated=ha,this.empty=ha,this.drain=ha,this.error=ha,this.started=!1,this.paused=!1,this._tasks=[],this._insert=function(t,e,r){if(r&&"function"!=typeof r)throw new Error("task callback must be a function");if(n.started=!0,null==t&&n.idle())setTimeout((function(){return n.drain()}),1);else{var i=new ca(t,"function"==typeof r?r:ha);e?n._tasks.unshift(i):n._tasks.push(i),setTimeout(n.process,1)}},this.process=function(){for(;!n.paused&&n.workers<n.concurrency&&n._tasks.length;){var t=n._tasks.shift();0===n._tasks.length&&n.empty(),n.workers+=1,n.workers===n.concurrency&&n.saturated(),n._worker(t.data,ua(n._next(t)))}},this._worker=t,0===e)throw new Error("Concurrency must not be zero");this.concurrency=e,this.buffer=e/4}return t.prototype._next=function(t){var e=this;return function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];e.workers-=1,t.callback.apply(t,r),null!=r[0]&&e.error(r[0],t.data),e.workers<=e.concurrency-e.buffer&&e.unsaturated(),e.idle()&&e.drain(),e.process()}},t.prototype.push=function(t,e){this._insert(t,!1,e)},t.prototype.kill=function(){this.workers=0,this.drain=ha,this.started=!1,this._tasks=[]},t.prototype.unshift=function(t,e){this._insert(t,!0,e)},t.prototype.length=function(){return this._tasks.length},t.prototype.running=function(){return this.workers},t.prototype.idle=function(){return this._tasks.length+this.workers===0},t.prototype.pause=function(){!0!==this.paused&&(this.paused=!0)},t.prototype.resume=function(){if(!1!==this.paused){this.paused=!1;for(var t=1;t<=this.concurrency;t++)this.process()}},t.eachSeries=function(t,e,n,r){var i=0,s=t.length;!function a(o){o||i===s?n&&n(o):r?setTimeout((function(){e(t[i++],a)}),1):e(t[i++],a)}()},t.queue=function(e,n){return new t(e,n)},t}(),pa=/(#[\w-]+)?$/,fa=function(){function t(e,n){var r=this;void 0===e&&(e=""),void 0===n&&(n=10),this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,e){return r._loadResource(t,e)},this.resources={},this.baseUrl=e,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,e){return r._loadResource(t,e)},this._queue=da.queue(this._boundLoadResource,n),this._queue.pause(),this.resources={},this.onProgress=new ea,this.onError=new ea,this.onLoad=new ea,this.onStart=new ea,this.onComplete=new ea;for(var i=0;i<t._plugins.length;++i){var s=t._plugins[i],a=s.pre,o=s.use;a&&this.pre(a),o&&this.use(o)}this._protected=!1}return t.prototype._add=function(t,e,n,r){if(this.loading&&(!n||!n.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(e=this._prepareUrl(e),this.resources[t]=new la(t,e,n),"function"==typeof r&&this.resources[t].onAfterMiddleware.once(r),this.loading){for(var i=n.parentResource,s=[],a=0;a<i.children.length;++a)i.children[a].isComplete||s.push(i.children[a]);var o=i.progressChunk*(s.length+1)/(s.length+2);i.children.push(this.resources[t]),i.progressChunk=o;for(a=0;a<s.length;++a)s[a].progressChunk=o;this.resources[t].progressChunk=o}return this._queue.push(this.resources[t]),this},t.prototype.pre=function(t){return this._beforeMiddleware.push(t),this},t.prototype.use=function(t){return this._afterMiddleware.push(t),this},t.prototype.reset=function(){for(var t in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var e=this.resources[t];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort("loader reset")}return this.resources={},this},t.prototype.load=function(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=100/this._queue._tasks.length,n=0;n<this._queue._tasks.length;++n)this._queue._tasks[n].data.progressChunk=e;this._onStart(),this._queue.resume()}return this},Object.defineProperty(t.prototype,"concurrency",{get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t},enumerable:!1,configurable:!0}),t.prototype._prepareUrl=function(t){var e,n=na(t,{strictMode:!0});if(e=n.protocol||!n.path||0===t.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t,this.defaultQueryString){var r=pa.exec(e)[0];-1!==(e=e.substr(0,e.length-r.length)).indexOf("?")?e+="&"+this.defaultQueryString:e+="?"+this.defaultQueryString,e+=r}return e},t.prototype._loadResource=function(t,e){var n=this;t._dequeue=e,da.eachSeries(this._beforeMiddleware,(function(e,r){e.call(n,t,(function(){r(t.isComplete?{}:null)}))}),(function(){t.isComplete?n._onLoad(t):(t._onLoadBinding=t.onComplete.once(n._onLoad,n),t.load())}),!0)},t.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},t.prototype._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},t.prototype._onLoad=function(t){var e=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),da.eachSeries(this._afterMiddleware,(function(n,r){n.call(e,t,r)}),(function(){t.onAfterMiddleware.dispatch(t),e.progress=Math.min(100,e.progress+t.progressChunk),e.onProgress.dispatch(e,t),t.error?e.onError.dispatch(t.error,e,t):e.onLoad.dispatch(e,t),e._resourcesParsing.splice(e._resourcesParsing.indexOf(t),1),e._queue.idle()&&0===e._resourcesParsing.length&&e._onComplete()}),!0)},t.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(t,"shared",{get:function(){var e=t._shared;return e||((e=new t)._protected=!0,t._shared=e),e},enumerable:!1,configurable:!0}),t.registerPlugin=function(e){return t._plugins.push(e),e.add&&e.add(),t},t._plugins=[],t}();fa.prototype.add=function(t,e,n,r){if(Array.isArray(t)){for(var i=0;i<t.length;++i)this.add(t[i]);return this}if("object"==typeof t&&(n=t,r=e||n.callback||n.onComplete,e=n.url,t=n.name||n.key||n.url),"string"!=typeof e&&(r=n,n=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");return"function"==typeof n&&(r=n,n=null),this._add(t,e,n,r)};var ma=function(){function t(){}return t.init=function(t){t=Object.assign({sharedLoader:!1},t),this.loader=t.sharedLoader?fa.shared:new fa},t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t}(),ga=function(){function t(){}return t.add=function(){la.setExtensionLoadType("svg",la.LOAD_TYPE.XHR),la.setExtensionXhrType("svg",la.XHR_RESPONSE_TYPE.TEXT)},t.use=function(t,e){if(!t.data||t.type!==la.TYPE.IMAGE&&"svg"!==t.extension)e();else{var n=t.data,r=t.url,i=t.name,s=t.metadata;Yr.fromLoader(n,r,i,s).then((function(n){t.texture=n,e()})).catch(e)}},t}();var ya,va,xa=self.URL||self.webkitURL;fa.registerPlugin({use:function(t,e){if(t.data){if(t.xhr&&t.xhrType===la.XHR_RESPONSE_TYPE.BLOB)if(self.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var n=xa.createObjectURL(t.data);return t.blob=t.data,t.data=new Image,t.data.src=n,t.type=la.TYPE.IMAGE,void(t.data.onload=function(){xa.revokeObjectURL(n),t.data.onload=null,e()})}}else{var r=t.xhr.getResponseHeader("content-type");if(r&&0===r.indexOf("image"))return t.data=new Image,t.data.src="data:"+r+";base64,"+function(t){for(var e="",n=0;n<t.length;){for(var r=[0,0,0],i=[0,0,0,0],s=0;s<r.length;++s)n<t.length?r[s]=255&t.charCodeAt(n++):r[s]=0;switch(i[0]=r[0]>>2,i[1]=(3&r[0])<<4|r[1]>>4,i[2]=(15&r[1])<<2|r[2]>>6,i[3]=63&r[2],n-(t.length-1)){case 2:i[3]=64,i[2]=64;break;case 1:i[3]=64}for(s=0;s<i.length;++s)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(i[s])}return e}(t.xhr.responseText),t.type=la.TYPE.IMAGE,void(t.data.onload=function(){t.data.onload=null,e()})}e()}else e()}}),fa.registerPlugin(ga),function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL"}(va||(va={}));var ba=((ya={})[va.COMPRESSED_RGB_S3TC_DXT1_EXT]=.5,ya[va.COMPRESSED_RGBA_S3TC_DXT1_EXT]=.5,ya[va.COMPRESSED_RGBA_S3TC_DXT3_EXT]=1,ya[va.COMPRESSED_RGBA_S3TC_DXT5_EXT]=1,ya[va.COMPRESSED_SRGB_S3TC_DXT1_EXT]=.5,ya[va.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]=.5,ya[va.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]=1,ya[va.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]=1,ya[va.COMPRESSED_R11_EAC]=.5,ya[va.COMPRESSED_SIGNED_R11_EAC]=.5,ya[va.COMPRESSED_RG11_EAC]=1,ya[va.COMPRESSED_SIGNED_RG11_EAC]=1,ya[va.COMPRESSED_RGB8_ETC2]=.5,ya[va.COMPRESSED_RGBA8_ETC2_EAC]=1,ya[va.COMPRESSED_SRGB8_ETC2]=.5,ya[va.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]=1,ya[va.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,ya[va.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,ya[va.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=.5,ya[va.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=.5,ya[va.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=.25,ya[va.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=.25,ya[va.COMPRESSED_RGB_ETC1_WEBGL]=.5,ya[va.COMPRESSED_RGB_ATC_WEBGL]=.5,ya[va.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]=1,ya[va.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]=1,ya),wa=function(t,e){return wa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},wa(t,e)};function _a(t,e){function n(){this.constructor=t}wa(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function Ta(t,e){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}}var Ea,Sa,Ia=function(t){function e(e,n){void 0===n&&(n={width:1,height:1,autoLoad:!0});var r,i,s=this;return"string"==typeof e?(r=e,i=new Uint8Array):(r=null,i=e),(s=t.call(this,i,n)||this).origin=r,s.buffer=i?new Fs(i):null,s.origin&&!1!==n.autoLoad&&s.load(),i&&i.length&&(s.loaded=!0,s.onBlobLoaded(s.buffer.rawBinaryData)),s}return _a(e,t),e.prototype.onBlobLoaded=function(t){},e.prototype.load=function(){return function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function a(t){try{l(r.next(t))}catch(t){s(t)}}function o(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,o)}l((r=r.apply(t,e||[])).next())}))}(this,void 0,Promise,(function(){var t;return Ta(this,(function(e){switch(e.label){case 0:return[4,fetch(this.origin)];case 1:return[4,e.sent().blob()];case 2:return[4,e.sent().arrayBuffer()];case 3:return t=e.sent(),this.data=new Uint32Array(t),this.buffer=new Fs(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),[2,this]}}))}))},e}(Nr),ka=function(t){function e(n,r){var i=t.call(this,n,r)||this;return i.format=r.format,i.levels=r.levels||1,i._width=r.width,i._height=r.height,i._extension=e._formatToExtension(i.format),(r.levelBuffers||i.buffer)&&(i._levelBuffers=r.levelBuffers||e._createLevelBuffers(n instanceof Uint8Array?n:i.buffer.uint8View,i.format,i.levels,4,4,i.width,i.height)),i}return _a(e,t),e.prototype.upload=function(t,e,n){var r=t.gl;if(!t.context.extensions[this._extension])throw new Error(this._extension+" textures are not supported on the current machine");if(!this._levelBuffers)return!1;for(var i=0,s=this.levels;i<s;i++){var a=this._levelBuffers[i],o=a.levelID,l=a.levelWidth,h=a.levelHeight,u=a.levelBuffer;r.compressedTexImage2D(r.TEXTURE_2D,o,this.format,l,h,0,u)}return!0},e.prototype.onBlobLoaded=function(){this._levelBuffers=e._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)},e._formatToExtension=function(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")},e._createLevelBuffers=function(t,e,n,r,i,s,a){for(var o=new Array(n),l=t.byteOffset,h=s,u=a,c=h+r-1&~(r-1),d=u+i-1&~(i-1),p=c*d*ba[e],f=0;f<n;f++)o[f]={levelID:f,levelWidth:n>1?h:c,levelHeight:n>1?u:d,levelBuffer:new Uint8Array(t.buffer,l,p)},l+=p,p=(c=(h=h>>1||1)+r-1&~(r-1))*(d=(u=u>>1||1)+i-1&~(i-1))*ba[e];return o},e}(Ia),Ca=function(){function t(){}return t.use=function(e,n){var r=e.data;if(e.type===la.TYPE.JSON&&r&&r.cacheID&&r.textures){for(var i=r.textures,s=void 0,a=void 0,o=0,l=i.length;o<l;o++){var h=i[o],u=h.src,c=h.format;if(c||(a=u),t.textureFormats[c]){s=u;break}}if(!(s=s||a))return void n(new Error("Cannot load compressed-textures in "+e.url+", make sure you provide a fallback"));if(s===e.url)return void n(new Error("URL of compressed texture cannot be the same as the manifest's URL"));var d={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},p=ke.resolve(e.url.replace(this.baseUrl,""),s),f=r.cacheID;this.add(f,p,d,(function(t){if(t.error)n(t.error);else{var r=t.texture,i=void 0===r?null:r,s=t.textures,a=void 0===s?{}:s;Object.assign(e,{texture:i,textures:a}),n()}}))}else n()},t.add=function(){var e=document.createElement("canvas").getContext("webgl");if(e){var n={s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};for(var r in t.textureExtensions=n,t.textureFormats={},n){var i=n[r];i&&Object.assign(t.textureFormats,Object.getPrototypeOf(i))}}},t}();function Na(t,e,n){var r={textures:{},texture:null};return e?(e.map((function(t){return new Yr(new Rr(t,Object.assign({mipmap:pe.OFF,alphaMode:fe.NO_PREMULTIPLIED_ALPHA},n)))})).forEach((function(e,n){var i=e.baseTexture,s=t+"-"+(n+1);Rr.addToCache(i,s),Yr.addToCache(e,s),0===n&&(Rr.addToCache(i,t),Yr.addToCache(e,t),r.texture=e),r.textures[s]=e})),r):r}la.setExtensionXhrType("dds",la.XHR_RESPONSE_TYPE.BUFFER);var Aa,Ra,Ma=124,Oa=3,Pa=4,Da=7,Fa=19,La=2,Ba=0,$a=1,Ua=2,Va=3;!function(t){t[t.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",t[t.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",t[t.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",t[t.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",t[t.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",t[t.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",t[t.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",t[t.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",t[t.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",t[t.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",t[t.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",t[t.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",t[t.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",t[t.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",t[t.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",t[t.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",t[t.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",t[t.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",t[t.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",t[t.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",t[t.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",t[t.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",t[t.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",t[t.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",t[t.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",t[t.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",t[t.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",t[t.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",t[t.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",t[t.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",t[t.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",t[t.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",t[t.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",t[t.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",t[t.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",t[t.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",t[t.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",t[t.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",t[t.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",t[t.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",t[t.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",t[t.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",t[t.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",t[t.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",t[t.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",t[t.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",t[t.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",t[t.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",t[t.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",t[t.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",t[t.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",t[t.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",t[t.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",t[t.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",t[t.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",t[t.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",t[t.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",t[t.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",t[t.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",t[t.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",t[t.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",t[t.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",t[t.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",t[t.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",t[t.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",t[t.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",t[t.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",t[t.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",t[t.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",t[t.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",t[t.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",t[t.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",t[t.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",t[t.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",t[t.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",t[t.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",t[t.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",t[t.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",t[t.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",t[t.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",t[t.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",t[t.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",t[t.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",t[t.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",t[t.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",t[t.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",t[t.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",t[t.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",t[t.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",t[t.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",t[t.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",t[t.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",t[t.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",t[t.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",t[t.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",t[t.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",t[t.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",t[t.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",t[t.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",t[t.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",t[t.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",t[t.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",t[t.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",t[t.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",t[t.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",t[t.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",t[t.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",t[t.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",t[t.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",t[t.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",t[t.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",t[t.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",t[t.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",t[t.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",t[t.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",t[t.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",t[t.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",t[t.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",t[t.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",t[t.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",t[t.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",t[t.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT"}(Aa||(Aa={})),function(t){t[t.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",t[t.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",t[t.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D"}(Ra||(Ra={}));var za,Ga,Wa,Xa=((Ea={})[827611204]=va.COMPRESSED_RGBA_S3TC_DXT1_EXT,Ea[861165636]=va.COMPRESSED_RGBA_S3TC_DXT3_EXT,Ea[894720068]=va.COMPRESSED_RGBA_S3TC_DXT5_EXT,Ea),Ha=((Sa={})[Aa.DXGI_FORMAT_BC1_TYPELESS]=va.COMPRESSED_RGBA_S3TC_DXT1_EXT,Sa[Aa.DXGI_FORMAT_BC1_UNORM]=va.COMPRESSED_RGBA_S3TC_DXT1_EXT,Sa[Aa.DXGI_FORMAT_BC2_TYPELESS]=va.COMPRESSED_RGBA_S3TC_DXT3_EXT,Sa[Aa.DXGI_FORMAT_BC2_UNORM]=va.COMPRESSED_RGBA_S3TC_DXT3_EXT,Sa[Aa.DXGI_FORMAT_BC3_TYPELESS]=va.COMPRESSED_RGBA_S3TC_DXT5_EXT,Sa[Aa.DXGI_FORMAT_BC3_UNORM]=va.COMPRESSED_RGBA_S3TC_DXT5_EXT,Sa[Aa.DXGI_FORMAT_BC1_UNORM_SRGB]=va.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,Sa[Aa.DXGI_FORMAT_BC2_UNORM_SRGB]=va.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,Sa[Aa.DXGI_FORMAT_BC3_UNORM_SRGB]=va.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,Sa),Ya=function(){function t(){}return t.use=function(e,n){if("dds"===e.extension&&e.data)try{Object.assign(e,Na(e.name||e.url,t.parse(e.data),e.metadata))}catch(t){return void n(t)}n()},t.parse=function(t){var e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");var n=new Uint32Array(t,0,Ma/Uint32Array.BYTES_PER_ELEMENT),r=n[Oa],i=n[Pa],s=n[Da],a=new Uint32Array(t,Fa*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),o=a[1];if(4&o){var l=a[La];if(808540228!==l){var h=Xa[l],u=new Uint8Array(t,128);return[new ka(u,{format:h,width:i,height:r,levels:s})]}var c=new Uint32Array(e.buffer,128,20/Uint32Array.BYTES_PER_ELEMENT),d=c[Ba],p=c[$a],f=c[Ua],m=c[Va],g=Ha[d];if(void 0===g)throw new Error("DDSLoader cannot parse texture data with DXGI format "+d);if(4===f)throw new Error("DDSLoader does not support cubemap textures");if(p===Ra.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSLoader does not supported 3D texture data");var y=new Array;if(1===m)y.push(new Uint8Array(t,148));else{for(var v=ba[g],x=0,b=i,w=r,_=0;_<s;_++){x+=Math.max(1,b+3&-4)*Math.max(1,w+3&-4)*v,b>>>=1,w>>>=1}var T=148;for(_=0;_<m;_++)y.push(new Uint8Array(t,T,x)),T+=x}return y.map((function(t){return new ka(t,{format:g,width:i,height:r,levels:s})}))}if(64&o)throw new Error("DDSLoader does not support uncompressed texture data.");if(512&o)throw new Error("DDSLoader does not supported YUV uncompressed texture data.");if(131072&o)throw new Error("DDSLoader does not support single-channel (lumninance) texture data!");if(2&o)throw new Error("DDSLoader does not support single-channel (alpha) texture data!");throw new Error("DDSLoader failed to load a texture file due to an unknown reason!")},t}();la.setExtensionXhrType("ktx",la.XHR_RESPONSE_TYPE.BUFFER);var ja=[171,75,84,88,32,49,49,187,13,10,26,10],qa=12,Ka=16,Za=24,Ja=28,Qa=36,to=40,eo=44,no=48,ro=52,io=56,so=60,ao=((za={})[he.UNSIGNED_BYTE]=1,za[he.UNSIGNED_SHORT]=2,za[he.FLOAT]=4,za[he.HALF_FLOAT]=8,za),oo=((Ga={})[oe.RGBA]=4,Ga[oe.RGB]=3,Ga[oe.LUMINANCE]=1,Ga[oe.LUMINANCE_ALPHA]=2,Ga[oe.ALPHA]=1,Ga),lo=((Wa={})[he.UNSIGNED_SHORT_4_4_4_4]=2,Wa[he.UNSIGNED_SHORT_5_5_5_1]=2,Wa[he.UNSIGNED_SHORT_5_6_5]=2,Wa),ho=function(){function t(){}return t.use=function(e,n){if("ktx"===e.extension&&e.data)try{var r=e.name||e.url;Object.assign(e,Na(r,t.parse(r,e.data),e.metadata))}catch(t){return void n(t)}n()},t.parse=function(e,n){var r=new DataView(n);if(!t.validate(e,r))return null;var i=67305985===r.getUint32(qa,!0),s=r.getUint32(Ka,i),a=r.getUint32(Za,i),o=r.getUint32(Ja,i),l=r.getUint32(Qa,i),h=r.getUint32(to,i)||1,u=r.getUint32(eo,i)||1,c=r.getUint32(no,i)||1,d=r.getUint32(ro,i),p=r.getUint32(io,i),f=r.getUint32(so,i);if(0===h||1!==u)throw new Error("Only 2D textures are supported");if(1!==d)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==c)throw new Error("WebGL does not support array textures");var m,g=l+3&-4,y=h+3&-4,v=new Array(c),x=l*h;if(0===s&&(x=g*y),void 0===(m=0!==s?ao[s]?ao[s]*oo[a]:lo[s]:ba[o]))throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");for(var b=x*m,w=l,_=h,T=g,E=y,S=64+f,I=0;I<p;I++){for(var k=r.getUint32(S,i),C=S+4,N=0;N<c;N++){var A=v[N];A||(A=v[N]=new Array(p)),A[I]={levelID:I,levelWidth:p>1?w:T,levelHeight:p>1?_:E,levelBuffer:new Uint8Array(n,C,b)},C+=b}S=(S+=k+4)%4!=0?S+4-S%4:S,b=(T=(w=w>>1||1)+4-1&-4)*(E=(_=_>>1||1)+4-1&-4)*m}if(0!==s)throw new Error("TODO: Uncompressed");return v.map((function(t){return new ka(null,{format:o,width:l,height:h,levels:p,levelBuffers:t})}))},t.validate=function(t,e){for(var n=0;n<ja.length;n++)if(e.getUint8(n)!==ja[n])return!1;return!0},t}(),uo=function(t,e){return uo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},uo(t,e)};function co(t,e){function n(){this.constructor=t}uo(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var po,fo,mo=function(t){function e(e,n,r,i){void 0===e&&(e=1500),void 0===r&&(r=16384),void 0===i&&(i=!1);var s=t.call(this)||this;return r>16384&&(r=16384),s._properties=[!1,!0,!1,!1,!1],s._maxSize=e,s._batchSize=r,s._buffers=null,s._bufferUpdateIDs=[],s._updateID=0,s.interactiveChildren=!1,s.blendMode=se.NORMAL,s.autoResize=i,s.roundPixels=!0,s.baseTexture=null,s.setProperties(n),s._tint=0,s.tintRgb=new Float32Array(4),s.tint=16777215,s}return co(e,t),e.prototype.setProperties=function(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])},e.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,Pe(t,this.tintRgb)},enumerable:!1,configurable:!0}),e.prototype.render=function(t){var e=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",(function(){return e.onChildrenChange(0)}))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},e.prototype.onChildrenChange=function(t){for(var e=Math.floor(t/this._batchSize);this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID},e.prototype.dispose=function(){if(this._buffers){for(var t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},e}(or),go=function(){function t(t,e,n){this.geometry=new ii,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(var r=0;r<t.length;++r){var i=t[r];i={attributeName:i.attributeName,size:i.size,uploadFunction:i.uploadFunction,type:i.type||he.FLOAT,offset:i.offset},e[r]?this.dynamicProperties.push(i):this.staticProperties.push(i)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return t.prototype.initBuffers=function(){var t=this.geometry,e=0;this.indexBuffer=new Qr(Ge(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(var n=0;n<this.dynamicProperties.length;++n){(a=this.dynamicProperties[n]).offset=e,e+=a.size,this.dynamicStride+=a.size}var r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new Qr(this.dynamicData,!1,!1);var i=0;this.staticStride=0;for(n=0;n<this.staticProperties.length;++n){(a=this.staticProperties[n]).offset=i,i+=a.size,this.staticStride+=a.size}var s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new Qr(this.staticData,!0,!1);for(n=0;n<this.dynamicProperties.length;++n){var a=this.dynamicProperties[n];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===he.UNSIGNED_BYTE,a.type,4*this.dynamicStride,4*a.offset)}for(n=0;n<this.staticProperties.length;++n){a=this.staticProperties[n];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===he.UNSIGNED_BYTE,a.type,4*this.staticStride,4*a.offset)}},t.prototype.uploadDynamic=function(t,e,n){for(var r=0;r<this.dynamicProperties.length;r++){var i=this.dynamicProperties[r];i.uploadFunction(t,e,n,i.type===he.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,i.offset)}this.dynamicBuffer._updateID++},t.prototype.uploadStatic=function(t,e,n){for(var r=0;r<this.staticProperties.length;r++){var i=this.staticProperties[r];i.uploadFunction(t,e,n,i.type===he.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,i.offset)}this.staticBuffer._updateID++},t.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},t}(),yo=function(t){function e(e){var n=t.call(this,e)||this;return n.shader=null,n.properties=null,n.tempMatrix=new In,n.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:n.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:n.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:n.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:n.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:he.UNSIGNED_BYTE,uploadFunction:n.uploadTint,offset:0}],n.shader=Yi.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),n.state=ji.for2d(),n}return co(e,t),e.prototype.render=function(t){var e=t.children,n=t._maxSize,r=t._batchSize,i=this.renderer,s=e.length;if(0!==s){s>n&&!t.autoResize&&(s=n);var a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));var o=e[0]._texture.baseTexture;this.state.blendMode=$e(t.blendMode,o.alphaMode),i.state.set(this.state);var l=i.gl,h=t.worldTransform.copyTo(this.tempMatrix);h.prepend(i.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=h.toArray(!0),this.shader.uniforms.uColor=Ue(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,o.alphaMode),this.shader.uniforms.uSampler=o,this.renderer.shader.bind(this.shader);for(var u=!1,c=0,d=0;c<s;c+=r,d+=1){var p=s-c;p>r&&(p=r),d>=a.length&&a.push(this._generateOneMoreBuffer(t));var f=a[d];f.uploadDynamic(e,c,p);var m=t._bufferUpdateIDs[d]||0;(u=u||f._updateID<m)&&(f._updateID=t._updateID,f.uploadStatic(e,c,p)),i.geometry.bind(f.geometry),l.drawElements(l.TRIANGLES,6*p,l.UNSIGNED_SHORT,0)}}},e.prototype.generateBuffers=function(t){for(var e=[],n=t._maxSize,r=t._batchSize,i=t._properties,s=0;s<n;s+=r)e.push(new go(this.properties,i,r));return e},e.prototype._generateOneMoreBuffer=function(t){var e=t._batchSize,n=t._properties;return new go(this.properties,n,e)},e.prototype.uploadVertices=function(t,e,n,r,i,s){for(var a=0,o=0,l=0,h=0,u=0;u<n;++u){var c=t[e+u],d=c._texture,p=c.scale.x,f=c.scale.y,m=d.trim,g=d.orig;m?(a=(o=m.x-c.anchor.x*g.width)+m.width,l=(h=m.y-c.anchor.y*g.height)+m.height):(a=g.width*(1-c.anchor.x),o=g.width*-c.anchor.x,l=g.height*(1-c.anchor.y),h=g.height*-c.anchor.y),r[s]=o*p,r[s+1]=h*f,r[s+i]=a*p,r[s+i+1]=h*f,r[s+2*i]=a*p,r[s+2*i+1]=l*f,r[s+3*i]=o*p,r[s+3*i+1]=l*f,s+=4*i}},e.prototype.uploadPosition=function(t,e,n,r,i,s){for(var a=0;a<n;a++){var o=t[e+a].position;r[s]=o.x,r[s+1]=o.y,r[s+i]=o.x,r[s+i+1]=o.y,r[s+2*i]=o.x,r[s+2*i+1]=o.y,r[s+3*i]=o.x,r[s+3*i+1]=o.y,s+=4*i}},e.prototype.uploadRotation=function(t,e,n,r,i,s){for(var a=0;a<n;a++){var o=t[e+a].rotation;r[s]=o,r[s+i]=o,r[s+2*i]=o,r[s+3*i]=o,s+=4*i}},e.prototype.uploadUvs=function(t,e,n,r,i,s){for(var a=0;a<n;++a){var o=t[e+a]._texture._uvs;o?(r[s]=o.x0,r[s+1]=o.y0,r[s+i]=o.x1,r[s+i+1]=o.y1,r[s+2*i]=o.x2,r[s+2*i+1]=o.y2,r[s+3*i]=o.x3,r[s+3*i+1]=o.y3,s+=4*i):(r[s]=0,r[s+1]=0,r[s+i]=0,r[s+i+1]=0,r[s+2*i]=0,r[s+2*i+1]=0,r[s+3*i]=0,r[s+3*i+1]=0,s+=4*i)}},e.prototype.uploadTint=function(t,e,n,r,i,s){for(var a=0;a<n;++a){var o=t[e+a],l=o._texture.baseTexture.alphaMode>0,h=o.alpha,u=h<1&&l?Ve(o._tintRGB,h):o._tintRGB+(255*h<<24);r[s]=u,r[s+i]=u,r[s+2*i]=u,r[s+3*i]=u,s+=4*i}},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},e}(pi);!function(t){t.MITER="miter",t.BEVEL="bevel",t.ROUND="round"}(po||(po={})),function(t){t.BUTT="butt",t.ROUND="round",t.SQUARE="square"}(fo||(fo={}));var vo={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(t,e){if(void 0===e&&(e=20),!this.adaptive||!t||isNaN(t))return e;var n=Math.ceil(t/this.maxLength);return n<this.minSegments?n=this.minSegments:n>this.maxSegments&&(n=this.maxSegments),n}},xo=function(){function t(){this.color=16777215,this.alpha=1,this.texture=Yr.WHITE,this.matrix=null,this.visible=!1,this.reset()}return t.prototype.clone=function(){var e=new t;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e},t.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=Yr.WHITE,this.matrix=null,this.visible=!1},t.prototype.destroy=function(){this.texture=null,this.matrix=null},t}(),bo=function(t,e){return bo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},bo(t,e)};function wo(t,e){function n(){this.constructor=t}bo(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var _o={build:function(t){t.points=t.shape.points.slice()},triangulate:function(t,e){var n=t.points,r=t.holes,i=e.points,s=e.indices;if(n.length>=6){for(var a=[],o=0;o<r.length;o++){var l=r[o];a.push(n.length/2),n=n.concat(l.points)}var h=Se()(n,a,2);if(!h)return;var u=i.length/2;for(o=0;o<h.length;o+=3)s.push(h[o]+u),s.push(h[o+1]+u),s.push(h[o+2]+u);for(o=0;o<n.length;o++)i.push(n[o])}}},To={build:function(t){var e,n,r=t.shape,i=t.points,s=r.x,a=r.y;if(i.length=0,t.type===mn.CIRC)e=r.radius,n=r.radius;else{var o=t.shape;e=o.width,n=o.height}if(0!==e&&0!==n){var l=Math.floor(30*Math.sqrt(r.radius))||Math.floor(15*Math.sqrt(e+n));l/=2.3;for(var h=2*Math.PI/l,u=0;u<l-.5;u++)i.push(s+Math.sin(-h*u)*e,a+Math.cos(-h*u)*n);i.push(i[0],i[1])}},triangulate:function(t,e){var n=t.points,r=e.points,i=e.indices,s=r.length/2,a=s,o=t.shape,l=t.matrix,h=o.x,u=o.y;r.push(t.matrix?l.a*h+l.c*u+l.tx:h,t.matrix?l.b*h+l.d*u+l.ty:u);for(var c=0;c<n.length;c+=2)r.push(n[c],n[c+1]),i.push(s++,a,s)}},Eo={build:function(t){var e=t.shape,n=e.x,r=e.y,i=e.width,s=e.height,a=t.points;a.length=0,a.push(n,r,n+i,r,n+i,r+s,n,r+s)},triangulate:function(t,e){var n=t.points,r=e.points,i=r.length/2;r.push(n[0],n[1],n[2],n[3],n[6],n[7],n[4],n[5]),e.indices.push(i,i+1,i+2,i+1,i+2,i+3)}};function So(t,e,n){return t+(e-t)*n}function Io(t,e,n,r,i,s,a){void 0===a&&(a=[]);for(var o=a,l=0,h=0,u=0,c=0,d=0,p=0,f=0,m=0;f<=20;++f)l=So(t,n,m=f/20),h=So(e,r,m),u=So(n,i,m),c=So(r,s,m),d=So(l,u,m),p=So(h,c,m),0===f&&o[o.length-2]===d&&o[o.length-1]===p||o.push(d,p);return o}var ko={build:function(t){var e=t.shape,n=t.points,r=e.x,i=e.y,s=e.width,a=e.height,o=Math.max(0,Math.min(e.radius,Math.min(s,a)/2));n.length=0,o?(Io(r,i+o,r,i,r+o,i,n),Io(r+s-o,i,r+s,i,r+s,i+o,n),Io(r+s,i+a-o,r+s,i+a,r+s-o,i+a,n),Io(r+o,i+a,r,i+a,r,i+a-o,n)):n.push(r,i,r+s,i,r+s,i+a,r,i+a)},triangulate:function(t,e){for(var n=t.points,r=e.points,i=e.indices,s=r.length/2,a=Se()(n,null,2),o=0,l=a.length;o<l;o+=3)i.push(a[o]+s),i.push(a[o+1]+s),i.push(a[o+2]+s);for(o=0,l=n.length;o<l;o++)r.push(n[o],n[++o])}};function Co(t,e,n,r,i,s,a,o){var l,h;a?(l=r,h=-n):(l=-r,h=n);var u=t-n*i+l,c=e-r*i+h,d=t+n*s+l,p=e+r*s+h;return o.push(u,c),o.push(d,p),2}function No(t,e,n,r,i,s,a,o){var l=n-t,h=r-e,u=Math.atan2(l,h),c=Math.atan2(i-t,s-e);o&&u<c?u+=2*Math.PI:!o&&u>c&&(c+=2*Math.PI);var d=u,p=c-u,f=Math.abs(p),m=Math.sqrt(l*l+h*h),g=1+(15*f*Math.sqrt(m)/Math.PI>>0),y=p/g;if(d+=y,o){a.push(t,e),a.push(n,r);for(var v=1,x=d;v<g;v++,x+=y)a.push(t,e),a.push(t+Math.sin(x)*m,e+Math.cos(x)*m);a.push(t,e),a.push(i,s)}else{a.push(n,r),a.push(t,e);for(v=1,x=d;v<g;v++,x+=y)a.push(t+Math.sin(x)*m,e+Math.cos(x)*m),a.push(t,e);a.push(i,s),a.push(t,e)}return 2*g}function Ao(t,e){t.lineStyle.native?function(t,e){var n=0,r=t.shape,i=t.points||r.points,s=r.type!==mn.POLY||r.closeStroke;if(0!==i.length){var a=e.points,o=e.indices,l=i.length/2,h=a.length/2,u=h;for(a.push(i[0],i[1]),n=1;n<l;n++)a.push(i[2*n],i[2*n+1]),o.push(u,u+1),u++;s&&o.push(u,h)}}(t,e):function(t,e){var n=t.shape,r=t.points||n.points.slice(),i=e.closePointEps;if(0!==r.length){var s=t.lineStyle,a=new En(r[0],r[1]),o=new En(r[r.length-2],r[r.length-1]),l=n.type!==mn.POLY||n.closeStroke,h=Math.abs(a.x-o.x)<i&&Math.abs(a.y-o.y)<i;if(l){r=r.slice(),h&&(r.pop(),r.pop(),o.set(r[r.length-2],r[r.length-1]));var u=.5*(a.x+o.x),c=.5*(o.y+a.y);r.unshift(u,c),r.push(u,c)}var d=e.points,p=r.length/2,f=r.length,m=d.length/2,g=s.width/2,y=g*g,v=s.miterLimit*s.miterLimit,x=r[0],b=r[1],w=r[2],_=r[3],T=0,E=0,S=-(b-_),I=x-w,k=0,C=0,N=Math.sqrt(S*S+I*I);S/=N,I/=N,S*=g,I*=g;var A=s.alignment,R=2*(1-A),M=2*A;l||(s.cap===fo.ROUND?f+=No(x-S*(R-M)*.5,b-I*(R-M)*.5,x-S*R,b-I*R,x+S*M,b+I*M,d,!0)+2:s.cap===fo.SQUARE&&(f+=Co(x,b,S,I,R,M,!0,d))),d.push(x-S*R,b-I*R),d.push(x+S*M,b+I*M);for(var O=1;O<p-1;++O){x=r[2*(O-1)],b=r[2*(O-1)+1],w=r[2*O],_=r[2*O+1],T=r[2*(O+1)],E=r[2*(O+1)+1],S=-(b-_),I=x-w,S/=N=Math.sqrt(S*S+I*I),I/=N,S*=g,I*=g,k=-(_-E),C=w-T,k/=N=Math.sqrt(k*k+C*C),C/=N,k*=g,C*=g;var P=w-x,D=b-_,F=w-T,L=E-_,B=D*F-L*P,$=B<0;if(Math.abs(B)<.1)d.push(w-S*R,_-I*R),d.push(w+S*M,_+I*M);else{var U=(-S+x)*(-I+_)-(-S+w)*(-I+b),V=(-k+T)*(-C+_)-(-k+w)*(-C+E),z=(P*V-F*U)/B,G=(L*U-D*V)/B,W=(z-w)*(z-w)+(G-_)*(G-_),X=w+(z-w)*R,H=_+(G-_)*R,Y=w-(z-w)*M,j=_-(G-_)*M,q=$?R:M;W<=Math.min(P*P+D*D,F*F+L*L)+q*q*y?s.join===po.BEVEL||W/y>v?($?(d.push(X,H),d.push(w+S*M,_+I*M),d.push(X,H),d.push(w+k*M,_+C*M)):(d.push(w-S*R,_-I*R),d.push(Y,j),d.push(w-k*R,_-C*R),d.push(Y,j)),f+=2):s.join===po.ROUND?$?(d.push(X,H),d.push(w+S*M,_+I*M),f+=No(w,_,w+S*M,_+I*M,w+k*M,_+C*M,d,!0)+4,d.push(X,H),d.push(w+k*M,_+C*M)):(d.push(w-S*R,_-I*R),d.push(Y,j),f+=No(w,_,w-S*R,_-I*R,w-k*R,_-C*R,d,!1)+4,d.push(w-k*R,_-C*R),d.push(Y,j)):(d.push(X,H),d.push(Y,j)):(d.push(w-S*R,_-I*R),d.push(w+S*M,_+I*M),s.join===po.BEVEL||W/y>v||(s.join===po.ROUND?f+=$?No(w,_,w+S*M,_+I*M,w+k*M,_+C*M,d,!0)+2:No(w,_,w-S*R,_-I*R,w-k*R,_-C*R,d,!1)+2:($?(d.push(Y,j),d.push(Y,j)):(d.push(X,H),d.push(X,H)),f+=2)),d.push(w-k*R,_-C*R),d.push(w+k*M,_+C*M),f+=2)}}x=r[2*(p-2)],b=r[2*(p-2)+1],w=r[2*(p-1)],S=-(b-(_=r[2*(p-1)+1])),I=x-w,S/=N=Math.sqrt(S*S+I*I),I/=N,S*=g,I*=g,d.push(w-S*R,_-I*R),d.push(w+S*M,_+I*M),l||(s.cap===fo.ROUND?f+=No(w-S*(R-M)*.5,_-I*(R-M)*.5,w-S*R,_-I*R,w+S*M,_+I*M,d,!1)+2:s.cap===fo.SQUARE&&(f+=Co(w,_,S,I,R,M,!1,d)));var K=e.indices,Z=vo.epsilon*vo.epsilon;for(O=m;O<f+m-2;++O)x=d[2*O],b=d[2*O+1],w=d[2*(O+1)],_=d[2*(O+1)+1],T=d[2*(O+2)],E=d[2*(O+2)+1],Math.abs(x*(_-E)+w*(E-b)+T*(b-_))<Z||K.push(O,O+1,O+2)}}(t,e)}var Ro,Mo=function(){function t(){}return t.curveTo=function(t,e,n,r,i,s){var a=s[s.length-2],o=s[s.length-1]-e,l=a-t,h=r-e,u=n-t,c=Math.abs(o*u-l*h);if(c<1e-8||0===i)return s[s.length-2]===t&&s[s.length-1]===e||s.push(t,e),null;var d=o*o+l*l,p=h*h+u*u,f=o*h+l*u,m=i*Math.sqrt(d)/c,g=i*Math.sqrt(p)/c,y=m*f/d,v=g*f/p,x=m*u+g*l,b=m*h+g*o,w=l*(g+y),_=o*(g+y),T=u*(m+v),E=h*(m+v);return{cx:x+t,cy:b+e,radius:i,startAngle:Math.atan2(_-b,w-x),endAngle:Math.atan2(E-b,T-x),anticlockwise:l*h>u*o}},t.arc=function(t,e,n,r,i,s,a,o,l){for(var h=a-s,u=vo._segmentsCount(Math.abs(h)*i,40*Math.ceil(Math.abs(h)/gn)),c=h/(2*u),d=2*c,p=Math.cos(c),f=Math.sin(c),m=u-1,g=m%1/m,y=0;y<=m;++y){var v=c+s+d*(y+g*y),x=Math.cos(v),b=-Math.sin(v);l.push((p*x+f*b)*i+n,(p*-b+f*x)*i+r)}},t}(),Oo=function(){function t(){}return t.curveLength=function(t,e,n,r,i,s,a,o){for(var l=0,h=0,u=0,c=0,d=0,p=0,f=0,m=0,g=0,y=0,v=0,x=t,b=e,w=1;w<=10;++w)y=x-(m=(f=(p=(d=1-(h=w/10))*d)*d)*t+3*p*h*n+3*d*(u=h*h)*i+(c=u*h)*a),v=b-(g=f*e+3*p*h*r+3*d*u*s+c*o),x=m,b=g,l+=Math.sqrt(y*y+v*v);return l},t.curveTo=function(e,n,r,i,s,a,o){var l=o[o.length-2],h=o[o.length-1];o.length-=2;var u=vo._segmentsCount(t.curveLength(l,h,e,n,r,i,s,a)),c=0,d=0,p=0,f=0,m=0;o.push(l,h);for(var g=1,y=0;g<=u;++g)p=(d=(c=1-(y=g/u))*c)*c,m=(f=y*y)*y,o.push(p*l+3*d*y*e+3*c*f*r+m*s,p*h+3*d*y*n+3*c*f*i+m*a)},t}(),Po=function(){function t(){}return t.curveLength=function(t,e,n,r,i,s){var a=t-2*n+i,o=e-2*r+s,l=2*n-2*t,h=2*r-2*e,u=4*(a*a+o*o),c=4*(a*l+o*h),d=l*l+h*h,p=2*Math.sqrt(u+c+d),f=Math.sqrt(u),m=2*u*f,g=2*Math.sqrt(d),y=c/f;return(m*p+f*c*(p-g)+(4*d*u-c*c)*Math.log((2*f+y+p)/(y+g)))/(4*m)},t.curveTo=function(e,n,r,i,s){for(var a=s[s.length-2],o=s[s.length-1],l=vo._segmentsCount(t.curveLength(a,o,e,n,r,i)),h=0,u=0,c=1;c<=l;++c){var d=c/l;h=a+(e-a)*d,u=o+(n-o)*d,s.push(h+(e+(r-e)*d-h)*d,u+(n+(i-n)*d-u)*d)}},t}(),Do=function(){function t(){this.reset()}return t.prototype.begin=function(t,e,n){this.reset(),this.style=t,this.start=e,this.attribStart=n},t.prototype.end=function(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start},t.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},t}(),Fo=((Ro={})[mn.POLY]=_o,Ro[mn.CIRC]=To,Ro[mn.ELIP]=To,Ro[mn.RECT]=Eo,Ro[mn.RREC]=ko,Ro),Lo=[],Bo=[];function $o(t){for(var e=t.points,n=0,r=0;r<e.length-2;r+=2)n+=(e[r+2]-e[r])*(e[r+3]+e[r+1]);return n>0}var Uo=function(){function t(t,e,n,r){void 0===e&&(e=null),void 0===n&&(n=null),void 0===r&&(r=null),this.points=[],this.holes=[],this.shape=t,this.lineStyle=n,this.fillStyle=e,this.matrix=r,this.type=t.type}return t.prototype.clone=function(){return new t(this.shape,this.fillStyle,this.lineStyle,this.matrix)},t.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},t}(),Vo=new En,zo=new Fn,Go=function(t){function e(){var e=t.call(this)||this;return e.closePointEps=1e-4,e.boundsPadding=0,e.uvsFloat32=null,e.indicesUint16=null,e.batchable=!1,e.points=[],e.colors=[],e.uvs=[],e.indices=[],e.textureIds=[],e.graphicsData=[],e.drawCalls=[],e.batchDirty=-1,e.batches=[],e.dirty=0,e.cacheDirty=-1,e.clearDirty=0,e.shapeIndex=0,e._bounds=new Fn,e.boundsDirty=-1,e}return wo(e,t),Object.defineProperty(e.prototype,"bounds",{get:function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),e.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Bo.push(this.drawCalls[t]);this.drawCalls.length=0;for(t=0;t<this.batches.length;t++){var e=this.batches[t];e.reset(),Lo.push(e)}this.batches.length=0},e.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},e.prototype.drawShape=function(t,e,n,r){void 0===e&&(e=null),void 0===n&&(n=null),void 0===r&&(r=null);var i=new Uo(t,e,n,r);return this.graphicsData.push(i),this.dirty++,this},e.prototype.drawHole=function(t,e){if(void 0===e&&(e=null),!this.graphicsData.length)return null;var n=new Uo(t,null,null,e),r=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=r.lineStyle,r.holes.push(n),this.dirty++,this},e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},e.prototype.containsPoint=function(t){for(var e=this.graphicsData,n=0;n<e.length;++n){var r=e[n];if(r.fillStyle.visible&&(r.shape&&(r.matrix?r.matrix.applyInverse(t,Vo):Vo.copyFrom(t),r.shape.contains(Vo.x,Vo.y)))){var i=!1;if(r.holes)for(var s=0;s<r.holes.length;s++){if(r.holes[s].shape.contains(Vo.x,Vo.y)){i=!0;break}}if(!i)return!0}}return!1},e.prototype.updateBatches=function(t){if(this.graphicsData.length){if(this.validateBatching()){this.cacheDirty=this.dirty;var e=this.uvs,n=this.graphicsData,r=null,i=null;this.batches.length>0&&(i=(r=this.batches[this.batches.length-1]).style);for(var s=this.shapeIndex;s<n.length;s++){this.shapeIndex++;var a=n[s],o=a.fillStyle,l=a.lineStyle;Fo[a.type].build(a),a.matrix&&this.transformPoints(a.points,a.matrix);for(var h=0;h<2;h++){var u=0===h?o:l;if(u.visible){var c=u.texture.baseTexture,d=this.indices.length,p=this.points.length/2;c.wrapMode=de.REPEAT,0===h?this.processFill(a):this.processLine(a);var f=this.points.length/2-p;0!==f&&(r&&!this._compareStyles(i,u)&&(r.end(d,p),r=null),r||((r=Lo.pop()||new Do).begin(u,d,p),this.batches.push(r),i=u),this.addUvs(this.points,e,u.texture,p,f,u.matrix))}}}var m=this.indices.length,g=this.points.length/2;if(r&&r.end(m,g),0!==this.batches.length){if(this.indicesUint16&&this.indices.length===this.indicesUint16.length)this.indicesUint16.set(this.indices);else{var y=g>65535&&t;this.indicesUint16=y?new Uint32Array(this.indices):new Uint16Array(this.indices)}this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}else this.batchable=!0}}else this.batchable=!0},e.prototype._compareStyles=function(t,e){return!(!t||!e)&&(t.texture.baseTexture===e.texture.baseTexture&&(t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native))},e.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var t=0,e=this.graphicsData.length;t<e;t++){var n=this.graphicsData[t],r=n.fillStyle,i=n.lineStyle;if(r&&!r.texture.baseTexture.valid)return!1;if(i&&!i.texture.baseTexture.valid)return!1}return!0},e.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var t=this.batches,e=0,n=t.length;e<n;e++)for(var r=t[e],i=0;i<r.size;i++){var s=r.start+i;this.indicesUint16[s]=this.indicesUint16[s]-r.attribStart}},e.prototype.isBatchable=function(){if(this.points.length>131070)return!1;for(var t=this.batches,n=0;n<t.length;n++)if(t[n].style.native)return!1;return this.points.length<2*e.BATCHABLE_SIZE},e.prototype.buildDrawCalls=function(){for(var t=++Rr._globalBatch,e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),Bo.push(this.drawCalls[e]);this.drawCalls.length=0;var n=this.colors,r=this.textureIds,i=Bo.pop();i||((i=new Ps).texArray=new Ds),i.texArray.count=0,i.start=0,i.size=0,i.type=ae.TRIANGLES;var s=0,a=null,o=0,l=!1,h=ae.TRIANGLES,u=0;this.drawCalls.push(i);for(e=0;e<this.batches.length;e++){var c=this.batches[e],d=c.style,p=d.texture.baseTexture;l!==!!d.native&&(h=(l=!!d.native)?ae.LINES:ae.TRIANGLES,a=null,s=8,t++),a!==p&&(a=p,p._batchEnabled!==t&&(8===s&&(t++,s=0,i.size>0&&((i=Bo.pop())||((i=new Ps).texArray=new Ds),this.drawCalls.push(i)),i.start=u,i.size=0,i.texArray.count=0,i.type=h),p.touched=1,p._batchEnabled=t,p._batchLocation=s,p.wrapMode=de.REPEAT,i.texArray.elements[i.texArray.count++]=p,s++)),i.size+=c.size,u+=c.size,o=p._batchLocation,this.addColors(n,d.color,d.alpha,c.attribSize,c.attribStart),this.addTextureIds(r,o,c.attribSize,c.attribStart)}Rr._globalBatch=t,this.packAttributes()},e.prototype.packAttributes=function(){for(var t=this.points,e=this.uvs,n=this.colors,r=this.textureIds,i=new ArrayBuffer(3*t.length*4),s=new Float32Array(i),a=new Uint32Array(i),o=0,l=0;l<t.length/2;l++)s[o++]=t[2*l],s[o++]=t[2*l+1],s[o++]=e[2*l],s[o++]=e[2*l+1],a[o++]=n[l],s[o++]=r[l];this._buffer.update(i),this._indexBuffer.update(this.indicesUint16)},e.prototype.processFill=function(t){t.holes.length?(this.processHoles(t.holes),_o.triangulate(t,this)):Fo[t.type].triangulate(t,this)},e.prototype.processLine=function(t){Ao(t,this);for(var e=0;e<t.holes.length;e++)Ao(t.holes[e],this)},e.prototype.processHoles=function(t){for(var e=0;e<t.length;e++){var n=t[e];Fo[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}},e.prototype.calculateBounds=function(){var t=this._bounds,e=zo,n=In.IDENTITY;this._bounds.clear(),e.clear();for(var r=0;r<this.graphicsData.length;r++){var i=this.graphicsData[r],s=i.shape,a=i.type,o=i.lineStyle,l=i.matrix||In.IDENTITY,h=0;if(o&&o.visible){var u=o.alignment;h=o.width,a===mn.POLY?$o(s)?h*=1-u:h*=u:h*=Math.max(0,u)}if(n!==l&&(e.isEmpty()||(t.addBoundsMatrix(e,n),e.clear()),n=l),a===mn.RECT||a===mn.RREC){var c=s;e.addFramePad(c.x,c.y,c.x+c.width,c.y+c.height,h,h)}else if(a===mn.CIRC){var d=s;e.addFramePad(d.x,d.y,d.x,d.y,d.radius+h,d.radius+h)}else if(a===mn.ELIP){var p=s;e.addFramePad(p.x,p.y,p.x,p.y,p.width+h,p.height+h)}else{var f=s;t.addVerticesMatrix(n,f.points,0,f.points.length,h,h)}}e.isEmpty()||t.addBoundsMatrix(e,n),t.pad(this.boundsPadding,this.boundsPadding)},e.prototype.transformPoints=function(t,e){for(var n=0;n<t.length/2;n++){var r=t[2*n],i=t[2*n+1];t[2*n]=e.a*r+e.c*i+e.tx,t[2*n+1]=e.b*r+e.d*i+e.ty}},e.prototype.addColors=function(t,e,n,r,i){void 0===i&&(i=0);var s=Ve((e>>16)+(65280&e)+((255&e)<<16),n);t.length=Math.max(t.length,i+r);for(var a=0;a<r;a++)t[i+a]=s},e.prototype.addTextureIds=function(t,e,n,r){void 0===r&&(r=0),t.length=Math.max(t.length,r+n);for(var i=0;i<n;i++)t[r+i]=e},e.prototype.addUvs=function(t,e,n,r,i,s){void 0===s&&(s=null);for(var a=0,o=e.length,l=n.frame;a<i;){var h=t[2*(r+a)],u=t[2*(r+a)+1];if(s){var c=s.a*h+s.c*u+s.tx;u=s.b*h+s.d*u+s.ty,h=c}a++,e.push(h/l.width,u/l.height)}var d=n.baseTexture;(l.width<d.width||l.height<d.height)&&this.adjustUvs(e,n,o,i)},e.prototype.adjustUvs=function(t,e,n,r){for(var i=e.baseTexture,s=1e-6,a=n+2*r,o=e.frame,l=o.width/i.width,h=o.height/i.height,u=o.x/o.width,c=o.y/o.height,d=Math.floor(t[n]+s),p=Math.floor(t[n+1]+s),f=n+2;f<a;f+=2)d=Math.min(d,Math.floor(t[f]+s)),p=Math.min(p,Math.floor(t[f+1]+s));u-=d,c-=p;for(f=n;f<a;f+=2)t[f]=(t[f]+u)*l,t[f+1]=(t[f+1]+c)*h},e.BATCHABLE_SIZE=100,e}($s),Wo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.width=0,e.alignment=.5,e.native=!1,e.cap=fo.BUTT,e.join=po.MITER,e.miterLimit=10,e}return wo(e,t),e.prototype.clone=function(){var t=new e;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t},e.prototype.reset=function(){t.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},e}(xo),Xo=new Float32Array(3),Ho={},Yo=function(t){function e(e){void 0===e&&(e=null);var n=t.call(this)||this;return n.shader=null,n.pluginName="batch",n.currentPath=null,n.batches=[],n.batchTint=-1,n.batchDirty=-1,n.vertexData=null,n._fillStyle=new xo,n._lineStyle=new Wo,n._matrix=null,n._holeMode=!1,n.state=ji.for2d(),n._geometry=e||new Go,n._geometry.refCount++,n._transformID=-1,n.tint=16777215,n.blendMode=se.NORMAL,n}return wo(e,t),Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return this.finishPoly(),new e(this._geometry)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),e.prototype.lineStyle=function(t,e,n,r,i){return void 0===t&&(t=null),void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r=.5),void 0===i&&(i=!1),"number"==typeof t&&(t={width:t,color:e,alpha:n,alignment:r,native:i}),this.lineTextureStyle(t)},e.prototype.lineTextureStyle=function(t){t=Object.assign({width:0,texture:Yr.WHITE,color:t&&t.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:fo.BUTT,join:po.MITER,miterLimit:10},t),this.currentPath&&this.startPoly();var e=t.width>0&&t.alpha>0;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:e},t)):this._lineStyle.reset(),this},e.prototype.startPoly=function(){if(this.currentPath){var t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new _n,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new _n,this.currentPath.closeStroke=!1},e.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},e.prototype.moveTo=function(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this},e.prototype.lineTo=function(t,e){this.currentPath||this.moveTo(0,0);var n=this.currentPath.points,r=n[n.length-2],i=n[n.length-1];return r===t&&i===e||n.push(t,e),this},e.prototype._initCurve=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)},e.prototype.quadraticCurveTo=function(t,e,n,r){this._initCurve();var i=this.currentPath.points;return 0===i.length&&this.moveTo(0,0),Po.curveTo(t,e,n,r,i),this},e.prototype.bezierCurveTo=function(t,e,n,r,i,s){return this._initCurve(),Oo.curveTo(t,e,n,r,i,s,this.currentPath.points),this},e.prototype.arcTo=function(t,e,n,r,i){this._initCurve(t,e);var s=this.currentPath.points,a=Mo.curveTo(t,e,n,r,i,s);if(a){var o=a.cx,l=a.cy,h=a.radius,u=a.startAngle,c=a.endAngle,d=a.anticlockwise;this.arc(o,l,h,u,c,d)}return this},e.prototype.arc=function(t,e,n,r,i,s){if(void 0===s&&(s=!1),r===i)return this;if(!s&&i<=r?i+=gn:s&&r<=i&&(r+=gn),0===i-r)return this;var a=t+Math.cos(r)*n,o=e+Math.sin(r)*n,l=this._geometry.closePointEps,h=this.currentPath?this.currentPath.points:null;if(h){var u=Math.abs(h[h.length-2]-a),c=Math.abs(h[h.length-1]-o);u<l&&c<l||h.push(a,o)}else this.moveTo(a,o),h=this.currentPath.points;return Mo.arc(a,o,t,e,n,r,i,s,h),this},e.prototype.beginFill=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),this.beginTextureFill({texture:Yr.WHITE,color:t,alpha:e})},e.prototype.beginTextureFill=function(t){t=Object.assign({texture:Yr.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();var e=t.alpha>0;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:e},t)):this._fillStyle.reset(),this},e.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},e.prototype.drawRect=function(t,e,n,r){return this.drawShape(new xn(t,e,n,r))},e.prototype.drawRoundedRect=function(t,e,n,r,i){return this.drawShape(new Tn(t,e,n,r,i))},e.prototype.drawCircle=function(t,e,n){return this.drawShape(new bn(t,e,n))},e.prototype.drawEllipse=function(t,e,n,r){return this.drawShape(new wn(t,e,n,r))},e.prototype.drawPolygon=function(){for(var t,e=arguments,n=[],r=0;r<arguments.length;r++)n[r]=e[r];var i=!0,s=n[0];s.points?(i=s.closeStroke,t=s.points):t=Array.isArray(n[0])?n[0]:n;var a=new _n(t);return a.closeStroke=i,this.drawShape(a),this},e.prototype.drawShape=function(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},e.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},e.prototype.isFastRect=function(){var t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==mn.RECT||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)},e.prototype._render=function(t){this.finishPoly();var e=this._geometry,n=t.context.supports.uint32Indices;e.updateBatches(n),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))},e.prototype._populateBatches=function(){var t=this._geometry,e=this.blendMode,n=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=n,this.vertexData=new Float32Array(t.points);for(var r=0;r<n;r++){var i=t.batches[r],s=i.style.color,a=new Float32Array(this.vertexData.buffer,4*i.attribStart*2,2*i.attribSize),o=new Float32Array(t.uvsFloat32.buffer,4*i.attribStart*2,2*i.attribSize),l={vertexData:a,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*i.start,i.size),uvs:o,_batchRGB:Pe(s),_tintRGB:s,_texture:i.style.texture,alpha:i.style.alpha,worldAlpha:1};this.batches[r]=l}},e.prototype._renderBatched=function(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var e=0,n=this.batches.length;e<n;e++){var r=this.batches[e];r.worldAlpha=this.worldAlpha*r.alpha,t.plugins[this.pluginName].render(r)}}},e.prototype._renderDirect=function(t){var e=this._resolveDirectShader(t),n=this._geometry,r=this.tint,i=this.worldAlpha,s=e.uniforms,a=n.drawCalls;s.translationMatrix=this.transform.worldTransform,s.tint[0]=(r>>16&255)/255*i,s.tint[1]=(r>>8&255)/255*i,s.tint[2]=(255&r)/255*i,s.tint[3]=i,t.shader.bind(e),t.geometry.bind(n,e),t.state.set(this.state);for(var o=0,l=a.length;o<l;o++)this._renderDrawCallDirect(t,n.drawCalls[o])},e.prototype._renderDrawCallDirect=function(t,e){for(var n=e.texArray,r=e.type,i=e.size,s=e.start,a=n.count,o=0;o<a;o++)t.texture.bind(n.elements[o],o);t.geometry.draw(r,i,s)},e.prototype._resolveDirectShader=function(t){var e=this.shader,n=this.pluginName;if(!e){if(!Ho[n]){for(var r=t.plugins.batch.MAX_TEXTURES,i=new Int32Array(r),s=0;s<r;s++)i[s]=s;var a={tint:new Float32Array([1,1,1,1]),translationMatrix:new In,default:li.from({uSamplers:i},!0)},o=t.plugins[n]._shader.program;Ho[n]=new Yi(o,a)}e=Ho[n]}return e},e.prototype._calculateBounds=function(){this.finishPoly();var t=this._geometry;if(t.graphicsData.length){var e=t.bounds,n=e.minX,r=e.minY,i=e.maxX,s=e.maxY;this._bounds.addFrame(this.transform,n,r,i,s)}},e.prototype.containsPoint=function(t){return this.worldTransform.applyInverse(t,e._TEMP_POINT),this._geometry.containsPoint(e._TEMP_POINT)},e.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var t=Pe(this.tint,Xo),e=0;e<this.batches.length;e++){var n=this.batches[e],r=n._batchRGB,i=(t[0]*r[0]*255<<16)+(t[1]*r[1]*255<<8)+(0|t[2]*r[2]*255);n._tintRGB=(i>>16)+(65280&i)+((255&i)<<16)}}},e.prototype.calculateVertices=function(){var t=this.transform._worldID;if(this._transformID!==t){this._transformID=t;for(var e=this.transform.worldTransform,n=e.a,r=e.b,i=e.c,s=e.d,a=e.tx,o=e.ty,l=this._geometry.points,h=this.vertexData,u=0,c=0;c<l.length;c+=2){var d=l[c],p=l[c+1];h[u++]=n*d+i*p+a,h[u++]=s*p+r*d+o}}},e.prototype.closePath=function(){var t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this},e.prototype.setMatrix=function(t){return this._matrix=t,this},e.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},e.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},e.prototype.destroy=function(e){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,t.prototype.destroy.call(this,e)},e._TEMP_POINT=new En,e}(or),jo={buildPoly:_o,buildCircle:To,buildRectangle:Eo,buildRoundedRectangle:ko,buildLine:Ao,ArcUtils:Mo,BezierUtils:Oo,QuadraticUtils:Po,BatchPart:Do,FILL_COMMANDS:Fo,BATCH_POOL:Lo,DRAW_CALL_POOL:Bo},qo=function(t,e){return qo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},qo(t,e)};var Ko,Zo=new En,Jo=new Uint16Array([0,1,2,0,2,3]),Qo=function(t){function e(e){var n=t.call(this)||this;return n._anchor=new Sn(n._onAnchorUpdate,n,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),n._texture=null,n._width=0,n._height=0,n._tint=null,n._tintRGB=null,n.tint=16777215,n.blendMode=se.NORMAL,n._cachedTint=16777215,n.uvs=null,n.texture=e||Yr.EMPTY,n.vertexData=new Float32Array(8),n.vertexTrimmedData=null,n._transformID=-1,n._textureID=-1,n._transformTrimmedID=-1,n._textureTrimmedID=-1,n.indices=Jo,n.pluginName="batch",n.isSprite=!0,n._roundPixels=we.ROUND_PIXELS,n}return function(t,e){function n(){this.constructor=t}qo(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Ze(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Ze(this.scale.y)*this._height/this._texture.orig.height)},e.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},e.prototype.calculateVertices=function(){var t=this._texture;if(this._transformID!==this.transform._worldID||this._textureID!==t._updateID){this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;var e=this.transform.worldTransform,n=e.a,r=e.b,i=e.c,s=e.d,a=e.tx,o=e.ty,l=this.vertexData,h=t.trim,u=t.orig,c=this._anchor,d=0,p=0,f=0,m=0;if(h?(d=(p=h.x-c._x*u.width)+h.width,f=(m=h.y-c._y*u.height)+h.height):(d=(p=-c._x*u.width)+u.width,f=(m=-c._y*u.height)+u.height),l[0]=n*p+i*m+a,l[1]=s*m+r*p+o,l[2]=n*d+i*m+a,l[3]=s*m+r*d+o,l[4]=n*d+i*f+a,l[5]=s*f+r*d+o,l[6]=n*p+i*f+a,l[7]=s*f+r*p+o,this._roundPixels)for(var g=we.RESOLUTION,y=0;y<l.length;++y)l[y]=Math.round((l[y]*g|0)/g)}},e.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this._texture,e=this.vertexTrimmedData,n=t.orig,r=this._anchor,i=this.transform.worldTransform,s=i.a,a=i.b,o=i.c,l=i.d,h=i.tx,u=i.ty,c=-r._x*n.width,d=c+n.width,p=-r._y*n.height,f=p+n.height;e[0]=s*c+o*p+h,e[1]=l*p+a*c+u,e[2]=s*d+o*p+h,e[3]=l*p+a*d+u,e[4]=s*d+o*f+h,e[5]=l*f+a*d+u,e[6]=s*c+o*f+h,e[7]=l*f+a*c+u},e.prototype._render=function(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},e.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new xn),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,Zo);var e=this._texture.orig.width,n=this._texture.orig.height,r=-e*this.anchor.x,i=0;return Zo.x>=r&&Zo.x<r+e&&(i=-n*this.anchor.y,Zo.y>=i&&Zo.y<i+n)},e.prototype.destroy=function(e){if(t.prototype.destroy.call(this,e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof e?e:e&&e.texture){var n="boolean"==typeof e?e:e&&e.baseTexture;this._texture.destroy(!!n)}this._texture=null},e.from=function(t,n){return new e(t instanceof Yr?t:Yr.from(t,n))},Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){var e=Ze(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){var e=Ze(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Yr.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),e}(or),tl=function(t,e){return tl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},tl(t,e)};!function(t){t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"}(Ko||(Ko={}));var el={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Ko.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},nl=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],rl=function(){function t(t){this.styleID=0,this.reset(),al(this,t,t)}return t.prototype.clone=function(){var e={};return al(e,this,el),new t(e)},t.prototype.reset=function(){al(this,el,el)},Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"breakWords",{get:function(){return this._breakWords},set:function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(t){var e=sl(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fill",{get:function(){return this._fill},set:function(t){var e=sl(t);this._fill!==e&&(this._fill=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leading",{get:function(){return this._leading},set:function(t){this._leading!==t&&(this._leading=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stroke",{get:function(){return this._stroke},set:function(t){var e=sl(t);this._stroke!==e&&(this._stroke=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trim",{get:function(){return this._trim},set:function(t){this._trim!==t&&(this._trim=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)},enumerable:!1,configurable:!0}),t.prototype.toFontString=function(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var n=e.length-1;n>=0;n--){var r=e[n].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&nl.indexOf(r)<0&&(r='"'+r+'"'),e[n]=r}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},t}();function il(t){return"number"==typeof t?De(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function sl(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=il(t[e]);return t}return il(t)}function al(t,e,n){for(var r in n)Array.isArray(e[r])?t[r]=e[r].slice():t[r]=e[r]}var ol=function(){function t(t,e,n,r,i,s,a,o,l){this.text=t,this.style=e,this.width=n,this.height=r,this.lines=i,this.lineWidths=s,this.lineHeight=a,this.maxLineWidth=o,this.fontProperties=l}return t.measureText=function(e,n,r,i){void 0===i&&(i=t._canvas),r=null==r?n.wordWrap:r;var s=n.toFontString(),a=t.measureFont(s);0===a.fontSize&&(a.fontSize=n.fontSize,a.ascent=n.fontSize);var o=i.getContext("2d");o.font=s;for(var l=(r?t.wordWrap(e,n,i):e).split(/(?:\r\n|\r|\n)/),h=new Array(l.length),u=0,c=0;c<l.length;c++){var d=o.measureText(l[c]).width+(l[c].length-1)*n.letterSpacing;h[c]=d,u=Math.max(u,d)}var p=u+n.strokeThickness;n.dropShadow&&(p+=n.dropShadowDistance);var f=n.lineHeight||a.fontSize+n.strokeThickness,m=Math.max(f,a.fontSize+n.strokeThickness)+(l.length-1)*(f+n.leading);return n.dropShadow&&(m+=n.dropShadowDistance),new t(e,n,p,m,l,h,f+n.leading,u,a)},t.wordWrap=function(e,n,r){void 0===r&&(r=t._canvas);for(var i=r.getContext("2d"),s=0,a="",o="",l=Object.create(null),h=n.letterSpacing,u=n.whiteSpace,c=t.collapseSpaces(u),d=t.collapseNewlines(u),p=!c,f=n.wordWrapWidth+h,m=t.tokenize(e),g=0;g<m.length;g++){var y=m[g];if(t.isNewline(y)){if(!d){o+=t.addLine(a),p=!c,a="",s=0;continue}y=" "}if(c){var v=t.isBreakingSpace(y),x=t.isBreakingSpace(a[a.length-1]);if(v&&x)continue}var b=t.getFromCache(y,h,l,i);if(b>f)if(""!==a&&(o+=t.addLine(a),a="",s=0),t.canBreakWords(y,n.breakWords))for(var w=t.wordWrapSplit(y),_=0;_<w.length;_++){for(var T=w[_],E=1;w[_+E];){var S=w[_+E],I=T[T.length-1];if(t.canBreakChars(I,S,y,_,n.breakWords))break;T+=S,E++}_+=T.length-1;var k=t.getFromCache(T,h,l,i);k+s>f&&(o+=t.addLine(a),p=!1,a="",s=0),a+=T,s+=k}else{a.length>0&&(o+=t.addLine(a),a="",s=0);var C=g===m.length-1;o+=t.addLine(y,!C),p=!1,a="",s=0}else b+s>f&&(p=!1,o+=t.addLine(a),a="",s=0),(a.length>0||!t.isBreakingSpace(y)||p)&&(a+=y,s+=b)}return o+=t.addLine(a,!1)},t.addLine=function(e,n){return void 0===n&&(n=!0),e=t.trimRight(e),e=n?e+"\n":e},t.getFromCache=function(t,e,n,r){var i=n[t];if("number"!=typeof i){var s=t.length*e;i=r.measureText(t).width+s,n[t]=i}return i},t.collapseSpaces=function(t){return"normal"===t||"pre-line"===t},t.collapseNewlines=function(t){return"normal"===t},t.trimRight=function(e){if("string"!=typeof e)return"";for(var n=e.length-1;n>=0;n--){var r=e[n];if(!t.isBreakingSpace(r))break;e=e.slice(0,-1)}return e},t.isNewline=function(e){return"string"==typeof e&&t._newlines.indexOf(e.charCodeAt(0))>=0},t.isBreakingSpace=function(e,n){return"string"==typeof e&&t._breakingSpaces.indexOf(e.charCodeAt(0))>=0},t.tokenize=function(e){var n=[],r="";if("string"!=typeof e)return n;for(var i=0;i<e.length;i++){var s=e[i],a=e[i+1];t.isBreakingSpace(s,a)||t.isNewline(s)?(""!==r&&(n.push(r),r=""),n.push(s)):r+=s}return""!==r&&n.push(r),n},t.canBreakWords=function(t,e){return e},t.canBreakChars=function(t,e,n,r,i){return!0},t.wordWrapSplit=function(t){return t.split("")},t.measureFont=function(e){if(t._fonts[e])return t._fonts[e];var n={ascent:0,descent:0,fontSize:0},r=t._canvas,i=t._context;i.font=e;var s=t.METRICS_STRING+t.BASELINE_SYMBOL,a=Math.ceil(i.measureText(s).width),o=Math.ceil(i.measureText(t.BASELINE_SYMBOL).width),l=Math.ceil(t.HEIGHT_MULTIPLIER*o);o=o*t.BASELINE_MULTIPLIER|0,r.width=a,r.height=l,i.fillStyle="#f00",i.fillRect(0,0,a,l),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(s,0,o);var h=i.getImageData(0,0,a,l).data,u=h.length,c=4*a,d=0,p=0,f=!1;for(d=0;d<o;++d){for(var m=0;m<c;m+=4)if(255!==h[p+m]){f=!0;break}if(f)break;p+=c}for(n.ascent=o-d,p=u-c,f=!1,d=l;d>o;--d){for(m=0;m<c;m+=4)if(255!==h[p+m]){f=!0;break}if(f)break;p-=c}return n.descent=d-o,n.fontSize=n.ascent+n.descent,t._fonts[e]=n,n},t.clearMetrics=function(e){void 0===e&&(e=""),e?delete t._fonts[e]:t._fonts={}},t}(),ll=function(){try{var t=new OffscreenCanvas(0,0),e=t.getContext("2d");return e&&e.measureText?t:document.createElement("canvas")}catch(t){return document.createElement("canvas")}}();ll.width=ll.height=10,ol._canvas=ll,ol._context=ll.getContext("2d"),ol._fonts={},ol.METRICS_STRING="|ÉqÅ",ol.BASELINE_SYMBOL="M",ol.BASELINE_MULTIPLIER=1.4,ol.HEIGHT_MULTIPLIER=2,ol._newlines=[10,13],ol._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var hl={texture:!0,children:!1,baseTexture:!0},ul="letterSpacing"in CanvasRenderingContext2D.prototype||"textLetterSpacing"in CanvasRenderingContext2D.prototype,cl=function(t){function e(e,n,r){var i=this,s=!1;r||(r=document.createElement("canvas"),s=!0),r.width=3,r.height=3;var a=Yr.from(r);return a.orig=new xn,a.trim=new xn,(i=t.call(this,a)||this)._ownCanvas=s,i.canvas=r,i.context=i.canvas.getContext("2d"),i._resolution=we.RESOLUTION,i._autoResolution=!0,i._text=null,i._style=null,i._styleListener=null,i._font="",i.text=e,i.style=n,i.localStyleID=-1,i}return function(t,e){function n(){this.constructor=t}tl(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.updateText=function(t){var n=this._style;if(this.localStyleID!==n.styleID&&(this.dirty=!0,this.localStyleID=n.styleID),this.dirty||!t){this._font=this._style.toFontString();var r,i,s=this.context,a=ol.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),o=a.width,l=a.height,h=a.lines,u=a.lineHeight,c=a.lineWidths,d=a.maxLineWidth,p=a.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,o)+2*n.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,l)+2*n.padding)*this._resolution),s.scale(this._resolution,this._resolution),s.clearRect(0,0,this.canvas.width,this.canvas.height),s.font=this._font,s.lineWidth=n.strokeThickness,s.textBaseline=n.textBaseline,s.lineJoin=n.lineJoin,s.miterLimit=n.miterLimit;for(var f=n.dropShadow?2:1,m=0;m<f;++m){var g=n.dropShadow&&0===m,y=g?Math.ceil(Math.max(1,l)+2*n.padding):0,v=y*this._resolution;if(g){s.fillStyle="black",s.strokeStyle="black";var x=n.dropShadowColor,b=Pe("number"==typeof x?x:Fe(x));s.shadowColor="rgba("+255*b[0]+","+255*b[1]+","+255*b[2]+","+n.dropShadowAlpha+")",s.shadowBlur=n.dropShadowBlur,s.shadowOffsetX=Math.cos(n.dropShadowAngle)*n.dropShadowDistance,s.shadowOffsetY=Math.sin(n.dropShadowAngle)*n.dropShadowDistance+v}else s.fillStyle=this._generateFillStyle(n,h,a),s.strokeStyle=n.stroke,s.shadowColor="black",s.shadowBlur=0,s.shadowOffsetX=0,s.shadowOffsetY=0;var w=(u-p.fontSize)/2;(!e.nextLineHeightBehavior||u-p.fontSize<0)&&(w=0);for(var _=0;_<h.length;_++)r=n.strokeThickness/2,i=n.strokeThickness/2+_*u+p.ascent+w,"right"===n.align?r+=d-c[_]:"center"===n.align&&(r+=(d-c[_])/2),n.stroke&&n.strokeThickness&&this.drawLetterSpacing(h[_],r+n.padding,i+n.padding-y,!0),n.fill&&this.drawLetterSpacing(h[_],r+n.padding,i+n.padding-y)}this.updateTexture()}},e.prototype.drawLetterSpacing=function(t,e,n,r){void 0===r&&(r=!1);var i=this._style.letterSpacing;if(0===i||ul)return ul&&(this.context.letterSpacing=i,this.context.textLetterSpacing=i),void(r?this.context.strokeText(t,e,n):this.context.fillText(t,e,n));for(var s=e,a=Array.from?Array.from(t):t.split(""),o=this.context.measureText(t).width,l=0,h=0;h<a.length;++h){var u=a[h];r?this.context.strokeText(u,s,n):this.context.fillText(u,s,n),s+=o-(l=this.context.measureText(t.substring(h+1)).width)+i,o=l}},e.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var e=hn(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}var n=this._texture,r=this._style,i=r.trim?0:r.padding,s=n.baseTexture;n.trim.width=n._frame.width=t.width/this._resolution,n.trim.height=n._frame.height=t.height/this._resolution,n.trim.x=-i,n.trim.y=-i,n.orig.width=n._frame.width-2*i,n.orig.height=n._frame.height-2*i,this._onTextureUpdate(),s.setRealSize(t.width,t.height,this._resolution),n.updateUvs(),this._recursivePostUpdateTransform(),this.dirty=!1},e.prototype._render=function(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),t.prototype._render.call(this,e)},e.prototype.getLocalBounds=function(e){return this.updateText(!0),t.prototype.getLocalBounds.call(this,e)},e.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},e.prototype._generateFillStyle=function(t,e,n){var r,i=t.fill;if(!Array.isArray(i))return i;if(1===i.length)return i[0];var s=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,o=this.canvas.width/this._resolution-s-2*a,l=this.canvas.height/this._resolution-s-2*a,h=i.slice(),u=t.fillGradientStops.slice();if(!u.length)for(var c=h.length+1,d=1;d<c;++d)u.push(d/c);if(h.unshift(i[0]),u.unshift(0),h.push(i[i.length-1]),u.push(1),t.fillGradientType===Ko.LINEAR_VERTICAL){r=this.context.createLinearGradient(o/2,a,o/2,l+a);var p=n.fontProperties.fontSize+t.strokeThickness;for(d=0;d<e.length;d++){var f=n.lineHeight*(d-1)+p,m=n.lineHeight*d,g=m;d>0&&f>m&&(g=(m+f)/2);var y=m+p,v=n.lineHeight*(d+1),x=y;d+1<e.length&&v<y&&(x=(y+v)/2);for(var b=(x-g)/l,w=0;w<h.length;w++){var _=0;_="number"==typeof u[w]?u[w]:w/h.length;var T=Math.min(1,Math.max(0,g/l+_*b));T=Number(T.toFixed(5)),r.addColorStop(T,h[w])}}}else{r=this.context.createLinearGradient(a,l/2,o+a,l/2);var E=h.length+1,S=1;for(d=0;d<h.length;d++){var I=void 0;I="number"==typeof u[d]?u[d]:S/E,r.addColorStop(I,h[d]),S++}}return r},e.prototype.destroy=function(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},hl,e),t.prototype.destroy.call(this,e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(e.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){this.updateText(!0);var e=Ze(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){this.updateText(!0);var e=Ze(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(t){t=t||{},this._style=t instanceof rl?t:new rl(t),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},enumerable:!1,configurable:!0}),e.nextLineHeightBehavior=!1,e}(Qo);we.UPLOADS_PER_FRAME=4;var dl=function(t,e){return dl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},dl(t,e)};var pl=function(){function t(t){this.maxItemsPerFrame=t,this.itemsLeft=0}return t.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},t.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},t}();function fl(t,e){var n=!1;if(t&&t._textures&&t._textures.length)for(var r=0;r<t._textures.length;r++)if(t._textures[r]instanceof Yr){var i=t._textures[r].baseTexture;-1===e.indexOf(i)&&(e.push(i),n=!0)}return n}function ml(t,e){if(t.baseTexture instanceof Rr){var n=t.baseTexture;return-1===e.indexOf(n)&&e.push(n),!0}return!1}function gl(t,e){if(t._texture&&t._texture instanceof Yr){var n=t._texture.baseTexture;return-1===e.indexOf(n)&&e.push(n),!0}return!1}function yl(t,e){return e instanceof cl&&(e.updateText(!0),!0)}function vl(t,e){if(e instanceof rl){var n=e.toFontString();return ol.measureFont(n),!0}return!1}function xl(t,e){if(t instanceof cl){-1===e.indexOf(t.style)&&e.push(t.style),-1===e.indexOf(t)&&e.push(t);var n=t._texture.baseTexture;return-1===e.indexOf(n)&&e.push(n),!0}return!1}function bl(t,e){return t instanceof rl&&(-1===e.indexOf(t)&&e.push(t),!0)}var wl=function(){function t(t){var e=this;this.limiter=new pl(we.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){e.queue&&e.prepareItems()},this.registerFindHook(xl),this.registerFindHook(bl),this.registerFindHook(fl),this.registerFindHook(ml),this.registerFindHook(gl),this.registerUploadHook(yl),this.registerUploadHook(vl)}return t.prototype.upload=function(t,e){"function"==typeof t&&(e=t,t=null),t&&this.add(t),this.queue.length?(e&&this.completes.push(e),this.ticking||(this.ticking=!0,dr.system.addOnce(this.tick,this,hr.UTILITY))):e&&e()},t.prototype.tick=function(){setTimeout(this.delayedTick,0)},t.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0],e=!1;if(t&&!t._destroyed)for(var n=0,r=this.uploadHooks.length;n<r;n++)if(this.uploadHooks[n](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)dr.system.addOnce(this.tick,this,hr.UTILITY);else{this.ticking=!1;var i=this.completes.slice(0);this.completes.length=0;for(n=0,r=i.length;n<r;n++)i[n]()}},t.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},t.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},t.prototype.add=function(t){for(var e=0,n=this.addHooks.length;e<n&&!this.addHooks[e](t,this.queue);e++);if(t instanceof or)for(e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this},t.prototype.destroy=function(){this.ticking&&dr.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},t}();function _l(t,e){return e instanceof Rr&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function Tl(t,e){if(!(e instanceof Yo))return!1;var n=e.geometry;e.finishPoly(),n.updateBatches();for(var r=n.batches,i=0;i<r.length;i++){var s=r[i].style.texture;s&&_l(t,s.baseTexture)}return n.batchable||t.geometry.bind(n,e._resolveDirectShader(t)),!0}function El(t,e){return t instanceof Yo&&(e.push(t),!0)}var Sl=function(t){function e(e){var n=t.call(this,e)||this;return n.uploadHookHelper=n.renderer,n.registerFindHook(El),n.registerUploadHook(_l),n.registerUploadHook(Tl),n}return function(t,e){function n(){this.constructor=t}dl(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e}(wl),Il=function(){function t(t){this.maxMilliseconds=t,this.frameStart=0}return t.prototype.beginFrame=function(){this.frameStart=Date.now()},t.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},t}(),kl=function(){function t(t,e,n){void 0===n&&(n=null),this._texture=t instanceof Yr?t:null,this.baseTexture=t instanceof Rr?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;var r=this.baseTexture.resource;this.resolution=this._updateResolution(n||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return t.prototype._updateResolution=function(t){void 0===t&&(t=null);var e=this.data.meta.scale,n=fn(t,null);return null===n&&(n=void 0!==e?parseFloat(e):1),1!==n&&this.baseTexture.setResolution(n),n},t.prototype.parse=function(e){this._batchIndex=0,this._callback=e,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},t.prototype._processFrames=function(e){for(var n=e,r=t.BATCH_SIZE;n-e<r&&n<this._frameKeys.length;){var i=this._frameKeys[n],s=this._frames[i],a=s.frame;if(a){var o=null,l=null,h=!1!==s.trimmed&&s.sourceSize?s.sourceSize:s.frame,u=new xn(0,0,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution);o=s.rotated?new xn(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):new xn(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),!1!==s.trimmed&&s.spriteSourceSize&&(l=new xn(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[i]=new Yr(this.baseTexture,o,u,l,s.rotated?2:0,s.anchor),Yr.addToCache(this.textures[i],i)}n++}},t.prototype._processAnimations=function(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];for(var n=0;n<t[e].length;n++){var r=t[e][n];this.animations[e].push(this.textures[r])}}},t.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},t.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout((function(){e._batchIndex*t.BATCH_SIZE<e._frameKeys.length?e._nextBatch():(e._processAnimations(),e._parseComplete())}),0)},t.prototype.destroy=function(t){var e;for(var n in void 0===t&&(t=!1),this.textures)this.textures[n].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(null===(e=this._texture)||void 0===e||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null},t.BATCH_SIZE=1e3,t}(),Cl=function(){function t(){}return t.use=function(e,n){var r,i,s=this,a=e.name+"_image";if(e.data&&e.type===la.TYPE.JSON&&e.data.frames&&!s.resources[a]){var o=null===(i=null===(r=e.data)||void 0===r?void 0:r.meta)||void 0===i?void 0:i.related_multi_packs;if(Array.isArray(o))for(var l=function(t){if("string"!=typeof t)return"continue";var n=t.replace(".json",""),r=ke.resolve(e.url.replace(s.baseUrl,""),t);if(s.resources[n]||Object.values(s.resources).some((function(t){return ke.format(ke.parse(t.url))===r})))return"continue";var i={crossOrigin:e.crossOrigin,loadType:la.LOAD_TYPE.XHR,xhrType:la.XHR_RESPONSE_TYPE.JSON,parentResource:e,metadata:e.metadata};s.add(n,r,i)},h=0,u=o;h<u.length;h++){l(u[h])}var c={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},d=t.getResourcePath(e,s.baseUrl);s.add(a,d,c,(function(t){if(t.error)n(t.error);else{var r=new kl(t.texture,e.data,e.url);r.parse((function(){e.spritesheet=r,e.textures=r.textures,n()}))}}))}else n()},t.getResourcePath=function(t,e){return t.isDataUrl?t.data.meta.image:ke.resolve(t.url.replace(e,""),t.data.meta.image)},t}(),Nl=function(t,e){return Nl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},Nl(t,e)};function Al(t,e){function n(){this.constructor=t}Nl(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var Rl=new En,Ml=function(t){function e(e,n,r){void 0===n&&(n=100),void 0===r&&(r=100);var i=t.call(this,e)||this;return i.tileTransform=new Dn,i._width=n,i._height=r,i.uvMatrix=i.texture.uvMatrix||new Zi(e),i.pluginName="tilingSprite",i.uvRespectAnchor=!1,i}return Al(e,t),Object.defineProperty(e.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(t){this.tileTransform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(t){this.tileTransform.position.copyFrom(t)},enumerable:!1,configurable:!0}),e.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},e.prototype._render=function(t){var e=this._texture;e&&e.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},e.prototype._calculateBounds=function(){var t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,n=this._width*(1-this._anchor._x),r=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,n,r)},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new xn),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,Rl);var e=this._width,n=this._height,r=-e*this.anchor._x;if(Rl.x>=r&&Rl.x<r+e){var i=-n*this.anchor._y;if(Rl.y>=i&&Rl.y<i+n)return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.tileTransform=null,this.uvMatrix=null},e.from=function(t,n){return new e(t instanceof Yr?t:Yr.from(t,n),n.width,n.height)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!1,configurable:!0}),e}(Qo),Ol="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",Pl=new In,Dl=function(t){function e(e){var n=t.call(this,e)||this;return e.runners.contextChange.add(n),n.quad=new ai,n.state=ji.for2d(),n}return Al(e,t),e.prototype.contextChange=function(){var t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Yi.from(Ol,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?Yi.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):Yi.from(Ol,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)},e.prototype.render=function(t){var e=this.renderer,n=this.quad,r=n.vertices;r[0]=r[6]=t._width*-t.anchor.x,r[1]=r[3]=t._height*-t.anchor.y,r[2]=r[4]=t._width*(1-t.anchor.x),r[5]=r[7]=t._height*(1-t.anchor.y);var i=t.uvRespectAnchor?t.anchor.x:0,s=t.uvRespectAnchor?t.anchor.y:0;(r=n.uvs)[0]=r[6]=-i,r[1]=r[3]=-s,r[2]=r[4]=1-i,r[5]=r[7]=1-s,n.invalidate();var a=t._texture,o=a.baseTexture,l=t.tileTransform.localTransform,h=t.uvMatrix,u=o.isPowerOfTwo&&a.frame.width===o.width&&a.frame.height===o.height;u&&(o._glTextures[e.CONTEXT_UID]?u=o.wrapMode!==de.CLAMP:o.wrapMode===de.CLAMP&&(o.wrapMode=de.REPEAT));var c=u?this.simpleShader:this.shader,d=a.width,p=a.height,f=t._width,m=t._height;Pl.set(l.a*d/f,l.b*d/m,l.c*p/f,l.d*p/m,l.tx/f,l.ty/m),Pl.invert(),u?Pl.prepend(h.mapCoord):(c.uniforms.uMapCoord=h.mapCoord.toArray(!0),c.uniforms.uClampFrame=h.uClampFrame,c.uniforms.uClampOffset=h.uClampOffset),c.uniforms.uTransform=Pl.toArray(!0),c.uniforms.uColor=ze(t.tint,t.worldAlpha,c.uniforms.uColor,o.alphaMode),c.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),c.uniforms.uSampler=a,e.shader.bind(c),e.geometry.bind(n),this.state.blendMode=$e(t.blendMode,o.alphaMode),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},e}(pi),Fl=function(t,e){return Fl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},Fl(t,e)};function Ll(t,e){function n(){this.constructor=t}Fl(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var Bl=function(){function t(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return t.prototype.update=function(t){if(t||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}},t}(),$l=new En,Ul=new _n,Vl=function(t){function e(e,n,r,i){void 0===i&&(i=ae.TRIANGLES);var s=t.call(this)||this;return s.geometry=e,s.shader=n,s.state=r||ji.for2d(),s.drawMode=i,s.start=0,s.size=0,s.uvs=null,s.indices=null,s.vertexData=new Float32Array(1),s.vertexDirty=-1,s._transformID=-1,s._roundPixels=we.ROUND_PIXELS,s.batchUvs=null,s}return Ll(e,t),Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this.shader},set:function(t){this.shader=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return"tint"in this.shader?this.shader.tint:null},set:function(t){this.shader.tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return"texture"in this.shader?this.shader.texture:null},set:function(t){this.shader.texture=t},enumerable:!1,configurable:!0}),e.prototype._render=function(t){var n=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===ae.TRIANGLES&&n.length<2*e.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)},e.prototype._renderDefault=function(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},e.prototype._renderToBatch=function(t){var e=this.geometry,n=this.shader;n.uvMatrix&&(n.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=n._tintRGB,this._texture=n.texture;var r=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[r]),t.plugins[r].render(this)},e.prototype.calculateVertices=function(){var t=this.geometry.buffers[0],e=t.data,n=t._updateID;if(n!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));for(var r=this.transform.worldTransform,i=r.a,s=r.b,a=r.c,o=r.d,l=r.tx,h=r.ty,u=this.vertexData,c=0;c<u.length/2;c++){var d=e[2*c],p=e[2*c+1];u[2*c]=i*d+a*p+l,u[2*c+1]=s*d+o*p+h}if(this._roundPixels){var f=we.RESOLUTION;for(c=0;c<u.length;++c)u[c]=Math.round((u[c]*f|0)/f)}this.vertexDirty=n}},e.prototype.calculateUvs=function(){var t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Bl(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},e.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,$l);for(var e=this.geometry.getBuffer("aVertexPosition").data,n=Ul.points,r=this.geometry.getIndex().data,i=r.length,s=4===this.drawMode?3:1,a=0;a+2<i;a+=s){var o=2*r[a],l=2*r[a+1],h=2*r[a+2];if(n[0]=e[o],n[1]=e[o+1],n[2]=e[l],n[3]=e[l+1],n[4]=e[h],n[5]=e[h+1],Ul.contains($l.x,$l.y))return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},e.BATCHABLE_SIZE=100,e}(or),zl=function(t){function e(e,n){var r=this,i={uSampler:e,alpha:1,uTextureMatrix:In.IDENTITY,uColor:new Float32Array([1,1,1,1])};return(n=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},n)).uniforms&&Object.assign(i,n.uniforms),(r=t.call(this,n.program||Hi.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),i)||this)._colorDirty=!1,r.uvMatrix=new Zi(e),r.batchable=void 0===n.program,r.pluginName=n.pluginName,r.tint=n.tint,r.alpha=n.alpha,r}return Ll(e,t),Object.defineProperty(e.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(t){this.uniforms.uSampler!==t&&(this.uniforms.uSampler=t,this.uvMatrix.texture=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var t=this.texture.baseTexture;ze(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},e}(Yi),Gl=function(t){function e(e,n,r){var i=t.call(this)||this,s=new Qr(e),a=new Qr(n,!0),o=new Qr(r,!0,!0);return i.addAttribute("aVertexPosition",s,2,!1,he.FLOAT).addAttribute("aTextureCoord",a,2,!1,he.FLOAT).addIndex(o),i._updateId=-1,i}return Ll(e,t),Object.defineProperty(e.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),e}(ii),Wl=function(t,e){return Wl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},Wl(t,e)};var Xl=function(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]},Hl=function(){function t(){}return t.test=function(t){return"string"==typeof t&&0===t.indexOf("info face=")},t.parse=function(t){var e=t.match(/^[a-z]+\s+.+$/gm),n={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(var r in e){var i=e[r].match(/^[a-z]+/gm)[0],s=e[r].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),a={};for(var o in s){var l=s[o].split("="),h=l[0],u=l[1].replace(/"/gm,""),c=parseFloat(u),d=isNaN(c)?u:c;a[h]=d}n[i].push(a)}var p=new Xl;return n.info.forEach((function(t){return p.info.push({face:t.face,size:parseInt(t.size,10)})})),n.common.forEach((function(t){return p.common.push({lineHeight:parseInt(t.lineHeight,10)})})),n.page.forEach((function(t){return p.page.push({id:parseInt(t.id,10),file:t.file})})),n.char.forEach((function(t){return p.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)})})),n.kerning.forEach((function(t){return p.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)})})),n.distanceField.forEach((function(t){return p.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType})})),p},t}(),Yl=function(){function t(){}return t.test=function(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")},t.parse=function(t){for(var e=new Xl,n=t.getElementsByTagName("info"),r=t.getElementsByTagName("common"),i=t.getElementsByTagName("page"),s=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),o=t.getElementsByTagName("distanceField"),l=0;l<n.length;l++)e.info.push({face:n[l].getAttribute("face"),size:parseInt(n[l].getAttribute("size"),10)});for(l=0;l<r.length;l++)e.common.push({lineHeight:parseInt(r[l].getAttribute("lineHeight"),10)});for(l=0;l<i.length;l++)e.page.push({id:parseInt(i[l].getAttribute("id"),10)||0,file:i[l].getAttribute("file")});for(l=0;l<s.length;l++){var h=s[l];e.char.push({id:parseInt(h.getAttribute("id"),10),page:parseInt(h.getAttribute("page"),10)||0,x:parseInt(h.getAttribute("x"),10),y:parseInt(h.getAttribute("y"),10),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10),xoffset:parseInt(h.getAttribute("xoffset"),10),yoffset:parseInt(h.getAttribute("yoffset"),10),xadvance:parseInt(h.getAttribute("xadvance"),10)})}for(l=0;l<a.length;l++)e.kerning.push({first:parseInt(a[l].getAttribute("first"),10),second:parseInt(a[l].getAttribute("second"),10),amount:parseInt(a[l].getAttribute("amount"),10)});for(l=0;l<o.length;l++)e.distanceField.push({fieldType:o[l].getAttribute("fieldType"),distanceRange:parseInt(o[l].getAttribute("distanceRange"),10)});return e},t}(),jl=function(){function t(){}return t.test=function(t){if("string"==typeof t&&t.indexOf("<font>")>-1){var e=(new self.DOMParser).parseFromString(t,"text/xml");return Yl.test(e)}return!1},t.parse=function(t){var e=(new self.DOMParser).parseFromString(t,"text/xml");return Yl.parse(e)},t}(),ql=[Hl,Yl,jl];function Kl(t){for(var e=0;e<ql.length;e++)if(ql[e].test(t))return ql[e];return null}function Zl(t,e,n,r,i,s,a){var o=n.text,l=n.fontProperties;e.translate(r,i),e.scale(s,s);var h=a.strokeThickness/2,u=-a.strokeThickness/2;e.font=a.toFontString(),e.lineWidth=a.strokeThickness,e.textBaseline=a.textBaseline,e.lineJoin=a.lineJoin,e.miterLimit=a.miterLimit,e.fillStyle=function(t,e,n,r,i,s){var a,o=n.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];var l=n.dropShadow?n.dropShadowDistance:0,h=n.padding||0,u=t.width/r-l-2*h,c=t.height/r-l-2*h,d=o.slice(),p=n.fillGradientStops.slice();if(!p.length)for(var f=d.length+1,m=1;m<f;++m)p.push(m/f);if(d.unshift(o[0]),p.unshift(0),d.push(o[o.length-1]),p.push(1),n.fillGradientType===Ko.LINEAR_VERTICAL){a=e.createLinearGradient(u/2,h,u/2,c+h);var g=0,y=(s.fontProperties.fontSize+n.strokeThickness)/c;for(m=0;m<i.length;m++)for(var v=s.lineHeight*m,x=0;x<d.length;x++){var b=v/c+("number"==typeof p[x]?p[x]:x/d.length)*y,w=Math.max(g,b);w=Math.min(w,1),a.addColorStop(w,d[x]),g=w}}else{a=e.createLinearGradient(h,c/2,u+h,c/2);var _=d.length+1,T=1;for(m=0;m<d.length;m++){var E=void 0;E="number"==typeof p[m]?p[m]:T/_,a.addColorStop(E,d[m]),T++}}return a}(t,e,a,s,[o],n),e.strokeStyle=a.stroke;var c=a.dropShadowColor,d=Pe("number"==typeof c?c:Fe(c));a.dropShadow?(e.shadowColor="rgba("+255*d[0]+","+255*d[1]+","+255*d[2]+","+a.dropShadowAlpha+")",e.shadowBlur=a.dropShadowBlur,e.shadowOffsetX=Math.cos(a.dropShadowAngle)*a.dropShadowDistance,e.shadowOffsetY=Math.sin(a.dropShadowAngle)*a.dropShadowDistance):(e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),a.stroke&&a.strokeThickness&&e.strokeText(o,h,u+n.lineHeight-l.descent),a.fill&&e.fillText(o,h,u+n.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function Jl(t){return Array.from?Array.from(t):t.split("")}function Ql(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}var th=function(){function t(t,e,n){var r,i,s=t.info[0],a=t.common[0],o=t.page[0],l=t.distanceField[0],h=fn(o.file),u={};this._ownsTextures=n,this.font=s.face,this.size=s.size,this.lineHeight=a.lineHeight/h,this.chars={},this.pageTextures=u;for(var c=0;c<t.page.length;c++){var d=t.page[c],p=d.id,f=d.file;u[p]=e instanceof Array?e[c]:e[f],(null==l?void 0:l.fieldType)&&"none"!==l.fieldType&&(u[p].baseTexture.alphaMode=fe.NO_PREMULTIPLIED_ALPHA)}for(c=0;c<t.char.length;c++){var m=t.char[c],g=(p=m.id,m.page),y=t.char[c],v=y.x,x=y.y,b=y.width,w=y.height,_=y.xoffset,T=y.yoffset,E=y.xadvance;x/=h,b/=h,w/=h,_/=h,T/=h,E/=h;var S=new xn((v/=h)+u[g].frame.x/h,x+u[g].frame.y/h,b,w);this.chars[p]={xOffset:_,yOffset:T,xAdvance:E,kerning:{},texture:new Yr(u[g].baseTexture,S),page:g}}for(c=0;c<t.kerning.length;c++){var I=t.kerning[c],k=I.first,C=I.second,N=I.amount;k/=h,C/=h,N/=h,this.chars[C]&&(this.chars[C].kerning[k]=N)}this.distanceFieldRange=null==l?void 0:l.distanceRange,this.distanceFieldType=null!==(i=null===(r=null==l?void 0:l.fieldType)||void 0===r?void 0:r.toLowerCase())&&void 0!==i?i:"none"}return t.prototype.destroy=function(){for(var t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(var t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null},t.install=function(e,n,r){var i;if(e instanceof Xl)i=e;else{var s=Kl(e);if(!s)throw new Error("Unrecognized data format for font.");i=s.parse(e)}n instanceof Yr&&(n=[n]);var a=new t(i,n,r);return t.available[a.font]=a,a},t.uninstall=function(e){var n=t.available[e];if(!n)throw new Error("No font found named '"+e+"'");n.destroy(),delete t.available[e]},t.from=function(e,n,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");var i=Object.assign({},t.defaultOptions,r),s=i.chars,a=i.padding,o=i.resolution,l=i.textureWidth,h=i.textureHeight,u=function(t){"string"==typeof t&&(t=[t]);for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];if(Array.isArray(i)){if(2!==i.length)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+i.length+".");var s=i[0].charCodeAt(0),a=i[1].charCodeAt(0);if(a<s)throw new Error("[BitmapFont]: Invalid character range.");for(var o=s,l=a;o<=l;o++)e.push(String.fromCharCode(o))}else e.push.apply(e,Jl(i))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(s),c=n instanceof rl?n:new rl(n),d=l,p=new Xl;p.info[0]={face:c.fontFamily,size:c.fontSize},p.common[0]={lineHeight:c.fontSize};for(var f,m,g,y=0,v=0,x=0,b=[],w=0;w<u.length;w++){f||((f=document.createElement("canvas")).width=l,f.height=h,m=f.getContext("2d"),g=new Rr(f,{resolution:o}),b.push(new Yr(g)),p.page.push({id:b.length-1,file:""}));var _=ol.measureText(u[w],c,!1,f),T=_.width,E=Math.ceil(_.height),S=Math.ceil(("italic"===c.fontStyle?2:1)*T);if(v>=h-E*o){if(0===v)throw new Error("[BitmapFont] textureHeight "+h+"px is too small for "+c.fontSize+"px fonts");--w,f=null,m=null,g=null,v=0,y=0,x=0}else if(x=Math.max(E+_.fontProperties.descent,x),S*o+y>=d)--w,v+=x*o,v=Math.ceil(v),y=0,x=0;else{Zl(f,m,_,y,v,o,c);var I=Ql(_.text);p.char.push({id:I,page:b.length-1,x:y/o,y:v/o,width:S,height:E,xoffset:0,yoffset:0,xadvance:Math.ceil(T-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0))}),y+=(S+2*a)*o,y=Math.ceil(y)}}w=0;for(var k=u.length;w<k;w++)for(var C=u[w],N=0;N<k;N++){var A=u[N],R=m.measureText(C).width,M=m.measureText(A).width,O=m.measureText(C+A).width-(R+M);O&&p.kerning.push({first:Ql(C),second:Ql(A),amount:O})}var P=new t(p,b,!0);return void 0!==t.available[e]&&t.uninstall(e),t.available[e]=P,P},t.ALPHA=[["a","z"],["A","Z"]," "],t.NUMERIC=[["0","9"]],t.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],t.ASCII=[[" ","~"]],t.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:t.ALPHANUMERIC},t.available={},t}(),eh=[],nh=[],rh=[],ih=function(t){function e(n,r){void 0===r&&(r={});var i=t.call(this)||this;i._tint=16777215;var s=Object.assign({},e.styleDefaults,r),a=s.align,o=s.tint,l=s.maxWidth,h=s.letterSpacing,u=s.fontName,c=s.fontSize;if(!th.available[u])throw new Error('Missing BitmapFont "'+u+'"');return i._activePagesMeshData=[],i._textWidth=0,i._textHeight=0,i._align=a,i._tint=o,i._fontName=u,i._fontSize=c||th.available[u].size,i._text=n,i._maxWidth=l,i._maxLineHeight=0,i._letterSpacing=h,i._anchor=new Sn((function(){i.dirty=!0}),i,0,0),i._roundPixels=we.ROUND_PIXELS,i.dirty=!0,i._textureCache={},i}return function(t,e){function n(){this.constructor=t}Wl(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.updateText=function(){for(var t,e=th.available[this._fontName],n=this._fontSize/e.size,r=new En,i=[],s=[],a=[],o=Jl(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),l=this._maxWidth*e.size/this._fontSize,h="none"===e.distanceFieldType?eh:nh,u=null,c=0,d=0,p=0,f=-1,m=0,g=0,y=0,v=0,x=0;x<o.length;x++){var b=Ql(U=o[x]);if(/(?:\s)/.test(U)&&(f=x,m=c,v++),"\r"!==U&&"\n"!==U){var w=e.chars[b];if(w){u&&w.kerning[u]&&(r.x+=w.kerning[u]);var _=rh.pop()||{texture:Yr.EMPTY,line:0,charCode:0,prevSpaces:0,position:new En};_.texture=w.texture,_.line=p,_.charCode=b,_.position.x=r.x+w.xOffset+this._letterSpacing/2,_.position.y=r.y+w.yOffset,_.prevSpaces=v,i.push(_),c=_.position.x+w.texture.orig.width,r.x+=w.xAdvance+this._letterSpacing,y=Math.max(y,w.yOffset+w.texture.height),u=b,-1!==f&&l>0&&r.x>l&&(Ke(i,1+f-++g,1+x-f),x=f,f=-1,s.push(m),a.push(i.length>0?i[i.length-1].prevSpaces:0),d=Math.max(d,m),p++,r.x=0,r.y+=e.lineHeight,u=null,v=0)}}else s.push(c),a.push(-1),d=Math.max(d,c),++p,++g,r.x=0,r.y+=e.lineHeight,u=null,v=0}var T=o[o.length-1];"\r"!==T&&"\n"!==T&&(/(?:\s)/.test(T)&&(c=m),s.push(c),d=Math.max(d,c),a.push(-1));var E=[];for(x=0;x<=p;x++){var S=0;"right"===this._align?S=d-s[x]:"center"===this._align?S=(d-s[x])/2:"justify"===this._align&&(S=a[x]<0?0:(d-s[x])/a[x]),E.push(S)}var I=i.length,k={},C=[],N=this._activePagesMeshData;for(x=0;x<N.length;x++)h.push(N[x]);for(x=0;x<I;x++){var A=(z=i[x].texture).baseTexture.uid;if(!k[A]){if(!(q=h.pop())){var R=new Gl,M=void 0,O=void 0;"none"===e.distanceFieldType?(M=new zl(Yr.EMPTY),O=se.NORMAL):(M=new zl(Yr.EMPTY,{program:Hi.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r\n\r\n}\r\n"),uniforms:{uFWidth:0}}),O=se.NORMAL_NPM);var P=new Vl(R,M);P.blendMode=O,q={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:P,vertices:null,uvs:null,indices:null}}q.index=0,q.indexCount=0,q.vertexCount=0,q.uvsCount=0,q.total=0;var D=this._textureCache;D[A]=D[A]||new Yr(z.baseTexture),q.mesh.texture=D[A],q.mesh.tint=this._tint,C.push(q),k[A]=q}k[A].total++}for(x=0;x<N.length;x++)-1===C.indexOf(N[x])&&this.removeChild(N[x].mesh);for(x=0;x<C.length;x++)C[x].mesh.parent!==this&&this.addChild(C[x].mesh);for(var x in this._activePagesMeshData=C,k){var F=(q=k[x]).total;if(!((null===(t=q.indices)||void 0===t?void 0:t.length)>6*F)||q.vertices.length<2*Vl.BATCHABLE_SIZE)q.vertices=new Float32Array(8*F),q.uvs=new Float32Array(8*F),q.indices=new Uint16Array(6*F);else for(var L=q.total,B=q.vertices,$=4*L*2;$<B.length;$++)B[$]=0;q.mesh.size=6*F}for(x=0;x<I;x++){var U,V=(U=i[x]).position.x+E[U.line]*("justify"===this._align?U.prevSpaces:1);this._roundPixels&&(V=Math.round(V));var z,G=V*n,W=U.position.y*n,X=k[(z=U.texture).baseTexture.uid],H=z.frame,Y=z._uvs,j=X.index++;X.indices[6*j+0]=0+4*j,X.indices[6*j+1]=1+4*j,X.indices[6*j+2]=2+4*j,X.indices[6*j+3]=0+4*j,X.indices[6*j+4]=2+4*j,X.indices[6*j+5]=3+4*j,X.vertices[8*j+0]=G,X.vertices[8*j+1]=W,X.vertices[8*j+2]=G+H.width*n,X.vertices[8*j+3]=W,X.vertices[8*j+4]=G+H.width*n,X.vertices[8*j+5]=W+H.height*n,X.vertices[8*j+6]=G,X.vertices[8*j+7]=W+H.height*n,X.uvs[8*j+0]=Y.x0,X.uvs[8*j+1]=Y.y0,X.uvs[8*j+2]=Y.x1,X.uvs[8*j+3]=Y.y1,X.uvs[8*j+4]=Y.x2,X.uvs[8*j+5]=Y.y2,X.uvs[8*j+6]=Y.x3,X.uvs[8*j+7]=Y.y3}for(var x in this._textWidth=d*n,this._textHeight=(r.y+e.lineHeight)*n,k){var q=k[x];if(0!==this.anchor.x||0!==this.anchor.y)for(var K=0,Z=this._textWidth*this.anchor.x,J=this._textHeight*this.anchor.y,Q=0;Q<q.total;Q++)q.vertices[K++]-=Z,q.vertices[K++]-=J,q.vertices[K++]-=Z,q.vertices[K++]-=J,q.vertices[K++]-=Z,q.vertices[K++]-=J,q.vertices[K++]-=Z,q.vertices[K++]-=J;this._maxLineHeight=y*n;var tt=q.mesh.geometry.getBuffer("aVertexPosition"),et=q.mesh.geometry.getBuffer("aTextureCoord"),nt=q.mesh.geometry.getIndex();tt.data=q.vertices,et.data=q.uvs,nt.data=q.indices,tt.update(),et.update(),nt.update()}for(x=0;x<i.length;x++)rh.push(i[x])},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype._render=function(e){var n=th.available[this._fontName],r=n.distanceFieldRange,i=n.distanceFieldType,s=n.size;if("none"!==i)for(var a=this.worldTransform,o=a.a,l=a.b,h=a.c,u=a.d,c=Math.sqrt(o*o+l*l),d=Math.sqrt(h*h+u*u),p=(Math.abs(c)+Math.abs(d))/2,f=this._fontSize/s,m=0,g=this._activePagesMeshData;m<g.length;m++){g[m].mesh.shader.uniforms.uFWidth=p*r*f*e.resolution}t.prototype._render.call(this,e)},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){if(this._tint!==t){this._tint=t;for(var e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontName",{get:function(){return this._fontName},set:function(t){if(!th.available[t])throw new Error('Missing BitmapFont "'+t+'"');this._fontName!==t&&(this._fontName=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),e.prototype.destroy=function(e){var n=this._textureCache;for(var r in n){n[r].destroy(),delete n[r]}this._textureCache=null,t.prototype.destroy.call(this,e)},e.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},e}(or),sh=function(){function t(){}return t.add=function(){la.setExtensionXhrType("fnt",la.XHR_RESPONSE_TYPE.TEXT)},t.use=function(e,n){var r=Kl(e.data);if(r)for(var i=t.getBaseUrl(this,e),s=r.parse(e.data),a={},o=function(t){a[t.metadata.pageFile]=t.texture,Object.keys(a).length===s.page.length&&(e.bitmapFont=th.install(s,a,!0),n())},l=0;l<s.page.length;++l){var h=s.page[l].file,u=i+h,c=!1;for(var d in this.resources){var p=this.resources[d];if(p.url===u){p.metadata.pageFile=h,p.texture?o(p):p.onAfterMiddleware.add(o),c=!0;break}}if(!c){var f={crossOrigin:e.crossOrigin,loadType:la.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:h},e.metadata.imageMetadata),parentResource:e};this.add(u,f,o)}}else n()},t.getBaseUrl=function(e,n){var r=n.isDataUrl?"":t.dirname(n.url);return n.isDataUrl&&("."===r&&(r=""),e.baseUrl&&r&&"/"===e.baseUrl.charAt(e.baseUrl.length-1)&&(r+="/")),(r=r.replace(e.baseUrl,""))&&"/"!==r.charAt(r.length-1)&&(r+="/"),r},t.dirname=function(t){var e=t.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return e===t?".":""===e?"/":e},t}(),ah=function(t,e){return ah=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},ah(t,e)};var oh=function(t){function e(e){void 0===e&&(e=1);var n=t.call(this,Rs,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1})||this;return n.alpha=e,n}return function(t,e){function n(){this.constructor=t}ah(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e}(qi),lh=function(t,e){return lh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},lh(t,e)};function hh(t,e){function n(){this.constructor=t}lh(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var uh,ch,dh,ph,fh,mh,gh,yh,vh,xh,bh,wh,_h,Th,Eh,Sh,Ih,kh,Ch,Nh={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Ah=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(uh||(uh={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(ch||(ch={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(dh||(dh={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(ph||(ph={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(fh||(fh={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(mh||(mh={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(gh||(gh={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(yh||(yh={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(vh||(vh={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(xh||(xh={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(bh||(bh={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(wh||(wh={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"}(_h||(_h={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(Th||(Th={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(Eh||(Eh={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(Sh||(Sh={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(Ih||(Ih={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(kh||(kh={})),function(t){t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(Ch||(Ch={}));var Rh=function(t){function e(e,n,r,i,s){void 0===n&&(n=8),void 0===r&&(r=4),void 0===i&&(i=we.FILTER_RESOLUTION),void 0===s&&(s=5);var a=this,o=function(t,e){var n,r=Math.ceil(t/2),i="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",s="";n=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var a=0;a<t;a++){var o=n.replace("%index%",a.toString());s+=o=o.replace("%sampleIndex%",a-(r-1)+".0"),s+="\n"}return(i=i.replace("%blur%",s)).replace("%size%",t.toString())}(s,e),l=function(t){for(var e,n=Nh[t],r=n.length,i=Ah,s="",a=0;a<t;a++){var o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",a.toString());e=a,a>=r&&(e=t-a-1),s+=o=o.replace("%value%",n[e].toString()),s+="\n"}return(i=i.replace("%blur%",s)).replace("%size%",t.toString())}(s);return(a=t.call(this,o,l)||this).horizontal=e,a.resolution=i,a._quality=0,a.quality=r,a.blur=n,a}return hh(e,t),e.prototype.apply=function(t,e,n,r){if(n?this.horizontal?this.uniforms.strength=1/n.width*(n.width/e.width):this.uniforms.strength=1/n.height*(n.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,n,r);else{var i=t.getFilterTexture(),s=t.renderer,a=e,o=i;this.state.blend=!1,t.applyFilter(this,a,o,Th.CLEAR);for(var l=1;l<this.passes-1;l++){t.bindAndClear(a,Th.BLIT),this.uniforms.uSampler=o;var h=o;o=a,a=h,s.shader.bind(this),s.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,o,n,r),t.returnFilterTexture(i)}},Object.defineProperty(e.prototype,"blur",{get:function(){return this.strength},set:function(t){this.padding=1+2*Math.abs(t),this.strength=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t},enumerable:!1,configurable:!0}),e}(qi),Mh=function(t){function e(e,n,r,i){void 0===e&&(e=8),void 0===n&&(n=4),void 0===r&&(r=we.FILTER_RESOLUTION),void 0===i&&(i=5);var s=t.call(this)||this;return s.blurXFilter=new Rh(!0,e,n,r,i),s.blurYFilter=new Rh(!1,e,n,r,i),s.resolution=r,s.quality=n,s.blur=e,s.repeatEdgePixels=!1,s}return hh(e,t),e.prototype.apply=function(t,e,n,r){var i=Math.abs(this.blurXFilter.strength),s=Math.abs(this.blurYFilter.strength);if(i&&s){var a=t.getFilterTexture();this.blurXFilter.apply(t,e,a,Th.CLEAR),this.blurYFilter.apply(t,a,n,r),t.returnFilterTexture(a)}else s?this.blurYFilter.apply(t,e,n,r):this.blurXFilter.apply(t,e,n,r)},e.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))},Object.defineProperty(e.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(t){this.blurXFilter.quality=this.blurYFilter.quality=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(t){this.blurYFilter.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(t){this._repeatEdgePixels=t,this.updatePadding()},enumerable:!1,configurable:!0}),e}(qi),Oh=function(t,e){return Oh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},Oh(t,e)};var Ph=function(t){function e(){var e=this,n={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return(e=t.call(this,Ms,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",n)||this).alpha=1,e}return function(t,e){function n(){this.constructor=t}Oh(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype._loadMatrix=function(t,e){void 0===e&&(e=!1);var n=t;e&&(this._multiply(n,this.uniforms.m,t),n=this._colorMatrix(n)),this.uniforms.m=n},e.prototype._multiply=function(t,e,n){return t[0]=e[0]*n[0]+e[1]*n[5]+e[2]*n[10]+e[3]*n[15],t[1]=e[0]*n[1]+e[1]*n[6]+e[2]*n[11]+e[3]*n[16],t[2]=e[0]*n[2]+e[1]*n[7]+e[2]*n[12]+e[3]*n[17],t[3]=e[0]*n[3]+e[1]*n[8]+e[2]*n[13]+e[3]*n[18],t[4]=e[0]*n[4]+e[1]*n[9]+e[2]*n[14]+e[3]*n[19]+e[4],t[5]=e[5]*n[0]+e[6]*n[5]+e[7]*n[10]+e[8]*n[15],t[6]=e[5]*n[1]+e[6]*n[6]+e[7]*n[11]+e[8]*n[16],t[7]=e[5]*n[2]+e[6]*n[7]+e[7]*n[12]+e[8]*n[17],t[8]=e[5]*n[3]+e[6]*n[8]+e[7]*n[13]+e[8]*n[18],t[9]=e[5]*n[4]+e[6]*n[9]+e[7]*n[14]+e[8]*n[19]+e[9],t[10]=e[10]*n[0]+e[11]*n[5]+e[12]*n[10]+e[13]*n[15],t[11]=e[10]*n[1]+e[11]*n[6]+e[12]*n[11]+e[13]*n[16],t[12]=e[10]*n[2]+e[11]*n[7]+e[12]*n[12]+e[13]*n[17],t[13]=e[10]*n[3]+e[11]*n[8]+e[12]*n[13]+e[13]*n[18],t[14]=e[10]*n[4]+e[11]*n[9]+e[12]*n[14]+e[13]*n[19]+e[14],t[15]=e[15]*n[0]+e[16]*n[5]+e[17]*n[10]+e[18]*n[15],t[16]=e[15]*n[1]+e[16]*n[6]+e[17]*n[11]+e[18]*n[16],t[17]=e[15]*n[2]+e[16]*n[7]+e[17]*n[12]+e[18]*n[17],t[18]=e[15]*n[3]+e[16]*n[8]+e[17]*n[13]+e[18]*n[18],t[19]=e[15]*n[4]+e[16]*n[9]+e[17]*n[14]+e[18]*n[19]+e[19],t},e.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},e.prototype.brightness=function(t,e){var n=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.tint=function(t,e){var n=[(t>>16&255)/255,0,0,0,0,0,(t>>8&255)/255,0,0,0,0,0,(255&t)/255,0,0,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.greyscale=function(t,e){var n=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},e.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var n=Math.cos(t),r=Math.sin(t),i=1/3,s=(0,Math.sqrt)(i),a=[n+(1-n)*i,i*(1-n)-s*r,i*(1-n)+s*r,0,0,i*(1-n)+s*r,n+i*(1-n),i*(1-n)-s*r,0,0,i*(1-n)-s*r,i*(1-n)+s*r,n+i*(1-n),0,0,0,0,0,1,0];this._loadMatrix(a,e)},e.prototype.contrast=function(t,e){var n=(t||0)+1,r=-.5*(n-1),i=[n,0,0,0,r,0,n,0,0,r,0,0,n,0,r,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.saturate=function(t,e){void 0===t&&(t=0);var n=2*t/3+1,r=-.5*(n-1),i=[n,r,r,0,0,r,n,r,0,0,r,r,n,0,0,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},e.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},e.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},e.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},e.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},e.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},e.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},e.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},e.prototype.colorTone=function(t,e,n,r,i){var s=((n=n||16770432)>>16&255)/255,a=(n>>8&255)/255,o=(255&n)/255,l=((r=r||3375104)>>16&255)/255,h=(r>>8&255)/255,u=(255&r)/255,c=[.3,.59,.11,0,0,s,a,o,t=t||.2,0,l,h,u,e=e||.15,0,s-l,a-h,o-u,0,0];this._loadMatrix(c,i)},e.prototype.night=function(t,e){var n=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.predator=function(t,e){var n=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(n,e)},e.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},e.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},Object.defineProperty(e.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(t){this.uniforms.m=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e}(qi);Ph.prototype.grayscale=Ph.prototype.greyscale;var Dh=function(t,e){return Dh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},Dh(t,e)};var Fh=function(t){function e(e,n){var r=this,i=new In;return e.renderable=!1,(r=t.call(this,"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:e._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this).maskSprite=e,r.maskMatrix=i,null==n&&(n=20),r.scale=new En(n,n),r}return function(t,e){function n(){this.constructor=t}Dh(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.apply=function(t,e,n,r){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var i=this.maskSprite.worldTransform,s=Math.sqrt(i.a*i.a+i.b*i.b),a=Math.sqrt(i.c*i.c+i.d*i.d);0!==s&&0!==a&&(this.uniforms.rotation[0]=i.a/s,this.uniforms.rotation[1]=i.b/s,this.uniforms.rotation[2]=i.c/a,this.uniforms.rotation[3]=i.d/a),t.applyFilter(this,e,n,r)},Object.defineProperty(e.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(t){this.uniforms.mapSampler=t},enumerable:!1,configurable:!0}),e}(qi),Lh=function(t,e){return Lh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},Lh(t,e)};var Bh=function(t){function e(){return t.call(this,"\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')||this}return function(t,e){function n(){this.constructor=t}Lh(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e}(qi),$h=function(t,e){return $h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},$h(t,e)};var Uh,Vh,zh,Gh,Wh,Xh,Hh,Yh,jh,qh,Kh,Zh,Jh,Qh,tu,eu,nu,ru,iu,su=function(t){function e(e,n){void 0===e&&(e=.5),void 0===n&&(n=Math.random());var r=t.call(this,Ms,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0})||this;return r.noise=e,r.seed=n,r}return function(t,e){function n(){this.constructor=t}$h(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),Object.defineProperty(e.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(t){this.uniforms.uNoise=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(t){this.uniforms.uSeed=t},enumerable:!1,configurable:!0}),e}(qi);!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(Uh||(Uh={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(Vh||(Vh={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(zh||(zh={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(Gh||(Gh={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Wh||(Wh={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(Xh||(Xh={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(Hh||(Hh={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(Yh||(Yh={})),function(t){t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT"}(jh||(jh={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(qh||(qh={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Kh||(Kh={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL"}(Zh||(Zh={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA"}(Jh||(Jh={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(Qh||(Qh={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(tu||(tu={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(eu||(eu={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(nu||(nu={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(ru||(ru={})),function(t){t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(iu||(iu={}));var au=new In;ir.prototype._cacheAsBitmap=!1,ir.prototype._cacheData=null,ir.prototype._cacheAsBitmapResolution=null,ir.prototype._cacheAsBitmapMultisample=ru.NONE;var ou=function(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null};Object.defineProperties(ir.prototype,{cacheAsBitmapResolution:{get:function(){return this._cacheAsBitmapResolution},set:function(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get:function(){return this._cacheAsBitmapMultisample},set:function(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){var e;this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new ou),(e=this._cacheData).originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((e=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea))}}}),ir.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},ir.prototype._initCachedDisplayObject=function(t){var e;if(!this._cacheData||!this._cacheData.sprite){var n=this.alpha;this.alpha=1,t.batch.flush();var r=this.getLocalBounds(null,!0).clone();if(this.filters){var i=this.filters[0].padding;r.pad(i)}r.ceil(we.RESOLUTION);var s=t.renderTexture.current,a=t.renderTexture.sourceFrame.clone(),o=t.renderTexture.destinationFrame.clone(),l=t.projection.transform,h=qr.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:null!==(e=this.cacheAsBitmapMultisample)&&void 0!==e?e:t.multisample}),u="cacheAsBitmap_"+Qe();this._cacheData.textureCacheId=u,Rr.addToCache(h.baseTexture,u),Yr.addToCache(h,u);var c=this.transform.localTransform.copyTo(au).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:h,clear:!0,transform:c,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=l,t.renderTexture.bind(s,a,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=n;var d=new Qo(h);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-r.x/r.width,d.anchor.y=-r.y/r.height,d.alpha=n,d._bounds=this._bounds,this._cacheData.sprite=d,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=d.containsPoint.bind(d)}},ir.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},ir.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(null,!0),n=this.alpha;this.alpha=1;var r=t.context,i=t._projTransform;e.ceil(we.RESOLUTION);var s=qr.create({width:e.width,height:e.height}),a="cacheAsBitmap_"+Qe();this._cacheData.textureCacheId=a,Rr.addToCache(s.baseTexture,a),Yr.addToCache(s,a);var o=au;this.transform.localTransform.copyTo(o),o.invert(),o.tx-=e.x,o.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:s,clear:!0,transform:o,skipUpdateTransform:!1}),t.context=r,t._projTransform=i,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=n;var l=new Qo(s);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-e.x/e.width,l.anchor.y=-e.y/e.height,l.alpha=n,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)}},ir.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},ir.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},ir.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Rr.removeFromCache(this._cacheData.textureCacheId),Yr.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},ir.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},ir.prototype.name=null,or.prototype.getChildByName=function(t,e){for(var n=0,r=this.children.length;n<r;n++)if(this.children[n].name===t)return this.children[n];if(e)for(n=0,r=this.children.length;n<r;n++){if(this.children[n].getChildByName){var i=this.children[n].getChildByName(t,!0);if(i)return i}}return null},ir.prototype.getGlobalPosition=function(t,e){return void 0===t&&(t=new En),void 0===e&&(e=!1),this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};var lu=function(t,e){return lu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},lu(t,e)};function hu(t,e){function n(){this.constructor=t}lu(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var uu=function(t){function e(e,n,r,i){void 0===e&&(e=100),void 0===n&&(n=100),void 0===r&&(r=10),void 0===i&&(i=10);var s=t.call(this)||this;return s.segWidth=r,s.segHeight=i,s.width=e,s.height=n,s.build(),s}return hu(e,t),e.prototype.build=function(){for(var t=this.segWidth*this.segHeight,e=[],n=[],r=[],i=this.segWidth-1,s=this.segHeight-1,a=this.width/i,o=this.height/s,l=0;l<t;l++){var h=l%this.segWidth,u=l/this.segWidth|0;e.push(h*a,u*o),n.push(h/i,u/s)}var c=i*s;for(l=0;l<c;l++){var d=l%i,p=l/i|0,f=p*this.segWidth+d,m=p*this.segWidth+d+1,g=(p+1)*this.segWidth+d,y=(p+1)*this.segWidth+d+1;r.push(f,m,g,m,y,g)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(n),this.indexBuffer.data=new Uint16Array(r),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},e}(Gl),cu=function(t){function e(e,n,r){void 0===e&&(e=200),void 0===r&&(r=0);var i=t.call(this,new Float32Array(4*n.length),new Float32Array(4*n.length),new Uint16Array(6*(n.length-1)))||this;return i.points=n,i._width=e,i.textureScale=r,i.build(),i}return hu(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),e.prototype.build=function(){var t=this.points;if(t){var e=this.getBuffer("aVertexPosition"),n=this.getBuffer("aTextureCoord"),r=this.getIndex();if(!(t.length<1)){e.data.length/4!==t.length&&(e.data=new Float32Array(4*t.length),n.data=new Float32Array(4*t.length),r.data=new Uint16Array(6*(t.length-1)));var i=n.data,s=r.data;i[0]=0,i[1]=0,i[2]=0,i[3]=1;for(var a=0,o=t[0],l=this._width*this.textureScale,h=t.length,u=0;u<h;u++){var c=4*u;if(this.textureScale>0){var d=o.x-t[u].x,p=o.y-t[u].y,f=Math.sqrt(d*d+p*p);o=t[u],a+=f/l}else a=u/(h-1);i[c]=a,i[c+1]=0,i[c+2]=a,i[c+3]=1}var m=0;for(u=0;u<h-1;u++){c=2*u;s[m++]=c,s[m++]=c+1,s[m++]=c+2,s[m++]=c+2,s[m++]=c+1,s[m++]=c+3}n.update(),r.update(),this.updateVertices()}}},e.prototype.updateVertices=function(){var t=this.points;if(!(t.length<1)){for(var e,n=t[0],r=0,i=0,s=this.buffers[0].data,a=t.length,o=0;o<a;o++){var l=t[o],h=4*o;i=-((e=o<t.length-1?t[o+1]:l).x-n.x),r=e.y-n.y;var u=Math.sqrt(r*r+i*i),c=this.textureScale>0?this.textureScale*this._width/2:this._width/2;r/=u,i/=u,r*=c,i*=c,s[h]=l.x+r,s[h+1]=l.y+i,s[h+2]=l.x-r,s[h+3]=l.y-i,n=l}this.buffers[0].update()}},e.prototype.update=function(){this.textureScale>0?this.build():this.updateVertices()},e}(Gl),du=function(t){function e(e,n,r){void 0===r&&(r=0);var i=this,s=new cu(e.height,n,r),a=new zl(e);return r>0&&(e.baseTexture.wrapMode=de.REPEAT),(i=t.call(this,s,a)||this).autoUpdate=!0,i}return hu(e,t),e.prototype._render=function(e){var n=this.geometry;(this.autoUpdate||n._width!==this.shader.texture.height)&&(n._width=this.shader.texture.height,n.update()),t.prototype._render.call(this,e)},e}(Vl),pu=function(t){function e(e,n,r){var i=this,s=new uu(e.width,e.height,n,r),a=new zl(Yr.WHITE);return(i=t.call(this,s,a)||this).texture=e,i.autoResize=!0,i}return hu(e,t),e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var t=this.geometry,e=this.shader.texture,n=e.width,r=e.height;!this.autoResize||t.width===n&&t.height===r||(t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build())},Object.defineProperty(e.prototype,"texture",{get:function(){return this.shader.texture},set:function(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),e.prototype._render=function(e){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),t.prototype._render.call(this,e)},e.prototype.destroy=function(e){this.shader.texture.off("update",this.textureUpdated,this),t.prototype.destroy.call(this,e)},e}(Vl),fu=function(t){function e(e,n,r,i,s){void 0===e&&(e=Yr.EMPTY);var a=this,o=new Gl(n,r,i);o.getBuffer("aVertexPosition").static=!1;var l=new zl(e);return(a=t.call(this,o,l,null,s)||this).autoUpdate=!0,a}return hu(e,t),Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype._render=function(e){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),t.prototype._render.call(this,e)},e}(Vl),mu=function(t){function e(e,n,r,i,s){void 0===n&&(n=10),void 0===r&&(r=10),void 0===i&&(i=10),void 0===s&&(s=10);var a=t.call(this,Yr.WHITE,4,4)||this;return a._origWidth=e.orig.width,a._origHeight=e.orig.height,a._width=a._origWidth,a._height=a._origHeight,a._leftWidth=n,a._rightWidth=i,a._topHeight=r,a._bottomHeight=s,a.texture=e,a}return hu(e,t),e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype.updateHorizontalVertices=function(){var t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height},e.prototype.updateVerticalVertices=function(){var t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width},e.prototype._getMinScale=function(){var t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,n=this._topHeight+this._bottomHeight,r=this._height>n?1:this._height/n;return Math.min(e,r)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(t){this._leftWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(t){this._rightWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topHeight",{get:function(){return this._topHeight},set:function(t){this._topHeight=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t,this._refresh()},enumerable:!1,configurable:!0}),e.prototype._refresh=function(){var t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;var n=1/this._origWidth,r=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=n*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-n*this._rightWidth,e[9]=e[11]=e[13]=e[15]=r*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-r*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},e}(pu),gu=function(t,e){return gu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},gu(t,e)};var yu=function(t){function e(e,n){void 0===n&&(n=!0);var r=t.call(this,e[0]instanceof Yr?e[0]:e[0].texture)||this;return r._textures=null,r._durations=null,r._autoUpdate=n,r._isConnectedToTicker=!1,r.animationSpeed=1,r.loop=!0,r.updateAnchor=!1,r.onComplete=null,r.onFrameChange=null,r.onLoop=null,r._currentTime=0,r._playing=!1,r._previousFrame=null,r.textures=e,r}return function(t,e){function n(){this.constructor=t}gu(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.stop=function(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(dr.shared.remove(this.update,this),this._isConnectedToTicker=!1))},e.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(dr.shared.add(this.update,this,hr.HIGH),this._isConnectedToTicker=!0))},e.prototype.gotoAndStop=function(t){this.stop();var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()},e.prototype.gotoAndPlay=function(t){var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture(),this.play()},e.prototype.update=function(t){if(this._playing){var e=this.animationSpeed*t,n=this.currentFrame;if(null!==this._durations){var r=this._currentTime%1*this._durations[this.currentFrame];for(r+=e/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];var i=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):n!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<n||this.animationSpeed<0&&this.currentFrame>n)&&this.onLoop(),this.updateTexture())}},e.prototype.updateTexture=function(){var t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},e.prototype.destroy=function(e){this.stop(),t.prototype.destroy.call(this,e),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},e.fromFrames=function(t){for(var n=[],r=0;r<t.length;++r)n.push(Yr.from(t[r]));return new e(n)},e.fromImages=function(t){for(var n=[],r=0;r<t.length;++r)n.push(Yr.from(t[r]));return new e(n)},Object.defineProperty(e.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textures",{get:function(){return this._textures},set:function(t){if(t[0]instanceof Yr)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentFrame",{get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(dr.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(dr.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),e}(Qo);Ns.registerPlugin("accessibility",ur),Ns.registerPlugin("extract",Js),Ns.registerPlugin("interaction",wr),Ns.registerPlugin("particle",yo),Ns.registerPlugin("prepare",Sl),Ns.registerPlugin("batch",Gs),Ns.registerPlugin("tilingSprite",Dl),fa.registerPlugin(sh),fa.registerPlugin(Ca),fa.registerPlugin(Ya),fa.registerPlugin(ho),fa.registerPlugin(Cl),qs.registerPlugin(pr),qs.registerPlugin(ma);var vu="6.2.0",xu={AlphaFilter:oh,BlurFilter:Mh,BlurFilterPass:Rh,ColorMatrixFilter:Ph,DisplacementFilter:Fh,FXAAFilter:Bh,NoiseFilter:su};function bu(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function wu(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var _u,Tu,Eu,Su,Iu,ku,Cu,Nu,Au,Ru,Mu,Ou,Pu,Du,Fu,Lu,Bu,$u,Uu,Vu,zu,Gu,Wu,Xu,Hu,Yu,ju,qu,Ku={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Zu={duration:.5,overwrite:!1,delay:0},Ju=1e8,Qu=1e-8,tc=2*Math.PI,ec=tc/4,nc=0,rc=Math.sqrt,ic=Math.cos,sc=Math.sin,ac=function(t){return"string"==typeof t},oc=function(t){return"function"==typeof t},lc=function(t){return"number"==typeof t},hc=function(t){return void 0===t},uc=function(t){return"object"==typeof t},cc=function(t){return!1!==t},dc=function(){return"undefined"!=typeof window},pc=function(t){return oc(t)||ac(t)},fc="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},mc=Array.isArray,gc=/(?:-?\.?\d|\.)+/gi,yc=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,vc=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,xc=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,bc=/[+-]=-?[.\d]+/,wc=/[^,'"\[\]\s]+/gi,_c=/[\d.+\-=]+(?:e[-+]\d*)*/i,Tc={},Ec={},Sc=function(t){return(Ec=qc(t,Tc))&&Lp},Ic=function(t,e){return!e&&void 0},kc=function(t,e){return t&&(Tc[t]=e)&&Ec&&(Ec[t]=e)||Tc},Cc=function(){return 0},Nc={},Ac=[],Rc={},Mc={},Oc={},Pc=30,Dc=[],Fc="",Lc=function(t){var e,n,r=t[0];if(uc(r)||oc(r)||(t=[t]),!(e=(r._gsap||{}).harness)){for(n=Dc.length;n--&&!Dc[n].targetTest(r););e=Dc[n]}for(n=t.length;n--;)t[n]&&(t[n]._gsap||(t[n]._gsap=new op(t[n],e)))||t.splice(n,1);return t},Bc=function(t){return t._gsap||Lc(Id(t))[0]._gsap},$c=function(t,e,n){return(n=t[e])&&oc(n)?t[e]():hc(n)&&t.getAttribute&&t.getAttribute(e)||n},Uc=function(t,e){return(t=t.split(",")).forEach(e)||t},Vc=function(t){return Math.round(1e5*t)/1e5||0},zc=function(t){return Math.round(1e7*t)/1e7||0},Gc=function(t,e){for(var n=e.length,r=0;t.indexOf(e[r])<0&&++r<n;);return r<n},Wc=function(){var t,e,n=Ac.length,r=Ac.slice(0);for(Rc={},Ac.length=0,t=0;t<n;t++)(e=r[t])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},Xc=function(t,e,n,r){Ac.length&&Wc(),t.render(e,n,r),Ac.length&&Wc()},Hc=function(t){var e=parseFloat(t);return(e||0===e)&&(t+"").match(wc).length<2?e:ac(t)?t.trim():t},Yc=function(t){return t},jc=function(t,e){for(var n in e)n in t||(t[n]=e[n]);return t},qc=function(t,e){for(var n in e)t[n]=e[n];return t},Kc=function t(e,n){for(var r in n)"__proto__"!==r&&"constructor"!==r&&"prototype"!==r&&(e[r]=uc(n[r])?t(e[r]||(e[r]={}),n[r]):n[r]);return e},Zc=function(t,e){var n,r={};for(n in t)n in e||(r[n]=t[n]);return r},Jc=function(t){var e,n=t.parent||Tu,r=t.keyframes?(e=mc(t.keyframes),function(t,n){for(var r in n)r in t||"duration"===r&&e||"ease"===r||(t[r]=n[r])}):jc;if(cc(t.inherit))for(;n;)r(t,n.vars.defaults),n=n.parent||n._dp;return t},Qc=function(t,e,n,r){void 0===n&&(n="_first"),void 0===r&&(r="_last");var i=e._prev,s=e._next;i?i._next=s:t[n]===e&&(t[n]=s),s?s._prev=i:t[r]===e&&(t[r]=i),e._next=e._prev=e.parent=null},td=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove(t),t._act=0},ed=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var n=t;n;)n._dirty=1,n=n.parent;return t},nd=function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t},rd=function t(e){return!e||e._ts&&t(e.parent)},id=function(t){return t._repeat?sd(t._tTime,t=t.duration()+t._rDelay)*t:0},sd=function(t,e){var n=Math.floor(t/=e);return t&&n===t?n-1:n},ad=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},od=function(t){return t._end=zc(t._start+(t._tDur/Math.abs(t._ts||t._rts||Qu)||0))},ld=function(t,e){var n=t._dp;return n&&n.smoothChildTiming&&t._ts&&(t._start=zc(n._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),od(t),n._dirty||ed(n,t)),t},hd=function(t,e){var n;if((e._time||e._initted&&!e._dur)&&(n=ad(t.rawTime(),e),(!e._dur||wd(0,e.totalDuration(),n)-e._tTime>Qu)&&e.render(n,!0)),ed(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(n=t;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;t._zTime=-1e-8}},ud=function(t,e,n,r){return e.parent&&td(e),e._start=zc((lc(n)?n:n||t!==Tu?vd(t,n,e):t._time)+e._delay),e._end=zc(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),function(t,e,n,r,i){void 0===n&&(n="_first"),void 0===r&&(r="_last");var s,a=t[r];if(i)for(s=e[i];a&&a[i]>s;)a=a._prev;a?(e._next=a._next,a._next=e):(e._next=t[n],t[n]=e),e._next?e._next._prev=e:t[r]=e,e._prev=a,e.parent=e._dp=t}(t,e,"_first","_last",t._sort?"_start":0),fd(e)||(t._recent=e),r||hd(t,e),t},cd=function(t,e){return Tc.ScrollTrigger?Tc.ScrollTrigger.create(e,t):void 0},dd=function(t,e,n,r){return fp(t,e),t._initted?!n&&t._pt&&(t._dur&&!1!==t.vars.lazy||!t._dur&&t.vars.lazy)&&Cu!==jd.frame?(Ac.push(t),t._lazy=[e,r],1):void 0:1},pd=function t(e){var n=e.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||t(n))},fd=function(t){var e=t.data;return"isFromStart"===e||"isStart"===e},md=function(t,e,n,r){var i=t._repeat,s=zc(e)||0,a=t._tTime/t._tDur;return a&&!r&&(t._time*=s/t._dur),t._dur=s,t._tDur=i?i<0?1e10:zc(s*(i+1)+t._rDelay*i):s,a>0&&!r?ld(t,t._tTime=t._tDur*a):t.parent&&od(t),n||ed(t.parent,t),t},gd=function(t){return t instanceof hp?ed(t):md(t,t._dur)},yd={_start:0,endTime:Cc,totalDuration:Cc},vd=function t(e,n,r){var i,s,a,o=e.labels,l=e._recent||yd,h=e.duration()>=Ju?l.endTime(!1):e._dur;return ac(n)&&(isNaN(n)||n in o)?(s=n.charAt(0),a="%"===n.substr(-1),i=n.indexOf("="),"<"===s||">"===s?(i>=0&&(n=n.replace(/=/,"")),("<"===s?l._start:l.endTime(l._repeat>=0))+(parseFloat(n.substr(1))||0)*(a?(i<0?l:r).totalDuration()/100:1)):i<0?(n in o||(o[n]=h),o[n]):(s=parseFloat(n.charAt(i-1)+n.substr(i+1)),a&&r&&(s=s/100*(mc(r)?r[0]:r).totalDuration()),i>1?t(e,n.substr(0,i-1),r)+s:h+s)):null==n?h:+n},xd=function(t,e,n){var r,i,s=lc(e[1]),a=(s?2:1)+(t<2?0:1),o=e[a];if(s&&(o.duration=e[1]),o.parent=n,t){for(r=o,i=n;i&&!("immediateRender"in r);)r=i.vars.defaults||{},i=cc(i.vars.inherit)&&i.parent;o.immediateRender=cc(r.immediateRender),t<2?o.runBackwards=1:o.startAt=e[a-1]}return new xp(e[0],o,e[a+1])},bd=function(t,e){return t||0===t?e(t):e},wd=function(t,e,n){return n<t?t:n>e?e:n},_d=function(t,e){return ac(t)&&(e=_c.exec(t))?t.substr(e.index+e[0].length):""},Td=[].slice,Ed=function(t,e){return t&&uc(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&uc(t[0]))&&!t.nodeType&&t!==Eu},Sd=function(t,e,n){return void 0===n&&(n=[]),t.forEach((function(t){var r;return ac(t)&&!e||Ed(t,1)?(r=n).push.apply(r,Id(t)):n.push(t)}))||n},Id=function(t,e,n){return!ac(t)||n||!Su&&qd()?mc(t)?Sd(t,n):Ed(t)?Td.call(t,0):t?[t]:[]:Td.call((e||Iu).querySelectorAll(t),0)},kd=function(t){return t.sort((function(){return.5-Math.random()}))},Cd=function(t){if(oc(t))return t;var e=uc(t)?t:{each:t},n=np(e.ease),r=e.from||0,i=parseFloat(e.base)||0,s={},a=r>0&&r<1,o=isNaN(r)||a,l=e.axis,h=r,u=r;return ac(r)?h=u={center:.5,edges:.5,end:1}[r]||0:!a&&o&&(h=r[0],u=r[1]),function(t,a,c){var d,p,f,m,g,y,v,x,b,w=(c||e).length,_=s[w];if(!_){if(!(b="auto"===e.grid?0:(e.grid||[1,Ju])[1])){for(v=-Ju;v<(v=c[b++].getBoundingClientRect().left)&&b<w;);b--}for(_=s[w]=[],d=o?Math.min(b,w)*h-.5:r%b,p=b===Ju?0:o?w*u/b-.5:r/b|0,v=0,x=Ju,y=0;y<w;y++)f=y%b-d,m=p-(y/b|0),_[y]=g=l?Math.abs("y"===l?m:f):rc(f*f+m*m),g>v&&(v=g),g<x&&(x=g);"random"===r&&kd(_),_.max=v-x,_.min=x,_.v=w=(parseFloat(e.amount)||parseFloat(e.each)*(b>w?w-1:l?"y"===l?w/b:b:Math.max(b,w/b))||0)*("edges"===r?-1:1),_.b=w<0?i-w:i,_.u=_d(e.amount||e.each)||0,n=n&&w<0?tp(n):n}return w=(_[t]-_.min)/_.max||0,zc(_.b+(n?n(w):w)*_.v)+_.u}},Nd=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(n){var r=Math.round(parseFloat(n)/t)*t*e;return(r-r%1)/e+(lc(n)?0:_d(n))}},Ad=function(t,e){var n,r,i=mc(t);return!i&&uc(t)&&(n=i=t.radius||Ju,t.values?(t=Id(t.values),(r=!lc(t[0]))&&(n*=n)):t=Nd(t.increment)),bd(e,i?oc(t)?function(e){return r=t(e),Math.abs(r-e)<=n?r:e}:function(e){for(var i,s,a=parseFloat(r?e.x:e),o=parseFloat(r?e.y:0),l=Ju,h=0,u=t.length;u--;)(i=r?(i=t[u].x-a)*i+(s=t[u].y-o)*s:Math.abs(t[u]-a))<l&&(l=i,h=u);return h=!n||l<=n?t[h]:e,r||h===e||lc(e)?h:h+_d(e)}:Nd(t))},Rd=function(t,e,n,r){return bd(mc(t)?!e:!0===n?!!(n=0):!r,(function(){return mc(t)?t[~~(Math.random()*t.length)]:(n=n||1e-5)&&(r=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((t-n/2+Math.random()*(e-t+.99*n))/n)*n*r)/r}))},Md=function(t,e,n){return bd(n,(function(n){return t[~~e(n)]}))},Od=function(t){for(var e,n,r,i,s=0,a="";~(e=t.indexOf("random(",s));)r=t.indexOf(")",e),i="["===t.charAt(e+7),n=t.substr(e+7,r-e-7).match(i?wc:gc),a+=t.substr(s,e-s)+Rd(i?n:+n[0],i?0:+n[1],+n[2]||1e-5),s=r+1;return a+t.substr(s,t.length-s)},Pd=function(t,e,n,r,i){var s=e-t,a=r-n;return bd(i,(function(e){return n+((e-t)/s*a||0)}))},Dd=function(t,e,n){var r,i,s,a=t.labels,o=Ju;for(r in a)(i=a[r]-e)<0==!!n&&i&&o>(i=Math.abs(i))&&(s=r,o=i);return s},Fd=function(t,e,n){var r,i,s=t.vars,a=s[e];if(a)return r=s[e+"Params"],i=s.callbackScope||t,n&&Ac.length&&Wc(),r?a.apply(i,r):a.call(i)},Ld=function(t){return td(t),t.scrollTrigger&&t.scrollTrigger.kill(!1),t.progress()<1&&Fd(t,"onInterrupt"),t},Bd=function(t){var e=(t=!t.name&&t.default||t).name,n=oc(t),r=e&&!n&&t.init?function(){this._props=[]}:t,i={init:Cc,render:Cp,add:dp,kill:Ap,modifier:Np,rawVars:0},s={targetTest:0,get:0,getSetter:Ep,aliases:{},register:0};if(qd(),t!==r){if(Mc[e])return;jc(r,jc(Zc(t,i),s)),qc(r.prototype,qc(i,Zc(t,s))),Mc[r.prop=e]=r,t.targetTest&&(Dc.push(r),Nc[e]=1),e=("css"===e?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}kc(e,r),t.register&&t.register(Lp,r,Op)},$d=255,Ud={aqua:[0,$d,$d],lime:[0,$d,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,$d],navy:[0,0,128],white:[$d,$d,$d],olive:[128,128,0],yellow:[$d,$d,0],orange:[$d,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[$d,0,0],pink:[$d,192,203],cyan:[0,$d,$d],transparent:[$d,$d,$d,0]},Vd=function(t,e,n){return(6*(t+=t<0?1:t>1?-1:0)<1?e+(n-e)*t*6:t<.5?n:3*t<2?e+(n-e)*(2/3-t)*6:e)*$d+.5|0},zd=function(t,e,n){var r,i,s,a,o,l,h,u,c,d,p=t?lc(t)?[t>>16,t>>8&$d,t&$d]:0:Ud.black;if(!p){if(","===t.substr(-1)&&(t=t.substr(0,t.length-1)),Ud[t])p=Ud[t];else if("#"===t.charAt(0)){if(t.length<6&&(r=t.charAt(1),i=t.charAt(2),s=t.charAt(3),t="#"+r+r+i+i+s+s+(5===t.length?t.charAt(4)+t.charAt(4):"")),9===t.length)return[(p=parseInt(t.substr(1,6),16))>>16,p>>8&$d,p&$d,parseInt(t.substr(7),16)/255];p=[(t=parseInt(t.substr(1),16))>>16,t>>8&$d,t&$d]}else if("hsl"===t.substr(0,3))if(p=d=t.match(gc),e){if(~t.indexOf("="))return p=t.match(yc),n&&p.length<4&&(p[3]=1),p}else a=+p[0]%360/360,o=+p[1]/100,r=2*(l=+p[2]/100)-(i=l<=.5?l*(o+1):l+o-l*o),p.length>3&&(p[3]*=1),p[0]=Vd(a+1/3,r,i),p[1]=Vd(a,r,i),p[2]=Vd(a-1/3,r,i);else p=t.match(gc)||Ud.transparent;p=p.map(Number)}return e&&!d&&(r=p[0]/$d,i=p[1]/$d,s=p[2]/$d,l=((h=Math.max(r,i,s))+(u=Math.min(r,i,s)))/2,h===u?a=o=0:(c=h-u,o=l>.5?c/(2-h-u):c/(h+u),a=h===r?(i-s)/c+(i<s?6:0):h===i?(s-r)/c+2:(r-i)/c+4,a*=60),p[0]=~~(a+.5),p[1]=~~(100*o+.5),p[2]=~~(100*l+.5)),n&&p.length<4&&(p[3]=1),p},Gd=function(t){var e=[],n=[],r=-1;return t.split(Xd).forEach((function(t){var i=t.match(vc)||[];e.push.apply(e,i),n.push(r+=i.length+1)})),e.c=n,e},Wd=function(t,e,n){var r,i,s,a,o="",l=(t+o).match(Xd),h=e?"hsla(":"rgba(",u=0;if(!l)return t;if(l=l.map((function(t){return(t=zd(t,e,1))&&h+(e?t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]:t.join(","))+")"})),n&&(s=Gd(t),(r=n.c).join(o)!==s.c.join(o)))for(a=(i=t.replace(Xd,"1").split(vc)).length-1;u<a;u++)o+=i[u]+(~r.indexOf(u)?l.shift()||h+"0,0,0,0)":(s.length?s:l.length?l:n).shift());if(!i)for(a=(i=t.split(Xd)).length-1;u<a;u++)o+=i[u]+l[u];return o+i[a]},Xd=function(){var t,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(t in Ud)e+="|"+t+"\\b";return new RegExp(e+")","gi")}(),Hd=/hsl[a]?\(/,Yd=function(t){var e,n=t.join(" ");if(Xd.lastIndex=0,Xd.test(n))return e=Hd.test(n),t[1]=Wd(t[1],e),t[0]=Wd(t[0],e,Gd(t[1])),!0},jd=(Lu=Date.now,Bu=500,$u=33,Uu=Lu(),Vu=Uu,Gu=zu=1e3/240,Xu=function t(e){var n,r,i,s,a=Lu()-Vu,o=!0===e;if(a>Bu&&(Uu+=a-$u),((n=(i=(Vu+=a)-Uu)-Gu)>0||o)&&(s=++Pu.frame,Du=i-1e3*Pu.time,Pu.time=i/=1e3,Gu+=n+(n>=zu?4:zu-n),r=1),o||(Ru=Mu(t)),r)for(Fu=0;Fu<Wu.length;Fu++)Wu[Fu](i,Du,s,e)},Pu={time:0,frame:0,tick:function(){Xu(!0)},deltaRatio:function(t){return Du/(1e3/(t||60))},wake:function(){ku&&(!Su&&dc()&&(Eu=Su=window,Iu=Eu.document||{},Tc.gsap=Lp,(Eu.gsapVersions||(Eu.gsapVersions=[])).push(Lp.version),Sc(Ec||Eu.GreenSockGlobals||!Eu.gsap&&Eu||{}),Ou=Eu.requestAnimationFrame),Ru&&Pu.sleep(),Mu=Ou||function(t){return setTimeout(t,Gu-1e3*Pu.time+1|0)},Au=1,Xu(2))},sleep:function(){(Ou?Eu.cancelAnimationFrame:clearTimeout)(Ru),Au=0,Mu=Cc},lagSmoothing:function(t,e){Bu=t||1e8,$u=Math.min(e,Bu,0)},fps:function(t){zu=1e3/(t||240),Gu=1e3*Pu.time+zu},add:function(t){Wu.indexOf(t)<0&&Wu.push(t),qd()},remove:function(t,e){~(e=Wu.indexOf(t))&&Wu.splice(e,1)&&Fu>=e&&Fu--},_listeners:Wu=[]},Pu),qd=function(){return!Au&&jd.wake()},Kd={},Zd=/^[\d.\-M][\d.\-,\s]/,Jd=/["']/g,Qd=function(t){for(var e,n,r,i={},s=t.substr(1,t.length-3).split(":"),a=s[0],o=1,l=s.length;o<l;o++)n=s[o],e=o!==l-1?n.lastIndexOf(","):n.length,r=n.substr(0,e),i[a]=isNaN(r)?r.replace(Jd,"").trim():+r,a=n.substr(e+1).trim();return i},tp=function(t){return function(e){return 1-t(1-e)}},ep=function t(e,n){for(var r,i=e._first;i;)i instanceof hp?t(i,n):!i.vars.yoyoEase||i._yoyo&&i._repeat||i._yoyo===n||(i.timeline?t(i.timeline,n):(r=i._ease,i._ease=i._yEase,i._yEase=r,i._yoyo=n)),i=i._next},np=function(t,e){return t&&(oc(t)?t:Kd[t]||function(t){var e,n,r,i,s=(t+"").split("("),a=Kd[s[0]];return a&&s.length>1&&a.config?a.config.apply(null,~t.indexOf("{")?[Qd(s[1])]:(e=t,n=e.indexOf("(")+1,r=e.indexOf(")"),i=e.indexOf("(",n),e.substring(n,~i&&i<r?e.indexOf(")",r+1):r)).split(",").map(Hc)):Kd._CE&&Zd.test(t)?Kd._CE("",t):a}(t))||e},rp=function(t,e,n,r){void 0===n&&(n=function(t){return 1-e(1-t)}),void 0===r&&(r=function(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2});var i,s={easeIn:e,easeOut:n,easeInOut:r};return Uc(t,(function(t){for(var e in Kd[t]=Tc[t]=s,Kd[i=t.toLowerCase()]=n,s)Kd[i+("easeIn"===e?".in":"easeOut"===e?".out":".inOut")]=Kd[t+"."+e]=s[e]})),s},ip=function(t){return function(e){return e<.5?(1-t(1-2*e))/2:.5+t(2*(e-.5))/2}},sp=function t(e,n,r){var i=n>=1?n:1,s=(r||(e?.3:.45))/(n<1?n:1),a=s/tc*(Math.asin(1/i)||0),o=function(t){return 1===t?1:i*Math.pow(2,-10*t)*sc((t-a)*s)+1},l="out"===e?o:"in"===e?function(t){return 1-o(1-t)}:ip(o);return s=tc/s,l.config=function(n,r){return t(e,n,r)},l},ap=function t(e,n){void 0===n&&(n=1.70158);var r=function(t){return t?--t*t*((n+1)*t+n)+1:0},i="out"===e?r:"in"===e?function(t){return 1-r(1-t)}:ip(r);return i.config=function(n){return t(e,n)},i};Uc("Linear,Quad,Cubic,Quart,Quint,Strong",(function(t,e){var n=e<5?e+1:e;rp(t+",Power"+(n-1),e?function(t){return Math.pow(t,n)}:function(t){return t},(function(t){return 1-Math.pow(1-t,n)}),(function(t){return t<.5?Math.pow(2*t,n)/2:1-Math.pow(2*(1-t),n)/2}))})),Kd.Linear.easeNone=Kd.none=Kd.Linear.easeIn,rp("Elastic",sp("in"),sp("out"),sp()),Hu=7.5625,ju=1/(Yu=2.75),qu=function(t){return t<ju?Hu*t*t:t<.7272727272727273?Hu*Math.pow(t-1.5/Yu,2)+.75:t<.9090909090909092?Hu*(t-=2.25/Yu)*t+.9375:Hu*Math.pow(t-2.625/Yu,2)+.984375},rp("Bounce",(function(t){return 1-qu(1-t)}),qu),rp("Expo",(function(t){return t?Math.pow(2,10*(t-1)):0})),rp("Circ",(function(t){return-(rc(1-t*t)-1)})),rp("Sine",(function(t){return 1===t?1:1-ic(t*ec)})),rp("Back",ap("in"),ap("out"),ap()),Kd.SteppedEase=Kd.steps=Tc.SteppedEase={config:function(t,e){void 0===t&&(t=1);var n=1/t,r=t+(e?0:1),i=e?1:0;return function(t){return((r*wd(0,.99999999,t)|0)+i)*n}}},Zu.ease=Kd["quad.out"],Uc("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(t){return Fc+=t+","+t+"Params,"}));var op=function(t,e){this.id=nc++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:$c,this.set=e?e.getSetter:Ep},lp=function(){function t(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,md(this,+t.duration,1,1),this.data=t.data,Au||jd.wake()}var e=t.prototype;return e.delay=function(t){return t||0===t?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,md(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,e){if(qd(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(ld(this,t),!n._dp||n.parent||hd(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&ud(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!e||this._initted&&Math.abs(this._zTime)===Qu||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),Xc(this,t,e)),this},e.time=function(t,e){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+id(this))%(this._dur+this._rDelay)||(t?this._dur:0),e):this._time},e.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+id(this),e):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(t,e){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*n,e):this._repeat?sd(this._tTime,n)+1:1},e.timeScale=function(t){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===t)return this;var e=this.parent&&this._ts?ad(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||-1e-8===t?0:this._rts,nd(this.totalTime(wd(-this._delay,this._tDur,e),!0)),od(this),this},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(qd(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==Qu&&(this._tTime-=Qu)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var e=this.parent||this._dp;return e&&(e._sort||!this.parent)&&ud(e,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(cc(t)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(t){var e=this.parent||this._dp;return e?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?ad(e.rawTime(t),this):this._tTime:this._tTime},e.globalTime=function(t){for(var e=this,n=arguments.length?t:e.rawTime();e;)n=e._start+n/(e._ts||1),e=e._dp;return n},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,gd(this)):-2===this._repeat?1/0:this._repeat},e.repeatDelay=function(t){if(arguments.length){var e=this._time;return this._rDelay=t,gd(this),e?this.time(e):this}return this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,e){return this.totalTime(vd(this,t),cc(e))},e.restart=function(t,e){return this.play().totalTime(t?-this._delay:0,cc(e))},e.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},e.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},e.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},e.isActive=function(){var t,e=this.parent||this._dp,n=this._start;return!(e&&!(this._ts&&this._initted&&e.isActive()&&(t=e.rawTime(!0))>=n&&t<this.endTime(!0)-Qu))},e.eventCallback=function(t,e,n){var r=this.vars;return arguments.length>1?(e?(r[t]=e,n&&(r[t+"Params"]=n),"onUpdate"===t&&(this._onUpdate=e)):delete r[t],this):r[t]},e.then=function(t){var e=this;return new Promise((function(n){var r=oc(t)?t:Yc,i=function(){var t=e.then;e.then=null,oc(r)&&(r=r(e))&&(r.then||r===e)&&(e.then=t),n(r),e.then=t};e._initted&&1===e.totalProgress()&&e._ts>=0||!e._tTime&&e._ts<0?i():e._prom=i}))},e.kill=function(){Ld(this)},t}();jc(lp.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var hp=function(t){function e(e,n){var r;return void 0===e&&(e={}),(r=t.call(this,e)||this).labels={},r.smoothChildTiming=!!e.smoothChildTiming,r.autoRemoveChildren=!!e.autoRemoveChildren,r._sort=cc(e.sortChildren),Tu&&ud(e.parent||Tu,bu(r),n),e.reversed&&r.reverse(),e.paused&&r.paused(!0),e.scrollTrigger&&cd(bu(r),e.scrollTrigger),r}wu(e,t);var n=e.prototype;return n.to=function(t,e,n){return xd(0,arguments,this),this},n.from=function(t,e,n){return xd(1,arguments,this),this},n.fromTo=function(t,e,n,r){return xd(2,arguments,this),this},n.set=function(t,e,n){return e.duration=0,e.parent=this,Jc(e).repeatDelay||(e.repeat=0),e.immediateRender=!!e.immediateRender,new xp(t,e,vd(this,n),1),this},n.call=function(t,e,n){return ud(this,xp.delayedCall(0,t,e),n)},n.staggerTo=function(t,e,n,r,i,s,a){return n.duration=e,n.stagger=n.stagger||r,n.onComplete=s,n.onCompleteParams=a,n.parent=this,new xp(t,n,vd(this,i)),this},n.staggerFrom=function(t,e,n,r,i,s,a){return n.runBackwards=1,Jc(n).immediateRender=cc(n.immediateRender),this.staggerTo(t,e,n,r,i,s,a)},n.staggerFromTo=function(t,e,n,r,i,s,a,o){return r.startAt=n,Jc(r).immediateRender=cc(r.immediateRender),this.staggerTo(t,e,r,i,s,a,o)},n.render=function(t,e,n){var r,i,s,a,o,l,h,u,c,d,p,f,m=this._time,g=this._dirty?this.totalDuration():this._tDur,y=this._dur,v=t<=0?0:zc(t),x=this._zTime<0!=t<0&&(this._initted||!y);if(this!==Tu&&v>g&&t>=0&&(v=g),v!==this._tTime||n||x){if(m!==this._time&&y&&(v+=this._time-m,t+=this._time-m),r=v,c=this._start,l=!(u=this._ts),x&&(y||(m=this._zTime),(t||!e)&&(this._zTime=t)),this._repeat){if(p=this._yoyo,o=y+this._rDelay,this._repeat<-1&&t<0)return this.totalTime(100*o+t,e,n);if(r=zc(v%o),v===g?(a=this._repeat,r=y):((a=~~(v/o))&&a===v/o&&(r=y,a--),r>y&&(r=y)),d=sd(this._tTime,o),!m&&this._tTime&&d!==a&&(d=a),p&&1&a&&(r=y-r,f=1),a!==d&&!this._lock){var b=p&&1&d,w=b===(p&&1&a);if(a<d&&(b=!b),m=b?0:y,this._lock=1,this.render(m||(f?0:zc(a*o)),e,!y)._lock=0,this._tTime=v,!e&&this.parent&&Fd(this,"onRepeat"),this.vars.repeatRefresh&&!f&&(this.invalidate()._lock=1),m&&m!==this._time||l!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(y=this._dur,g=this._tDur,w&&(this._lock=2,m=b?y:-1e-4,this.render(m,!0),this.vars.repeatRefresh&&!f&&this.invalidate()),this._lock=0,!this._ts&&!l)return this;ep(this,f)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(h=function(t,e,n){var r;if(n>e)for(r=t._first;r&&r._start<=n;){if("isPause"===r.data&&r._start>e)return r;r=r._next}else for(r=t._last;r&&r._start>=n;){if("isPause"===r.data&&r._start<e)return r;r=r._prev}}(this,zc(m),zc(r)),h&&(v-=r-(r=h._start))),this._tTime=v,this._time=r,this._act=!u,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=t,m=0),!m&&r&&!e&&(Fd(this,"onStart"),this._tTime!==v))return this;if(r>=m&&t>=0)for(i=this._first;i;){if(s=i._next,(i._act||r>=i._start)&&i._ts&&h!==i){if(i.parent!==this)return this.render(t,e,n);if(i.render(i._ts>0?(r-i._start)*i._ts:(i._dirty?i.totalDuration():i._tDur)+(r-i._start)*i._ts,e,n),r!==this._time||!this._ts&&!l){h=0,s&&(v+=this._zTime=-1e-8);break}}i=s}else{i=this._last;for(var _=t<0?t:r;i;){if(s=i._prev,(i._act||_<=i._end)&&i._ts&&h!==i){if(i.parent!==this)return this.render(t,e,n);if(i.render(i._ts>0?(_-i._start)*i._ts:(i._dirty?i.totalDuration():i._tDur)+(_-i._start)*i._ts,e,n),r!==this._time||!this._ts&&!l){h=0,s&&(v+=this._zTime=_?-1e-8:Qu);break}}i=s}}if(h&&!e&&(this.pause(),h.render(r>=m?0:-1e-8)._zTime=r>=m?1:-1,this._ts))return this._start=c,od(this),this.render(t,e,n);this._onUpdate&&!e&&Fd(this,"onUpdate",!0),(v===g&&g>=this.totalDuration()||!v&&m)&&(c!==this._start&&Math.abs(u)===Math.abs(this._ts)||this._lock||((t||!y)&&(v===g&&this._ts>0||!v&&this._ts<0)&&td(this,1),e||t<0&&!m||!v&&!m&&g||(Fd(this,v===g&&t>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(v<g&&this.timeScale()>0)&&this._prom())))}return this},n.add=function(t,e){var n=this;if(lc(e)||(e=vd(this,e,t)),!(t instanceof lp)){if(mc(t))return t.forEach((function(t){return n.add(t,e)})),this;if(ac(t))return this.addLabel(t,e);if(!oc(t))return this;t=xp.delayedCall(0,t)}return this!==t?ud(this,t,e):this},n.getChildren=function(t,e,n,r){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===n&&(n=!0),void 0===r&&(r=-Ju);for(var i=[],s=this._first;s;)s._start>=r&&(s instanceof xp?e&&i.push(s):(n&&i.push(s),t&&i.push.apply(i,s.getChildren(!0,e,n)))),s=s._next;return i},n.getById=function(t){for(var e=this.getChildren(1,1,1),n=e.length;n--;)if(e[n].vars.id===t)return e[n]},n.remove=function(t){return ac(t)?this.removeLabel(t):oc(t)?this.killTweensOf(t):(Qc(this,t),t===this._recent&&(this._recent=this._last),ed(this))},n.totalTime=function(e,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=zc(jd.time-(this._ts>0?e/this._ts:(this.totalDuration()-e)/-this._ts))),t.prototype.totalTime.call(this,e,n),this._forcing=0,this):this._tTime},n.addLabel=function(t,e){return this.labels[t]=vd(this,e),this},n.removeLabel=function(t){return delete this.labels[t],this},n.addPause=function(t,e,n){var r=xp.delayedCall(0,e||Cc,n);return r.data="isPause",this._hasPause=1,ud(this,r,vd(this,t))},n.removePause=function(t){var e=this._first;for(t=vd(this,t);e;)e._start===t&&"isPause"===e.data&&td(e),e=e._next},n.killTweensOf=function(t,e,n){for(var r=this.getTweensOf(t,n),i=r.length;i--;)up!==r[i]&&r[i].kill(t,e);return this},n.getTweensOf=function(t,e){for(var n,r=[],i=Id(t),s=this._first,a=lc(e);s;)s instanceof xp?Gc(s._targets,i)&&(a?(!up||s._initted&&s._ts)&&s.globalTime(0)<=e&&s.globalTime(s.totalDuration())>e:!e||s.isActive())&&r.push(s):(n=s.getTweensOf(i,e)).length&&r.push.apply(r,n),s=s._next;return r},n.tweenTo=function(t,e){e=e||{};var n,r=this,i=vd(r,t),s=e,a=s.startAt,o=s.onStart,l=s.onStartParams,h=s.immediateRender,u=xp.to(r,jc({ease:e.ease||"none",lazy:!1,immediateRender:!1,time:i,overwrite:"auto",duration:e.duration||Math.abs((i-(a&&"time"in a?a.time:r._time))/r.timeScale())||Qu,onStart:function(){if(r.pause(),!n){var t=e.duration||Math.abs((i-(a&&"time"in a?a.time:r._time))/r.timeScale());u._dur!==t&&md(u,t,0,1).render(u._time,!0,!0),n=1}o&&o.apply(u,l||[])}},e));return h?u.render(0):u},n.tweenFromTo=function(t,e,n){return this.tweenTo(e,jc({startAt:{time:vd(this,t)}},n))},n.recent=function(){return this._recent},n.nextLabel=function(t){return void 0===t&&(t=this._time),Dd(this,vd(this,t))},n.previousLabel=function(t){return void 0===t&&(t=this._time),Dd(this,vd(this,t),1)},n.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.previousLabel(this._time+Qu)},n.shiftChildren=function(t,e,n){void 0===n&&(n=0);for(var r,i=this._first,s=this.labels;i;)i._start>=n&&(i._start+=t,i._end+=t),i=i._next;if(e)for(r in s)s[r]>=n&&(s[r]+=t);return ed(this)},n.invalidate=function(){var e=this._first;for(this._lock=0;e;)e.invalidate(),e=e._next;return t.prototype.invalidate.call(this)},n.clear=function(t){void 0===t&&(t=!0);for(var e,n=this._first;n;)e=n._next,this.remove(n),n=e;return this._dp&&(this._time=this._tTime=this._pTime=0),t&&(this.labels={}),ed(this)},n.totalDuration=function(t){var e,n,r,i=0,s=this,a=s._last,o=Ju;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-t:t));if(s._dirty){for(r=s.parent;a;)e=a._prev,a._dirty&&a.totalDuration(),(n=a._start)>o&&s._sort&&a._ts&&!s._lock?(s._lock=1,ud(s,a,n-a._delay,1)._lock=0):o=n,n<0&&a._ts&&(i-=n,(!r&&!s._dp||r&&r.smoothChildTiming)&&(s._start+=n/s._ts,s._time-=n,s._tTime-=n),s.shiftChildren(-n,!1,-Infinity),o=0),a._end>i&&a._ts&&(i=a._end),a=e;md(s,s===Tu&&s._time>i?s._time:i,1,1),s._dirty=0}return s._tDur},e.updateRoot=function(t){if(Tu._ts&&(Xc(Tu,ad(t,Tu)),Cu=jd.frame),jd.frame>=Pc){Pc+=Ku.autoSleep||120;var e=Tu._first;if((!e||!e._ts)&&Ku.autoSleep&&jd._listeners.length<2){for(;e&&!e._ts;)e=e._next;e||jd.sleep()}}},e}(lp);jc(hp.prototype,{_lock:0,_hasPause:0,_forcing:0});var up,cp=function(t,e,n,r,i,s,a){var o,l,h,u,c,d,p,f,m=new Op(this._pt,t,e,0,1,kp,null,i),g=0,y=0;for(m.b=n,m.e=r,n+="",(p=~(r+="").indexOf("random("))&&(r=Od(r)),s&&(s(f=[n,r],t,e),n=f[0],r=f[1]),l=n.match(xc)||[];o=xc.exec(r);)u=o[0],c=r.substring(g,o.index),h?h=(h+1)%5:"rgba("===c.substr(-5)&&(h=1),u!==l[y++]&&(d=parseFloat(l[y-1])||0,m._pt={_next:m._pt,p:c||1===y?c:",",s:d,c:"="===u.charAt(1)?parseFloat(u.substr(2))*("-"===u.charAt(0)?-1:1):parseFloat(u)-d,m:h&&h<4?Math.round:0},g=xc.lastIndex);return m.c=g<r.length?r.substring(g,r.length):"",m.fp=a,(bc.test(r)||p)&&(m.e=0),this._pt=m,m},dp=function(t,e,n,r,i,s,a,o,l){oc(r)&&(r=r(i||0,t,s));var h,u=t[e],c="get"!==n?n:oc(u)?l?t[e.indexOf("set")||!oc(t["get"+e.substr(3)])?e:"get"+e.substr(3)](l):t[e]():u,d=oc(u)?l?_p:wp:bp;if(ac(r)&&(~r.indexOf("random(")&&(r=Od(r)),"="===r.charAt(1)&&((h=parseFloat(c)+parseFloat(r.substr(2))*("-"===r.charAt(0)?-1:1)+(_d(c)||0))||0===h)&&(r=h)),c!==r)return isNaN(c*r)||""===r?cp.call(this,t,e,c,r,d,o||Ku.stringFilter,l):(h=new Op(this._pt,t,e,+c||0,r-(c||0),"boolean"==typeof u?Ip:Sp,0,d),l&&(h.fp=l),a&&h.modifier(a,this,t),this._pt=h)},pp=function(t,e,n,r,i,s){var a,o,l,h;if(Mc[t]&&!1!==(a=new Mc[t]).init(i,a.rawVars?e[t]:function(t,e,n,r,i){if(oc(t)&&(t=gp(t,i,e,n,r)),!uc(t)||t.style&&t.nodeType||mc(t)||fc(t))return ac(t)?gp(t,i,e,n,r):t;var s,a={};for(s in t)a[s]=gp(t[s],i,e,n,r);return a}(e[t],r,i,s,n),n,r,s)&&(n._pt=o=new Op(n._pt,i,t,0,1,a.render,a,0,a.priority),n!==Nu))for(l=n._ptLookup[n._targets.indexOf(i)],h=a._props.length;h--;)l[a._props[h]]=o;return a},fp=function t(e,n){var r,i,s,a,o,l,h,u,c,d,p,f,m,g=e.vars,y=g.ease,v=g.startAt,x=g.immediateRender,b=g.lazy,w=g.onUpdate,_=g.onUpdateParams,T=g.callbackScope,E=g.runBackwards,S=g.yoyoEase,I=g.keyframes,k=g.autoRevert,C=e._dur,N=e._startAt,A=e._targets,R=e.parent,M=R&&"nested"===R.data?R.parent._targets:A,O="auto"===e._overwrite&&!_u,P=e.timeline;if(P&&(!I||!y)&&(y="none"),e._ease=np(y,Zu.ease),e._yEase=S?tp(np(!0===S?y:S,Zu.ease)):0,S&&e._yoyo&&!e._repeat&&(S=e._yEase,e._yEase=e._ease,e._ease=S),e._from=!P&&!!g.runBackwards,!P||I&&!g.stagger){if(f=(u=A[0]?Bc(A[0]).harness:0)&&g[u.prop],r=Zc(g,Nc),N&&td(N.render(-1,!0)),v)if(td(e._startAt=xp.set(A,jc({data:"isStart",overwrite:!1,parent:R,immediateRender:!0,lazy:cc(b),startAt:null,delay:0,onUpdate:w,onUpdateParams:_,callbackScope:T,stagger:0},v))),n<0&&!x&&!k&&e._startAt.render(-1,!0),x){if(n>0&&!k&&(e._startAt=0),C&&n<=0)return void(n&&(e._zTime=n))}else!1===k&&(e._startAt=0);else if(E&&C)if(N)!k&&(e._startAt=0);else if(n&&(x=!1),s=jc({overwrite:!1,data:"isFromStart",lazy:x&&cc(b),immediateRender:x,stagger:0,parent:R},r),f&&(s[u.prop]=f),td(e._startAt=xp.set(A,s)),n<0&&e._startAt.render(-1,!0),e._zTime=n,x){if(!n)return}else t(e._startAt,Qu);for(e._pt=0,b=C&&cc(b)||b&&!C,i=0;i<A.length;i++){if(h=(o=A[i])._gsap||Lc(A)[i]._gsap,e._ptLookup[i]=d={},Rc[h.id]&&Ac.length&&Wc(),p=M===A?i:M.indexOf(o),u&&!1!==(c=new u).init(o,f||r,e,p,M)&&(e._pt=a=new Op(e._pt,o,c.name,0,1,c.render,c,0,c.priority),c._props.forEach((function(t){d[t]=a})),c.priority&&(l=1)),!u||f)for(s in r)Mc[s]&&(c=pp(s,r,e,p,o,M))?c.priority&&(l=1):d[s]=a=dp.call(e,o,s,"get",r[s],p,M,0,g.stringFilter);e._op&&e._op[i]&&e.kill(o,e._op[i]),O&&e._pt&&(up=e,Tu.killTweensOf(o,d,e.globalTime(n)),m=!e.parent,up=0),e._pt&&b&&(Rc[h.id]=1)}l&&Mp(e),e._onInit&&e._onInit(e)}e._onUpdate=w,e._initted=(!e._op||e._pt)&&!m,I&&n<=0&&P.render(Ju,!0,!0)},mp=function(t,e,n,r){var i,s,a=e.ease||r||"power1.inOut";if(mc(e))s=n[t]||(n[t]=[]),e.forEach((function(t,n){return s.push({t:n/(e.length-1)*100,v:t,e:a})}));else for(i in e)s=n[i]||(n[i]=[]),"ease"===i||s.push({t:parseFloat(t),v:e[i],e:a})},gp=function(t,e,n,r,i){return oc(t)?t.call(e,n,r,i):ac(t)&&~t.indexOf("random(")?Od(t):t},yp=Fc+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase",vp={};Uc(yp+",id,stagger,delay,duration,paused,scrollTrigger",(function(t){return vp[t]=1}));var xp=function(t){function e(e,n,r,i){var s;"number"==typeof n&&(r.duration=n,n=r,r=null);var a,o,l,h,u,c,d,p,f=(s=t.call(this,i?n:Jc(n))||this).vars,m=f.duration,g=f.delay,y=f.immediateRender,v=f.stagger,x=f.overwrite,b=f.keyframes,w=f.defaults,_=f.scrollTrigger,T=f.yoyoEase,E=n.parent||Tu,S=(mc(e)||fc(e)?lc(e[0]):"length"in n)?[e]:Id(e);if(s._targets=S.length?Lc(S):Ic(0,!Ku.nullTargetWarn)||[],s._ptLookup=[],s._overwrite=x,b||v||pc(m)||pc(g)){if(n=s.vars,(a=s.timeline=new hp({data:"nested",defaults:w||{}})).kill(),a.parent=a._dp=bu(s),a._start=0,v||pc(m)||pc(g)){if(h=S.length,d=v&&Cd(v),uc(v))for(u in v)~yp.indexOf(u)&&(p||(p={}),p[u]=v[u]);for(o=0;o<h;o++)(l=Zc(n,vp)).stagger=0,T&&(l.yoyoEase=T),p&&qc(l,p),c=S[o],l.duration=+gp(m,bu(s),o,c,S),l.delay=(+gp(g,bu(s),o,c,S)||0)-s._delay,!v&&1===h&&l.delay&&(s._delay=g=l.delay,s._start+=g,l.delay=0),a.to(c,l,d?d(o,c,S):0),a._ease=Kd.none;a.duration()?m=g=0:s.timeline=0}else if(b){Jc(jc(a.vars.defaults,{ease:"none"})),a._ease=np(b.ease||n.ease||"none");var I,k,C,N=0;if(mc(b))b.forEach((function(t){return a.to(S,t,">")}));else{for(u in l={},b)"ease"===u||"easeEach"===u||mp(u,b[u],l,b.easeEach);for(u in l)for(I=l[u].sort((function(t,e){return t.t-e.t})),N=0,o=0;o<I.length;o++)(C={ease:(k=I[o]).e,duration:(k.t-(o?I[o-1].t:0))/100*m})[u]=k.v,a.to(S,C,N),N+=C.duration;a.duration()<m&&a.to({},{duration:m-a.duration()})}}m||s.duration(m=a.duration())}else s.timeline=0;return!0!==x||_u||(up=bu(s),Tu.killTweensOf(S),up=0),ud(E,bu(s),r),n.reversed&&s.reverse(),n.paused&&s.paused(!0),(y||!m&&!b&&s._start===zc(E._time)&&cc(y)&&rd(bu(s))&&"nested"!==E.data)&&(s._tTime=-1e-8,s.render(Math.max(0,-g))),_&&cd(bu(s),_),s}wu(e,t);var n=e.prototype;return n.render=function(t,e,n){var r,i,s,a,o,l,h,u,c,d=this._time,p=this._tDur,f=this._dur,m=t>p-Qu&&t>=0?p:t<Qu?0:t;if(f){if(m!==this._tTime||!t||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!=t<0){if(r=m,u=this.timeline,this._repeat){if(a=f+this._rDelay,this._repeat<-1&&t<0)return this.totalTime(100*a+t,e,n);if(r=zc(m%a),m===p?(s=this._repeat,r=f):((s=~~(m/a))&&s===m/a&&(r=f,s--),r>f&&(r=f)),(l=this._yoyo&&1&s)&&(c=this._yEase,r=f-r),o=sd(this._tTime,a),r===d&&!n&&this._initted)return this;s!==o&&(u&&this._yEase&&ep(u,l),!this.vars.repeatRefresh||l||this._lock||(this._lock=n=1,this.render(zc(a*s),!0).invalidate()._lock=0))}if(!this._initted){if(dd(this,t<0?t:r,n,e))return this._tTime=0,this;if(f!==this._dur)return this.render(t,e,n)}if(this._tTime=m,this._time=r,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=h=(c||this._ease)(r/f),this._from&&(this.ratio=h=1-h),r&&!d&&!e&&(Fd(this,"onStart"),this._tTime!==m))return this;for(i=this._pt;i;)i.r(h,i.d),i=i._next;u&&u.render(t<0?t:!r&&l?-1e-8:u._dur*u._ease(r/this._dur),e,n)||this._startAt&&(this._zTime=t),this._onUpdate&&!e&&(t<0&&this._startAt&&this._startAt.render(t,!0,n),Fd(this,"onUpdate")),this._repeat&&s!==o&&this.vars.onRepeat&&!e&&this.parent&&Fd(this,"onRepeat"),m!==this._tDur&&m||this._tTime!==m||(t<0&&this._startAt&&!this._onUpdate&&this._startAt.render(t,!0,!0),(t||!f)&&(m===this._tDur&&this._ts>0||!m&&this._ts<0)&&td(this,1),e||t<0&&!d||!m&&!d||(Fd(this,m===p?"onComplete":"onReverseComplete",!0),this._prom&&!(m<p&&this.timeScale()>0)&&this._prom()))}}else!function(t,e,n,r){var i,s,a,o=t.ratio,l=e<0||!e&&(!t._start&&pd(t)&&(t._initted||!fd(t))||(t._ts<0||t._dp._ts<0)&&!fd(t))?0:1,h=t._rDelay,u=0;if(h&&t._repeat&&(u=wd(0,t._tDur,e),s=sd(u,h),t._yoyo&&1&s&&(l=1-l),s!==sd(t._tTime,h)&&(o=1-l,t.vars.repeatRefresh&&t._initted&&t.invalidate())),l!==o||r||t._zTime===Qu||!e&&t._zTime){if(!t._initted&&dd(t,e,r,n))return;for(a=t._zTime,t._zTime=e||(n?Qu:0),n||(n=e&&!a),t.ratio=l,t._from&&(l=1-l),t._time=0,t._tTime=u,i=t._pt;i;)i.r(l,i.d),i=i._next;t._startAt&&e<0&&t._startAt.render(e,!0,!0),t._onUpdate&&!n&&Fd(t,"onUpdate"),u&&t._repeat&&!n&&t.parent&&Fd(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===l&&(l&&td(t,1),n||(Fd(t,l?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)}(this,t,e,n);return this},n.targets=function(){return this._targets},n.invalidate=function(){return this._pt=this._op=this._startAt=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),t.prototype.invalidate.call(this)},n.kill=function(t,e){if(void 0===e&&(e="all"),!(t||e&&"all"!==e))return this._lazy=this._pt=0,this.parent?Ld(this):this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(t,e,up&&!0!==up.vars.overwrite)._first||Ld(this),this.parent&&n!==this.timeline.totalDuration()&&md(this,this._dur*this.timeline._tDur/n,0,1),this}var r,i,s,a,o,l,h,u=this._targets,c=t?Id(t):u,d=this._ptLookup,p=this._pt;if((!e||"all"===e)&&function(t,e){for(var n=t.length,r=n===e.length;r&&n--&&t[n]===e[n];);return n<0}(u,c))return"all"===e&&(this._pt=0),Ld(this);for(r=this._op=this._op||[],"all"!==e&&(ac(e)&&(o={},Uc(e,(function(t){return o[t]=1})),e=o),e=function(t,e){var n,r,i,s,a=t[0]?Bc(t[0]).harness:0,o=a&&a.aliases;if(!o)return e;for(r in n=qc({},e),o)if(r in n)for(i=(s=o[r].split(",")).length;i--;)n[s[i]]=n[r];return n}(u,e)),h=u.length;h--;)if(~c.indexOf(u[h]))for(o in i=d[h],"all"===e?(r[h]=e,a=i,s={}):(s=r[h]=r[h]||{},a=e),a)(l=i&&i[o])&&("kill"in l.d&&!0!==l.d.kill(o)||Qc(this,l,"_pt"),delete i[o]),"all"!==s&&(s[o]=1);return this._initted&&!this._pt&&p&&Ld(this),this},e.to=function(t,n){return new e(t,n,arguments[2])},e.from=function(t,e){return xd(1,arguments)},e.delayedCall=function(t,n,r,i){return new e(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:t,onComplete:n,onReverseComplete:n,onCompleteParams:r,onReverseCompleteParams:r,callbackScope:i})},e.fromTo=function(t,e,n){return xd(2,arguments)},e.set=function(t,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new e(t,n)},e.killTweensOf=function(t,e,n){return Tu.killTweensOf(t,e,n)},e}(lp);jc(xp.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),Uc("staggerTo,staggerFrom,staggerFromTo",(function(t){xp[t]=function(){var e=new hp,n=Td.call(arguments,0);return n.splice("staggerFromTo"===t?5:4,0,0),e[t].apply(e,n)}}));var bp=function(t,e,n){return t[e]=n},wp=function(t,e,n){return t[e](n)},_p=function(t,e,n,r){return t[e](r.fp,n)},Tp=function(t,e,n){return t.setAttribute(e,n)},Ep=function(t,e){return oc(t[e])?wp:hc(t[e])&&t.setAttribute?Tp:bp},Sp=function(t,e){return e.set(e.t,e.p,Math.round(1e6*(e.s+e.c*t))/1e6,e)},Ip=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},kp=function(t,e){var n=e._pt,r="";if(!t&&e.b)r=e.b;else if(1===t&&e.e)r=e.e;else{for(;n;)r=n.p+(n.m?n.m(n.s+n.c*t):Math.round(1e4*(n.s+n.c*t))/1e4)+r,n=n._next;r+=e.c}e.set(e.t,e.p,r,e)},Cp=function(t,e){for(var n=e._pt;n;)n.r(t,n.d),n=n._next},Np=function(t,e,n,r){for(var i,s=this._pt;s;)i=s._next,s.p===r&&s.modifier(t,e,n),s=i},Ap=function(t){for(var e,n,r=this._pt;r;)n=r._next,r.p===t&&!r.op||r.op===t?Qc(this,r,"_pt"):r.dep||(e=1),r=n;return!e},Rp=function(t,e,n,r){r.mSet(t,e,r.m.call(r.tween,n,r.mt),r)},Mp=function(t){for(var e,n,r,i,s=t._pt;s;){for(e=s._next,n=r;n&&n.pr>s.pr;)n=n._next;(s._prev=n?n._prev:i)?s._prev._next=s:r=s,(s._next=n)?n._prev=s:i=s,s=e}t._pt=r},Op=function(){function t(t,e,n,r,i,s,a,o,l){this.t=e,this.s=r,this.c=i,this.p=n,this.r=s||Sp,this.d=a||this,this.set=o||bp,this.pr=l||0,this._next=t,t&&(t._prev=this)}return t.prototype.modifier=function(t,e,n){this.mSet=this.mSet||this.set,this.set=Rp,this.m=t,this.mt=n,this.tween=e},t}();Uc(Fc+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(t){return Nc[t]=1})),Tc.TweenMax=Tc.TweenLite=xp,Tc.TimelineLite=Tc.TimelineMax=hp,Tu=new hp({sortChildren:!1,defaults:Zu,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),Ku.stringFilter=Yd;var Pp={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach((function(t){return Bd(t)}))},timeline:function(t){return new hp(t)},getTweensOf:function(t,e){return Tu.getTweensOf(t,e)},getProperty:function(t,e,n,r){ac(t)&&(t=Id(t)[0]);var i=Bc(t||{}).get,s=n?Yc:Hc;return"native"===n&&(n=""),t?e?s((Mc[e]&&Mc[e].get||i)(t,e,n,r)):function(e,n,r){return s((Mc[e]&&Mc[e].get||i)(t,e,n,r))}:t},quickSetter:function(t,e,n){if((t=Id(t)).length>1){var r=t.map((function(t){return Lp.quickSetter(t,e,n)})),i=r.length;return function(t){for(var e=i;e--;)r[e](t)}}t=t[0]||{};var s=Mc[e],a=Bc(t),o=a.harness&&(a.harness.aliases||{})[e]||e,l=s?function(e){var r=new s;Nu._pt=0,r.init(t,n?e+n:e,Nu,0,[t]),r.render(1,r),Nu._pt&&Cp(1,Nu)}:a.set(t,o);return s?l:function(e){return l(t,o,n?e+n:e,a,1)}},isTweening:function(t){return Tu.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=np(t.ease,Zu.ease)),Kc(Zu,t||{})},config:function(t){return Kc(Ku,t||{})},registerEffect:function(t){var e=t.name,n=t.effect,r=t.plugins,i=t.defaults,s=t.extendTimeline;(r||"").split(",").forEach((function(t){return t&&!Mc[t]&&!Tc[t]&&Ic()})),Oc[e]=function(t,e,r){return n(Id(t),jc(e||{},i),r)},s&&(hp.prototype[e]=function(t,n,r){return this.add(Oc[e](t,uc(n)?n:(r=n)&&{},this),r)})},registerEase:function(t,e){Kd[t]=np(e)},parseEase:function(t,e){return arguments.length?np(t,e):Kd},getById:function(t){return Tu.getById(t)},exportRoot:function(t,e){void 0===t&&(t={});var n,r,i=new hp(t);for(i.smoothChildTiming=cc(t.smoothChildTiming),Tu.remove(i),i._dp=0,i._time=i._tTime=Tu._time,n=Tu._first;n;)r=n._next,!e&&!n._dur&&n instanceof xp&&n.vars.onComplete===n._targets[0]||ud(i,n,n._start-n._delay),n=r;return ud(Tu,i,0),i},utils:{wrap:function t(e,n,r){var i=n-e;return mc(e)?Md(e,t(0,e.length),n):bd(r,(function(t){return(i+(t-e)%i)%i+e}))},wrapYoyo:function t(e,n,r){var i=n-e,s=2*i;return mc(e)?Md(e,t(0,e.length-1),n):bd(r,(function(t){return e+((t=(s+(t-e)%s)%s||0)>i?s-t:t)}))},distribute:Cd,random:Rd,snap:Ad,normalize:function(t,e,n){return Pd(t,e,0,1,n)},getUnit:_d,clamp:function(t,e,n){return bd(n,(function(n){return wd(t,e,n)}))},splitColor:zd,toArray:Id,selector:function(t){return t=Id(t)[0]||Ic()||{},function(e){var n=t.current||t.nativeElement||t;return Id(e,n.querySelectorAll?n:n===t?Ic()||Iu.createElement("div"):t)}},mapRange:Pd,pipe:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.reduce((function(t,e){return e(t)}),t)}},unitize:function(t,e){return function(n){return t(parseFloat(n))+(e||_d(n))}},interpolate:function t(e,n,r,i){var s=isNaN(e+n)?0:function(t){return(1-t)*e+t*n};if(!s){var a,o,l,h,u,c=ac(e),d={};if(!0===r&&(i=1)&&(r=null),c)e={p:e},n={p:n};else if(mc(e)&&!mc(n)){for(l=[],h=e.length,u=h-2,o=1;o<h;o++)l.push(t(e[o-1],e[o]));h--,s=function(t){t*=h;var e=Math.min(u,~~t);return l[e](t-e)},r=n}else i||(e=qc(mc(e)?[]:{},e));if(!l){for(a in n)dp.call(d,e,a,"get",n[a]);s=function(t){return Cp(t,d)||(c?e.p:e)}}}return bd(r,s)},shuffle:kd},install:Sc,effects:Oc,ticker:jd,updateRoot:hp.updateRoot,plugins:Mc,globalTimeline:Tu,core:{PropTween:Op,globals:kc,Tween:xp,Timeline:hp,Animation:lp,getCache:Bc,_removeLinkedListItem:Qc,suppressOverwrites:function(t){return _u=t}}};Uc("to,from,fromTo,delayedCall,set,killTweensOf",(function(t){return Pp[t]=xp[t]})),jd.add(hp.updateRoot),Nu=Pp.to({},{duration:0});var Dp=function(t,e){for(var n=t._pt;n&&n.p!==e&&n.op!==e&&n.fp!==e;)n=n._next;return n},Fp=function(t,e){return{name:t,rawVars:1,init:function(t,n,r){r._onInit=function(t){var r,i;if(ac(n)&&(r={},Uc(n,(function(t){return r[t]=1})),n=r),e){for(i in r={},n)r[i]=e(n[i]);n=r}!function(t,e){var n,r,i,s=t._targets;for(n in e)for(r=s.length;r--;)(i=t._ptLookup[r][n])&&(i=i.d)&&(i._pt&&(i=Dp(i,n)),i&&i.modifier&&i.modifier(e[n],t,s[r],n))}(t,n)}}}},Lp=Pp.registerPlugin({name:"attr",init:function(t,e,n,r,i){var s,a;for(s in e)(a=this.add(t,"setAttribute",(t.getAttribute(s)||0)+"",e[s],r,i,0,0,s))&&(a.op=s),this._props.push(s)}},{name:"endArray",init:function(t,e){for(var n=e.length;n--;)this.add(t,n,t[n]||0,e[n])}},Fp("roundProps",Nd),Fp("modifiers"),Fp("snap",Ad))||Pp;xp.version=hp.version=Lp.version="3.9.1",ku=1,dc()&&qd();Kd.Power0,Kd.Power1,Kd.Power2,Kd.Power3,Kd.Power4,Kd.Linear,Kd.Quad,Kd.Cubic,Kd.Quart,Kd.Quint,Kd.Strong,Kd.Elastic,Kd.Back,Kd.SteppedEase,Kd.Bounce,Kd.Sine,Kd.Expo,Kd.Circ;var Bp,$p,Up,Vp,zp,Gp,Wp,Xp={},Hp=180/Math.PI,Yp=Math.PI/180,jp=Math.atan2,qp=/([A-Z])/g,Kp=/(?:left|right|width|margin|padding|x)/i,Zp=/[\s,\(]\S/,Jp={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Qp=function(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},tf=function(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},ef=function(t,e){return e.set(e.t,e.p,t?Math.round(1e4*(e.s+e.c*t))/1e4+e.u:e.b,e)},nf=function(t,e){var n=e.s+e.c*t;e.set(e.t,e.p,~~(n+(n<0?-.5:.5))+e.u,e)},rf=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},sf=function(t,e){return e.set(e.t,e.p,1!==t?e.b:e.e,e)},af=function(t,e,n){return t.style[e]=n},of=function(t,e,n){return t.style.setProperty(e,n)},lf=function(t,e,n){return t._gsap[e]=n},hf=function(t,e,n){return t._gsap.scaleX=t._gsap.scaleY=n},uf=function(t,e,n,r,i){var s=t._gsap;s.scaleX=s.scaleY=n,s.renderTransform(i,s)},cf=function(t,e,n,r,i){var s=t._gsap;s[e]=n,s.renderTransform(i,s)},df="transform",pf=df+"Origin",ff=function(t,e){var n=$p.createElementNS?$p.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):$p.createElement(t);return n.style?n:$p.createElement(t)},mf=function t(e,n,r){var i=getComputedStyle(e);return i[n]||i.getPropertyValue(n.replace(qp,"-$1").toLowerCase())||i.getPropertyValue(n)||!r&&t(e,yf(n)||n,1)||""},gf="O,Moz,ms,Ms,Webkit".split(","),yf=function(t,e,n){var r=(e||zp).style,i=5;if(t in r&&!n)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);i--&&!(gf[i]+t in r););return i<0?null:(3===i?"ms":i>=0?gf[i]:"")+t},vf=function(){"undefined"!=typeof window&&window.document&&(Bp=window,$p=Bp.document,Up=$p.documentElement,zp=ff("div")||{style:{}},ff("div"),df=yf(df),pf=df+"Origin",zp.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Wp=!!yf("perspective"),Vp=1)},xf=function t(e){var n,r=ff("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=this.parentNode,s=this.nextSibling,a=this.style.cssText;if(Up.appendChild(r),r.appendChild(this),this.style.display="block",e)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=t}catch(t){}else this._gsapBBox&&(n=this._gsapBBox());return i&&(s?i.insertBefore(this,s):i.appendChild(this)),Up.removeChild(r),this.style.cssText=a,n},bf=function(t,e){for(var n=e.length;n--;)if(t.hasAttribute(e[n]))return t.getAttribute(e[n])},wf=function(t){var e;try{e=t.getBBox()}catch(n){e=xf.call(t,!0)}return e&&(e.width||e.height)||t.getBBox===xf||(e=xf.call(t,!0)),!e||e.width||e.x||e.y?e:{x:+bf(t,["x","cx","x1"])||0,y:+bf(t,["y","cy","y1"])||0,width:0,height:0}},_f=function(t){return!(!t.getCTM||t.parentNode&&!t.ownerSVGElement||!wf(t))},Tf=function(t,e){if(e){var n=t.style;e in Xp&&e!==pf&&(e=df),n.removeProperty?("ms"!==e.substr(0,2)&&"webkit"!==e.substr(0,6)||(e="-"+e),n.removeProperty(e.replace(qp,"-$1").toLowerCase())):n.removeAttribute(e)}},Ef=function(t,e,n,r,i,s){var a=new Op(t._pt,e,n,0,1,s?sf:rf);return t._pt=a,a.b=r,a.e=i,t._props.push(n),a},Sf={deg:1,rad:1,turn:1},If=function t(e,n,r,i){var s,a,o,l,h=parseFloat(r)||0,u=(r+"").trim().substr((h+"").length)||"px",c=zp.style,d=Kp.test(n),p="svg"===e.tagName.toLowerCase(),f=(p?"client":"offset")+(d?"Width":"Height"),m=100,g="px"===i,y="%"===i;return i===u||!h||Sf[i]||Sf[u]?h:("px"!==u&&!g&&(h=t(e,n,r,"px")),l=e.getCTM&&_f(e),!y&&"%"!==u||!Xp[n]&&!~n.indexOf("adius")?(c[d?"width":"height"]=m+(g?u:i),a=~n.indexOf("adius")||"em"===i&&e.appendChild&&!p?e:e.parentNode,l&&(a=(e.ownerSVGElement||{}).parentNode),a&&a!==$p&&a.appendChild||(a=$p.body),(o=a._gsap)&&y&&o.width&&d&&o.time===jd.time?Vc(h/o.width*m):((y||"%"===u)&&(c.position=mf(e,"position")),a===e&&(c.position="static"),a.appendChild(zp),s=zp[f],a.removeChild(zp),c.position="absolute",d&&y&&((o=Bc(a)).time=jd.time,o.width=a[f]),Vc(g?s*h/m:s&&h?m/s*h:0))):(s=l?e.getBBox()[d?"width":"height"]:e[f],Vc(y?h/s*m:h/100*s)))},kf=function(t,e,n,r){var i;return Vp||vf(),e in Jp&&"transform"!==e&&~(e=Jp[e]).indexOf(",")&&(e=e.split(",")[0]),Xp[e]&&"transform"!==e?(i=$f(t,r),i="transformOrigin"!==e?i[e]:i.svg?i.origin:Uf(mf(t,pf))+" "+i.zOrigin+"px"):(!(i=t.style[e])||"auto"===i||r||~(i+"").indexOf("calc("))&&(i=Mf[e]&&Mf[e](t,e,n)||mf(t,e)||$c(t,e)||("opacity"===e?1:0)),n&&!~(i+"").trim().indexOf(" ")?If(t,e,i,n)+n:i},Cf=function(t,e,n,r){if(!n||"none"===n){var i=yf(e,t,1),s=i&&mf(t,i,1);s&&s!==n?(e=i,n=s):"borderColor"===e&&(n=mf(t,"borderTopColor"))}var a,o,l,h,u,c,d,p,f,m,g,y,v=new Op(this._pt,t.style,e,0,1,kp),x=0,b=0;if(v.b=n,v.e=r,n+="","auto"===(r+="")&&(t.style[e]=r,r=mf(t,e)||r,t.style[e]=n),Yd(a=[n,r]),r=a[1],l=(n=a[0]).match(vc)||[],(r.match(vc)||[]).length){for(;o=vc.exec(r);)d=o[0],f=r.substring(x,o.index),u?u=(u+1)%5:"rgba("!==f.substr(-5)&&"hsla("!==f.substr(-5)||(u=1),d!==(c=l[b++]||"")&&(h=parseFloat(c)||0,g=c.substr((h+"").length),(y="="===d.charAt(1)?+(d.charAt(0)+"1"):0)&&(d=d.substr(2)),p=parseFloat(d),m=d.substr((p+"").length),x=vc.lastIndex-m.length,m||(m=m||Ku.units[e]||g,x===r.length&&(r+=m,v.e+=m)),g!==m&&(h=If(t,e,c,m)||0),v._pt={_next:v._pt,p:f||1===b?f:",",s:h,c:y?y*p:p-h,m:u&&u<4||"zIndex"===e?Math.round:0});v.c=x<r.length?r.substring(x,r.length):""}else v.r="display"===e&&"none"===r?sf:rf;return bc.test(r)&&(v.e=0),this._pt=v,v},Nf={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Af=function(t){var e=t.split(" "),n=e[0],r=e[1]||"50%";return"top"!==n&&"bottom"!==n&&"left"!==r&&"right"!==r||(t=n,n=r,r=t),e[0]=Nf[n]||n,e[1]=Nf[r]||r,e.join(" ")},Rf=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var n,r,i,s=e.t,a=s.style,o=e.u,l=s._gsap;if("all"===o||!0===o)a.cssText="",r=1;else for(i=(o=o.split(",")).length;--i>-1;)n=o[i],Xp[n]&&(r=1,n="transformOrigin"===n?pf:df),Tf(s,n);r&&(Tf(s,df),l&&(l.svg&&s.removeAttribute("transform"),$f(s,1),l.uncache=1))}},Mf={clearProps:function(t,e,n,r,i){if("isFromStart"!==i.data){var s=t._pt=new Op(t._pt,e,n,0,0,Rf);return s.u=r,s.pr=-10,s.tween=i,t._props.push(n),1}}},Of=[1,0,0,1,0,0],Pf={},Df=function(t){return"matrix(1, 0, 0, 1, 0, 0)"===t||"none"===t||!t},Ff=function(t){var e=mf(t,df);return Df(e)?Of:e.substr(7).match(yc).map(Vc)},Lf=function(t,e){var n,r,i,s,a=t._gsap||Bc(t),o=t.style,l=Ff(t);return a.svg&&t.getAttribute("transform")?"1,0,0,1,0,0"===(l=[(i=t.transform.baseVal.consolidate().matrix).a,i.b,i.c,i.d,i.e,i.f]).join(",")?Of:l:(l!==Of||t.offsetParent||t===Up||a.svg||(i=o.display,o.display="block",(n=t.parentNode)&&t.offsetParent||(s=1,r=t.nextSibling,Up.appendChild(t)),l=Ff(t),i?o.display=i:Tf(t,"display"),s&&(r?n.insertBefore(t,r):n?n.appendChild(t):Up.removeChild(t))),e&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},Bf=function(t,e,n,r,i,s){var a,o,l,h=t._gsap,u=i||Lf(t,!0),c=h.xOrigin||0,d=h.yOrigin||0,p=h.xOffset||0,f=h.yOffset||0,m=u[0],g=u[1],y=u[2],v=u[3],x=u[4],b=u[5],w=e.split(" "),_=parseFloat(w[0])||0,T=parseFloat(w[1])||0;n?u!==Of&&(o=m*v-g*y)&&(l=_*(-g/o)+T*(m/o)-(m*b-g*x)/o,_=_*(v/o)+T*(-y/o)+(y*b-v*x)/o,T=l):(_=(a=wf(t)).x+(~w[0].indexOf("%")?_/100*a.width:_),T=a.y+(~(w[1]||w[0]).indexOf("%")?T/100*a.height:T)),r||!1!==r&&h.smooth?(x=_-c,b=T-d,h.xOffset=p+(x*m+b*y)-x,h.yOffset=f+(x*g+b*v)-b):h.xOffset=h.yOffset=0,h.xOrigin=_,h.yOrigin=T,h.smooth=!!r,h.origin=e,h.originIsAbsolute=!!n,t.style[pf]="0px 0px",s&&(Ef(s,h,"xOrigin",c,_),Ef(s,h,"yOrigin",d,T),Ef(s,h,"xOffset",p,h.xOffset),Ef(s,h,"yOffset",f,h.yOffset)),t.setAttribute("data-svg-origin",_+" "+T)},$f=function(t,e){var n=t._gsap||new op(t);if("x"in n&&!e&&!n.uncache)return n;var r,i,s,a,o,l,h,u,c,d,p,f,m,g,y,v,x,b,w,_,T,E,S,I,k,C,N,A,R,M,O,P,D=t.style,F=n.scaleX<0,L="px",B="deg",$=mf(t,pf)||"0";return r=i=s=l=h=u=c=d=p=0,a=o=1,n.svg=!(!t.getCTM||!_f(t)),g=Lf(t,n.svg),n.svg&&(I=(!n.uncache||"0px 0px"===$)&&!e&&t.getAttribute("data-svg-origin"),Bf(t,I||$,!!I||n.originIsAbsolute,!1!==n.smooth,g)),f=n.xOrigin||0,m=n.yOrigin||0,g!==Of&&(b=g[0],w=g[1],_=g[2],T=g[3],r=E=g[4],i=S=g[5],6===g.length?(a=Math.sqrt(b*b+w*w),o=Math.sqrt(T*T+_*_),l=b||w?jp(w,b)*Hp:0,(c=_||T?jp(_,T)*Hp+l:0)&&(o*=Math.abs(Math.cos(c*Yp))),n.svg&&(r-=f-(f*b+m*_),i-=m-(f*w+m*T))):(P=g[6],M=g[7],N=g[8],A=g[9],R=g[10],O=g[11],r=g[12],i=g[13],s=g[14],h=(y=jp(P,R))*Hp,y&&(I=E*(v=Math.cos(-y))+N*(x=Math.sin(-y)),k=S*v+A*x,C=P*v+R*x,N=E*-x+N*v,A=S*-x+A*v,R=P*-x+R*v,O=M*-x+O*v,E=I,S=k,P=C),u=(y=jp(-_,R))*Hp,y&&(v=Math.cos(-y),O=T*(x=Math.sin(-y))+O*v,b=I=b*v-N*x,w=k=w*v-A*x,_=C=_*v-R*x),l=(y=jp(w,b))*Hp,y&&(I=b*(v=Math.cos(y))+w*(x=Math.sin(y)),k=E*v+S*x,w=w*v-b*x,S=S*v-E*x,b=I,E=k),h&&Math.abs(h)+Math.abs(l)>359.9&&(h=l=0,u=180-u),a=Vc(Math.sqrt(b*b+w*w+_*_)),o=Vc(Math.sqrt(S*S+P*P)),y=jp(E,S),c=Math.abs(y)>2e-4?y*Hp:0,p=O?1/(O<0?-O:O):0),n.svg&&(I=t.getAttribute("transform"),n.forceCSS=t.setAttribute("transform","")||!Df(mf(t,df)),I&&t.setAttribute("transform",I))),Math.abs(c)>90&&Math.abs(c)<270&&(F?(a*=-1,c+=l<=0?180:-180,l+=l<=0?180:-180):(o*=-1,c+=c<=0?180:-180)),n.x=r-((n.xPercent=r&&(n.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-r)?-50:0)))?t.offsetWidth*n.xPercent/100:0)+L,n.y=i-((n.yPercent=i&&(n.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-i)?-50:0)))?t.offsetHeight*n.yPercent/100:0)+L,n.z=s+L,n.scaleX=Vc(a),n.scaleY=Vc(o),n.rotation=Vc(l)+B,n.rotationX=Vc(h)+B,n.rotationY=Vc(u)+B,n.skewX=c+B,n.skewY=d+B,n.transformPerspective=p+L,(n.zOrigin=parseFloat($.split(" ")[2])||0)&&(D[pf]=Uf($)),n.xOffset=n.yOffset=0,n.force3D=Ku.force3D,n.renderTransform=n.svg?Yf:Wp?Hf:zf,n.uncache=0,n},Uf=function(t){return(t=t.split(" "))[0]+" "+t[1]},Vf=function(t,e,n){var r=_d(e);return Vc(parseFloat(e)+parseFloat(If(t,"x",n+"px",r)))+r},zf=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,Hf(t,e)},Gf="0deg",Wf="0px",Xf=") ",Hf=function(t,e){var n=e||this,r=n.xPercent,i=n.yPercent,s=n.x,a=n.y,o=n.z,l=n.rotation,h=n.rotationY,u=n.rotationX,c=n.skewX,d=n.skewY,p=n.scaleX,f=n.scaleY,m=n.transformPerspective,g=n.force3D,y=n.target,v=n.zOrigin,x="",b="auto"===g&&t&&1!==t||!0===g;if(v&&(u!==Gf||h!==Gf)){var w,_=parseFloat(h)*Yp,T=Math.sin(_),E=Math.cos(_);_=parseFloat(u)*Yp,w=Math.cos(_),s=Vf(y,s,T*w*-v),a=Vf(y,a,-Math.sin(_)*-v),o=Vf(y,o,E*w*-v+v)}m!==Wf&&(x+="perspective("+m+Xf),(r||i)&&(x+="translate("+r+"%, "+i+"%) "),(b||s!==Wf||a!==Wf||o!==Wf)&&(x+=o!==Wf||b?"translate3d("+s+", "+a+", "+o+") ":"translate("+s+", "+a+Xf),l!==Gf&&(x+="rotate("+l+Xf),h!==Gf&&(x+="rotateY("+h+Xf),u!==Gf&&(x+="rotateX("+u+Xf),c===Gf&&d===Gf||(x+="skew("+c+", "+d+Xf),1===p&&1===f||(x+="scale("+p+", "+f+Xf),y.style[df]=x||"translate(0, 0)"},Yf=function(t,e){var n,r,i,s,a,o=e||this,l=o.xPercent,h=o.yPercent,u=o.x,c=o.y,d=o.rotation,p=o.skewX,f=o.skewY,m=o.scaleX,g=o.scaleY,y=o.target,v=o.xOrigin,x=o.yOrigin,b=o.xOffset,w=o.yOffset,_=o.forceCSS,T=parseFloat(u),E=parseFloat(c);d=parseFloat(d),p=parseFloat(p),(f=parseFloat(f))&&(p+=f=parseFloat(f),d+=f),d||p?(d*=Yp,p*=Yp,n=Math.cos(d)*m,r=Math.sin(d)*m,i=Math.sin(d-p)*-g,s=Math.cos(d-p)*g,p&&(f*=Yp,a=Math.tan(p-f),i*=a=Math.sqrt(1+a*a),s*=a,f&&(a=Math.tan(f),n*=a=Math.sqrt(1+a*a),r*=a)),n=Vc(n),r=Vc(r),i=Vc(i),s=Vc(s)):(n=m,s=g,r=i=0),(T&&!~(u+"").indexOf("px")||E&&!~(c+"").indexOf("px"))&&(T=If(y,"x",u,"px"),E=If(y,"y",c,"px")),(v||x||b||w)&&(T=Vc(T+v-(v*n+x*i)+b),E=Vc(E+x-(v*r+x*s)+w)),(l||h)&&(a=y.getBBox(),T=Vc(T+l/100*a.width),E=Vc(E+h/100*a.height)),a="matrix("+n+","+r+","+i+","+s+","+T+","+E+")",y.setAttribute("transform",a),_&&(y.style[df]=a)},jf=function(t,e,n,r,i,s){var a,o,l=360,h=ac(i),u=parseFloat(i)*(h&&~i.indexOf("rad")?Hp:1),c=s?u*s:u-r,d=r+c+"deg";return h&&("short"===(a=i.split("_")[1])&&(c%=l)!==c%180&&(c+=c<0?l:-360),"cw"===a&&c<0?c=(c+36e9)%l-~~(c/l)*l:"ccw"===a&&c>0&&(c=(c-36e9)%l-~~(c/l)*l)),t._pt=o=new Op(t._pt,e,n,r,c,tf),o.e=d,o.u="deg",t._props.push(n),o},qf=function(t,e){for(var n in e)t[n]=e[n];return t},Kf=function(t,e,n){var r,i,s,a,o,l,h,u=qf({},n._gsap),c=n.style;for(i in u.svg?(s=n.getAttribute("transform"),n.setAttribute("transform",""),c[df]=e,r=$f(n,1),Tf(n,df),n.setAttribute("transform",s)):(s=getComputedStyle(n)[df],c[df]=e,r=$f(n,1),c[df]=s),Xp)(s=u[i])!==(a=r[i])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(i)<0&&(o=_d(s)!==(h=_d(a))?If(n,i,s,h):parseFloat(s),l=parseFloat(a),t._pt=new Op(t._pt,r,i,o,l-o,Qp),t._pt.u=h||0,t._props.push(i));qf(r,u)};Uc("padding,margin,Width,Radius",(function(t,e){var n="Top",r="Right",i="Bottom",s="Left",a=(e<3?[n,r,i,s]:[n+s,n+r,i+r,i+s]).map((function(n){return e<2?t+n:"border"+n+t}));Mf[e>1?"border"+t:t]=function(t,e,n,r,i){var s,o;if(arguments.length<4)return s=a.map((function(e){return kf(t,e,n)})),5===(o=s.join(" ")).split(s[0]).length?s[0]:o;s=(r+"").split(" "),o={},a.forEach((function(t,e){return o[t]=s[e]=s[e]||s[(e-1)/2|0]})),t.init(e,o,i)}}));var Zf,Jf,Qf,tm={name:"css",register:vf,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,n,r,i){var s,a,o,l,h,u,c,d,p,f,m,g,y,v,x,b=this._props,w=t.style,_=n.vars.startAt;for(c in Vp||vf(),e)if("autoRound"!==c&&(a=e[c],!Mc[c]||!pp(c,e,n,r,t,i)))if(h=typeof a,u=Mf[c],"function"===h&&(h=typeof(a=a.call(n,r,t,i))),"string"===h&&~a.indexOf("random(")&&(a=Od(a)),u)u(this,t,c,a,n)&&(x=1);else if("--"===c.substr(0,2))s=(getComputedStyle(t).getPropertyValue(c)+"").trim(),a+="",Xd.lastIndex=0,Xd.test(s)||(d=_d(s),p=_d(a)),p?d!==p&&(s=If(t,c,s,p)+p):d&&(a+=d),this.add(w,"setProperty",s,a,r,i,0,0,c),b.push(c);else if("undefined"!==h){if(_&&c in _?(s="function"==typeof _[c]?_[c].call(n,r,t,i):_[c],ac(s)&&~s.indexOf("random(")&&(s=Od(s)),_d(s+"")||(s+=Ku.units[c]||_d(kf(t,c))||""),"="===(s+"").charAt(1)&&(s=kf(t,c))):s=kf(t,c),l=parseFloat(s),(f="string"===h&&"="===a.charAt(1)?+(a.charAt(0)+"1"):0)&&(a=a.substr(2)),o=parseFloat(a),c in Jp&&("autoAlpha"===c&&(1===l&&"hidden"===kf(t,"visibility")&&o&&(l=0),Ef(this,w,"visibility",l?"inherit":"hidden",o?"inherit":"hidden",!o)),"scale"!==c&&"transform"!==c&&~(c=Jp[c]).indexOf(",")&&(c=c.split(",")[0])),m=c in Xp)if(g||((y=t._gsap).renderTransform&&!e.parseTransform||$f(t,e.parseTransform),v=!1!==e.smoothOrigin&&y.smooth,(g=this._pt=new Op(this._pt,w,df,0,1,y.renderTransform,y,0,-1)).dep=1),"scale"===c)this._pt=new Op(this._pt,y,"scaleY",y.scaleY,(f?f*o:o-y.scaleY)||0),b.push("scaleY",c),c+="X";else{if("transformOrigin"===c){a=Af(a),y.svg?Bf(t,a,0,v,0,this):((p=parseFloat(a.split(" ")[2])||0)!==y.zOrigin&&Ef(this,y,"zOrigin",y.zOrigin,p),Ef(this,w,c,Uf(s),Uf(a)));continue}if("svgOrigin"===c){Bf(t,a,1,v,0,this);continue}if(c in Pf){jf(this,y,c,l,a,f);continue}if("smoothOrigin"===c){Ef(this,y,"smooth",y.smooth,a);continue}if("force3D"===c){y[c]=a;continue}if("transform"===c){Kf(this,a,t);continue}}else c in w||(c=yf(c)||c);if(m||(o||0===o)&&(l||0===l)&&!Zp.test(a)&&c in w)o||(o=0),(d=(s+"").substr((l+"").length))!==(p=_d(a)||(c in Ku.units?Ku.units[c]:d))&&(l=If(t,c,s,p)),this._pt=new Op(this._pt,m?y:w,c,l,f?f*o:o-l,m||"px"!==p&&"zIndex"!==c||!1===e.autoRound?Qp:nf),this._pt.u=p||0,d!==p&&"%"!==p&&(this._pt.b=s,this._pt.r=ef);else if(c in w)Cf.call(this,t,c,s,a);else{if(!(c in t))continue;this.add(t,c,s||t[c],a,r,i)}b.push(c)}x&&Mp(this)},get:kf,aliases:Jp,getSetter:function(t,e,n){var r=Jp[e];return r&&r.indexOf(",")<0&&(e=r),e in Xp&&e!==pf&&(t._gsap.x||kf(t,"x"))?n&&Gp===n?"scale"===e?hf:lf:(Gp=n||{})&&("scale"===e?uf:cf):t.style&&!hc(t.style[e])?af:~e.indexOf("-")?of:Ep(t,e)},core:{_removeProperty:Tf,_getMatrix:Lf}};Lp.utils.checkPrefix=yf,Qf=Uc((Zf="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(Jf="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(t){Xp[t]=1})),Uc(Jf,(function(t){Ku.units[t]="deg",Pf[t]=1})),Jp[Qf[13]]=Zf+","+Jf,Uc("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(t){var e=t.split(":");Jp[e[1]]=Qf[e[0]]})),Uc("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(t){Ku.units[t]="px"})),Lp.registerPlugin(tm);var em=Lp.registerPlugin(tm)||Lp;em.core.Tween;class nm{constructor(t,e,n){this.value=t,this.time=e,this.next=null,this.isStepped=!1,this.ease=n?"function"==typeof n?n:cm(n):null}static createList(t){if("list"in t){const e=t.list;let n;const{value:r,time:i}=e[0],s=n=new nm("string"==typeof r?um(r):r,i,t.ease);if(e.length>2||2===e.length&&e[1].value!==r)for(let t=1;t<e.length;++t){const{value:r,time:i}=e[t];n.next=new nm("string"==typeof r?um(r):r,i),n=n.next}return s.isStepped=!!t.isStepped,s}const e=new nm("string"==typeof t.start?um(t.start):t.start,0);return t.end!==t.start&&(e.next=new nm("string"==typeof t.end?um(t.end):t.end,1)),e}}let rm=Yr.from;const im=Math.PI/180;function sm(t,e){if(!t)return;const n=Math.sin(t),r=Math.cos(t),i=e.x*r-e.y*n,s=e.x*n+e.y*r;e.x=i,e.y=s}function am(t,e,n){return t<<16|e<<8|n}function om(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function lm(t){const e=1/om(t);t.x*=e,t.y*=e}function hm(t,e){t.x*=e,t.y*=e}function um(t,e){let n;return e||(e={}),"#"===t.charAt(0)?t=t.substr(1):0===t.indexOf("0x")&&(t=t.substr(2)),8===t.length&&(n=t.substr(0,2),t=t.substr(2)),e.r=parseInt(t.substr(0,2),16),e.g=parseInt(t.substr(2,2),16),e.b=parseInt(t.substr(4,2),16),n&&(e.a=parseInt(n,16)),e}function cm(t){const e=t.length,n=1/e;return function(r){const i=e*r|0,s=(r-i*n)*e,a=t[i]||t[e-1];return a.s+s*(2*(1-s)*(a.cp-a.s)+s*(a.e-a.s))}}function dm(t){return t?(t=t.toUpperCase().replace(/ /g,"_"),se[t]||se.NORMAL):se.NORMAL}var pm;class fm extends Qo{constructor(t){super(),this.prevChild=this.nextChild=null,this.emitter=t,this.config={},this.anchor.x=this.anchor.y=.5,this.maxLife=0,this.age=0,this.agePercent=0,this.oneOverLife=0,this.next=null,this.prev=null,this.init=this.init,this.kill=this.kill}init(t){this.maxLife=t,this.age=this.agePercent=0,this.rotation=0,this.position.x=this.position.y=0,this.scale.x=this.scale.y=1,this.tint=16777215,this.alpha=1,this.oneOverLife=1/this.maxLife,this.visible=!0}kill(){this.emitter.recycle(this)}destroy(){this.parent&&this.parent.removeChild(this),this.emitter=this.next=this.prev=null,super.destroy()}}!function(t){t[t.Spawn=0]="Spawn",t[t.Normal=2]="Normal",t[t.Late=5]="Late"}(pm||(pm={}));const mm=dr.shared,gm=Symbol("Position particle per emitter position");class ym{constructor(t,e){this.initBehaviors=[],this.updateBehaviors=[],this.recycleBehaviors=[],this.minLifetime=0,this.maxLifetime=0,this.customEase=null,this._frequency=1,this.spawnChance=1,this.maxParticles=1e3,this.emitterLifetime=-1,this.spawnPos=new En,this.particlesPerWave=1,this.rotation=0,this.ownerPos=new En,this._prevEmitterPos=new En,this._prevPosIsValid=!1,this._posChanged=!1,this._parent=null,this.addAtBack=!1,this.particleCount=0,this._emit=!1,this._spawnTimer=0,this._emitterLife=-1,this._activeParticlesFirst=null,this._activeParticlesLast=null,this._poolFirst=null,this._origConfig=null,this._autoUpdate=!1,this._destroyWhenComplete=!1,this._completeCallback=null,this.parent=t,e&&this.init(e),this.recycle=this.recycle,this.update=this.update,this.rotate=this.rotate,this.updateSpawnPos=this.updateSpawnPos,this.updateOwnerPos=this.updateOwnerPos}static registerBehavior(t){ym.knownBehaviors[t.type]=t}get frequency(){return this._frequency}set frequency(t){this._frequency="number"==typeof t&&t>0?t:1}get parent(){return this._parent}set parent(t){this.cleanup(),this._parent=t}init(t){if(!t)return;this.cleanup(),this._origConfig=t,this.minLifetime=t.lifetime.min,this.maxLifetime=t.lifetime.max,t.ease?this.customEase="function"==typeof t.ease?t.ease:cm(t.ease):this.customEase=null,this.particlesPerWave=1,t.particlesPerWave&&t.particlesPerWave>1&&(this.particlesPerWave=t.particlesPerWave),this.frequency=t.frequency,this.spawnChance="number"==typeof t.spawnChance&&t.spawnChance>0?t.spawnChance:1,this.emitterLifetime=t.emitterLifetime||-1,this.maxParticles=t.maxParticles>0?t.maxParticles:1e3,this.addAtBack=!!t.addAtBack,this.rotation=0,this.ownerPos.set(0),t.pos?this.spawnPos.copyFrom(t.pos):this.spawnPos.set(0),this._prevEmitterPos.copyFrom(this.spawnPos),this._prevPosIsValid=!1,this._spawnTimer=0,this.emit=void 0===t.emit||!!t.emit,this.autoUpdate=!!t.autoUpdate;const e=t.behaviors.map((t=>{const e=ym.knownBehaviors[t.type];return e?new e(t.config):null})).filter((t=>!!t));e.push(gm),e.sort(((t,e)=>t===gm?e.order===pm.Spawn?1:-1:e===gm?t.order===pm.Spawn?-1:1:t.order-e.order)),this.initBehaviors=e.slice(),this.updateBehaviors=e.filter((t=>t!==gm&&t.updateParticle)),this.recycleBehaviors=e.filter((t=>t!==gm&&t.recycleParticle))}getBehavior(t){return ym.knownBehaviors[t]&&this.initBehaviors.find((e=>e instanceof ym.knownBehaviors[t]))||null}fillPool(t){for(;t>0;--t){const t=new fm(this);t.next=this._poolFirst,this._poolFirst=t}}recycle(t,e=!1){for(let n=0;n<this.recycleBehaviors.length;++n)this.recycleBehaviors[n].recycleParticle(t,!e);t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next),t===this._activeParticlesLast&&(this._activeParticlesLast=t.prev),t===this._activeParticlesFirst&&(this._activeParticlesFirst=t.next),t.prev=null,t.next=this._poolFirst,this._poolFirst=t,t.parent&&t.parent.removeChild(t),--this.particleCount}rotate(t){if(this.rotation===t)return;const e=t-this.rotation;this.rotation=t,sm(e,this.spawnPos),this._posChanged=!0}updateSpawnPos(t,e){this._posChanged=!0,this.spawnPos.x=t,this.spawnPos.y=e}updateOwnerPos(t,e){this._posChanged=!0,this.ownerPos.x=t,this.ownerPos.y=e}resetPositionTracking(){this._prevPosIsValid=!1}get emit(){return this._emit}set emit(t){this._emit=!!t,this._emitterLife=this.emitterLifetime}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){this._autoUpdate&&!t?mm.remove(this.update,this):!this._autoUpdate&&t&&mm.add(this.update,this),this._autoUpdate=!!t}playOnceAndDestroy(t){this.autoUpdate=!0,this.emit=!0,this._destroyWhenComplete=!0,this._completeCallback=t}playOnce(t){this.emit=!0,this._completeCallback=t}update(t){if(this._autoUpdate&&(t=.001*mm.elapsedMS),!this._parent)return;for(let e,n=this._activeParticlesFirst;n;n=e)if(e=n.next,n.age+=t,n.age>n.maxLife||n.age<0)this.recycle(n);else{let e=n.age*n.oneOverLife;this.customEase&&(e=4===this.customEase.length?this.customEase(e,0,1,1):this.customEase(e)),n.agePercent=e;for(let e=0;e<this.updateBehaviors.length;++e)if(this.updateBehaviors[e].updateParticle(n,t)){this.recycle(n);break}}let e,n;this._prevPosIsValid&&(e=this._prevEmitterPos.x,n=this._prevEmitterPos.y);const r=this.ownerPos.x+this.spawnPos.x,i=this.ownerPos.y+this.spawnPos.y;if(this._emit)for(this._spawnTimer-=t<0?0:t;this._spawnTimer<=0;){if(this._emitterLife>=0&&(this._emitterLife-=this._frequency,this._emitterLife<=0)){this._spawnTimer=0,this._emitterLife=0,this.emit=!1;break}if(this.particleCount>=this.maxParticles){this._spawnTimer+=this._frequency;continue}let s,a;if(this._prevPosIsValid&&this._posChanged){const o=1+this._spawnTimer/t;s=(r-e)*o+e,a=(i-n)*o+n}else s=r,a=i;let o=null,l=null;for(let t=Math.min(this.particlesPerWave,this.maxParticles-this.particleCount),e=0;e<t;++e){if(this.spawnChance<1&&Math.random()>=this.spawnChance)continue;let t,e;(t=this.minLifetime===this.maxLifetime?this.minLifetime:Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime,-this._spawnTimer>=t)||(this._poolFirst?(e=this._poolFirst,this._poolFirst=this._poolFirst.next,e.next=null):e=new fm(this),e.init(t),this.addAtBack?this._parent.addChildAt(e,0):this._parent.addChild(e),o?(l.next=e,e.prev=l,l=e):l=o=e,++this.particleCount)}if(o){this._activeParticlesLast?(this._activeParticlesLast.next=o,o.prev=this._activeParticlesLast,this._activeParticlesLast=l):(this._activeParticlesFirst=o,this._activeParticlesLast=l);for(let t=0;t<this.initBehaviors.length;++t){const e=this.initBehaviors[t];if(e===gm)for(let t,e=o;e;e=t){t=e.next,0!==this.rotation&&(sm(this.rotation,e.position),e.rotation+=this.rotation),e.position.x+=s,e.position.y+=a,e.age+=-this._spawnTimer;let n=e.age*e.oneOverLife;this.customEase&&(n=4===this.customEase.length?this.customEase(n,0,1,1):this.customEase(n)),e.agePercent=n}else e.initParticles(o)}for(let t,e=o;e;e=t){t=e.next;for(let t=0;t<this.updateBehaviors.length;++t)if(this.updateBehaviors[t].updateParticle(e,-this._spawnTimer)){this.recycle(e);break}}}this._spawnTimer+=this._frequency}if(this._posChanged&&(this._prevEmitterPos.x=r,this._prevEmitterPos.y=i,this._prevPosIsValid=!0,this._posChanged=!1),!this._emit&&!this._activeParticlesFirst){if(this._completeCallback){const t=this._completeCallback;this._completeCallback=null,t()}this._destroyWhenComplete&&this.destroy()}}emitNow(){const t=this.ownerPos.x+this.spawnPos.x,e=this.ownerPos.y+this.spawnPos.y;let n=null,r=null;for(let t=Math.min(this.particlesPerWave,this.maxParticles-this.particleCount),e=0;e<t;++e){if(this.spawnChance<1&&Math.random()>=this.spawnChance)continue;let t,e;this._poolFirst?(t=this._poolFirst,this._poolFirst=this._poolFirst.next,t.next=null):t=new fm(this),e=this.minLifetime===this.maxLifetime?this.minLifetime:Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime,t.init(e),this.addAtBack?this._parent.addChildAt(t,0):this._parent.addChild(t),n?(r.next=t,t.prev=r,r=t):r=n=t,++this.particleCount}if(n){this._activeParticlesLast?(this._activeParticlesLast.next=n,n.prev=this._activeParticlesLast,this._activeParticlesLast=r):(this._activeParticlesFirst=n,this._activeParticlesLast=r);for(let r=0;r<this.initBehaviors.length;++r){const i=this.initBehaviors[r];if(i===gm)for(let r,i=n;i;i=r)r=i.next,0!==this.rotation&&(sm(this.rotation,i.position),i.rotation+=this.rotation),i.position.x+=t,i.position.y+=e;else i.initParticles(n)}}}cleanup(){let t,e;for(t=this._activeParticlesFirst;t;t=e)e=t.next,this.recycle(t,!0);this._activeParticlesFirst=this._activeParticlesLast=null,this.particleCount=0}get destroyed(){return!(this._parent&&this.initBehaviors.length)}destroy(){let t;this.autoUpdate=!1,this.cleanup();for(let e=this._poolFirst;e;e=t)t=e.next,e.destroy();this._poolFirst=this._parent=this.spawnPos=this.ownerPos=this.customEase=this._completeCallback=null,this.initBehaviors.length=this.updateBehaviors.length=this.recycleBehaviors.length=0}}ym.knownBehaviors={};class vm{constructor(t){this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h}getRandPos(t){t.x=Math.random()*this.w+this.x,t.y=Math.random()*this.h+this.y}}vm.type="rect",vm.editorConfig=null;class xm{constructor(t){this.x=t.x||0,this.y=t.y||0,this.radius=t.radius,this.innerRadius=t.innerRadius||0,this.rotation=!!t.affectRotation}getRandPos(t){this.innerRadius!==this.radius?t.x=Math.random()*(this.radius-this.innerRadius)+this.innerRadius:t.x=this.radius,t.y=0;const e=Math.random()*Math.PI*2;this.rotation&&(t.rotation+=e),sm(e,t.position),t.position.x+=this.x,t.position.y+=this.y}}xm.type="torus",xm.editorConfig=null;class bm{constructor(t){this.segments=[],this.countingLengths=[],this.totalLength=0,this.init(t)}init(t){if(t&&t.length)if(Array.isArray(t[0]))for(let e=0;e<t.length;++e){const n=t[e];let r=n[0];for(let t=1;t<n.length;++t){const e=n[t];this.segments.push({p1:r,p2:e,l:0}),r=e}}else{let e=t[0];for(let n=1;n<t.length;++n){const r=t[n];this.segments.push({p1:e,p2:r,l:0}),e=r}}else this.segments.push({p1:{x:0,y:0},p2:{x:0,y:0},l:0});for(let t=0;t<this.segments.length;++t){const{p1:e,p2:n}=this.segments[t],r=Math.sqrt((n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y));this.segments[t].l=r,this.totalLength+=r,this.countingLengths.push(this.totalLength)}}getRandPos(t){const e=Math.random()*this.totalLength;let n,r;if(1===this.segments.length)n=this.segments[0],r=e;else for(let t=0;t<this.countingLengths.length;++t)if(e<this.countingLengths[t]){n=this.segments[t],r=0===t?e:e-this.countingLengths[t-1];break}r/=n.l||1;const{p1:i,p2:s}=n;t.x=i.x+r*(s.x-i.x),t.y=i.y+r*(s.y-i.y)}}bm.type="polygonalChain",bm.editorConfig=null;class wm{constructor(t){var e;this.order=pm.Late,this.minStart=t.minStart,this.maxStart=t.maxStart,this.accel=t.accel,this.rotate=!!t.rotate,this.maxSpeed=null!==(e=t.maxSpeed)&&void 0!==e?e:0}initParticles(t){let e=t;for(;e;){const t=Math.random()*(this.maxStart-this.minStart)+this.minStart;e.config.velocity?e.config.velocity.set(t,0):e.config.velocity=new En(t,0),sm(e.rotation,e.config.velocity),e=e.next}}updateParticle(t,e){const n=t.config.velocity,r=n.x,i=n.y;if(n.x+=this.accel.x*e,n.y+=this.accel.y*e,this.maxSpeed){const t=om(n);t>this.maxSpeed&&hm(n,this.maxSpeed/t)}t.x+=(r+n.x)/2*e,t.y+=(i+n.y)/2*e,this.rotate&&(t.rotation=Math.atan2(n.y,n.x))}}function _m(t){return this.ease&&(t=this.ease(t)),(this.first.next.value-this.first.value)*t+this.first.value}function Tm(t){this.ease&&(t=this.ease(t));const e=this.first.value,n=this.first.next.value;return am((n.r-e.r)*t+e.r,(n.g-e.g)*t+e.g,(n.b-e.b)*t+e.b)}function Em(t){this.ease&&(t=this.ease(t));let e=this.first,n=e.next;for(;t>n.time;)e=n,n=n.next;return t=(t-e.time)/(n.time-e.time),(n.value-e.value)*t+e.value}function Sm(t){this.ease&&(t=this.ease(t));let e=this.first,n=e.next;for(;t>n.time;)e=n,n=n.next;t=(t-e.time)/(n.time-e.time);const r=e.value,i=n.value;return am((i.r-r.r)*t+r.r,(i.g-r.g)*t+r.g,(i.b-r.b)*t+r.b)}function Im(t){this.ease&&(t=this.ease(t));let e=this.first;for(;e.next&&t>e.next.time;)e=e.next;return e.value}function km(t){this.ease&&(t=this.ease(t));let e=this.first;for(;e.next&&t>e.next.time;)e=e.next;const n=e.value;return am(n.r,n.g,n.b)}wm.type="moveAcceleration",wm.editorConfig=null;class Cm{constructor(t=!1){this.first=null,this.isColor=!!t,this.interpolate=null,this.ease=null}reset(t){this.first=t;t.next&&t.next.time>=1?this.interpolate=this.isColor?Tm:_m:t.isStepped?this.interpolate=this.isColor?km:Im:this.interpolate=this.isColor?Sm:Em,this.ease=this.first.ease}}class Nm{constructor(t){this.order=pm.Normal,this.list=new Cm(!1),this.list.reset(nm.createList(t.alpha))}initParticles(t){let e=t;for(;e;)e.alpha=this.list.first.value,e=e.next}updateParticle(t){t.alpha=this.list.interpolate(t.agePercent)}}Nm.type="alpha",Nm.editorConfig=null;class Am{constructor(t){this.order=pm.Normal,this.value=t.alpha}initParticles(t){let e=t;for(;e;)e.alpha=this.value,e=e.next}}function Rm(t){const e=[];for(let n=0;n<t.length;++n){let r=t[n];if("string"==typeof r)e.push(rm(r));else if(r instanceof Yr)e.push(r);else{let t=r.count||1;for(r="string"==typeof r.texture?rm(r.texture):r.texture;t>0;--t)e.push(r)}}return e}Am.type="alphaStatic",Am.editorConfig=null;class Mm{constructor(t){this.order=pm.Normal,this.anims=[];for(let e=0;e<t.anims.length;++e){const n=t.anims[e],r=Rm(n.textures),i=n.framerate<0?-1:n.framerate>0?n.framerate:60,s={textures:r,duration:i>0?r.length/i:0,framerate:i,loop:i>0&&!!n.loop};this.anims.push(s)}}initParticles(t){let e=t;for(;e;){const t=Math.floor(Math.random()*this.anims.length),n=e.config.anim=this.anims[t];e.texture=n.textures[0],e.config.animElapsed=0,-1===n.framerate?(e.config.animDuration=e.maxLife,e.config.animFramerate=n.textures.length/e.maxLife):(e.config.animDuration=n.duration,e.config.animFramerate=n.framerate),e=e.next}}updateParticle(t,e){const n=t.config,r=n.anim;n.animElapsed+=e,n.animElapsed>=n.animDuration&&(n.anim.loop?n.animElapsed=n.animElapsed%n.animDuration:n.animElapsed=n.animDuration-1e-6);const i=n.animElapsed*n.animFramerate+1e-7|0;t.texture=r.textures[i]||r.textures[r.textures.length-1]||Yr.EMPTY}}Mm.type="animatedRandom",Mm.editorConfig=null;class Om{constructor(t){this.order=pm.Normal;const e=t.anim,n=Rm(e.textures),r=e.framerate<0?-1:e.framerate>0?e.framerate:60;this.anim={textures:n,duration:r>0?n.length/r:0,framerate:r,loop:r>0&&!!e.loop}}initParticles(t){let e=t;const n=this.anim;for(;e;)e.texture=n.textures[0],e.config.animElapsed=0,-1===n.framerate?(e.config.animDuration=e.maxLife,e.config.animFramerate=n.textures.length/e.maxLife):(e.config.animDuration=n.duration,e.config.animFramerate=n.framerate),e=e.next}updateParticle(t,e){const n=this.anim,r=t.config;r.animElapsed+=e,r.animElapsed>=r.animDuration&&(n.loop?r.animElapsed=r.animElapsed%r.animDuration:r.animElapsed=r.animDuration-1e-6);const i=r.animElapsed*r.animFramerate+1e-7|0;t.texture=n.textures[i]||n.textures[n.textures.length-1]||Yr.EMPTY}}Om.type="animatedSingle",Om.editorConfig=null;class Pm{constructor(t){this.order=pm.Normal,this.value=t.blendMode}initParticles(t){let e=t;for(;e;)e.blendMode=dm(this.value),e=e.next}}Pm.type="blendMode",Pm.editorConfig=null;class Dm{constructor(t){this.order=pm.Spawn,this.spacing=t.spacing*im,this.start=t.start*im,this.distance=t.distance}initParticles(t){let e=0,n=t;for(;n;){let t;t=this.spacing?this.start+this.spacing*e:Math.random()*Math.PI*2,n.rotation=t,this.distance&&(n.position.x=this.distance,sm(t,n.position)),n=n.next,++e}}}Dm.type="spawnBurst",Dm.editorConfig=null;class Fm{constructor(t){this.order=pm.Normal,this.list=new Cm(!0),this.list.reset(nm.createList(t.color))}initParticles(t){let e=t;const n=this.list.first.value,r=am(n.r,n.g,n.b);for(;e;)e.tint=r,e=e.next}updateParticle(t){t.tint=this.list.interpolate(t.agePercent)}}Fm.type="color",Fm.editorConfig=null;class Lm{constructor(t){this.order=pm.Normal;let e=t.color;"#"===e.charAt(0)?e=e.substr(1):0===e.indexOf("0x")&&(e=e.substr(2)),this.value=parseInt(e,16)}initParticles(t){let e=t;for(;e;)e.tint=this.value,e=e.next}}Lm.type="colorStatic",Lm.editorConfig=null;class Bm{constructor(t){this.order=pm.Normal,this.index=0,this.textures=t.textures.map((t=>"string"==typeof t?rm(t):t))}initParticles(t){let e=t;for(;e;)e.texture=this.textures[this.index],++this.index>=this.textures.length&&(this.index=0),e=e.next}}Bm.type="textureOrdered",Bm.editorConfig=null;const $m=new En,Um=["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2","abs","acos","acosh","asin","asinh","atan","atanh","atan2","cbrt","ceil","cos","cosh","exp","expm1","floor","fround","hypot","log","log1p","log10","log2","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh"],Vm=new RegExp(["[01234567890\\.\\*\\-\\+\\/\\(\\)x ,]"].concat(Um).join("|"),"g");class zm{constructor(t){var e;if(this.order=pm.Late,t.path)if("function"==typeof t.path)this.path=t.path;else try{this.path=function(t){const e=t.match(Vm);for(let t=e.length-1;t>=0;--t)Um.indexOf(e[t])>=0&&(e[t]=`Math.${e[t]}`);return t=e.join(""),new Function("x",`return ${t};`)}(t.path)}catch(t){this.path=null}else this.path=t=>t;this.list=new Cm(!1),this.list.reset(nm.createList(t.speed)),this.minMult=null!==(e=t.minMult)&&void 0!==e?e:1}initParticles(t){let e=t;for(;e;){e.config.initRotation=e.rotation,e.config.initPosition?e.config.initPosition.copyFrom(e.position):e.config.initPosition=new En(e.x,e.y),e.config.movement=0;const t=Math.random()*(1-this.minMult)+this.minMult;e.config.speedMult=t,e=e.next}}updateParticle(t,e){const n=this.list.interpolate(t.agePercent)*t.config.speedMult;t.config.movement+=n*e,$m.x=t.config.movement,$m.y=this.path($m.x),sm(t.config.initRotation,$m),t.position.x=t.config.initPosition.x+$m.x,t.position.y=t.config.initPosition.y+$m.y}}zm.type="movePath",zm.editorConfig=null;class Gm{constructor(){this.order=pm.Spawn}initParticles(t){}}Gm.type="spawnPoint",Gm.editorConfig=null;class Wm{constructor(t){this.order=pm.Normal,this.textures=t.textures.map((t=>"string"==typeof t?rm(t):t))}initParticles(t){let e=t;for(;e;){const t=Math.floor(Math.random()*this.textures.length);e.texture=this.textures[t],e=e.next}}}Wm.type="textureRandom",Wm.editorConfig=null;class Xm{constructor(t){this.order=pm.Normal,this.minStart=t.minStart*im,this.maxStart=t.maxStart*im,this.minSpeed=t.minSpeed*im,this.maxSpeed=t.maxSpeed*im,this.accel=t.accel*im}initParticles(t){let e=t;for(;e;)this.minStart===this.maxStart?e.rotation+=this.maxStart:e.rotation+=Math.random()*(this.maxStart-this.minStart)+this.minStart,e.config.rotSpeed=Math.random()*(this.maxSpeed-this.minSpeed)+this.minSpeed,e=e.next}updateParticle(t,e){if(this.accel){const n=t.config.rotSpeed;t.config.rotSpeed+=this.accel*e,t.rotation+=(t.config.rotSpeed+n)/2*e}else t.rotation+=t.config.rotSpeed*e}}Xm.type="rotation",Xm.editorConfig=null;class Hm{constructor(t){this.order=pm.Normal,this.min=t.min*im,this.max=t.max*im}initParticles(t){let e=t;for(;e;)this.min===this.max?e.rotation+=this.max:e.rotation+=Math.random()*(this.max-this.min)+this.min,e=e.next}}Hm.type="rotationStatic",Hm.editorConfig=null;class Ym{constructor(t){this.order=pm.Late+1,this.rotation=(t.rotation||0)*im}initParticles(t){let e=t;for(;e;)e.rotation=this.rotation,e=e.next}}Ym.type="noRotation",Ym.editorConfig=null;class jm{constructor(t){var e;this.order=pm.Normal,this.list=new Cm(!1),this.list.reset(nm.createList(t.scale)),this.minMult=null!==(e=t.minMult)&&void 0!==e?e:1}initParticles(t){let e=t;for(;e;){const t=Math.random()*(1-this.minMult)+this.minMult;e.config.scaleMult=t,e.scale.x=e.scale.y=this.list.first.value*t,e=e.next}}updateParticle(t){t.scale.x=t.scale.y=this.list.interpolate(t.agePercent)*t.config.scaleMult}}jm.type="scale",jm.editorConfig=null;class qm{constructor(t){this.order=pm.Normal,this.min=t.min,this.max=t.max}initParticles(t){let e=t;for(;e;){const t=Math.random()*(this.max-this.min)+this.min;e.scale.x=e.scale.y=t,e=e.next}}}qm.type="scaleStatic",qm.editorConfig=null;class Km{constructor(t){this.order=pm.Spawn;const e=Km.shapes[t.type];if(!e)throw new Error(`No shape found with type '${t.type}'`);this.shape=new e(t.data)}static registerShape(t,e){Km.shapes[e||t.type]=t}initParticles(t){let e=t;for(;e;)this.shape.getRandPos(e),e=e.next}}Km.type="spawnShape",Km.editorConfig=null,Km.shapes={},Km.registerShape(bm),Km.registerShape(vm),Km.registerShape(xm),Km.registerShape(xm,"circle");class Zm{constructor(t){this.order=pm.Normal,this.texture="string"==typeof t.texture?rm(t.texture):t.texture}initParticles(t){let e=t;for(;e;)e.texture=this.texture,e=e.next}}Zm.type="textureSingle",Zm.editorConfig=null;class Jm{constructor(t){var e;this.order=pm.Late,this.list=new Cm(!1),this.list.reset(nm.createList(t.speed)),this.minMult=null!==(e=t.minMult)&&void 0!==e?e:1}initParticles(t){let e=t;for(;e;){const t=Math.random()*(1-this.minMult)+this.minMult;e.config.speedMult=t,e.config.velocity?e.config.velocity.set(this.list.first.value*t,0):e.config.velocity=new En(this.list.first.value*t,0),sm(e.rotation,e.config.velocity),e=e.next}}updateParticle(t,e){const n=this.list.interpolate(t.agePercent)*t.config.speedMult,r=t.config.velocity;lm(r),hm(r,n),t.x+=r.x*e,t.y+=r.y*e}}Jm.type="moveSpeed",Jm.editorConfig=null;class Qm{constructor(t){this.order=pm.Late,this.min=t.min,this.max=t.max}initParticles(t){let e=t;for(;e;){const t=Math.random()*(this.max-this.min)+this.min;e.config.velocity?e.config.velocity.set(t,0):e.config.velocity=new En(t,0),sm(e.rotation,e.config.velocity),e=e.next}}updateParticle(t,e){const n=t.config.velocity;t.x+=n.x*e,t.y+=n.y*e}}Qm.type="moveSpeedStatic",Qm.editorConfig=null;ym.registerBehavior(wm),ym.registerBehavior(Nm),ym.registerBehavior(Am),ym.registerBehavior(Mm),ym.registerBehavior(Om),ym.registerBehavior(Pm),ym.registerBehavior(Dm),ym.registerBehavior(Fm),ym.registerBehavior(Lm),ym.registerBehavior(Bm),ym.registerBehavior(zm),ym.registerBehavior(Gm),ym.registerBehavior(Wm),ym.registerBehavior(Xm),ym.registerBehavior(Hm),ym.registerBehavior(Ym),ym.registerBehavior(jm),ym.registerBehavior(qm),ym.registerBehavior(Km),ym.registerBehavior(Zm),ym.registerBehavior(Jm),ym.registerBehavior(Qm);class tg extends or{constructor(){super();let t=new or;var e={lifetime:{min:4,max:10},ease:[{s:0,cp:.379,e:.548},{s:.548,cp:.717,e:.676},{s:.676,cp:.635,e:1}],frequency:.01,emitterLifetime:0,maxParticles:60,addAtBack:!1,pos:{x:0,y:0},behaviors:[{type:"alpha",config:{alpha:{list:[{time:0,value:1},{time:3,value:.8},{time:3.05,value:0}]}}},{type:"moveSpeedStatic",config:{min:50,max:150}},{type:"scale",config:{scale:{list:[{time:0,value:1},{time:3,value:.3},{time:3.005,value:.01}]},minMult:1}},{type:"rotation",config:{accel:0,minSpeed:0,maxSpeed:100,minStart:180,maxStart:100}},{type:"textureRandom",config:{textures:["images/wu.png","images/hua.png"]}},{type:"spawnShape",config:{type:"rect",data:{x:h8.width/2,y:-500,w:900,h:500}}},{type:"color",config:{color:{list:[{time:0,value:"FFFFFF"},{time:1,value:"FFFFFF"},{time:2,value:"FFFFFF"}]}}}]};this.addChild(t),this.emitter=new ym(t,e),this.elapsed=Date.now(),this.emitter.emit=!0}update(){var t=Date.now();this.emitter.update(.001*(t-this.elapsed)),this.elapsed=t}}class eg{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class ng{refCount(t){return rg("refCount")}incRef(t){return rg("incRef")}timerAvailable(){return!0}time(t){return rg("time")}read(t){return rg("read")}readSync(t){return rg("readSync")}readToGPU(t,e){return rg("readToGPU")}numDataIds(){return rg("numDataIds")}disposeData(t,e){return rg("disposeData")}write(t,e,n){return rg("write")}move(t,e,n,r,i){return rg("move")}createTensorFromGPUData(t,e,n){return rg("createTensorFromGPUData")}memory(){return rg("memory")}floatPrecision(){return rg("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return rg("dispose")}}function rg(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function ig(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,lg(t,e,n)}function sg(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let n=t.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,lg(t,n,r),lg(e,n,r)}function ag(t,e,n){return Math.max(t,Math.min(e,n))}function og(t){return t%2==0?t:t+1}function lg(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function hg(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function ug(t,e){const n=Math.random();return e*n+(1-n)*t}function cg(t,e){let n=0;for(let r=0;r<t.length;r++){const i=Number(t[r])-Number(e[r]);n+=i*i}return n}function dg(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function pg(t,e,n=""){dg(vg(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function fg(t){dg(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function mg(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function gg(t){return 0===t.length}function yg(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(null!==t[n]&&null!==e[n]&&t[n]!==e[n])return!1;return!0}function vg(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function xg(t){return t%1==0}function bg(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}}function wg(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function _g(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return ig(e),e}function Tg(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function Eg(t,e=(t=>0),n,r){return new Promise(((i,s)=>{let a=0;const o=()=>{if(t())return void i();a++;const l=e(a);null!=n&&a>=n?s():null!=r?r(o,l):setTimeout(o,l)};o()}))}function Sg(t,e){let n=1,r=-1;for(let e=0;e<t.length;++e)if(t[e]>=0)n*=t[e];else if(-1===t[e]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${e}`);r=e}else if(t[e]<0)throw Error(`Shapes can not be < 0. Found ${t[e]} at dim ${e}`);if(-1===r){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(0===n)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const i=t.slice();return i[r]=e/n,i}function Ig(t,e){const n=e.length;return t=null==t?e.map(((t,e)=>e)):[].concat(t),dg(t.every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),dg(t.every((t=>xg(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function kg(t,e){const n=[],r=[],i=null!=e&&Array.isArray(e)&&0===e.length,s=null==e||i?null:Ig(e,t).sort();let a=0;for(let e=0;e<t.length;++e){if(null!=s){if(s[a]===e&&1!==t[e])throw new Error(`Can't squeeze axis ${e} since its dim '${t[e]}' is not 1`);(null==s[a]||s[a]>e)&&1===t[e]&&(n.push(t[e]),r.push(e)),s[a]<=e&&a++}1!==t[e]&&(n.push(t[e]),r.push(e))}return{newShape:n,keptDims:r}}function Cg(t,e){return Ng(t,e)}function Ng(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}function Ag(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function Rg(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function Mg(t,e){return"complex64"!==e&&(("float32"!==e||"complex64"===t)&&(("int32"!==e||"float32"===t||"complex64"===t)&&("bool"!==e||"bool"!==t)))}function Og(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function Pg(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}function Dg(t){return"string"==typeof t||t instanceof String}function Fg(t){return"boolean"==typeof t}function Lg(t){return"number"==typeof t}function Bg(t){return Array.isArray(t)?Bg(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":Lg(t)?"float32":Dg(t)?"string":Fg(t)?"bool":"float32"}function $g(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Ug(t,e){for(let n=e;n<t;++n)if(t%n==0)return n;return t}function Vg(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function zg(t,e,n,r=!1){const i=new Array;if(1===e.length){const s=e[0]*(r?2:1);for(let e=0;e<s;e++)i[e]=n[t+e]}else{const s=e[0],a=e.slice(1),o=a.reduce(((t,e)=>t*e))*(r?2:1);for(let e=0;e<s;e++)i[e]=zg(t+e*o,a,n,r)}return i}function Gg(t,e,n=!1){if(0===t.length)return e[0];const r=t.reduce(((t,e)=>t*e))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return zg(0,t,e,n)}function Wg(t,e){if(Array.isArray(t))return t;if("float32"===e)return t instanceof Float32Array?t:new Float32Array(t);if("int32"===e)return t instanceof Int32Array?t:new Int32Array(t);if("bool"===e||"string"===e)return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function Xg(t,e){const n=Hg(t,e);for(let t=0;t<n.length;t++)n[t]=1;return n}function Hg(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function Yg(t,e){const n=t.reduce(((t,e)=>t*e),1);if(null==e||"float32"===e)return Gg(t,new Float32Array(n));if("int32"===e)return Gg(t,new Int32Array(n));if("bool"===e)return Gg(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function jg(t){t.forEach((e=>{dg(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function qg(t,e,n){if(0===e)return 0;if(1===e)return t[0];let r=t[t.length-1];for(let e=0;e<t.length-1;++e)r+=n[e]*t[e];return r}function Kg(t,e,n){if(0===e)return[];if(1===e)return[t];const r=new Array(e);for(let e=0;e<r.length-1;++e)r[e]=Math.floor(t/n[e]),t-=r[e]*n[e];return r[r.length-1]=t,r}function Zg(t){return t&&t.then&&"function"==typeof t.then}const Jg="tfjsflags";class Qg{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=ty,this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&!ey().getBool("IS_TEST")&&ey().getBool("PROD"),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];!ey().getBool("IS_TEST")&&ey().getBool("PROD"),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(Zg(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getString(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=this.getQueryParams(this.global.location.search);if(Jg in t){t.tfjsflags.split(",").forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){const n=e.toLowerCase();return"true"===n||"false"===n?"true"===n:""+ +n===n?+n:e}(0,n)}))}}}function ty(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")))),e}function ey(){return ry}let ny,ry=null;function iy(){if(null==ny){let t;if("undefined"!=typeof window)t=window;else if(void 0!==n.g)t=n.g;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}ny=t}return ny}function sy(t,e){const n=function(){const t=iy();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}const ay="Abs",oy="Acos",ly="Acosh",hy="Add",uy="AddN",cy="All",dy="Any",py="ArgMax",fy="ArgMin",my="Asin",gy="Asinh",yy="Atan",vy="Atanh",xy="Atan2",by="AvgPool",wy="AvgPoolGrad",_y="AvgPool3D",Ty="AvgPool3DGrad",Ey="BatchMatMul",Sy="BatchToSpaceND",Iy="Bincount",ky="BitwiseAnd",Cy="BroadcastTo",Ny="BroadcastArgs",Ay="Cast",Ry="Ceil",My="ClipByValue",Oy="Complex",Py="ComplexAbs",Dy="Concat",Fy="Conv2D",Ly="Conv2DBackpropFilter",By="Conv2DBackpropInput",$y="Conv3D",Uy="Conv3DBackpropFilterV2",Vy="Conv3DBackpropInputV2",zy="Cos",Gy="Cosh",Wy="Cumprod",Xy="Cumsum",Hy="CropAndResize",Yy="DenseBincount",jy="DepthToSpace",qy="DepthwiseConv2dNative",Ky="DepthwiseConv2dNativeBackpropFilter",Zy="DepthwiseConv2dNativeBackpropInput",Jy="Diag",Qy="Dilation2D",tv="Dilation2DBackpropInput",ev="Dilation2DBackpropFilter",nv="Draw",rv="RealDiv",iv="Einsum",sv="Elu",av="EluGrad",ov="Erf",lv="Equal",hv="Exp",uv="ExpandDims",cv="Expm1",dv="FFT",pv="Fill",fv="FlipLeftRight",mv="Floor",gv="FloorDiv",yv="FusedBatchNorm",vv="GatherV2",xv="GatherNd",bv="Greater",wv="GreaterEqual",_v="Identity",Tv="IFFT",Ev="Imag",Sv="IsFinite",Iv="IsInf",kv="IsNan",Cv="LeakyRelu",Nv="Less",Av="LessEqual",Rv="LinSpace",Mv="Log",Ov="Log1p",Pv="LogicalAnd",Dv="LogicalNot",Fv="LogicalOr",Lv="LogicalXor",Bv="LogSoftmax",$v="LowerBound",Uv="LRN",Vv="LRNGrad",zv="MatrixBandPart",Gv="Max",Wv="Maximum",Xv="MaxPool",Hv="MaxPoolGrad",Yv="MaxPool3D",jv="MaxPool3DGrad",qv="MaxPoolWithArgmax",Kv="Mean",Zv="Min",Jv="Minimum",Qv="MirrorPad",tx="Mod",ex="Multinomial",nx="Multiply",rx="Neg",ix="NotEqual",sx="NonMaxSuppressionV3",ax="NonMaxSuppressionV4",ox="NonMaxSuppressionV5",lx="OnesLike",hx="OneHot",ux="Pack",cx="PadV2",dx="Pool",px="Pow",fx="Prelu",mx="Prod",gx="RaggedGather",yx="RaggedRange",vx="RaggedTensorToTensor",xx="Range",bx="Real",wx="Reciprocal",_x="Relu",Tx="Reshape",Ex="ResizeNearestNeighbor",Sx="ResizeNearestNeighborGrad",Ix="ResizeBilinear",kx="ResizeBilinearGrad",Cx="Relu6",Nx="Reverse",Ax="Round",Rx="Rsqrt",Mx="ScatterNd",Ox="TensorScatterUpdate",Px="SearchSorted",Dx="Select",Fx="Selu",Lx="Slice",Bx="Sin",$x="Sinh",Ux="Sign",Vx="Sigmoid",zx="Softplus",Gx="Sqrt",Wx="Sum",Xx="SpaceToBatchND",Hx="SplitV",Yx="Softmax",jx="SparseFillEmptyRows",qx="SparseReshape",Kx="SparseSegmentMean",Zx="SparseSegmentSum",Jx="SparseToDense",Qx="SquaredDifference",tb="Square",eb="StaticRegexReplace",nb="StridedSlice",rb="StringNGrams",ib="StringSplit",sb="StringToHashBucketFast",ab="Sub",ob="Tan",lb="Tanh",hb="Tile",ub="TopK",cb="Transform",db="Transpose",pb="Unique",fb="Unpack",mb="UnsortedSegmentSum",gb="UpperBound",yb="ZerosLike",vb="Step",xb="FromPixels",bb="RotateWithOffset",wb="_FusedMatMul",_b="FusedConv2D",Tb="FusedDepthwiseConv2D";function Eb(...t){!ey().getBool("IS_TEST")&&ey().getBool("PROD")}function Sb(...t){!ey().getBool("IS_TEST")&&ey().getBool("PROD")}const Ib=sy("kernelRegistry",(()=>new Map)),kb=sy("gradRegistry",(()=>new Map));function Cb(t,e){const n=Fb(t,e);return Ib.get(n)}function Nb(t){return kb.get(t)}function Ab(t){const e=Ib.entries(),n=[];for(;;){const{done:r,value:i}=e.next();if(r)break;const[s,a]=i,[o]=s.split("_");o===t&&n.push(a)}return n}function Rb(t){const{kernelName:e,backendName:n}=t,r=Fb(e,n);Ib.has(r)&&Eb(),Ib.set(r,t)}function Mb(t){const{kernelName:e}=t;kb.has(e)&&ey().getBool("DEBUG")&&Eb(),kb.set(e,t)}function Ob(t,e){const n=Fb(t,e);if(!Ib.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);Ib.delete(n)}function Pb(t){if(!kb.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);kb.delete(t)}function Db(t,e){Ab(t).forEach((t=>{Rb(Object.assign({},t,{backendName:e}))}))}function Fb(t,e){return`${e}_${t}`}function Lb(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var Bb=n(720);const $b=n.n(Bb)()||Bb;function Ub(t){return $b.fromString(t,!0,16)}const Vb=Ub("c3a5c85c97cb3127"),zb=Ub("b492b66fbe98f273"),Gb=Ub("9ae16a3b2f90404f");function Wb(t){return t.xor(t.shru(47))}function Xb(t,e,n){const r=t.slice(e,e+n);return $b.fromBytes(Array.from(r),!0,!0)}function Hb(t,e){return Xb(t,e,8)}function Yb(t,e){return Xb(t,e,4)}function jb(t,e){return 0===e?t:t.shru(e).or(t.shl(64-e))}function qb(t,e,n=Ub("9ddfea08eb382d69")){let r=t.xor(e).mul(n);r=r.xor(r.shru(47));let i=e.xor(r).mul(n);return i=i.xor(i.shru(47)),i=i.mul(n),i}function Kb(t,e,n,r){return function(t,e,n,r,i,s){i=i.add(t),s=jb(s.add(i).add(r),21);const a=i;return i=(i=i.add(e)).add(n),s=s.add(jb(i,44)),[i.add(r),s.add(a)]}(Hb(t,e),Hb(t,e+8),Hb(t,e+16),Hb(t,e+24),n,r)}function Zb(t,e=t.length){const n=$b.fromNumber(81,!0);if(e<=32)return e<=16?function(t,e=t.length){if(e>=8){const n=Gb.add(2*e),r=Hb(t,0).add(Gb),i=Hb(t,e-8);return qb(jb(i,37).mul(n).add(r),jb(r,25).add(i).mul(n),n)}if(e>=4){const n=Gb.add(2*e);return qb(Yb(t,0).shl(3).add(e),Yb(t,e-4),n)}if(e>0){const n=t[0]+(t[e>>1]<<8),r=e+(t[e-1]<<2);return Wb(Gb.mul(n).xor(Vb.mul(r))).mul(Gb)}return Gb}(t,e):function(t,e=t.length){const n=Gb.add(2*e),r=Hb(t,0).mul(zb),i=Hb(t,8),s=Hb(t,e-8).mul(n),a=Hb(t,e-16).mul(Gb);return qb(jb(r.add(i),43).add(jb(s,30)).add(a),r.add(jb(i.add(Gb),18)).add(s),n)}(t,e);if(e<=64)return function(t,e=t.length){const n=Gb.add(2*e),r=Hb(t,0).mul(Gb),i=Hb(t,8),s=Hb(t,e-8).mul(n),a=Hb(t,e-16).mul(Gb),o=jb(r.add(i),43).add(jb(s,30)).add(a),l=qb(o,r.add(jb(i.add(Gb),18)).add(s),n),h=Hb(t,16).mul(n),u=Hb(t,24),c=o.add(Hb(t,e-32)).mul(n),d=l.add(Hb(t,e-24)).mul(n);return qb(jb(h.add(u),43).add(jb(c,30)).add(d),h.add(jb(u.add(r),18)).add(c),n)}(t,e);let r=n,i=n.mul(zb).add(113),s=Wb(i.mul(Gb).add(113)).mul(Gb),a=[$b.UZERO,$b.UZERO],o=[$b.UZERO,$b.UZERO];r=r.mul(Gb).add(Hb(t,0));let l=0;const h=64*(e-1>>6),u=h+(e-1&63)-63;do{r=jb(r.add(i).add(a[0]).add(Hb(t,l+8)),37).mul(zb),i=jb(i.add(a[1]).add(Hb(t,l+48)),42).mul(zb),r=r.xor(o[1]),i=i.add(a[0]).add(Hb(t,l+40)),s=jb(s.add(o[0]),33).mul(zb),a=Kb(t,l,a[1].mul(zb),r.add(o[0])),o=Kb(t,l+32,s.add(o[1]),i.add(Hb(t,l+16))),[s,r]=[r,s],l+=64}while(l!==h);const c=zb.add(s.and(255).shl(1));return l=u,o[0]=o[0].add(e-1&63),a[0]=a[0].add(o[0]),o[0]=o[0].add(a[0]),r=jb(r.add(i).add(a[0]).add(Hb(t,l+8)),37).mul(c),i=jb(i.add(a[1]).add(Hb(t,l+48)),42).mul(c),r=r.xor(o[1].mul(9)),i=i.add(a[0].mul(9).add(Hb(t,l+40))),s=jb(s.add(o[0]),33).mul(c),a=Kb(t,l,a[1].mul(c),r.add(o[0])),o=Kb(t,l+32,s.add(o[1]),i.add(Hb(t,l+16))),[s,r]=[r,s],qb(qb(a[0],o[0],c).add(Wb(i).mul(Vb)).add(s),qb(a[1],o[1],c).add(r),c)}function Jb(t,e){return"string"===e?nw(t):Qb([t],e)}function Qb(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=sw(t)),ey().getBool("DEBUG")&&Ag(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function tw(){return ey().platform.now()}function ew(t,e){return ey().platform.fetch(t,e)}function nw(t,e="utf-8"){return e=e||"utf-8",ey().platform.encode(t,e)}function rw(t,e="utf-8"){return e=e||"utf-8",ey().platform.decode(t,e)}function iw(t){return null!=ey().platform.isTypedArray?ey().platform.isTypedArray(t):Lb(t)}function sw(t,e=[],n=!1){if(null==e&&(e=[]),"boolean"==typeof t||"number"==typeof t||"string"==typeof t||Zg(t)||null==t||iw(t)&&n)e.push(t);else if(Array.isArray(t)||iw(t))for(let r=0;r<t.length;++r)sw(t[r],e,n);else{let r=-1;for(const e of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(e)&&(r=Math.max(r,Number(e)));for(let i=0;i<=r;i++)sw(t[i],e,n)}return e}class aw{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new lw)}profileKernel(t,e,n){let r;const i=()=>{r=n()};let s;const a=tw();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(i);else{i();for(const t of r)t.dataSync();s=Promise.resolve({kernelMs:tw()-a})}if(ey().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let e=0;e<r.length;e++){const n=r[e];n.data().then((e=>{ow(e,n.dtype,t)}))}return{kernelName:t,outputs:r,inputs:e,timeMs:s.then((t=>t.kernelMs)),extraInfo:s.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:r,inputs:i,extraInfo:s}=t;n.forEach((t=>{Promise.all([t.data(),r,s]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],i,n[2])}))}))}}function ow(t,e,n){if("float32"!==e)return!1;for(let e=0;e<t.length;e++){const n=t[e];if(isNaN(n)||!isFinite(n))return!0}return!1}class lw{logKernelProfile(t,e,n,r,i,s){"number"==typeof r?Tg(`${r}ms`,9):r.error,Tg(t,25),e.rank,e.size,Tg(e.shape.toString(),14);let a="";for(const t in i){const n=i[t];if(null!=n){const r=n.shape||e.shape,i=r.length;a+=`${t}: ${i}D ${i>0?r:""} `}}}}function hw(t,e,n,r){const i=Vg(e),s=function(t,e,n,r){const i=mg(e),s=r[r.length-1],a=new Array(s).fill(0),o=e.length,l="complex64"===n?pw(t):t;if(o>1)for(let t=0;t<i/s;t++){const e=t*s;for(let t=0;t<s;t++)a[t]=Math.max(a[t],uw(l[e+t],0,n).length)}return a}(t,e,n,i),a=e.length,o=dw(t,e,n,i,s),l=["Tensor"];return r&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${a}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(o.map((t=>"    "+t)).join("\n")),l.join("\n")}function uw(t,e,n){let r;return r=Array.isArray(t)?`${parseFloat(t[0].toFixed(7))} + ${parseFloat(t[1].toFixed(7))}j`:Dg(t)?`'${t}'`:"bool"===n?cw(t):parseFloat(t.toFixed(7)).toString(),Tg(r,e)}function cw(t){return 0===t?"false":"true"}function dw(t,e,n,r,i,s=!0){const a="complex64"===n?2:1,o=e[0],l=e.length;if(0===l){if("complex64"===n){return[uw(pw(t)[0],0,n)]}return"bool"===n?[cw(t[0])]:[t[0].toString()]}if(1===l){if(o>20){const e=3*a;let r=Array.from(t.slice(0,e)),s=Array.from(t.slice((o-3)*a,o*a));return"complex64"===n&&(r=pw(r),s=pw(s)),["["+r.map(((t,e)=>uw(t,i[e],n))).join(", ")+", ..., "+s.map(((t,e)=>uw(t,i[o-3+e],n))).join(", ")+"]"]}return["["+("complex64"===n?pw(t):Array.from(t)).map(((t,e)=>uw(t,i[e],n))).join(", ")+"]"]}const h=e.slice(1),u=r.slice(1),c=r[0]*a,d=[];if(o>20){for(let e=0;e<3;e++){const r=e*c,s=r+c;d.push(...dw(t.slice(r,s),h,n,u,i,!1))}d.push("...");for(let e=o-3;e<o;e++){const r=e*c,s=r+c;d.push(...dw(t.slice(r,s),h,n,u,i,e===o-1))}}else for(let e=0;e<o;e++){const r=e*c,s=r+c;d.push(...dw(t.slice(r,s),h,n,u,i,e===o-1))}const p=2===l?",":"";d[0]="["+(o>0?d[0]+p:"");for(let t=1;t<d.length-1;t++)d[t]=" "+d[t]+p;let f=",\n";for(let t=2;t<l;t++)f+="\n";return d[d.length-1]=" "+d[d.length-1]+"]"+(s?"":f),d}function pw(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}class fw{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=mg(t),null!=n){const t=n.length;dg(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Ng(e,this.size),this.strides=Vg(t)}set(t,...e){0===e.length&&(e=[0]),dg(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const n of t){if(n<0||n>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let e=0;e<t.length-1;++e)n+=this.strides[e]*t[e];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return mw().makeTensor(this.values,this.shape,this.dtype)}}let mw=null,gw=null,yw=null;class vw{constructor(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=mg(t),this.strides=Vg(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return gw.buffer(this.shape,this.dtype,t)}bufferSync(){return gw.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return Gg(this.shape,t,"complex64"===this.dtype)}arraySync(){return Gg(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const t=mw().read(this.dataId);if("string"===this.dtype){const e=await t;try{return e.map((t=>rw(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),mw().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=mw().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>rw(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await mw().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(mw().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return gw.print(this,t)}clone(){return this.throwIfDisposed(),gw.clone(this)}toString(t=!1){return hw(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),gw.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),mw().makeVariable(this,t,e,n)}}function xw(){return sy("Tensor",(()=>vw))}Object.defineProperty(vw,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}),xw();class bw extends vw{constructor(t,e,n,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!vg(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);mw().disposeTensor(this),this.dataId=t.dataId,mw().incRef(this,null)}dispose(){mw().disposeVariable(this),this.isDisposedInternal=!0}}var ww,_w,Tw,Ew,Sw;Object.defineProperty(bw,Symbol.hasInstance,{value:t=>t instanceof vw&&null!=t.assign&&t.assign instanceof Function}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(ww||(ww={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(_w||(_w={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(Tw||(Tw={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(Ew||(Ew={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(Sw||(Sw={}));const Iw={float32:Ew,int32:_w,bool:Tw,complex64:Sw};function kw(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return Iw[t][e]}function Cw(t){return kw(t,"int32")}function Nw(t){return null!=t&&"object"==typeof t&&"texture"in t&&t.texture instanceof WebGLTexture}function Aw(t){return"undefined"!=typeof GPUBuffer&&null!=t&&"object"==typeof t&&"buffer"in t&&t.buffer instanceof GPUBuffer}function Rw(t,e){if(t.dtype===e.dtype)return[t,e];const n=kw(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function Mw(t,e){dg(t.dtype===e.dtype,(()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`))}function Ow(t,e){return e.some((e=>e.id===t.id))}function Pw(t){const e=[];return Dw(t,e,new Set),e}function Dw(t,e,n){if(null==t)return;if(t instanceof vw)return void e.push(t);if(r=t,!Array.isArray(r)&&"object"!=typeof r)return;var r;const i=t;for(const t in i){const r=i[t];n.has(r)||(n.add(r),Dw(r,e,n))}}function Fw(t){return null!=t.kernelName}class Lw{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class Bw{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Lw}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(Eb(),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new aw(this.backendInstance),!0}setupRegisteredKernels(){Ab(this.backendName).forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){Ab(t).forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const n=e.factory();if(!n||n instanceof ng||"function"!=typeof n.then)return this.registry[t]=n,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,r=n.then((n=>!(e<this.pendingBackendInitId)&&(this.registry[t]=n,this.pendingBackendInit=null,!0))).catch((t=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,Eb(),Eb(t.stack||t.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(t){return Eb(),Eb(t.stack||t.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:r,asyncInit:i}=this.initializeBackend(n);if(i||r)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),r=n.backend,i=this.readSync(e),s=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,i,n.shape,n.dtype,s),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=e(),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(t){throw e(),t}}nextTensorId(){return Bw.nextTensorId++}nextVariableId(){return Bw.nextVariableId++}clone(t){const e=Uw.runKernel(_v,{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(t=>({x:()=>{const e={x:t},n={dtype:"float32"};return Uw.runKernel(Ay,e,n)}})),[],{}),e}runKernel(t,e,n){null==this.backendName&&this.backend;if(!(null!=Cb(t,this.backendName)))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const r=this.backend.numDataIds();let i=0;n.forEach((t=>{i+="complex64"===t.dtype?3:1}));const s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-e-i-s;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${t}'`)}runKernelFunc(t){let e,n=[];const r=this.isTapeOn(),i=this.state.numBytes,s=this.state.numTensors;let a,o;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const l=Fw(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Fw(t)){const{kernelName:e,inputs:i,attrs:s}=t;null==this.backendName&&this.backend;const l=Cb(e,this.backendName);dg(null!=l,(()=>`Cannot find registered kernel '${e}' for backend '${this.backendName}'`)),a=()=>{const t=this.backend.numDataIds();o=l.kernelFunc({inputs:i,attrs:s,backend:this.backend});const a=Array.isArray(o)?o:[o];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(e,t,a);const h=a.map((t=>null!=t.rank?t:this.makeTensorFromTensorInfo(t)));if(r){const t=this.getTensorsForGradient(e,i,h);n=this.saveTensorsForBackwardMode(t)}return h}}else{const{forwardFunc:e}=t,i=t=>{r&&(n=t.map((t=>this.keep(this.clone(t)))))};a=()=>{const t=this.backend.numDataIds();o=this.tidy((()=>e(this.backend,i)));const n=Array.isArray(o)?o:[o];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,t,n),n}}const{inputs:h,attrs:u}=t,c=Fw(t)?null:t.backwardsFunc;let d;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(d=this.profiler.profileKernel(l,h,(()=>a())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),e=d.outputs):e=a()})),r&&this.addTapeNode(l,h,e,c,n,u),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(h).map((t=>null!=h[t]?h[t].shape:null)),outputShapes:e.map((t=>t.shape)),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(o)?e:e[0]}saveTensorsForBackwardMode(t){const e=t.map((t=>this.keep(this.clone(t))));return e}getTensorsForGradient(t,e,n){const r=Nb(t);if(null!=r){const t=r.inputsToSave||[],i=r.outputsToSave||[];let s;r.saveAllInputs?(dg(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),s=Object.keys(e).map((t=>e[t]))):s=t.map((t=>e[t]));const a=n.filter(((t,e)=>i[e]));return s.concat(a)}return[]}makeTensor(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let i=t;"string"===n&&Dg(t[0])&&(i=t.map((t=>nw(t))));const s=r.write(i,e,n),a=new vw(e,n,s,this.nextTensorId());if(this.trackTensor(a,r),"string"===n){const t=this.state.tensorInfo.get(s),e=Pg(i);this.state.numBytes+=e-t.bytes,t.bytes=e}return a}makeTensorFromDataId(t,e,n,r){const i={dataId:t,shape:e,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(t,e){const{dataId:n,shape:r,dtype:i}=t,s=new vw(r,i,n,this.nextTensorId());return this.trackTensor(s,e),s}makeVariable(t,e=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));const i=new bw(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*Og(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof bw||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){const e=t.size*Og(t.dtype);this.state.numBytes-=e}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const t of this.state.activeProfile.kernels)t.kernelTimeMs=await t.kernelTimeMs,t.extraInfo=await t.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,r,i,s){const a={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:i},o=Nb(t);null!=o&&(r=o.gradFunc),null!=r&&(a.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],r=Hg(t.size,t.dtype);return this.makeTensor(r,t.shape,t.dtype)}return t})),r(t.length>1?t:t[0],i,s))),this.state.activeTape.push(a)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=Pw(t),n=new Set(e.map((t=>t.id)));for(let t=0;t<this.state.activeScope.track.length;t++){const e=this.state.activeScope.track[t];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==r.id||this.track(t)}))}gradients(t,e,n,r=!1){if(dg(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const i=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));dg(i instanceof vw,(()=>"The result y returned by f() must be a tensor."));const s=function(t,e,n){const r={},i={};for(let t=0;t<e.length;t++)r[e[t].id]=!0;for(let n=0;n<t.length;n++){const s=t[n],a=s.inputs;for(const t in a){const n=a[t];let o=!1;for(let t=0;t<e.length;t++)if(r[n.id]){s.outputs.forEach((t=>r[t.id]=!0)),o=!0,i[s.id]=!0;break}if(o)break}}const s={};s[n.id]=!0;const a={};for(let e=t.length-1;e>=0;e--){const n=t[e],r=n.inputs;for(let t=0;t<n.outputs.length;t++)if(s[n.outputs[t].id]){for(const t in r)s[r[t].id]=!0,a[n.id]=!0;break}}const o=[];for(let e=0;e<t.length;e++){const n=t[e];if(i[n.id]&&a[n.id]){const t={};for(const e in n.inputs){const i=n.inputs[e];r[i.id]&&(t[e]=i)}const e=Object.assign({},n);e.inputs=t,e.outputs=n.outputs,o.push(e)}}return o}(this.state.activeTape,e,i);if(!r&&0===s.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[i.id]=null==n?function(t){const e=Xg(mg(t),"float32");return Uw.makeTensor(e,t,"float32")}(i.shape):n,function(t,e,n,r){for(let i=e.length-1;i>=0;i--){const s=e[i],a=[];if(s.outputs.forEach((e=>{const n=t[e.id];null!=n?a.push(n):a.push(null)})),null==s.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);const o=s.gradient(a);for(const e in s.inputs){if(!(e in o))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(o)}.`);const i=n((()=>o[e]()));if("float32"!==i.dtype)throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${i.dtype}'`);const a=s.inputs[e];if(!vg(i.shape,a.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${e}' has shape '${i.shape}', which does not match the shape of the input '${a.shape}'`);if(null==t[a.id])t[a.id]=i;else{const e=t[a.id];t[a.id]=r(e,i),e.dispose()}}}}(t,s,(t=>this.tidy(t)),Vw);const r=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:i,grads:r}}))}customGrad(t){return dg($g(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;dg(e.every((t=>t instanceof vw)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};e.forEach(((t,e)=>{r[e]=t}));return this.runKernelFunc({forwardFunc:(r,i)=>(n=t(...e,i),dg(n.value instanceof vw,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),dg($g(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(t,r)=>{const i=n.gradFunc(t,r),s=Array.isArray(i)?i:[i];dg(s.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),dg(s.every((t=>t instanceof vw)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const a={};return s.forEach(((t,e)=>{a[e]=()=>t})),a},inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,e){return this.state.tensorInfo.get(t).backend.readToGPU(t,e)}async time(t){const e=tw(),n=await this.backend.time(t);return n.wallMs=tw()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Lw;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function $w(){const t=iy();if(null==t._tfengine){const e=new Qg(t);t._tfengine=new Bw(e)}var e;return e=t._tfengine.ENV,ry=e,mw=()=>t._tfengine,t._tfengine}Bw.nextTensorId=0,Bw.nextVariableId=0;const Uw=$w();function Vw(t,e){const n={a:t,b:e};return Uw.runKernel(hy,n)}let zw;function Gw(t){zw=t}function Ww(t){if(void 0!==zw)return zw;if(t||"undefined"!=typeof navigator&&null!=navigator){if(t||(t=navigator),"ReactNative"===t.product)return!0;const e=t.userAgent||t.vendor||("undefined"!=typeof window?window.opera:"");if(!e){const e=t;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function Xw(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}const Hw=ey();function Yw(t,e){let n=t;if(iw(t))return"string"===e?[]:[t.length];if(Nw(t)){const e=t.channels||"RGBA";return[t.height,t.width*e.length]}if(Aw(t))return[t.buffer.size/(null==e?4:Og(e))];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||iw(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&ey().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&jw(t,r,[]),r}function jw(t,e,n){if(n=n||[],!Array.isArray(t)&&!iw(t))return void dg(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));dg(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),dg(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const r=e.slice(1);for(let e=0;e<t.length;++e)jw(t[e],r,n.concat(e))}function qw(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function Kw(t,e,n,r="numeric"){if(t instanceof vw)return qw(r,t.dtype,e,n),t;let i=Bg(t);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),qw(r,i,e,n),null==t||!iw(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){const r=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const s=Yw(t,i);iw(t)||Array.isArray(t)||(t=[t]);const a="string"!==i?Qb(t,i):sw(t,[],!0);return Uw.makeTensor(a,s,i)}function Zw(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map(((t,i)=>Kw(t,`${e}[${i}]`,n,r)))}Hw.registerFlag("DEBUG",(()=>!1),(t=>{})),Hw.registerFlag("IS_BROWSER",(()=>Xw())),Hw.registerFlag("IS_NODE",(()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node)),Hw.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),Hw.registerFlag("IS_SAFARI",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor))),Hw.registerFlag("PROD",(()=>!1)),Hw.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>Hw.getBool("DEBUG"))),Hw.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),Hw.registerFlag("IS_TEST",(()=>!1)),Hw.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>Hw.getBool("DEBUG"))),Hw.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),Hw.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(()=>!1)),Hw.registerFlag("USE_SETTIMEOUTCUSTOM",(()=>!1));const Jw="__op";function Qw(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=Jw;const i=(...t)=>{Uw.startScope(n);try{const e=r(...t);return Zg(e),Uw.endScope(e),e}catch(t){throw Uw.endScope(null),t}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}const t_=Qw({complex_:function(t,e){const n=Kw(t,"real","complex"),r=Kw(e,"imag","complex");pg(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const i={real:n,imag:r};return Uw.runKernel(Oy,i)}});function e_(t,e,n,r){if(null==r)r=Bg(t);else if("complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(Aw(t)||Nw(t)){if("float32"!==r&&"int32"!==r)throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return Uw.backend.createTensorFromGPUData(t,e||n,r)}if(!iw(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){jg(e);const t=mg(e),r=mg(n);dg(t===r,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${r}`));for(let t=0;t<n.length;++t){const r=n[t],i=t!==n.length-1||r!==mg(e.slice(t));dg(n[t]===e[t]||!i,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return iw(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?Qb(t,r):sw(t,[],!0),Uw.makeTensor(t,e,r)}function n_(t,e,n){return e_(t,e,Yw(t,n),n)}const r_={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class i_{static join(t){return new i_(t).slice()}constructor(t){if(this.shards=[],this.previousShardIndex=0,null==t)return;if(t instanceof Array||(t=[t]),0===(t=t.map((t=>iw(t)?t.buffer:t))).length)return;this.bufferUniformSize=t[0].byteLength;let e=0;for(let n=0;n<t.length;n++){const r=t[n];n!==t.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=e+r.byteLength;this.shards.push({buffer:r,start:e,end:i}),e=i}0===this.shards.length&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(t=0,e=this.byteLength){if(0===this.shards.length)return new ArrayBuffer(0);if(t=isNaN(Number(t))?0:t,e=isNaN(Number(e))?0:e,t=Math.max(0,t),(e=Math.min(this.byteLength,e))<=t)return new ArrayBuffer(0);const n=this.findShardForByte(t);if(-1===n)throw new Error(`Could not find start shard for byte ${t}`);const r=new ArrayBuffer(e-t),i=new Uint8Array(r);let s=0;for(let r=n;r<this.shards.length;r++){const n=this.shards[r],a=t+s-n.start,o=s,l=Math.min(e,n.end)-n.start,h=new Uint8Array(n.buffer,a,l-a);if(i.set(h,o),s+=h.length,e<n.end)break}return r}findShardForByte(t){if(0===this.shards.length||t<0||t>=this.byteLength)return-1;if(null!=this.bufferUniformSize)return this.previousShardIndex=Math.floor(t/this.bufferUniformSize),this.previousShardIndex;function e(e){return t<e.start?-1:t>=e.end?1:0}if(0===e(this.shards[this.previousShardIndex]))return this.previousShardIndex;const n=function(t,e){let n=0,r=t.length;for(;n<=r;){const i=Math.floor((r-n)/2)+n,s=e(t[i]);if(0===s)return i;s<0?r=i:n=i+1}return-1}(this.shards,e);return-1===n?-1:(this.previousShardIndex=n,this.previousShardIndex)}}async function s_(t,e){const n=[],r=[],i=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);for(let s=0;s<i.length;++s){const a=i[s],o=Array.isArray(t)?t[s].tensor:t[a];if("float32"!==o.dtype&&"int32"!==o.dtype&&"bool"!==o.dtype&&"string"!==o.dtype&&"complex64"!==o.dtype)throw new Error(`Unsupported dtype in weight '${a}': ${o.dtype}`);const l={name:a,shape:o.shape,dtype:o.dtype};if("string"===o.dtype){const t=new Promise((async t=>{const e=await o.bytes(),n=e.reduce(((t,e)=>t+e.length),0)+4*e.length,r=new Uint8Array(n);let i=0;for(let t=0;t<e.length;t++){const n=e[t],s=new Uint8Array(new Uint32Array([n.length]).buffer);r.set(s,i),i+=4,r.set(n,i),i+=n.length}t(r)}));r.push(t)}else r.push(o.data());null!=e&&(l.group=e),n.push(l)}return{data:o_(await Promise.all(r)),specs:n}}function a_(t,e){const n=new i_(t),r={};let i,s=0;for(const t of e){const e=t.name,a=t.dtype,o=t.shape,l=mg(o);let h;if("quantization"in t){const r=t.quantization;if("uint8"===r.dtype||"uint16"===r.dtype){if(!("min"in r)||!("scale"in r))throw new Error(`Weight ${t.name} with quantization ${r.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==r.dtype)throw new Error(`Weight ${t.name} has unknown quantization dtype ${r.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==a)throw new Error(`Weight ${t.name} is quantized with ${r.dtype} which only supports weights of type float32 not ${a}.`)}const o=r_[r.dtype],u=n.slice(s,s+l*o),c="uint8"===r.dtype?new Uint8Array(u):new Uint16Array(u);if("float32"===a)if("uint8"===r.dtype||"uint16"===r.dtype){h=new Float32Array(c.length);for(let t=0;t<c.length;t++){const e=c[t];h[t]=e*r.scale+r.min}}else{if("float16"!==r.dtype)throw new Error(`Unsupported quantization type ${r.dtype} for weight type float32.`);void 0===i&&(i=y_()),h=i(c)}else{if("int32"!==a)throw new Error(`Unsupported dtype in weight '${e}': ${a}`);if("uint8"!==r.dtype&&"uint16"!==r.dtype)throw new Error(`Unsupported quantization type ${r.dtype} for weight type int32.`);h=new Int32Array(c.length);for(let t=0;t<c.length;t++){const e=c[t];h[t]=Math.round(e*r.scale+r.min)}}s+=l*o}else if("string"===a){const e=mg(t.shape);h=[];for(let t=0;t<e;t++){const t=new Uint32Array(n.slice(s,s+4))[0];s+=4;const e=new Uint8Array(n.slice(s,s+t));h.push(e),s+=t}}else{const t=r_[a],i=n.slice(s,s+l*t);if("float32"===a)h=new Float32Array(i);else if("int32"===a)h=new Int32Array(i);else if("bool"===a)h=new Uint8Array(i);else{if("complex64"!==a)throw new Error(`Unsupported dtype in weight '${e}': ${a}`);{h=new Float32Array(i);const t=new Float32Array(h.length/2),n=new Float32Array(h.length/2);for(let e=0;e<t.length;e++)t[e]=h[2*e],n[e]=h[2*e+1];const s=n_(t,o,"float32"),a=n_(n,o,"float32");r[e]=t_(s,a),s.dispose(),a.dispose()}}s+=l*t}"complex64"!==a&&(r[e]=n_(h,o,a))}return r}function o_(t){if(null===t)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach((t=>{if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${t.constructor.name}`)}));const r=new Uint8Array(e);let i=0;return n.forEach((t=>{r.set(new Uint8Array(t.buffer),i),i+=t.byteLength})),r.buffer}const l_="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function h_(t){return l_?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function u_(t){return i_.join(t)}function c_(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);const e=t.split("/");return e[e.length-1]}function d_(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return null!=t.signature&&(n.signature=t.signature),null!=t.userDefinedMetadata&&(n.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(n.modelInitializer=t.modelInitializer),null!=t.initializerSignature&&(n.initializerSignature=t.initializerSignature),null!=t.trainingConfig&&(n.trainingConfig=t.trainingConfig),n}function p_(t,e,n){const r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(null!=t.trainingConfig&&(r.trainingConfig=t.trainingConfig),null!=t.weightsManifest){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=n}return null!=t.signature&&(r.signature=t.signature),null!=t.userDefinedMetadata&&(r.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(r.modelInitializer=t.modelInitializer),null!=t.initializerSignature&&(r.initializerSignature=t.initializerSignature),r}async function f_(t,e){let n,r;return null!=t.weightsManifest&&([n,r]=await e(t.weightsManifest)),p_(t,n,r)}function m_(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:h_(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:h_(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:new i_(t.weightData).byteLength}}function g_(t){const e=[];for(const n of t)e.push(...n.weights);return e}function y_(){const t=function(){const t=t=>{let e=t<<13,n=0;for(;0==(8388608&e);)n-=8388608,e<<=1;return e&=-8388609,n+=947912704,e|n},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}(),e=function(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}(),n=function(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}();return r=>{const i=new ArrayBuffer(4*r.length),s=new Uint32Array(i);for(let i=0;i<r.length;i++){const a=r[i],o=t[n[a>>10]+(1023&a)]+e[a>>10];s[i]=o}return new Float32Array(i)}}class v_{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==v_.instance&&(v_.instance=new v_),v_.instance}static registerSaveRouter(t){v_.getInstance().saveRouters.push(t)}static registerLoadRouter(t){v_.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return v_.getHandlers(t,"save")}static getLoadHandlers(t,e){return v_.getHandlers(t,"load",e)}static getHandlers(t,e,n){const r=[];return("load"===e?v_.getInstance().loadRouters:v_.getInstance().saveRouters).forEach((e=>{const i=e(t,n);null!==i&&r.push(i)})),r}}const x_=t=>v_.registerSaveRouter(t),b_=t=>v_.registerLoadRouter(t),w_=t=>v_.getSaveHandlers(t),__=(t,e)=>v_.getLoadHandlers(t,e),T_="tensorflowjs",E_="models_store",S_="model_info_store";function I_(){if(!ey().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function k_(t){const e=t.result;e.createObjectStore(E_,{keyPath:"modelPath"}),e.createObjectStore(S_,{keyPath:"modelPath"})}class C_{constructor(t){if(this.indexedDB=I_(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const r=this.indexedDB.open(T_,1);r.onupgradeneeded=()=>k_(r),r.onsuccess=()=>{const i=r.result;if(null==e){const e=i.transaction(E_,"readonly"),r=e.objectStore(E_).get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return i.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(i.close(),n(r.error)),e.oncomplete=()=>i.close()}else{e.weightData=i_.join(e.weightData);const r=m_(e),s=i.transaction(S_,"readwrite");let a,o,l=s.objectStore(S_);try{a=l.put({modelPath:this.modelPath,modelArtifactsInfo:r})}catch(t){return n(t)}a.onsuccess=()=>{o=i.transaction(E_,"readwrite");const a=o.objectStore(E_);let h;try{h=a.put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:r})}catch(t){return n(t)}h.onsuccess=()=>t({modelArtifactsInfo:r}),h.onerror=t=>{l=s.objectStore(S_);const e=l.delete(this.modelPath);e.onsuccess=()=>(i.close(),n(h.error)),e.onerror=t=>(i.close(),n(h.error))}},a.onerror=t=>(i.close(),n(a.error)),s.oncomplete=()=>{null==o?i.close():o.oncomplete=()=>i.close()}}},r.onerror=t=>n(r.error)}))}}C_.URL_SCHEME="indexeddb://";const N_=t=>{return ey().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(C_.URL_SCHEME)?(e=t.slice(C_.URL_SCHEME.length),new C_(e)):null;var e};v_.registerSaveRouter(N_),v_.registerLoadRouter(N_);class A_{constructor(){this.indexedDB=I_()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open(T_,1);n.onupgradeneeded=()=>k_(n),n.onsuccess=()=>{const r=n.result,i=r.transaction(S_,"readonly"),s=i.objectStore(S_).getAll();s.onsuccess=()=>{const e={};for(const t of s.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},s.onerror=t=>(r.close(),e(s.error)),i.oncomplete=()=>r.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){var e;return t=(e=t).startsWith(C_.URL_SCHEME)?e.slice(C_.URL_SCHEME.length):e,new Promise(((e,n)=>{const r=this.indexedDB.open(T_,1);r.onupgradeneeded=()=>k_(r),r.onsuccess=()=>{const i=r.result,s=i.transaction(S_,"readwrite"),a=s.objectStore(S_),o=a.get(t);let l;o.onsuccess=()=>{if(null==o.result)return i.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const r=a.delete(t),s=()=>{l=i.transaction(E_,"readwrite");const r=l.objectStore(E_).delete(t);r.onsuccess=()=>e(o.result.modelArtifactsInfo),r.onerror=t=>n(o.error)};r.onsuccess=s,r.onerror=t=>(s(),i.close(),n(o.error))}},o.onerror=t=>(i.close(),n(o.error)),s.oncomplete=()=>{null==l?i.close():l.oncomplete=()=>i.close()}},r.onerror=t=>n(r.error)}))}}const R_="/",M_="tensorflowjs_models",O_="info",P_="model_topology",D_="weight_specs",F_="weight_data",L_="model_metadata";function B_(t){return{info:[M_,t,O_].join(R_),topology:[M_,t,P_].join(R_),weightSpecs:[M_,t,D_].join(R_),weightData:[M_,t,F_].join(R_),modelMetadata:[M_,t,L_].join(R_)}}function $_(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function U_(t){const e=t.split(R_);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(R_)}class V_{constructor(t){if(!ey().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=B_(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=m_(t),i=i_.join(t.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(l_)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let t=0,r=e.length;t<r;t++)n+=String.fromCharCode(e[t]);return btoa(n)}(i));const s={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,initializerSignature:null!=t.initializerSignature?t.initializerSignature:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:r}}catch(t){throw $_(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(null!=i){const t=JSON.parse(i);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer),null!=t.initializerSignature&&(e.initializerSignature=t.initializerSignature),null!=t.trainingConfig&&(e.trainingConfig=t.trainingConfig)}const s=this.LS.getItem(this.keys.weightData);if(null==s)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(l_){const e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n.set([e.charCodeAt(t)],t);return n.buffer}(s),e}}V_.URL_SCHEME="localstorage://";const z_=t=>{return ey().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(V_.URL_SCHEME)?(e=t.slice(V_.URL_SCHEME.length),new V_(e)):null;var e};v_.registerSaveRouter(z_),v_.registerLoadRouter(z_);class G_{constructor(){dg(ey().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),dg("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=M_+R_,n=R_+O_;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(e)&&i.endsWith(n)){t[U_(i)]=JSON.parse(this.LS.getItem(i))}}return t}async removeModel(t){var e;const n=B_(t=(e=t).startsWith(V_.URL_SCHEME)?e.slice(V_.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return $_(n),r}}const W_="://";class X_{constructor(){this.managers={}}static getInstance(){return null==X_.instance&&(X_.instance=new X_),X_.instance}static registerManager(t,e){dg(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith(W_)&&(t=t.slice(0,t.indexOf(W_))),dg(t.length>0,(()=>"scheme must not be an empty string."));const n=X_.getInstance();dg(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=X_.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(X_.getInstance().managers)}}function H_(t){if(-1===t.indexOf(W_))throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${X_.getSchemes().join(",")}`);return{scheme:t.split(W_)[0],path:t.split(W_)[1]}}async function Y_(t,e,n=!1){dg(t!==e,(()=>`Old path and new path are the same: '${t}'`));const r=v_.getLoadHandlers(t);dg(r.length>0,(()=>`Copying failed because no load handler is found for source URL ${t}.`)),dg(r.length<2,(()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`));const i=r[0],s=v_.getSaveHandlers(e);dg(s.length>0,(()=>`Copying failed because no save handler is found for destination URL ${e}.`)),dg(s.length<2,(()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${e}.`));const a=s[0],o=H_(t).scheme,l=H_(t).path,h=o===H_(t).scheme,u=await i.load();n&&h&&await X_.getManager(o).removeModel(l);const c=await a.save(u);return n&&!h&&await X_.getManager(o).removeModel(l),c.modelArtifactsInfo}async function j_(){const t=X_.getSchemes(),e={};for(const n of t){const t=await X_.getManager(n).listModels();for(const r in t){e[n+W_+r]=t[r]}}return e}async function q_(t){const e=H_(t);return X_.getManager(e.scheme).removeModel(e.path)}async function K_(t,e){return Y_(t,e,!1)}async function Z_(t,e){return Y_(t,e,!0)}class J_{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}setTimeoutCustom(t,e){"undefined"!=typeof window&&ey().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(t),setTimeout((()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")}),e),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(t=>{if(t.source===window&&t.data.name===this.messageName){t.stopPropagation();(0,this.functionRefs[t.data.index])(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}}),!0))):setTimeout(t,e)}isTypedArray(t){return Lb(t)}}if(ey().get("IS_BROWSER")){ey().setPlatform("browser",new J_);try{X_.registerManager(V_.URL_SCHEME,new G_)}catch(t){}try{X_.registerManager(C_.URL_SCHEME,new A_)}catch(t){}}const Q_=()=>n(410);let tT;class eT{constructor(){this.util=n(628),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=ey().global.fetch?ey().global.fetch(t,e):(null==tT&&(tT=Q_()),tT(t,e))}now(){const t=process.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}isTypedArray(t){return this.util.types.isFloat32Array(t)||this.util.types.isInt32Array(t)||this.util.types.isUint8Array(t)||this.util.types.isUint8ClampedArray(t)}}function nT(t,e="float32",n){return e=e||"float32",jg(t),new fw(t,e,n)}ey().get("IS_NODE")&&!ey().get("IS_BROWSER")&&ey().setPlatform("node",new eT);const rT=Qw({cast_:function(t,e){const n=Kw(t,"x","cast");if(!Rg(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},i={dtype:e};return Uw.runKernel(Ay,r,i)}});const iT=Qw({clone_:function(t){const e={x:Kw(t,"x","clone","string_or_numeric")};return Uw.runKernel(_v,e)}});function sT(t,e=!1){}$w();function aT(){ey().set("PROD",!0)}function oT(){ey().set("DEBUG",!0)}function lT(){ey().set("DEPRECATION_WARNINGS_ENABLED",!1)}function hT(t){ey().getBool("DEPRECATION_WARNINGS_ENABLED")}function uT(){Uw.disposeVariables()}function cT(){return Uw}function dT(){return Uw.memory()}function pT(t){return Uw.profile(t)}function fT(t,e){return Uw.tidy(t,e)}function mT(t){Pw(t).forEach((t=>t.dispose()))}function gT(t){return Uw.keep(t)}function yT(t){return Uw.time(t)}function vT(t){return Uw.setBackend(t)}function xT(){return Uw.ready()}function bT(){return Uw.backendName}function wT(t){Uw.removeBackend(t)}function _T(t){return Uw.findBackend(t)}function TT(t){return Uw.findBackendFactory(t)}function ET(t,e,n=1){return Uw.registerBackend(t,e,n)}function ST(){return Uw.backend}function IT(t,e){ey().setPlatform(t,e)}gw={buffer:nT,cast:rT,clone:iT,print:sT},yw=hT;const kT=Qw({add_:function(t,e){let n=Kw(t,"a","add"),r=Kw(e,"b","add");[n,r]=Rw(n,r);const i={a:n,b:r};return Uw.runKernel(hy,i)}});const CT=Qw({floorDiv_:function(t,e){let n=Kw(t,"a","floorDiv"),r=Kw(e,"b","floorDiv");[n,r]=Rw(n,r);const i={a:n,b:r};return Uw.runKernel(gv,i)}});const NT=Qw({div_:function(t,e){let n=Kw(t,"a","div"),r=Kw(e,"b","div");if([n,r]=Rw(n,r),"int32"===n.dtype&&"int32"===r.dtype)return CT(n,r);const i={a:n,b:r};return Uw.runKernel(rv,i,{})}});const AT=Qw({mul_:function(t,e){let n=Kw(t,"a","mul"),r=Kw(e,"b","mul");[n,r]=Rw(n,r);const i={a:n,b:r};return Uw.runKernel(nx,i)}});const RT=Qw({sqrt_:function(t){const e={x:Kw(t,"x","sqrt","float32")};return Uw.runKernel(Gx,e)}});const MT=Qw({square_:function(t){const e=Kw(t,"x","square");return Uw.runKernel("Square",{x:e},{})}});const OT=Qw({zerosLike_:function(t){const e={x:Kw(t,"x","zerosLike")};return Uw.runKernel(yb,e)}});function PT(t){return dg($g(t),(()=>"The f passed in grad(f) must be a function")),(e,n)=>{const r=Kw(e,"x","tf.grad","string_or_numeric"),i=null!=n?Kw(n,"dy","tf.grad"):null;return Uw.tidy((()=>{const{value:e,grads:n}=Uw.gradients((()=>t(r)),[r],i);return null!=i&&pg(e.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),UT(n),n[0]}))}}function DT(t){return dg($g(t),(()=>"The f passed in grads(f) must be a function")),(e,n)=>{dg(Array.isArray(e),(()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"));const r=Zw(e,"args","tf.grads","string_or_numeric"),i=null!=n?Kw(n,"dy","tf.grads"):null;return Uw.tidy((()=>{const{value:e,grads:n}=Uw.gradients((()=>t(...r)),r,i);return null!=i&&pg(e.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),UT(n),n}))}}function FT(t){return dg($g(t),(()=>"The f passed in valueAndGrad(f) must be a function")),(e,n)=>{dg(e instanceof vw,(()=>"The x passed in valueAndGrad(f)(x) must be a tensor")),dg(null==n||n instanceof vw,(()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"));const{grads:r,value:i}=Uw.gradients((()=>t(e)),[e],n);return UT(r),{grad:r[0],value:i}}}function LT(t){return dg($g(t),(()=>"The f passed in valueAndGrads(f) must be a function")),(e,n)=>{dg(Array.isArray(e)&&e.every((t=>t instanceof vw)),(()=>"The args passed in valueAndGrads(f)(args) must be array of tensors")),dg(null==n||n instanceof vw,(()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"));const r=Uw.gradients((()=>t(...e)),e,n);return null!=n&&pg(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),UT(r.grads),r}}function BT(t,e){dg($g(t),(()=>"The f passed in variableGrads(f) must be a function")),dg(null==e||Array.isArray(e)&&e.every((t=>t instanceof bw)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=e;if(!n){e=[];for(const t in Uw.registeredVariables)e.push(Uw.registeredVariables[t])}const r=n?e.filter((t=>!t.trainable)):null,i=e.length;e=e.filter((t=>t.trainable)),dg(e.length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`));const{value:s,grads:a}=Uw.gradients(t,e,null,!0);dg(a.some((t=>null!=t)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),dg(0===s.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${s.rank} tensor`));const o={};return e.forEach(((t,e)=>{null!=a[e]&&(o[t.name]=a[e])})),null!=r&&r.forEach((t=>o[t.name]=null)),{value:s,grads:o}}function $T(t){return Uw.customGrad(t)}function UT(t){if(t.filter((t=>null==t)).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}function VT(t,e){if((iw(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&iw(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return e_(t,[],[],e)}const zT=new Map,GT=new Map;class WT{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class XT{constructor(){this.classNameMap={}}static getMap(){return null==XT.instance&&(XT.instance=new XT),XT.instance}static register(t){XT.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function HT(t,e,n){dg(null!=t.className,(()=>"Class being registered does not have the static className property defined.")),dg("string"==typeof t.className,(()=>"className is required to be a string, but got type "+typeof t.className)),dg(t.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),void 0===e&&(e="Custom"),void 0===n&&(n=t.className);const r=e+">"+n;return XT.register(t),zT.set(r,t),GT.set(t,r),t}function YT(t){return GT.has(t)?GT.get(t):t.className}class jT extends WT{minimize(t,e=!1,n){const{value:r,grads:i}=this.computeGradients(t,n);if(null!=n){const t=n.map((t=>({name:t.name,tensor:i[t.name]})));this.applyGradients(t)}else this.applyGradients(i);return mT(i),e?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return BT(t,e)}dispose(){null!=this.iterations_&&mT(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:VT(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(jT,Symbol.hasInstance,{value:t=>null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients});class qT extends jT{static get className(){return"Adadelta"}constructor(t,e,n=null){super(),this.learningRate=t,this.rho=e,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=Uw.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Uw.registeredVariables[e];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${e}/accum_grad`,variable:fT((()=>OT(r).variable(false)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${e}/accum_var`,variable:fT((()=>OT(r).variable(false)))});const i=Array.isArray(t)?t[n].tensor:t[e];if(null==i)return;const s=this.accumulatedGrads[n].variable,a=this.accumulatedUpdates[n].variable;fT((()=>{const t=kT(AT(s,this.rho),AT(MT(i),1-this.rho)),e=AT(NT(RT(kT(a,this.epsilon)),RT(kT(s,this.epsilon))),i),n=kT(AT(a,this.rho),AT(MT(e),1-this.rho));s.assign(t),a.assign(n);const o=kT(AT(e,-this.learningRate),r);r.assign(o)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(mT(this.accumulatedGrads.map((t=>t.variable))),mT(this.accumulatedUpdates.map((t=>t.variable))))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){const e=(t=await this.extractIterations(t)).length/2;this.accumulatedGrads=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedUpdates=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}function KT(t,e,n){jg(t);const r={shape:t,value:e,dtype:n=n||Bg(e)};return Uw.runKernel(pv,{},r)}class ZT extends jT{static get className(){return"Adagrad"}constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Uw.registeredVariables[e];if(null==this.accumulatedGrads[n]){const t=!1;this.accumulatedGrads[n]={originalName:`${e}/accumulator`,variable:fT((()=>KT(r.shape,this.initialAccumulatorValue).variable(t)))}}const i=Array.isArray(t)?t[n].tensor:t[e];if(null==i)return;const s=this.accumulatedGrads[n].variable;fT((()=>{const t=kT(s,MT(i));s.assign(t);const e=kT(AT(NT(i,RT(kT(t,Uw.backend.epsilon()))),-this.learningRate),r);r.assign(e)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&mT(this.accumulatedGrads.map((t=>t.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulatedGrads=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}const JT=Qw({pow_:function(t,e){let n=Kw(t,"base","pow"),r=Kw(e,"exp","pow");[n,r]=Rw(n,r);const i={a:n,b:r};return Uw.runKernel(px,i)}});const QT=Qw({sub_:function(t,e){let n=Kw(t,"a","sub"),r=Kw(e,"b","sub");[n,r]=Rw(n,r);const i={a:n,b:r};return Uw.runKernel(ab,i)}});class tE extends jT{static get className(){return"Adam"}constructor(t,e,n,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],fT((()=>{this.accBeta1=VT(e).variable(),this.accBeta2=VT(n).variable()})),null==r&&(this.epsilon=Uw.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);fT((()=>{const n=QT(1,this.accBeta1),r=QT(1,this.accBeta2);e.forEach(((e,i)=>{const s=Uw.registeredVariables[e];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:`${e}/m`,variable:fT((()=>OT(s).variable(false)))}),null==this.accumulatedSecondMoment[i]&&(this.accumulatedSecondMoment[i]={originalName:`${e}/v`,variable:fT((()=>OT(s).variable(false)))});const a=Array.isArray(t)?t[i].tensor:t[e];if(null==a)return;const o=this.accumulatedFirstMoment[i].variable,l=this.accumulatedSecondMoment[i].variable,h=kT(AT(o,this.beta1),AT(a,1-this.beta1)),u=kT(AT(l,this.beta2),AT(MT(a),1-this.beta2)),c=NT(h,n),d=NT(u,r);o.assign(h),l.assign(u);const p=kT(AT(NT(c,kT(RT(d),this.epsilon)),-this.learningRate),s);s.assign(p)})),this.accBeta1.assign(AT(this.accBeta1,this.beta1)),this.accBeta2.assign(AT(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&mT(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedSecondMoment&&mT(this.accumulatedSecondMoment.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),fT((()=>{this.accBeta1.assign(JT(this.beta1,this.iterations_+1)),this.accBeta2.assign(JT(this.beta2,this.iterations_+1))}));const e=t.length/2;this.accumulatedFirstMoment=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)}))),this.accumulatedSecondMoment=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}const eE=Qw({abs_:function(t){const e=Kw(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return Uw.runKernel(Py,t)}{const t={x:e};return Uw.runKernel(ay,t)}}});function nE(t,e){const n=t.length,r=[];for(let i=0;i<n;i++){const s=n-1-i,a=t[s]||1;(e[e.length-1-i]||1)>1&&1===a&&r.unshift(s)}return r}function rE(t,e){const n=[];for(let r=0;r<e.length;r++){const i=t[t.length-r-1],s=e.length-r-1,a=e[s];(null==i||1===i&&a>1)&&n.unshift(s)}return n}function iE(t,e){const n=Math.max(t.length,e.length),r=new Array(n);for(let i=0;i<n;i++){let s=t[t.length-i-1];null==s&&(s=1);let a=e[e.length-i-1];if(null==a&&(a=1),1===s)r[n-i-1]=a;else if(1===a)r[n-i-1]=s;else{if(s!==a){throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`)}r[n-i-1]=s}}return r}const sE=Qw({maximum_:function(t,e){let n=Kw(t,"a","maximum"),r=Kw(e,"b","maximum");[n,r]=Rw(n,r),"bool"===n.dtype&&(n=rT(n,"int32"),r=rT(r,"int32")),iE(n.shape,r.shape);const i={a:n,b:r};return Uw.runKernel(Wv,i)}});class aE extends jT{static get className(){return"Adamax"}constructor(t,e,n,r=null,i=0){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],fT((()=>{this.iteration=VT(0).variable(),this.accBeta1=VT(e).variable()})),null==r&&(this.epsilon=Uw.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);fT((()=>{const n=QT(1,this.accBeta1),r=NT(-this.learningRate,kT(AT(this.iteration,this.decay),1));e.forEach(((e,i)=>{const s=Uw.registeredVariables[e];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:`${e}/m`,variable:OT(s).variable(false)}),null==this.accumulatedWeightedInfNorm[i]&&(this.accumulatedWeightedInfNorm[i]={originalName:`${e}/v`,variable:OT(s).variable(false)});const a=Array.isArray(t)?t[i].tensor:t[e];if(null==a)return;const o=this.accumulatedFirstMoment[i].variable,l=this.accumulatedWeightedInfNorm[i].variable,h=kT(AT(o,this.beta1),AT(a,1-this.beta1)),u=AT(l,this.beta2),c=eE(a),d=sE(u,c);o.assign(h),l.assign(d);const p=kT(AT(NT(r,n),NT(h,kT(d,this.epsilon))),s);s.assign(p)})),this.iteration.assign(kT(this.iteration,1)),this.accBeta1.assign(AT(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&mT(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedWeightedInfNorm&&mT(this.accumulatedWeightedInfNorm.map((t=>t.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}class oE extends jT{static get className(){return"SGD"}constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const i=Uw.registeredVariables[e];fT((()=>{const t=kT(AT(this.c,r),i);i.assign(t)}))})),this.incrementIterations()}setLearningRate(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=gT(VT(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(0!==(t=await this.extractIterations(t)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}class lE extends oE{static get className(){return"Momentum"}constructor(t,e,n=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=n,this.accumulations=[],this.m=VT(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Uw.registeredVariables[e];if(null==this.accumulations[n]){const t=!1;this.accumulations[n]={originalName:`${e}/momentum`,variable:fT((()=>OT(r).variable(t)))}}const i=this.accumulations[n].variable,s=Array.isArray(t)?t[n].tensor:t[e];null!=s&&fT((()=>{let t;const e=kT(AT(this.m,i),s);t=this.useNesterov?kT(AT(this.c,kT(s,AT(e,this.m))),r):kT(AT(this.c,e),r),i.assign(e),r.assign(t)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&mT(this.accumulations.map((t=>t.variable)))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);this.accumulations=t.map((t=>({originalName:t.name,variable:t.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}class hE extends jT{static get className(){return"RMSProp"}constructor(t,e=.9,n=0,r=null,i=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,null==r&&(this.epsilon=Uw.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Uw.registeredVariables[e],i=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${e}/rms`,variable:fT((()=>OT(r).variable(i)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${e}/momentum`,variable:fT((()=>OT(r).variable(i)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${e}/mg`,variable:fT((()=>OT(r).variable(i)))});const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const a=this.accumulatedMeanSquares[n].variable,o=this.accumulatedMoments[n].variable;fT((()=>{const t=kT(AT(a,this.decay),AT(MT(s),1-this.decay));if(this.centered){const e=this.accumulatedMeanGrads[n].variable,i=kT(AT(e,this.decay),AT(s,1-this.decay)),l=NT(AT(s,this.learningRate),RT(QT(t,kT(MT(i),this.epsilon)))),h=kT(AT(o,this.momentum),l);a.assign(t),e.assign(i),o.assign(h);const u=QT(r,h);r.assign(u)}else{const t=kT(AT(a,this.decay),AT(MT(s),1-this.decay)),e=kT(AT(o,this.momentum),NT(AT(s,this.learningRate),RT(kT(t,this.epsilon))));a.assign(t),o.assign(e);const n=QT(r,e);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&mT(this.accumulatedMeanSquares.map((t=>t.variable))),null!=this.accumulatedMeanGrads&&this.centered&&mT(this.accumulatedMeanGrads.map((t=>t.variable))),null!=this.accumulatedMoments&&mT(this.accumulatedMoments.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,n=!1;this.accumulatedMeanSquares=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedMoments=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}const uE=[qT,ZT,tE,aE,lE,hE,oE];function cE(t){return new Promise((t=>setTimeout(t))).then(t)}class dE{constructor(t){if(!ey().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(dE.URL_SCHEME)&&(t=t.slice(dE.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}async save(t){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=i_.join(t.weightData),n=window.URL.createObjectURL(new Blob([e],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const e=d_(t,[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(e)],{type:"application/json"})),i=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(i.download=this.modelJsonFileName,i.href=r,await cE((()=>i.dispatchEvent(new MouseEvent("click")))),null!=t.weightData){const t=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;t.download=this.weightDataFileName,t.href=n,await cE((()=>t.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:m_(t)}}}}dE.URL_SCHEME="downloads://";class pE{constructor(t){if(null==t||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}async load(){return new Promise(((t,e)=>{const n=new FileReader;n.onload=n=>{const r=JSON.parse(n.target.result),i=r.modelTopology;if(null==i)return void e(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));if(null==r.weightsManifest)return void e(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));if(0===this.weightsFiles.length)return void t({modelTopology:i});const s=f_(r,(t=>this.loadWeights(t)));t(s)},n.onerror=t=>e(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)}))}loadWeights(t){const e=[],n=[];for(const r of t)e.push(...r.weights),n.push(...r.paths);const r=this.checkManifestAndWeightFiles(t),i=n.map((t=>this.loadWeightsFile(t,r[t])));return Promise.all(i).then((t=>[e,t]))}loadWeightsFile(t,e){return new Promise(((n,r)=>{const i=new FileReader;i.onload=t=>{const e=t.target.result;n(e)},i.onerror=e=>r(`Failed to weights data from file of path '${t}'.`),i.readAsArrayBuffer(e)}))}checkManifestAndWeightFiles(t){const e=[],n=this.weightsFiles.map((t=>c_(t.name))),r={};for(const i of t)i.paths.forEach((t=>{const i=c_(t);if(-1!==e.indexOf(i))throw new Error(`Duplicate file basename found in weights manifest: '${i}'`);if(e.push(i),-1===n.indexOf(i))throw new Error(`Weight file with basename '${i}' is not provided.`);r[t]=this.weightsFiles[n.indexOf(i)]}));if(e.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${e.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}function fE(t){return new pE(t)}function mE(t,e,n,r){!function(t){dg(null!=t&&Array.isArray(t)&&t.length>0,(()=>"promises must be a none empty array"))}(t),function(t,e){dg(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${t}`)),dg(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${e}`)),dg(e>=t,(()=>`startFraction must be no more than endFraction, but got startFraction ${t} and endFraction ${e}`))}(n=null==n?0:n,r=null==r?1:r);let i=0;return Promise.all(t.map((s=>(s.then((s=>{const a=n+ ++i/t.length*(r-n);return e(a),s})),s))))}async function gE(t,e){null==e&&(e={});const n=null==e.fetchFunc?ey().platform.fetch:e.fetchFunc,r=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),i=(null==e.onProgress?await Promise.all(r):await mE(r,e.onProgress,0,.5)).map((t=>t.arrayBuffer()));return null==e.onProgress?await Promise.all(i):await mE(i,e.onProgress,.5,1)}async function yE(t,e="",n,r){return vE((t=>gE(t,{requestInit:r})))(t,e,n)}function vE(t){return async(e,n="",r)=>{const i=e.map((()=>!1)),s={},a=null!=r?r.map((()=>!1)):[],o=[];if(e.forEach(((t,e)=>{let n=0;t.weights.forEach((t=>{const l="quantization"in t?t.quantization.dtype:t.dtype,h=r_[l]*mg(t.shape),u=()=>{i[e]=!0,null==s[e]&&(s[e]=[]),s[e].push({manifestEntry:t,groupOffset:n,sizeBytes:h})};null!=r?r.forEach(((e,n)=>{e===t.name&&(u(),a[n]=!0)})):u(),o.push(t.name),n+=h}))})),!a.every((t=>t))){const t=r.filter(((t,e)=>!a[e]));throw new Error(`Could not find weights in manifest with names: ${t.join(", ")}. \nManifest JSON has weights with names: ${o.join(", ")}.`)}const l=i.reduce(((t,e,n)=>(e&&t.push(n),t)),[]),h=[];l.forEach((t=>{e[t].paths.forEach((t=>{const e=n+(n.endsWith("/")?"":"/")+t;h.push(e)}))}));const u=await t(h),c={};let d=0;return l.forEach((t=>{const n=e[t].paths.length,r=new i_(u.slice(d,d+n));s[t].forEach((t=>{const e=a_(r.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(const t in e)c[t]=e[t]})),d+=n})),c}}v_.registerSaveRouter((t=>ey().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(dE.URL_SCHEME)?function(t="model"){return new dE(t)}(t.slice(dE.URL_SCHEME.length)):null));class xE{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?(dg("function"==typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=ey().platform.fetch,dg(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&dg(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=d_(t,[{paths:["./model.weights.bin"],weights:t.weightSpecs}]);if(e.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=t.weightData){const n=i_.join(t.weightData);e.body.append("model.weights.bin",new Blob([n],{type:"application/octet-stream"}),"model.weights.bin")}const r=await this.fetch(this.path,e);if(r.ok)return{modelArtifactsInfo:m_(t),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(t){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=e.modelTopology,r=e.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return f_(e,(t=>this.loadWeights(t)))}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),i=n>e?t.substring(n):"";return[r+"/",i]}(e),i=this.weightPathPrefix||n,s=g_(t),a=[],o=[];for(const e of t)for(const t of e.paths)null!=this.weightUrlConverter?o.push(this.weightUrlConverter(t)):a.push(i+t+r);this.weightUrlConverter&&a.push(...await Promise.all(o));return[s,await gE(a,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})]}}function bE(t){return null!=t.match(xE.URL_SCHEME_REGEX)}xE.URL_SCHEME_REGEX=/^https?:\/\//;const wE=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>bE(t))):bE(t),n)return _E(t,e)}return null};function _E(t,e){return new xE(t,e)}function TE(t,e){return _E(t,e)}v_.registerSaveRouter(wE),v_.registerLoadRouter(wE);class EE{constructor(t){this.modelArtifacts=t}load(){return this.modelArtifacts}}class SE{constructor(t){this.saveHandler=t}save(t){return this.saveHandler(t)}}class IE{constructor(t){t.load&&(this.load=()=>Promise.resolve(t.load())),t.save&&(this.save=e=>Promise.resolve(t.save(e)))}}function kE(t,e,n,r){const i=arguments;return new IE(CE(...i))}function CE(t,e,n,r){if(1===arguments.length){const e=null!=t.modelTopology||null!=t.weightSpecs;return new EE(e?t:{modelTopology:t})}return new EE({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r})}function NE(t){return new SE(t)}function AE(t){return new SE(t)}const RE=Qw({matMul_:function(t,e,n=!1,r=!1){let i=Kw(t,"a","matMul"),s=Kw(e,"b","matMul");[i,s]=Rw(i,s);const a={a:i,b:s},o={transposeA:n,transposeB:r};return Uw.runKernel(Ey,a,o)}});const ME=Qw({oneHot_:function(t,e,n=1,r=0,i="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:Kw(t,"indices","oneHot","int32")},a={dtype:i,depth:e,onValue:n,offValue:r};return Uw.runKernel(hx,s,a)}});const OE=Qw({imag_:function(t){const e={input:Kw(t,"input","imag")};return Uw.runKernel(Ev,e)}});const PE=Qw({neg_:function(t){const e={x:Kw(t,"x","neg")};return Uw.runKernel(rx,e)}});const DE=Qw({real_:function(t){const e={input:Kw(t,"input","real")};return Uw.runKernel(bx,e)}});const FE=Qw({transpose_:function(t,e,n){const r=Kw(t,"x","transpose");if(null==e&&(e=r.shape.map(((t,e)=>e)).reverse()),dg(r.rank===e.length,(()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`)),e.forEach((t=>{dg(t>=0&&t<r.rank,(()=>"All entries in 'perm' must be between 0 and "+(r.rank-1)+` but got ${e}`))})),r.rank<=1)return r.clone();const i={x:r},s={perm:e};return"complex64"===r.dtype?fT((()=>{let t=DE(r),e=OE(r);return t=Uw.runKernel(db,{x:t},s),e=Uw.runKernel(db,{x:e},s),n&&(e=PE(e)),t_(t,e)})):Uw.runKernel(db,i,s)}});const LE=Qw({confusionMatrix_:function(t,e,n){const r=Kw(t,"labels","confusionMatrix"),i=Kw(e,"predictions","confusionMatrix");dg(null==n||n>0&&Number.isInteger(n),(()=>`If provided, numClasses must be a positive integer, but got ${n}`)),dg(1===r.rank,(()=>`Expected the rank of labels to be 1, but got ${r.rank}`)),dg(1===i.rank,(()=>`Expected the rank of predictions to be 1, but got ${i.rank}`)),dg(r.shape[0]===i.shape[0],(()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${i.shape[0]}. Labels and predictions should have the same number of elements.`)),dg(n>0&&Number.isInteger(n),(()=>`numClasses is required to be a positive integer, but got ${n}`));const s=ME(rT(r,"int32"),n),a=ME(rT(i,"int32"),n),o=FE(s),l=RE(o,a);return rT(l,"int32")}});function BE(t,e,n){if(fg(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const r=Yw(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return e_(t,e,r,n)}let $E,UE=!1;function VE(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,i=!1,s=!1,a=!1,o=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)s=!0;else if(null!=t.getContext)a=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);o=!0}if(null!=Cb(xb,Uw.backendName)){const n={pixels:t},r={numChannels:e};return Uw.runKernel(xb,n,r)}const[l,h]=i?[t.videoWidth,t.videoHeight]:[t.width,t.height];let u,c;if(a)u=t.getContext("2d").getImageData(0,0,l,h).data;else if(r||n)u=t.data;else if(s||i||o){if(null==$E)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");$E=new OffscreenCanvas(1,1).getContext("2d")}else $E=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});$E.canvas.width=l,$E.canvas.height=h,$E.drawImage(t,0,0,l,h),u=$E.getImageData(0,0,l,h).data}if(4===e)c=new Int32Array(u);else{const t=l*h;c=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)c[n*e+t]=u[4*n+t]}return BE(c,[h,l,e],"int32")}function zE(t){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(t instanceof ImageBitmap)&&function(t){return null!=t&&0!==t.width&&0!==t.height}(t)&&!function(t){return null!=t&&t.data instanceof Uint8Array}(t)}async function GE(t,e=3){let n=null;if(ey().getBool("WRAP_TO_IMAGEBITMAP")&&zE(t)){let e;try{e=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch(t){e=null}n=null!=e&&e.width===t.width&&e.height===t.height?e:t}else n=t;return VE(n,e)}function WE(t){if(2!==t.rank&&3!==t.rank)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${t.rank}.`);const e=2===t.rank?1:t.shape[2];if(e>4||2===e)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${e}`);if("float32"!==t.dtype&&"int32"!==t.dtype)throw new Error(`Unsupported type for toPixels: ${t.dtype}. Please use float32 or int32 tensors.`)}async function XE(t,e){let n=Kw(t,"img","toPixels");if(!(t instanceof vw)){const t=n;n=rT(t,"int32"),t.dispose()}WE(n);const[r,i]=n.shape.slice(0,2),s=2===n.rank?1:n.shape[2],a=await n.data(),o="float32"===n.dtype?255:1,l=new Uint8ClampedArray(i*r*4);for(let t=0;t<r*i;++t){const e=[0,0,0,255];for(let r=0;r<s;r++){const i=a[t*s+r];if("float32"===n.dtype){if(i<0||i>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${i}.`)}else if("int32"===n.dtype&&(i<0||i>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${i}.`);1===s?(e[0]=i*o,e[1]=i*o,e[2]=i*o):e[r]=i*o}const r=4*t;l[r+0]=Math.round(e[0]),l[r+1]=Math.round(e[1]),l[r+2]=Math.round(e[2]),l[r+3]=Math.round(e[3])}if(null!=e){if(!UE){null!=Cb(nv,Uw.backendName)&&(UE=!0)}e.width=i,e.height=r;const t=e.getContext("2d"),n=new ImageData(l,i,r);t.putImageData(n,0,0)}return n!==t&&n.dispose(),l}function HE(t,e,n){let r=Kw(t,"img","draw");if(!(t instanceof vw)){const t=r;r=rT(t,"int32"),t.dispose()}WE(r),function(t){const e=(null==t?void 0:t.alpha)||1;if(e>1||e<0)throw new Error(`Alpha value ${e} is suppoed to be in range [0 - 1].`)}(null==n?void 0:n.imageOptions);const i={image:r},s={canvas:e,options:n};Uw.runKernel(nv,i,s)}const YE=Qw({fromPixels_:VE});function jE(t,e){const n=t.shape.length,r=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==e.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${n}`);if(0===mg(t.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const i=e.shape,s=i[i.length-1];let a=1;for(let t=0;t<i.length-1;++t)a*=i[t];const o=t.shape,l=i.slice();l.pop();let h=1;for(let t=s;t<n;++t)h*=o[t],l.push(o[t]);const u=[...Vg(t.shape).map((t=>t/h)),1].slice(0,s);return[l,a,h,u]}function qE(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(s+` update.rank < ${i}. `);if(t.length<r+(n.rank-i))throw new Error(s+` Output shape length < ${r+(n.rank-i)}`);if(n.rank!==i+t.length-r)throw new Error(s+" update.rank != "+(i+t.length-r));for(let t=0;t<i;++t)if(n.shape[t]!==e.shape[t])throw new Error(s+` updates.shape[${t}] (${n.shape[t]}) != indices.shape[${t}] (${e.shape[t]}).`);for(let e=0;e<n.rank-i;++e)if(n.shape[e+i]!==t[e+r])throw new Error(s+` updates.shape[${e+i}] (${n.shape[e+i]}) != shape[${e+i}] (${t[e+i]})`)}function KE(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}qE(n,e,t)}function ZE(t,e,n){const r=e.shape.length,i=r>1?e.shape[r-1]:1,s=n.length;let a=1;for(let t=i;t<s;++t)a*=n[t];const o=i<1?1:i;return{sliceRank:i,numUpdates:mg(e.shape)/o,sliceSize:a,strides:[...Vg(n.slice(0,i)),1],outputSize:mg(n)}}function JE(t,e,n){const r=t.shape.length;dg(r===e.length,(()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`)),dg(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let i=0;i<r;++i)dg(e[i]+n[i]<=t.shape[i],(()=>`Error in slice${r}D: begin[${i}] + size[${i}] (${e[i]+n[i]}) would overflow input.shape[${i}] (${t.shape[i]})`))}function QE(t){const e=[];let n=0;for(;t>0;)1&t&&e.push(n),t/=2,n++;return e}function tS(t,e,n){const r=[];for(let i=0;i<t.length;i++)r[i]=Math.ceil((e[i]-t[i])/n[i]);return r}function eS(t,e,n,r){const i=[...t];for(let t=i.length;t<r.length;t++)i.push(1);for(let t=0;t<n;t++)0===t?i[e]=1:(i.splice(e,0,1),i.pop());return i}function nS(t,e,n){return n<=t?n:n-(e-1)}function rS(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function iS(t,e,n,r,i,s,a,o,l){const h=t.length;let u=new Array(h),c=new Array(h),d=new Array(h);if(e.length&&n>0){const l=e[0],h=n+1;u=sS(a,l,h,r,t),c=aS(o,l,h,i,t),d=eS(s,l,h,t)}else for(let e=0;e<h;e++)u[e]=lS(a,r,s,t,e,l),c[e]=hS(o,i,s,t,e,l),d[e]=oS(s,e,l);return{begin:u,end:c,strides:d}}function sS(t,e,n,r,i){const s=[...i],a=rS(n,e);for(let i=0;i<s.length;i++)if(a.indexOf(i)>-1)s[i]=0;else{const a=nS(e,n,i);let o=r[a];t&1<<a&&(o=0),s[i]=o}return s}function aS(t,e,n,r,i){const s=[...i],a=rS(n,e);for(let i=0;i<s.length;i++)if(a.indexOf(i)>-1)s[i]=Number.MAX_SAFE_INTEGER;else{const a=nS(e,n,i);let o=r[a];t&1<<a&&(o=Number.MAX_SAFE_INTEGER),s[i]=o}for(let t=0;t<s.length;t++){const e=i[t];s[t]<0&&(s[t]+=e),s[t]=ag(0,s[t],i[t])}return s}function oS(t,e,n){let r=t[e];return(n&1<<e||null==r)&&(r=1),r}function lS(t,e,n,r,i,s){let a=e[i];const o=n[i]||1;(t&1<<i||s&1<<i||null==a)&&(a=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const l=r[i];return a<0&&(a+=l),a=ag(0,a,l-1),a}function hS(t,e,n,r,i,s){let a=e[i];const o=n[i]||1;(t&1<<i||s&1<<i||null==a)&&(a=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const l=r[i];return a<0&&(a+=l),a=o>0?ag(0,a,l):ag(-1,a,l-1),a}function uS(t,e,n){let r=n.length;for(let t=0;t<n.length;t++)if(n[t]>1){r=t;break}for(let i=r+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function cS(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function dS(t,e,n){let r;const i=t.shape.length;let s;return r="number"==typeof e?[e,...new Array(i-1).fill(0)]:e.length<i?e.concat(new Array(i-e.length).fill(0)):e.slice(),r.forEach((t=>{dg(-1!==t,(()=>"slice() does not support negative begin indexing."))})),s=null==n?new Array(i).fill(-1):"number"==typeof n?[n,...new Array(i-1).fill(-1)]:n.length<i?n.concat(new Array(i-n.length).fill(-1)):n,s=s.map(((e,n)=>e>=0?e:(dg(-1===e,(()=>`Negative size values should be exactly -1 but got ${e} for the slice() size at index ${n}.`)),t.shape[n]-r[n]))),[r,s]}function pS(t,e,n,r,i,s,a,o,l){let h;if(null==r?(h=new Array(e.length),h.fill(1)):h=r,null!=a&&0!=(a&a-1))throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const c={dims:h.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:h.slice(),beginMask:i,endMask:s,ellipsisMask:a,newAxisMask:o,shrinkAxisMask:l};for(let t=0;t<c.dims;t++)u&&0!=(1<<t&o)&&c.numAddAxisAfterEllipsis++,1<<t&a&&(u=!0);u||(c.ellipsisMask|=1<<c.dims,c.dims++);const d={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=null!=t.begin,e.endValid=null!=t.end,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<t.dims;r++)if(1<<r&t.ellipsisMask){const i=Math.min(e.dims-(t.dims-r)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<i;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&t.newAxisMask)e.finalShapeGatherIndices.push(-2),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);null!=t.begin&&(e.begin[n]=t.begin[r]),null!=t.end&&(e.end[n]=t.end[r]),e.strides[n]=t.strides[r],t.beginMask&1<<r&&(e.beginMask|=1<<n),t.endMask&1<<r&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(-1),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[n]=r,n++}}(c,d);let p=!0,f=!0,m=!0;const g=[],y=[];for(let e=0;e<t.length;++e){if(0===d.strides[e])throw Error(`strides[${e}] must be non-zero`);const n=!!(d.shrinkAxisMask&1<<e),r=t[e];if(-1===r){g.push(n?1:-1);continue}const i=[d.beginMask&1<<e,d.endMask&1<<e],s=[d.strides[e]>0?0:-1,d.strides[e]>0?r:r-1];if(n&&d.strides[e]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===d.strides[e];const a=!!(d.beginMask&1<<e&&d.endMask&1<<e);if(d.beginValid&&d.endValid){if(n){const t=d.begin[e]<0?r+d.begin[e]:d.begin[e];if(d.begin[e]=t,d.end[e]=d.begin[e]+1,t<0||t>=r)throw Error(`slice index ${d.begin[e]} of dimension ${e} out of bounds.`)}else d.begin[e]=fS(d.begin[e],0,d.strides[e],r,i,s),d.end[e]=fS(d.end[e],1,d.strides[e],r,i,s);const t=1===d.strides[e]&&0===d.begin[e]&&d.end[e]===r;p=p&&t,f=f&&(0===e&&1===d.strides[e]||t)}else p=p&&1===d.strides[e]&&a,f=f&&(0===e&&1===d.strides[e]||a);let o,l=!1;if(d.beginValid&&d.endValid?(o=d.end[e]-d.begin[e],l=!0):n?(o=1,l=!0):a&&r>=0&&(o=d.strides[e]<0?-r:r,l=!0),l){let t;t=0===o||o<0!=d.strides[e]<0?0:Math.trunc(o/d.strides[e])+(o%d.strides[e]!=0?1:0),g.push(t)}else g.push(-1)}for(let t=0;t<d.finalShapeGatherIndices.length;++t){const e=d.finalShapeGatherIndices[t];e>=0?y.push(g[e]):-2===e&&y.push(1)}const v=y.filter(((t,e)=>-2!==d.finalShapeGatherIndices[e]));return{finalShapeSparse:v,finalShape:y,isIdentity:p,sliceDim0:f,isSimpleSlice:m,begin:d.begin,end:d.end,strides:d.strides}}function fS(t,e,n,r,i,s){if(i[e])return n>0?s[e]:s[e+1&1];{const e=t<0?r+t:t;return e<s[0]?s[0]:e>s[1]?s[1]:e}}const mS=.1;function gS(t,e,n){return null==n&&(n=yS()),vS(t,e,((t,e)=>_S(t,e,n)))}function yS(){return 32===Uw.backend.floatPrecision()?.001:mS}function vS(t,e,n){let r=!0;if((iw(t)||iw(e))&&(r=!1),iw(t)&&iw(e)&&(r=!0),r){const n=t.constructor.name,r=e.constructor.name;if(n!==r)throw new Error(`Arrays are of different type. Actual: ${n}. Expected: ${r}`)}if(Array.isArray(t)&&Array.isArray(e)){const n=Yw(t),r=Yw(e);if(!vg(n,r))throw new Error(`Arrays have different shapes. Actual: [${n}]. Expected: [${r}]`)}const i=iw(t)?t:sw(t),s=iw(e)?e:sw(e);if(i.length!==s.length)throw new Error(`Arrays have different lengths actual: ${i.length} vs expected: ${s.length}.\nActual:   ${i}.\nExpected: ${s}.`);for(let t=0;t<s.length;++t){const e=i[t],r=s[t];if(!n(e,r))throw new Error(`Arrays differ: actual[${t}] = ${e}, expected[${t}] = ${r}.\nActual:   ${i}.\nExpected: ${s}.`)}"undefined"!=typeof expect&&expect().nothing()}function xS(t,e){t().then((()=>e.fail()),(()=>e())),"undefined"!=typeof expect&&expect().nothing()}function bS(t,e){const n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return Dg(t)||Dg(t[0])||Dg(e)||Dg(e[0])?vS(t,n,((t,e)=>t==e)):vS(t,e,((t,e)=>_S(t,e,0)))}function wS(t,e,n){if(null==n&&(n=yS()),!_S(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`);"undefined"!=typeof expect&&expect().nothing()}function _S(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}function TS(t,e,n){for(let r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error(`Value out of range:${t[r]} low: ${e}, high: ${n}`)}function ES(t,e){const n=new Float32Array(t),r=new Float32Array(e);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let t=0;t<r.length;t++)if(n[t]!==r[t])throw new Error(`Expected ArrayBuffer value at ${t} to be ${r[t]} but got ${n[t]} instead`)}function SS(t){for(let e=0;e<t.length;e++){const n=t[e];Array.isArray(n)?SS(n):t[e]=nw(n)}return t}function IS(t){const e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(t),new Promise((t=>{e.addEventListener("loadeddata",(n=>t(e))),e.load()}))}async function kS(t){await t.play(),"requestVideoFrameCallback"in t&&await new Promise((e=>{t.requestVideoFrameCallback(e)}))}const CS="4.8.0";class NS{static sgd(t){return new oE(t)}static momentum(t,e,n=!1){return new lE(t,e,n)}static rmsprop(t,e=.9,n=0,r=null,i=!1){return new hE(t,e,n,r,i)}static adam(t=.001,e=.9,n=.999,r=null){return new tE(t,e,n,r)}static adadelta(t=.001,e=.95,n=null){return new qT(t,e,n)}static adamax(t=.002,e=.9,n=.999,r=null,i=0){return new aE(t,e,n,r,i)}static adagrad(t,e=.1){return new ZT(t,e)}}const AS=Qw({acos_:function(t){const e={x:Kw(t,"x","acos")};return Uw.runKernel(oy,e)}});const RS=Qw({acosh_:function(t){const e={x:Kw(t,"x","acosh")};return Uw.runKernel(ly,e)}});const MS=Qw({addN_:function(t){dg(Array.isArray(t),(()=>"The argument passed to tf.addN() must be a list of tensors")),dg(t.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`));const e=t.map(((t,e)=>Kw(t,`tensors${e}`,"addN"))),n=e[0];e.forEach((t=>{if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((t=>{if(!vg(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=e;return Uw.runKernel(uy,r)}});const OS=Qw({all_:function(t,e=null,n=!1){const r={x:Kw(t,"x","all","bool")},i={axis:e,keepDims:n};return Uw.runKernel(cy,r,i)}});const PS=Qw({any_:function(t,e=null,n=!1){const r={x:Kw(t,"x","any","bool")},i={axis:e,keepDims:n};return Uw.runKernel(dy,r,i)}});const DS=Qw({argMax_:function(t,e=0){const n={x:Kw(t,"x","argMax")},r={axis:e};return Uw.runKernel(py,n,r)}});const FS=Qw({argMin_:function(t,e=0){const n={x:Kw(t,"x","argMin")},r={axis:e};return Uw.runKernel(fy,n,r)}});const LS=Qw({asin_:function(t){const e={x:Kw(t,"x","asin")};return Uw.runKernel(my,e)}});const BS=Qw({asinh_:function(t){const e={x:Kw(t,"x","asinh")};return Uw.runKernel(gy,e)}});const $S=Qw({atan_:function(t){const e={x:Kw(t,"x","atan")};return Uw.runKernel(yy,e)}});const US=Qw({atan2_:function(t,e){let n=Kw(t,"a","atan2"),r=Kw(e,"b","atan2");[n,r]=Rw(n,r);const i={a:n,b:r};return Uw.runKernel(xy,i)}});const VS=Qw({atanh_:function(t){const e={x:Kw(t,"x","atanh")};return Uw.runKernel(vy,e)}});function zS(t,e,n,r,i="NHWC",s){return XS(t,[...e,t[3]],n,s,r,null,null,eI(i))}function GS(t,e,n,r,i,s,a="channelsLast"){const[o,l]=jS(e);let h;if("channelsLast"===a)h=[o,l,t[3],t[3]];else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);h=[o,l,t[1],t[1]]}return XS(t,h,n,r,i,s,!1,a)}function WS(t,e,n,r,i,s,a="NDHWC"){const[o,l,h]=qS(e);let u,c;if("NDHWC"===a)c="channelsLast",u=[o,l,h,t[4],t[4]];else{if("NCDHW"!==a)throw new Error(`Unknown dataFormat ${a}`);c="channelsFirst",u=[o,l,h,t[1],t[1]]}return HS(t,u,n,r,i,!1,c,s)}function XS(t,e,n,r,i,s,a=!1,o="channelsLast"){let[l,h,u,c]=[-1,-1,-1,-1];if("channelsLast"===o)[l,h,u,c]=t;else{if("channelsFirst"!==o)throw new Error(`Unknown dataFormat ${o}`);[l,c,h,u]=t}const[d,p,,f]=e,[m,g]=jS(n),[y,v]=jS(r),x=KS(d,y),b=KS(p,v),{padInfo:w,outHeight:_,outWidth:T}=function(t,e,n,r,i,s,a,o,l){let h,u,c;if("number"==typeof t){h={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const i=function(t,e,n,r,i){null==r&&(r=YS(t,e,n));const s=t[0],a=t[1],o=ZS((s-e+2*r)/n+1,i),l=ZS((a-e+2*r)/n+1,i);return[o,l]}([e,n],s,r,t,o);u=i[0],c=i[1]}else if("same"===t){u=Math.ceil(e/r),c=Math.ceil(n/i);const t=Math.max(0,(u-1)*r+s-e),o=Math.max(0,(c-1)*i+a-n),l=Math.floor(t/2),d=t-l,p=Math.floor(o/2);h={top:l,bottom:d,left:p,right:o-p,type:"SAME"}}else if("valid"===t)h={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-s+1)/r),c=Math.ceil((n-a+1)/i);else{if("object"!=typeof t)throw Error(`Unknown padding parameter: ${t}`);{const d="channelsLast"===l?t[1][0]:t[2][0],p="channelsLast"===l?t[1][1]:t[2][1],f="channelsLast"===l?t[2][0]:t[3][0],m="channelsLast"===l?t[2][1]:t[3][1];h={top:d,bottom:p,left:f,right:m,type:0===d&&0===p&&0===f&&0===m?"VALID":"EXPLICIT"},u=ZS((e-s+d+p)/r+1,o),c=ZS((n-a+f+m)/i+1,o)}}return{padInfo:h,outHeight:u,outWidth:c}}(i,h,u,m,g,x,b,s,o),E=a?f*c:f;let S;return"channelsFirst"===o?S=[l,E,_,T]:"channelsLast"===o&&(S=[l,_,T,E]),{batchSize:l,dataFormat:o,inHeight:h,inWidth:u,inChannels:c,outHeight:_,outWidth:T,outChannels:E,padInfo:w,strideHeight:m,strideWidth:g,filterHeight:d,filterWidth:p,effectiveFilterHeight:x,effectiveFilterWidth:b,dilationHeight:y,dilationWidth:v,inShape:t,outShape:S,filterShape:e}}function HS(t,e,n,r,i,s=!1,a="channelsLast",o){let[l,h,u,c,d]=[-1,-1,-1,-1,-1];if("channelsLast"===a)[l,h,u,c,d]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[l,d,h,u,c]=t}const[p,f,m,,g]=e,[y,v,x]=qS(n),[b,w,_]=qS(r),T=KS(p,b),E=KS(f,w),S=KS(m,_),{padInfo:I,outDepth:k,outHeight:C,outWidth:N}=function(t,e,n,r,i,s,a,o,l,h,u){let c,d,p,f;"valid"===t&&(t=0);if("number"==typeof t){c={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};const m=function(t,e,n,r,i,s){null==i&&(i=YS(t,e[0],r[0]));const a=[0,0,0,n];for(let n=0;n<3;n++)t[n]+2*i>=e[n]&&(a[n]=ZS((t[n]-e[n]+2*i)/r[n]+1,s));return a}([e,n,r,1],[o,l,h],1,[i,s,a],t,u);d=m[0],p=m[1],f=m[2]}else{if("same"!==t)throw Error(`Unknown padding parameter: ${t}`);{d=Math.ceil(e/i),p=Math.ceil(n/s),f=Math.ceil(r/a);const t=(d-1)*i+o-e,u=(p-1)*s+l-n,m=(f-1)*a+h-r,g=Math.floor(t/2),y=t-g,v=Math.floor(u/2),x=u-v,b=Math.floor(m/2);c={top:v,bottom:x,left:b,right:m-b,front:g,back:y,type:"SAME"}}}return{padInfo:c,outDepth:d,outHeight:p,outWidth:f}}(i,h,u,c,y,v,x,T,E,S,o),A=s?g*d:g;let R;return"channelsFirst"===a?R=[l,A,k,C,N]:"channelsLast"===a&&(R=[l,k,C,N,A]),{batchSize:l,dataFormat:a,inDepth:h,inHeight:u,inWidth:c,inChannels:d,outDepth:k,outHeight:C,outWidth:N,outChannels:A,padInfo:I,strideDepth:y,strideHeight:v,strideWidth:x,filterDepth:p,filterHeight:f,filterWidth:m,effectiveFilterDepth:T,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationDepth:b,dilationHeight:w,dilationWidth:_,inShape:t,outShape:R,filterShape:e}}function YS(t,e,n,r=1){const i=KS(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)}function jS(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function qS(t){return"number"==typeof t?[t,t,t]:t}function KS(t,e){return e<=1?t:t+(t-1)*(e-1)}function ZS(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function JS(t){const[e,n,r]=jS(t);return 1===e&&1===n&&1===r}function QS(t,e){return JS(t)||JS(e)}function tI(t){return jS(t).every((t=>t>0))}function eI(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function nI(t,e,n){if(null!=n){if("string"==typeof e)throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if("number"==typeof e)dg(xg(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`));else{if("object"!=typeof e)throw Error(`Error in ${t}: Unknown padding parameter: ${e}`);e.forEach((e=>{e.forEach((e=>{dg(xg(e),(()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`))}))}))}}}const rI=Qw({reshape_:function(t,e){const n={x:Kw(t,"x","reshape","string_or_numeric")},r={shape:e};return Uw.runKernel(Tx,n,r)}});const iI=Qw({avgPool_:function(t,e,n,r,i){const s=Kw(t,"x","avgPool","float32");dg(QS(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let a=s,o=!1;3===s.rank&&(o=!0,a=rI(s,[1,s.shape[0],s.shape[1],s.shape[2]])),dg(4===a.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`)),nI("avgPool",r,i);const l={x:a},h={filterSize:e,strides:n,pad:r,dimRoundingMode:i};let u=Uw.runKernel(by,l,h);return u=rT(u,s.dtype),o?rI(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const sI=Qw({avgPool3d_:function(t,e,n,r,i,s="NDHWC"){const a=Kw(t,"x","avgPool3d","float32");let o=a,l=!1;4===a.rank&&(l=!0,o=rI(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),dg(5===o.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${o.rank}.`)),dg("NDHWC"===s,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`)),dg("number"==typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,(()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`)),nI("avgPool3d",r,i);const h={x:o},u={filterSize:e,strides:n,pad:r,dimRoundingMode:i,dataFormat:s};let c=Uw.runKernel(_y,h,u);return c=rT(c,o.dtype),l?rI(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}});const aI=Qw({concat_:function(t,e=0){dg(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=Zw(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return iT(n[0]);const r=n,i={axis:e};return Uw.runKernel(Dy,r,i)}});const oI=Qw({sigmoid_:function(t){const e={x:Kw(t,"x","sigmoid","float32")};return Uw.runKernel(Vx,e)}});const lI=Qw({slice_:function(t,e,n){const r=Kw(t,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const i={x:r},s={begin:e,size:n};return Uw.runKernel(Lx,i,s)}});const hI=Qw({tanh_:function(t){const e={x:Kw(t,"x","tanh","float32")};return Uw.runKernel(lb,e)}});const uI=Qw({basicLSTMCell_:function(t,e,n,r,i,s){const a=Kw(t,"forgetBias","basicLSTMCell"),o=Kw(e,"lstmKernel","basicLSTMCell"),l=Kw(n,"lstmBias","basicLSTMCell"),h=Kw(r,"data","basicLSTMCell"),u=Kw(i,"c","basicLSTMCell"),c=Kw(s,"h","basicLSTMCell"),d=aI([h,c],1),p=RE(d,o),f=kT(p,l),m=f.shape[0],g=f.shape[1]/4,y=[m,g],v=lI(f,[0,0],y),x=lI(f,[0,g],y),b=lI(f,[0,2*g],y),w=lI(f,[0,3*g],y),_=kT(AT(oI(v),hI(x)),AT(u,oI(kT(a,b))));return[_,AT(hI(_),oI(w))]}});const cI=Qw({batchToSpaceND_:function(t,e,n){const r=Kw(t,"x","batchToSpaceND"),i=e.reduce(((t,e)=>t*e));dg(r.rank>=1+e.length,(()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`)),dg(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),dg(r.shape[0]%i==0,(()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${i}`));const s={x:r},a={blockShape:e,crops:n};return Uw.runKernel(Sy,s,a)}});const dI=Qw({batchNorm_:function(t,e,n,r,i,s){null==s&&(s=.001);const a=Kw(t,"x","batchNorm"),o=Kw(e,"mean","batchNorm"),l=Kw(n,"variance","batchNorm");let h,u;null!=i&&(h=Kw(i,"scale","batchNorm")),null!=r&&(u=Kw(r,"offset","batchNorm")),dg(o.rank===l.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),dg(null==u||o.rank===u.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),dg(null==h||o.rank===h.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const c=function(t){let e;return e=0===t.rank||1===t.rank?rI(t,[1,1,1,t.size]):2===t.rank?rI(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?rI(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(a),d={x:c,scale:h,offset:u,mean:o,variance:l},p={varianceEpsilon:s},f=Uw.runKernel(yv,d,p);return rI(f,a.shape)}});const pI=Qw({batchNorm2d_:function(t,e,n,r,i,s){const a=Kw(t,"x","batchNorm"),o=Kw(e,"mean","batchNorm"),l=Kw(n,"variance","batchNorm");let h,u;return null!=i&&(h=Kw(i,"scale","batchNorm")),null!=r&&(u=Kw(r,"offset","batchNorm")),dg(2===a.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${a.rank}.`)),dg(2===o.rank||1===o.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${o.rank}.`)),dg(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`)),null!=h&&dg(2===h.rank||1===h.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${h.rank}.`)),null!=u&&dg(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`)),dI(a,o,l,u,h,s)}});const fI=Qw({batchNorm3d_:function(t,e,n,r,i,s){const a=Kw(t,"x","batchNorm"),o=Kw(e,"mean","batchNorm"),l=Kw(n,"variance","batchNorm");let h,u;return null!=i&&(h=Kw(i,"scale","batchNorm")),null!=r&&(u=Kw(r,"offset","batchNorm")),dg(3===a.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${a.rank}.`)),dg(3===o.rank||1===o.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${o.rank}.`)),dg(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`)),null!=h&&dg(3===h.rank||1===h.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${h.rank}.`)),null!=u&&dg(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`)),dI(a,o,l,u,h,s)}});const mI=Qw({batchNorm4d_:function(t,e,n,r,i,s){const a=Kw(t,"x","batchNorm"),o=Kw(e,"mean","batchNorm"),l=Kw(n,"variance","batchNorm");let h,u;return null!=i&&(h=Kw(i,"scale","batchNorm")),null!=r&&(u=Kw(r,"offset","batchNorm")),dg(4===a.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${a.rank}.`)),dg(4===o.rank||1===o.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${o.rank}.`)),dg(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`)),null!=h&&dg(4===h.rank||1===h.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${h.rank}.`)),null!=u&&dg(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`)),dI(a,o,l,u,h,s)}});const gI=Qw({bincount_:function(t,e,n){const r=Kw(t,"x","bincount"),i=Kw(e,"weights","bincount");dg("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),dg(n>=0,(()=>`size must be non-negative, but got ${n}.`)),dg(i.size===r.size||0===i.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${i.shape}.`));const s={x:r,weights:i},a={size:n};return Uw.runKernel(Iy,s,a)}});const yI=Qw({bitwiseAnd_:function(t,e){const n=Kw(t,"x","bitwiseAnd"),r=Kw(e,"y","bitwiseAnd");if(!vg(n.shape,r.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${n.shape}, y: ${r.shape}`);if("int32"!==n.dtype||"int32"!==r.dtype)throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${n.dtype} and type of y: ${r.dtype}`);const i={a:n,b:r};return Uw.runKernel(ky,i)}});const vI=Qw({broadcastArgs_:function(t,e){const n=Kw(t,"s0","broadcastArgs","int32"),r=Kw(e,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const i={s0:n,s1:r};return Uw.runKernel(Ny,i)}});const xI=Qw({broadcastTo_:function(t,e){let n=Kw(t,"broadcastTo","x");const r=n.shape;if(jg(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=rI(n,t)}const i=n.shape,s=Array.from(e);for(let t=e.length-1;t>=0;t--)if(i[t]===e[t])s[t]=1;else if(1!==n.shape[t])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);const a=s.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0));if(0===a.length)return iT(n);const o={x:n},l={reps:s};return Uw.runKernel(hb,o,l)}});const bI=Qw({ceil_:function(t){const e={x:Kw(t,"x","ceil","float32")};return Uw.runKernel(Ry,e)}});const wI=Qw({clipByValue_:function(t,e,n){const r=Kw(t,"x","clipByValue");if(dg(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`)),e===n)return KT(r.shape,e,r.dtype);const i={x:r},s={clipValueMin:e,clipValueMax:n};return Uw.runKernel(My,i,s)}});const _I=Qw({concat1d_:function(t){return aI(t,0)}});const TI=Qw({concat2d_:function(t,e){return aI(t,e)}});const EI=Qw({concat3d_:function(t,e){return aI(t,e)}});const SI=Qw({concat4d_:function(t,e){return aI(t,e)}});const II=Qw({conv2d_:function(t,e,n,r,i="NHWC",s=[1,1],a){const o=Kw(t,"x","conv2d","float32"),l=Kw(e,"filter","conv2d","float32");let h=o,u=!1;3===o.rank&&(u=!0,h=rI(o,[1,o.shape[0],o.shape[1],o.shape[2]])),dg(4===h.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${h.rank}.`)),dg(4===l.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`)),nI("conv2d",r,a);const c="NHWC"===i?h.shape[3]:h.shape[1];dg(c===l.shape[2],(()=>`Error in conv2d: depth of input (${c}) must match input depth for filter ${l.shape[2]}.`)),dg(QS(n,s),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`)),dg(tI(s),(()=>"Error in conv2D: Dilated rates should be larger than 0.")),dg(tI(n),(()=>"Error in conv2D: Strides should be larger than 0."));const d={x:h,filter:l},p={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:a},f=Uw.runKernel(Fy,d,p);return u?rI(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});const kI=Qw({conv1d_:function(t,e,n,r,i="NWC",s=1,a){const o=Kw(t,"x","conv1d"),l=Kw(e,"filter","conv1d");let h=o,u=!1;2===o.rank&&(u=!0,h=rI(o,[1,o.shape[0],o.shape[1]])),dg(3===h.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${h.rank}.`)),dg(3===l.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`)),nI("conv1d",r,a),dg(h.shape[2]===l.shape[1],(()=>`Error in conv1d: depth of input (${h.shape[2]}) must match input depth for filter ${l.shape[1]}.`)),dg(QS(n,s),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${s}'`)),dg(tI(s),(()=>"Error in conv1D: Dilated rates should be larger than 0.")),dg(tI(n),(()=>"Error in conv1D: Stride should be larger than 0.")),dg("NWC"===i,(()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`));const c=rI(l,[1,l.shape[0],l.shape[1],l.shape[2]]),d=rI(h,[h.shape[0],1,h.shape[1],h.shape[2]]),p=II(d,c,[1,n],r,"NHWC",[1,s],a);return rI(p,u?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}});const CI=Qw({conv2DBackpropInput_:function(t,e,n,r,i,s="NHWC",a){dg(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let o=t,l=e,h=!1;3===e.rank&&(h=!0,l=rI(e,[1,e.shape[0],e.shape[1],e.shape[2]]),o=[1,t[0],t[1],t[2]]),dg(4===o.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${o.length}.`)),dg(4===l.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`)),dg(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const u="NHWC"===s?o[3]:o[1],c="NHWC"===s?l.shape[3]:l.shape[1];dg(u===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[2]}.`)),dg(c===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[3]}.`)),nI("conv2dDerInput",i,a);const d={dy:l,filter:n},p={strides:r,pad:i,dataFormat:s,dimRoundingMode:a,inputShape:o},f=Uw.runKernel(By,d,p);return h?rI(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});const NI=Qw({conv2dTranspose_:function(t,e,n,r,i,s){const a=Kw(t,"x","conv2dTranspose"),o=Kw(e,"filter","conv2dTranspose");return CI(n,a,o,r,i,"NHWC",s)}});const AI=Qw({conv3d_:function(t,e,n,r,i="NDHWC",s=[1,1,1]){const a=Kw(t,"x","conv3d"),o=Kw(e,"filter","conv3d");let l=a,h=!1;4===a.rank&&(h=!0,l=rI(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),dg(5===l.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`)),dg(5===o.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${o.rank}.`)),dg(l.shape[4]===o.shape[3],(()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${o.shape[3]}.`)),dg(QS(n,s),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`)),dg("NDHWC"===i,(()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`)),dg(tI(s),(()=>"Error in conv3D: Dilated rates should be larger than 0.")),dg(tI(n),(()=>"Error in conv3D: Strides should be larger than 0."));const u={x:l,filter:o},c={strides:n,pad:r,dataFormat:i,dilations:s},d=Uw.runKernel($y,u,c);return h?rI(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const RI=Qw({conv3DBackpropInput_:function(t,e,n,r,i){dg(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let s=t,a=e,o=!1;4===e.rank&&(o=!0,a=rI(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),s=[1,t[0],t[1],t[2],t[3]]);const l=s[4],h=a.shape[4];dg(5===s.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`)),dg(5===a.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${a.rank}`)),dg(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),dg(l===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`)),dg(h===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[4]}.`));const u={dy:a,filter:n},c={pad:i,strides:r,inputShape:s},d=Uw.runKernel(Vy,u,c);return o?rI(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const MI=Qw({conv3dTranspose_:function(t,e,n,r,i){const s=Kw(t,"x","conv3dTranspose"),a=Kw(e,"filter","conv3dTranspose");return RI(n,s,a,r,i)}});const OI=Qw({cos_:function(t){const e={x:Kw(t,"x","cos","float32")};return Uw.runKernel(zy,e)}});const PI=Qw({cosh_:function(t){const e={x:Kw(t,"x","cosh","float32")};return Uw.runKernel(Gy,e)}});const DI=Qw({cumprod_:function(t,e=0,n=!1,r=!1){const i={x:Kw(t,"x","cumprod")},s={axis:e,exclusive:n,reverse:r};return Uw.runKernel(Wy,i,s)}});const FI=Qw({cumsum_:function(t,e=0,n=!1,r=!1){const i={x:Kw(t,"x","cumsum")},s={axis:e,exclusive:n,reverse:r};return Uw.runKernel(Xy,i,s)}});const LI=Qw({denseBincount_:function(t,e,n,r=!1){const i=Kw(t,"x","denseBincount"),s=Kw(e,"weights","denseBincount");dg("int32"===i.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`)),dg(i.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`)),dg(n>=0,(()=>`size must be non-negative, but got ${n}.`)),dg(s.size===i.size||0===s.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${s.shape}.`));const a={x:i,weights:s},o={size:n,binaryOutput:r};return Uw.runKernel(Yy,a,o)}});const BI=Qw({depthToSpace_:function(t,e,n="NHWC"){const r=Kw(t,"x","depthToSpace","float32"),i="NHWC"===n?r.shape[1]:r.shape[2],s="NHWC"===n?r.shape[2]:r.shape[3],a="NHWC"===n?r.shape[3]:r.shape[1];dg(e>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`)),dg(i*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${i} and ${e}  for depthToSpace with input shape\n    ${r.shape}`)),dg(s*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${e} for depthToSpace with input shape\n        ${r.shape}`)),dg(a%(e*e)==0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${a} for depthToSpace with input shape ${r.shape}`));const o={x:r},l={blockSize:e,dataFormat:n};return Uw.runKernel(jy,o,l)}});const $I=Qw({depthwiseConv2d_:function(t,e,n,r,i="NHWC",s=[1,1],a){const o=Kw(t,"x","depthwiseConv2d","float32"),l=Kw(e,"filter","depthwiseConv2d","float32");let h=o,u=!1;3===o.rank&&(u=!0,h=rI(o,[1,o.shape[0],o.shape[1],o.shape[2]])),dg(4===h.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${h.rank}.`)),dg(4===l.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`));const c="NHWC"===i?h.shape[3]:h.shape[1];dg(c===l.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${c}) must match the inChannels dimension in filter ${l.shape[2]}.`)),nI("depthwiseConv2d",r,a);const d={x:h,filter:l},p={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:a},f=Uw.runKernel(qy,d,p);return u?rI(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});const UI=Qw({diag_:function(t){const e={x:Kw(t,"x","diag")};return Uw.runKernel(Jy,e)}});const VI=Qw({dilation2d_:function(t,e,n,r,i=[1,1],s="NHWC"){const a=Kw(t,"x","dilation2d"),o=Kw(e,"filter","dilation2d");dg(3===a.rank||4===a.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${a.rank}.`)),dg(3===o.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${o.rank}.`)),dg("NHWC"===s,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`));let l=a,h=!1;3===a.rank&&(l=rI(a,[1,a.shape[0],a.shape[1],a.shape[2]]),h=!0),dg(l.shape[3]===o.shape[2],(()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${o.shape[2]}`));const u={x:l,filter:o},c={strides:n,pad:r,dilations:i},d=Uw.runKernel(Qy,u,c);return h?rI(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});const zI=Qw({equal_:function(t,e){let n=Kw(t,"a","equal","string_or_numeric"),r=Kw(e,"b","equal","string_or_numeric");[n,r]=Rw(n,r),iE(n.shape,r.shape);const i={a:n,b:r};return Uw.runKernel(lv,i)}});const GI=Qw({where_:function(t,e,n){const r=Kw(e,"a","where"),i=Kw(n,"b","where"),s=Kw(t,"condition","where","bool"),a=iE(iE(s.shape,r.shape),i.shape),o={condition:xI(s,a),t:xI(r,a),e:xI(i,a)};return Uw.runKernel(Dx,o)}});const WI=Qw({divNoNan_:function(t,e){let n=Kw(t,"a","div"),r=Kw(e,"b","div");[n,r]=Rw(n,r);const i=NT(n,r),s=OT(i),a=zI(r,s);return GI(a,s,i)}});const XI=Qw({dot_:function(t,e){const n=Kw(t,"t1","dot"),r=Kw(e,"t2","dot");dg(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`));const i=1===n.rank?n.size:n.shape[1],s=1===r.rank?r.size:r.shape[0];if(dg(i===s,(()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${s}.`)),1===n.rank&&1===r.rank){const t=rI(n,[1,-1]),e=rI(r,[-1,1]),i=RE(t,e);return rI(i,[])}if(1===n.rank&&2===r.rank){const t=rI(n,[1,-1]),e=rI(r,[r.shape[0],r.shape[1]]),i=RE(t,e);return rI(i,[i.size])}if(2===n.rank&&1===r.rank){const t=rI(r,[-1,1]),e=RE(n,t);return rI(e,[e.size])}{const t=rI(r,[r.shape[0],r.shape[1]]);return RE(n,t)}}});const HI=Qw({einsum_:function(t,...e){const n=e.map(((t,e)=>Kw(t,`tensors${e}`,"einsum"))),r={equation:t};return Uw.runKernel(iv,n,r)}});const YI=Qw({elu_:function(t){const e={x:Kw(t,"x","elu","float32")};return Uw.runKernel(sv,e)}});const jI=Qw({ensureShape_:function(t,e){const n=Kw(t,"x","ensureShape","string_or_numeric");if(!yg(n.shape,e))throw new Error(`EnsureShape: Shape of tensor ${n.shape} is not compatible with expected shape ${e}`);return t}});const qI=Qw({erf_:function(t){let e=Kw(t,"x","erf");dg("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=rT(e,"float32"));const n={x:e};return Uw.runKernel(ov,n)}});function KI(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function ZI(t,e,n){const r=t.length+e.length,i=[];let s=0,a=0;for(let o=0;o<r;o++)-1===n.indexOf(o)?i.push(t[s++]):i.push(e[a++]);return i}function JI(t,e){const n=[],r=t.length;for(let i=0;i<r;i++)-1===e.indexOf(i)&&n.push(t[i]);return[n,e.map((e=>t[e]))]}function QI(t,e){return ZI(t,e.map((t=>1)),e)}function tk(t,e,n){dg(KI(e,n),(()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`))}function ek(t,e){if(KI(t,e))return null;const n=[];for(let r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((t=>n.push(t))),n}function nk(t){return t.map(((t,e)=>[e,t])).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))}function rk(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n}const ik=Qw({max_:function(t,e=null,n=!1){const r={x:Kw(t,"x","max")},i={reductionIndices:e,keepDims:n};return Uw.runKernel(Gv,r,i)}});const sk=Qw({min_:function(t,e=null,n=!1){const r={x:Kw(t,"x","min")},i={axis:e,keepDims:n};return Uw.runKernel(Zv,r,i)}});const ak=Qw({sum_:function(t,e=null,n=!1){let r=Kw(t,"x","sum");"bool"===r.dtype&&(r=rT(r,"int32"));const i={x:r},s={axis:e,keepDims:n};return Uw.runKernel(Wx,i,s)}});function ok(t,e,n=null){if(0===t.rank)return eE(t);if(1!==t.rank&&null===n)return ok(rI(t,[-1]),e,n);if(1===t.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return ak(eE(t),n);if(e===1/0)return ik(eE(t),n);if(e===-1/0)return sk(eE(t),n);if("euclidean"===e||2===e)return RT(ak(JT(eE(t),VT(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return ik(ak(eE(t),n[0]),n[1]-1);if(e===1/0)return ik(ak(eE(t),n[1]),n[0]);if(e===-1/0)return sk(ak(eE(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return RT(ak(MT(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const lk=Qw({norm_:function(t,e="euclidean",n=null,r=!1){const i=ok(t=Kw(t,"x","norm"),e,n);let s=i.shape;if(r){const e=Ig(n,t.shape);s=QI(i.shape,e)}return rI(i,s)}});const hk=Qw({euclideanNorm_:function(t,e=null,n=!1){return lk(t,"euclidean",e,n)}});const uk=Qw({exp_:function(t){const e={x:Kw(t,"x","exp")};return Uw.runKernel(hv,e)}});const ck=Qw({expandDims_:function(t,e=0){const n=Kw(t,"x","expandDims","string_or_numeric");dg(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},i={dim:e};return Uw.runKernel(uv,r,i)}});const dk=Qw({expm1_:function(t){const e={x:Kw(t,"x","expm1")};return Uw.runKernel(cv,e)}});const pk=Qw({tile_:function(t,e){const n=Kw(t,"x","tile","string_or_numeric");dg(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const r={x:n},i={reps:e};return Uw.runKernel(hb,r,i)}});const fk=Qw({eye_:function(t,e,n,r="float32"){null==e&&(e=t);const i=nT([t,e],r),s=t<=e?t:e;for(let t=0;t<s;++t)i.set(1,t,t);const a=rI(i.toTensor(),[t,e]);if(null==n)return a;if(1===n.length)return pk(ck(a,0),[n[0],1,1]);if(2===n.length)return pk(ck(ck(a,0),0),[n[0],n[1],1,1]);if(3===n.length)return pk(ck(ck(ck(a,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});const mk=Qw({floor_:function(t){const e={x:Kw(t,"x","floor","float32")};return Uw.runKernel(mv,e)}});const gk=Qw({gather_:function(t,e,n=0,r=0){const i={x:Kw(t,"x","gather"),indices:Kw(e,"indices","gather","int32")},s={axis:n,batchDims:r};return Uw.runKernel(vv,i,s)}});const yk=Qw({greater_:function(t,e){let n=Kw(t,"a","greater","string_or_numeric"),r=Kw(e,"b","greater","string_or_numeric");[n,r]=Rw(n,r),iE(n.shape,r.shape);const i={a:n,b:r};return Uw.runKernel(bv,i)}});const vk=Qw({greaterEqual_:function(t,e){let n=Kw(t,"a","greaterEqual","string_or_numeric"),r=Kw(e,"b","greaterEqual","string_or_numeric");[n,r]=Rw(n,r),iE(n.shape,r.shape);const i={a:n,b:r};return Uw.runKernel(wv,i)}});const xk=Qw({isFinite_:function(t){const e={x:Kw(t,"x","isFinite")};return Uw.runKernel(Sv,e)}});const bk=Qw({isInf_:function(t){const e={x:Kw(t,"x","isInf")};return Uw.runKernel(Iv,e)}});const wk=Qw({isNaN_:function(t){const e={x:Kw(t,"x","isNaN")};return Uw.runKernel(kv,e)}});const _k=Qw({leakyRelu_:function(t,e=.2){const n={x:Kw(t,"x","leakyRelu")},r={alpha:e};return Uw.runKernel(Cv,n,r)}});const Tk=Qw({less_:function(t,e){let n=Kw(t,"a","less","string_or_numeric"),r=Kw(e,"b","less","string_or_numeric");[n,r]=Rw(n,r),iE(n.shape,r.shape);const i={a:n,b:r};return Uw.runKernel(Nv,i)}});const Ek=Qw({lessEqual_:function(t,e){let n=Kw(t,"a","lessEqual","string_or_numeric"),r=Kw(e,"b","lessEqual","string_or_numeric");[n,r]=Rw(n,r),iE(n.shape,r.shape);const i={a:n,b:r};return Uw.runKernel(Av,i)}});function Sk(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:t,stop:e,num:n};return Uw.runKernel(Rv,{},r)}const Ik=Qw({localResponseNormalization_:function(t,e=5,n=1,r=1,i=.5){const s=Kw(t,"x","localResponseNormalization");dg(4===s.rank||3===s.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${s.rank}.`)),dg(xg(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let a=s,o=!1;3===s.rank&&(o=!0,a=rI(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const l={x:a},h={depthRadius:e,bias:n,alpha:r,beta:i},u=Uw.runKernel(Uv,l,h);return o?rI(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const kk=Qw({log_:function(t){const e={x:Kw(t,"x","log","float32")};return Uw.runKernel(Mv,e)}});const Ck=Qw({log1p_:function(t){const e={x:Kw(t,"x","log1p")};return Uw.runKernel(Ov,e)}});const Nk=Qw({softplus_:function(t){const e={x:Kw(t,"x","softplus")};return Uw.runKernel(zx,e)}});const Ak=Qw({logSigmoid_:function(t){const e=Kw(t,"x","logSigmoid"),n=$T((t=>({value:PE(Nk(PE(t))),gradFunc:e=>AT(e,oI(PE(t)))})));return n(e)}});const Rk=Qw({logSoftmax_:function(t,e=-1){const n=Kw(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);const r=$T(((t,n)=>{const r=ik(t,e,!0),i=QT(t,r),s=QT(rT(i,"float32"),kk(ak(uk(i),e,!0)));n([s]);return{value:s,gradFunc:(t,n)=>{const[r]=n,i=uk(r);return QT(t,AT(ak(t,e,!0),i))}}}));return r(n)}});const Mk=Qw({logSumExp_:function(t,e=null,n=!1){const r=Kw(t,"x","logSumExp"),i=Ig(e,r.shape),s=ik(r,i,!0),a=QT(r,s),o=uk(a),l=ak(o,i),h=kk(l),u=kT(rI(s,h.shape),h);if(n){const t=QI(u.shape,i);return rI(u,t)}return u}});const Ok=Qw({logicalAnd_:function(t,e){const n=Kw(t,"a","logicalAnd","bool"),r=Kw(e,"b","logicalAnd","bool");iE(n.shape,r.shape);const i={a:n,b:r};return Uw.runKernel(Pv,i)}});const Pk=Qw({logicalNot_:function(t){const e={x:Kw(t,"x","logicalNot","bool")};return Uw.runKernel(Dv,e)}});const Dk=Qw({logicalOr_:function(t,e){const n=Kw(t,"a","logicalOr","bool"),r=Kw(e,"b","logicalOr","bool");iE(n.shape,r.shape);const i={a:n,b:r};return Uw.runKernel(Fv,i)}});const Fk=Qw({logicalXor_:function(t,e){const n=Kw(t,"a","logicalXor","bool"),r=Kw(e,"b","logicalXor","bool");return iE(n.shape,r.shape),Ok(Dk(t,e),Pk(Ok(t,e)))}}),Lk=2147483648;const Bk=Qw({searchSorted_:function(t,e,n="left"){const r=Kw(t,"sortedSequence","searchSorted"),i=Kw(e,"values","searchSorted"),s=r.shape[r.shape.length-1],a=i.shape[i.shape.length-1],o=rI(r,[-1,s]),l=rI(i,[-1,a]);if(o.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(o.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(mg(l.shape)>=Lk)throw new Error("values tensor size must less than 2147483648");if(o.shape[1]>=Lk)throw new Error(`trailing dim_size must less than 2147483648 for int32 output type, was ${o.shape[1]}`);const h={sortedSequence:o,values:l},u={side:n};return Uw.runKernel(Px,h,u)}});function $k(t,e){return Bk(t,e,"left")}const Uk=Qw({maxPool_:function(t,e,n,r,i){const s=Kw(t,"x","maxPool");let a=s,o=!1;3===s.rank&&(o=!0,a=rI(s,[1,s.shape[0],s.shape[1],s.shape[2]])),dg(4===a.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`)),dg(QS(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),nI("maxPool",r,i);const l={x:a},h={filterSize:e,strides:n,pad:r,dimRoundingMode:i},u=Uw.runKernel(Xv,l,h);return o?rI(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const Vk=Qw({maxPool3d_:function(t,e=[1,1,1],n,r,i,s="NDHWC"){const a=Kw(t,"x","maxPool3d");let o=a,l=!1;4===a.rank&&(l=!0,o=rI(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),dg(5===o.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${o.rank}.`)),dg("NDHWC"===s,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`)),nI("maxPool3d",r,i);const h={x:o},u={filterSize:e,strides:n,pad:r,dimRoundingMode:i,dataFormat:s},c=Uw.runKernel(Yv,h,u);return l?rI(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}});const zk=Qw({maxPoolWithArgmax_:function(t,e,n,r,i=!1){const s={x:Kw(t,"x","maxPoolWithArgmax")},a={filterSize:e,strides:n,pad:r,includeBatchInIndex:i},o=Uw.runKernel(qv,s,a);return{result:o[0],indexes:o[1]}}});const Gk=Qw({mean_:function(t,e=null,n=!1){const r={x:Kw(t,"x","mean")},i={axis:e,keepDims:n};return Uw.runKernel(Kv,r,i)}});function Wk(t,e="float32"){if(jg(t),"complex64"===e){const e=Wk(t,"float32"),n=Wk(t,"float32");return t_(e,n)}const n=Hg(mg(t),e);return Uw.makeTensor(n,t,e)}function Xk(t,e="float32"){if(jg(t),"complex64"===e){const e=Xk(t,"float32"),n=Wk(t,"float32");return t_(e,n)}const n=Xg(mg(t),e);return Uw.makeTensor(n,t,e)}function Hk(t,e,{indexing:n="xy"}={}){if("xy"!==n&&"ij"!==n)throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(void 0===t)return[];let r=Kw(t,"x","meshgrid",t instanceof vw?t.dtype:"float32");if(void 0===e)return[r];let i=Kw(e,"y","meshgrid",e instanceof vw?e.dtype:"float32");const s=mg(r.shape),a=mg(i.shape);return"xy"===n?(r=rI(r,[1,-1]),i=rI(i,[-1,1]),[RE(Xk([a,1],r.dtype),r),RE(i,Xk([1,s],i.dtype))]):(r=rI(r,[-1,1]),i=rI(i,[1,-1]),[RE(r,Xk([1,a],r.dtype)),RE(Xk([s,1],i.dtype),i)])}const Yk=Qw({minimum_:function(t,e){let n=Kw(t,"a","minimum"),r=Kw(e,"b","minimum");[n,r]=Rw(n,r),"bool"===n.dtype&&(n=rT(n,"int32"),r=rT(r,"int32")),iE(n.shape,r.shape);const i={a:n,b:r};return Uw.runKernel(Jv,i)}});const jk=Qw({mirrorPad_:function(t,e,n){dg("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const r=Kw(t,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");dg(e.length===r.rank,(()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`));const i="reflect"===n?1:0;for(let t=0;t<r.rank;t++)dg(2===e[t].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),dg(e[t][0]>=0&&e[t][0]<=r.shape[t]-i&&e[t][1]>=0&&e[t][1]<=r.shape[t]-i,(()=>`Padding in dimension ${t} cannot be greater than or equal to ${r.shape[t]-i} or less than 0 for input of shape ${r.shape}`));const s={paddings:e,mode:n},a={x:r};return Uw.runKernel(Qv,a,s)}});const qk=Qw({mod_:function(t,e){let n=Kw(t,"a","mod"),r=Kw(e,"b","mod");[n,r]=Rw(n,r);const i={a:n,b:r};return Uw.runKernel(tx,i)}});const Kk=Qw({moments_:function(t,e=null,n=!1){const r=Ig(e,(t=Kw(t,"x","moments")).shape),i=Gk(t,r,n);let s=i.shape;n||(s=QI(i.shape,r));const a=MT(QT(rT(t,"float32"),rI(i,s)));return{mean:i,variance:Gk(a,r,n)}}});const Zk=Qw({multiRNNCell_:function(t,e,n,r){const i=Kw(e,"data","multiRNNCell"),s=Zw(n,"c","multiRNNCell"),a=Zw(r,"h","multiRNNCell");let o=i;const l=[];for(let e=0;e<t.length;e++){const n=t[e](o,s[e],a[e]);l.push(n[0]),l.push(n[1]),o=n[1]}const h=[],u=[];for(let t=0;t<l.length;t+=2)h.push(l[t]),u.push(l[t+1]);return[h,u]}});const Jk=Qw({multinomial_:function(t,e,n,r=!1){const i=Kw(t,"logits","multinomial"),s=i.size,a=i.rank;if(s<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${s}.`);if(a>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${a}`);n=n||Math.random();const o={logits:1===a?rI(i,[1,-1]):i},l={numSamples:e,seed:n,normalized:r},h=Uw.runKernel(ex,o,l);return 1===a?rI(h,[h.size]):h}});const Qk=Qw({notEqual_:function(t,e){let n=Kw(t,"a","notEqual","string_or_numeric"),r=Kw(e,"b","notEqual","string_or_numeric");[n,r]=Rw(n,r),iE(n.shape,r.shape);const i={a:n,b:r};return Uw.runKernel(ix,i)}});const tC=Qw({onesLike_:function(t){const e={x:Kw(t,"x","onesLike")};return Uw.runKernel(lx,e)}});const eC=Qw({outerProduct_:function(t,e){const n=Kw(t,"v1","outerProduct"),r=Kw(e,"v2","outerProduct");dg(1===n.rank&&1===r.rank,(()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`));const i=rI(n,[-1,1]),s=rI(r,[1,-1]);return RE(i,s)}});const nC=Qw({pad_:function(t,e,n=0){const r=Kw(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:e,constantValue:n},s={x:r};return Uw.runKernel(cx,s,i)}});const rC=Qw({pad1d_:function(t,e,n=0){return dg(2===e.length,(()=>"Invalid number of paddings. Must be length of 2.")),nC(t,[e],n)}});const iC=Qw({pad2d_:function(t,e,n=0){return dg(2===e.length&&2===e[0].length&&2===e[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),nC(t,e,n)}});const sC=Qw({pad3d_:function(t,e,n=0){return dg(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),nC(t,e,n)}});const aC=Qw({pad4d_:function(t,e,n=0){return dg(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),nC(t,e,n)}});const oC=Qw({spaceToBatchND_:function(t,e,n){const r=Kw(t,"x","spaceToBatchND");dg(r.rank>=1+e.length,(()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`)),dg(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),dg(r.shape.reduce(((t,r,i)=>i>0&&i<=e.length?t&&(r+n[i-1][0]+n[i-1][1])%e[i-1]==0:t),!0),(()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const i={x:r},s={blockShape:e,paddings:n};return Uw.runKernel(Xx,i,s)}});const lC=Qw({pool_:function(t,e,n,r,i,s,a){null==i&&(i=[1,1]),null==s&&(s=1),0===r&&(r="valid");const o=Kw(t,"x","maxPool");let l=o,h=!1;3===o.rank&&(h=!0,l=rI(o,[1,o.shape[0],o.shape[1],o.shape[2]])),dg(QS(s,i),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${i}'`));const u=GS(l.shape,e,s,i,r),c=[u.dilationHeight,u.dilationWidth];let d;d="same"===r?function(t,e){const n=t.map(((t,n)=>t+(t-1)*(e[n]-1))),r=n.map((t=>t-1)),i=r.map((t=>Math.floor(t/2))),s=r.map(((t,e)=>t-i[e]));return r.map(((t,e)=>[i[e],s[e]]))}([u.filterHeight,u.filterWidth],c):[[0,0],[0,0]];const p=1===c[0]&&1===c[1],[f,m]=function(t,e,n){const r=n.map((t=>t[0])),i=n.map((t=>t[1])),s=t.concat(r,i),a=e.map(((t,e)=>(t-s[e]%t)%t)),o=i.map(((t,e)=>t+a[e])),l=e.map(((t,e)=>[r[e],o[e]])),h=e.map(((t,e)=>[0,a[e]]));return[l,h]}([u.inHeight,u.inWidth],c,d),g=p?r:"valid",y=p?l:oC(l,c,f),v=("avg"===n?()=>iI(y,e,s,g,a):()=>Uk(y,e,s,g,a))(),x=p?v:cI(v,c,m);return h?rI(x,[x.shape[1],x.shape[2],x.shape[3]]):x}});const hC=Qw({prelu_:function(t,e){const n={x:Kw(t,"x","prelu"),alpha:Kw(e,"alpha","prelu")};return Uw.runKernel(fx,n)}});const uC=Qw({prod_:function(t,e=null,n=!1){let r=Kw(t,"x","prod");"bool"===r.dtype&&(r=rT(r,"int32"));const i={x:r},s={axis:e,keepDims:n};return Uw.runKernel(mx,i,s)}});const cC=Qw({raggedGather_:function(t,e,n,r){const i=t.map(((t,e)=>Kw(t,`tensors${e}`,"raggedGather","int32"))),s={paramsNestedSplits:i,paramsDenseValues:Kw(e,"paramsDenseValues","raggedGather"),indices:Kw(n,"indices","raggedGather","int32")},a={outputRaggedRank:r},o=Uw.runKernel(gx,s,a);return{outputNestedSplits:o.slice(0,o.length-1),outputDenseValues:o[o.length-1]}}});const dC=Qw({raggedRange_:function(t,e,n){const r=Kw(t,"starts","raggedRange"),i={starts:r,limits:Kw(e,"limits","raggedRange",r.dtype),deltas:Kw(n,"deltas","raggedRange",r.dtype)},s=Uw.runKernel(yx,i);return{rtNestedSplits:s[0],rtDenseValues:s[1]}}});const pC=Qw({raggedTensorToTensor_:function(t,e,n,r,i){const s=Kw(t,"shape","raggedTensorToTensor","int32"),a=Kw(e,"values","raggedTensorToTensor"),o=Kw(n,"defaultValue","raggedTensorToTensor",a.dtype),l=r.map(((t,e)=>Kw(t,`tensors${e}`,"raggedTensorToTensor","int32"))),h={shape:s,values:a,defaultValue:o,rowPartitionTensors:l},u={rowPartitionTypes:i};return Uw.runKernel(vx,h,u)}});const fC=Qw({rand_:function(t,e,n){jg(t);const r=mg(t);let i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error(`Unknown data type ${n}`);i=new Uint8Array(r)}for(let t=0;t<r;t++)i[t]=e();return Uw.makeTensor(i,t,n)}});var mC=n(377);class gC{constructor(t,e,n,r,i){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const s=i||Math.random();this.random=mC.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let r,i,s;do{r=2*this.random()-1,i=2*this.random()-1,s=r*r+i*i}while(s>=1||0===s);const a=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*r*a,e=this.mean+this.stdDev*i*a,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class yC{constructor(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;const i=r||Math.random();this.randu=mC.alea(i.toString()),this.randn=new gC(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,n,r,i,s;for(;;){do{r=this.randn.nextValue(),s=1+this.c*r}while(s<=0);if(s*=s*s,t=r*r,e=1-.331*t*t,n=.5*t+this.d*(1-s+Math.log(s)),i=this.randu(),i<e||Math.log(i)<n)break}return s=1/this.beta*this.d*s,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)}convertValue(t){return"float32"===this.dtype?t:Math.round(t)}}class vC{constructor(t=0,e=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=mC.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}const xC=Qw({randomGamma_:function(t,e,n=1,r="float32",i){if(jg(t),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error(`Unsupported data type ${r}`);const s=new yC(e,n,r,i),a=nT(t,r);for(let t=0;t<a.values.length;t++)a.values[t]=s.nextValue();return a.toTensor()}});const bC=Qw({randomNormal_:function(t,e=0,n=1,r,i){if(jg(t),null!=r&&"bool"===r)throw new Error(`Unsupported data type ${r}`);const s=new gC(e,n,r,!1,i),a=nT(t,r);for(let t=0;t<a.values.length;t++)a.values[t]=s.nextValue();return a.toTensor()}});const wC=Qw({randomStandardNormal_:function(t,e,n){if(null!=e&&"bool"===e)throw new Error(`Unsupported data type ${e}`);return bC(t,0,1,e,n)}});const _C=Qw({randomUniform_:function(t,e=0,n=1,r="float32",i){jg(t);const s=nT(t,r),a=new vC(e,n,null,i);for(let t=0;t<s.values.length;t++)s.values[t]=a.nextValue();return s.toTensor()}});const TC=Qw({randomUniformInt_:function(t,e,n,r){return _C(t,e,n,"int32",r)}});function EC(t,e,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const i={start:t,stop:e,step:n,dtype:r};return Uw.runKernel(xx,{},i)}const SC=Qw({reciprocal_:function(t){const e={x:Kw(t,"x","reciprocal")};return Uw.runKernel(wx,e)}});const IC=Qw({relu_:function(t){const e={x:Kw(t,"x","relu")};return Uw.runKernel(_x,e)}});const kC=Qw({relu6_:function(t){const e={x:Kw(t,"x","relu6")};return Uw.runKernel(Cx,e)}});const CC=Qw({reverse_:function(t,e){const n={x:Kw(t,"x","reverse")},r={dims:e};return Uw.runKernel(Nx,n,r)}});const NC=Qw({reverse1d_:function(t){const e=Kw(t,"x","reverse");return dg(1===e.rank,(()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`)),CC(e,0)}});const AC=Qw({reverse2d_:function(t,e){const n=Kw(t,"x","reverse");return dg(2===n.rank,(()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`)),CC(n,e)}});const RC=Qw({reverse3d_:function(t,e){const n=Kw(t,"x","reverse");return dg(3===n.rank,(()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`)),CC(n,e)}});const MC=Qw({reverse4d_:function(t,e){const n=Kw(t,"x","reverse");return dg(4===n.rank,(()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`)),CC(n,e)}});const OC=Qw({round_:function(t){const e={x:Kw(t,"x","round")};return Uw.runKernel(Ax,e)}});const PC=Qw({rsqrt_:function(t){const e={x:Kw(t,"x","rsqrt","float32")};return Uw.runKernel(Rx,e)}});const DC=Qw({selu_:function(t){const e={x:Kw(t,"x","selu")};return Uw.runKernel(Fx,e)}});const FC=Qw({separableConv2d_:function(t,e,n,r,i,s=[1,1],a="NHWC"){const o=Kw(t,"x","separableConv2d"),l=Kw(e,"depthwiseFilter","separableConv2d"),h=Kw(n,"pointwiseFilter","separableConv2d");let u=o,c=!1;if(3===o.rank&&(c=!0,u=rI(o,[1,o.shape[0],o.shape[1],o.shape[2]])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");dg(4===u.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`)),dg(4===l.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`)),dg(4===h.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`)),dg(1===h.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${h.shape[0]}.`)),dg(1===h.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${h.shape[1]}.`));const d=l.shape[2],p=l.shape[3];dg(h.shape[2]===d*p,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${d*p}, but got ${h.shape[2]}.`));const f=$I(u,l,r,i,a,s),m=II(f,h,1,"valid",a);return c?rI(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});const LC=async function(t,e){const n=Kw(t,"x","setdiff1d"),r=Kw(e,"y","setdiff1d");dg(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),dg(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),dg(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));const i=await n.data(),s=await r.data(),a=new Set(s);let o=0;for(let t=0;t<i.length;t++)a.has(i[t])||o++;const l=new fw([o],n.dtype),h=new fw([o],"int32");for(let t=0,e=0;t<i.length;t++)a.has(i[t])||(l.values[e]=i[t],h.values[e]=t,e++);return[l.toTensor(),h.toTensor()]};const BC=Qw({sign_:function(t){const e={x:Kw(t,"x","sign")};return Uw.runKernel(Ux,e)}});const $C=Qw({sin_:function(t){const e={x:Kw(t,"x","sin","float32")};return Uw.runKernel(Bx,e)}});const UC=Qw({sinh_:function(t){const e={x:Kw(t,"x","sinh")};return Uw.runKernel($x,e)}});const VC=Qw({slice1d_:function(t,e,n){const r=Kw(t,"x","slice1d");return dg(1===r.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`)),lI(r,[e],[n])}});const zC=Qw({slice2d_:function(t,e,n){const r=Kw(t,"x","slice2d");return dg(2===r.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`)),lI(r,e,n)}});const GC=Qw({slice3d_:function(t,e,n){const r=Kw(t,"x","slice3d");return dg(3===r.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`)),lI(r,e,n)}});const WC=Qw({slice4d_:function(t,e,n){const r=Kw(t,"x","slice4d");return dg(4===r.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`)),lI(r,e,n)}});const XC=Qw({softmax_:function(t,e=-1){const n=Kw(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const r={logits:n},i={dim:e};return Uw.runKernel(Yx,r,i)}});const HC=Qw({fft_:function(t){dg("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return Uw.runKernel(dv,e)}});const YC=Qw({ifft_:function(t){dg("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return Uw.runKernel(Tv,e)}});const jC=Qw({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const i=rI(t,[n,e]);r=YC(i)}else{const i=[n,2*(e-1)],s=rI(DE(t),[n,e]),a=rI(OE(t),[n,e]),o=CC(lI(s,[0,1],[n,e-2]),1),l=AT(CC(lI(a,[0,1],[n,e-2]),1),VT(-1)),h=aI([s,o],1),u=aI([a,l],1),c=rI(t_(h,u),[i[0],i[1]]);r=YC(c)}if(r=DE(r),3===t.rank&&0!==t.shape[0]){const e=r,n=t.shape[0];r=rI(r,[n,r.shape[0]/n,r.shape[1]]),e.dispose()}return r}});const qC=Qw({split_:function(t,e,n=0){const r={x:Kw(t,"x","split")},i={numOrSizeSplits:e,axis:n};return Uw.runKernel(Hx,r,i)}});const KC=Qw({rfft_:function(t,e){dg("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const r=t.size/n;let i;if(null!=e&&e<n){const r=t.shape.map((t=>0)),s=t.shape.map((t=>t));s[t.shape.length-1]=e,i=lI(t,r,s),n=e}else if(null!=e&&e>n){const r=t.shape.map((t=>t));r[t.shape.length-1]=e-n,i=aI([t,Wk(r)],t.shape.length-1),n=e}else i=t;const s=OT(i),a=rI(t_(i,s),[r,n]),o=HC(a),l=Math.floor(n/2)+1,h=DE(o),u=OE(o),c=qC(h,[l,n-l],h.shape.length-1),d=qC(u,[l,n-l],u.shape.length-1),p=i.shape.slice();return p[i.shape.length-1]=l,rI(t_(c[0],d[0]),p)}});const ZC=Qw({squaredDifference_:function(t,e){let n=Kw(t,"a","squaredDifference"),r=Kw(e,"b","squaredDifference");[n,r]=Rw(n,r),iE(n.shape,r.shape);const i={a:n,b:r};return Uw.runKernel(Qx,i,{})}});const JC=Qw({squeeze_:function(t,e){const n=Kw(t,"x","squeeze","string_or_numeric");return rI(n,kg(n.shape,e).newShape)}});const QC=Qw({stack_:function(t,e=0){const n=Zw(t,"tensors","stack","string_or_numeric");dg(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&dg(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,i={axis:e};return Uw.runKernel(ux,r,i)}});const tN=Qw({step_:function(t,e=0){const n={x:Kw(t,"x","step")},r={alpha:e};return Uw.runKernel(vb,n,r)}});const eN=Qw({stridedSlice_:function(t,e,n,r,i=0,s=0,a=0,o=0,l=0){const h={x:Kw(t,"x","stridedSlice","string_or_numeric")},u={begin:e,end:n,strides:r,beginMask:i,endMask:s,ellipsisMask:a,newAxisMask:o,shrinkAxisMask:l};return Uw.runKernel(nb,h,u)}});const nN=Qw({tan_:function(t){const e={x:Kw(t,"x","tan","float32")};return Uw.runKernel(ob,e)}});function rN(t,e){fg(t);const n=Yw(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return e_(t,null,n,e)}function iN(t,e,n){if(fg(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const r=Yw(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return e_(t,e,r,n)}function sN(t,e,n){if(fg(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");const r=Yw(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return e_(t,e,r,n)}function aN(t,e,n){if(fg(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");const r=Yw(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return e_(t,e,r,n)}function oN(t,e,n){if(fg(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");const r=Yw(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e_(t,e=e||r,r,n)}const lN=Qw({tensorScatterUpdate_:function(t,e,n){const r=Kw(t,"tensor","tensorScatterupdate"),i=Kw(e,"indices","tensorScatterupdate","int32"),s=Kw(n,"updates","tensorScatterupdate");if(KE(s,i,r.shape),r.dtype!==s.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${r.dtype} and ${s.dtype}.`);const a={tensor:r,indices:i,updates:s};return Uw.runKernel(Ox,a,{})}});const hN=Qw({topk_:function(t,e=1,n=!0){const r=Kw(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const i=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${e}`);const s={x:r},a={k:e,sorted:n},[o,l]=Uw.runKernel(ub,s,a);return{values:o,indices:l}}});const uN=Qw({truncatedNormal_:function(t,e=0,n=1,r,i){if(jg(t),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const s=new gC(e,n,r,!0,i),a=nT(t,r);for(let t=0;t<a.values.length;t++)a.values[t]=s.nextValue();return a.toTensor()}});const cN=Qw({unique_:function(t,e=0){const n=Kw(t,"x","unique","string_or_numeric");dg(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},i={axis:e},[s,a]=Uw.runKernel(pb,r,i);return{values:s,indices:a}}});const dN=Qw({unsortedSegmentSum_:function(t,e,n){const r=Kw(t,"x","unsortedSegmentSum"),i=Kw(e,"segmentIds","unsortedSegmentSum","int32");dg(xg(n),(()=>"numSegments must be of dtype int"));const s={x:r,segmentIds:i},a={numSegments:n};return Uw.runKernel(mb,s,a)}});const pN=Qw({unstack_:function(t,e=0){const n=Kw(t,"x","unstack","string_or_numeric");dg(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const r={value:n},i={axis:e};return Uw.runKernel(fb,r,i)}});function fN(t,e){return Bk(t,e,"right")}function mN(t,e=!0,n,r){return Uw.makeVariable(t,e,n,r)}function gN(t,e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(t);const r=nT(t,"int32"),i=nT([n.length,t.length],"int32");for(let e=0;e<n.length;e++){const s=r.indexToLoc(n[e]),a=e*t.length;i.values.set(s,a)}return i.toTensor()}const yN=async function(t){const e=Kw(t,"condition","whereAsync","bool"),n=await e.data(),r=gN(e.shape,n);return t!==e&&e.dispose(),r};const vN=async function(t,e,n){const r=Kw(t,"tensor","boolMask"),i=Kw(e,"mask","boolMask","bool"),s=null==n?0:n,a=i.rank,o=r.shape;dg(a>0,(()=>"mask cannot be scalar")),pg(o.slice(s,s+a),i.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let t=s;t<s+a;t++)l*=o[t];const h=o.slice(0,s).concat([l],o.slice(s+a)),u=rI(r,h),c=rI(i,[-1]),d=await yN(c),p=JC(d,[1]),f=gk(u,p,s);return t!==r&&r.dispose(),e!==i&&i.dispose(),p.dispose(),u.dispose(),c.dispose(),d.dispose(),f};const xN=Qw({movingAverage_:function(t,e,n,r,i=!0){const s=Kw(t,"v","movingAverage"),a=Kw(e,"x","movingAverage"),o=Kw(n,"decay","movingAverage");Mw(s,a),dg(vg(s.shape,a.shape),(()=>"Shape mismatch in v and x"));const l=VT(1),h=QT(l,o);let u=AT(QT(a,s),h);if(i){dg(null!=r,(()=>"When using zeroDebias: true, step is required."));const t=Kw(r,"step","movingAverage");u=NT(u,QT(l,JT(o,t)))}return kT(s,u)}});const bN=Qw({scatterND_:function(t,e,n){jg(n);const r=Kw(t,"indices","scatterND","int32"),i=Kw(e,"updates","scatterND");KE(i,r,n);const s={indices:r,updates:i},a={shape:n};return Uw.runKernel(Mx,s,a)}});const wN=Qw({sparseToDense_:function(t,e,n,r=0){jg(n);const i=Kw(t,"sparseIndices","sparseToDense","int32"),s=Kw(e,"sparseValues","sparseToDense","string_or_numeric"),a=Kw(r,"defaultValue","sparseToDense",s.dtype);!function(t,e,n,r){if("int32"!==t.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const i=t.rank>0?t.shape[0]:1,s=t.rank>1?t.shape[1]:1;if(n.length!==s)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${s}.`);const a=e.size;if(0!==e.rank&&(1!==e.rank||a!==i))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${i}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,s,n,a);const o={sparseIndices:i,sparseValues:s,defaultValue:a},l={outputShape:n};return Uw.runKernel(Jx,o,l)}});const _N=Qw({gatherND_:function(t,e){const n=Kw(e,"indices","gatherND","int32"),r={params:Kw(t,"x","gatherND","string_or_numeric"),indices:n};return Uw.runKernel(xv,r)}});const TN=Qw({dropout_:function(t,e,n,r){const i=Kw(t,"x","dropout");if(dg("float32"===i.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`)),dg(e>=0&&e<1,(()=>`rate must be a float in the range [0, 1), but got ${e}.`)),0===e)return t instanceof vw?i.clone():i;const s=function(t,e){if(null==e)return t.shape.slice();if(vg(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(i,n),a=1-e,o=NT(mk(kT(_C(s,0,1,"float32",r),a)),a);return AT(i,o)}});function EN(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function SN(t,e,n){const r=1-t%2,i=new Float32Array(t);for(let s=0;s<t;++s){const a=2*Math.PI*s/(t+r-1);i[s]=e-n*Math.cos(a)}return rN(i,"float32")}const IN=async function(t,e,n=1){const r=Kw(t,"predictions","inTopK"),i=Kw(e,"targets","inTopK");dg(r.rank>1,(()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`)),dg(r.rank-1===i.rank,(()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${i.rank}`)),pg(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const s=r.shape[r.shape.length-1];dg(n>0&&n<=s,(()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${s}), but got ${n}`));const a=await r.data(),o=await i.data(),[l,h]=[a.length/s,s],u=Cg("bool",l);for(let t=0;t<l;t++){const e=t*h,r=a.subarray(e,e+h),i=[];for(let t=0;t<r.length;t++)i.push({value:r[t],index:t});i.sort(((t,e)=>e.value-t.value)),u[t]=0;for(let e=0;e<n;e++)if(i[e].index===o[t]){u[t]=1;break}}return t!==r&&r.dispose(),e!==i&&i.dispose(),n_(u,i.shape,"bool")};const kN=Qw({conv2DBackpropFilter_:function(t,e,n,r,i,s="NHWC",a){let o=t;3===t.rank&&(o=rI(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;3===l.rank&&(l=rI(e,[1,e.shape[0],e.shape[1],e.shape[2]])),dg(4===o.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${o.shape}.`)),dg(4===l.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`)),dg(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const h="NHWC"===s?o.shape[3]:o.shape[1],u="NHWC"===s?l.shape[3]:l.shape[1];dg(h===n[2],(()=>`Error in conv2dDerFilter: depth of input ${h}) must match input depth in filter (${n[2]}.`)),dg(u===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${n[3]}).`)),nI("conv2dDerFilter",i,a);const c={x:o,dy:l},d={strides:r,pad:i,dataFormat:s,dimRoundingMode:a,filterShape:n};return Uw.runKernel(Ly,c,d)}});function CN(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return AT(t,tN(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function NN(t,e){let n=e;const r=rE(t.shape,e.shape);return r.length>0&&(n=ak(n,r)),rI(n,t.shape)}function AN(t,e,n,r){if("linear"===e)return t;if("relu"===e)return IC(t);if("elu"===e)return YI(t);if("relu6"===e)return kC(t);if("prelu"===e)return hC(t,n);if("leakyrelu"===e)return _k(t,r);if("sigmoid"===e)return oI(t);throw new Error(`Unknown fused activation ${e}.`)}const RN=(t,e)=>!(t>0)||"linear"===e;const MN=Qw({fusedConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:a,bias:o,activation:l="linear",preluActivationWeights:h,leakyreluAlpha:u}){if(l=l||"linear",!1===RN(Uw.state.gradientDepth,l)){dg("NHWC"===i,(()=>`Error in fused conv2d: got dataFormat of ${i} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`));let c=II(t,e,n,r,i,s,a);return null!=o&&(c=kT(c,o)),AN(c,l,h,u)}const c=Kw(t,"x","conv2d","float32"),d=Kw(e,"filter","conv2d","float32");let p=c,f=!1;3===c.rank&&(f=!0,p=rI(c,[1,c.shape[0],c.shape[1],c.shape[2]])),dg(4===p.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`)),dg(4===d.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${d.rank}.`)),nI("fused conv2d",r,a);const m="NHWC"===i?p.shape[3]:p.shape[1];dg(d.shape[2]===m,(()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${d.shape[2]}.`)),dg(QS(n,s),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`));const g=XS(p.shape,d.shape,n,s,r,a);let y,v;if(null!=o&&(y=Kw(o,"bias","fused conv2d"),[y]=Rw(y,c),"NHWC"===i?iE(g.outShape,y.shape):(dg(y.shape.length<=1,(()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`)),dg(0===y.shape.length||y.shape[0]===g.outChannels||1===y.shape[0],(()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${g.outChannels})`)))),null!=h){const t=h.shape;if(dg(t.length<=1||3===t.length,(()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${t.length}.`)),1===t.length)dg(1===t[0]||t[0]===g.outChannels,(()=>`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the number of output channels (${g.outChannels}).`));else if(3===t.length)try{iE(t,g.outShape)}catch(e){const n=`Error in fused conv2d: PReLU activation weights (${t}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(n)}v=Kw(h,"prelu weights","fused conv2d")}const x=(t,e)=>{dg("NHWC"===i,(()=>`Error in gradient of fused conv2D: got dataFormat of ${i} but only NHWC is currently supported.`));const[a,o,h,u]=e,c=CN(t,h,l);dg(JS(s),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`));const d=[CI(o.shape,c,a,n,r),kN(o,c,a.shape,n,r)];if(null!=u){const t=NN(u,c);d.push(t)}return d},b={x:p,filter:d,bias:y,preluActivationWeights:v},w={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:a,activation:l,leakyreluAlpha:u};if(null==o){const t=$T(((t,e,n)=>{let r=Uw.runKernel(_b,b,w);return n([e,t,r]),f&&(r=rI(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:x}}));return t(p,d)}{const t=$T(((t,e,n,r)=>{let i=Uw.runKernel(_b,b,w);return r([e,t,i,n]),f&&(i=rI(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:x}}));return t(p,d,y)}}});const ON=Qw({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,r,i,s=[1,1],a){let o=t;3===t.rank&&(o=rI(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;3===l.rank&&(l=rI(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const h={x:o,dy:l},u={strides:r,pad:i,dimRoundingMode:a,dilations:s,filterShape:n};return Uw.runKernel(Ky,h,u)}});const PN=Qw({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,i,s=[1,1],a){let o=e,l=!1;3===e.rank&&(l=!0,o=rI(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const h={dy:o,filter:n},u={strides:r,pad:i,dimRoundingMode:a,dilations:s,inputShape:t},c=Uw.runKernel(Zy,h,u);return l?rI(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});const DN=Qw({fusedDepthwiseConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:a,bias:o,activation:l="linear",preluActivationWeights:h,leakyreluAlpha:u}){if(!1===RN(Uw.state.gradientDepth,l)){let c=$I(t,e,n,r,i,s,a);return null!=o&&(c=kT(c,o)),AN(c,l,h,u)}const c=Kw(t,"x","depthwiseConv2d","float32"),d=Kw(e,"filter","depthwiseConv2d","float32");let p=c,f=!1;3===c.rank&&(f=!0,p=rI(c,[1,c.shape[0],c.shape[1],c.shape[2]])),dg(4===p.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`)),dg(4===d.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${d.rank}.`)),dg(p.shape[3]===d.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${d.shape[2]}.`)),null==s&&(s=[1,1]),dg(QS(n,s),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`)),nI("fused depthwiseConv2d",r,a);const m=XS(p.shape,d.shape,n,s,r,a,!0);let g,y;null!=o&&(g=Kw(o,"bias","fused conv2d"),[g]=Rw(g,c),iE(m.outShape,g.shape)),null!=h&&(y=Kw(h,"prelu weights","fused depthwiseConv2d"));const v=(t,e)=>{dg(JS(s),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`));const[i,o,h,u]=e,c=CN(t,h,l),d=PN(o.shape,c,i,n,r,s,a),p=ON(o,c,i.shape,n,r,s,a);if(null!=u){return[d,p,NN(g,c)]}return[d,p]},x={x:p,filter:d,bias:g,preluActivationWeights:y},b={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:a,activation:l,leakyreluAlpha:u};if(null==o){const t=$T(((t,e,n)=>{let r=Uw.runKernel(Tb,x,b);return n([e,t,r]),f&&(r=rI(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:v}}));return t(p,d)}{const t=$T(((t,e,n,r)=>{let i=Uw.runKernel(Tb,x,b);return r([e,t,i,n]),f&&(i=rI(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:v}}));return t(p,d,g)}}});const FN=Qw({fusedMatMul_:function({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:i,activation:s="linear",preluActivationWeights:a,leakyreluAlpha:o=.2}){if(!1===RN(Uw.state.gradientDepth,s)){let l=RE(t,e,n,r);return null!=i&&(l=kT(l,i)),AN(l,s,a,o)}let l=Kw(t,"a","fused matMul"),h=Kw(e,"b","fused matMul");[l,h]=Rw(l,h);const u=n?l.shape[l.rank-2]:l.shape[l.rank-1],c=r?h.shape[h.rank-1]:h.shape[h.rank-2],d=n?l.shape[l.rank-1]:l.shape[l.rank-2],p=r?h.shape[h.rank-2]:h.shape[h.rank-1],f=l.shape.slice(0,-2),m=h.shape.slice(0,-2),g=mg(f),y=mg(m);dg(u===c,(()=>`Error in fused matMul: inner shapes (${u}) and (${c}) of Tensors with shapes ${l.shape} and ${h.shape} and transposeA=${n} and transposeB=${r} must match.`));const v=iE(l.shape.slice(0,-2),h.shape.slice(0,-2)).concat([d,p]),x=rI(l,n?[g,u,d]:[g,d,u]),b=rI(h,r?[y,p,c]:[y,c,p]);let w,_;null!=i&&(w=Kw(i,"bias","fused matMul"),[w]=Rw(w,l),iE(v,w.shape)),null!=a&&(_=Kw(a,"prelu weights","fused matMul"));const T=(t,e)=>{const[a,o,l,h]=e,u=CN(rI(t,l.shape),l,s);let c,d;if(n||r?!n&&r?(c=RE(u,o,!1,!1),d=RE(u,a,!0,!1)):n&&!r?(c=RE(o,u,!1,!0),d=RE(a,u,!1,!1)):(c=RE(o,u,!0,!0),d=RE(u,a,!0,!0)):(c=RE(u,o,!1,!0),d=RE(a,u,!0,!1)),null!=i){return[c,d,NN(h,u)]}return[c,d]},E={a:x,b,bias:w,preluActivationWeights:_},S={transposeA:n,transposeB:r,activation:s,leakyreluAlpha:o};if(null==i){const t=$T(((t,e,n)=>{const r=Uw.runKernel(wb,E,S);return n([t,e,r]),{value:rI(r,v),gradFunc:T}}));return t(x,b)}{const t=$T(((t,e,n,r)=>{const i=Uw.runKernel(wb,E,S);return r([t,e,i,n]),{value:rI(i,v),gradFunc:T}}));return t(x,b,w)}}});const LN=Qw({hammingWindow_:function(t){return SN(t,.54,.46)}});const BN=Qw({hannWindow_:function(t){return SN(t,.5,.5)}});const $N=Qw({frame_:function(t,e,n,r=!1,i=0){let s=0;const a=[];for(;s+e<=t.size;)a.push(lI(t,s,e)),s+=n;if(r)for(;s<t.size;){const r=s+e-t.size,o=aI([lI(t,s,e-r),KT([r],i)]);a.push(o),s+=n}return 0===a.length?iN([],[0,e]):rI(aI(a),[a.length,e])}});const UN=Qw({stft_:function(t,e,n,r,i=BN){null==r&&(r=EN(e));const s=$N(t,e,n),a=AT(s,i(e));return KC(a,r)}});const VN=Qw({cropAndResize_:function(t,e,n,r,i="bilinear",s=0){const a=Kw(t,"image","cropAndResize"),o=Kw(e,"boxes","cropAndResize","float32"),l=Kw(n,"boxInd","cropAndResize","int32"),h=o.shape[0];dg(4===a.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${a.rank}.`)),dg(2===o.rank&&4===o.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${h},4] but had shape ${o.shape}.`)),dg(1===l.rank&&l.shape[0]===h,(()=>`Error in cropAndResize: boxInd must be have size [${h}] but had shape ${o.shape}.`)),dg(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),dg(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),dg("bilinear"===i||"nearest"===i,(()=>`method must be bilinear or nearest, but was ${i}`));const u={image:a,boxes:o,boxInd:l},c={method:i,extrapolationValue:s,cropSize:r};return Uw.runKernel(Hy,u,c)}});const zN=Qw({flipLeftRight_:function(t){const e=Kw(t,"image","flipLeftRight","float32");dg(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e};return Uw.runKernel(fv,n,{})}});const GN=Qw({grayscaleToRGB_:function(t){const e=Kw(t,"image","grayscaleToRGB"),n=e.rank-1,r=e.shape[n];dg(e.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`)),dg(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const i=new Array(e.rank);return i.fill(1,0,n),i[n]=3,pk(e,i)}});const WN=Qw({rotateWithOffset_:function(t,e,n=0,r=.5){const i=Kw(t,"image","rotateWithOffset","float32");dg(4===i.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`));const s={image:i},a={radians:e,fillValue:n,center:r};return Uw.runKernel(bb,s,a)}});function XN(t,e,n,r,i,s){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==s&&(s=0);const a=t.shape[0];return n=Math.min(n,a),dg(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),dg(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),dg(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),dg(1===e.rank,(()=>"scores must be a 1D tensor")),dg(e.shape[0]===a,(()=>`scores has incompatible shape with boxes. Expected ${a}, but was ${e.shape[0]}`)),dg(0<=s&&s<=1,(()=>`softNmsSigma must be in [0, 1], but was '${s}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:s}}const HN=Qw({nonMaxSuppression_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=Kw(t,"boxes","nonMaxSuppression","float32"),a=Kw(e,"scores","nonMaxSuppression","float32"),o=XN(s,a,n,r,i),l={maxOutputSize:n=o.maxOutputSize,iouThreshold:r=o.iouThreshold,scoreThreshold:i=o.scoreThreshold};return Uw.runKernel(sx,{boxes:s,scores:a},l)}});function YN(t,e,n){const r=function(t,e,n){return function(t,e,n){let r=0,i=t.length,s=0,a=!1;for(;r<i;){s=r+(i-r>>>1);const o=n(e,t[s]);o>0?r=s+1:(i=s,a=!o)}return a?r:-r-1}(t,e,n||jN)}(t,e,n),i=r<0?-(r+1):r;t.splice(i,0,e)}function jN(t,e){return t>e?1:t<e?-1:0}function qN(t,e,n,r,i){return JN(t,e,n,r,i,0)}function KN(t,e,n,r,i,s){return JN(t,e,n,r,i,0,!1,s,!0)}function ZN(t,e,n,r,i,s){return JN(t,e,n,r,i,s,!0)}function JN(t,e,n,r,i,s,a=!1,o=!1,l=!1){const h=[];for(let t=0;t<e.length;t++)e[t]>i&&h.push({score:e[t],boxIndex:t,suppressBeginIndex:0});h.sort(eA);const u=s>0?-.5/s:0,c=[],d=[];for(;c.length<n&&h.length>0;){const e=h.pop(),{score:n,boxIndex:s,suppressBeginIndex:a}=e;if(n<i)break;let o=!1;for(let n=c.length-1;n>=a;--n){const a=QN(t,s,c[n]);if(a>=r){o=!0;break}if(e.score=e.score*tA(r,u,a),e.score<=i)break}e.suppressBeginIndex=c.length,o||(e.score===n?(c.push(s),d.push(e.score)):e.score>i&&YN(h,e,eA))}const p=c.length,f=n-p;o&&f>0&&(c.push(...new Array(f).fill(0)),d.push(...new Array(f).fill(0)));const m={selectedIndices:c};return a&&(m.selectedScores=d),l&&(m.validOutputs=p),m}function QN(t,e,n){const r=t.subarray(4*e,4*e+4),i=t.subarray(4*n,4*n+4),s=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),o=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),h=Math.min(i[0],i[2]),u=Math.min(i[1],i[3]),c=Math.max(i[0],i[2]),d=Math.max(i[1],i[3]),p=(o-s)*(l-a),f=(c-h)*(d-u);if(p<=0||f<=0)return 0;const m=Math.max(s,h),g=Math.max(a,u),y=Math.min(o,c),v=Math.min(l,d),x=Math.max(y-m,0)*Math.max(v-g,0);return x/(p+f-x)}function tA(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function eA(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}const nA=async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=Kw(t,"boxes","nonMaxSuppressionAsync"),a=Kw(e,"scores","nonMaxSuppressionAsync"),o=XN(s,a,n,r,i);n=o.maxOutputSize,r=o.iouThreshold,i=o.scoreThreshold;const l=await Promise.all([s.data(),a.data()]),h=l[0],u=l[1],{selectedIndices:c}=qN(h,u,n,r,i);return s!==t&&s.dispose(),a!==e&&a.dispose(),rN(c,"int32")};const rA=Qw({nonMaxSuppressionWithScore_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const a=Kw(t,"boxes","nonMaxSuppression"),o=Kw(e,"scores","nonMaxSuppression"),l=XN(a,o,n,r,i,s),h={boxes:a,scores:o},u={maxOutputSize:n=l.maxOutputSize,iouThreshold:r=l.iouThreshold,scoreThreshold:i=l.scoreThreshold,softNmsSigma:s=l.softNmsSigma},c=Uw.runKernel(ox,h,u);return{selectedIndices:c[0],selectedScores:c[1]}}});const iA=async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const a=Kw(t,"boxes","nonMaxSuppressionAsync"),o=Kw(e,"scores","nonMaxSuppressionAsync"),l=XN(a,o,n,r,i,s);n=l.maxOutputSize,r=l.iouThreshold,i=l.scoreThreshold,s=l.softNmsSigma;const h=await Promise.all([a.data(),o.data()]),u=h[0],c=h[1],{selectedIndices:d,selectedScores:p}=ZN(u,c,n,r,i,s);return a!==t&&a.dispose(),o!==e&&o.dispose(),{selectedIndices:rN(d,"int32"),selectedScores:rN(p)}};const sA=Qw({nonMaxSuppressionPadded_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const a=Kw(t,"boxes","nonMaxSuppression"),o=Kw(e,"scores","nonMaxSuppression"),l=XN(a,o,n,r,i,null),h={boxes:a,scores:o},u={maxOutputSize:l.maxOutputSize,iouThreshold:l.iouThreshold,scoreThreshold:l.scoreThreshold,padToMaxOutputSize:s},c=Uw.runKernel(ax,h,u);return{selectedIndices:c[0],validOutputs:c[1]}}});const aA=async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const a=Kw(t,"boxes","nonMaxSuppressionAsync"),o=Kw(e,"scores","nonMaxSuppressionAsync"),l=XN(a,o,n,r,i,null),h=l.maxOutputSize,u=l.iouThreshold,c=l.scoreThreshold,[d,p]=await Promise.all([a.data(),o.data()]),{selectedIndices:f,validOutputs:m}=KN(d,p,h,u,c,s);return a!==t&&a.dispose(),o!==e&&o.dispose(),{selectedIndices:rN(f,"int32"),validOutputs:VT(m,"int32")}};const oA=Qw({resizeBilinear_:function(t,e,n=!1,r=!1){const i=Kw(t,"images","resizeBilinear");dg(3===i.rank||4===i.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`)),dg(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),dg(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let s=i,a=!1;3===i.rank&&(a=!0,s=rI(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const[]=e,o={images:s},l={alignCorners:n,halfPixelCenters:r,size:e},h=Uw.runKernel(Ix,o,l);return a?rI(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});const lA=Qw({resizeNearestNeighbor_:function(t,e,n=!1,r=!1){const i=Kw(t,"images","resizeNearestNeighbor");dg(3===i.rank||4===i.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`)),dg(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),dg("float32"===i.dtype||"int32"===i.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),dg(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let s=i,a=!1;3===i.rank&&(a=!0,s=rI(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const[]=e,o={images:s},l={alignCorners:n,halfPixelCenters:r,size:e},h=Uw.runKernel(Ex,o,l);return a?rI(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});const hA=Qw({threshold_:function(t,e="binary",n=!1,r=.5){const i=Kw(t,"image","threshold"),s=i.shape[0]*i.shape[1];let a,o,l,h,u=AT(rN([r]),255);if(dg(3===i.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${i.rank}.`)),dg(3===i.shape[2]||1===i.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${i.shape[2]}.`)),dg("int32"===i.dtype||"float32"===i.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${i.dtype}.`)),dg("otsu"===e||"binary"===e,(()=>`Method must be binary or otsu, but was ${e}`)),3===i.shape[2]){[a,o,l]=qC(i,[1,1,1],-1);const t=AT(a,.2989),e=AT(o,.587),n=AT(l,.114);h=kT(kT(t,e),n)}else h=t;if("otsu"===e){u=function(t,e){let n,r,i,s,a,o,l=rN([-1]),h=rN([0]),u=rN([0]);for(let c=0;c<t.size-1;c++){n=lI(t,0,c+1),r=lI(t,c+1),a=NT(ak(n),e),o=NT(ak(r),e);const d=ak(AT(n,EC(0,n.size)));i=NT(d,ak(n));const p=KT(r.shape,n.size),f=kT(EC(0,r.size),p),m=AT(r,f);s=NT(ak(m),ak(r));const g=QT(i,s),y=QT(i,s),v=AT(a,o);u=AT(AT(v,g),y);const x=yk(u,h);h=GI(x,u,h),l=GI(x,rN([c]),l)}return l}(gI(rT(OC(h),"int32"),n_([]),256),s)}const c=n?Ek(h,u):yk(h,u);return rT(AT(c,255),"int32")}});const uA=Qw({transform_:function(t,e,n="nearest",r="constant",i=0,s){const a=Kw(t,"image","transform","float32"),o=Kw(e,"transforms","transform","float32");dg(4===a.rank,(()=>`Error in transform: image must be rank 4,but got rank ${a.rank}.`)),dg(2===o.rank&&(o.shape[0]===a.shape[0]||1===o.shape[0])&&8===o.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),dg(null==s||2===s.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`));const l={image:a,transforms:o},h={interpolation:n,fillMode:r,fillValue:i,outputShape:s};return Uw.runKernel(cb,l,h)}});const cA=Qw({bandPart_:function(t,e,n){const r=Kw(t,"a","bandPart");dg(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const i=r.shape,[s,a]=r.shape.slice(-2);let o,l;"number"==typeof e?(dg(e%1==0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),dg(e<=s,(()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${s}).`)),o=Kw(e<0?s:e,"numLower","bandPart")):(dg("int32"===e.dtype,(()=>"bandPart(): numLower's dtype must be an int32.")),o=GI(Tk(e,0),s,Yk(e,s))),"number"==typeof n?(dg(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`)),dg(n<=a,(()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${a}).`)),l=Kw(n<0?a:n,"numUpper","bandPart")):(dg("int32"===n.dtype,(()=>"bandPart(): numUpper's dtype must be an int32.")),l=GI(Tk(n,0),a,Yk(n,a)));const h=rI(EC(0,s,1,"int32"),[-1,1]),u=EC(0,a,1,"int32"),c=QT(h,u),d=Ok(Ek(c,o),vk(c,PE(l))),p=Wk([s,a],r.dtype);return rI(QC(pN(rI(r,[-1,s,a])).map((t=>GI(d,t,p)))),i)}});const dA=Qw({gramSchmidt_:function(t){let e;if(Array.isArray(t)){e=!1,dg(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)dg(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=qC(t,t.shape[0],0).map((t=>JC(t,[0])));dg(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],r=t;for(let e=0;e<t.length;++e)n.push(Uw.tidy((()=>{let t=r[e];if(e>0)for(let r=0;r<e;++r){const e=AT(ak(AT(n[r],t)),n[r]);t=QT(t,e)}return NT(t,lk(t,"euclidean"))})));return e?QC(n,0):n}});function pA(t,e=!1){return Uw.tidy((()=>{dg(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],r=t.shape[1];let i=fk(n),s=iT(t);const a=iN([[1]],[1,1]);let o=iT(a);const l=n>=r?r:n;for(let t=0;t<l;++t){const e=s,l=o,h=i;[o,s,i]=Uw.tidy((()=>{const e=lI(s,[t,t],[n-t,1]),l=lk(e),h=lI(s,[t,t],[1,1]),u=GI(yk(h,0),iN([[-1]]),iN([[1]])),c=QT(h,AT(u,l)),d=NT(e,c);o=1===d.shape[0]?iT(a):aI([a,lI(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);const p=PE(NT(RE(u,c),l)),f=lI(s,[t,0],[n-t,r]),m=AT(p,o),g=FE(o);if(0===t)s=QT(f,RE(m,RE(g,f)));else{const e=QT(f,RE(m,RE(g,f)));s=aI([lI(s,[0,0],[t,r]),e],0)}const y=FE(m),v=lI(i,[0,t],[n,i.shape[1]-t]);if(0===t)i=QT(v,RE(RE(v,o),y));else{const e=QT(v,RE(RE(v,o),y));i=aI([lI(i,[0,0],[n,t]),e],1)}return[o,s,i]})),mT([e,l,h])}return!e&&n>r&&(i=lI(i,[0,0],[n,r]),s=lI(s,[0,0],[r,r])),[i,s]}))}const fA=Qw({qr_:function(t,e=!1){if(dg(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return pA(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),r=pN(rI(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],s=[];r.forEach((t=>{const[n,r]=pA(t,e);i.push(n),s.push(r)}));return[rI(QC(i,0),t.shape),rI(QC(s,0),t.shape)]}}});var mA;!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(mA||(mA={}));const gA=Qw({computeWeightedLoss_:function(t,e,n=mA.SUM_BY_NONZERO_WEIGHTS){const r=Kw(t,"losses","computeWeightedLoss");let i=null;null!=e&&(i=Kw(e,"weights","computeWeightedLoss"));const s=null==i?r:AT(r,i);if(n===mA.NONE)return s;if(n===mA.SUM)return ak(s);if(n===mA.MEAN){if(null==i)return Gk(s);{const t=r.size/i.size,e=NT(ak(s),ak(i));return t>1?NT(e,VT(t)):e}}if(n===mA.SUM_BY_NONZERO_WEIGHTS){if(null==i)return NT(ak(s),VT(r.size));{const t=AT(i,Xk(r.shape)),e=rT(ak(Qk(t,VT(0))),"float32");return NT(ak(s),e)}}throw Error(`Unknown reduction: ${n}`)}});const yA=Qw({absoluteDifference_:function(t,e,n,r=mA.SUM_BY_NONZERO_WEIGHTS){const i=Kw(t,"labels","absoluteDifference"),s=Kw(e,"predictions","absoluteDifference");let a=null;null!=n&&(a=Kw(n,"weights","absoluteDifference")),pg(i.shape,s.shape,"Error in absoluteDifference: ");const o=eE(QT(i,s));return gA(o,a,r)}});const vA=Qw({cosineDistance_:function(t,e,n,r,i=mA.SUM_BY_NONZERO_WEIGHTS){const s=Kw(t,"labels","cosineDistance"),a=Kw(e,"predictions","cosineDistance");let o=null;null!=r&&(o=Kw(r,"weights","cosineDistance")),pg(s.shape,a.shape,"Error in cosineDistance: ");const l=VT(1),h=QT(l,ak(AT(s,a),n,!0));return gA(h,o,i)}});const xA=Qw({hingeLoss_:function(t,e,n,r=mA.SUM_BY_NONZERO_WEIGHTS){let i=Kw(t,"labels","hingeLoss");const s=Kw(e,"predictions","hingeLoss");let a=null;null!=n&&(a=Kw(n,"weights","hingeLoss")),pg(i.shape,s.shape,"Error in hingeLoss: ");const o=VT(1);i=QT(AT(VT(2),i),o);const l=IC(QT(o,AT(i,s)));return gA(l,a,r)}});const bA=Qw({huberLoss_:function(t,e,n,r=1,i=mA.SUM_BY_NONZERO_WEIGHTS){const s=Kw(t,"labels","huberLoss"),a=Kw(e,"predictions","huberLoss");let o=null;null!=n&&(o=Kw(n,"weights","huberLoss")),pg(s.shape,a.shape,"Error in huberLoss: ");const l=VT(r),h=eE(QT(a,s)),u=Yk(h,l),c=QT(h,u),d=kT(AT(VT(.5),MT(u)),AT(l,c));return gA(d,o,i)}});const wA=Qw({logLoss_:function(t,e,n,r=1e-7,i=mA.SUM_BY_NONZERO_WEIGHTS){const s=Kw(t,"labels","logLoss"),a=Kw(e,"predictions","logLoss");let o=null;null!=n&&(o=Kw(n,"weights","logLoss")),pg(s.shape,a.shape,"Error in logLoss: ");const l=VT(1),h=VT(r),u=PE(AT(s,kk(kT(a,h)))),c=AT(QT(l,s),kk(kT(QT(l,a),h))),d=QT(u,c);return gA(d,o,i)}});const _A=Qw({meanSquaredError_:function(t,e,n,r=mA.SUM_BY_NONZERO_WEIGHTS){const i=Kw(t,"labels","meanSquaredError"),s=Kw(e,"predictions","meanSquaredError");let a=null;null!=n&&(a=Kw(n,"weights","meanSquaredError")),pg(i.shape,s.shape,"Error in meanSquaredError: ");const o=ZC(i,s);return gA(o,a,r)}});const TA=Qw({sigmoidCrossEntropy_:function(t,e,n,r=0,i=mA.SUM_BY_NONZERO_WEIGHTS){let s=Kw(t,"multiClassLabels","sigmoidCrossEntropy");const a=Kw(e,"logits","sigmoidCrossEntropy");let o=null;if(null!=n&&(o=Kw(n,"weights","sigmoidCrossEntropy")),pg(s.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){const t=VT(r),e=VT(1),n=VT(.5);s=kT(AT(s,QT(e,t)),AT(n,t))}const l=function(t,e){const n=Kw(t,"labels","sigmoidCrossEntropyWithLogits"),r=Kw(e,"logits","sigmoidCrossEntropyWithLogits");pg(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=IC(r),s=AT(r,n),a=Ck(uk(PE(eE(r))));return kT(QT(i,s),a)}(s,a);return gA(l,o,i)}});const EA=Qw({softmaxCrossEntropy_:function(t,e,n,r=0,i=mA.SUM_BY_NONZERO_WEIGHTS){let s=Kw(t,"onehotLabels","softmaxCrossEntropy");const a=Kw(e,"logits","softmaxCrossEntropy");let o=null;if(null!=n&&(o=Kw(n,"weights","softmaxCrossEntropy")),pg(s.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){const t=VT(r),e=VT(1),n=VT(s.shape[1]);s=kT(AT(s,QT(e,t)),NT(t,n))}const l=function(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);const r=$T(((t,e,r)=>{const i=Mk(e,[n],!0),s=QT(rT(e,"float32"),i);r([t,s]);const a=PE(AT(s,t));return{value:ak(a,[n]),gradFunc:(t,e)=>{const[r,i]=e,s=QI(t.shape,[n]);return[AT(rI(t,s),QT(rT(r,"float32"),uk(i))),AT(rI(t,s),QT(uk(i),rT(r,"float32")))]}}}));return r(t,e)}(s,a);return gA(l,o,i)}});const SA=Qw({sparseFillEmptyRows_:function(t,e,n,r){const i=Kw(t,"indices","sparseFillEmptyRows","int32"),s=Kw(e,"values","sparseFillEmptyRows"),a=Kw(n,"denseShape","sparseFillEmptyRows","int32"),o=Kw(r,"defaultValue","sparseFillEmptyRows",s.dtype);if(2!==i.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${i.shape}`);if(1!==s.rank)throw new Error(`Values should be Tensor1D but received shape ${s.shape}`);if(1!==a.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${a.shape}`);if(0!==o.rank)throw new Error(`Default value should be a scalar but received shape ${o.shape}`);const l={indices:i,values:s,denseShape:a,defaultValue:o},h=Uw.runKernel(jx,l);return{outputIndices:h[0],outputValues:h[1],emptyRowIndicator:h[2],reverseIndexMap:h[3]}}});const IA=Qw({sparseReshape_:function(t,e,n){const r=Kw(t,"inputIndices","sparseReshape","int32"),i=Kw(e,"inputShape","sparseReshape","int32"),s=Kw(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==i.rank)throw new Error(`Input shape should be Tensor1D but received shape ${i.shape}`);if(1!==s.rank)throw new Error(`New shape should be Tensor1D but received shape ${s.shape}`);const a={inputIndices:r,inputShape:i,newShape:s},o=Uw.runKernel(qx,a);return{outputIndices:o[0],outputShape:o[1]}}});const kA=Qw({sparseSegmentMean_:function(t,e,n){const r=Kw(t,"data","sparseSegmentMean"),i=Kw(e,"indices","sparseSegmentMean","int32"),s=Kw(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${i.shape}`);if(1!==s.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${s.shape}`);const a={data:r,indices:i,segmentIds:s};return Uw.runKernel(Kx,a)}});const CA=Qw({sparseSegmentSum_:function(t,e,n){const r=Kw(t,"data","sparseSegmentSum"),i=Kw(e,"indices","sparseSegmentSum","int32"),s=Kw(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${i.shape}`);if(1!==s.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${s.shape}`);const a={data:r,indices:i,segmentIds:s};return Uw.runKernel(Zx,a)}});const NA=Qw({stringNGrams_:function(t,e,n,r,i,s,a,o){const l=Kw(t,"data","stringNGrams","string");if("string"!==l.dtype)throw new Error("Data must be of datatype string");if(1!==l.shape.length)throw new Error(`Data must be a vector, saw: ${l.shape}`);const h=Kw(e,"dataSplits","stringNGrams");if("int32"!==h.dtype)throw new Error("Data splits must be of datatype int32");const u={separator:n,nGramWidths:r,leftPad:i,rightPad:s,padWidth:a,preserveShortSequences:o},c={data:l,dataSplits:h},d=Uw.runKernel(rb,c,u);return{nGrams:d[0],nGramsSplits:d[1]}}});const AA=Qw({stringSplit_:function(t,e,n=!0){const r=Kw(t,"input","stringSplit","string"),i=Kw(e,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==i.rank)throw new Error(`Delimiter should be a scalar but received shape ${i.shape}`);const s={skipEmpty:n},a={input:r,delimiter:i},o=Uw.runKernel(ib,a,s);return{indices:o[0],values:o[1],shape:o[2]}}});const RA=Qw({stringToHashBucketFast_:function(t,e){const n=Kw(t,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const i={input:n};return Uw.runKernel(sb,i,r)}});const MA=Qw({staticRegexReplace_:function(t,e,n,r=!0){const i=Kw(t,"input","staticRegexReplace","string"),s={pattern:e,rewrite:n,replaceGlobal:r};return Uw.runKernel(eb,{x:i},s)}}),OA={fft:HC,ifft:YC,rfft:KC,irfft:jC},PA={hammingWindow:LN,hannWindow:BN,frame:$N,stft:UN},DA={flipLeftRight:zN,grayscaleToRGB:GN,resizeNearestNeighbor:lA,resizeBilinear:oA,rotateWithOffset:WN,cropAndResize:VN,nonMaxSuppression:HN,nonMaxSuppressionAsync:nA,nonMaxSuppressionWithScore:rA,nonMaxSuppressionWithScoreAsync:iA,nonMaxSuppressionPadded:sA,nonMaxSuppressionPaddedAsync:aA,threshold:hA,transform:uA},FA={bandPart:cA,gramSchmidt:dA,qr:fA},LA={absoluteDifference:yA,computeWeightedLoss:gA,cosineDistance:vA,hingeLoss:xA,huberLoss:bA,logLoss:wA,meanSquaredError:_A,sigmoidCrossEntropy:TA,softmaxCrossEntropy:EA},BA={sparseFillEmptyRows:SA,sparseReshape:IA,sparseSegmentMean:kA,sparseSegmentSum:CA},$A={stringNGrams:NA,stringSplit:AA,stringToHashBucketFast:RA,staticRegexReplace:MA},UA=NS,VA="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:t=>t();function zA(){return new Promise((t=>VA((()=>t()))))}function GA(t,e){const n=t[0].length;t.forEach(((t,e)=>{dg(t.length===n,(()=>`Error in concat${n}D: rank of tensors[${e}] must be the same as the rank of the rest (${n})`))})),dg(e>=0&&e<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=t[0];t.forEach(((t,i)=>{for(let s=0;s<n;s++)dg(s===e||t[s]===r[s],(()=>`Error in concat${n}D: Shape of tensors[${i}] (${t}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`))}))}function WA(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}var XA;function HA(t,e,n){let r=new Array;if(null==n&&null==e)return r;if(null==e)for(;r.length<t+n.length;)r.push(-1);else r=e.slice();if(null==n)return r;if(t+n.length!==r.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${r.length}`);for(let i=1;i<n.length;++i){const s=n[i],a=r[r.length-n.length+i],o=r[a];if(s>=0)if(o>=0){if(o!==s)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${i+t}] = ${s} but shape[${i+t}] = ${o}`)}else r[a]=s}return r}function YA(t){const e={FIRST_DIM_SIZE:XA.FIRST_DIM_SIZE,VALUE_ROWIDS:XA.VALUE_ROWIDS,ROW_LENGTHS:XA.ROW_LENGTHS,ROW_SPLITS:XA.ROW_SPLITS,ROW_LIMITS:XA.ROW_LIMITS,ROW_STARTS:XA.ROW_STARTS},n=[];for(const r of t){if(!(r in e))break;n.push(e[r])}return n}function jA(t){return 0===t.length?0:t[0]===XA.FIRST_DIM_SIZE?t.length-1:t.length}function qA(t,e){if(null==t||null==e)return;const n=t.length,r=e.length;if(n>=r)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${r})`);for(let i=0;i<Math.min(n,r-1);++i){const n=t[i],r=e[i+1];if(n>=0&&r>=0&&1!==n&&n!==r)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${i-t.length}] = ${n} but ragged tensor input.flatValues.shape[${i-t.length}] = ${r}`)}}!function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"}(XA||(XA={}));const KA=30;function ZA(t){return t<=KA?t:Ug(t,Math.floor(Math.sqrt(t)))}function JA(t,e,n){return[n*("number"==typeof t?t:t[0]),e*("number"==typeof t?t:t[1])]}function QA(t,e,n,r=!0){let i=[];if(r)i=i.concat(e.slice(0)),i.push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);const n=e.length;for(let r=0;r<n;++r)i=i.concat([t[r+1]/e[r],e[r]]);i=i.concat(t.slice(n+1))}return i}function tR(t,e,n=!0){const r=[];if(n){r.push(e);for(let n=e+1;n<t;++n)n<=2*e?(r.push(n),r.push(n-(e+1))):r.push(n)}else{const n=[],i=[];for(let r=1;r<t;++r)r>=2*e+1||r%2==1?i.push(r):n.push(r);r.push(...n),r.push(0),r.push(...i)}return r}function eR(t,e,n,r=!0){const i=[];r?i.push(t[0]/n):i.push(t[0]*n);for(let n=1;n<t.length;++n)n<=e.length?r?i.push(e[n-1]*t[n]):i.push(t[n]/e[n-1]):i.push(t[n]);return i}function nR(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n}function rR(t,e,n){const r=t.slice(0,1);for(let i=0;i<n;++i)r.push(t[i+1]-e[i][0]-e[i][1]);return r}const iR=1.7580993408473768,sR=1.0507009873554805,aR=.3275911,oR=.254829592,lR=-.284496736,hR=1.421413741,uR=-1.453152027,cR=1.061405429;function dR(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(2*t.length);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function pR(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}function fR(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=0;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}}function mR(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=2;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}}function gR(t,e){return{real:t[2*e],imag:t[2*e+1]}}function yR(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function vR(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let i=0;i<Math.ceil(t/2);i++){const s=(e?2:-2)*Math.PI*(i/t);n[i]=Math.cos(s),r[i]=Math.sin(s)}return{real:n,imag:r}}function xR(t,e,n){const r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}const bR="->",wR=/->/g;function _R(t,e){const n=((t=t.replace(/\s/g,"")).length-t.replace(wR,"").length)/bR.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[r,i]=t.split(bR);dg(-1===r.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const s=r.split(","),a=s.length;if(e!==a)throw new Error(`Expected ${a} input tensors, received ${e}`);if(a>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const o=[];for(let t=0;t<i.length;++t){const e=i[t];if(!s.some((t=>-1!==t.indexOf(e))))throw new Error(`Output subscripts contain the label ${e} not present in the input subscripts.`);-1===o.indexOf(e)&&o.push(e)}for(let t=0;t<r.length;++t){const e=r[t];-1===o.indexOf(e)&&","!==e&&o.push(e)}const l=new Array(s.length);for(let t=0;t<a;++t){if(new Set(s[t].split("")).size!==s[t].length)throw new Error(`Found duplicate axes in input component ${s[t]}. Support for duplicate axes in input is not implemented yet.`);l[t]=[];for(let e=0;e<s[t].length;++e)l[t].push(o.indexOf(s[t][e]))}const h=o.length,u=[];for(let t=i.length;t<h;++t)u.push(t);return{allDims:o,summedDims:u,idDims:l}}function TR(t,e){let n=new Array(t);n.fill(-1);for(let t=0;t<e.length;++t)n[e[t]]=t;const r=[];for(let e=0;e<t;++e)-1===n[e]&&r.push(e);return n=n.filter((t=>-1!==t)),{permutationIndices:n,expandDims:r}}function ER(t,e,n){const r=new Array(t);for(let t=0;t<n.length;++t){const i=n[t].shape;for(let n=0;n<e[t].length;++n)void 0===r[e[t][n]]?r[e[t][n]]=i[n]:dg(r[e[t][n]]===i[n],(()=>`Expected dimension ${r[e[t][n]]} at axis ${n} of input shaped ${JSON.stringify(i)}, but got dimension ${i[n]}`))}}function SR(t,e){const n=t,r=[];let i=0;0===t.length&&n.push(-1),i=t.length+1;for(let t=0;t<i;++t)r.push([]);const s=[];for(let t=0;t<n.length;++t){const i=kR(e,n[t]);for(const e of i)-1===s.indexOf(e)&&(r[t].push(e),s.push(e))}return{path:n,steps:r}}function IR(t){return t.every(((t,e)=>t===e))}function kR(t,e){const n=[];for(let r=0;r<t.length;++r)0!==t[r].length&&-1===t[r].indexOf(e)&&-1!==e||n.push(r);return n}function CR(t,e,n=0){let r=[];if("number"==typeof e)dg(t.shape[n]%e==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(e).fill(t.shape[n]/e);else{const i=e.reduce(((t,e)=>(-1===e&&(t+=1),t)),0);dg(i<=1,(()=>"There should be only one negative value in split array."));const s=e.indexOf(-1);if(-1!==s){const r=e.reduce(((t,e)=>e>0?t+e:t));e[s]=t.shape[n]-r}dg(t.shape[n]===e.reduce(((t,e)=>t+e)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=e}return r}function NR(t){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${t}`}function AR(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function RR(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}function MR(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function OR(t,e){return`size ${t} must be non-negative, not ${e}`}function PR(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function DR(t,e){return`Input to reshape is a SparseTensor with ${mg(t)}\n  dense values, but the requested shape requires a multiple of ${mg(e)}. inputShape=${t} outputShape= ${e}`}function FR(t,e){return`Input to reshape is a tensor with ${mg(t)} dense values, but the requested shape has ${mg(e)}. inputShape=${t} outputShape=${e}`}function LR(){return"segment ids must be >= 0"}function BR(){return"segment ids are not increasing"}function $R(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function UR(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}function VR(t,e){let n,r=!1;for(t<=KA?(n=t,r=!0):n=Ug(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=Ug(t,n+1);return n}function zR(t,e,n){const r=[],i=t.length;for(let s=0;s<i;s++)s!==e?r.push(t[s]):r.push(n);return r}function GR(t,e,n,r){const i=e.shape.length,s=t.shape.length;if(0!==r&&(r<-i||r>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${r}`);if(r<0&&(r+=i),r>s)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${s}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(t.shape[n]!==e.shape[n])throw new Error(`x.shape[${n}]: ${t.shape[n]} should be equal to indices.shape[${n}]: ${e.shape[n]}.`);const a=t.shape[n],o=[];let l=1,h=1,u=1;for(let e=0;e<r;++e)o.push(t.shape[e]),l*=t.shape[e];for(let e=r;e<n;e++)o.push(t.shape[e]),h*=t.shape[e];for(let t=r;t<i;t++)o.push(e.shape[t]);for(let e=n+1;e<s;e++)o.push(t.shape[e]),u*=t.shape[e];return{batchSize:l,sliceSize:u,outerSize:h,dimSize:a,outputShape:o}}function WR(t){try{return t.map((t=>rw(t)))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function XR(t){return t.map((t=>nw(t)))}!function(){for(const t of uE)HT(t)}();const HR={kernelName:ay,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>AT(t,tN(rT(n,"float32"),-1))}}},YR={kernelName:oy,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=MT(rT(n,"float32")),r=RT(QT(VT(1),e));return PE(NT(t,r))}}}},jR={kernelName:ly,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=RT(QT(MT(rT(n,"float32")),1));return NT(t,e)}}}},qR={kernelName:hy,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=iE(n.shape,r.shape);return{a:()=>{let e=t;const r=rE(n.shape,i);return r.length>0&&(e=ak(e,r)),rI(e,n.shape)},b:()=>{let e=t;const n=rE(r.shape,i);return n.length>0&&(e=ak(e,n)),rI(e,r.shape)}}}},KR={kernelName:uy,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach(((e,r)=>{n[r]=()=>t.clone()})),n}},ZR={kernelName:py,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>OT(n)}}},JR={kernelName:fy,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>OT(n)}}},QR={kernelName:my,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>NT(t,RT(QT(VT(1),MT(rT(n,"float32")))))}}},tM={kernelName:gy,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=RT(kT(VT(1),MT(rT(n,"float32"))));return NT(t,e)}}}},eM={kernelName:xy,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=iE(n.shape,r.shape);return{a:()=>{const e=kT(MT(n),MT(r));let s=AT(t,NT(r,e));const a=rE(n.shape,i);return a.length>0&&(s=ak(s,a)),rI(s,n.shape)},b:()=>{const e=kT(MT(n),MT(r));let s=PE(AT(t,NT(n,e)));const a=rE(r.shape,i);return a.length>0&&(s=ak(s,a)),rI(s,r.shape)}}}},nM={kernelName:yy,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>NT(t,kT(MT(rT(n,"float32")),1))}}},rM={kernelName:vy,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>NT(t,QT(VT(1),MT(rT(n,"float32"))))}}};const iM=Qw({avgPool3dGrad_:function(t,e,n,r,i,s){const a=Kw(t,"dy","avgPool3dGrad"),o=Kw(e,"input","avgPool3dGrad");let l=a,h=o,u=!1;4===o.rank&&(u=!0,l=rI(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=rI(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),dg(5===l.rank,(()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`)),dg(5===h.rank,(()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${h.rank}.`)),nI("avgPool3dGrad",i,s);const c={dy:l,input:h},d={filterSize:n,strides:r,pad:i,dimRoundingMode:s},p=Uw.runKernel(Ty,c,d);return u?rI(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}}),sM={kernelName:_y,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{filterSize:i,strides:s,pad:a,dimRoundingMode:o}=n;return{x:()=>iM(t,r,i,s,a,o)}}};const aM=Qw({avgPoolGrad_:function(t,e,n,r,i){const s=Kw(t,"dy","avgPoolGrad"),a=Kw(e,"input","avgPoolGrad");dg(a.rank===s.rank,(()=>`Rank of input (${a.rank}) does not match rank of dy (${s.rank})`));let o=a,l=s,h=!1;3===a.rank&&(h=!0,o=rI(a,[1,a.shape[0],a.shape[1],a.shape[2]]),l=rI(s,[1,s.shape[0],s.shape[1],s.shape[2]])),dg(4===l.rank,(()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`)),dg(4===o.rank,(()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${o.rank}.`));const u={dy:l,input:o},c={filterSize:n,strides:r,pad:i},d=Uw.runKernel(wy,u,c);return h?rI(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),oM={kernelName:by,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{filterSize:i,strides:s,pad:a}=n;return{x:()=>aM(t,r,i,s,a)}}},lM={kernelName:Ey,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[r,i]=e,{transposeA:s,transposeB:a}=n;return s||a?!s&&a?{a:()=>RE(t,i,!1,!1),b:()=>RE(t,r,!0,!1)}:s&&!a?{a:()=>RE(i,t,!1,!0),b:()=>RE(r,t,!1,!1)}:{a:()=>RE(i,t,!0,!0),b:()=>RE(t,r,!0,!0)}:{a:()=>RE(t,i,!1,!0),b:()=>RE(r,t,!0,!1)}}},hM={kernelName:Sy,gradFunc:(t,e,n)=>{const{blockShape:r,crops:i}=n;return{x:()=>oC(t,r,i)}}},uM={kernelName:Cy,gradFunc:(t,e,n)=>{const r=n,i=r.inputShape,s=r.shape,a=Array.from(s);for(let t=i.length-1;t>=0;t--)if(i[t]===s[t])a[t]=1;else if(1!==i[t])throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${s}].`);const o=[];for(let t=0;t<a.length;t++)a[t]>1&&o.push(t);return{x:()=>ak(t,o,!0)}}},cM={kernelName:Ay,gradFunc:t=>({x:()=>t.clone()})},dM={kernelName:Ry,gradFunc:t=>({x:()=>OT(t)})},pM={kernelName:My,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{clipValueMin:i,clipValueMax:s}=n;return{x:()=>GI(Ok(vk(r,i),Ek(r,s)),t,OT(t))}}},fM={kernelName:Py,inputsToSave:["x"],gradFunc:HR.gradFunc},mM={kernelName:Dy,saveAllInputs:!0,gradFunc:(t,e,n)=>{const r=e.map((t=>t.shape)),{axis:i}=n,s=Ig(i,e[0].shape)[0],a=r.map((t=>t[s]));return qC(t,a,s).map((t=>()=>t))}},gM={kernelName:Fy,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,{dilations:s,strides:a,pad:o,dataFormat:l}=n;return dg(JS(s),(()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`)),{x:()=>CI(r.shape,t,i,a,o,l),filter:()=>kN(r,t,i.shape,a,o,l)}}},yM={kernelName:By,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,{strides:s,pad:a,dataFormat:o,dimRoundingMode:l}=n;return{dy:()=>II(t,i,s,a,o,1,l),filter:()=>kN(t,r,i.shape,s,a,o,l)}}};const vM=Qw({conv3DBackpropFilter_:function(t,e,n,r,i){let s=t;4===t.rank&&(s=rI(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let a=e;4===a.rank&&(a=rI(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),dg(5===s.rank,(()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`)),dg(5===a.rank,(()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${a.shape}.`)),dg(5===n.length,(()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`)),dg(s.shape[4]===n[3],(()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${n[3]}.`)),dg(a.shape[4]===n[4],(()=>`Error in conv3dDerFilter: depth of dy (${a.shape[4]}) must match output depth for filter (${n[4]}).`));const o={x:s,dy:a},l={strides:r,pad:i,filterShape:n};return Uw.runKernel(Uy,o,l)}}),xM={kernelName:$y,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:r,strides:i,pad:s}=n;dg(JS(r),(()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`));const[a,o]=e;return{x:()=>RI(a.shape,t,o,i,s),filter:()=>vM(a,t,o.shape,i,s)}}},bM={kernelName:zy,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>AT(PE($C(rT(n,"float32"))),t)}}},wM={kernelName:Gy,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>AT(UC(rT(n,"float32")),t)}}},_M={kernelName:Xy,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:i,exclusive:s,reverse:a}=n;return{x:()=>{const e=ek([i],r.rank);let n=FI(t,i,s,!a);return null!=e&&(n=FE(n,e)),n}}}},TM={kernelName:qy,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:r,strides:i,pad:s,dimRoundingMode:a}=n,o=null==r?[1,1]:r;dg(JS(o),(()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[l,h]=e;return dg(4===l.rank,(()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`)),dg(4===h.rank,(()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${h.rank}.`)),dg(l.shape[3]===h.shape[2],(()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`)),dg(QS(i,o),(()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${o}'.`)),nI("depthwiseConv2d",s,a),{x:()=>PN(l.shape,t,h,i,s,o,a),filter:()=>ON(l,t,h.shape,i,s,o,a)}}},EM={kernelName:Qy,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,s={x:r,filter:i,dy:t},a={x:r,filter:i,dy:t};return{x:()=>Uw.runKernel(tv,s,n),filter:()=>Uw.runKernel(ev,a,n)}}},SM={kernelName:sv,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,r={dy:t,y:n};return{x:()=>Uw.runKernel(av,r)}}},IM={kernelName:ov,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,r=AT(uk(PE(MT(n))),2/Math.sqrt(Math.PI));return{x:()=>AT(t,r)}}},kM={kernelName:hv,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>AT(t,n)}}},CM={kernelName:uv,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>rI(t,n.shape)}}},NM={kernelName:cv,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>AT(t,uk(n))}}},AM={kernelName:mv,gradFunc:t=>({x:()=>OT(t)})},RM={kernelName:gv,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=iE(n.shape,r.shape);return{a:()=>{const e=NT(t,rT(r,"float32")),s=rE(n.shape,i);return s.length>0?rI(ak(e,s),n.shape):e},b:()=>{let e=AT(t,rT(n,"float32"));const s=rE(r.shape,i);s.length>0&&(e=rI(ak(e,s),r.shape));const a=MT(r);return PE(NT(e,rT(a,"float32")))}}}},MM={kernelName:yv,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:r}=n,[i,s,a,o]=e,l=null==o?VT(1):o,h=rE(s.shape,i.shape),u=[];if(1===s.rank){for(let t=0;t<i.shape.length-1;++t)u.push(i.shape[t]);u.push(1)}const c=QT(i,s),d=AT(t,l),p=PC(kT(a,VT(r))),f=AT(AT(AT(p,p),p),VT(-.5));return{x:()=>1===s.rank?rI(AT(AT(t,pk(rI(p,[1,1,1,s.shape[0]]),u)),l),i.shape):rI(AT(AT(t,p),l),i.shape),mean:()=>{let t=AT(AT(p,VT(-1)),d);return 1===s.rank&&(t=ak(t,h)),rI(t,s.shape)},variance:()=>{let t=AT(AT(f,c),d);return 1===s.rank&&(t=ak(t,h)),rI(t,s.shape)},scale:()=>{const e=AT(c,p);let n=AT(t,e);return 1===s.rank&&(n=ak(n,h)),rI(n,s.shape)},offset:()=>{let e=t;return 1===s.rank&&(e=ak(e,h)),rI(e,s.shape)}}}},OM={kernelName:vv,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[r,i]=e,{axis:s}=n,a=Ig(s,r.shape)[0];return{x:()=>{const e=r.shape,n=i.size,o=e.slice(0,a),l=o.length,h=e.slice(s,e.length).slice(1),u=h.length,c=PM(0,l),d=PM(l+1,l+1+u),p=DM([o,[n],h]),f=rI(t,p),m=rI(i,[n]),g=DM([[l],c,d]),y=FE(f,g);let v=dN(y,m,r.shape[a]);const x=nk(g);return v=FE(v,x),v},indices:()=>i}}};function PM(t,e){const n=[];for(let r=t;r<e;++r)n.push(r);return n}function DM(t){const e=[];for(let n=0;n<t.length;++n)for(let r=0;r<t[n].length;++r)e.push(t[n][r]);return e}const FM={kernelName:wv,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>OT(n),b:()=>OT(r)}}},LM={kernelName:_v,gradFunc:t=>({x:()=>rT(t,"float32")})},BM={kernelName:Sv,gradFunc:t=>({x:()=>OT(t)})},$M={kernelName:Iv,gradFunc:t=>({x:()=>OT(t)})},UM={kernelName:kv,gradFunc:t=>({x:()=>OT(t)})},VM={kernelName:Cv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{alpha:i}=n,s=yk(r,0);return{x:()=>GI(s,t,AT(t,i))}}},zM={kernelName:Ov,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>NT(t,kT(n,1))}}},GM={kernelName:Mv,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>NT(t,rT(n,"float32"))}}},WM={kernelName:Bv,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r]=e,{axis:i}=n;return{logits:()=>{const e=uk(r);return QT(t,AT(ak(t,i,!0),e))}}}};const XM=Qw({localResponseNormalizationBackprop_:function(t,e,n,r=5,i=1,s=1,a=.5){const o={x:t,y:e,dy:n},l={depthRadius:r,bias:i,alpha:s,beta:a};return Uw.runKernel(Vv,o,l)}}),HM={kernelName:Uv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{depthRadius:s,bias:a,alpha:o,beta:l}=n;return{x:()=>XM(r,i,t,s,a,o,l)}}};function YM(t,e,n,r){return e.rank<n.rank&&(e=rI(e,QI(e.shape,r))),t.rank<n.rank&&(t=rI(t,QI(t.shape,r))),{x:()=>AT(t,rT(zI(n,e),t.dtype))}}const jM={kernelName:Gv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const r=n,{reductionIndices:i}=r,s=e[0],a=YM(t,e[1],s,Ig(i,s.shape));return{x:()=>a.x()}}},qM={kernelName:Wv,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>AT(t,rT(vk(n,r),"float32")),b:()=>AT(t,rT(Tk(n,r),"float32"))}}};const KM=Qw({maxPool3dGrad_:function(t,e,n,r,i,s,a){const o=Kw(t,"dy","maxPool3dGrad"),l=Kw(e,"input","maxPool3dGrad"),h=Kw(n,"output","maxPool3dGrad");let u=o,c=l,d=h,p=!1;4===l.rank&&(p=!0,u=rI(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=rI(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),d=rI(h,[1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]])),dg(5===u.rank,(()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`)),dg(5===c.rank,(()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${c.rank}.`)),dg(5===d.rank,(()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${d.rank}.`)),nI("maxPool3dGrad",s,a);const f={dy:u,input:c,output:d},m={filterSize:r,strides:i,pad:s,dimRoundingMode:a},g=Uw.runKernel(jv,f,m);return p?rI(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}}),ZM={kernelName:Yv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=n;return{x:()=>KM(t,r,i,s,a,o,l)}}};const JM=Qw({maxPoolGrad_:function(t,e,n,r,i,s,a){const o=Kw(t,"dy","maxPoolGrad"),l=Kw(e,"input","maxPoolGrad"),h=Kw(n,"output","maxPoolGrad");dg(l.rank===o.rank,(()=>`Rank of input (${l.rank}) does not match rank of dy (${o.rank})`)),dg(4===o.rank,(()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${o.rank}.`)),dg(4===l.rank,(()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`)),nI("maxPoolGrad",s,a);const u={dy:o,input:l,output:h},c={filterSize:r,strides:i,pad:s,dimRoundingMode:a};return Uw.runKernel(Hv,u,c)}}),QM={kernelName:Xv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{filterSize:s,strides:a,pad:o}=n;return{x:()=>JM(t,r,i,s,a,o)}}},tO={kernelName:Kv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:i}=n,s=Ig(i,r.shape),a=mg(JI(r.shape,s)[1]);return{x:()=>{const e=r.shape.slice();s.forEach((t=>{e[t]=1}));const n=rI(t,e);return NT(AT(n,Xk(r.shape,"float32")),a)}}}},eO={kernelName:Zv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const r=n,{axis:i}=r,[s,a]=e,o=YM(t,a,s,Ig(i,s.shape));return{x:()=>o.x()}}},nO={kernelName:Qv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const r=e[0],{paddings:i}=n,s=i.map((t=>t[0]));return{x:()=>lI(t,s,r.shape)}}},rO={kernelName:hx,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>Wk(n.shape,"float32")}}},iO={kernelName:cx,inputsToSave:["x"],gradFunc:(t,e,n)=>{const r=e[0],{paddings:i}=n,s=i.map((t=>t[0]));return{x:()=>lI(t,s,r.shape)}}},sO={kernelName:px,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,r,i]=e,s=n,a=r,o=iE(s.shape,a.shape);return{a:()=>{const e=rT(a,"float32");let n=AT(t,AT(e,JT(s,QT(e,VT(1)))));const r=rE(s.shape,o);return r.length>0&&(n=ak(n,r)),rI(n,s.shape)},b:()=>{const e=yk(s,0),n=GI(e,kk(s),OT(s));let r=AT(t,AT(i,n));const l=rE(a.shape,o);return l.length>0&&(r=ak(r,l)),rI(r,a.shape)}}}},aO={kernelName:fx,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,r]=e,i=yk(n,0);return{x:()=>GI(i,t,AT(t,r)),alpha:()=>{let e=GI(i,OT(t),AT(t,n));const s=rE(r.shape,t.shape);return s.length>0&&(e=ak(e,s)),rI(e,r.shape)}}}};function oO(t,e,n){const r=t.shape.length,i=r-n.length,s=ek(n,r);let a=t;null!=s&&(a=FE(t,s));const o=a.shape.slice(),l=o.splice(r-n.length,n.length).reduce(((t,e)=>t*e),1);o.push(l);let h=function(t,e,n){const r=t.shape.slice();r[n]=1;const i=rI(e,r),s=DI(t,n,!0,!1),a=DI(t,n,!0,!0),o=AT(s,a);return AT(i,o)}(a.reshape(o),e,i);if(h=h.reshape(a.shape),null!=s){const t=nk(s);h=FE(h,t)}return h}const lO={kernelName:mx,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:i}=n;let s=[];return s=null==i?r.shape.map(((t,e)=>e)):"number"==typeof i?[i]:i,{x:()=>oO(r,t,s)}}},hO={kernelName:wx,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>NT(t,PE(MT(n)))}}},uO={kernelName:Cx,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,r=AT(Ek(n,6),tN(n));return{x:()=>AT(t,rT(r,"float32"))}}},cO={kernelName:_x,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>AT(t,rT(tN(n),"float32"))}}},dO={kernelName:Tx,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>rI(t,n.shape)}}},pO={kernelName:Rx,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>PE(NT(t,AT(JT(n,1.5),2)))}}},fO={kernelName:Fx,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=yk(n,VT(0)),r=VT(iR),i=VT(sR),s=AT(t,i),a=AT(AT(t,r),uk(rT(n,"float32")));return GI(e,s,a)}}}},mO={kernelName:Bx,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>AT(OI(rT(n,"float32")),t)}}},gO={kernelName:$x,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>AT(PI(rT(n,"float32")),t)}}},yO={kernelName:Lx,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{begin:i,size:s}=n,a=r.shape,[o,l]=dS(r,i,s),h=[];for(let e=0;e<t.rank;e++)h.push([o[e],a[e]-o[e]-l[e]]);return{x:()=>nC(t,h)}}},vO={kernelName:zx,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>AT(t,oI(n))}}},xO={kernelName:Xx,gradFunc:(t,e,n)=>{const{blockShape:r,paddings:i}=n;return{x:()=>cI(t,r,i)}}},bO={kernelName:Hx,gradFunc:(t,e,n)=>{const{axis:r}=n;return{x:()=>aI(t,r)}}},wO={kernelName:Gx,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>NT(t,AT(RT(rT(n,"float32")),2))}}},_O={kernelName:tb,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>AT(t,AT(rT(n,"float32"),2))}}},TO={kernelName:Wx,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,i=r.shape.slice(),{axis:s}=n;Ig(s,r.shape).forEach((t=>{i[t]=1}));const a=rI(t,i),o=AT(a,Xk(r.shape,"float32"));return{x:()=>o}}},EO={kernelName:ob,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>NT(t,MT(OI(n)))}}},SO={kernelName:hb,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{reps:i}=n;return{x:()=>{let e=OT(r);if(1===r.rank)for(let n=0;n<i[0];++n)e=kT(e,lI(t,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)e=kT(e,lI(t,[n*r.shape[0],s*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)for(let a=0;a<i[2];++a)e=kT(e,lI(t,[n*r.shape[0],s*r.shape[1],a*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)for(let a=0;a<i[2];++a)for(let o=0;o<i[3];++o)e=kT(e,lI(t,[n*r.shape[0],s*r.shape[1],a*r.shape[2],o*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return e}}}},IO={kernelName:mb,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>function(t,e){const n=sE(e,OT(e)),r=gk(t,n);let i=vk(e,VT(0,"int32"));const s=r.rank-i.rank;for(let t=0;t<s;++t)i=ck(i,t+1);i=Ok(i,Xk(r.shape,"bool"));const a=OT(r);return GI(i,r,a)}(t,n)}}};const kO=[HR,YR,jR,qR,KR,ZR,JR,QR,tM,eM,nM,rM,sM,oM,lM,hM,uM,cM,dM,pM,fM,mM,yM,gM,xM,bM,wM,_M,TM,EM,{kernelName:rv,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=iE(n.shape,r.shape);return{a:()=>{const e=NT(t,rT(r,"float32")),s=rE(n.shape,i);return s.length>0?rI(ak(e,s),n.shape):e},b:()=>{let e=AT(t,rT(n,"float32"));const s=rE(r.shape,i);s.length>0&&(e=rI(ak(e,s),r.shape));const a=MT(r);return PE(NT(e,rT(a,"float32")))}}}},SM,IM,kM,CM,NM,RM,AM,MM,OM,FM,LM,BM,$M,UM,VM,zM,GM,WM,HM,jM,jM,qM,ZM,QM,tO,eO,{kernelName:Jv,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>AT(t,rT(Ek(n,r),"float32")),b:()=>AT(t,rT(yk(n,r),"float32"))}}},nO,{kernelName:tx,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=iE(n.shape,r.shape);return{a:()=>{const e=rE(n.shape,i);return e.length>0?rI(ak(t,e),n.shape):t},b:()=>{const e=AT(t,PE(mk(NT(n,r)))),s=rE(r.shape,i);return s.length>0?rI(ak(e,s),r.shape):e}}}},{kernelName:nx,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=iE(n.shape,r.shape);return{a:()=>{const e=AT(t,rT(r,"float32")),s=rE(n.shape,i);return s.length>0?rI(ak(e,s),n.shape):e},b:()=>{const e=AT(t,rT(n,"float32")),s=rE(r.shape,i);return s.length>0?rI(ak(e,s),r.shape):e}}}},{kernelName:rx,gradFunc:t=>({x:()=>PE(t)})},rO,{kernelName:lx,gradFunc:t=>({x:()=>OT(t)})},{kernelName:ux,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:r}=n;return pN(t,r).map((t=>()=>t))}},iO,iO,sO,aO,lO,hO,uO,cO,dO,{kernelName:Ix,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[r]=e,i={dy:t,images:r};return{images:()=>Uw.runKernel(kx,i,n)}}},{kernelName:Ex,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[r]=e,i={dy:t,images:r};return{images:()=>Uw.runKernel(Sx,i,n)}}},{kernelName:Nx,gradFunc:(t,e,n)=>{const{dims:r}=n,i=Ig(r,t.shape);return{x:()=>CC(t,i)}}},{kernelName:Ax,gradFunc:t=>({x:()=>OT(t)})},pO,{kernelName:Dx,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>rT(OT(n),"float32"),t:()=>AT(t,rT(n,t.dtype)),e:()=>AT(t,rT(Pk(n),t.dtype))}}},fO,{kernelName:Vx,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>AT(t,AT(n,QT(VT(1),n)))}}},{kernelName:Ux,gradFunc:t=>({x:()=>OT(t)})},mO,gO,yO,{kernelName:Yx,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r]=e,{dim:i}=n,s=AT(t,r);return{logits:()=>QT(s,AT(ak(s,[i],true),r))}}},vO,xO,xO,bO,bO,wO,{kernelName:Qx,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=VT(2);return{a:()=>AT(t,AT(i,QT(n,r))),b:()=>AT(t,AT(i,QT(r,n)))}}},_O,{kernelName:vb,gradFunc:t=>({x:()=>OT(t)})},{kernelName:ab,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=iE(n.shape,r.shape);return{a:()=>{let e=t;const r=rE(n.shape,i);return r.length>0&&(e=ak(e,r)),rI(e,n.shape)},b:()=>{let e=t;const n=rE(r.shape,i);return n.length>0&&(e=ak(e,n)),rI(PE(e),r.shape)}}}},TO,EO,{kernelName:lb,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>AT(QT(VT(1),MT(n)),t)}}},SO,{kernelName:db,gradFunc:(t,e,n)=>{const r=n,{perm:i}=r,s=nk(i);return{x:()=>FE(t,s)}}},{kernelName:fb,gradFunc:(t,e,n)=>{const r=n,{axis:i}=r;return{value:()=>QC(t,i)}}},IO,{kernelName:yb,gradFunc:t=>({x:()=>OT(t)})}];for(const t of kO)Mb(t);xw().prototype.abs=function(){return this.throwIfDisposed(),eE(this)},xw().prototype.acos=function(){return this.throwIfDisposed(),AS(this)},xw().prototype.acosh=function(){return this.throwIfDisposed(),RS(this)},xw().prototype.add=function(t){return this.throwIfDisposed(),kT(this,t)},xw().prototype.all=function(t,e){return this.throwIfDisposed(),OS(this,t,e)},xw().prototype.any=function(t,e){return this.throwIfDisposed(),PS(this,t,e)},xw().prototype.argMax=function(t){return this.throwIfDisposed(),DS(this,t)},xw().prototype.argMin=function(t){return this.throwIfDisposed(),FS(this,t)},xw().prototype.asScalar=function(){return this.throwIfDisposed(),dg(1===this.size,(()=>"The array must have only 1 element.")),rI(this,[])},xw().prototype.asType=function(t){return this.throwIfDisposed(),rT(this,t)},xw().prototype.as1D=function(){return this.throwIfDisposed(),rI(this,[this.size])},xw().prototype.as2D=function(t,e){return this.throwIfDisposed(),rI(this,[t,e])},xw().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),rI(this,[t,e,n])},xw().prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),rI(this,[t,e,n,r])},xw().prototype.as5D=function(t,e,n,r,i){return this.throwIfDisposed(),rI(this,[t,e,n,r,i])},xw().prototype.asin=function(){return this.throwIfDisposed(),LS(this)},xw().prototype.asinh=function(){return this.throwIfDisposed(),BS(this)},xw().prototype.atan=function(){return this.throwIfDisposed(),$S(this)},xw().prototype.atan2=function(t){return this.throwIfDisposed(),US(this,t)},xw().prototype.atanh=function(){return this.throwIfDisposed(),VS(this)},xw().prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),iI(this,t,e,n,r)},xw().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),cI(this,t,e)},xw().prototype.batchNorm=function(t,e,n,r,i){return this.throwIfDisposed(),dI(this,t,e,n,r,i)},xw().prototype.broadcastTo=function(t){return this.throwIfDisposed(),xI(this,t)},xw().prototype.cast=function(t){return this.throwIfDisposed(),rT(this,t)},xw().prototype.ceil=function(){return this.throwIfDisposed(),bI(this)},xw().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),wI(this,t,e)},xw().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof vw&&(t=[t]),aI([this,...t],e)},xw().prototype.conv1d=function(t,e,n,r,i,s){return this.throwIfDisposed(),kI(this,t,e,n,r,i,s)},xw().prototype.conv2dTranspose=function(t,e,n,r,i){return this.throwIfDisposed(),NI(this,t,e,n,r,i)},xw().prototype.conv2d=function(t,e,n,r,i,s){return this.throwIfDisposed(),II(this,t,e,n,r,i,s)},xw().prototype.cos=function(){return this.throwIfDisposed(),OI(this)},xw().prototype.cosh=function(){return this.throwIfDisposed(),PI(this)},xw().prototype.cumprod=function(t,e,n){return this.throwIfDisposed(),DI(this,t,e,n)},xw().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),FI(this,t,e,n)},xw().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),BI(this,t,e)},xw().prototype.depthwiseConv2d=function(t,e,n,r,i,s){return this.throwIfDisposed(),$I(this,t,e,n,r,i,s)},xw().prototype.dilation2d=function(t,e,n,r,i){return this.throwIfDisposed(),VI(this,t,e,n,r,i)},xw().prototype.divNoNan=function(t){return this.throwIfDisposed(),WI(this,t)},xw().prototype.div=function(t){return this.throwIfDisposed(),NT(this,t)},xw().prototype.dot=function(t){return this.throwIfDisposed(),XI(this,t)},xw().prototype.elu=function(){return this.throwIfDisposed(),YI(this)},xw().prototype.equal=function(t){return this.throwIfDisposed(),zI(this,t)},xw().prototype.erf=function(){return this.throwIfDisposed(),qI(this)},xw().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),hk(this,t,e)},xw().prototype.exp=function(){return this.throwIfDisposed(),uk(this)},xw().prototype.expandDims=function(t){return this.throwIfDisposed(),ck(this,t)},xw().prototype.expm1=function(){return this.throwIfDisposed(),dk(this)},xw().prototype.fft=function(){return this.throwIfDisposed(),HC(this)},xw().prototype.flatten=function(){return this.throwIfDisposed(),rI(this,[this.size])},xw().prototype.floor=function(){return this.throwIfDisposed(),mk(this)},xw().prototype.floorDiv=function(t){return this.throwIfDisposed(),CT(this,t)},xw().prototype.gather=function(t,e,n){return this.throwIfDisposed(),gk(this,t,e,n)},xw().prototype.greaterEqual=function(t){return this.throwIfDisposed(),vk(this,t)},xw().prototype.greater=function(t){return this.throwIfDisposed(),yk(this,t)},xw().prototype.ifft=function(){return this.throwIfDisposed(),YC(this)},xw().prototype.irfft=function(){return this.throwIfDisposed(),jC(this)},xw().prototype.isFinite=function(){return this.throwIfDisposed(),xk(this)},xw().prototype.isInf=function(){return this.throwIfDisposed(),bk(this)},xw().prototype.isNaN=function(){return this.throwIfDisposed(),wk(this)},xw().prototype.leakyRelu=function(t){return this.throwIfDisposed(),_k(this,t)},xw().prototype.lessEqual=function(t){return this.throwIfDisposed(),Ek(this,t)},xw().prototype.less=function(t){return this.throwIfDisposed(),Tk(this,t)},xw().prototype.localResponseNormalization=function(t,e,n,r){return this.throwIfDisposed(),Ik(this,t,e,n,r)},xw().prototype.logSigmoid=function(){return this.throwIfDisposed(),Ak(this)},xw().prototype.logSoftmax=function(t){return this.throwIfDisposed(),Rk(this,t)},xw().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),Mk(this,t,e)},xw().prototype.log=function(){return this.throwIfDisposed(),kk(this)},xw().prototype.log1p=function(){return this.throwIfDisposed(),Ck(this)},xw().prototype.logicalAnd=function(t){return this.throwIfDisposed(),Ok(this,t)},xw().prototype.logicalNot=function(){return this.throwIfDisposed(),Pk(this)},xw().prototype.logicalOr=function(t){return this.throwIfDisposed(),Dk(this,t)},xw().prototype.logicalXor=function(t){return this.throwIfDisposed(),Fk(this,t)},xw().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),RE(this,t,e,n)},xw().prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),Uk(this,t,e,n,r)},xw().prototype.max=function(t,e){return this.throwIfDisposed(),ik(this,t,e)},xw().prototype.maximum=function(t){return this.throwIfDisposed(),sE(this,t)},xw().prototype.mean=function(t,e){return this.throwIfDisposed(),Gk(this,t,e)},xw().prototype.min=function(t,e){return this.throwIfDisposed(),sk(this,t,e)},xw().prototype.minimum=function(t){return this.throwIfDisposed(),Yk(this,t)},xw().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),jk(this,t,e)},xw().prototype.mod=function(t){return this.throwIfDisposed(),qk(this,t)},xw().prototype.mul=function(t){return this.throwIfDisposed(),AT(this,t)},xw().prototype.neg=function(){return this.throwIfDisposed(),PE(this)},xw().prototype.norm=function(t,e,n){return this.throwIfDisposed(),lk(this,t,e,n)},xw().prototype.notEqual=function(t){return this.throwIfDisposed(),Qk(this,t)},xw().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),ME(this,t,e,n)},xw().prototype.onesLike=function(){return this.throwIfDisposed(),tC(this)},xw().prototype.pad=function(t,e){return this.throwIfDisposed(),nC(this,t,e)},xw().prototype.pool=function(t,e,n,r,i,s){return this.throwIfDisposed(),lC(this,t,e,n,r,i,s)},xw().prototype.pow=function(t){return this.throwIfDisposed(),JT(this,t)},xw().prototype.prelu=function(t){return this.throwIfDisposed(),hC(this,t)},xw().prototype.prod=function(t,e){return this.throwIfDisposed(),uC(this,t,e)},xw().prototype.reciprocal=function(){return this.throwIfDisposed(),SC(this)},xw().prototype.relu=function(){return this.throwIfDisposed(),IC(this)},xw().prototype.relu6=function(){return this.throwIfDisposed(),kC(this)},xw().prototype.reshapeAs=function(t){return this.throwIfDisposed(),rI(this,t.shape)},xw().prototype.reshape=function(t){return this.throwIfDisposed(),rI(this,t)},xw().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),oA(this,t,e,n)},xw().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),lA(this,t,e,n)},xw().prototype.reverse=function(t){return this.throwIfDisposed(),CC(this,t)},xw().prototype.rfft=function(){return this.throwIfDisposed(),KC(this)},xw().prototype.round=function(){return this.throwIfDisposed(),OC(this)},xw().prototype.rsqrt=function(){return this.throwIfDisposed(),PC(this)},xw().prototype.selu=function(){return this.throwIfDisposed(),DC(this)},xw().prototype.separableConv2d=function(t,e,n,r,i,s){return this.throwIfDisposed(),FC(this,t,e,n,r,i,s)},xw().prototype.sigmoid=function(){return this.throwIfDisposed(),oI(this)},xw().prototype.sign=function(){return this.throwIfDisposed(),BC(this)},xw().prototype.sin=function(){return this.throwIfDisposed(),$C(this)},xw().prototype.sinh=function(){return this.throwIfDisposed(),UC(this)},xw().prototype.slice=function(t,e){return this.throwIfDisposed(),lI(this,t,e)},xw().prototype.softmax=function(t){return this.throwIfDisposed(),XC(this,t)},xw().prototype.softplus=function(){return this.throwIfDisposed(),Nk(this)},xw().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),oC(this,t,e)},xw().prototype.split=function(t,e){return this.throwIfDisposed(),qC(this,t,e)},xw().prototype.sqrt=function(){return this.throwIfDisposed(),RT(this)},xw().prototype.square=function(){return this.throwIfDisposed(),MT(this)},xw().prototype.squaredDifference=function(t){return this.throwIfDisposed(),ZC(this,t)},xw().prototype.squeeze=function(t){return this.throwIfDisposed(),JC(this,t)},xw().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof vw?[this,t]:[this,...t];return QC(n,e)},xw().prototype.step=function(t){return this.throwIfDisposed(),tN(this,t)},xw().prototype.stridedSlice=function(t,e,n,r,i,s,a,o){return this.throwIfDisposed(),eN(this,t,e,n,r,i,s,a,o)},xw().prototype.sub=function(t){return this.throwIfDisposed(),QT(this,t)},xw().prototype.sum=function(t,e){return this.throwIfDisposed(),ak(this,t,e)},xw().prototype.tan=function(){return this.throwIfDisposed(),nN(this)},xw().prototype.tanh=function(){return this.throwIfDisposed(),hI(this)},xw().prototype.tile=function(t){return this.throwIfDisposed(),pk(this,t)},xw().prototype.toBool=function(){return this.throwIfDisposed(),rT(this,"bool")},xw().prototype.toFloat=function(){return this.throwIfDisposed(),rT(this,"float32")},xw().prototype.toInt=function(){return this.throwIfDisposed(),rT(this,"int32")},xw().prototype.topk=function(t,e){return this.throwIfDisposed(),hN(this,t,e)},xw().prototype.transpose=function(t){return this.throwIfDisposed(),FE(this,t)},xw().prototype.unique=function(t){return this.throwIfDisposed(),cN(this,t)},xw().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),dN(this,t,e)},xw().prototype.unstack=function(t){return this.throwIfDisposed(),pN(this,t)},xw().prototype.where=function(t,e){return this.throwIfDisposed(),GI(t,this,e)},xw().prototype.zerosLike=function(){return this.throwIfDisposed(),OT(this)};class CO extends Error{constructor(t){super(t),Object.setPrototypeOf(this,CO.prototype)}}class NO extends Error{constructor(t){super(t),Object.setPrototypeOf(this,NO.prototype)}}class AO extends Error{constructor(t){super(t),Object.setPrototypeOf(this,AO.prototype)}}class RO extends Error{constructor(t){super(t),Object.setPrototypeOf(this,RO.prototype)}}class MO extends Error{constructor(t){super(t),Object.setPrototypeOf(this,MO.prototype)}}Error;class OO{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let e;return this.cache.has(t)&&(e=this.cache.get(t),this.cache.delete(t),this.cache.set(t,e)),e}put(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){const t=this.cache.keys().next().value;this.cache.delete(t)}this.cache.set(t,e)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let e=0;e<this.maxEntries-t;e++){const t=this.cache.keys().next().value;this.cache.delete(t)}this.maxEntries=t}}function PO(t,e){if(Array.isArray(t)){let n=[];for(let r=0;r<e;r++)n=n.concat(t);return n}{const n=new Array(e);return n.fill(t),n}}function DO(t,e){if(!t)throw new MO(e)}function FO(t,e){let n=0;for(const r of t)r===e&&n++;return n}function LO(t){return 1===t.length?t[0]:t}function BO(t){return Array.isArray(t)?t:[t]}function $O(t){const e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==e[0]?e:"private"+e}function UO(t){return t.length<=1||-1===t.indexOf("_")?t:t.replace(/[_]+(\w|$)/g,((t,e)=>e.toUpperCase()))}let VO={};function zO(t){if(null==t)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function GO(t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))t.forEach((t=>GO(t)));else{const e=Object.keys(t);for(const n of e){const e=t[n];null!=e&&"object"==typeof e&&(Array.isArray(e)||"ndarray"!==e.type||"number"!=typeof e.value?GO(e):t[n]=e.value)}}}function WO(t,e={},n={},r="object",i=!1){if("string"==typeof t){const i=t;let s;if(i in n)s=n[i];else if(i in VO)s=VO[i];else if(s=e[i],null==s)throw new AO(`Unknown ${r}: ${t}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return s}{const s=t;if(null==s.className||null==s.config)throw new AO(`${r}: Improper config format: ${JSON.stringify(s)}.\n'className' and 'config' must set.`);const a=s.className;let o,l;if(a in n?[o,l]=n[a]:a in VO?[o,l]=VO.className:a in e&&([o,l]=e[a]),null==o)throw new AO(`Unknown ${r}: ${a}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(null!=l){const t={};for(const e of Object.keys(VO))t[e]=VO[e];for(const e of Object.keys(n))t[e]=n[e];s.config.customObjects=t;const e=Object.assign({},VO);for(const t of Object.keys(n))VO[t]=n[t];GO(s.config);const r=l(o,s.config,n,i);return VO=Object.assign({},e),r}{const t=Object.assign({},VO);for(const t of Object.keys(n))VO[t]=n[t];const e=new o(s.config);return VO=Object.assign({},t),e}}}function XO(t,e){return-1*function(t,e){return t<e?-1:t>e?1:0}(t,e)}function HO(t){if(null==t)return t;const e=[];for(const n of t)-1===e.indexOf(n)&&e.push(n);return e}function YO(t){if(null==t)throw new AO(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function jO(t,e,n){if(null!=n&&t.indexOf(n)<0)throw new AO(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function qO(t,e,n=0,r=1/0){return DO(n>=0),DO(r>=n),Array.isArray(t)&&t.length>=n&&t.length<=r&&t.every((t=>typeof t===e))}function KO(t,e){Array.isArray(t)?(dg(t.length>0,(()=>`${e} is unexpectedly an empty array.`)),t.forEach(((t,n)=>KO(t,`element ${n+1} of ${e}`)))):dg(Number.isInteger(t)&&t>0,(()=>`Expected ${e} to be a positive integer, but got ${ZO(t)}.`))}function ZO(t){return null===t?"null":Array.isArray(t)?"["+t.map((t=>ZO(t))).join(",")+"]":"string"==typeof t?`"${t}"`:`${t}`}function JO(t){return"relu"===t?"relu":"linear"===t?"linear":"elu"===t?"elu":null}let QO=0;function tP(){return QO++}const eP={};function nP(t=""){return t in eP||(eP[t]=0),eP[t]+=1,t+eP[t].toString()}const rP=["channelsFirst","channelsLast"],iP=["nearest","bilinear"],sP=["valid","same","causal"],aP=["max","avg"],oP=["sum","mul","concat","ave"],lP=new Map;function hP(t){jO(rP,"DataFormat",t)}function uP(t){jO(sP,"PaddingMode",t)}function cP(t){jO(aP,"PoolMode",t)}const dP=[];function pP(t,e){dP.push(t);try{const t=e();return dP.pop(),t}catch(t){throw dP.pop(),t}}function fP(t){if(!yP(t))throw new Error("Not a valid tensor name: '"+t+"'");return(0===dP.length?"":dP.join("/")+"/")+t}function mP(t){if(!yP(t))throw new Error("Not a valid tensor name: '"+t+"'");lP.has(t)||lP.set(t,0);const e=lP.get(t);if(lP.set(t,lP.get(t)+1),e>0){const n=`${t}_${e}`;return lP.set(n,1),n}return t}const gP=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function yP(t){return!!t.match(gP)}function vP(t){return t===parseInt(t.toString(),10)}function xP(t,e,n){null==e&&(e=0),null==n&&(n=t.length);let r=1;for(let i=e;i<n;++i)r*=t[i];return r}function bP(t){if(0===t.length)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const r=t[n];r<e&&(e=r)}return e}function wP(t){if(0===t.length)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const r=t[n];r>e&&(e=r)}return e}function _P(t,e){if(e<t)throw new AO(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let r=t;r<e;++r)n.push(r);return n}let TP;function EP(){return null==TP&&(TP=ST().epsilon()),TP}function SP(t,e){return rT(t,e)}function IP(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),rI(t,n)}function kP(t,e,n){return fT((()=>{switch(t.rank){case 1:return VC(t,e,n);case 2:return zC(t,[e,0],[n,t.shape[1]]);case 3:return GC(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return WC(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return lI(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return lI(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new AO(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function CP(t,e,n){return fT((()=>{switch(t.rank){case 1:return VC(t,e,n);case 2:return zC(t,[0,e],[t.shape[0],n]);case 3:return GC(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return WC(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new AO(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function NP(t,e,n,r){return fT((()=>{switch(t.rank){case 1:return VC(t,e,n);case 2:switch(r){case 1:return kP(t,e,n);case 2:return CP(t,e,n);default:throw new AO(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return kP(t,e,n);case 2:return GC(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return CP(t,e,n);default:throw new AO(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return kP(t,e,n);case 2:return WC(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return WC(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return CP(t,e,n);default:throw new AO(`The axis is not within the rank of the tensor ${r}`)}default:throw new AO(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function AP(t,e=-1){let n;return e<0&&(n=t[0].rank,e=0!==n?n:0),e===t[0].rank&&(e=-1),aI(t,e)}function RP(t,e){switch(t.rank){case 1:return _I([t,e]);case 2:return TI([t,e],0);case 3:return EI([t,e],0);case 4:return SI([t,e],0);default:throw new AO(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function MP(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new AO(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return pk(t,e)}function OP(t,e=0,n=1,r,i){return bC(t,e,n,r,i)}function PP(t,e,n,r){if(t.rank<2||e.rank<2)throw new RO(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){if(t.shape.slice(-1)[0]!==e.shape.slice(-2)[0])throw new RO(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(2===t.rank&&2===e.rank){return FN({a:t,b:e,transposeA:!1,transposeB:!1,bias:r?LP(t.rank,r,"channelsLast"):null,activation:n})}{const i=t.shape.slice(),s=i.pop();t=rI(t,[-1,s]);const a=e.shape.slice(),o=a.pop(),l=a.pop(),h=[...a,o],u=Array.from({length:e.rank},((t,n)=>0===n?e.rank-2:n<=e.rank-2?n-1:n));e=rI(FE(e,u),[l,-1]);const c=[...i,...h];return rI(FN({a:t,b:e,transposeA:!1,transposeB:!1,bias:r?LP(t.rank,r,"channelsLast"):null,activation:n}),c)}}function DP(t,e,n){return fT((()=>(e=Array.isArray(e)?rN(e,"int32"):rT(e,"int32"),gk(t,e,n))))}function FP(t){return AT(t,t)}function LP(t,e,n){const r=e.shape;if(1!==e.rank&&e.rank!==t)throw new AO(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(5===t){if("channelsFirst"===n)return 1===r.length?rI(e,[1,r[0],1,1,1]):rI(e,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?rI(e,[1,1,1,1,r[0]]):rI(e,[1].concat(r))}else if(4===t){if("channelsFirst"===n)return 1===r.length?rI(e,[1,r[0],1,1]):rI(e,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?rI(e,[1,1,1,r[0]]):rI(e,[1].concat(r))}else if(3===t){if("channelsFirst"===n)return 1===r.length?rI(e,[1,r[0],1]):rI(e,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?rI(e,[1,1,r[0]]):rI(e,[1].concat(r))}else if(t<3)return e;throw new AO(`Unsupported input rank by biasAdd: ${e.rank}`)}function BP(t,e,n){return fT((()=>(null==n&&(n="channelsLast"),hP(n),kT(t,LP(t.rank,e,n)))))}function $P(t,e,n,r){return fT((()=>TN(t,e,n,r)))}function UP(t,e,n=!1){return n?t():e()}const VP=["fanIn","fanOut","fanAvg"],zP=["normal","uniform","truncatedNormal"];class GP extends WT{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class WP extends GP{apply(t,e){return Wk(t,e)}}WP.className="Zeros",HT(WP);class XP extends GP{apply(t,e){return Xk(t,e)}}XP.className="Ones",HT(XP);class HP extends GP{constructor(t){if(super(),"object"!=typeof t)throw new AO(`Expected argument of type ConstantConfig but got ${t}`);if(void 0===t.value)throw new AO(`config must have value set but got ${t}`);this.value=t.value}apply(t,e){return fT((()=>AT(VT(this.value),Xk(t,e))))}getConfig(){return{value:this.value}}}HP.className="Constant",HT(HP);class YP extends GP{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,e){return _C(t,this.minval,this.maxval,e,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}YP.className="RandomUniform",HT(YP);class jP extends GP{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new RO(`randomNormal does not support dType ${e}.`);return OP(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}jP.className="RandomNormal",HT(jP);class qP extends GP{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new RO(`truncatedNormal does not support dType ${e}.`);return uN(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}qP.className="TruncatedNormal",HT(qP);class KP extends GP{constructor(t){super(),this.gain=null!=t.gain?t.gain:1}apply(t,e){return fT((()=>{if(2!==t.length||t[0]!==t[1])throw new AO("Identity matrix initializer can only be used for 2D square matrices.");return AT(this.gain,fk(t[0]))}))}getConfig(){return{gain:this.gain}}}KP.className="Identity",HT(KP);class ZP extends GP{constructor(t){if(super(),t.scale<0)throw new AO(`scale must be a positive float. Got: ${t.scale}`);var e;this.scale=null==t.scale?1:t.scale,this.mode=null==t.mode?"fanIn":t.mode,e=this.mode,jO(VP,"FanMode",e),this.distribution=null==t.distribution?"normal":t.distribution,function(t){jO(zP,"Distribution",t)}(this.distribution),this.seed=t.seed}apply(t,e){const n=function(t,e="channelsLast"){let n,r;if(hP(e),2===t.length)n=t[0],r=t[1];else if(-1!==[3,4,5].indexOf(t.length)){if("channelsFirst"===e){const e=xP(t,2);n=t[1]*e,r=t[0]*e}else if("channelsLast"===e){const e=xP(t,0,t.length-2);n=t[t.length-2]*e,r=t[t.length-1]*e}}else{const e=xP(t);n=Math.sqrt(e),r=Math.sqrt(e)}return[n,r]}(t),r=n[0],i=n[1];let s=this.scale;if("fanIn"===this.mode?s/=Math.max(1,r):"fanOut"===this.mode?s/=Math.max(1,i):s/=Math.max(1,(r+i)/2),"normal"===this.distribution){const n=Math.sqrt(s);if("float32"!==(e=e||"float32")&&"int32"!==e)throw new RO(`${this.getClassName()} does not support dType ${e}.`);return uN(t,0,n,e,this.seed)}{const n=Math.sqrt(3*s);return _C(t,-n,n,e,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}ZP.className="VarianceScaling",HT(ZP);class JP extends ZP{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return ZP.className}}JP.className="GlorotUniform",HT(JP);class QP extends ZP{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return ZP.className}}QP.className="GlorotNormal",HT(QP);class tD extends ZP{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return ZP.className}}tD.className="HeNormal",HT(tD);class eD extends ZP{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return ZP.className}}eD.className="HeUniform",HT(eD);class nD extends ZP{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return ZP.className}}nD.className="LeCunNormal",HT(nD);class rD extends ZP{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return ZP.className}}rD.className="LeCunUniform",HT(rD);class iD extends GP{constructor(t){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=null==t.gain?this.DEFAULT_GAIN:t.gain,this.seed=t.seed}apply(t,e){return fT((()=>{if(t.length<2)throw new RO("Shape must be at least 2D.");if("int32"!==e&&"float32"!==e&&void 0!==e)throw new TypeError(`Unsupported data type ${e}.`);e=e;const n=mg(t.slice(0,-1)),r=t[t.length-1];this.ELEMENTS_WARN_SLOW;const i=OP([Math.max(r,n),Math.min(r,n)],0,1,e,this.seed),s=FA.qr(i,!1);let a=s[0];const o=s[1].flatten().stridedSlice([0],[Math.min(r,n)*Math.min(r,n)],[Math.min(r,n)+1]);return a=AT(a,o.sign()),n<r&&(a=a.transpose()),AT(VT(this.gain),a.reshape(t))}))}getConfig(){return{gain:this.gain,seed:this.seed}}}iD.className="Orthogonal",HT(iD);const sD={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function aD(t,e={}){return WO(t,XT.getMap().classNameMap,e,"initializer")}function oD(t){return zO(t)}function lD(t){if("string"==typeof t){const e=t in sD?sD[t]:t;if("GlorotNormal"===e)return new QP;if("GlorotUniform"===e)return new JP;if("HeNormal"===e)return new tD;if("HeUniform"===e)return new eD;if("LeCunNormal"===e)return new nD;if("LeCunUniform"===e)return new rD;{const t={};return t.className=e,t.config={},aD(t)}}return t instanceof GP?t:aD(t)}function hD(t){return Array.isArray(t)&&Array.isArray(t[0])}function uD(t){return 0===t.length?[]:Array.isArray(t[0])?t:[t]}function cD(t){let e;if(Array.isArray(t)){if(1!==t.length)throw new AO(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function dD(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(1===t.length)return(t=t)[0];throw new AO(`Expected exactly 1 Shape; got ${t.length}`)}return t}function pD(t){let e=0;for(const n of t)0===n.shape.length?e+=1:e+=n.shape.reduce(((t,e)=>t*e));return e}const fD="Variable";class mD{constructor(t,e="float32",n="Variable",r=!0,i=null){this.dtype=null==e?"float32":e,this.shape=t.shape,this.id=tP(),n=null==n?fD:n,this.originalName=fP(n),this.name=mP(this.originalName),this.trainable_=r,this.constraint=i,this.val=mN(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),function(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}(this.val,t),this.val.id!==t.id&&(this.val.assign(t),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function gD(t){return t.map((t=>t.read()))}function yD(t){t.forEach((t=>{t[0].write(t[1])}))}class vD{constructor(t){this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class xD{constructor(t,e,n,r,i,s,a){this.dtype=t,this.shape=e,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=tP(),null!=s&&(this.originalName=fP(s),this.name=mP(this.originalName)),this.rank=e.length}}let bD=0;class wD{constructor(t,e){this.callArgs=e,this.id=bD++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const e of t.inboundLayers)null!=e&&e.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const e of this.inboundLayers)null!=e?t.push(e.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let _D=0;class TD extends WT{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=_D++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=t.name;if(!e){const t=this.getClassName();e=$O(t)+"_"+nP(t)}if(this.name=e,this.trainable_=null==t.trainable||t.trainable,null!=t.inputShape||null!=t.batchInputShape){let e;if(null!=t.batchInputShape)e=t.batchInputShape;else if(null!=t.inputShape){let n=null;null!=t.batchSize&&(n=t.batchSize),e=[n].concat(t.inputShape)}this.batchInputShape=e;let n=t.dtype;null==n&&(n=t.inputDType),null==n&&(n="float32"),this.dtype=n}null!=t.weights?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,e){return t.name+"_ib-"+e.toString()}getNodeAtIndex(t,e){if(0===this.inboundNodes.length)throw new NO(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=t)throw new AO(`Asked to get ${e} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return LO(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return LO(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new CO(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(0===this.inboundNodes.length)throw new CO(`Layer ${this.name} is not connected, no input to return.`);return LO(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new CO(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new CO(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return LO(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map((t=>t()))}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach((e=>e.trainable=t)),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter((t=>t.trainable)):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter((t=>!t.trainable)).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){if(t=BO(t),null==this.inputSpec||0===this.inputSpec.length)return;const e=BO(this.inputSpec);if(t.length!==e.length)throw new AO(`Layer ${this.name} expects ${e.length} inputs, but it received ${t.length} input tensors. Input received: ${t}`);for(let n=0;n<t.length;n++){const r=t[n],i=e[n];if(null==i)continue;const s=r.rank;if(null!=i.ndim&&s!==i.ndim)throw new AO(`Input ${n} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${s}`);if(null!=i.maxNDim&&s>i.maxNDim)throw new AO(`Input ${n} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${s}`);if(null!=i.minNDim&&s<i.minNDim)throw new AO(`Input ${n} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${s}.`);if(null!=i.dtype&&r.dtype!==i.dtype)throw new AO(`Input ${n} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${r.dtype}.`);if(i.axes){const t=r.shape;for(const e in i.axes){const r=Number(e),s=i.axes[e],a=r>=0?t[r]:t[t.length+r];if(null!=s&&-1===[s,null].indexOf(a))throw new AO(`Input ${n} is incompatible with layer ${this.name}: expected axis ${r} of input shape to have value ${s} but got shape ${t}.`)}}if(null!=i.shape)for(let t=0;t<i.shape.length;++t){const e=i.shape[t],s=r.shape[t];if(null!=e&&null!=s&&e!==s)throw new AO(`Input ${n} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${r.shape}.`)}}}call(t,e){return t}invokeCallHook(t,e){null!=this._callHook&&this._callHook(t,e)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,e){e=e||{},this.assertNotDisposed();const n=BO(t);let r=!0;for(const t of n)if(!(t instanceof xD)){r=!1;break}let i=!0;for(const t of n)if(t instanceof xD){i=!1;break}if(r===i)throw new AO("Arguments to apply() must be all SymbolicTensors or all Tensors");return pP(this.name,(()=>{if(!this.built){this.assertInputCompatibility(t);const e=[];for(const n of BO(t))e.push(n.shape);this.build(LO(e)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&i&&(this._refCount=1)}if(this.assertInputCompatibility(t),i){let r=this.call(t,e);const i=BO(r),s=[];for(let t of i)-1!==n.indexOf(t)&&(t=t.clone()),s.push(t);if(r=LO(s),null!=this.activityRegularizer)throw new RO("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}{const n=function(t){t=BO(t);const e=[];for(const n of t)e.push(n.shape);return LO(e)}(t),r=this.computeOutputShape(n);let i;const s="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(t)?n[0]:n),i=null!=r&&r.length>0&&Array.isArray(r[0])?r.map(((n,r)=>new xD(s,n,this,BO(t),e,this.name,r))):new xD(s,r,this,BO(t),e,this.name),this.addInboundNode(t,i,null,null,n,r,e),this._refCount++,null!=this.activityRegularizer)throw new RO("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}}))}warnOnIncompatibleInputShape(t){if(null!=this.batchInputShape)if(t.length!==this.batchInputShape.length);else{let e=!1;this.batchInputShape.forEach(((n,r)=>{null!=n&&null!=t[r]&&t[r]!==n&&(e=!0)}))}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new CO(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const e of this.inboundNodes){const n=JSON.stringify(e.outputShapes);-1===t.indexOf(n)&&t.push(n)}if(1===t.length){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&1===t.length?t[0]:t}throw new CO(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new NO(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return pD(this.weights)}build(t){this.built=!0}getWeights(t=!1){return gD(t?this.trainableWeights:this.weights)}setWeights(t){fT((()=>{const e=this.weights;if(e.length!==t.length)throw new AO(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${e.length} weights. Provided weights: ${t}...`);if(0===e.length)return;const n=[],r=gD(e);for(let i=0;i<r.length;++i){const s=r[i],a=e[i],o=t[i];if(!vg(s.shape,o.shape))throw new AO(`Layer weight shape ${s.shape} not compatible with provided weight shape ${o.shape}`);n.push([a,o])}yD(n)}))}addWeight(t,e,n,r,i,s,a,o){if(-1!==this._addedWeightNames.indexOf(t))throw new AO(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=o?o():lD("zeros"));const l=r.apply(e,n),h=new mD(l,n,t,s,a);return l.dispose(),null!=i&&this.addLoss((()=>i.apply(h.read()))),null==s&&(s=!0),s?this._trainableWeights.push(h):this._nonTrainableWeights.push(h),h}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){null==t||Array.isArray(t)&&0===t.length||(t=BO(t),void 0!==this._losses&&null!==this._losses&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,e){if(!this.supportsMasking){if(null!=e){if(!Array.isArray(e))throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);e.forEach((t=>{if(null!=t)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)}))}return null}return e}addInboundNode(t,e,n,r,i,s,a=null){const o=BO(t);e=BO(e),n=BO(n),r=BO(r),i=uD(i),s=uD(s);const l=[],h=[],u=[];for(const t of o)l.push(t.sourceLayer),h.push(t.nodeIndex),u.push(t.tensorIndex);new wD({outboundLayer:this,inboundLayers:l,nodeIndices:h,tensorIndices:u,inputTensors:o,outputTensors:e,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:s},a);for(let t=0;t<e.length;t++)e[t].sourceLayer=this,e[t].nodeIndex=this.inboundNodes.length-1,e[t].tensorIndex=t}getConfig(){const t={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(t.batchInputShape=this.batchInputShape),null!=this.dtype&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach((t=>t.dispose())),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(null===this._refCount)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return 0==--this._refCount&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function ED(t,e,n){if((null==e||null!=n&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),0===e.inboundNodes.length)return[t];{const t=e.inboundNodes[n];if(0===t.inboundLayers.length)return t.inputTensors;{const e=[];for(let n=0;n<t.inboundLayers.length;n++){const r=ED(t.inputTensors[n],t.inboundLayers[n],t.nodeIndices[n]);for(const t of r)-1===e.indexOf(t)&&e.push(t)}return e}}}class SD extends TD{constructor(t){if(super({dtype:t.dtype,name:null!=t.name?t.name:nP("input").toString()}),null==t.batchSize&&(t.batchSize=null),null==t.sparse&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,null!=t.inputShape&&null!=t.batchInputShape)throw new AO("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let e=t.batchInputShape;if(null==e){if(null==t.inputShape)throw new AO("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");e=[t.batchSize].concat(t.inputShape)}else if(null!=t.batchSize)throw new AO("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=t.dtype||"float32";this.batchInputShape=e,this.dtype=n,this.inputSpec=[{shape:e}];const r=new xD(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new wD({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[e],outputShapes:[e]})}apply(t,e){throw new AO(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}function ID(t){if(null==t.batchShape&&null==t.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=t.batchShape&&null!=t.shape)throw new AO("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;null!=t.shape&&null==e&&(e=[null].concat(t.shape));let n=t.dtype;null==n&&(n="float32");return new SD({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}SD.className="InputLayer",HT(SD);class kD{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof kD)for(const e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(null==t)return;for(const e of t)this.add(e.key,e.value)}}add(t,e,n){if(null!=this.id2Value[t.id])throw new AO(`Duplicate key: name=${t.name}, id=${t.id}`);return this.id2Value[t.id]=function(t,e){if(null==t.dtype||t.dtype===e.dtype)return e;try{return rT(e,t.dtype)}catch(n){throw new AO(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}(t,e),this.name2Id[t.name]=t.id,null!=n&&(this.id2Mask[t.id]=n),this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return null!=this.id2Value[t.id]}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof xD){if(null==this.id2Value[t.id])throw new AO(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}{const e=this.name2Id[t];if(null==e)throw new AO(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[e]}}getMask(t){if(t instanceof xD){if(null==this.id2Value[t.id])throw new AO(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}{const e=this.name2Id[t];if(null==e)throw new AO(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[e]}}disposeMasks(){null!=this.id2Mask&&mT(this.id2Mask)}}const CD=new OO,ND=new OO;function AD(t,e,n,r){const i=null!=n&&n.training,s=Array.isArray(t),a=s?t:[t],o=a.map((t=>t.name)),l=[],h=e.names();for(const t of o)-1!==h.indexOf(t)?l.push(e.getValue(t)):l.push(null);null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const u=o.join(",")+"|"+e.names().sort().join(",");let c,d=CD.get(u);if(null==d){const t=function(t,e){dg(null!=t&&t.length>0,(()=>"Expected at least one fetch, got none"));let n=[],r={};if(1===t.length){const i=MD(t[0],e);n=i.sorted,r=i.recipientMap}else{const i=new Set;for(const s of t){const{sorted:t,recipientMap:a}=MD(s,e);for(const e of t)i.has(e.name)||(n.push(e),i.add(e.name));for(const t in a)null==r[t]&&(r[t]=new Set),a[t].forEach((e=>r[t].add(e)))}}return{sorted:n,recipientCounts:RD(r)}}(a,e);d=t.sorted,c=t.recipientCounts,CD.put(u,d),ND.put(u,c)}c={},i||Object.assign(c,ND.get(u));const p=new kD(e);for(let t=0;t<d.length;++t){if(null!=r){const t=dT().numTensors;t>r.maxNumTensors&&(r.maxNumTensors=t),t<r.minNumTensors&&(r.minNumTensors=t)}const s=d[t],a=s.sourceLayer;if(a instanceof SD)continue;const h=[],u=[],f=[];let m=!1;for(const t of s.inputs){const n=p.getValue(t),r=p.getMask(t);h.push(n),u.push(r),null!=r&&(m=!0),i||(c[t.name]--,0!==c[t.name]||e.hasKey(t)||-1!==o.indexOf(t.name)||n.isDisposed||!0===t.sourceLayer.stateful||f.push(n))}m&&((n=n||{}).mask=u[0]);const g=BO(a.apply(h,n));let y=null;a.supportsMasking&&(y=a.computeMask(h,u));const v=OD(s),x=Array.isArray(v)?v:[v];for(let t=0;t<x.length;++t){p.hasKey(x[t])||p.add(x[t],g[t],Array.isArray(y)?y[0]:y);const e=o.indexOf(x[t].name);-1!==e&&(l[e]=g[t])}i||mT(f)}return p.disposeMasks(),s?l:l[0]}function RD(t){const e={};for(const n in t)e[n]=t[n].size;return e}function MD(t,e){const n=new Set,r=[],i={};for(const t of e.names())n.add(t);const s=[],a=[];for(s.push(t);s.length>0;){const t=s[s.length-1];if(n.has(t.name)){s.pop();continue}const e=a[a.length-1]===s.length-1;if(0===t.inputs.length||e)s.pop(),r.push(t),n.add(t.name),e&&a.pop();else{a.push(s.length-1);for(const e of t.inputs)null==i[e.name]&&(i[e.name]=new Set),i[e.name].add(t.name),n.has(e.name)||s.push(e)}}return{sorted:r,recipientMap:i}}function OD(t){let e;if(1===t.sourceLayer.inboundNodes.length)e=t.sourceLayer.output;else{let n=null;for(let e=0;e<t.sourceLayer.inboundNodes.length;++e)for(const r of t.sourceLayer.inboundNodes[e].outputTensors)if(r.id===t.id){n=e;break}e=t.sourceLayer.getOutputAt(n)}return e}function PD(t,e){return fT((()=>RT(ak(AT(t,t),e,!0))))}ey().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(()=>100),(function(t){null!=CD&&CD.setMaxEntries(t),null!=ND&&ND.setMaxEntries(t)}));class DD extends WT{getConfig(){return{}}}class FD extends DD{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=t.maxValue?t.maxValue:this.defaultMaxValue,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return fT((()=>{const e=PD(t,this.axis),n=wI(e,0,this.maxValue);return AT(t,NT(n,kT(EP(),e)))}))}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}FD.className="MaxNorm",HT(FD);class LD extends DD{constructor(t){super(),this.defaultAxis=0,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return fT((()=>NT(t,kT(EP(),PD(t,this.axis)))))}getConfig(){return{axis:this.axis}}}LD.className="UnitNorm",HT(LD);class BD extends DD{apply(t){return IC(t)}}BD.className="NonNeg",HT(BD);class $D extends DD{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=t.minValue?t.minValue:this.defaultMinValue,this.maxValue=null!=t.maxValue?t.maxValue:this.defaultMaxValue,this.rate=null!=t.rate?t.rate:this.defaultRate,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return fT((()=>{const e=PD(t,this.axis),n=kT(AT(this.rate,wI(e,this.minValue,this.maxValue)),AT(1-this.rate,e));return AT(t,NT(n,kT(EP(),e)))}))}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}$D.className="MinMaxNorm",HT($D);const UD={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function VD(t){return zO(t)}function zD(t,e={}){return WO(t,XT.getMap().classNameMap,e,"constraint")}function GD(t){if(null==t)return null;if("string"==typeof t){return zD({className:t in UD?UD[t]:t,config:{}})}return t instanceof DD?t:zD(t)}function WD(t){return new FD(t)}function XD(t){return new LD(t)}function HD(){return new BD}function YD(t){return new $D(t)}function jD(){return new WP}function qD(){return new XP}function KD(t){return new HP(t)}function ZD(t){return new YP(t)}function JD(t){return new jP(t)}function QD(t){return new qP(t)}function tF(t){return new KP(t)}function eF(t){return new ZP(t)}function nF(t){return new JP(t)}function rF(t){return new QP(t)}function iF(t){return new tD(t)}function sF(t){return new eD(t)}function aF(t){return new nD(t)}function oF(t){return new rD(t)}function lF(t){return new iD(t)}async function hF(t){if(null==t)return;const e=[],n=[],r=[];for(const i in t){const s=t[i];if("number"!=typeof s){const t=s;e.push(t.data()),n.push(i),r.push(t)}}if(e.length>0){const i=await Promise.all(e);for(let e=0;e<i.length;++e)t[n[e]]=i[e][0];mT(r)}}function uF(t){if(null!=t)for(const e in t){const n=t[e];"number"!=typeof n&&n.dispose()}}var cF;!function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"}(cF||(cF={}));class dF{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,e){}async onEpochEnd(t,e){}async onBatchBegin(t,e){}async onBatchEnd(t,e){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class pF{constructor(t,e=10){null==t&&(t=[]),this.callbacks=t,this.queueLength=e}append(t){this.callbacks.push(t)}setParams(t){for(const e of this.callbacks)e.setParams(t)}setModel(t){for(const e of this.callbacks)e.setModel(t)}async onEpochBegin(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onEpochBegin(t,e)}async onEpochEnd(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onEpochEnd(t,e)}async onBatchBegin(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onBatchBegin(t,e)}async onBatchEnd(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onBatchEnd(t,e)}async onTrainBegin(t){null==t&&(t={});for(const e of this.callbacks)await e.onTrainBegin(t)}async onTrainEnd(t){null==t&&(t={});for(const e of this.callbacks)await e.onTrainEnd(t)}}class fF extends dF{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,e){null==e&&(e={});const n=null==e.size?0:e.size;this.seen+=n;for(const t in e){const r=e[t];if("number"==typeof r)this.totals.hasOwnProperty(t)||(this.totals[t]=0),this.totals[t]=this.totals[t]+r*n;else{let e;t in this.totals?e=this.totals[t]:this.totals[t]=0;const i=fT((()=>kT(this.totals[t],AT(r,n))));this.totals[t]=i,null!=e&&e.dispose()}}}async onEpochEnd(t,e){if(null!=e)for(const t of this.params.metrics)null!=this.totals[t]&&("number"==typeof this.totals[t]?e[t]=this.totals[t]/this.seen:fT((()=>{const n=AT(NT(1,this.seen),this.totals[t]);e[t]=n,this.totals[t].dispose(),gT(e[t])})))}}class mF extends dF{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,e){null==e&&(e={}),this.epoch.push(t);for(const t in e)null==this.history[t]&&(this.history[t]=[]),this.history[t].push(e[t])}async syncData(){const t=[],e=[],n=[];for(const r in this.history){const i=this.history[r];for(let s=0;s<i.length;++s)if("number"!=typeof i[s]){const a=i[s];t.push(a.data()),e.push(r),n.push(s)}}const r=await Promise.all(t);for(let t=0;t<r.length;++t){this.history[e[t]][n[t]].dispose(),this.history[e[t]][n[t]]=r[t][0]}}}class gF extends dF{constructor(t,e){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||zA,this.yieldEvery=e||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=t.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Lg(this.yieldEvery)&&(this.maybeWait=function(t,e,n){let r,i=null!=n?n():tw();return(...s)=>{const a=null!=n?n():tw();return a-i<e||(i=a,r=t(...s)),r}}(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,e,n){const r=[];null!=this.yield&&(await hF(n),r.push(this.yield(t,e,n))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(t,e){this.currentEpoch=t,null!=this.epochBegin&&(await hF(e),await this.epochBegin(t,e))}async onEpochEnd(t,e){const n=[];null!=this.epochEnd&&(await hF(e),n.push(this.epochEnd(t,e))),"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(t,e){null!=this.batchBegin&&(await hF(e),await this.batchBegin(t,e))}async onBatchEnd(t,e){const n=[];null!=this.batchEnd&&(await hF(e),n.push(this.batchEnd(t,e))),"batch"===this.yieldEvery?n.push(this.nextFrameFunc()):Lg(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,t,e)),await Promise.all(n)}async onTrainBegin(t){null!=this.trainBegin&&(await hF(t),await this.trainBegin(t))}async onTrainEnd(t){null!=this.trainEnd&&(await hF(t),await this.trainEnd(t))}}function yF(t,e){if(null==t&&(t={}),t instanceof dF)return[t];if(Array.isArray(t)&&t[0]instanceof dF)return t;return BO(t).map((t=>new gF(t,e)))}class vF{constructor(){}static registerCallbackConstructor(t,e){dg(t>=0&&Number.isInteger(t),(()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`)),vF.checkForDuplicate(e),null==vF.constructors[t]&&(vF.constructors[t]=[]),vF.constructors[t].push(e)}static checkForDuplicate(t){for(const e in vF.constructors){vF.constructors[+e].forEach((e=>{if(e===t)throw new AO("Duplicate callback constructor.")}))}}static clear(){vF.constructors={}}static createCallbacks(t){const e=[];for(const n in vF.constructors){const r=+n;t>=r&&e.push(...vF.constructors[r])}return e.map((t=>new t))}}function xF(t,e,n,r,i,s,a,o,l){const h=new mF,u=[new fF,...vF.createCallbacks(e)];null!=t&&u.push(...t),u.push(h);const c=new pF(u);return c.setParams({epochs:n,initialEpoch:r,samples:i,steps:s,batchSize:a,verbose:e,doValidation:o,metrics:l}),{callbackList:c,history:h}}function bF(t,e={},n=!1){return WO(t,XT.getMap().classNameMap,e,"layer",n)}function wF(t,e){return fT((()=>{"float32"!==t.dtype&&(t=rT(t,"float32"));const n=ak(FP(t),e,!0),r=KT(n.shape,EP()),i=RT(sE(n,r));return NT(t,i)}))}function _F(t,e){return fT((()=>Gk(FP(QT(e,t)),-1)))}function TF(t,e){return fT((()=>Gk(eE(QT(e,t)),-1)))}function EF(t,e){return fT((()=>{const n=QT(t,e),r=wI(eE(t),EP(),Number.MAX_VALUE),i=eE(NT(n,r));return AT(100,Gk(i,-1))}))}function SF(t,e){return fT((()=>{const n=wI(e,EP(),Number.MAX_VALUE),r=kk(kT(1,n)),i=wI(t,EP(),Number.MAX_VALUE),s=kk(kT(1,i));return Gk(FP(QT(r,s)),-1)}))}function IF(t,e,n=!1){return fT((()=>{if(n)e=XC(e);else{const t=ak(e,e.shape.length-1,!0);e=NT(e,t)}return e=wI(e,EP(),1-EP()),PE(ak(AT(rT(t,"float32"),kk(e)),e.shape.length-1))}))}function kF(t,e,n=!1){return fT((()=>{const r=rT(mk(function(t){const e=[xP(t.shape)];return rI(t,e)}(t)),"int32"),i=(e=wI(e,EP(),1-EP())).shape;return IF(rI(ME(r,i[i.length-1]),i),e,n)}))}function CF(t,e){return fT((()=>{let n;return n=wI(e,EP(),1-EP()),n=kk(NT(n,QT(1,n))),Gk(function(t,e){if(!vg(t.shape,e.shape))throw new AO(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return fT((()=>{const n=IC(e),r=PE(eE(e));return kT(QT(n,AT(e,t)),Ck(uk(r)))}))}(t,n),-1)}))}function NF(t,e){return fT((()=>{const n=wI(t,EP(),1),r=wI(e,EP(),1);return ak(AT(t,kk(NT(n,r))),-1)}))}function AF(t,e){return fT((()=>{const n=wF(t,-1),r=wF(e,-1),i=AT(n,r);return PE(ak(i,-1))}))}vF.constructors={};const RF={meanSquaredError:_F,meanAbsoluteError:TF,meanAbsolutePercentageError:EF,meanSquaredLogarithmicError:SF,squaredHinge:function(t,e){return fT((()=>{const n=sE(0,QT(1,AT(t,e)));return Gk(FP(n),-1)}))},hinge:function(t,e){return fT((()=>{const n=sE(0,QT(1,AT(t,e)));return Gk(n,-1)}))},categoricalHinge:function(t,e){return fT((()=>{const n=ak(AT(t,e),-1),r=ik(AT(QT(1,t),e),-1);return sE(0,kT(1,QT(r,n)))}))},logcosh:function(t,e){return fT((()=>{const n=Math.log(2),r=QT(e,t),i=QT(kT(r,Nk(AT(-2,r))),n);return Gk(i,-1)}))},categoricalCrossentropy:IF,sparseCategoricalCrossentropy:kF,binaryCrossentropy:CF,kullbackLeiblerDivergence:NF,poisson:function(t,e){return fT((()=>{const n=kk(kT(EP(),e));return Gk(QT(e,AT(t,n)),-1)}))},cosineProximity:AF};function MF(t){if("string"==typeof t){if(t in RF)return RF[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new AO(e)}return t}function OF(t,e){return fT((()=>{const n=AT(.5,tC(e)),r=SP(yk(e,n),t.dtype);return Gk(zI(t,r),-1)}))}function PF(t,e){return fT((()=>SP(zI(DS(t,-1),DS(e,-1)),"float32")))}function DF(t,e){return fT((()=>rT(ak(Ok(zI(t,1),zI(e,1))),"float32")))}function FF(t,e){return fT((()=>{const n=DF(t,e),r=function(t,e){return fT((()=>rT(ak(Ok(zI(t,0),zI(e,1))),"float32")))}(t,e),i=kT(n,r);return rT(GI(yk(i,0),NT(n,i),0),"float32")}))}function LF(t,e){return fT((()=>{const n=DF(t,e),r=function(t,e){return fT((()=>rT(ak(Ok(zI(t,1),zI(e,0))),"float32")))}(t,e),i=kT(n,r);return rT(GI(yk(i,0),NT(n,i),0),"float32")}))}function BF(t,e){return CF(t,e)}function $F(t,e){return t.rank===e.rank&&(t=JC(t,[t.rank-1])),(e=DS(e,-1)).dtype!==t.dtype&&(e=rT(e,t.dtype)),rT(zI(t,e),"float32")}const UF=IF,VF=kF,zF={binaryAccuracy:OF,categoricalAccuracy:PF,precision:FF,categoricalCrossentropy:UF,sparseCategoricalCrossentropy:VF,mse:_F,MSE:_F,mae:TF,MAE:TF,mape:EF,MAPE:EF,cosine:AF};function GF(t){if("string"==typeof t&&t in zF)return zF[t];if("string"!=typeof t&&null!=t)return t;throw new AO(`Unknown metric ${t}`)}function WF(t){if(DO(null!==t,`Unknown LossOrMetricFn ${t}`),"string"==typeof t)return t;{let e;for(const n of Object.keys(RF))if(RF[n]===t){e=n;break}if(void 0!==e)return e;for(const n of Object.keys(zF))if(zF[n]===t){e=n;break}return void 0!==e?e:t.name}}function XF(t,e,n=!1){if(null==t||"object"!=typeof t||Object.getPrototypeOf(t)!==Object.prototype||!HF(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){JSON.stringify(t).length}}function HF(t){if(null===t)return!0;if("object"==typeof t){if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e){if("string"!=typeof n)return!1;if(!HF(t[n]))return!1}return!0}if(Array.isArray(t)){for(const e of t)if(!HF(e))return!1;return!0}return!1}{const e=typeof t;return"string"===e||"number"===e||"boolean"===e}}function YF(t,e,n,r=console.log){const i=function(t){let e=!0;const n=[],r=[];for(const e in t.nodesByDepth)n.push(t.nodesByDepth[e]);for(const t of n){if(t.length>1||1===t.length&&t[0].inboundLayers.length>1){e=!1;break}r.push(...t)}if(e)for(const n of t.layers){let t=!1;for(const i of n.inboundNodes)if(-1!==r.indexOf(i)){if(t){e=!1;break}t=!0}if(!e)break}return e}(t),s=["Layer (type)","Input Shape","Output shape","Param #"];let a;if(i?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((t=>Math.floor(e*t)))),!i){s.push("Receives inputs"),a=[];for(const e in t.nodesByDepth)a.push(...t.nodesByDepth[e])}r("_".repeat(e)),jF(s,n,r),r("=".repeat(e));const o=t.layers;for(let t=0;t<o.length;++t)i?qF(o[t],n,r):KF(o[t],n,a,r),r((t===o.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=function(t){let e;e=null!=t.collectedTrainableWeights?pD(t.collectedTrainableWeights):pD(t.trainableWeights);return e}(t),h=pD(t.nonTrainableWeights);r(`Total params: ${l+h}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${h}`),r("_".repeat(e))}function jF(t,e,n=console.log){let r="";for(let n=0;n<t.length;++n)n>0&&(r=r.slice(0,r.length-1)+" "),r+=t[n],r=r.slice(0,e[n]),r+=" ".repeat(e[n]-r.length);n(r)}function qF(t,e,n){let r,i;try{i=t.inboundNodes.map((t=>JSON.stringify(t.inputShapes))).join(",")}catch(t){i="multiple"}try{r=JSON.stringify(t.outputShape)}catch(t){r="multiple"}jF([`${t.name} (${t.getClassName()})`,i,r,t.countParams().toString()],e,n)}function KF(t,e,n,r){let i,s;try{s=t.inboundNodes.map((t=>JSON.stringify(t.inputShapes))).join(",")}catch(t){s="multiple"}try{i=JSON.stringify(t.outputShape)}catch(t){i="multiple"}const a=[];for(const e of t.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(e)))for(let t=0;t<e.inboundLayers.length;++t){const n=e.inboundLayers[t].name,r=e.nodeIndices[t],i=e.tensorIndices[t];a.push(`${n}[${r}][${i}]`)}const o=t.name,l=t.getClassName(),h=0===a.length?"":a[0];jF([`${o} (${l})`,s,i,t.countParams().toString(),h],e,r);for(let t=1;t<a.length;++t)jF(["","","","",a[t]],e,r)}function ZF(t,e,n){return("inboundNodes"===t||"outputLayers"===t||"inputLayers"===t)&&0===e&&"string"==typeof n}function JF(t,e){if(null===t)return null;if("string"==typeof t)return UO(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){const n=[],r=t.length;for(let i=0;i<r;++i){const r=t[i];ZF(e,i,r)?n.push(r):n.push(JF(r,e))}return n}{const e={};for(const n of Object.keys(t)){const r=t[n];if("name"===n&&"string"==typeof r)e[n]=r;else{const t=UO(n);e[t]=JF(r,t)}}return e}}function QF(t,e){if(null==t)return null;if("string"==typeof t)return $O(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){const n=[],r=t.length;for(let i=0;i<r;++i){const r=t[i];ZF(e,i,r)?n.push(r):n.push(QF(r,e))}return n}{const e={};for(const n of Object.keys(t)){const r=t[n],i=$O(n);e[i]="name"!==n&&"className"!==n||"string"!=typeof r?QF(r,n):r}return e}}const tL="4.8.0";class eL extends TD{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,null==this.name){const t=this.getClassName().toLowerCase();this.name=nP(t)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],HO(this.inputs).length!==this.inputs.length)throw new AO(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map((t=>t.name))}`);HO(this.outputs).length,this.outputs.length,this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const t of this.outputs){const e=t.sourceLayer,n=t.nodeIndex,r=t.tensorIndex;this.outputLayers.push(e),this.outputLayersNodeIndices.push(n),this.outputLayersTensorIndices.push(r)}for(const t of this.inputs){const e=t.sourceLayer,n=t.nodeIndex,r=t.tensorIndex;DO(0===n,"input layer has >1 nodes"),DO(0===r,"input layer has >1 tensors"),this.inputLayers.push(e),this.inputLayersNodeIndices.push(n),this.inputLayersTensorIndices.push(r)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let e=0;e<this.inputLayers.length;e++){const n=this.inputLayers[e];if(!(n instanceof SD))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${e} (0-based) originates from layer type ${n.getClassName()}.`);this.inputNames.push(n.name),this.feedInputShapes.push(n.batchInputShape),this.feedInputNames.push(n.name)}for(const t of this.outputLayers)this.outputNames.push(t.name);this.internalInputShapes=this.inputs.map((t=>t.shape)),this.internalOutputShapes=this.outputs.map((t=>t.shape));const e={},n={},r={},i={},s={},a=[],o=(t,e,n,r,i,l)=>{null!=r&&null!=i&&null!=l||(r=t.sourceLayer,i=t.nodeIndex,l=t.tensorIndex);const h=r.inboundNodes[i];if(-1!==n.indexOf(h))throw new NO(`The tensor ${t.name} at layer "${r.name}" is part of a cycle.`);if(-1!==e.indexOf(h))return;this.containerNodes.add(eL.nodeKey(r,i)),r.id in s||(s[r.id]=Object.keys(s).length),-1===n.indexOf(h)&&n.push(h);const u=h.inboundLayers.length;for(let t=0;t<u;t++){const r=h.inputTensors[t],i=h.inboundLayers[t],s=h.nodeIndices[t],a=h.tensorIndices[t];o(r,e,n,i,s,a)}for(e.push(h);n.indexOf(h)>=0;)n.splice(n.indexOf(h),1);a.push(h)},l=[],h=[];for(const t of this.outputs)o(t,l,h);const u=a.slice().reverse();for(const t of u){n[t.id]=t,t.id in e||(e[t.id]=0);let s=e[t.id];const a=null==r[t.outboundLayer.id]?0:r[t.outboundLayer.id];s=Math.max(s,a),r[t.outboundLayer.id]=s,i[t.outboundLayer.id]=t.outboundLayer,e[t.id]=s;for(let r=0;r<t.inboundLayers.length;r++){const i=t.inboundLayers[r],a=t.nodeIndices[r],o=i.inboundNodes[a],l=null==e[o.id]?0:e[o.id];e[o.id]=Math.max(s+1,l),n[o.id]=o}}const c={};for(const t in e){const r=e[t];r in c||(c[r]=[]),c[r].push(n[t])}const d={};for(const t in r){const e=r[t];e in d||(d[e]=[]),d[e].push(i[t])}let p=Object.keys(d).map((t=>parseInt(t,10))).sort(XO);this.layers=[];for(const t of p){const e=d[t];e.sort(((t,e)=>{const n=s[t.id],r=s[e.id];return n<r?-1:n>r?1:0}));for(const t of e)t instanceof eL&&this.internalContainerRefs.push(t),this.layers.push(t)}this.layersByDepth=d,p=Object.keys(c).map((t=>parseInt(t,10))).sort(XO);const f=this.inputs.slice(),m=[];for(const t of p)for(const e of c[t]){const t=e.outboundLayer;if(null!=t){for(const n of e.inputTensors)if(-1===f.indexOf(n))throw new NO(`Graph disconnected: cannot obtain value for tensor ${n} at layer "${t.name}". The following previous layers were accessed without issue: ${m}`);for(const t of e.outputTensors)f.push(t);m.push(t.name)}}this.nodesByDepth=c;const g=this.layers.map((t=>t.name));for(const t of g){const e=g.filter((e=>e===t)).length;if(1!==e)throw new NO(`The name "${t}" is used ${e} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new wD({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map((t=>null)),outputMasks:this.outputs.map((t=>null)),inputShapes:this.inputs.map((t=>t.shape)),outputShapes:this.outputs.map((t=>t.shape))}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(const e of this.layers)t.numDisposedVariables+=e.dispose().numDisposedVariables;for(const e of this.internalContainerRefs)t.numDisposedVariables+=e.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach((e=>{e._trainableWeights.forEach((e=>e.trainable=t))})),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new AO("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const e of this.layers)t=t.concat(e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.layers)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const t of this.layers)e.push(...t.trainableWeights);return e.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,e=!0){const n={};let r=0;for(const t of this.layers)for(const e of t.weights){if(null!=n[e.originalName])throw new AO(`Duplicate weight name: ${e.originalName}`);n[e.originalName]=e,r++}const i=[];for(const r in t){let s=r;if(null==n[r]){const t=r.split("/");s=t.slice(0,-2).concat([t[t.length-1]]).join("/")}if(null!=n[s])i.push([n[s],t[r]]);else if(e)throw new AO(`Provided weight data has no target variable: ${r}`);delete n[s]}if(e){const t=[];for(const e in n)t.push(e);if(t.length>0)throw new AO(`${t.length} of ${r} weights are not set: ${t}`)}yD(i)}updatedConfig(){const t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion=`tfjs-layers ${tL}`,e.backend="TensorFlow.js",e}toJSON(t,e=!0){const n=QF(this.updatedConfig());return e?JSON.stringify(n):n}call(t,e){return fT((()=>{t=BO(t);const n=new kD;for(let e=0;e<this.inputs.length;++e)n.add(this.inputs[e],t[e]);return AD(this.outputs,n,e)}))}computeMask(t,e){return fT((()=>{let n;return t=BO(t),n=null==e?PO(null,t.length):BO(e),this.runInternalGraph(t,n)[1]}))}computeOutputShape(t){const e=uD(t);if(e.length!==this.inputLayers.length)throw new AO(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const n={};for(let t=0;t<e.length;t++){const r=this.inputLayers[t],i=e[t];n[r.name+"_0_0"]=i}const r=Object.keys(this.nodesByDepth).map((t=>parseInt(t,10))).sort(XO);if(r.length>1)for(const t of r){const e=this.nodesByDepth[t];for(const t of e){const e=t.outboundLayer;if(-1!==this.inputLayers.map((t=>t.id)).indexOf(e.id))continue;const r=[];for(let e=0;e<t.inboundLayers.length;e++){const i=t.inboundLayers[e],s=t.nodeIndices[e],a=t.tensorIndices[e],o=n[`${i.name}_${s}_${a}`];r.push(o)}const i=uD(e.computeOutputShape(LO(r))),s=e.inboundNodes.indexOf(t);for(let t=0;t<i.length;t++){n[`${e.name}_${s}_${t}`]=i[t]}}}const i=[],s=[];for(let t=0;t<this.outputLayers.length;t++){const e=this.outputLayers[t],n=this.outputLayersNodeIndices[t],r=this.outputLayersTensorIndices[t],i=`${e.name}_${n}_${r}`;s.push(i)}for(let t=0;t<s.length;t++){const e=s[t];DO(e in n),i.push(n[e])}return LO(i)}runInternalGraph(t,e){null==e&&(e=PO(null,t.length));const n={};for(let r=0;r<this.inputs.length;++r){const i=this.inputs[r],s=t[r],a=e[r];n[i.id]=[s,a]}const r=Object.keys(this.nodesByDepth).map((t=>parseInt(t,10))).sort(XO);for(const t of r){const e=this.nodesByDepth[t];for(const t of e){const e=t.outboundLayer,r=t.inputTensors,i=t.outputTensors,s=new Array;for(const t of r)t.id in n&&s.push(n[t.id]);if(s.length===r.length){let r,a,o,l,h={};if(null!=t.callArgs&&(h=t.callArgs),1===s.length){const[t,n]=s[0];null==h.mask&&(h.mask=n),o=BO(e.call(t,h)),l=BO(e.computeMask(t,n)),r=[t],a=[n]}else r=s.map((t=>t[0])),a=s.map((t=>t[1])),null==h.mask&&(h.mask=a),o=BO(e.call(r,h)),l=BO(e.computeMask(r,a));if(e.activityRegularizer)throw new RO("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let t=0;t<i.length;++t){const e=i[t],r=o[t],s=l[t];n[e.id]=[r,s]}}}}const i=[],s=[],a=[];for(const t of this.outputs){DO(t.id in n,`Could not compute output ${t.name} : ${t.id}`);const[e,r]=n[t.id];a.push(e.shape),i.push(e),s.push(r)}return[i,s,a]}buildNodeConversionMap(t){const e={};let n;for(const t of this.layers){n=t instanceof eL?1:0;for(let r=0;r<t.inboundNodes.length;r++){const i=eL.nodeKey(t,r);this.containerNodes.has(i)&&(e[i]=n,n+=1)}}return e}getLayer(t,e){if(null!=e)return this.findLayer(e);if(null==t)throw new AO("Provide either a layer name or layer index");if("number"==typeof t)return this.findLayer(t);for(const e of this.layers)if(e.name===t)return e;throw new AO(`No such layer: ${t}`)}findLayer(t){if(this.layers.length<=t)throw new AO(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}calculateLosses(){return fT((()=>{const t=[];for(const e of this.layers)for(let n=0;n<e.inboundNodes.length;++n){const r=eL.nodeKey(e,n);this.containerNodes.has(r)&&t.push(...e.calculateLosses())}return t}))}getConfig(){const t={name:this.name},e=this.buildNodeConversionMap(this.layers),n=[];for(const t of this.layers){const r=t.getClassName(),i=t.getConfig(),s=[];for(let n=0;n<t.inboundNodes.length;n++){const r=t.inboundNodes[n],i=eL.nodeKey(t,n);let a={};if(this.containerNodes.has(i)){if(r.callArgs)try{JSON.stringify(r.callArgs),a=r.callArgs}catch(t){a={}}if(r.inboundLayers.length>0){const t=[];for(let n=0;n<r.inboundLayers.length;n++){const i=r.inboundLayers[n],s=r.nodeIndices[n],o=r.tensorIndices[n];let l=e[eL.nodeKey(i,s)];null==l&&(l=0),t.push([i.name,l,o,a])}s.push(t)}}}const a={};a.name=t.name,a.className=r,a.config=i,a.inboundNodes=s,n.push(a)}t.layers=n;const r=[];for(let t=0;t<this.inputLayers.length;t++){const n=this.inputLayers[t],i=this.inputLayersNodeIndices[t],s=eL.nodeKey(n,i);if(!this.containerNodes.has(s))continue;let a=e[s];null==a&&(a=0);const o=this.inputLayersTensorIndices[t];r.push([n.name,a,o])}t.inputLayers=r;const i=[];for(let t=0;t<this.outputLayers.length;t++){const n=this.outputLayers[t],r=this.outputLayersNodeIndices[t],s=eL.nodeKey(n,r);if(!this.containerNodes.has(s))continue;let a=e[s];null==a&&(a=0);const o=this.outputLayersTensorIndices[t];i.push([n.name,a,o])}return t.outputLayers=i,t}static fromConfig(t,e,n={},r=!1){const i={},s={};function a(t,e){t.name in s?s[t.name].push(e):s[t.name]=[e]}function o(t,e){const n=[];let r;for(const s of e){const o=s[0],l=s[1],h=s[2];if(r=null==s[3]?{}:s[3],!(o in i))return void a(t,e);const u=i[o];if(u.inboundNodes.length<=l)return void a(t,e);const c=u.inboundNodes[l];n.push(c.outputTensors[h])}n.length>0&&t.apply(LO(n),r)}function l(t){const n=t.name,s=bF(t,null!=e.customObjects?e.customObjects:{});s.setFastWeightInitDuringBuild(r),i[n]=s;t.inboundNodes.forEach((t=>{if(!(t instanceof Array))throw new AO(`Corrupted configuration, expected array for nodeData: ${t}`);a(s,t)}))}const h=e.name,u=e.layers;for(const t of u)l(t);for(;!YO(s);)for(const t of u){const e=i[t.name];if(e.name in s){const t=s[e.name];delete s[e.name];for(const n of t)o(e,n)}}const c=[],d=[],p=e.inputLayers;for(const t of p){const e=t[0],n=t[1],r=t[2];DO(e in i);const s=i[e].inboundNodes[n].outputTensors;c.push(s[r])}const f=e.outputLayers;for(const t of f){const e=t[0],n=t[1],r=t[2];DO(e in i);const s=i[e].inboundNodes[n].outputTensors;d.push(s[r])}return new t({inputs:c,outputs:d,name:h})}get stateful(){if(this._stateful)throw new AO("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){fT((()=>{this.layers.forEach((t=>{t.stateful&&t.resetStates()}))}))}}function nL(t,e,n){const r=e.length;if(null==t||Array.isArray(t)&&0===t.length)return e.map((t=>null));if(1===r)return Array.isArray(t)&&1===t.length?t:"object"==typeof t&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==r)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return t}if("object"==typeof t&&Object.keys(t).length>0&&"object"==typeof t[Object.keys(t)[0]]){const n=[];return e.forEach((e=>{e in t?n.push(t[e]):n.push(null)})),n}throw new Error(`The model has multiple (${r}) outputs, so ${n} must be either an array with ${r} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function rL(t,e){return nL(t,e,"classWeight")}async function iL(t,e,n,r){if(null!=e||null!=r)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const e=fT((()=>{if(1===t.shape.length)return iT(t);if(2===t.shape.length){if(t.shape[1]>1){return DS(t,1)}if(1===t.shape[1])return rI(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)})),r=Array.from(await e.data());mT(e);const i=[];return r.forEach((t=>{if(null==n[t])throw new Error(`classWeight must contain all classes in the training data. The class ${t} exists in the data but not in classWeight`);i.push(n[t])})),rN(i,"float32")}return null}function sL(t,e){return AT(t,e)}function aL(t,e){let n,r;const i=e;n=i.xs,r=i.ys,dg(null!=n&&null!=r,(()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`));const s=oL("input",t.inputNames,n),a=oL("output",t.outputNames,r),o=s[0].shape[0];dg(s.length===t.inputs.length,(()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`)),dg(a.length===t.outputs.length,(()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${a.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`));for(let e=0;e<s.length;e++)dg(s[e].shape[0]===o,(()=>`Batch size mismatch: input ${t.inputNames[e]} has ${s[e].shape[0]}; expected  ${o} based on input ${t.inputNames[0]}.`));for(let e=0;e<a.length;e++)dg(a[e].shape[0]===o,(()=>`Batch size mismatch: output ${t.outputNames[e]} has ${a[e].shape[0]}; expected  ${o} based on input ${t.inputNames[0]}.`));return{xs:s,ys:a}}function oL(t,e,n){if(n instanceof vw)return[n];if(Array.isArray(n))return dg(n.length===e.length,(()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`)),n;{const r=[];for(const i of e){if(null==n[i])throw new AO(`The feature data generated by the dataset lacks the required ${t} key '${i}'.`);r.push(n[i])}return r}}async function lL(t,e,n){const r=null!=n.batchesPerEpoch;if(dg(null!=t.optimizer,(()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig).")),dg(null!=n,(()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call.")),dg(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`)),dg(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`)),dg(null==n.validationSplit,(()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead.")),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const i=null!=n.validationData;let s,a;if(i)if(hL(n.validationData))dg(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`));else{const t=function(t){if(3===t.length)throw new RO("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}(n.validationData);s=t.xs,a=t.ys}const o=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let h;h=i?l.slice().concat(l.map((t=>"val_"+t))):l.slice();const u=yF(n.callbacks,n.yieldEvery),c=null==n.verbose?1:n.verbose,{callbackList:d,history:p}=xF(u,c,n.epochs,null,null,function(t,e){let n=null;null!=e.batchesPerEpoch?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size);return n}(e,n),null,i,h);d.setModel(t),t.history=p,await d.onTrainBegin(),t.stopTraining_=!1;let f=null==n.initialEpoch?0:n.initialEpoch,m=await e.iterator();for(;f<n.epochs;){const h={};await d.onEpochBegin(f);let u=0,c=0;for(r||(m=await e.iterator());!r||u<n.batchesPerEpoch;){const e=await m.next();if(r&&e.done)break;if(null!=e.value){const{xs:r,ys:i}=aL(t,e.value),s={};s.batch=c,s.size=r[0].shape[0],await d.onBatchBegin(c,s);const a=[];if(null!=n.classWeight){const e=rL(n.classWeight,t.outputNames);for(let t=0;t<e.length;++t)a.push(await iL(i[t],null,e[t]))}const h=r.concat(i).concat(a),p=o(h);mT(h);for(let t=0;t<l.length;++t){const e=l[t],n=p[t];s[e]=n,gT(n)}await d.onBatchEnd(c,s),uF(s),c++,u++}if(r?u>=n.batchesPerEpoch:e.done){if(i){let e;e=hL(n.validationData)?BO(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):BO(t.evaluate(s,a,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<t.metricsNames.length;++n)h[`val_${t.metricsNames[n]}`]=e[n]}break}if(t.stopTraining_)break}if(await d.onEpochEnd(f,h),f++,t.stopTraining_)break}return await d.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function hL(t){return"function"==typeof t.iterator}function uL(t){dg(t>0&&Number.isInteger(t),(()=>`batchSize is required to be a positive integer, but got ${t}`))}function cL(t,e,n){return null==t?[null]:Array.isArray(t)?t.map((t=>kP(t,e,n-e))):kP(t,e,n-e)}function dL(t,e){return fT((()=>null==t?null:Array.isArray(t)?t.map((t=>dL(t,e))):DP(t,"int32"===e.dtype?e:rT(e,"int32"))))}function pL(t,e){const n=[];let r=0,i=null;for(;r<t;)i=r+e,i>=t&&(i=t),n.push([r,i]),r=i;return n}function fL(t){const e=[];t instanceof vw&&(t=[t]);for(let n=0;n<t.length;++n){const r=t[n];if(1===r.rank)e.push(IP(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function mL(t,e){if(null==t)return;const n=[];if(e instanceof vw)n.push(e.id);else if(Array.isArray(e))e.forEach((t=>n.push(t.id)));else if(null!=e)for(const t in e){const r=e[t];n.push(r.id)}const r=[];if(t instanceof vw)-1===n.indexOf(t.id)&&r.push(t);else if(Array.isArray(t))t.forEach((t=>{-1===n.indexOf(t.id)&&r.push(t)}));else if(null!=t)for(const e in t){const i=t[e];-1===n.indexOf(i.id)&&r.push(i)}r.forEach((t=>{t.isDisposed||t.dispose()}))}function gL(t){return Array.isArray(t)}function yL(t){return!function(t){return t instanceof vw}(t)&&!gL(t)}function vL(t,e,n,r=!0,i=""){if(null==e||0===e.length){if(null!=t){let e=!1;if(gL(t)&&t.length>0)e=!0;else if(yL(t)){for(const n in t)if(t.hasOwnProperty(n)){e=!0;break}}else e=!0;if(e)throw new AO(`Error when checking model ${i} expected no data, but got ${t}`)}return[]}if(null==t)return e.map((t=>null));let s;if(yL(t)){t=t,s=[];for(const n of e){if(null==t[n])throw new AO(`No data provided for "${n}". Need data for each key in: ${e}`);s.push(t[n])}}else if(gL(t)){if((t=t).length!==e.length)throw new AO(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);s=t}else{if(t=t,e.length>1)throw new AO(`The model ${i} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);s=[t]}if(s=fL(s),null!=n)for(let t=0;t<e.length;++t){if(null==n[t])continue;const a=s[t];if(a.shape.length!==n[t].length)throw new AO(`Error when checking ${i}: expected ${e[t]} to have ${n[t].length} dimension(s). but got array with shape ${a.shape}`);for(let e=0;e<n[t].length;++e){if(0===e&&!r)continue;const s=a.shape[e],o=n[t][e];if(null!=o&&o>=0&&s!==o)throw new AO(`${i} expected a batch of elements where each example has shape [${n[t].slice(1,n[t].length)}] (i.e.,tensor shape [*,${n[t].slice(1,n[t].length)}]) but the ${i} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return s}function xL(t,e,n,r=!0,i=""){let s;if(Array.isArray(t)){if(t.length!==e.length)throw new AO(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);s=t}else{if(e.length>1)throw new AO(`The model expects ${e.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);s=[t]}if(null!=n)for(let t=0;t<e.length;++t){if(null==n[t])continue;const a=s[t];if(a.shape.length!==n[t].length)throw new AO(`Error when checking ${i}: expected ${e[t]} to have ${n[t].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let s=0;s<n[t].length;++s){if(0===s&&!r)continue;const o=a.shape[s],l=n[t][s];if(null!=l&&l!==o)throw new AO(`Error when checking ${i}: expected ${e[t]} to have shape ${JSON.stringify(n[t])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}class bL extends eL{constructor(t){super(t),this.isTraining=!1}summary(t,e,n=console.log){if(!this.built)throw new AO("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");YF(this,t,e,n)}compile(t){if(null==t.loss&&(t.loss=[]),this.loss=t.loss,"string"==typeof t.optimizer)this.optimizer_=function(t){const e={Adagrad:()=>UA.adagrad(.01),Adadelta:()=>UA.adadelta(1,.95,EP()),Adam:()=>UA.adam(.001,.9,.999,EP()),Adamax:()=>UA.adamax(.002,.9,.999,EP(),0),RMSProp:()=>UA.rmsprop(.001,.9,0,EP()),SGD:()=>UA.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new AO(`Unknown Optimizer ${t}`)}(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof jT))throw new AO("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let e=[];if(Array.isArray(t.loss)||"string"==typeof t.loss||"function"==typeof t.loss)if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new AO(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);const n=t.loss;e=n.map((t=>MF(t)))}else{const n=MF(t.loss);this.outputs.forEach((t=>{e.push(n)}))}else{t.loss=t.loss;for(const e in t.loss)if(-1===this.outputNames.indexOf(e))throw new AO(`Unknown entry in loss dictionary: "${e}". Only expected the following keys: ${this.outputNames}`);for(const n of this.outputNames)t.loss[n],e.push(MF(t.loss[n]))}this.lossFunctions=e,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let t=0;t<this.outputs.length;++t){const e=this.internalOutputShapes[t],n=this.outputNames[t];this.feedOutputNames.push(n),this.feedOutputShapes.push(e),this.feedLossFns.push(this.lossFunctions[t])}const n=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],pP("loss",(()=>{for(let t=0;t<this.outputs.length;++t){if(-1!==n.indexOf(t))continue;const e=this.lossFunctions[t];this.outputs.length>1&&(this.metricsTensors.push([e,t]),this.metricsNames.push(this.outputNames[t]+"_loss"))}}));const r=function(t,e){if(null==t||Array.isArray(t)&&0===t.length)return e.map((t=>[]));let n;if("string"==typeof t||"function"==typeof t)n=[t];else{if(!Array.isArray(t)&&"object"!=typeof t)throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);n=t}if(Array.isArray(n))return e.map((t=>n));{const t=[];for(const r of e){let e=n.hasOwnProperty(r)?n[r]:[];Array.isArray(e)||(e=[e]),t.push(e)}return t}}(t.metrics,this.outputNames),i=(t,e,n)=>{this.outputNames.length>1&&(e=this.outputNames[t]+"_"+e),this.metricsNames.push(e),this.metricsTensors.push([n,t])};pP("metric",(()=>{for(let t=0;t<this.outputs.length;++t){if(-1!==n.indexOf(t))continue;(e=>{let n,r,s;for(const a of e){if("string"==typeof a&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(a)){const e=this.internalOutputShapes[t];let i;1===e[e.length-1]||this.lossFunctions[t]===CF?-1!==["accuracy","acc"].indexOf(a)?r=OF:-1!==["crossentropy","ce"].indexOf(a)&&(r=BF):this.lossFunctions[t]===kF?-1!==["accuracy","acc"].indexOf(a)?r=$F:-1!==["crossentropy","ce"].indexOf(a)&&(r=VF):-1!==["accuracy","acc"].indexOf(a)?r=PF:-1!==["crossentropy","ce"].indexOf(a)&&(r=UF),-1!==["accuracy","acc"].indexOf(a)?i="acc":-1!==["crossentropy","ce"].indexOf(a)&&(i="ce"),s=r,n=""+i}else{const t=GF(a);s=t,n=""+WF(a)}let e;pP(n,(()=>{e=s})),i(t,n,e)}})(r[t])}})),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&(this.trainableWeights.length,this.collectedTrainableWeights.length)}evaluate(t,e,n={}){const r=null==n.batchSize?32:n.batchSize;uL(r);const i=this.standardizeUserDataXY(t,e,!0,r);try{const s=i[0].concat(i[1]);this.makeTestFunction();const a=this.testFunction;return LO(this.testLoop(a,s,r,n.verbose,n.steps))}finally{mL(i[0],t),mL(i[1],e)}}async evaluateDataset(t,e){return this.makeTestFunction(),async function(t,e,n){const r=null!=(n=n||{}).batches,i=t.testFunction;let s=[];if(n.verbose>0)throw new RO("Verbose mode is not implemented yet.");dg(!r||n.batches>0&&Number.isInteger(n.batches),(()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`));const a="function"==typeof e.next?e:await e.iterator();let o=0,l=0;for(;!r||l<n.batches;){const e=await a.next();if(s=fT((()=>{if(e.value){const{xs:n,ys:r}=aL(t,e.value),a=n.concat(r),h=fT((()=>i(a)));if(mT(a),0===l)for(let t=0;t<h.length;++t)s.push(VT(0));const u=a[0].shape[0];for(let t=0;t<h.length;++t){const e=h[t],n=s[t];s[t]=fT((()=>kT(s[t],AT(u,e)))),l>0&&mT(n)}mT(h),o+=u,++l}return s})),e.done)break}for(let t=0;t<s.length;++t){const e=s[t];s[t]=NT(s[t],o),mT(e)}return LO(s)}(this,t,e)}checkNumSamples(t,e,n,r="steps"){let i;if(null!=n){if(i=null,null!=e)throw new AO(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${e}`)}else{if(null==t)throw new AO(`Either the input data should have a defined shape, or ${r} shoud be specified.`);i=Array.isArray(t)?t[0].shape[0]:t.shape[0]}return i}execute(t,e){if(Array.isArray(e)&&0===e.length)throw new AO("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(e),r=n?e:[e],i=this.retrieveSymbolicTensors(r),s=new kD;if(t instanceof vw&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new AO(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let e=0;e<this.inputs.length;++e)s.add(this.inputs[e],t[e])}else for(const e of this.inputs){const n=t[e.name];if(null==n)throw new AO(`No value is provided for the model's input ${e.name}`);s.add(e,n)}const a=AD(i,s);return n?a:a[0]}retrieveSymbolicTensors(t){const e=PO(null,t.length);let n=t.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],s=i.map((t=>t.name));for(let r=0;r<t.length;++r){const a=s.indexOf(t[r]);if(-1!==a&&(e[r]=i[a],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw e.forEach(((e,r)=>{null==e&&n.push(t[r])})),new AO(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(n)}`)}return e}predictLoop(t,e=32,n=!1){return fT((()=>{const r=this.checkNumSamples(t);if(n)throw new RO("Verbose predictLoop() is not implemented yet.");const i=pL(r,e),s=this.outputs.map((t=>[]));for(let e=0;e<i.length;++e){const n=fT((()=>{const n=i[e][0],r=i[e][1],s=cL(t,n,r),a=[];if(Array.isArray(s))for(let t=0;t<s.length;++t)a.push({key:this.inputs[t],value:s[t]});else a.push({key:this.inputs[0],value:s});const o=new kD(a);return AD(this.outputs,o)}));n.forEach(((t,e)=>s[e].push(t)))}return LO(s.map((t=>aI(t,0))))}))}predict(t,e={}){const n=fL(t);xL(n,this.inputNames,this.feedInputShapes,!1);try{const r=null==e.batchSize?32:e.batchSize;return uL(r),this.predictLoop(n,r)}finally{mL(n,t)}}predictOnBatch(t){xL(t,this.inputNames,this.feedInputShapes,!0);const e=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,e)}standardizeUserDataXY(t,e,n=!0,r){if(null==this.optimizer_)throw new NO("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let t=0;t<this.feedOutputShapes.length;++t){const e=this.feedOutputShapes[t];this.feedLossFns[t]===kF?i.push(e.slice(0,e.length-1).concat([1])):i.push(e)}if(function(t,e,n){const r=HO(t.map((t=>t.shape[0])));r.sort();const i=HO(e.map((t=>t.shape[0])));if(i.sort(),r.length>1)throw new AO(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map((t=>t.shape)))}`);if(i.length>1)throw new AO(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map((t=>t.shape)))}`);if(r.length>0&&i.length>0&&!vg(r,i))throw new AO(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${i[0]} target sample(s).`)}(t=vL(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=vL(e,this.feedOutputNames,i,!1,"target")),function(t,e,n){const r=[_F,CF,IF];for(let i=0;i<t.length;++i){const s=t[i],a=e[i],o=n[i];if(null!=a){if(a===IF&&1===s.shape[s.shape.length-1])throw new AO(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(-1!==r.indexOf(a)){const t=s.shape.slice(1),e=o.slice(1);for(let n=0;n<t.length;++n){const r=t[n],i=e[n];if(null!=i&&r!==i)throw new AO(`A target Tensor with shape ${s.shape} was passed for an output of shape ${o}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&r>0&&t[0].shape[0]%r!=0)throw new AO(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${t[0].shape[0]} sample(s).`);return[t,e]}async standardizeUserData(t,e,n,r,i=!0,s){const[a,o]=this.standardizeUserDataXY(t,e,i,s);if(null!=n)throw new Error("sample weight is not supported yet.");let l=null;if(null!=r){const t=rL(r,this.outputNames);l=[];for(let e=0;e<t.length;++e)l.push(await iL(o[e],null,t[e]))}return[a,o,l]}testLoop(t,e,n,r=0,i){return fT((()=>{const s=this.checkNumSamples(e,n,i,"steps"),a=[];if(r>0)throw new RO("Verbose mode is not implemented yet.");if(null!=i)throw new RO("steps mode in testLoop() is not implemented yet");{const r=pL(s,n),i=rN(_P(0,s));for(let n=0;n<r.length;++n){const s=r[n][0],o=r[n][1],l=kP(i,s,o-s),h=dL(e,l),u=t(h);if(0===n)for(let t=0;t<u.length;++t)a.push(VT(0));for(let t=0;t<u.length;++t){const e=u[t];a[t]=kT(a[t],AT(o-s,e))}}for(let t=0;t<a.length;++t)a[t]=NT(a[t],s)}return a}))}getDedupedMetricsNames(){const t=this.metricsNames,e=[];for(let n=0;n<t.length;++n){const r=t[n];let i=r;if(FO(t,r)>1){i+=`_${FO(t.slice(0,n),r)}`}e.push(i)}return e}makeTrainFunction(){return t=>{const e=[],n=t.slice(0,this.inputs.length),r=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),s=[],a=this.collectedTrainableWeights.map((t=>t.read())),o=this.optimizer_.minimize((()=>{const t=[];for(let e=0;e<this.inputs.length;++e)t.push({key:this.inputs[e],value:n[e]});const a=new kD(t),o=AD(this.outputs,a,{training:!0});let l;for(let t=0;t<this.lossFunctions.length;++t){let n=(0,this.lossFunctions[t])(r[t],o[t]);null!=i[t]&&(n=sL(n,i[t]));const s=Gk(n);e.push(s),l=0===t?n:kT(l,n)}for(let t=0;t<this.metricsTensors.length;++t){let n;if(this.outputs.length>1&&t<this.outputs.length)n=e[t];else{const e=this.metricsTensors[t][0],i=this.metricsTensors[t][1];n=Gk(e(r[i],o[i]))}gT(n),s.push(n)}return l=Gk(l),this.calculateLosses().forEach((t=>{l=kT(l,t)})),l}),!0,a);return[o].concat(s)}}makeTestFunction(){this.testFunction=t=>fT((()=>{const e=[];let n;const r=t.slice(0,this.inputs.length),i=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=[];for(let t=0;t<this.inputs.length;++t)s.push({key:this.inputs[t],value:r[t]});const a=new kD(s),o=AD(this.outputs,a);for(let t=0;t<this.lossFunctions.length;++t){const r=this.lossFunctions[t],s=Gk(r(i[t],o[t]));n=0===t?s:kT(n,s),e.push(n)}for(let t=0;t<this.metricsTensors.length;++t){const n=this.metricsTensors[t][0],r=this.metricsTensors[t][1],s=Gk(n(i[r],o[r]));e.push(s)}return e}))}async fit(t,e,n={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");let r,i,s,a,o,l,h,u,c;this.isTraining=!0;try{const d=null==n.batchSize?32:n.batchSize;uL(d);const p=!1,f=await this.standardizeUserData(t,e,n.sampleWeight,n.classWeight,p,d);r=f[0],i=f[1],c=f[2];let m,g=!1;if(null!=n.validationData&&n.validationData.length>0){if(g=!0,2!==n.validationData.length)throw 3===n.validationData.length?new RO("validationData including sample weights is not supported yet."):new AO(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${n.validationData} is invalid.`);o=n.validationData[0],l=n.validationData[1];const t=!0,e=await this.standardizeUserData(o,l,null,null,t,d);h=e[0],u=e[1],m=h.concat(u)}else if(null!=n.validationSplit&&n.validationSplit>0&&n.validationSplit<1){g=!0;const t=Math.floor(r[0].shape[0]*(1-n.validationSplit)),e=r[0].shape[0];h=cL(r,t,e),s=r,r=cL(r,0,t),u=cL(i,t,e),a=i,i=cL(i,0,t),m=h.concat(u)}else null!=n.validationSteps&&(g=!0);const y=r.concat(i).concat(c);this.checkTrainableWeightsConsistency();const v=this.makeTrainFunction(),x=this.getDedupedMetricsNames();let b,w;g?(this.makeTestFunction(),b=this.testFunction,w=x.slice().concat(x.map((t=>"val_"+t)))):(b=null,m=[],w=x.slice());const _=yF(n.callbacks,n.yieldEvery);return await this.fitLoop(v,y,x,d,n.epochs,n.verbose,_,b,m,n.shuffle,w,n.initialEpoch,null,null)}finally{this.isTraining=!1,mL(r,t),mL(i,e),mL(s,t),mL(a,e),mL(h,o),mL(u,l),null!=c&&mT(c)}}async fitLoop(t,e,n,r,i,s,a,o,l,h,u,c,d,p){null==r&&(r=32),null==i&&(i=1),null==h&&(h=!0),null==c&&(c=0);let f=!1;if(null!=o&&null!=l&&(f=!0),null!=p&&(f=!0,null==d))throw new AO("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const m=this.checkNumSamples(e,r,d,"steps_per_epoch");let g;null!=m&&(g=_P(0,m)),null==s&&(s=1);const{callbackList:y,history:v}=xF(a,s,i,c,m,d,r,f,u);y.setModel(this),this.history=v,await y.onTrainBegin(),this.stopTraining_=!1;for(let s=c;s<i;++s){await y.onEpochBegin(s);const i={};if(null!=d)throw new RO("stepsPerEpoch mode is not implemented yet.");{if("batch"===h)throw new RO("batch shuffling is not implemneted yet");h&&ig(g);const s=rN(g),a=pL(m,r);for(let h=0;h<a.length;++h){const u={};if(await y.onBatchBegin(h,u),fT((()=>{const c=a[h][0],d=a[h][1],p=kP(s,c,d-c);u.batch=h,u.size=d-c;const m=dL(e,p),g=t(m);for(let t=0;t<n.length;++t){const e=n[t],r=g[t];u[e]=r,gT(r)}if(h===a.length-1&&f){const t=this.testLoop(o,l,r);for(let e=0;e<n.length;++e){const r=n[e],s=t[e];gT(s),i["val_"+r]=s}}})),await y.onBatchEnd(h,u),uF(u),this.stopTraining_)break}s.dispose()}if(await y.onEpochEnd(s,i),this.stopTraining_)break}return await y.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(t,e){return lL(this,t,e)}async trainOnBatch(t,e){const n=await this.standardizeUserData(t,e),r=n[0],i=n[1],s=this.makeTrainFunction()(r.concat(i)),a=[];for(const t of s){const e=await t.data();a.push(e[0])}return mT(s),mL(n[0],t),mL(n[1],e),LO(a)}getNamedWeights(t){const e=[],n=null!=t&&t.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n);for(let t=0;t<r.length;++t)n&&!r[t].trainable||e.push({name:r[t].originalName,tensor:i[t]});return e}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(0===t.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const e=dT().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=e-dT().numTensors}return t}getLossIdentifiers(){let t;if("string"==typeof this.loss)t=$O(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if("string"!=typeof t)throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map((t=>$O(t)))}else{const e=Object.keys(this.loss);t={};const n=this.loss;for(const r of e){if("string"!=typeof n[r])throw new Error("Serialization of non-string loss is not supported.");t[r]=$O(n[r])}}return t}getMetricIdentifiers(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[$O(WF(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((t=>$O(WF(t))));{const t={};for(const e in this.metrics)t[e]=$O(WF(this.metrics[e]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(null!=t.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=t.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=t.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const e=bF(JF(t.optimizer_config));let n,r;if("string"==typeof t.loss)n=UO(t.loss);else if(Array.isArray(t.loss))n=t.loss.map((t=>UO(t)));else if(null!=t.loss){n={};for(const e in t.loss)n[e]=UO(t.loss[e])}if(Array.isArray(t.metrics))r=t.metrics.map((t=>UO(t)));else if(null!=t.metrics){r={};for(const e in t.metrics)r[e]=UO(t.metrics[e])}this.compile({loss:n,metrics:r,optimizer:e})}async save(t,e){if("string"==typeof t){const e=w_(t);if(0===e.length)throw new AO(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new AO(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new AO("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await s_(this.getNamedWeights(e)),r={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:`TensorFlow.js tfjs-layers v${tL}`,convertedBy:null};if(null!=e&&e.includeOptimizer&&null!=this.optimizer){r.trainingConfig=this.getTrainingConfig();const t="optimizer",{data:e,specs:i}=await s_(await this.optimizer.getWeights(),t);n.specs.push(...i),n.data=u_([n.data,e])}if(null!=this.userDefinedMetadata){const t=!0;XF(this.userDefinedMetadata,this.name,t),r.userDefinedMetadata=this.userDefinedMetadata}return r.weightData=n.data,r.weightSpecs=n.specs,t.save(r)}setUserDefinedMetadata(t){XF(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}bL.className="Model",HT(bL);class wL extends bL{}async function _L(t,e){"modelTopology"in t||(t={modelTopology:t});let n=(t=t).modelTopology;null!=n.model_config&&(n=n.model_config);const r=bF(JF(n),e);if(null!=t.weightsManifest){const e=await yE(t.weightsManifest,t.pathPrefix,r.weights.map((t=>t.originalName))),n={};for(const t of r.weights)n[t.originalName]=e[t.originalName];r.loadWeights(n),mT(e)}return r}async function TL(t,e){if(null==e&&(e={}),"string"==typeof t){const n=__(t,e);if(0===n.length)n.push(TE(t,e));else if(n.length>1)throw new AO(`Found more than one (${n.length}) load handlers for URL '${t}'`);t=n[0]}return async function(t,e,n){null==n&&(n={});if(null==t.load)throw new AO("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const r=await t.load();let i=r.modelTopology;null!=i.model_config&&(i=i.model_config);const s=null==n.strict||n.strict,a=null!=r.weightData&&null!=r.weightSpecs&&s,o=bF(JF(i),e,a),l=r.trainingConfig;null!=l&&o.loadTrainingConfig(l);null!=r.userDefinedMetadata&&o.setUserDefinedMetadata(r.userDefinedMetadata);if(null!=r.weightData){if(null==r.weightSpecs)throw new AO("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:t,optimizerWeights:e}=function(t,e){const n=a_(t,e),r={},i=[];return e.forEach((t=>{"optimizer"===t.group?i.push({name:t.name,tensor:n[t.name]}):r[t.name]=n[t.name]})),{modelWeights:r,optimizerWeights:i}}(r.weightData,r.weightSpecs);o.loadWeights(t,s),null!=o.optimizer&&e.length>0&&await o.optimizer.setWeights(e),mT(t),mT(e.map((t=>t.tensor)))}return o}(t,void 0,e)}wL.className="Functional",HT(wL);class EL extends bL{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=null!=t.name?t.name:nP("sequential_"),null!=t.layers)for(const e of t.layers)this.add(e)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some((t=>t<0)))throw new AO(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const e=t instanceof EL||t instanceof bL;let n;if(e){if(n=t,1!==n.outputs.length)throw new AO("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new AO("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===t.inboundNodes.length){if(null==t.batchInputShape)throw new AO("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const e=ID({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(e)}if(e)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==t.inboundNodes.length)throw new AO(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(1!==t.inboundNodes[0].outputTensors.length)throw new AO("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=ED(this.outputs[0])}this.inboundNodes=[],new wD({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:PO(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((t=>t.shape)),outputShapes:this.outputs[0].shape})}else{const e=t.apply(this.outputs[0]);if(Array.isArray(e))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[e],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,e){return null==this.model&&this.build(),this.model.call(t,e)}build(t){if(dD(t),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new bL({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,e,n=console.log){this.built||this.build(),super.summary(t,e,n)}setWeights(t){null==this.model&&this.build(),this.model.setWeights(t)}evaluate(t,e,n={}){if(!this.built)throw new NO("The model needs to be compiled before being used.");return this.model.evaluate(t,e,n)}async evaluateDataset(t,e){if(!this.built)throw new NO("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,e)}predict(t,e={}){return null==this.model&&this.build(),this.model.predict(t,e)}predictOnBatch(t){return null==this.model&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,e,n={}){if(!this.built)throw new NO("The model needs to be compiled before being used.");return this.model.fit(t,e,n)}async fitDataset(t,e){if(!this.built)throw new NO("The model needs to be compiled before being used.");return this.model.fitDataset(t,e)}async trainOnBatch(t,e){return this.model.trainOnBatch(t,e)}static fromConfig(t,e,n={},r=!1){let i,s={};if(e instanceof Array){if(null==e[0].className||"Merge"===e[0].className)throw new AO("Legacy serialization format not supported yet.");i=e}else dg(null!=e.layers,(()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field.")),i=e.layers,delete e.layers,s=e;const a=new t(s);if(!(a instanceof EL))throw new RO(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const t of i){const e=bF(t,void 0,r);r&&e.setFastWeightInitDuringBuild(!0),a.add(e)}return a}set stopTraining(t){if(null==this.model)throw new AO("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(null==this.model)throw new AO("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const e of this.layers){const n={};n.className=e.getClassName(),n.config=e.getConfig(),t.push(n)}return{name:this.name,layers:t}}}function SL(t){return new bL(t)}function IL(t){return new EL(t)}function kL(t){return ID(t)}function CL(t,e){vF.registerCallbackConstructor(t,e)}EL.className="Sequential",HT(EL);class NL extends WT{getConfig(){return{}}}class AL extends NL{apply(t,e=1){return function(t,e=1){if(1!==e)throw new RO(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return YI(t)}(t,e)}}AL.className="elu",HT(AL);class RL extends NL{apply(t){return DC(t)}}RL.className="selu",HT(RL);class ML extends NL{apply(t){return IC(t)}}ML.className="relu",HT(ML);class OL extends NL{apply(t){return fT((()=>Yk(6,IC(t))))}}OL.className="relu6",HT(OL);class PL extends NL{apply(t){return t}}PL.className="linear",HT(PL);class DL extends NL{apply(t){return oI(t)}}DL.className="sigmoid",HT(DL);class FL extends NL{apply(t){return function(t){return fT((()=>{const e=kT(.5,AT(.2,t));return wI(e,0,1)}))}(t)}}FL.className="hardSigmoid",HT(FL);class LL extends NL{apply(t){return Nk(t)}}LL.className="softplus",HT(LL);class BL extends NL{apply(t){return function(t){return fT((()=>NT(t,kT(eE(t),1))))}(t)}}BL.className="softsign",HT(BL);class $L extends NL{apply(t){return hI(t)}}$L.className="tanh",HT($L);class UL extends NL{apply(t,e=-1){return XC(t,e)}}UL.className="softmax",HT(UL);class VL extends NL{apply(t,e=-1){return Rk(t,e)}}VL.className="logSoftmax",HT(VL);class zL extends NL{apply(t,e=1){return fT((()=>AT(oI(AT(t,e)),t)))}}zL.className="swish",HT(zL);class GL extends NL{apply(t){return fT((()=>AT(t,hI(Nk(t)))))}}function WL(t){return t.getClassName()}function XL(t,e={}){return WO(t,XT.getMap().classNameMap,e,"activation")}function HL(t){if(null==t){const t={className:"linear",config:{}};return XL(t)}if("string"==typeof t){const e={};return e.className=t,e.config={},XL(e)}return t instanceof NL?t:XL(t)}function YL(t){if(null!=t&&"object"!=typeof t)throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}GL.className="mish",HT(GL);class jL extends WT{}class qL extends jL{constructor(t){super(),YL(t),this.l1=null==t||null==t.l1?.01:t.l1,this.l2=null==t||null==t.l2?.01:t.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(t){return fT((()=>{let e=Wk([1]);return this.hasL1&&(e=kT(e,ak(AT(this.l1,eE(t))))),this.hasL2&&(e=kT(e,ak(AT(this.l2,FP(t))))),rI(e,[])}))}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,e){return new t({l1:e.l1,l2:e.l2})}}qL.className="L1L2",HT(qL);const KL={l1l2:"L1L2"};function ZL(t){return zO(t)}function JL(t,e={}){return WO(t,XT.getMap().classNameMap,e,"regularizer")}function QL(t){if(null==t)return null;if("string"==typeof t){return JL({className:t in KL?KL[t]:t,config:{}})}return t instanceof jL?t:JL(t)}class tB extends TD{constructor(t){super(null==t?{}:t),this.supportsMasking=!0,null!=t&&(this.maxValue=t.maxValue)}call(t,e){t=cD(t);let n=IC(t);return null!=this.maxValue&&(n=wI(n,0,this.maxValue)),n}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},e=super.getConfig();return Object.assign(t,e),t}}tB.className="ReLU",HT(tB);class eB extends TD{constructor(t){super(null==t?{}:t),this.DEFAULT_ALPHA=.3,null==t&&(t={}),this.alpha=null==t.alpha?this.DEFAULT_ALPHA:t.alpha}call(t,e){const n=cD(t);return _k(n,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}eB.className="LeakyReLU",HT(eB);class nB extends TD{constructor(t){if(super(null==t?{}:t),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==t&&(t={}),this.supportsMasking=!0,this.alphaInitializer=lD(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=QL(t.alphaRegularizer),this.alphaConstraint=GD(t.alphaConstraint),null==t.sharedAxes)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else{if("number"!=typeof t.sharedAxes)throw new AO(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`);this.sharedAxes=[t.sharedAxes]}}build(t){const e=(t=dD(t)).slice(1);if(null!=this.sharedAxes)for(const t of this.sharedAxes)e[t-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let e=1;e<t.length;++e)n[e]=t[e];this.inputSpec=[new vD({ndim:t.length,axes:n})],this.built=!0}call(t,e){return t=cD(t),hC(t,this.alpha.read())}getConfig(){const t={alphaInitializer:oD(this.alphaInitializer),alphaRegularizer:ZL(this.alphaRegularizer),alphaConstraint:VD(this.alphaConstraint),sharedAxes:this.sharedAxes},e=super.getConfig();return Object.assign(t,e),t}}nB.className="PReLU",HT(nB);class rB extends TD{constructor(t){if(super(null==t?{}:t),this.DEFAULT_ALPHA=1,null==t&&(t={}),null!=t.alpha&&t.alpha!==this.DEFAULT_ALPHA)throw new RO(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=null==t.alpha?this.DEFAULT_ALPHA:t.alpha}call(t,e){const n=cD(t);return YI(n)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}rB.className="ELU",HT(rB);class iB extends TD{constructor(t){super(null==t?{}:t),this.DEFAULT_THETA=1,null==t&&(t={}),this.theta=null==t.theta?this.DEFAULT_THETA:t.theta}call(t,e){const n=cD(t);return AT(n,rT(yk(n,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},e=super.getConfig();return Object.assign(t,e),t}}iB.className="ThresholdedReLU",HT(iB);class sB extends TD{constructor(t){super(null==t?{}:t),this.DEFAULT_AXIS=1,null==t&&(t={}),this.softmax=(new UL).apply,this.axis=null==t.axis?this.DEFAULT_AXIS:t.axis}call(t,e){const n=cD(t);return this.softmax(n,this.axis)}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}function aB(t,e,n){if("number"==typeof t)return PO(t,e);if(t.length!==e)throw new AO(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let r=0;r<e;++r){const i=t[r];if(!vP(i))throw new AO(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${i}`)}return t}function oB(t,e,n,r,i=1){if(null==t)return t;let s;return s="same"===n?t:t-(e+(e-1)*(i-1))+1,Math.floor((s+r-1)/r)}function lB(t,e,n,r){if(null==t)return null;if("valid"===r)t=t*e+wP([n-e,0]);else{if("same"!==r)throw new AO(`Unsupport padding mode: ${r}.`);t*=e}return t}function hB(t,e){return fT((()=>(hP(e),"channelsFirst"===e?FE(t,[0,2,3,1]):t)))}function uB(t,e){return fT((()=>(hP(e),"channelsFirst"===e?FE(t,[0,2,3,4,1]):t)))}function cB(t,e,n,r=1,i="valid",s,a=1){return fT((()=>{if(null==s&&(s="channelsLast"),hP(s),3!==t.shape.length)throw new AO(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(3!==e.shape.length)throw new AO(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(null!=n&&1!==n.shape.length)throw new AO(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if("channelsFirst"===s&&(t=FE(t,[0,2,1])),"causal"===i)throw new RO("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let o=kI(t,e,r,"same"===i?"same":"valid","NWC",a);return null!=n&&(o=BP(o,n)),o}))}function dB(t,e,n,r=[1,1],i="valid",s,a,o=null){return fT((()=>{if(null==s&&(s="channelsLast"),hP(s),3!==t.rank&&4!==t.rank)throw new AO(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(3!==e.rank&&4!==e.rank)throw new AO(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=hB(t,s);if("causal"===i)throw new RO("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=MN({x:l,filter:e,strides:r,pad:"same"===i?"same":"valid",dilations:a,dataFormat:"NHWC",bias:n,activation:o}),"channelsFirst"===s&&(l=FE(l,[0,3,1,2])),l}))}function pB(t,e,n,r=[1,1,1],i="valid",s,a){return fT((()=>{if(null==s&&(s="channelsLast"),hP(s),4!==t.rank&&5!==t.rank)throw new AO(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(4!==e.rank&&5!==e.rank)throw new AO(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let o=uB(t,s);if("causal"===i)throw new RO("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return o=AI(o,e,r,"same"===i?"same":"valid","NDHWC",a),null!=n&&(o=BP(o,n)),"channelsFirst"===s&&(o=FE(o,[0,4,1,2,3])),o}))}sB.className="Softmax",HT(sB);class fB extends TD{constructor(t,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",fB.verifyArgs(e),this.rank=t,KO(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new RO(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=aB(e.kernelSize,t,"kernelSize"),this.strides=aB(null==e.strides?1:e.strides,t,"strides"),this.padding=null==e.padding?"valid":e.padding,uP(this.padding),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,hP(this.dataFormat),this.activation=HL(e.activation),this.useBias=null==e.useBias||e.useBias,this.biasInitializer=lD(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=GD(e.biasConstraint),this.biasRegularizer=QL(e.biasRegularizer),this.activityRegularizer=QL(e.activityRegularizer),this.dilationRate=aB(null==e.dilationRate?1:e.dilationRate,t,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new AO(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(2===this.rank){if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new AO(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(3===this.rank)if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new AO(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}static verifyArgs(t){if(DO("kernelSize"in t,"required key 'kernelSize' not in config"),"number"!=typeof t.kernelSize&&!qO(t.kernelSize,"number",1,3))throw new AO(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:WL(this.activation),useBias:this.useBias,biasInitializer:oD(this.biasInitializer),biasRegularizer:ZL(this.biasRegularizer),activityRegularizer:ZL(this.activityRegularizer),biasConstraint:VD(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}class mB extends fB{constructor(t,e){super(t,e),this.kernel=null,mB.verifyArgs(e),this.filters=e.filters,KO(this.filters,"filters"),this.kernelInitializer=lD(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=GD(e.kernelConstraint),this.kernelRegularizer=QL(e.kernelRegularizer)}build(t){t=dD(t);const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new AO(`The channel dimension of the input should be defined. Found ${t[e]}`);const n=t[e],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:n}}],this.built=!0}call(t,e){return fT((()=>{let e;t=cD(t);const n=null==this.bias?null:this.bias.read(),r=JO(this.activation.getClassName());if(null!=r&&2===this.rank)e=dB(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(1===this.rank)e=cB(t,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)e=dB(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new RO("convolutions greater than 3D are not implemented yet.");e=pB(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(e=this.activation.apply(e))}return e}))}computeOutputShape(t){t=dD(t);const e=[],n="channelsLast"===this.dataFormat?t.slice(1,t.length-1):t.slice(2);for(let t=0;t<n.length;++t){const r=oB(n[t],this.kernelSize[t],this.padding,this.strides[t],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[t]);e.push(r)}let r=[t[0]];return"channelsLast"===this.dataFormat?(r=r.concat(e),r.push(this.filters)):(r.push(this.filters),r=r.concat(e)),r}getConfig(){const t={filters:this.filters,kernelInitializer:oD(this.kernelInitializer),kernelRegularizer:ZL(this.kernelRegularizer),kernelConstraint:VD(this.kernelConstraint)},e=super.getConfig();return Object.assign(t,e),t}static verifyArgs(t){if(!("filters"in t)||"number"!=typeof t.filters||t.filters<1)throw new AO(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class gB extends mB{constructor(t){super(2,t),gB.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&!qO(t.kernelSize,"number",1,2))throw new AO(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}gB.className="Conv2D",HT(gB);class yB extends mB{constructor(t){super(3,t),yB.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&(!Array.isArray(t.kernelSize)||1!==t.kernelSize.length&&3!==t.kernelSize.length))throw new AO(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}yB.className="Conv3D",HT(yB);class vB extends gB{constructor(t){if(super(t),this.inputSpec=[new vD({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new AO(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(4!==(t=dD(t)).length)throw new AO("Input should have rank 4; Received input shape: "+JSON.stringify(t));const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new AO("The channel dimension of the inputs should be defined. Found `None`.");const n=t[e],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new vD({ndim:4,axes:{[e]:n}})],this.built=!0}call(t,e){return fT((()=>{let e=cD(t);if(4!==e.shape.length)throw new AO(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${e.shape.length}`);const n=e.shape,r=n[0];let i,s;"channelsFirst"===this.dataFormat?(i=2,s=3):(i=1,s=2);const a=n[i],o=n[s],l=this.kernelSize[0],h=this.kernelSize[1],u=this.strides[0],c=this.strides[1],d=[r,lB(a,u,l,this.padding),lB(o,c,h,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(e=FE(e,[0,2,3,1]));let p=NI(e,this.kernel.read(),d,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(p=FE(p,[0,3,1,2])),null!=this.bias&&(p=BP(p,this.bias.read(),this.dataFormat)),null!=this.activation&&(p=this.activation.apply(p)),p}))}computeOutputShape(t){const e=(t=dD(t)).slice();let n,r,i;"channelsFirst"===this.dataFormat?(n=1,r=2,i=3):(n=3,r=1,i=2);const s=this.kernelSize[0],a=this.kernelSize[1],o=this.strides[0],l=this.strides[1];return e[n]=this.filters,e[r]=lB(e[r],o,s,this.padding),e[i]=lB(e[i],l,a,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}vB.className="Conv2DTranspose",HT(vB);class xB extends yB{constructor(t){if(super(t),this.inputSpec=[new vD({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new AO(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(5!==(t=dD(t)).length)throw new AO("Input should have rank 5; Received input shape: "+JSON.stringify(t));const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new AO("The channel dimension of the inputs should be defined. Found `None`.");const n=t[e],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new vD({ndim:5,axes:{[e]:n}})],this.built=!0}call(t,e){return fT((()=>{let e=cD(t);if(5!==e.shape.length)throw new AO(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${e.shape.length}`);const n=e.shape,r=n[0];let i,s,a;"channelsFirst"===this.dataFormat?(a=2,i=3,s=4):(a=1,i=2,s=3);const o=n[a],l=n[i],h=n[s],u=this.kernelSize[0],c=this.kernelSize[1],d=this.kernelSize[2],p=this.strides[0],f=this.strides[1],m=this.strides[2],g=[r,lB(o,p,u,this.padding),lB(l,f,c,this.padding),lB(h,m,d,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(e=FE(e,[0,2,3,4,1]));let y=MI(e,this.kernel.read(),g,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(y=FE(y,[0,4,1,2,3])),null!==this.bias&&(y=BP(y,this.bias.read(),this.dataFormat)),null!==this.activation&&(y=this.activation.apply(y)),y}))}computeOutputShape(t){const e=(t=dD(t)).slice();let n,r,i,s;"channelsFirst"===this.dataFormat?(n=1,r=2,i=3,s=4):(n=4,r=1,i=2,s=3);const a=this.kernelSize[0],o=this.kernelSize[1],l=this.kernelSize[2],h=this.strides[0],u=this.strides[1],c=this.strides[2];return e[n]=this.filters,e[r]=lB(e[r],h,a,this.padding),e[i]=lB(e[i],u,o,this.padding),e[s]=lB(e[s],c,l,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}xB.className="Conv3DTranspose",HT(xB);class bB extends mB{constructor(t,e){if(super(t,e),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==e.filters)throw new AO("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=e.kernelInitializer||null!=e.kernelRegularizer||null!=e.kernelConstraint)throw new AO("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=e.padding&&"same"!==e.padding&&"valid"!==e.padding)throw new AO(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(e.padding)}`);this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=lD(e.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=QL(e.depthwiseRegularizer),this.depthwiseConstraint=GD(e.depthwiseConstraint),this.pointwiseInitializer=lD(e.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=QL(e.pointwiseRegularizer),this.pointwiseConstraint=GD(e.pointwiseConstraint)}build(t){if((t=dD(t)).length<this.rank+2)throw new AO(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e]||t[e]<0)throw new AO(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[e])}`);const n=t[e],r=this.kernelSize.concat([n,this.depthMultiplier]),i=[];for(let t=0;t<this.rank;++t)i.push(1);i.push(n*this.depthMultiplier,this.filters);const s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new vD({ndim:this.rank+2,axes:{[e]:n}})],this.built=!0}call(t,e){return fT((()=>{let e;if(t=cD(t),1===this.rank)throw new RO("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(t=FE(t,[0,2,3,1])),e=FC(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(e=BP(e,this.bias.read(),this.dataFormat)),null!=this.activation&&(e=this.activation.apply(e)),"channelsFirst"===this.dataFormat&&(e=FE(e,[0,3,1,2])),e}))}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=oD(this.depthwiseInitializer),t.pointwiseInitializer=oD(this.pointwiseInitializer),t.depthwiseRegularizer=ZL(this.depthwiseRegularizer),t.pointwiseRegularizer=ZL(this.pointwiseRegularizer),t.depthwiseConstraint=VD(this.depthwiseConstraint),t.pointwiseConstraint=VD(this.pointwiseConstraint),t}}bB.className="SeparableConv";class wB extends bB{constructor(t){super(2,t)}}wB.className="SeparableConv2D",HT(wB);class _B extends mB{constructor(t){super(1,t),_B.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&!qO(t.kernelSize,"number",1,1))throw new AO(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}_B.className="Conv1D",HT(_B);class TB extends TD{constructor(t){super(t),"number"==typeof t.cropping?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:"number"==typeof t.cropping[0]?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=void 0===t.dataFormat?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return"channelsFirst"===this.dataFormat?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,e){return fT((()=>{if(t=cD(t),"channelsLast"===this.dataFormat){const e=NP(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return NP(e,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const e=NP(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return NP(e,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}}))}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}TB.className="Cropping2D",HT(TB);class EB extends TD{constructor(t){var e;super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==t.size?this.DEFAULT_SIZE:t.size,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,hP(this.dataFormat),this.interpolation=null==t.interpolation?"nearest":t.interpolation,e=this.interpolation,jO(iP,"InterpolationFormat",e)}computeOutputShape(t){if("channelsFirst"===this.dataFormat){const e=null==t[2]?null:this.size[0]*t[2],n=null==t[3]?null:this.size[1]*t[3];return[t[0],t[1],e,n]}{const e=null==t[1]?null:this.size[0]*t[1],n=null==t[2]?null:this.size[1]*t[2];return[t[0],e,n,t[3]]}}call(t,e){return fT((()=>{let e=cD(t);const n=e.shape;if("channelsFirst"===this.dataFormat){e=FE(e,[0,2,3,1]);const t=this.size[0]*n[2],r=this.size[1]*n[3],i="nearest"===this.interpolation?DA.resizeNearestNeighbor(e,[t,r]):DA.resizeBilinear(e,[t,r]);return FE(i,[0,3,1,2])}{const t=this.size[0]*n[1],r=this.size[1]*n[2];return"nearest"===this.interpolation?DA.resizeNearestNeighbor(e,[t,r]):DA.resizeBilinear(e,[t,r])}}))}getConfig(){const t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}}EB.className="UpSampling2D",HT(EB);class SB extends fB{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=lD(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=GD(t.depthwiseConstraint),this.depthwiseRegularizer=QL(t.depthwiseRegularizer)}build(t){if((t=dD(t)).length<4)throw new AO(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const e="channelsFirst"===this.dataFormat?1:3;if(null==t[e]||t[e]<0)throw new AO(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[e]}).`);const n=t[e],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return fT((()=>{let e=function(t,e,n=[1,1],r="valid",i,s){return fT((()=>{null==i&&(i="channelsLast"),hP(i);let a=hB(t,i);if(4!==t.rank)throw new AO(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(4!==e.rank)throw new AO(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return a=$I(a,e,n,"same"===r?"same":"valid","NHWC",s),"channelsFirst"===i&&(a=FE(a,[0,3,1,2])),a}))}(t=cD(t),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(e=BP(e,this.bias.read(),this.dataFormat)),null!=this.activation&&(e=this.activation.apply(e)),e}))}computeOutputShape(t){t=dD(t);const e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],r="channelsFirst"===this.dataFormat?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,i=oB(e,this.kernelSize[0],this.padding,this.strides[0]),s=oB(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[t[0],r,i,s]:[t[0],i,s,r]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=oD(this.depthwiseInitializer),t.depthwiseRegularizer=ZL(this.depthwiseRegularizer),t.depthwiseConstraint=VD(this.depthwiseRegularizer),t}}function IB(t,e,n,r){if(Array.isArray(t)){if(null!=e||null!=n)throw new AO("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function i(t){return null==t||Array.isArray(t)?t:[t]}return{inputs:t,initialState:e=i(e),constants:n=i(n)}}function kB(t,e,n,r=!1,i,s,a=!1,o=!1){return fT((()=>{const a=e.shape.length;if(a<3)throw new AO(`Input should be at least 3D, but is ${a}D.`);const l=[1,0].concat(_P(2,a));if(e=FE(e,l),null!=s)throw new RO("The rnn() functoin of the deeplearn.js backend does not support constants yet.");null!=i&&((i=rT(rT(i,"bool"),"float32")).rank===a-1&&(i=ck(i,-1)),i=FE(i,l)),r&&(e=CC(e,0),null!=i&&(i=CC(i,0)));const h=[];let u,c=n;const d=e.shape[0],p=pN(e);let f,m;null!=i&&(f=pN(i));for(let e=0;e<d;++e){const n=p[e],r=fT((()=>t(n,c)));if(null==i)u=r[0],c=r[1];else{const t=fT((()=>{const t=f[e],n=QT(tC(t),t),i=kT(AT(r[0],t),AT(c[0],n)),s=c.map(((e,i)=>kT(AT(r[1][i],t),AT(e,n))));return{output:i,newStates:s}}));u=t.output,c=t.newStates}o&&h.push(u)}if(o){m=QC(h,1)}return[u,m,c]}))}SB.className="DepthwiseConv2D",HT(SB);class CB extends TD{constructor(t){let e;if(super(t),null==t.cell)throw new AO("cell property is missing for the constructor of RNN.");if(e=Array.isArray(t.cell)?new FB({cells:t.cell}):t.cell,null==e.stateSize)throw new AO("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=e,this.returnSequences=null!=t.returnSequences&&t.returnSequences,this.returnState=null!=t.returnState&&t.returnState,this.goBackwards=null!=t.goBackwards&&t.goBackwards,this._stateful=null!=t.stateful&&t.stateful,this.unroll=null!=t.unroll&&t.unroll,this.supportsMasking=!0,this.inputSpec=[new vD({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(null==this.states_){return _P(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((t=>null))}return this.states_}setStates(t){this.states_=t}computeOutputShape(t){hD(t)&&(t=t[0]),t=t;let e=this.cell.stateSize;Array.isArray(e)||(e=[e]);const n=e[0];let r;if(r=this.returnSequences?[t[0],t[1],n]:[t[0],n],this.returnState){const n=[];for(const r of e)n.push([t[0],r]);return[r].concat(n)}return r}computeMask(t,e){return fT((()=>{Array.isArray(e)&&(e=e[0]);const t=this.returnSequences?e:null;if(this.returnState){const e=this.states.map((t=>null));return[t].concat(e)}return t}))}get states(){if(null==this.states_){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[];for(let n=0;n<t;++n)e.push(null);return e}return this.states_}set states(t){this.states_=t}build(t){if(null!=this.numConstants)throw new RO("Constants support is not implemented in RNN yet.");hD(t)&&(t=t[0]),t=t;const e=this.stateful?t[0]:null,n=t.slice(2);this.inputSpec[0]=new vD({shape:[e,null,...n]});const r=[t[0]].concat(t.slice(2));let i;if(this.cell.build(r),i=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!vg(this.stateSpec.map((t=>t.shape[t.shape.length-1])),i))throw new AO(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map((t=>new vD({shape:[null,t]})));this.stateful&&this.resetStates()}resetStates(t,e=!1){fT((()=>{if(!this.stateful)throw new CO("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new AO("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((t=>Wk([n,t]))):this.states_=[Wk([n,this.cell.stateSize])];else if(null==t)mT(this.states_),null!=this.keptStates&&(mT(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((t=>Wk([n,t]))):this.states_[0]=Wk([n,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new AO(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);!0===e?this.keptStates.push(this.states_.slice()):mT(this.states_);for(let e=0;e<this.states_.length;++e){const r=t[e],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[e]:this.cell.stateSize,s=[n,i];if(!vg(r.shape,s))throw new AO(`State ${e} is incompatible with layer ${this.name}: expected shape=${s}, received shape=${r.shape}`);this.states_[e]=r}}this.states_=this.states_.map((t=>gT(t.clone())))}))}apply(t,e){let n=null==e?null:e.initialState,r=null==e?null:e.constants;null==e&&(e={});const i=IB(t,n,r,this.numConstants);t=i.inputs,n=i.initialState,r=i.constants;let s=[],a=[];if(null!=n){e.initialState=n,s=s.concat(n),this.stateSpec=[];for(const t of n)this.stateSpec.push(new vD({shape:t.shape}));a=a.concat(this.stateSpec)}null!=r&&(e.constants=r,s=s.concat(r),this.numConstants=r.length);if(s[0]instanceof xD){const n=[t].concat(s),r=this.inputSpec.concat(a),i=this.inputSpec;this.inputSpec=r;const o=super.apply(n,e);return this.inputSpec=i,o}return super.apply(t,e)}call(t,e){return fT((()=>{const n=null==e?null:e.mask,r=null==e?null:e.training;let i=null==e?null:e.initialState;t=cD(t),null==i&&(i=this.stateful?this.states_:this.getInitialState(t));const s=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==s)throw new AO(`RNN Layer has ${s} state(s) but was passed ${i.length} initial state(s).`);this.unroll;const a={training:r},o=kB(((t,e)=>{const n=this.cell.call([t].concat(e),a);return[n[0],n.slice(1)]}),t,i,this.goBackwards,n,null,this.unroll,this.returnSequences),l=o[0],h=o[1],u=o[2];this.stateful&&this.resetStates(u,r);const c=this.returnSequences?h:l;return this.returnState?[c].concat(u):c}))}getInitialState(t){return fT((()=>{let e=Wk(t.shape);return e=ak(e,[1,2]),e=IP(e),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map((t=>t>1?MP(e,[1,t]):e)):this.cell.stateSize>1?[MP(e,[1,this.cell.stateSize])]:[e]}))}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(e.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===CB.className&&(e.cell={className:this.cell.getClassName(),config:n}),Object.assign(Object.assign(Object.assign({},n),t),e)}static fromConfig(t,e,n={}){const r=bF(e.cell,n);return new t(Object.assign(e,{cell:r}))}}CB.className="RNN",HT(CB);class NB extends TD{}class AB extends NB{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,KO(this.units,"units"),this.activation=HL(null==t.activation?this.DEFAULT_ACTIVATION:t.activation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=lD(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=lD(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=lD(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=QL(t.kernelRegularizer),this.recurrentRegularizer=QL(t.recurrentRegularizer),this.biasRegularizer=QL(t.biasRegularizer),this.kernelConstraint=GD(t.kernelConstraint),this.recurrentConstraint=GD(t.recurrentConstraint),this.biasConstraint=GD(t.biasConstraint),this.dropout=bP([1,wP([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=bP([1,wP([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=dD(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return fT((()=>{if(2!==(t=t).length)throw new AO(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let n=t[1];t=t[0];const r=null!=e.training&&e.training;let i;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=LB({ones:()=>tC(t),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=LB({ones:()=>tC(n),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,a=this.recurrentDropoutMask;i=PP(null!=s?AT(t,s):t,this.kernel.read()),null!=this.bias&&(i=BP(i,this.bias.read())),null!=a&&(n=AT(n,a));let o=kT(i,PP(n,this.recurrentKernel.read()));return null!=this.activation&&(o=this.activation.apply(o)),[o,o]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:WL(this.activation),useBias:this.useBias,kernelInitializer:oD(this.kernelInitializer),recurrentInitializer:oD(this.recurrentInitializer),biasInitializer:oD(this.biasInitializer),kernelRegularizer:ZL(this.kernelRegularizer),recurrentRegularizer:ZL(this.recurrentRegularizer),biasRegularizer:ZL(this.biasRegularizer),activityRegularizer:ZL(this.activityRegularizer),kernelConstraint:VD(this.kernelConstraint),recurrentConstraint:VD(this.recurrentConstraint),biasConstraint:VD(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),e)}}AB.className="SimpleRNNCell",HT(AB);class RB extends CB{constructor(t){t.cell=new AB(t),super(t)}call(t,e){return fT((()=>{null!=this.cell.dropoutMask&&(mT(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(mT(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,r=null==e?null:e.training,i=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:i})}))}static fromConfig(t,e){return new t(e)}}RB.className="SimpleRNN",HT(RB);class MB extends NB{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new AO("GRUCell does not support reset_after parameter set to true.");this.units=t.units,KO(this.units,"units"),this.activation=HL(void 0===t.activation?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=HL(void 0===t.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=lD(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=lD(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=lD(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=QL(t.kernelRegularizer),this.recurrentRegularizer=QL(t.recurrentRegularizer),this.biasRegularizer=QL(t.biasRegularizer),this.kernelConstraint=GD(t.kernelConstraint),this.recurrentConstraint=GD(t.recurrentConstraint),this.biasConstraint=GD(t.biasConstraint),this.dropout=bP([1,wP([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=bP([1,wP([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){const e=(t=dD(t))[t.length-1];this.kernel=this.addWeight("kernel",[e,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return fT((()=>{if(2!==(t=t).length)throw new AO(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const n=null!=e.training&&e.training;let r=t[1];t=t[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=LB({ones:()=>tC(t),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=LB({ones:()=>tC(r),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,s=this.recurrentDropoutMask;let a,o,l;0<this.dropout&&this.dropout<1&&(t=AT(t,i[0]));let h=PP(t,this.kernel.read());this.useBias&&(h=BP(h,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=AT(r,s[0]));const u=this.recurrentKernel.read(),[c,d]=qC(u,[2*this.units,this.units],u.rank-1),p=PP(r,c),[f,m,g]=qC(h,3,h.rank-1),[y,v]=qC(p,2,p.rank-1);a=this.recurrentActivation.apply(kT(f,y)),o=this.recurrentActivation.apply(kT(m,v));const x=PP(AT(o,r),d);l=this.activation.apply(kT(g,x));const b=kT(AT(a,r),AT(kT(1,PE(a)),l));return[b,b]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:WL(this.activation),recurrentActivation:WL(this.recurrentActivation),useBias:this.useBias,kernelInitializer:oD(this.kernelInitializer),recurrentInitializer:oD(this.recurrentInitializer),biasInitializer:oD(this.biasInitializer),kernelRegularizer:ZL(this.kernelRegularizer),recurrentRegularizer:ZL(this.recurrentRegularizer),biasRegularizer:ZL(this.biasRegularizer),activityRegularizer:ZL(this.activityRegularizer),kernelConstraint:VD(this.kernelConstraint),recurrentConstraint:VD(this.recurrentConstraint),biasConstraint:VD(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),e)}}MB.className="GRUCell",HT(MB);class OB extends CB{constructor(t){t.implementation,t.cell=new MB(t),super(t)}call(t,e){return fT((()=>{null!=this.cell.dropoutMask&&(mT(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(mT(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,r=null==e?null:e.training,i=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:i})}))}static fromConfig(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)}}OB.className="GRU",HT(OB);class PB extends NB{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,KO(this.units,"units"),this.activation=HL(void 0===t.activation?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=HL(void 0===t.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=lD(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=lD(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=lD(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=QL(t.kernelRegularizer),this.recurrentRegularizer=QL(t.recurrentRegularizer),this.biasRegularizer=QL(t.biasRegularizer),this.kernelConstraint=GD(t.kernelConstraint),this.recurrentConstraint=GD(t.recurrentConstraint),this.biasConstraint=GD(t.biasConstraint),this.dropout=bP([1,wP([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=bP([1,wP([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var e;const n=(t=dD(t))[t.length-1];let r;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const t=this.biasInitializer,n=this.units;r=new((e=class extends GP{apply(e,r){const i=t.apply([n]),s=(new XP).apply([n]),a=t.apply([2*n]);return RP(RP(i,s),a)}}).className="CustomInit",e)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,e){return fT((()=>{const n=null!=e.training&&e.training;if(3!==(t=t).length)throw new AO(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let r=t[1];const i=t[2];t=t[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=LB({ones:()=>tC(t),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=LB({ones:()=>tC(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,a=this.recurrentDropoutMask;let o,l,h,u;0<this.dropout&&this.dropout<1&&(t=AT(t,s[0]));let c=PP(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=AT(r,a[0])),c=kT(c,PP(r,this.recurrentKernel.read())),this.useBias&&(c=BP(c,this.bias.read()));const[d,p,f,m]=qC(c,4,c.rank-1);o=this.recurrentActivation.apply(d),l=this.recurrentActivation.apply(p),h=kT(AT(l,i),AT(o,this.activation.apply(f))),u=this.recurrentActivation.apply(m);const g=AT(u,this.activation.apply(h));return[g,g,h]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:WL(this.activation),recurrentActivation:WL(this.recurrentActivation),useBias:this.useBias,kernelInitializer:oD(this.kernelInitializer),recurrentInitializer:oD(this.recurrentInitializer),biasInitializer:oD(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:ZL(this.kernelRegularizer),recurrentRegularizer:ZL(this.recurrentRegularizer),biasRegularizer:ZL(this.biasRegularizer),activityRegularizer:ZL(this.activityRegularizer),kernelConstraint:VD(this.kernelConstraint),recurrentConstraint:VD(this.recurrentConstraint),biasConstraint:VD(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),e)}}PB.className="LSTMCell",HT(PB);class DB extends CB{constructor(t){t.implementation,t.cell=new PB(t),super(t)}call(t,e){return fT((()=>{null!=this.cell.dropoutMask&&(mT(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(mT(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e.mask,r=null==e?null:e.training,i=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:i})}))}static fromConfig(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)}}DB.className="LSTM",HT(DB);class FB extends NB{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?t.push(...e.stateSize):t.push(e.stateSize);return t}call(t,e){return fT((()=>{let n=(t=t).slice(1);const r=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?r.push(n.splice(0,t.stateSize.length)):r.push(n.splice(0,1));r.reverse();const i=[];let s;for(let a=0;a<this.cells.length;++a){const o=this.cells[a];n=r[a],s=0===a?[t[0]].concat(n):[s[0]].concat(n),s=o.call(s,e),i.push(s.slice(1))}n=[];for(const t of i.slice().reverse())n.push(...t);return[s[0]].concat(n)}))}build(t){let e;hD(t)&&(t=t[0]),t=t,this.cells.forEach(((n,r)=>{pP(`RNNCell_${r}`,(()=>{n.build(t),e=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,t=[t[0],e]}))})),this.built=!0}getConfig(){const t=super.getConfig(),e={cells:this.cells.map((t=>({className:t.getClassName(),config:t.getConfig()})))};return Object.assign(Object.assign({},t),e)}static fromConfig(t,e,n={}){const r=[];for(const t of e.cells)r.push(bF(t,n));return new t({cells:r})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.cells)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e.concat(t)}return t}getWeights(){const t=[];for(const e of this.cells)t.push(...e.weights);return gD(t)}setWeights(t){const e=[];for(const n of this.cells){const r=n.weights.length,i=t.splice(r);for(let t=0;t<n.weights.length;++t)e.push([n.weights[t],i[t]])}yD(e)}}function LB(t){const{ones:e,rate:n,training:r=!1,count:i=1,dropoutFunc:s}=t,a=()=>null!=s?s(e(),n):$P(e(),n),o=()=>UP(a,e,r);if(!i||i<=1)return gT(o().clone());return Array(i).fill(void 0).map(o).map((t=>gT(t.clone())))}FB.className="StackedRNNCells",HT(FB);var BB=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};class $B extends CB{constructor(t){if(t.unroll)throw new RO("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new RO("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new vD({ndim:5})]}call(t,e){return fT((()=>{if(null!=this.cell.dropoutMask&&(mT(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(mT(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),e&&e.constants)throw new AO("ConvRNN2D cell does not support constants");const n=null==e?null:e.mask,r=null==e?null:e.training,i=null==e?null:e.initialState;return super.call(t,{mask:n,training:r,initialState:i})}))}computeOutputShape(t){let e=this.computeSingleOutputShape(t);return this.returnSequences||(e=[e[0],...e.slice(2)]),this.returnState&&(e=[e,...Array(2).fill([t[0],...e.slice(-3)])]),e}getInitialState(t){return fT((()=>{const{stateSize:e}=this.cell,n=t.shape,r=this.computeSingleOutputShape(n),i=Wk([r[0],...r.slice(2)]);return Array.isArray(e)?Array(e.length).fill(i):[i]}))}resetStates(t,e=!1){fT((()=>{if(!this.stateful)throw new CO("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),i=[r[0],...r.slice(2)];if(null==n[0])throw new AO("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>Wk(i))):this.states_=[Wk(i)];else if(null==t)mT(this.states_),null!=this.keptStates&&(mT(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>Wk(i))):this.states_[0]=Wk(i);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new AO(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e?this.keptStates.push(this.states_.slice()):mT(this.states_);for(let e=0;e<this.states_.length;++e){const n=t[e],r=i;if(!vg(n.shape,r))throw new AO(`State ${e} is incompatible with layer ${this.name}: expected shape=${r}, received shape=${n.shape}`);this.states_[e]=n}}this.states_=this.states_.map((t=>gT(t.clone())))}))}computeSingleOutputShape(t){const{dataFormat:e,filters:n,kernelSize:r,padding:i,strides:s,dilationRate:a}=this.cell,o="channelsFirst"===e,l=t[o?3:2],h=t[o?4:3],u=oB(l,r[0],i,s[0],a[0]),c=oB(h,r[1],i,s[1],a[1]);return[...t.slice(0,2),...o?[n,u,c]:[u,c,n]]}}$B.className="ConvRNN2D";class UB extends PB{constructor(t){const{filters:e,kernelSize:n,strides:r,padding:i,dataFormat:s,dilationRate:a}=t;super(Object.assign(Object.assign({},t),{units:e})),this.filters=e,KO(this.filters,"filters"),this.kernelSize=aB(n,2,"kernelSize"),this.kernelSize.forEach((t=>KO(t,"kernelSize"))),this.strides=aB(r||1,2,"strides"),this.strides.forEach((t=>KO(t,"strides"))),this.padding=i||"valid",uP(this.padding),this.dataFormat=s||"channelsLast",hP(this.dataFormat),this.dilationRate=aB(a||1,2,"dilationRate"),this.dilationRate.forEach((t=>KO(t,"dilationRate")))}build(t){var e;t=dD(t);const n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n])throw new AO(`The channel dimension of the input should be defined. Found ${t[n]}`);const r=t[n],i=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const s=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",s,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let t;if(this.unitForgetBias){const n=this.biasInitializer,r=this.filters;t=new(e=class extends GP{apply(t,e){return AP([n.apply([r]),Xk([r]),n.apply([2*r])])}},e.className="CustomInit",e)}else t=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,t,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,e){return fT((()=>{if(3!==t.length)throw new AO(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const n=e.training||!1,r=t[0],i=t[1],s=t[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=LB({ones:()=>tC(r),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,o=(t,e,n)=>e&&e[n]?AT(e[n],t):t;let l=o(r,a,0),h=o(r,a,1),u=o(r,a,2),c=o(r,a,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=LB({ones:()=>tC(i),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const d=this.recurrentDropoutMask;let p=o(i,d,0),f=o(i,d,1),m=o(i,d,2),g=o(i,d,3);const[y,v,x,b]=qC(this.kernel.read(),4,3),[w,_,T,E]=this.useBias?qC(this.bias.read(),4):[null,null,null,null];l=this.inputConv(l,y,w,this.padding),h=this.inputConv(h,v,_,this.padding),u=this.inputConv(u,x,T,this.padding),c=this.inputConv(c,b,E,this.padding);const[S,I,k,C]=qC(this.recurrentKernel.read(),4,3);p=this.recurrentConv(p,S),f=this.recurrentConv(f,I),m=this.recurrentConv(m,k),g=this.recurrentConv(g,C);const N=this.recurrentActivation.apply(kT(l,p)),A=this.recurrentActivation.apply(kT(h,f)),R=kT(AT(A,s),AT(N,this.activation.apply(kT(u,m)))),M=AT(this.recurrentActivation.apply(kT(c,g)),this.activation.apply(R));return[M,M,R]}))}getConfig(){const t=super.getConfig(),{units:e}=t,n=BB(t,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),r)}inputConv(t,e,n,r){const i=II(t,e,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?BP(i,n,this.dataFormat):i}recurrentConv(t,e){return II(t,e,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}UB.className="ConvLSTM2DCell",HT(UB);class VB extends $B{constructor(t){const e=new UB(t);super(Object.assign(Object.assign({},t),{cell:e}))}static fromConfig(t,e){return new t(e)}}VB.className="ConvLSTM2D",HT(VB);class zB extends TD{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(null==this.noiseShape)return this.noiseShape;const e=t.shape,n=[];for(let t=0;t<this.noiseShape.length;++t)n.push(null==this.noiseShape[t]?e[t]:this.noiseShape[t]);return n}call(t,e){return fT((()=>{this.invokeCallHook(t,e);const n=cD(t);if(0<this.rate&&this.rate<1){const t=null!=e.training&&e.training,r=this.getNoiseShape(n);return UP((()=>$P(n,this.rate,r,this.seed)),(()=>n),t)}return t}))}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},e=super.getConfig();return Object.assign(t,e),t}dispose(){return super.dispose()}}zB.className="Dropout",HT(zB);class GB extends zB{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const e=t.shape;return[e[0],1,e[2]]}}GB.className="SpatialDropout1D",HT(GB);class WB extends TD{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==t.batchInputShape&&null==t.inputShape&&null!=t.inputDim){let e=null;null!=t.batchSize&&(e=t.batchSize),this.batchInputShape=[e,t.inputDim]}this.units=t.units,KO(this.units,"units"),this.activation=HL(t.activation),null!=t.useBias&&(this.useBias=t.useBias),this.kernelInitializer=lD(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=lD(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=GD(t.kernelConstraint),this.biasConstraint=GD(t.biasConstraint),this.kernelRegularizer=QL(t.kernelRegularizer),this.biasRegularizer=QL(t.biasRegularizer),this.activityRegularizer=QL(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){const e=(t=dD(t))[t.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[e,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:e}}],this.built=!0}computeOutputShape(t){const e=(t=dD(t)).slice();return e[e.length-1]=this.units,e}call(t,e){return fT((()=>{this.invokeCallHook(t,e);const n=cD(t),r=JO(this.activation.getClassName());let i;return null!=r?i=PP(n,this.kernel.read(),r,this.bias?this.bias.read():null):(i=PP(n,this.kernel.read()),null!=this.bias&&(i=BP(i,this.bias.read())),null!=this.activation&&(i=this.activation.apply(i))),i}))}getConfig(){const t={units:this.units,activation:WL(this.activation),useBias:this.useBias,kernelInitializer:oD(this.kernelInitializer),biasInitializer:oD(this.biasInitializer),kernelRegularizer:ZL(this.kernelRegularizer),biasRegularizer:ZL(this.biasRegularizer),activityRegularizer:ZL(this.activityRegularizer),kernelConstraint:VD(this.kernelConstraint),biasConstraint:VD(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}WB.className="Dense",HT(WB);class XB extends TD{constructor(t){super(t=t||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=dD(t);for(const e of t.slice(1))if(null==e)throw new AO(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],xP(t,1)]}call(t,e){return fT((()=>{this.invokeCallHook(t,e);let n=cD(t);if("channelsFirst"===this.dataFormat&&n.rank>1){const t=[0];for(let e=2;e<n.rank;++e)t.push(e);t.push(1),n=FE(n,t)}return function(t){if(t.rank<=1)throw new AO(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],xP(t.shape,1)];return rI(t,e)}(n)}))}getConfig(){const t={};null!=this.dataFormat&&(t.dataFormat=this.dataFormat);const e=super.getConfig();return Object.assign(t,e),t}}XB.className="Flatten",HT(XB);class HB extends TD{constructor(t){super(t),this.supportsMasking=!0,this.activation=HL(t.activation)}call(t,e){return fT((()=>{this.invokeCallHook(t,e);const n=cD(t);return this.activation.apply(n)}))}getConfig(){const t={activation:WL(this.activation)},e=super.getConfig();return Object.assign(t,e),t}}HB.className="Activation",HT(HB);class YB extends TD{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,e){return fT((()=>function(t,e){return fT((()=>{if(2!==t.shape.length)throw new AO(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);return MP(IP(t,1),[1,e,1])}))}(t=cD(t),this.n)))}getConfig(){const t={n:this.n},e=super.getConfig();return Object.assign(t,e),t}}YB.className="RepeatVector",HT(YB);class jB extends TD{constructor(t){super(t),this.targetShape=t.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(t){return t<0||null==t}fixUnknownDimension(t,e){const n="Total size of new array must be unchanged.",r=e.slice();let i=1,s=null;for(let t=0;t<r.length;++t){const e=r[t];if(this.isUnknown(e)){if(null!==s)throw new AO("Can only specifiy one unknown dimension.");s=t}else i*=e}const a=xP(t);if(null!==s){if(0===i||a%i!=0)throw new AO(n);r[s]=a/i}else if(a!==i)throw new AO(n);return r}computeOutputShape(t){let e=!1;for(let n=0;n<t.length;++n)if(this.isUnknown(t[n])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,e){return fT((()=>{this.invokeCallHook(t,e);const n=cD(t),r=n.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return rI(n,i)}))}getConfig(){const t={targetShape:this.targetShape},e=super.getConfig();return Object.assign(t,e),t}}jB.className="Reshape",HT(jB);class qB extends TD{constructor(t){if(super(t),null==t.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const e=_P(1,t.dims.length+1);if(!vg(t.dims.slice().sort(),e))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new vD({ndim:this.dims.length+1})]}computeOutputShape(t){const e=(t=dD(t)).slice();return this.dims.forEach(((n,r)=>{e[r+1]=t[n]})),e}call(t,e){return FE(cD(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},e=super.getConfig();return Object.assign(t,e),t}}qB.className="Permute",HT(qB);class KB extends TD{constructor(t){super(null==t?{}:t),this.supportsMasking=!0,this.maskValue=null!=t?null==t.maskValue?0:t.maskValue:0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={maskValue:this.maskValue};return Object.assign(e,t),e}computeMask(t,e){const n=cD(t);return PS(Qk(n,this.maskValue),-1)}call(t,e){return fT((()=>{this.invokeCallHook(t,e);const n=cD(t),r=PS(Qk(n,this.maskValue),-1,!0);return AT(n,rT(r,n.dtype))}))}}KB.className="Masking",HT(KB);class ZB extends TD{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==t.batchInputShape&&null==t.inputShape){let e=null;null!=t.batchSize&&(e=t.batchSize),null==t.inputLength?this.batchInputShape=[e,null]:this.batchInputShape=[e].concat(BO(t.inputLength))}this.inputDim=t.inputDim,KO(this.inputDim,"inputDim"),this.outputDim=t.outputDim,KO(this.outputDim,"outputDim"),this.embeddingsInitializer=lD(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=QL(t.embeddingsRegularizer),this.activityRegularizer=QL(t.activityRegularizer),this.embeddingsConstraint=GD(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,e){return fT((()=>this.maskZero?(t=cD(t),Qk(t,OT(t))):null))}computeOutputShape(t){if(t=dD(t),null==this.inputLength)return[...t,this.outputDim];const e=BO(this.inputLength);if(e.length!==t.length-1)throw new AO(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let n=0;for(let r=0;r<e.length;++r){const i=e[r],s=t[r+1];if(null!=i&&null!=s&&i!==s)throw new AO(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);null==i&&(e[n]=s),n++}}return[t[0],...e,this.outputDim]}call(t,e){return fT((()=>{this.invokeCallHook(t,e);let n=cD(t);"int32"!==n.dtype&&(n=SP(n,"int32"));const r=DP(this.embeddings.read(),rI(n,[n.size]));return rI(r,dD(this.computeOutputShape(n.shape)))}))}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:oD(this.embeddingsInitializer),embeddingsRegularizer:ZL(this.embeddingsRegularizer),activityRegularizer:ZL(this.activityRegularizer),embeddingsConstraint:VD(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},e=super.getConfig();return Object.assign(t,e),t}}ZB.className="Embedding",HT(ZB);class JB extends TD{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new RO}computeElementwiseOpOutputShape(t,e){if(null==t||null==e)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(0===e.length)return t;const n=t.slice(0,t.length-e.length);for(let r=0;r<e.length;++r){const i=t[t.length-e.length+r],s=e[r];if(null==i||null==s||i<0||s<0)n.push(null);else if(1===i)n.push(s);else if(1===s)n.push(i);else{if(i!==s)throw new AO("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));n.push(i)}}return n}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[dD(t)]),(t=t).length<2)throw new AO(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let e=[];for(const n of t)null!=n&&null!==n[0]&&e.push(n[0]);if(e=HO(e),e.length>1)throw new AO(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let n=null==t[0]?null:t[0].slice(1);for(let e=1;e<t.length;++e){const r=null==t[e]?null:t[e].slice(1);n=this.computeElementwiseOpOutputShape(n,r)}const r=t.map((t=>t.length));-1===t.indexOf(null)&&1===HO(r).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,e){return fT((()=>{if(t=t,this.reshapeRequired){const e=[],n=t.map((t=>t.rank));if(-1===n.indexOf(null)){const r=wP(n);for(let n of t){const t=n.rank;for(let e=0;e<r-t;++e)n=IP(n,1);e.push(n)}return this.mergeFunction(e)}{let n=!1;for(const r of t){const t=r.rank;if(null==t){const t=r.shape,i=t[0],s=t.slice(1).concat([i]);let a=rI(r,[i].concat(xP(t.slice(1))));a=FE(a,[1,0]),a=rI(a,s),e.push(a),n=!0}else if(t>1){const i=_P(1,t).concat([0]);e.push(FE(r,i)),n=!0}else e.push(r)}let r=this.mergeFunction(e);const i=r.rank;if(n)if(null==i){const t=r.shape,e=t[t.length-1],n=[e].concat(t.slice(0,t.length-1));r=rI(FE(rI(r,[-1,e]),[1,0]),n)}else if(i>1){const t=[i-1].concat(_P(0,i-1));r=FE(r,t)}return r}}return this.mergeFunction(t)}))}computeOutputShape(t){let e;e=null==(t=t)[0]?null:t[0].slice(1);for(let n=1;n<t.length;++n){const r=null==t[n]?null:t[n].slice(1);e=this.computeElementwiseOpOutputShape(e,r)}let n=[];for(const e of t)null!=e&&null!==e[0]&&n.push(e[0]);return n=HO(n),e=1===n.length?n.concat(e):[null].concat(e),e}computeMask(t,e){return fT((()=>{if(null==e)return null;if(!Array.isArray(e))throw new AO("`mask` should be an Array");if(!Array.isArray(t))throw new AO("`inputs` should be an Array");if(e.length!==t.length)throw new AO(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${e.length})`);if(e.every((t=>null==t)))return null;let n=(e=e.map((t=>null==t?t:ck(t,0))))[0];for(let t=1;t<e.length-1;++t)n=Ok(n,e[t]);return n}))}}class QB extends JB{constructor(t){super(t)}mergeFunction(t){return fT((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=kT(e,t[n]);return e}))}}QB.className="Add",HT(QB);class t$ extends JB{constructor(t){super(t)}mergeFunction(t){return fT((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=AT(e,t[n]);return e}))}}t$.className="Multiply",HT(t$);class e$ extends JB{constructor(t){super(t)}mergeFunction(t){return fT((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=kT(e,t[n]);return AT(1/t.length,e)}))}}e$.className="Average",HT(e$);class n$ extends JB{constructor(t){super(t)}mergeFunction(t){return fT((()=>{let e=t[0];for(let n=1;n<t.length;++n)e=sE(e,t[n]);return e}))}}n$.className="Maximum",HT(n$);class r$ extends JB{constructor(t){super(t)}mergeFunction(t){return fT((()=>{let e=t[0];for(let n=1;n<t.length;++n)e=Yk(e,t[n]);return e}))}}r$.className="Minimum",HT(r$);class i$ extends JB{constructor(t){super(t),this.DEFAULT_AXIS=-1,null==t&&(t={}),this.axis=null==t.axis?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!Array.isArray(t)||!Array.isArray(t[0])||1===t.length)throw new AO("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let e=!0;for(const n of t)if(null!=n){e=!1;break}if(e)return;const n=[];for(let e=0;e<t.length;++e){const r=t[e].slice();r.splice(this.axis,1);let i=!1;for(const t of n)if(vg(t,r)){i=!0;break}i||n.push(r)}if(n.length>1)throw new AO("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return fT((()=>AP(t,this.axis)))}computeOutputShape(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new AO("A `Concatenate` layer should be called on a list of inputs.");const e=t,n=e[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(const t of e.slice(1)){if(null==n[r]||null==t[r]){n[r]=null;break}n[r]+=t[r]}return n}computeMask(t,e){if(null==e)return null;if(!Array.isArray(e))throw new AO("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new AO("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new AO(`Mismatch in the length of mask (${e.length}) and the legnth of inputs (${t.length})`);return fT((()=>{let n=!0;if(e.forEach((t=>{null==t||(n=!1)})),n)return null;const r=[];for(let n=0;n<t.length;++n)null==e[n]?r.push(rT(tC(t[n]),"bool")):e[n].rank<t[n].rank?r.push(ck(e[n],-1)):r.push(e[n]);const i=aI(r,this.axis);return OS(i,-1,!1)}))}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}function s$(t,e){for(;t<0;)t+=e;return t}i$.className="Concatenate",HT(i$);class a$ extends JB{constructor(t){super(t),this.axes=t.axes,this.normalize=null!=t.normalize&&t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){dg(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const e=t[0],n=t[1];if(e.length>3||n.length>3)throw new RO("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(e,n);if(e[r[0]]!==n[r[1]])throw new AO(`Dimension incompatibility: ${e[r[0]]} !== ${n[r[1]]}`)}mergeFunction(t){if(2!==t.length)throw new AO(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let e,n=t[0],r=t[1];return e=Array.isArray(this.axes)?this.axes.map(((e,n)=>s$(e,t[n].shape.length))):[s$(this.axes,n.shape.length),s$(this.axes,r.shape.length)],this.normalize&&(n=wF(n,e[0]),r=wF(r,e[1])),function(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new RO("batchDot is not implemented for tensors of 4D or higher rank yet");if(dg(t.shape.length>=2,(()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`)),dg(t.shape.length>=2,(()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`)),"number"==typeof n&&(n=[n,n]),"complex64"===t.dtype||"complex64"===e.dtype)throw new RO("batchDot is not implemented for complex64-type Tensors yet.");const r=t.shape.length,i=e.shape.length;null==n&&(n=[r-1,i-2]);const s=n;return fT((()=>{let n,a;if(r>i){n=r-i;const t=[];for(let e=0;e<n;++e)t.push(1);e=rI(e,e.shape.concat(t))}else if(i>r){n=i-r;const e=[];for(let t=0;t<n;++t)e.push(1);t=rI(t,t.shape.concat(e))}else n=0;if(2===t.shape.length&&2===e.shape.length)a=s[0]===s[1]?ak(AT(t,e),s[0]):ak(AT(FE(t,[1,0]),e),s[1]);else{const n=s[0]!==t.shape.length-1,r=s[1]===e.shape.length-1;a=RE(t,e,n,r)}if(n>0){let t;t=r>i?r+i-3:r-1;const e=[];for(let r=t;r<t+n;++r)e.push(r);a=JC(a,e)}return 1===a.shape.length&&(a=ck(a,1)),a}))}(n,r,e)}interpretAxes(t,e){let n;return n=Array.isArray(this.axes)?this.axes:[s$(this.axes,t.length),s$(this.axes,e.length)],n}computeOutputShape(t){dg(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const e=t[0].slice(),n=t[1].slice();if(e.length>3||n.length>3)throw new RO("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(e,n);e.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);const i=e.concat(n);return 1===i.length&&i.push(1),i}computeMask(t,e){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},e=super.getConfig();return Object.assign(t,e),t}}a$.className="Dot",HT(a$);class o$ extends TD{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={stddev:this.stddev};return Object.assign(e,t),e}call(t,e){return fT((()=>{this.invokeCallHook(t,e);const n=cD(t);return UP((()=>kT(OP(n.shape,0,this.stddev),n)),(()=>n),e.training||!1)}))}}o$.className="GaussianNoise",HT(o$);class l$ extends TD{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return fT((()=>{this.invokeCallHook(t,e);const n=cD(t);if(this.rate>0&&this.rate<1){return UP((()=>{const t=Math.sqrt(this.rate/(1-this.rate));return AT(n,OP(n.shape,1,t))}),(()=>n),e.training||!1)}return n}))}}l$.className="GaussianDropout",HT(l$);class h$ extends TD{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||cD(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return fT((()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(t),r=()=>{const e=cD(t),r=-1.7580993408473766;let i=vk(_C(n),this.rate);i=SP(i,"float32");const s=((1-this.rate)*(1+this.rate*r**2))**-.5,a=-s*r*this.rate,o=kT(AT(e,i),AT(kT(i,-1),r));return kT(AT(o,s),a)};return UP(r,(()=>cD(t)),e.training||!1)}return t}))}}function u$(t,e,n,r,i,s=.001){let a;if(2===t.rank)a=pI(t,e,n,r,i,s);else if(3===t.rank)a=fI(t,e,n,r,i,s);else{if(4!==t.rank)throw new RO(`batchNormalization is not implemented for array of rank ${t.rank} yet`);a=mI(t,e,n,r,i,s)}return a}function c$(t,e,n,r,i=.001){return vg(r.slice().sort(),_P(0,t.rank-1))?function(t,e,n,r,i=.001){return fT((()=>{const s=Kk(t,r),a=s.mean,o=s.variance;return[u$(t,a,o,n,e,i),a,o]}))}(t,e,n,r,i):function(t,e,n,r,i=.001){return fT((()=>{const s=Kk(t,r),a=s.mean,o=s.variance,l=[];for(const e of _P(0,t.rank))-1!==r.indexOf(e)?l.push(1):l.push(t.shape[e]);const h=rI(a,l),u=rI(o,l),c=null==e?null:rI(e,l),d=null==n?null:rI(n,l);return[u$(t,h,u,d,c,i),a,o]}))}(t,e,n,r,i)}h$.className="AlphaDropout",HT(h$);class d$ extends TD{constructor(t){null==t&&(t={}),super(t),this.supportsMasking=!0,this.axis=null==t.axis?-1:t.axis,this.momentum=null==t.momentum?.99:t.momentum,this.epsilon=null==t.epsilon?.001:t.epsilon,this.center=null==t.center||t.center,this.scale=null==t.scale||t.scale,this.betaInitializer=lD(t.betaInitializer||"zeros"),this.gammaInitializer=lD(t.gammaInitializer||"ones"),this.movingMeanInitializer=lD(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=lD(t.movingVarianceInitializer||"ones"),this.betaConstraint=GD(t.betaConstraint),this.gammaConstraint=GD(t.gammaConstraint),this.betaRegularizer=QL(t.betaRegularizer),this.gammaRegularizer=QL(t.gammaRegularizer)}build(t){t=dD(t);const e=this.axis>=0?this.axis:this.axis+t.length,n=t[e];if(null==n)throw new AO(`Axis ${e} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new vD({ndim:t.length,axes:{[e]:n}})];const r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,e){return fT((()=>{const n=null!=e.training&&e.training,r=cD(t),i=r.shape,s=i.length,a=_P(0,s),o=this.axis>=0?this.axis:this.axis+s;a.splice(o,1);const l=PO(1,s);l[o]=i[o];const h=a.slice();h.sort();const u=!vg(h,_P(0,s).slice(0,s-1));if(!n)return(()=>{if(u){const t=rI(this.movingMean.read(),l),e=rI(this.movingVariance.read(),l),n=this.center?rI(this.beta.read(),l):null,i=this.scale?rI(this.gamma.read(),l):null;return u$(r,t,e,n,i,this.epsilon)}return u$(r,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[c,d,p]=c$(r,this.gamma.read(),this.beta.read(),a,this.epsilon),f=(t,e,n)=>{fT((()=>{const r=1-n,i=t.read(),s=AT(QT(i,e),r);t.write(QT(i,s))}))};return(()=>{f(this.movingMean,d,this.momentum),f(this.movingVariance,p,this.momentum)})(),c}))}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:oD(this.betaInitializer),gammaInitializer:oD(this.gammaInitializer),movingMeanInitializer:oD(this.movingMeanInitializer),movingVarianceInitializer:oD(this.movingVarianceInitializer),betaRegularizer:ZL(this.betaRegularizer),gammaRegularizer:ZL(this.gammaRegularizer),betaConstraint:VD(this.betaConstraint),gammaConstraint:VD(this.gammaConstraint)},e=super.getConfig();return Object.assign(t,e),t}}d$.className="BatchNormalization",HT(d$);class p$ extends TD{constructor(t){if(null==t&&(t={}),super(t),this.axis=null==t.axis?-1:t.axis,"number"==typeof this.axis){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else{if(!Array.isArray(this.axis))throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}this.epsilon=null==t.epsilon?.001:t.epsilon,this.center=null==t.center||t.center,this.scale=null==t.scale||t.scale,this.betaInitializer=lD(t.betaInitializer||"zeros"),this.gammaInitializer=lD(t.gammaInitializer||"ones"),this.betaRegularizer=QL(t.betaRegularizer),this.gammaRegularizer=QL(t.gammaRegularizer),this.supportsMasking=!0}build(t){const e=(t=dD(t)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(let t=0;t<this.axis.length;++t)this.axis[t]<0&&(this.axis[t]+=e);for(const t of this.axis)if(t<0||t>=e)throw new Error(`Invalid axis: ${t}`);if(this.axis.length!==HO(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const n=this.axis.map((e=>t[e]));this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}call(t,e){const n=cD(t),r=n.shape,i=r.length;return fT((()=>{let{mean:t,variance:e}=Kk(n,this.axis,!0);const s=PO(1,i);for(const t of this.axis)s[t]=r[t];const a=t=>null!=t&&t.shape.length!==i?rI(t,s):t;let o=this.scale?a(this.gamma.read()):null,l=this.center?a(this.beta.read()):null;const h=[],u=[];for(let t=0;t<i;++t)-1!==this.axis.indexOf(t)?(h.push(r[t]),u.push(1)):(h.push(1),u.push(r[t]));return t=pk(t,h),e=pk(e,h),null!=o&&(o=pk(o,u)),null!=l&&(l=pk(l,u)),u$(n,t,e,l,o,this.epsilon)}))}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:oD(this.betaInitializer),gammaInitializer:oD(this.gammaInitializer),betaRegularizer:ZL(this.betaRegularizer),gammaRegularizer:ZL(this.gammaRegularizer)},e=super.getConfig();return Object.assign(t,e),t}}p$.className="LayerNormalization",HT(p$);class f$ extends TD{constructor(t){if(null==t&&(t={}),super(t),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,null==t.padding)this.padding=[[1,1],[1,1]];else if("number"==typeof t.padding)this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,2!==t.padding.length)throw new AO(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let e,n;if("number"==typeof t.padding[0])e=[t.padding[0],t.padding[0]],n=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,2!==t.padding[0].length)throw new AO(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(e=t.padding[0],2!==t.padding[1].length)throw new AO(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);n=t.padding[1]}this.padding=[e,n]}this.inputSpec=[new vD({ndim:4})]}computeOutputShape(t){let e,n;return t=dD(t),"channelsFirst"===this.dataFormat?(e=null!=t[2]&&t[2]>=0?t[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[3]&&t[3]>=0?t[3]+this.padding[1][0]+this.padding[1][1]:null,[t[0],t[1],e,n]):(e=null!=t[1]&&t[1]>=0?t[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[2]&&t[2]>=0?t[2]+this.padding[1][0]+this.padding[1][1]:null,[t[0],e,n,t[3]])}call(t,e){return fT((()=>function(t,e,n){return fT((()=>{if(4!==t.rank)throw new AO(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(null==e&&(e=[[1,1],[1,1]]),2!==e.length||2!==e[0].length||2!==e[1].length)throw new AO("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new AO(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return r="channelsFirst"===n?[[0,0],[0,0],e[0],e[1]]:[[0,0],e[0],e[1],[0,0]],nC(t,r)}))}(cD(t),this.padding,this.dataFormat)))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}function m$(t,e,n,r,i,s){return fT((()=>{let a;hP(i),cP(s),uP(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==s&&(s="max"),t=hB(t,i);const o="same"===r?"same":"valid";return a="max"===s?Uk(t,e,n,o):iI(t,e,n,o),"channelsFirst"===i&&(a=FE(a,[0,3,1,2])),a}))}function g$(t,e,n,r,i,s){return fT((()=>{let a;hP(i),cP(s),uP(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==s&&(s="max"),t=uB(t,i);const o="same"===r?"same":"valid";return a="max"===s?Vk(t,e,n,o):sI(t,e,n,o),"channelsFirst"===i&&(a=FE(a,[0,4,1,2,3])),a}))}f$.className="ZeroPadding2D",HT(f$);class y$ extends TD{constructor(t){if(null==t.poolSize&&(t.poolSize=2),super(t),"number"==typeof t.poolSize)this.poolSize=[t.poolSize];else{if(!Array.isArray(t.poolSize)||1!==t.poolSize.length||"number"!=typeof t.poolSize[0])throw new AO(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);this.poolSize=t.poolSize}if(KO(this.poolSize,"poolSize"),null==t.strides)this.strides=this.poolSize;else if("number"==typeof t.strides)this.strides=[t.strides];else{if(!Array.isArray(t.strides)||1!==t.strides.length||"number"!=typeof t.strides[0])throw new AO(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);this.strides=t.strides}KO(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,uP(this.padding),this.inputSpec=[new vD({ndim:3})]}computeOutputShape(t){const e=oB((t=dD(t))[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]}call(t,e){return fT((()=>{this.invokeCallHook(t,e),t=IP(cD(t),2);const n=this.poolingFunction(cD(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return JC(n,[2])}))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(t,e),t}}class v$ extends y${constructor(t){super(t)}poolingFunction(t,e,n,r,i){return hP(i),uP(r),m$(t,e,n,r,i,"max")}}v$.className="MaxPooling1D",HT(v$);class x$ extends y${constructor(t){super(t)}poolingFunction(t,e,n,r,i){return hP(i),uP(r),m$(t,e,n,r,i,"avg")}}x$.className="AveragePooling1D",HT(x$);class b$ extends TD{constructor(t){if(null==t.poolSize&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],null==t.strides)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(2!==t.strides.length)throw new AO(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];KO(this.poolSize,"poolSize"),KO(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,hP(this.dataFormat),uP(this.padding),this.inputSpec=[new vD({ndim:4})]}computeOutputShape(t){t=dD(t);let e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2];return e=oB(e,this.poolSize[0],this.padding,this.strides[0]),n=oB(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n]:[t[0],e,n,t[3]]}call(t,e){return fT((()=>(this.invokeCallHook(t,e),this.poolingFunction(cD(t),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class w$ extends b${constructor(t){super(t)}poolingFunction(t,e,n,r,i){return hP(i),uP(r),m$(t,e,n,r,i,"max")}}w$.className="MaxPooling2D",HT(w$);class _$ extends b${constructor(t){super(t)}poolingFunction(t,e,n,r,i){return hP(i),uP(r),m$(t,e,n,r,i,"avg")}}_$.className="AveragePooling2D",HT(_$);class T$ extends TD{constructor(t){if(null==t.poolSize&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],null==t.strides)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(3!==t.strides.length)throw new AO(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];KO(this.poolSize,"poolSize"),KO(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,hP(this.dataFormat),uP(this.padding),this.inputSpec=[new vD({ndim:5})]}computeOutputShape(t){t=dD(t);let e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],r="channelsFirst"===this.dataFormat?t[4]:t[3];return e=oB(e,this.poolSize[0],this.padding,this.strides[0]),n=oB(n,this.poolSize[1],this.padding,this.strides[1]),r=oB(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n,r]:[t[0],e,n,r,t[4]]}call(t,e){return fT((()=>(this.invokeCallHook(t,e),this.poolingFunction(cD(t),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class E$ extends T${constructor(t){super(t)}poolingFunction(t,e,n,r,i){return hP(i),uP(r),g$(t,e,n,r,i,"max")}}E$.className="MaxPooling3D",HT(E$);class S$ extends T${constructor(t){super(t)}poolingFunction(t,e,n,r,i){return hP(i),uP(r),g$(t,e,n,r,i,"avg")}}S$.className="AveragePooling3D",HT(S$);class I$ extends TD{constructor(t){super(t),this.inputSpec=[new vD({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,e){throw new RO}}class k$ extends I${constructor(t){super(t||{})}call(t,e){return fT((()=>{const e=cD(t);return Gk(e,1)}))}}k$.className="GlobalAveragePooling1D",HT(k$);class C$ extends I${constructor(t){super(t||{})}call(t,e){return fT((()=>{const e=cD(t);return ik(e,1)}))}}C$.className="GlobalMaxPooling1D",HT(C$);class N$ extends TD{constructor(t){super(t),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,hP(this.dataFormat),this.inputSpec=[new vD({ndim:4})]}computeOutputShape(t){return t=t,"channelsLast"===this.dataFormat?[t[0],t[3]]:[t[0],t[1]]}call(t,e){throw new RO}getConfig(){const t={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class A$ extends N${call(t,e){return fT((()=>{const e=cD(t);return"channelsLast"===this.dataFormat?Gk(e,[1,2]):Gk(e,[2,3])}))}}A$.className="GlobalAveragePooling2D",HT(A$);class R$ extends N${call(t,e){return fT((()=>{const e=cD(t);return"channelsLast"===this.dataFormat?ik(e,[1,2]):ik(e,[2,3])}))}}R$.className="GlobalMaxPooling2D",HT(R$);class M$ extends TD{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(t){null!=this.layer&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(t,e),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,e,n={}){const r=bF(e.layer,n);delete e.layer;const i={layer:r};return Object.assign(i,e),new t(i)}}class O$ extends M${constructor(t){super(t),this.supportsMasking=!0}build(t){if((t=dD(t)).length<3)throw new AO(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const e=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(e),this.layer.built=!0),super.build(t)}computeOutputShape(t){const e=[(t=dD(t))[0]].concat(t.slice(2)),n=this.layer.computeOutputShape(e),r=t[1];return[n[0],r].concat(n.slice(1))}call(t,e){return fT((()=>kB(((t,n)=>[cD(this.layer.call(t,e)),[]]),t=cD(t),[],!1,null,null,!1,!0)[1]))}}O$.className="TimeDistributed",HT(O$);class P$ extends M${constructor(t){super(t);const e=t.layer.getConfig(),n={};n.className=t.layer.getClassName(),n.config=e,this.forwardLayer=bF(n),e.goBackwards=!0!==e.goBackwards;const r={};var i;if(r.className=t.layer.getClassName(),r.config=e,this.backwardLayer=bF(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===t.mergeMode?"concat":t.mergeMode,i=this.mergeMode,jO(oP,"BidirectionalMergeMode",i),t.weights)throw new RO("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,null!=this.forwardLayer&&(this.forwardLayer.trainable=t),null!=this.backwardLayer&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const e=t.length,n=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,n)),this.backwardLayer.setWeights(t.slice(n))}computeOutputShape(t){let e,n,r,i=this.forwardLayer.computeOutputShape(t);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),i=i,this.returnState?(r=i.slice(1),e=i[0]):e=i[0],e=e,"concat"===this.mergeMode?(e[e.length-1]*=2,n=[e]):n=null==this.mergeMode?[e,e.slice()]:[e],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[e].concat(r).concat(r.slice()):LO(n)}apply(t,e){let n=null==e?null:e.initialState,r=null==e?null:e.constants;null==e&&(e={});const i=IB(t,n,r,this.numConstants);if(t=i.inputs,n=i.initialState,r=i.constants,Array.isArray(t)&&(n=t.slice(1),t=t[0]),(null==n||0===n.length)&&null==r)return super.apply(t,e);const s=[],a=[];if(null!=n){const t=n.length;if(t%2>0)throw new AO("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");e.initialState=n,s.push(...n);const r=n.map((t=>new vD({shape:t.shape})));this.forwardLayer.stateSpec=r.slice(0,t/2),this.backwardLayer.stateSpec=r.slice(t/2),a.push(...r)}if(null!=r)throw new RO("Support for constants in Bidirectional layers is not implemented yet.");const o=s[0]instanceof xD;for(const t of s)if(t instanceof xD!==o)throw new AO("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(o){const n=[t].concat(s),r=this.inputSpec.concat(a),i=this.inputSpec;this.inputSpec=r;const o=super.apply(n,e);return this.inputSpec=i,o}return super.apply(t,e)}call(t,e){return fT((()=>{const n=e.initialState;let r,i,s,a;if(null==n)r=this.forwardLayer.call(t,e),i=this.backwardLayer.call(t,e);else{const s=n.slice(0,n.length/2),a=n.slice(n.length/2);r=this.forwardLayer.call(t,Object.assign(e,{initialState:s})),i=this.backwardLayer.call(t,Object.assign(e,{initialState:a}))}return this.returnState&&(Array.isArray(r)&&(s=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=CC(i,1)),"concat"===this.mergeMode?a=AP([r,i]):"sum"===this.mergeMode?a=kT(r,i):"ave"===this.mergeMode?a=AT(.5,kT(r,i)):"mul"===this.mergeMode?a=AT(r,i):null==this.mergeMode&&(a=[r,i]),this.returnState?null==this.mergeMode?a.concat(s):[a].concat(s):a}))}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){pP(this.forwardLayer.name,(()=>{this.forwardLayer.build(t)})),pP(this.backwardLayer.name,(()=>{this.backwardLayer.build(t)})),this.built=!0}computeMask(t,e){let n;if(Array.isArray(e)&&(e=e[0]),n=this.returnSequences?null==this.mergeMode?[e,e]:e:null==this.mergeMode?[null,null]:null,this.returnState){const t=this.forwardLayer.states.map((t=>null));return Array.isArray(n)?n.concat(t).concat(t):[n].concat(t).concat(t)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(t),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},e=super.getConfig();return Object.assign(t,e),t}static fromConfig(t,e){const n=bF(e.layer);if(delete e.layer,null!=e.numConstants)throw new RO("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=e;return r.layer=n,new t(r)}}P$.className="Bidirectional",HT(P$);class D$ extends TD{constructor(t){super(t),this.scale=t.scale,t.offset?this.offset=t.offset:this.offset=0}getConfig(){const t={scale:this.scale,offset:this.offset},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return fT((()=>("float32"!==(t=cD(t)).dtype&&(t=SP(t,"float32")),kT(AT(t,this.scale),this.offset))))}}D$.className="Rescaling",HT(D$);const{resizeBilinear:F$,cropAndResize:L$}=DA;class B$ extends TD{constructor(t){super(t),this.height=t.height,this.width=t.width}centerCrop(t,e,n,r,i,s,a,o){return fT((()=>{let l,h=!1;const u=[e/s,n/a,(r+e)/s,(i+n)/a],c=[];3===t.rank?(h=!0,l=QC([t])):l=t;for(let t=0;t<l.shape[0];t++)c.push(u);const d=n_(c,[c.length,4]),p=EC(0,c.length,1,"int32"),f=L$(l,d,p,[r,i],"nearest");return SP(h?cD(pN(f)):f,o)}))}upsize(t,e,n,r){return fT((()=>SP(F$(t,[e,n]),r)))}call(t,e){return fT((()=>{const e=cD(t),n=e.dtype,r=e.shape,i=r[r.length-3],s=r[r.length-2];let a=0;i!==this.height&&(a=Math.floor((i-this.height)/2));let o=0;return s!==this.width&&(o=Math.floor((s-this.width)/2),0===o&&(o=1)),a>=0&&o>=0?this.centerCrop(e,a,o,this.height,this.width,i,s,n):this.upsize(t,this.height,this.width,n)}))}getConfig(){const t={height:this.height,width:this.width},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){const e=(t=dD(t)).length-3,n=t.length-2;return t[e]=this.height,t[n]=this.width,t}}B$.className="CenterCrop",HT(B$);class $$ extends TD{constructor(t){super(t),this.numTokens=t.numTokens,t.outputMode?this.outputMode=t.outputMode:this.outputMode="multiHot"}getConfig(){const t={numTokens:this.numTokens,outputMode:this.outputMode},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){return null==(t=dD(t))?[this.numTokens]:"oneHot"===this.outputMode&&1!==t[t.length-1]?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)}call(t,e){return fT((()=>{let n;if("int32"!==(t=cD(t)).dtype&&(t=SP(t,"int32")),void 0!==e.countWeights){if("count"!==this.outputMode)throw new AO(`countWeights is not used when outputMode !== count.\n              Received countWeights=${e.countWeights}`);n=cD(e.countWeights)}const r=ik(t),i=sk(t),s=yk(this.numTokens,r).bufferSync().get(0),a=vk(i,0).bufferSync().get(0);if(!s||!a)throw new AO(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return function(t,e,n,r){let i=cD(t);if("int32"!==i.dtype&&(i=SP(i,"int32")),"int"===e)return i;const s=i.shape;if(0===i.rank&&(i=ck(i,-1)),"oneHot"===e&&1!==i.shape[i.shape.length-1]&&(i=ck(i,-1)),i.rank>2)throw new AO(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${s} which would result in output rank ${i.rank}.`);const a=["multiHot","oneHot"].includes(e);let o;if(o=LI(i,void 0!==r&&"count"===e?r:[],n,a),"tfIdf"!==e)return o;if(r)return AT(o,r);throw new AO("When outputMode is 'tfIdf', weights must be provided.")}(t,this.outputMode,this.numTokens,n)}))}}$$.className="CategoryEncoding",HT($$);const U$=new Set(["bilinear","nearest"]);class V$ extends TD{constructor(t){if(super(t),this.height=t.height,this.width=t.width,t.interpolation){if(!U$.has(t.interpolation))throw new AO(`Invalid interpolation parameter: ${t.interpolation} is not implemented`);this.interpolation=t.interpolation}else this.interpolation="bilinear";this.cropToAspectRatio=Boolean(t.cropToAspectRatio)}computeOutputShape(t){const e=(t=dD(t))[2];return[this.height,this.width,e]}getConfig(){const t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},e=super.getConfig();return Object.assign(t,e),t}call(t,e){return fT((()=>{const e=[this.height,this.width];if("bilinear"===this.interpolation)return DA.resizeBilinear(t,e,!this.cropToAspectRatio);if("nearest"===this.interpolation)return DA.resizeNearestNeighbor(t,e,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...U$]} are supported`)}))}}V$.className="Resizing",HT(V$);class z${constructor(t){this.seed=t}next(){if(void 0!==this.seed)return this.seed++}}z$.className="RandomSeed";class G$ extends TD{constructor(t){super(t),this.randomGenerator=new z$(t.seed)}getConfig(){const t={seed:this.randomGenerator.seed},e=super.getConfig();return Object.assign(t,e),t}}G$.className="BaseRandomLayer";const W$=new Set(["bilinear","nearest"]);class X$ extends G${constructor(t){super(t);const{factor:e,interpolation:n="bilinear"}=t;if(this.factor=e,Array.isArray(this.factor)&&2===this.factor.length)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else{if(Array.isArray(this.factor)||!(this.factor>0))throw new AO(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);this.widthLower=-this.factor,this.widthUpper=this.factor}if(this.widthLower<-1||this.widthUpper<-1)throw new AO(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new AO(`factor cannot have upper bound less than lower bound.\n        Got upper bound: ${this.widthUpper}.\n        Got lower bound: ${this.widthLower}\n      `);if(n){if(!W$.has(n))throw new AO(`Invalid interpolation parameter: ${n} is not implemented`);this.interpolation=n}}getConfig(){const t={factor:this.factor,interpolation:this.interpolation},e=super.getConfig();return Object.assign(t,e),t}computeOutputShape(t){const e=(t=dD(t))[2];return[this.imgHeight,-1,e]}call(t,e){return fT((()=>{const e=cD(t);this.imgHeight=e.shape[e.shape.length-3];const n=e.shape[e.shape.length-2];this.widthFactor=_C([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let r=this.widthFactor.dataSync()[0]*n;r=Math.round(r);const i=[this.imgHeight,r];switch(this.interpolation){case"bilinear":return DA.resizeBilinear(t,i);case"nearest":return DA.resizeNearestNeighbor(t,i);default:throw new Error(`Interpolation is ${this.interpolation}\n          but only ${[...W$]} are supported`)}}))}}function H$(t){return new SD(t)}function Y$(t){return new rB(t)}function j$(t){return new tB(t)}function q$(t){return new eB(t)}function K$(t){return new nB(t)}function Z$(t){return new sB(t)}function J$(t){return new iB(t)}function Q$(t){return new _B(t)}function tU(t){return new gB(t)}function eU(t){return new vB(t)}function nU(t){return new yB(t)}function rU(t){return new xB(t)}function iU(t){return new wB(t)}function sU(t){return new TB(t)}function aU(t){return new EB(t)}function oU(t){return new SB(t)}function lU(t){return new HB(t)}function hU(t){return new WB(t)}function uU(t){return new zB(t)}function cU(t){return new GB(t)}function dU(t){return new XB(t)}function pU(t){return new YB(t)}function fU(t){return new jB(t)}function mU(t){return new qB(t)}function gU(t){return new ZB(t)}function yU(t){return new QB(t)}function vU(t){return new e$(t)}function xU(t){return new i$(t)}function bU(t){return new n$(t)}function wU(t){return new r$(t)}function _U(t){return new t$(t)}function TU(t){return new a$(t)}function EU(t){return new d$(t)}function SU(t){return new p$(t)}function IU(t){return new f$(t)}function kU(t){return new x$(t)}function CU(t){return kU(t)}function NU(t){return kU(t)}function AU(t){return new _$(t)}function RU(t){return AU(t)}function MU(t){return AU(t)}function OU(t){return new S$(t)}function PU(t){return OU(t)}function DU(t){return OU(t)}function FU(t){return new k$(t)}function LU(t){return new A$(t)}function BU(t){return new C$(t)}function $U(t){return new R$(t)}function UU(t){return new v$(t)}function VU(t){return new w$(t)}function zU(t){return new E$(t)}function GU(t){return new OB(t)}function WU(t){return new MB(t)}function XU(t){return new DB(t)}function HU(t){return new PB(t)}function YU(t){return new RB(t)}function jU(t){return new AB(t)}function qU(t){return new VB(t)}function KU(t){return new UB(t)}function ZU(t){return new CB(t)}function JU(t){return new FB(t)}function QU(t){return new P$(t)}function tV(t){return new O$(t)}X$.className="RandomWidth",HT(X$);const eV=BU,nV=$U,rV=UU,iV=VU;function sV(t){return new o$(t)}function aV(t){return new l$(t)}function oV(t){return new h$(t)}function lV(t){return new KB(t)}function hV(t){return new D$(t)}function uV(t){return new B$(t)}function cV(t){return new V$(t)}function dV(t){return new $$(t)}function pV(t){return new X$(t)}function fV(t,e){return OF(t,e)}function mV(t,e){return BF(t,e)}function gV(t,e){return $F(t,e)}function yV(t,e){return PF(t,e)}function vV(t,e){return UF(t,e)}function xV(t,e){return FF(t,e)}function bV(t,e){return LF(t,e)}function wV(t,e){return AF(t,e)}function _V(t,e){return TF(t,e)}function TV(t,e){return EF(t,e)}function EV(t,e){return EF(t,e)}function SV(t,e){return EF(t,e)}function IV(t,e){return _F(t,e)}function kV(t,e){return _F(t,e)}function CV(t,e){return _F(t,e)}function NV(t){return new qL(t)}function AV(t){return YL(e=t),new qL({l1:null!=e?e.l1:null,l2:0});var e}function RV(t){return YL(e=t),new qL({l2:null!=e?e.l2:null,l1:0});var e}class MV extends dF{constructor(){super(...arguments),this.model=null}setModel(t){if(!(t instanceof bL))throw new Error("model must be a LayersModel, not some other Container");this.model=t}}function OV(t,e){return t<e}function PV(t,e){return t>e}class DV extends MV{constructor(t){if(super(),null==t&&(t={}),t.restoreBestWeights)throw new RO("restoreBestWeights = True is not implemented in EarlyStopping yet.");this.monitor=t.monitor||"val_loss",this.minDelta=Math.abs(t.minDelta||0),this.patience=t.patience||0,this.verbose=t.verbose||0,this.mode=t.mode||"auto",this.baseline=t.baseline,-1===["auto","min","max"].indexOf(this.mode)&&(this.mode="auto"),"min"===this.mode?this.monitorFunc=OV:"max"===this.mode||-1!==this.monitor.indexOf("acc")?this.monitorFunc=PV:this.monitorFunc=OV,this.monitorFunc===OV&&(this.minDelta*=-1)}async onTrainBegin(t){this.wait=0,this.stoppedEpoch=0,null!=this.baseline?this.best=this.baseline:this.best=this.monitorFunc===OV?1/0:-1/0}async onEpochEnd(t,e){await hF(e);const n=this.getMonitorValue(e);null!=n&&(this.monitorFunc(n-this.minDelta,this.best)?(this.best=n,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)))}async onTrainEnd(t){this.stoppedEpoch>0&&this.verbose}getMonitorValue(t){null==t&&(t={});const e=t[this.monitor];return e}}const FV={earlyStopping:function(t){return new DV(t)}};var LV,BV;ey().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(t=>{})),function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"}(LV||(LV={})),function(t){let e;!function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"}(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))}(BV||(BV={}));const $V={};function UV(t,e){const n={tfOpName:t,category:"custom",inputs:[],attrs:[],customExecutor:e};$V[t]=n}function VV(t){return $V[t]}function zV(t){delete $V[t]}function GV(t,e,n,r,i){const s=e.inputParams[t];if(s&&void 0!==s.inputIndexStart){const t=s.inputIndexStart,a=0===s.inputIndexEnd?void 0:void 0===s.inputIndexEnd?t+1:s.inputIndexEnd,o=t<0?e.inputNames.length+t:t;if("tensor"===s.type)return WV(e.inputNames[o],n,r,i);if("tensors"===s.type){const s=e.inputs.slice(t,a),o=e.inputNames.slice(t,a).filter(((t,e)=>{var n;return"NoOp"!==(null===(n=s[e])||void 0===n?void 0:n.op)}));return o.map((t=>WV(t,n,r,i)))}const l=WV(e.inputNames[o],n,r,i),h=l.dataSync();return"number"===s.type?h[0]:Gg(l.shape,h)}const a=e.attrParams[t];return a&&a.value}function WV(t,e,n,r){const[i,s]=jV(t,n);if(null!=r){const t=r.getHashTableHandleByName(i);if(null!=t)return t}const a=n.currentContextIds.find((t=>!!e[YV(i,t)]));return void 0!==a?e[YV(i,a)][s]:void 0}function XV(t,e,n){return e[YV(t,n.currentContextId)]}function HV(t,e){const[n,r,i]=jV(t,e);return[YV(n,e&&e.currentContextId),r,i]}function YV(t,e){return e?`${t}-${e}`:t}function jV(t,e){if(""===t)return["",0,void 0];const n=null!=e&&null!=e.parseNodeNameCache;if(n){const n=e.parseNodeNameCache.get(t);if(null!=n)return n}const r=t.split(":");let i;if(1===r.length)i=[t,0,void 0];else{const t=r[0],e=3===r.length?r[1]:void 0;i=[t,Number(r[r.length-1]),e]}return n&&e.parseNodeNameCache.set(t,i),i}function qV(t,e,n){let r=GV("pad",t,e,n);if("explicit"===r){r=GV("explicitPaddings",t,e,n);const i=[[0,0],[0,0],[0,0],[0,0]];for(let t=0;t<4;t++)i[t][0]=r[2*t],i[t][1]=r[2*t+1];return i}return r}function KV(t){return t.kept?t:iT(t)}const ZV=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],JV=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],QV=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],tz=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],ez=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],nz=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],rz=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],iz=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],sz=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],az=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],oz=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],lz=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],hz=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],uz=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],cz=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],dz=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],pz=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],fz=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],mz=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}];class gz{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const t=[].concat(...[S,I,k,C,N,A,R,M,O,P,D,F,L,B,$,U,V,z,G].map((t=>t.json)));this.opMappers=t.reduce(((t,e)=>(t[e.tfOpName]=e,t)),{})}transformGraph(t,e={}){const n=t.node,r=[],i=[],s=[],a=n.reduce(((t,e)=>(t[e.name]=this.mapNode(e),e.op.startsWith("Placeholder")?r.push(t[e.name]):"Const"===e.op?i.push(t[e.name]):null!=e.input&&0!==e.input.length||s.push(t[e.name]),t)),{});let o=[];const l=[];let h={},u={};null!=e&&(h=this.mapSignatureEntries(e.inputs),u=this.mapSignatureEntries(e.outputs));const c=Object.keys(a);c.forEach((t=>{const e=a[t];e.inputNames.forEach(((t,n)=>{const[r,,i]=HV(t),s=a[r];if(null!=s.outputs){const t=s.outputs.indexOf(i);if(-1!==t){const i=`${r}:${t}`;e.inputNames[n]=i}}e.inputs.push(s),s.children.push(e)}))})),0===Object.keys(u).length?c.forEach((t=>{const e=a[t];0===e.children.length&&l.push(e)})):Object.keys(u).forEach((t=>{const[e]=HV(t),n=a[e];null!=n&&(n.signatureKey=u[t],l.push(n))})),Object.keys(h).length>0?Object.keys(h).forEach((t=>{const[e]=HV(t),n=a[e];n&&(n.signatureKey=h[t],o.push(n))})):o=r;let d={};null!=t.library&&null!=t.library.function&&(d=t.library.function.reduce(((t,e)=>(t[e.signature.name]=this.mapFunction(e),t)),{}));const p={nodes:a,inputs:o,outputs:l,weights:i,placeholders:r,signature:e,functions:d};return s.length>0&&(p.initNodes=s),p}mapSignatureEntries(t){return Object.keys(t||{}).reduce(((e,n)=>(e[t[n].name]=n,e)),{})}mapNode(t){const e=VV(t.op)||this.opMappers[t.op]||{};null==t.attr&&(t.attr={});const n={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map((t=>t.startsWith("^")?t.slice(1):t)),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr,outputs:e.outputs};return null!=e.inputs&&(n.inputParams=e.inputs.reduce(((t,e)=>(t[e.name]={type:e.type,inputIndexStart:e.start,inputIndexEnd:e.end},t)),{})),null!=e.attrs&&(n.attrParams=e.attrs.reduce(((e,n)=>{const r=n.type;let i;switch(n.type){case"string":i=vz(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=vz(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":i=Cz(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=Cz(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":i=bz(t.attr,n.tfName,n.defaultValue||0),void 0===i&&n.tfDeprecatedName&&(i=bz(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":i=kz(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=kz(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":i=xz(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=xz(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":i=Az(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=Az(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":i=Iz(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=Iz(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":i=Nz(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=Nz(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":i=Tz(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=Tz(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":i=Ez(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=Ez(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":i=_z(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=_z(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${t.op}`)}return e[n.name]={value:i,type:r},e}),{})),n}mapFunction(t){const e=t.nodeDef,n=[];let r={};null!=e&&(r=e.reduce(((t,e)=>(t[e.name]=this.mapNode(e),"Const"===e.op&&n.push(t[e.name]),t)),{}));const i=[],s=[];t.signature.inputArg.forEach((t=>{const[e]=HV(t.name),n={name:e,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:wz(t.type),type:"dtype"}},children:[]};n.signatureKey=t.name,i.push(n),r[e]=n}));Object.keys(r).forEach((t=>{const e=r[t];e.inputNames.forEach(((t,n)=>{const[i,,s]=HV(t),a=r[i];if(null!=a.outputs){const t=a.outputs.indexOf(s);if(-1!==t){const r=`${i}:${t}`;e.inputNames[n]=r}}e.inputs.push(a),a.children.push(e)}))}));const a=t.ret;t.signature.outputArg.forEach((t=>{const[e,n]=HV(a[t.name]),i=r[e];null!=i&&(i.defaultOutput=n,s.push(i))}));const o=this.mapArgsToSignature(t);return{nodes:r,inputs:i,outputs:s,weights:n,placeholders:[],signature:o}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce(((t,e)=>(t[e.name]=this.mapArgToTensorInfo(e),t)),{}),outputs:t.signature.outputArg.reduce(((e,n)=>(e[n.name]=this.mapArgToTensorInfo(n,t.ret),e)),{})}}mapArgToTensorInfo(t,e){let n=t.name;return null!=e&&(n=e[n]),{name:n,dtype:t.type}}}function yz(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):function(t){const e=ey().global;if(void 0!==e.atob)return e.atob(t);if("undefined"!=typeof Buffer)return new Buffer(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(t);return e?n:n.toLowerCase()}function vz(t,e,n,r=!1){const i=t[e];return null!=i?yz(i.s,r):n}function xz(t,e,n){const r=t[e];return r?r.b:n}function bz(t,e,n){const r=t[e]||{},i=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof i?i:parseInt(i,10)}function wz(t){switch("string"==typeof t&&(t=LV[t]),t){case LV.DT_FLOAT:case LV.DT_HALF:return"float32";case LV.DT_INT32:case LV.DT_INT64:case LV.DT_INT8:case LV.DT_UINT8:return"int32";case LV.DT_BOOL:return"bool";case LV.DT_DOUBLE:return"float32";case LV.DT_STRING:return"string";default:return null}}function _z(t,e,n){const r=t[e];return r&&r.func?r.func.name:n}function Tz(t,e,n){const r=t[e];return r&&r.type?wz(r.type):n}function Ez(t,e,n){const r=t[e];return r&&r.list&&r.list.type?r.list.type.map((t=>wz(t))):n}function Sz(t){if(!t.unknownRank)return null!=t.dim?t.dim.map((t=>"number"==typeof t.size?t.size:parseInt(t.size,10))):[]}function Iz(t,e,n){const r=t[e];return r&&r.shape?Sz(r.shape):n}function kz(t,e,n){const r=t[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((t=>"number"==typeof t?t:parseInt(t,10))):n}function Cz(t,e,n,r=!1){const i=t[e];return i&&i.list&&i.list.s?i.list.s.map((t=>yz(t,r))):n}function Nz(t,e,n){const r=t[e];return r&&r.list&&r.list.shape?r.list.shape.map((t=>Sz(t))):n}function Az(t,e,n){const r=t[e];return r&&r.list&&r.list.b?r.list.b:n}class Rz{constructor(t,e,n){this.node=t,this.tensorMap=e,this.context=n,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((t=>this.getInput(t))),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce(((t,e)=>(t[e]=this.getAttr(e),t)),{}))}getInput(t){return WV(t,this.tensorMap,this.context)}getAttr(t,e){const n=this.node.rawAttrs[t];if(null!=n.tensor)return WV(t,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return bz(this.node.rawAttrs,t,e);if(null!=n.s)return vz(this.node.rawAttrs,t,e);if(null!=n.b)return xz(this.node.rawAttrs,t,e);if(null!=n.shape)return Iz(this.node.rawAttrs,t,e);if(null!=n.type)return Tz(this.node.rawAttrs,t,e);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return kz(this.node.rawAttrs,t,e);if(null!=n.list.s)return Cz(this.node.rawAttrs,t,e);if(null!=n.list.shape)return Nz(this.node.rawAttrs,t,e);if(null!=n.list.b)return Az(this.node.rawAttrs,t,e);if(null!=n.list.type)return Ez(this.node.rawAttrs,t,e)}return e}}function Mz(t,e,n=""){if("number"!=typeof t&&"number"!=typeof e){dg(t.length===e.length,(()=>n+` Shapes ${t} and ${e} must match`));for(let r=0;r<t.length;r++){const i=t[r],s=e[r];dg(i<0||s<0||i===s,(()=>n+` Shapes ${t} and ${e} must match`))}}}function Oz(t){return"number"!=typeof t&&!t.some((t=>t<0))}function Pz(t,e,n){let r=Dz(t,n);const i=!Oz(r);if(i&&0===e.length)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(i&&e.forEach((t=>{r=Dz(t.shape,r)})),!Oz(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function Dz(t,e){if("number"==typeof t)return e;if("number"==typeof e)return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let r=0;r<t.length;++r){const i=t[r],s=e[r];if(i>=0&&s>=0&&i!==s)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[r]=i>=0?i:s}return n}class Fz{constructor(t,e,n,r,i,s,a){this.name=t,this.dtype=e,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=i,this.dynamicSize=s,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=VT(0),gT(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.tensor.id)||e.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);const e=this.tensors[t];if(e.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor}readMany(t){return t.map((t=>this.read(t)))}write(t,e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},\n          because the value dtype is ${e.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=e.shape),Mz(this.elementShape,e.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);n.tensor=e,gT(e),n.written=!0,this.tensors[t]=n}writeMany(t,e){if(t.length!==e.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${e.length}.`);t.forEach(((t,n)=>this.write(t,e[n])))}gather(t,e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${e}`);if(t)t=t.slice(0,this.size());else{t=[];for(let e=0;e<this.size();e++)t.push(e)}if(0===t.length)return n_([],[0].concat(this.elementShape));const n=this.readMany(t);return Mz(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),QC(n,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(0===this.size())return n_([],[0].concat(this.elementShape));const e=[];for(let t=0;t<this.size();t++)e.push(t);const n=this.readMany(e);return Mz(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),aI(n,0)}scatter(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const n=Math.max(...t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(t,pN(e,0))}split(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);let n=0;const r=t.map((t=>(n+=t,n)));if(n!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${e.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);const i=0===n?0:e.size/n,s=[];fT((()=>{e=rI(e,[1,n,i]);for(let n=0;n<t.length;++n){const a=[0,0===n?0:r[n-1],0],o=[1,t[n],i];s[n]=rI(lI(e,a,o),this.elementShape)}return s}));const a=[];for(let e=0;e<t.length;e++)a[e]=e;this.writeMany(a,s)}}class Lz{get id(){return this.idTensor.id}constructor(t,e,n,r=-1){this.tensors=t,this.elementShape=e,this.elementDtype=n,null!=t&&t.forEach((t=>{if(n!==t.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${t.dtype}`);Mz(e,t.shape,"TensorList shape mismatch: "),gT(t)})),this.idTensor=VT(0),this.maxNumElements=r,gT(this.idTensor)}copy(){return new Lz([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach((e=>{null!=t&&t.has(e.id)||e.dispose()})),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,e,n=-1){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);Mz(t,this.elementShape,"TensorList shape mismatch: ");const r=Pz(this.elementShape,this.tensors,t);return fT((()=>{const t=this.tensors.map((t=>rI(t,r)));return QC(t,0)}))}popBack(t,e){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=Pz(this.elementShape,this.tensors,t),r=this.tensors.pop();return r.kept=!1,Mz(r.shape,t,"TensorList shape mismatch: "),rI(r,n)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(Mz(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");gT(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);const e=new Lz([],this.elementShape,this.elementDtype,this.maxNumElements);e.tensors.length=t;for(let n=0;n<Math.min(this.tensors.length,t);++n)e.tensors[n]=this.tensors[n];return e}getItem(t,e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[t])throw new Error(`element at index ${t} is null.`);Mz(this.tensors[t].shape,e,"TensorList shape mismatch: ");const r=Pz(this.elementShape,this.tensors,e);return rI(this.tensors[t],r)}setItem(t,e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(t<0||-1!==this.maxNumElements&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);Mz(this.elementShape,e.shape,"TensorList shape mismatch: "),gT(e),null!=this.tensors[t]&&(this.tensors[t].kept=!1),this.tensors[t]=e}gather(t,e,n){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);Mz(this.elementShape,n,"TensorList shape mismatch: "),t=t.slice(0,this.size());const r=Pz(this.elementShape,this.tensors,n);return 0===t.length?n_([],[0].concat(r)):fT((()=>{const e=t.map((t=>rI(this.tensors[t],r)));return QC(e,0)}))}concat(t,e){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);Mz(this.elementShape,e,"TensorList shape mismatch: ");const n=Pz(this.elementShape,this.tensors,e);return 0===this.size()?n_([],[0].concat(n)):fT((()=>{const t=this.tensors.map((t=>rI(t,n)));return aI(t,0)}))}}const Bz=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const r=GV("thenBranch",t,e,n),i=GV("elseBranch",t,e,n),s=GV("cond",t,e,n),a=GV("args",t,e,n);return(await s.data())[0]?n.functionMap[r].executeFunctionAsync(a,n.tensorArrayMap,n.tensorListMap):n.functionMap[i].executeFunctionAsync(a,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=GV("body",t,e,n),i=GV("cond",t,e,n),s=GV("args",t,e,n),a=await n.functionMap[i].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap),o=s.map((t=>t.id));let l=await a[0].data();a.forEach((t=>{t.kept||-1!==o.indexOf(t.id)||t.dispose()}));let h=s;for(;l[0];){const t=h;h=await n.functionMap[r].executeFunctionAsync(h,n.tensorArrayMap,n.tensorListMap);const e=h.map((t=>t.id));t.forEach((t=>{t.kept||-1!==o.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}));const s=await n.functionMap[i].executeFunctionAsync(h,n.tensorArrayMap,n.tensorListMap);l=await s[0].data(),s.forEach((t=>{t.kept||-1!==o.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()}))}return h}case"LoopCond":return[KV(GV("pred",t,e,n))];case"Switch":{const r=GV("pred",t,e,n);let i=GV("data",t,e,n);return i.kept||(i=KV(i)),(await r.data())[0]?[void 0,i]:[i,void 0]}case"Merge":{const r=t.inputNames.find((t=>void 0!==WV(t,e,n)));if(r){return[KV(WV(r,e,n))]}return}case"Enter":{const r=GV("frameName",t,e,n),i=GV("tensor",t,e,n);return n.enterFrame(r),[KV(i)]}case"Exit":{const r=GV("tensor",t,e,n);return n.exitFrame(),[KV(r)]}case"NextIteration":{const r=GV("tensor",t,e,n);return n.nextIteration(),[KV(r)]}case"TensorArrayV3":{const r=GV("size",t,e,n),i=GV("dtype",t,e,n),s=GV("elementShape",t,e,n),a=GV("dynamicSize",t,e,n),o=GV("clearAfterRead",t,e,n),l=GV("identicalElementShapes",t,e,n),h=GV("name",t,e,n),u=new Fz(h,i,r,s,l,a,o);return n.addTensorArray(u),[u.idTensor,VT(1)]}case"TensorArrayWriteV3":{const r=GV("tensorArrayId",t,e,n),i=GV("index",t,e,n),s=GV("tensor",t,e,n),a=n.getTensorArray(r.id);return a.write(i,s),[a.idTensor]}case"TensorArrayReadV3":{const r=GV("tensorArrayId",t,e,n),i=GV("index",t,e,n);return[n.getTensorArray(r.id).read(i)]}case"TensorArrayGatherV3":{const r=GV("tensorArrayId",t,e,n),i=GV("indices",t,e,n),s=GV("dtype",t,e,n);return[n.getTensorArray(r.id).gather(i,s)]}case"TensorArrayScatterV3":{const r=GV("tensorArrayId",t,e,n),i=GV("indices",t,e,n),s=GV("tensor",t,e,n),a=n.getTensorArray(r.id);return a.scatter(i,s),[a.idTensor]}case"TensorArrayConcatV3":{const r=GV("tensorArrayId",t,e,n),i=n.getTensorArray(r.id),s=GV("dtype",t,e,n);return[i.concat(s)]}case"TensorArraySplitV3":{const r=GV("tensorArrayId",t,e,n),i=GV("tensor",t,e,n),s=GV("lengths",t,e,n),a=n.getTensorArray(r.id);return a.split(s,i),[a.idTensor]}case"TensorArraySizeV3":{const r=GV("tensorArrayId",t,e,n);return[VT(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=GV("tensorArrayId",t,e,n),i=n.getTensorArray(r.id);return i.clearAndClose(),[i.idTensor]}case"TensorListSetItem":{const r=GV("tensorListId",t,e,n),i=GV("index",t,e,n),s=GV("tensor",t,e,n),a=n.getTensorList(r.id);return a.setItem(i,s),[a.idTensor]}case"TensorListGetItem":{const r=GV("tensorListId",t,e,n),i=GV("index",t,e,n),s=GV("elementShape",t,e,n),a=GV("elementDType",t,e,n);return[n.getTensorList(r.id).getItem(i,s,a)]}case"TensorListScatterV2":case"TensorListScatter":{const r=GV("indices",t,e,n),i=function(t,e,n,r){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const i=Math.max(...e);if(null!=r&&-1!==r&&i>=r)throw new Error(`Max index must be < array size (${i}  vs. ${r})`);const s=new Lz([],n,t.dtype,r),a=pN(t,0);return e.forEach(((t,e)=>{s.setItem(t,a[e])})),s}(GV("tensor",t,e,n),r,GV("elementShape",t,e,n),GV("numElements",t,e,n));return n.addTensorList(i),[i.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const r=GV("elementShape",t,e,n),i=GV("elementDType",t,e,n);let s;s="TensorListReserve"===t.op?"numElements":"maxNumElements";const a=GV(s,t,e,n),o=function(t,e,n,r){return new Lz([],t,e,r)}(r,i,0,"TensorListReserve"===t.op?-1:a);return n.addTensorList(o),[o.idTensor]}case"TensorListGather":{const r=GV("tensorListId",t,e,n),i=GV("indices",t,e,n),s=GV("elementShape",t,e,n),a=GV("elementDType",t,e,n);return[n.getTensorList(r.id).gather(i,a,s)]}case"TensorListStack":{const r=GV("tensorListId",t,e,n),i=GV("elementShape",t,e,n),s=GV("elementDType",t,e,n),a=GV("numElements",t,e,n);return[n.getTensorList(r.id).stack(i,s,a)]}case"TensorListFromTensor":{const r=function(t,e,n){const r=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);Mz(t.shape.slice(1),e,"TensorList shape mismatch: ");const i=pN(t);return new Lz(i,e,r)}(GV("tensor",t,e,n),GV("elementShape",t,e,n),GV("elementDType",t,e,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const r=GV("tensorListId",t,e,n),i=n.getTensorList(r.id),s=GV("dtype",t,e,n),a=GV("elementShape",t,e,n);return[i.concat(s,a)]}case"TensorListPushBack":{const r=GV("tensorListId",t,e,n),i=GV("tensor",t,e,n),s=n.getTensorList(r.id);return s.pushBack(i),[s.idTensor]}case"TensorListPopBack":{const r=GV("tensorListId",t,e,n),i=GV("elementShape",t,e,n),s=GV("elementDType",t,e,n);return[n.getTensorList(r.id).popBack(i,s)]}case"TensorListSplit":{const r=GV("tensor",t,e,n),i=GV("elementShape",t,e,n),s=function(t,e,n){let r=0;const i=e.map((t=>(r+=t,r)));if(r!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${t.shape}`);const s=Dz(t.shape.slice(1),n),a=0===r?0:t.size/r,o=fT((()=>{const n=[];t=rI(t,[1,r,a]);for(let r=0;r<e.length;++r){const o=[0,0===r?0:i[r-1],0],l=[1,e[r],a];n[r]=rI(lI(t,o,l),s)}return t.dispose(),n})),l=new Lz([],n,t.dtype,e.length);for(let t=0;t<o.length;t++)l.setItem(t,o[t]);return l}(r,GV("lengths",t,e,n),i);return n.addTensorList(s),[s.idTensor]}case"TensorListLength":{const r=GV("tensorListId",t,e,n);return[VT(n.getTensorList(r.id).size(),"int32")]}case"TensorListResize":{const r=GV("tensorListId",t,e,n),i=GV("size",t,e,n),s=n.getTensorList(r.id).resize(i);return n.addTensorList(s),[s.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};function $z(t,e,n){const[r,i]=GV("fusedOps",t,e,n),s="biasadd"===r,a=!s,o="prelu"===i,l="fusedbatchnorm"===r,h=GV("numArgs",t,e,n);if(s){if(o&&2!==h)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&s&&1!==h)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const u=GV("strides",t,e,n),c=qV(t,e,n),d=GV("dataFormat",t,e,n).toUpperCase(),p=GV("dilations",t,e,n);let[f,m]=GV("args",t,e,n);a&&(m=f,f=void 0);return{stride:u,pad:c,dataFormat:d,dilations:p,biasArg:f,preluArg:m,activationFunc:i,leakyreluAlpha:GV("leakyreluAlpha",t,e,n)}}function Uz(t,e,n){return{boxes:GV("boxes",t,e,n),scores:GV("scores",t,e,n),maxOutputSize:GV("maxOutputSize",t,e,n),iouThreshold:GV("iouThreshold",t,e,n),scoreThreshold:GV("scoreThreshold",t,e,n),softNmsSigma:GV("softNmsSigma",t,e,n)}}class Vz{get id(){return this.handle.id}constructor(t,e){this.keyDType=t,this.valueDType=e,this.handle=VT(0),this.tensorMap=new Map,gT(this.handle)}clearAndClose(){this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return VT(this.size(),"int32")}async import(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return this.tensorMap.forEach((t=>t.dispose())),this.tensorMap.clear(),fT((()=>{const t=pN(e),r=n.length,i=t.length;dg(r===i,(()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${i} elements.`));for(let e=0;e<r;e++){const r=n[e],i=t[e];gT(i),this.tensorMap.set(r,i)}return this.handle}))}async find(t,e){this.checkKeyAndValueTensor(t,e);const n=await t.data();return fT((()=>{const t=[];for(let r=0;r<n.length;r++){const i=n[r],s=this.findWithDefault(i,e);t.push(s)}return QC(t)}))}findWithDefault(t,e){const n=this.tensorMap.get(t);return null!=n?n:e}checkKeyAndValueTensor(t,e){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(e.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${e.dtype}`)}}function zz(t,e,n,r,i=fT){const s=((t,e,n)=>{switch(t.category){case"arithmetic":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(GV("a",t,e,n),GV("b",t,e,n))];case"AddN":return[r.addN(GV("tensors",t,e,n))];case"FloorMod":case"Mod":return[r.mod(GV("a",t,e,n),GV("b",t,e,n))];case"Mul":return[r.mul(GV("a",t,e,n),GV("b",t,e,n))];case"RealDiv":case"Div":return[r.div(GV("a",t,e,n),GV("b",t,e,n))];case"DivNoNan":return[r.divNoNan(GV("a",t,e,n),GV("b",t,e,n))];case"FloorDiv":return[r.floorDiv(GV("a",t,e,n),GV("b",t,e,n))];case"Sub":return[r.sub(GV("a",t,e,n),GV("b",t,e,n))];case"Minimum":return[r.minimum(GV("a",t,e,n),GV("b",t,e,n))];case"Maximum":return[r.maximum(GV("a",t,e,n),GV("b",t,e,n))];case"Pow":return[r.pow(GV("a",t,e,n),GV("b",t,e,n))];case"SquaredDifference":return[r.squaredDifference(GV("a",t,e,n),GV("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"basic_math":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"Abs":case"ComplexAbs":return[r.abs(GV("x",t,e,n))];case"Acos":return[r.acos(GV("x",t,e,n))];case"Acosh":return[r.acosh(GV("x",t,e,n))];case"Asin":return[r.asin(GV("x",t,e,n))];case"Asinh":return[r.asinh(GV("x",t,e,n))];case"Atan":return[r.atan(GV("x",t,e,n))];case"Atan2":return[r.atan2(GV("x",t,e,n),GV("y",t,e,n))];case"Atanh":return[r.atanh(GV("x",t,e,n))];case"Ceil":return[r.ceil(GV("x",t,e,n))];case"Complex":return[r.complex(GV("real",t,e,n),GV("imag",t,e,n))];case"Cos":return[r.cos(GV("x",t,e,n))];case"Cosh":return[r.cosh(GV("x",t,e,n))];case"Elu":return[r.elu(GV("x",t,e,n))];case"Erf":return[r.erf(GV("x",t,e,n))];case"Exp":return[r.exp(GV("x",t,e,n))];case"Expm1":return[r.expm1(GV("x",t,e,n))];case"Floor":return[r.floor(GV("x",t,e,n))];case"Log":return[r.log(GV("x",t,e,n))];case"Log1p":return[r.log1p(GV("x",t,e,n))];case"Imag":return[r.imag(GV("x",t,e,n))];case"Neg":return[r.neg(GV("x",t,e,n))];case"Reciprocal":return[r.reciprocal(GV("x",t,e,n))];case"Real":return[r.real(GV("x",t,e,n))];case"Relu":return[r.relu(GV("x",t,e,n))];case"Round":return[r.round(GV("x",t,e,n))];case"Selu":return[r.selu(GV("x",t,e,n))];case"Sigmoid":return[r.sigmoid(GV("x",t,e,n))];case"Sin":return[r.sin(GV("x",t,e,n))];case"Sign":return[r.sign(GV("x",t,e,n))];case"Sinh":return[r.sinh(GV("x",t,e,n))];case"Softplus":return[r.softplus(GV("x",t,e,n))];case"Sqrt":return[r.sqrt(GV("x",t,e,n))];case"Square":return[r.square(GV("x",t,e,n))];case"Tanh":return[r.tanh(GV("x",t,e,n))];case"Tan":return[r.tan(GV("x",t,e,n))];case"ClipByValue":return[r.clipByValue(GV("x",t,e,n),GV("clipValueMin",t,e,n),GV("clipValueMax",t,e,n))];case"Relu6":return[r.relu6(GV("x",t,e,n))];case"Rsqrt":return[r.rsqrt(WV(t.inputNames[0],e,n))];case"LeakyRelu":return[r.leakyRelu(GV("x",t,e,n),GV("alpha",t,e,n))];case"Prelu":return[r.prelu(GV("x",t,e,n),GV("alpha",t,e,n))];case"IsNan":return[r.isNaN(WV(t.inputNames[0],e,n))];case"IsInf":return[r.isInf(WV(t.inputNames[0],e,n))];case"IsFinite":return[r.isFinite(WV(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"control":return Bz(t,e,n);case"convolution":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"Conv1D":{const i=GV("stride",t,e,n),s=GV("pad",t,e,n),a=GV("dataFormat",t,e,n).toUpperCase(),o=GV("dilation",t,e,n);return[r.conv1d(GV("x",t,e,n),GV("filter",t,e,n),i,s,a,o)]}case"Conv2D":{const i=GV("strides",t,e,n),s=qV(t,e,n),a=GV("dataFormat",t,e,n).toUpperCase(),o=GV("dilations",t,e,n);return[r.conv2d(GV("x",t,e,n),GV("filter",t,e,n),[i[1],i[2]],s,a,[o[1],o[2]])]}case"_FusedConv2D":{const{stride:i,pad:s,dataFormat:a,dilations:o,biasArg:l,preluArg:h,activationFunc:u,leakyreluAlpha:c}=$z(t,e,n);return[r.fused.conv2d({x:GV("x",t,e,n),filter:GV("filter",t,e,n),strides:[i[1],i[2]],pad:s,dataFormat:a,dilations:[o[1],o[2]],bias:l,activation:u,preluActivationWeights:h,leakyreluAlpha:c})]}case"FusedDepthwiseConv2dNative":{const{stride:i,pad:s,dataFormat:a,dilations:o,biasArg:l,preluArg:h,activationFunc:u,leakyreluAlpha:c}=$z(t,e,n);return[r.fused.depthwiseConv2d({x:GV("x",t,e,n),filter:GV("filter",t,e,n),strides:[i[1],i[2]],pad:s,dataFormat:a,dilations:[o[1],o[2]],bias:l,activation:u,preluActivationWeights:h,leakyreluAlpha:c})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const i=GV("outputShape",t,e,n),s=GV("strides",t,e,n),a=qV(t,e,n);return[r.conv2dTranspose(GV("x",t,e,n),GV("filter",t,e,n),i,[s[1],s[2]],a)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const i=GV("strides",t,e,n),s=qV(t,e,n),a=GV("dilations",t,e,n),o=GV("dataFormat",t,e,n).toUpperCase();return[r.depthwiseConv2d(GV("input",t,e,n),GV("filter",t,e,n),[i[1],i[2]],s,o,[a[1],a[2]])]}case"Conv3D":{const i=GV("strides",t,e,n),s=GV("pad",t,e,n),a=GV("dataFormat",t,e,n).toUpperCase(),o=GV("dilations",t,e,n);return[r.conv3d(GV("x",t,e,n),GV("filter",t,e,n),[i[1],i[2],i[3]],s,a,[o[1],o[2],o[3]])]}case"AvgPool":{const i=GV("strides",t,e,n),s=GV("pad",t,e,n),a=GV("kernelSize",t,e,n);return[r.avgPool(GV("x",t,e,n),[a[1],a[2]],[i[1],i[2]],s)]}case"MaxPool":{const i=GV("strides",t,e,n),s=GV("pad",t,e,n),a=GV("kernelSize",t,e,n);return[r.maxPool(GV("x",t,e,n),[a[1],a[2]],[i[1],i[2]],s)]}case"MaxPoolWithArgmax":{const i=GV("strides",t,e,n),s=GV("pad",t,e,n),a=GV("kernelSize",t,e,n),o=GV("includeBatchInIndex",t,e,n),{result:l,indexes:h}=r.maxPoolWithArgmax(GV("x",t,e,n),[a[1],a[2]],[i[1],i[2]],s,o);return[l,h]}case"AvgPool3D":{const i=GV("strides",t,e,n),s=GV("pad",t,e,n),a=GV("kernelSize",t,e,n);return[r.avgPool3d(GV("x",t,e,n),[a[1],a[2],a[3]],[i[1],i[2],i[3]],s)]}case"MaxPool3D":{const i=GV("strides",t,e,n),s=GV("pad",t,e,n),a=GV("kernelSize",t,e,n);return[r.maxPool3d(GV("x",t,e,n),[a[1],a[2],a[3]],[i[1],i[2],i[3]],s)]}case"Dilation2D":{const i=GV("strides",t,e,n),s=GV("pad",t,e,n),a=GV("dilations",t,e,n),o=i[1],l=i[2],h=a[1],u=a[2];return[r.dilation2d(GV("x",t,e,n),GV("filter",t,e,n),[o,l],s,[h,u],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"creation":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"Fill":{const i=GV("shape",t,e,n),s=GV("dtype",t,e,n),a=GV("value",t,e,n);return[r.fill(i,a,s)]}case"LinSpace":{const i=GV("start",t,e,n),s=GV("stop",t,e,n),a=GV("num",t,e,n);return[r.linspace(i,s,a)]}case"Multinomial":{const i=GV("logits",t,e,n),s=GV("numSamples",t,e,n),a=GV("seed",t,e,n);return[r.multinomial(i,s,a)]}case"OneHot":{const i=GV("indices",t,e,n),s=GV("depth",t,e,n),a=GV("onValue",t,e,n),o=GV("offValue",t,e,n),l=GV("dtype",t,e,n);return[r.oneHot(i,s,a,o,l)]}case"Ones":return[r.ones(GV("shape",t,e,n),GV("dtype",t,e,n))];case"OnesLike":return[r.onesLike(GV("x",t,e,n))];case"RandomStandardNormal":return[r.randomStandardNormal(GV("shape",t,e,n),GV("dtype",t,e,n),GV("seed",t,e,n))];case"RandomUniform":return[r.randomUniform(GV("shape",t,e,n),GV("minval",t,e,n),GV("maxval",t,e,n),GV("dtype",t,e,n))];case"RandomUniformInt":return[r.randomUniformInt(GV("shape",t,e,n),GV("minval",t,e,n),GV("maxval",t,e,n),GV("seed",t,e,n))];case"Range":{const i=GV("start",t,e,n),s=GV("stop",t,e,n),a=GV("step",t,e,n);return[r.range(i,s,a,GV("dtype",t,e,n))]}case"TruncatedNormal":{const i=GV("shape",t,e,n),s=GV("mean",t,e,n),a=GV("stdDev",t,e,n),o=GV("seed",t,e,n);return[r.truncatedNormal(i,s,a,GV("dtype",t,e,n),o)]}case"Zeros":return[r.zeros(GV("shape",t,e,n),GV("dtype",t,e,n))];case"ZerosLike":return[r.zerosLike(GV("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"dynamic":return(async(t,e,n,r,i=W)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:s,maxOutputSize:a,iouThreshold:o,scoreThreshold:l,softNmsSigma:h}=Uz(t,e,n),u=await i.image.nonMaxSuppressionWithScoreAsync(r,s,a,o,l,h);return[u.selectedIndices,u.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:s,maxOutputSize:a,iouThreshold:o,scoreThreshold:l}=Uz(t,e,n),h=GV("padToMaxOutputSize",t,e,n),u=await i.image.nonMaxSuppressionPaddedAsync(r,s,a,o,l,h);return[u.selectedIndices,u.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:s,maxOutputSize:a,iouThreshold:o,scoreThreshold:l}=Uz(t,e,n);return[await i.image.nonMaxSuppressionAsync(r,s,a,o,l)]}case"Where":{const r=i.cast(GV("condition",t,e,n),"bool"),s=[await i.whereAsync(r)];return r.dispose(),s}case"ListDiff":return i.setdiff1dAsync(GV("x",t,e,n),GV("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n);case"evaluation":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"LowerBound":{const i=GV("sortedSequence",t,e,n),s=GV("values",t,e,n);return[r.lowerBound(i,s)]}case"TopKV2":{const i=GV("x",t,e,n),s=GV("k",t,e,n),a=GV("sorted",t,e,n),o=r.topk(i,s,a);return[o.values,o.indices]}case"UpperBound":{const i=GV("sortedSequence",t,e,n),s=GV("values",t,e,n);return[r.upperBound(i,s)]}case"Unique":{const i=GV("x",t,e,n),s=r.unique(i);return[s.values,s.indices]}case"UniqueV2":{const i=GV("x",t,e,n),s=GV("axis",t,e,n),a=r.unique(i,s);return[a.values,a.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"image":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"ResizeBilinear":{const i=GV("images",t,e,n),s=GV("size",t,e,n),a=GV("alignCorners",t,e,n),o=GV("halfPixelCenters",t,e,n);return[r.image.resizeBilinear(i,[s[0],s[1]],a,o)]}case"ResizeNearestNeighbor":{const i=GV("images",t,e,n),s=GV("size",t,e,n),a=GV("alignCorners",t,e,n),o=GV("halfPixelCenters",t,e,n);return[r.image.resizeNearestNeighbor(i,[s[0],s[1]],a,o)]}case"CropAndResize":{const i=GV("image",t,e,n),s=GV("boxes",t,e,n),a=GV("boxInd",t,e,n),o=GV("cropSize",t,e,n),l=GV("method",t,e,n),h=GV("extrapolationValue",t,e,n);return[r.image.cropAndResize(i,s,a,o,l,h)]}case"ImageProjectiveTransformV3":{const i=GV("images",t,e,n),s=GV("transforms",t,e,n),a=GV("outputShape",t,e,n),o=GV("fillValue",t,e,n),l=GV("interpolation",t,e,n),h=GV("fillMode",t,e,n);return[r.image.transform(i,s,l.toLowerCase(),h.toLowerCase(),o,a)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"graph":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const i=GV("default",t,e,n);return[WV(t.name,e,n)||i];case"Placeholder":return[WV(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[KV(GV("x",t,e,n))];case"IdentityN":return GV("x",t,e,n).map((t=>KV(t)));case"Shape":return[r.tensor1d(GV("x",t,e,n).shape,"int32")];case"ShapeN":return GV("x",t,e,n).map((t=>r.tensor1d(t.shape)));case"Size":return[r.scalar(GV("x",t,e,n).size,"int32")];case"Rank":return[r.scalar(GV("x",t,e,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":const s=GV("x",t,e,n),a=GV("data",t,e,n);GV("message",t,e,n),GV("summarize",t,e,n);for(let t=0;t<a.length;t++);return[s];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"logical":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"Equal":return[r.equal(GV("a",t,e,n),GV("b",t,e,n))];case"NotEqual":return[r.notEqual(GV("a",t,e,n),GV("b",t,e,n))];case"Greater":return[r.greater(GV("a",t,e,n),GV("b",t,e,n))];case"GreaterEqual":return[r.greaterEqual(GV("a",t,e,n),GV("b",t,e,n))];case"Less":return[r.less(GV("a",t,e,n),GV("b",t,e,n))];case"LessEqual":return[r.lessEqual(GV("a",t,e,n),GV("b",t,e,n))];case"LogicalAnd":return[r.logicalAnd(GV("a",t,e,n),GV("b",t,e,n))];case"LogicalNot":return[r.logicalNot(GV("a",t,e,n))];case"LogicalOr":return[r.logicalOr(GV("a",t,e,n),GV("b",t,e,n))];case"Select":case"SelectV2":return[r.where(GV("condition",t,e,n),GV("a",t,e,n),GV("b",t,e,n))];case"BitwiseAnd":return[r.bitwiseAnd(GV("a",t,e,n),GV("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"matrices":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(GV("a",t,e,n),GV("b",t,e,n),GV("transposeA",t,e,n),GV("transposeB",t,e,n))];case"Einsum":return[r.einsum(GV("equation",t,e,n),...GV("tensors",t,e,n))];case"Transpose":return[r.transpose(GV("x",t,e,n),GV("perm",t,e,n))];case"_FusedMatMul":const[i,s]=GV("fusedOps",t,e,n),a="biasadd"===i,o="prelu"===s,l=GV("numArgs",t,e,n),h=GV("leakyreluAlpha",t,e,n);if(a){if(o&&2!==l)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&1!==l)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[u,c]=GV("args",t,e,n);return[r.fused.matMul({a:GV("a",t,e,n),b:GV("b",t,e,n),transposeA:GV("transposeA",t,e,n),transposeB:GV("transposeB",t,e,n),bias:u,activation:s,preluActivationWeights:c,leakyreluAlpha:h})];case"MatrixBandPart":return[r.linalg.bandPart(GV("a",t,e,n),GV("numLower",t,e,n),GV("numUpper",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"normalization":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"EuclideanNorm":return[r.euclideanNorm(GV("x",t,e,n),GV("axis",t,e,n),GV("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[r.batchNorm(GV("x",t,e,n),GV("mean",t,e,n),GV("variance",t,e,n),GV("offset",t,e,n),GV("scale",t,e,n),GV("epsilon",t,e,n))];case"LRN":return[r.localResponseNormalization(GV("x",t,e,n),GV("radius",t,e,n),GV("bias",t,e,n),GV("alpha",t,e,n),GV("beta",t,e,n))];case"Softmax":return[r.softmax(GV("x",t,e,n))];case"LogSoftmax":return[r.logSoftmax(GV("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"ragged":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"RaggedGather":{const{outputNestedSplits:i,outputDenseValues:s}=r.raggedGather(GV("paramsNestedSplits",t,e,n),GV("paramsDenseValues",t,e,n),GV("indices",t,e,n),GV("outputRaggedRank",t,e,n));return i.concat(s)}case"RaggedRange":{const{rtNestedSplits:i,rtDenseValues:s}=r.raggedRange(GV("starts",t,e,n),GV("limits",t,e,n),GV("splits",t,e,n));return[i,s]}case"RaggedTensorToTensor":return[r.raggedTensorToTensor(GV("shape",t,e,n),GV("values",t,e,n),GV("defaultValue",t,e,n),GV("rowPartitionTensors",t,e,n),GV("rowPartitionTypes",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"reduction":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"Max":{const i=GV("axis",t,e,n),s=GV("keepDims",t,e,n);return[r.max(GV("x",t,e,n),i,s)]}case"Mean":{const i=GV("axis",t,e,n),s=GV("keepDims",t,e,n);return[r.mean(GV("x",t,e,n),i,s)]}case"Min":{const i=GV("axis",t,e,n),s=GV("keepDims",t,e,n);return[r.min(GV("x",t,e,n),i,s)]}case"Sum":{const i=GV("axis",t,e,n),s=GV("keepDims",t,e,n);return[r.sum(GV("x",t,e,n),i,s)]}case"All":{const i=GV("axis",t,e,n),s=GV("keepDims",t,e,n);return[r.all(GV("x",t,e,n),i,s)]}case"Any":{const i=GV("axis",t,e,n),s=GV("keepDims",t,e,n);return[r.any(GV("x",t,e,n),i,s)]}case"ArgMax":{const i=GV("axis",t,e,n);return[r.argMax(GV("x",t,e,n),i)]}case"ArgMin":{const i=GV("axis",t,e,n);return[r.argMin(GV("x",t,e,n),i)]}case"Prod":{const i=GV("axis",t,e,n),s=GV("keepDims",t,e,n);return[r.prod(GV("x",t,e,n),i,s)]}case"Cumprod":{const i=GV("axis",t,e,n),s=GV("exclusive",t,e,n),a=GV("reverse",t,e,n);return[r.cumprod(GV("x",t,e,n),i,s,a)]}case"Cumsum":{const i=GV("axis",t,e,n),s=GV("exclusive",t,e,n),a=GV("reverse",t,e,n);return[r.cumsum(GV("x",t,e,n),i,s,a)]}case"Bincount":const i=GV("x",t,e,n),s=GV("weights",t,e,n),a=GV("size",t,e,n);return[r.bincount(i,s,a)];case"DenseBincount":{const i=GV("x",t,e,n),s=GV("weights",t,e,n),a=GV("size",t,e,n),o=GV("binaryOutput",t,e,n);return[r.denseBincount(i,s,a,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"slice_join":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"ConcatV2":case"Concat":{const i=GV("n",t,e,n),s=GV("axis",t,e,n);let a=GV("tensors",t,e,n);return a=a.slice(0,i),[r.concat(a,s)]}case"Gather":{const i=GV("x",t,e,n),s=GV("indices",t,e,n);return[r.gather(i,r.cast(s,"int32"),0)]}case"GatherV2":{const i=GV("axis",t,e,n),s=GV("batchDims",t,e,n),a=GV("x",t,e,n),o=GV("indices",t,e,n);return[r.gather(a,r.cast(o,"int32"),i,s)]}case"Reverse":{const i=GV("dims",t,e,n),s=[];for(let t=0;t<i.length;t++)i[t]&&s.push(t);const a=GV("x",t,e,n);return[r.reverse(a,s)]}case"ReverseV2":{const i=GV("axis",t,e,n),s=GV("x",t,e,n);return[r.reverse(s,i)]}case"Slice":{const i=GV("begin",t,e,n),s=GV("size",t,e,n);return[r.slice(GV("x",t,e,n),i,s)]}case"StridedSlice":{const i=GV("begin",t,e,n),s=GV("end",t,e,n),a=GV("strides",t,e,n),o=GV("beginMask",t,e,n),l=GV("endMask",t,e,n),h=GV("ellipsisMask",t,e,n),u=GV("newAxisMask",t,e,n),c=GV("shrinkAxisMask",t,e,n),d=GV("x",t,e,n);return[r.stridedSlice(d,i,s,a,o,l,h,u,c)]}case"Pack":return fT((()=>{const i=GV("axis",t,e,n),s=GV("tensors",t,e,n),a=s[0].shape,o=r.squeeze(s[0]).shape,l=s.map((t=>{const e=vg(t.shape,a);if(!e&&!vg(r.squeeze(t).shape,o))throw new Error("the input tensors shape does not match");return e?t:r.reshape(t,a)}));return[r.stack(l,i)]}));case"Unpack":{const i=GV("axis",t,e,n),s=GV("tensor",t,e,n);return r.unstack(s,i)}case"Tile":{const i=GV("reps",t,e,n);return[r.tile(GV("x",t,e,n),i)]}case"Split":case"SplitV":{const i=GV("axis",t,e,n),s=GV("numOrSizeSplits",t,e,n),a=GV("x",t,e,n);return r.split(a,s,i)}case"ScatterNd":{const i=GV("indices",t,e,n),s=GV("values",t,e,n),a=GV("shape",t,e,n);return[r.scatterND(i,s,a)]}case"GatherNd":{const i=GV("x",t,e,n),s=GV("indices",t,e,n);return[r.gatherND(i,s)]}case"SparseToDense":{const i=GV("sparseIndices",t,e,n),s=GV("outputShape",t,e,n),a=GV("sparseValues",t,e,n),o=GV("defaultValue",t,e,n);return[r.sparseToDense(i,a,s,a.dtype===o.dtype?o:r.cast(o,a.dtype))]}case"TensorScatterUpdate":{const i=GV("indices",t,e,n),s=GV("values",t,e,n),a=GV("tensor",t,e,n);return[r.tensorScatterUpdate(a,i,s)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"sparse":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:i,outputValues:s,emptyRowIndicator:a,reverseIndexMap:o}=r.sparse.sparseFillEmptyRows(GV("indices",t,e,n),GV("values",t,e,n),GV("denseShape",t,e,n),GV("defaultValue",t,e,n));return[i,s,a,o]}case"SparseReshape":{const{outputIndices:i,outputShape:s}=r.sparse.sparseReshape(GV("inputIndices",t,e,n),GV("inputShape",t,e,n),GV("newShape",t,e,n));return[i,s]}case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(GV("data",t,e,n),GV("indices",t,e,n),GV("segmentIds",t,e,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(GV("data",t,e,n),GV("indices",t,e,n),GV("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"spectral":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"FFT":return[r.fft(GV("x",t,e,n))];case"IFFT":return[r.ifft(GV("x",t,e,n))];case"RFFT":return[r.rfft(GV("x",t,e,n))];case"IRFFT":return[r.irfft(GV("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"string":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"StaticRegexReplace":return[r.string.staticRegexReplace(GV("input",t,e,n),GV("pattern",t,e,n),GV("rewrite",t,e,n),GV("replaceGlobal",t,e,n))];case"StringNGrams":{const{nGrams:i,nGramsSplits:s}=r.string.stringNGrams(GV("data",t,e,n),GV("dataSplits",t,e,n),GV("separator",t,e,n),GV("nGramWidths",t,e,n),GV("leftPad",t,e,n),GV("rightPad",t,e,n),GV("padWidth",t,e,n),GV("preserveShortSequences",t,e,n));return[i,s]}case"StringSplit":{const{indices:i,values:s,shape:a}=r.string.stringSplit(GV("input",t,e,n),GV("delimiter",t,e,n),GV("skipEmpty",t,e,n));return[i,s,a]}case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(GV("input",t,e,n),GV("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"transformation":return i((()=>((t,e,n,r=W)=>{switch(t.op){case"Cast":return[r.cast(GV("x",t,e,n),GV("dtype",t,e,n))];case"ExpandDims":{const i=GV("axis",t,e,n);return[r.expandDims(GV("x",t,e,n),i)]}case"Squeeze":{const i=GV("axis",t,e,n);return[r.squeeze(GV("x",t,e,n),i)]}case"Reshape":return[r.reshape(GV("x",t,e,n),GV("shape",t,e,n))];case"EnsureShape":return[r.ensureShape(GV("x",t,e,n),GV("shape",t,e,n))];case"MirrorPad":return[r.mirrorPad(GV("x",t,e,n),GV("padding",t,e,n),GV("mode",t,e,n))];case"PadV2":case"Pad":return[r.pad(GV("x",t,e,n),GV("padding",t,e,n),GV("constantValue",t,e,n))];case"SpaceToBatchND":{const i=GV("blockShape",t,e,n),s=GV("paddings",t,e,n);return[r.spaceToBatchND(GV("x",t,e,n),i,s)]}case"BatchToSpaceND":{const i=GV("blockShape",t,e,n),s=GV("crops",t,e,n);return[r.batchToSpaceND(GV("x",t,e,n),i,s)]}case"DepthToSpace":{const i=GV("blockSize",t,e,n),s=GV("dataFormat",t,e,n).toUpperCase();return[r.depthToSpace(GV("x",t,e,n),i,s)]}case"BroadcastTo":return[r.broadcastTo(GV("x",t,e,n),GV("shape",t,e,n))];case"BroadcastArgs":return[r.broadcastArgs(GV("s0",t,e,n),GV("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n)));case"hash_table":return(async(t,e,n,r)=>{switch(t.op){case"HashTable":case"HashTableV2":{const i=r.getHashTableHandleByName(t.name);if(null!=i)return[i];{const i=GV("keyDType",t,e,n),s=GV("valueDType",t,e,n),a=new Vz(i,s);return r.addHashTable(t.name,a),[a.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const i=GV("tableHandle",t,e,n,r),s=GV("keys",t,e,n),a=GV("values",t,e,n),o=r.getHashTableById(i.id);return[await o.import(s,a)]}case"LookupTableFind":case"LookupTableFindV2":{const i=GV("tableHandle",t,e,n,r),s=GV("keys",t,e,n),a=GV("defaultValue",t,e,n),o=r.getHashTableById(i.id);return[await o.find(s,a)]}case"LookupTableSize":case"LookupTableSizeV2":{const i=GV("tableHandle",t,e,n,r);return[r.getHashTableById(i.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n,r);case"custom":const s=VV(t.op);if(s&&s.customExecutor)return s.customExecutor(new Rz(t,e,n));throw TypeError(`Custom op ${t.op} is not registered.`);default:throw TypeError(`Unknown op '${t.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return Zg(s)?s.then((t=>[].concat(t))):[].concat(s)}class Gz{constructor(t={},e={},n={},r={},i){this.weightMap=t,this.tensorArrayMap=e,this.tensorListMap=n,this.functionMap=r,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,e){return{id:t,frameName:e,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const t=[];for(let e=0;e<this.contexts.length-1;e++){const n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map((t=>0===t.id&&0===t.iterationId?"":`${t.frameName}-${t.iterationId}`)).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(const e in this.tensorArrayMap)this.tensorArrayMap[e].clearAndClose(t);for(const e in this.tensorListMap)this.tensorListMap[e].clearAndClose(t)}}function Wz(t,e,n,r){const i=new Set,s=[];let a=null,o=null;const l=new Set,h=new Set(Object.keys(t).map((t=>jV(t)[0])));r=r||[];const u=new Set(r.map((t=>jV(t.name)[0]))),c=[...e];for(;c.length>0;){const t=c.pop();(Kz(t)||Zz(t)||Jz(t))&&null==a&&(a=t,o=a.children.map((t=>t.name)).filter((t=>i.has(t)))),i.add(t.name),null==n[t.name]&&(h.has(t.name)||u.has(t.name)||(0!==t.inputs.length?t.inputs.forEach((t=>{l.has(t.name)||(l.add(t.name),c.push(t))})):s.push(t.name)))}return{inputs:t,outputs:e,usedNodes:i,missingInputs:s,dynamicNode:a,syncInputs:o}}function Xz(t,e){const{usedNodes:n,inputs:r}=e,i=Object.keys(r).map((t=>jV(t)[0])).map((e=>t.nodes[e])),s=t.initNodes||[],a=t=>n.has("string"==typeof t?t:t.name);function o(t){return[...new Map(t.map((t=>[t.name,t]))).values()]}const l=o([...i,...t.weights,...s]).filter(a),h=o([...l,...Object.values(t.nodes)]).filter(a),u=new Map(h.map((t=>[t.name,t]))),c={};for(const t of h){c[t.name]=c[t.name]||0;for(const e of t.children)a(e)||(c[e.name]=Number.POSITIVE_INFINITY),c[e.name]=(c[e.name]||0)+1}const d=Object.entries(c).filter((([,t])=>0===t)).map((([t])=>t)),p=[...d];for(;d.length>0;){const t=d.pop(),e=u.get(t);for(const t of e.children.filter(a))0==--c[t.name]&&(p.push(t.name),d.push(t.name))}const f=function(t,e){const n=new Map(t.map((t=>[t.name,t]))),r=e.map((t=>t.name)),i=new Set(r);for(;r.length>0;){const t=r.pop(),e=n.get(t);for(const t of e.children)n.has(t.name)&&!i.has(t.name)&&(i.add(t.name),r.push(t.name))}return t.filter((t=>i.has(t.name)))}(p.map((t=>u.get(t))),l);return function(t,e){const n=new Map(t.map(((t,e)=>[t.name,e]))),r=new Set(e.map((t=>t.name))),i=t=>r.has("string"==typeof t?t:t.name),s=new Set(t.map((t=>t.name))),a=t=>s.has("string"==typeof t?t:t.name);for(const e of t){for(const t of e.children.filter(a)){if(!n.has(t.name))throw new Hz(`Child ${t.name} of node ${e.name} is unreachable.`);if(n.get(e.name)>n.get(t.name))throw new Hz(`Node ${e.name} is scheduled to run after its child ${t.name}.`)}if(!i(e))for(const t of e.inputs){if(!n.has(t.name))throw new Hz(`Input ${t.name} of node ${e.name} is unreachable.`);if(n.get(t.name)>n.get(e.name))throw new Hz(`Node ${e.name} is scheduled to run before its input ${t.name}.`)}}}(f,l),f}class Hz extends Error{constructor(t){super(`NodesExecutionOrderError: ${t}`)}}const Yz=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),jz=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),qz=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function Kz(t){return Yz.has(t.op)}function Zz(t){return jz.has(t.op)}function Jz(t){return qz.has(t.op)}class Qz{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){const e=Object.keys(t).map((e=>t[e].map((t=>t.id))));this._weightIds=[].concat(...e),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get outputs(){return this._outputs.map((t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0})))}get inputNodes(){return this._inputs.map((t=>t.signatureKey||t.name))}get outputNodes(){return this._outputs.map((t=>{const e=t.signatureKey||t.name;return t.defaultOutput?`${e}:${t.defaultOutput}`:e}))}get functions(){return Object.keys(this._functions).reduce(((t,e)=>(t[e]=this._functions[e].signature,t)),{})}constructor(t,e){this.graph=t,this.parent=e,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((e=>{this._functionExecutorMap[e]=new Qz(t.functions[e],this)}))}getCompilationKey(t,e){const n=t.map((t=>t.name)).sort(),r=e.map((t=>t.name)).sort();return n.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}compile(t,e){const n=Wz(t,e,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:i,syncInputs:s}=n;if(null!=i)throw new Error(`This execution contains the node '${i.name}', which has the dynamic op '${i.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${s}]`);if(r.length>0){const n=e.map((t=>t.name)),i=Object.keys(t);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${i}]. Missing the following inputs: [${r}]`)}const a=Xz(this.graph,n),o=function(t){const e=new Map(t.map(((t,e)=>[t.name,e]))),n=Number.MAX_SAFE_INTEGER,r=t.map(((t,e)=>Kz(t)?n:e)),i=t=>{const n=r[e.get(t.name)];return null==n?-1:n},s=t.map(((t,e)=>t.children.map(i).reduce(((t,e)=>Math.max(t,e)),r[e]))),a=new Map;for(let e=0;e<t.length;++e){const r=s[e];if(r===n)continue;const i=t[e],o=t[r];a.has(o.name)||a.set(o.name,[]),a.get(o.name).push(i)}return a}(a);return{orderedNodes:a,nodeLiveUntilMap:o}}cloneAndKeepTensor(t){if(null==t)return null;const e=t.clone();return gT(e),e}cloneTensorList(t){if(!t)return null;const e=t.map((t=>this.cloneAndKeepTensor(t)));return e}cloneTensorMap(t){return Object.fromEntries(Object.entries(t).map((([t,e])=>[t,this.cloneTensorList(e)])))}execute(t,e){this.disposeIntermediateTensors(),t=this.mapInputs(t);const n=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e);const r=n.map((t=>this.graph.nodes[jV(t)[0]])),i=e.map((t=>jV(t)[0])),s=new Set(i);let a=i.map((t=>this.graph.nodes[t]));0===a.length&&(a=this._outputs);const o=this.getCompilationKey(r,a);let l=this.compiledMap.get(o);null==l&&(l=this.compile(t,a),this.compiledMap.set(o,l));try{this.keepIntermediateTensors=ey().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(t){this.keepIntermediateTensors=!1}const h={},u={};return fT((()=>{const n=new Gz(this.weightMap,h,u,this.functionExecutorMap,this.parseNodeNameCache),r=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(t).forEach((e=>{const[i,s]=jV(e,n),a=[];a[s]=t[e],r[i]=a,this.keepIntermediateTensors&&(this.clonedTensorsMap[i]=this.cloneTensorList(a))}));const i=this.getFrozenTensorIds(r),{orderedNodes:a,nodeLiveUntilMap:o}=l;for(const t of a){if(r[t.name])continue;const e=zz(t,r,n,this._resourceManager);if(Zg(e))throw new Error(`The execution of the op '${t.op}' returned a promise. Please use model.executeAsync() instead.`);r[t.name]=e,this.keepIntermediateTensors&&(this.clonedTensorsMap[t.name]=this.cloneTensorList(e)),this.checkTensorForDisposalWithNodeLiveUntilInfo(t,r,n,i,s,o.get(t.name))}return null==this.parent&&n.dispose(i),e.map((t=>WV(t,r,n)))}))}getFrozenTensorIds(t){const e=[].concat.apply([],Object.keys(t).map((e=>t[e])).map((t=>t.map((t=>t.id)))));return new Set(e)}checkTensorForDisposal(t,e,n,r,i,s,a){if(!Kz(e)&&!s.has(t)){for(const r of n[t])null!=r&&(a[r.id]=(a[r.id]||0)+e.children.length);for(const t of e.inputs){if(Kz(t))continue;const e=XV(t.name,n,r);if(null!=e)for(const t of e){if(!t||t.kept||i.has(t.id))continue;const e=a[t.id];1===e?(t.dispose(),delete a[t.id]):null!=e&&a[t.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(t,e,n,r,i,s){function a(t){return Kz(t)||i.has(t.name)}if(!Kz(t)&&null!=s)for(const t of s){if(a(t))continue;const i=XV(t.name,e,n);for(const t of i)!t||t.kept||r.has(t.id)||t.dispose()}}async executeAsync(t,e){return this._executeAsync(t,e)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach((t=>{for(const e of t)e&&!e.isDisposed&&e.dispose()})),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(t,e,n=!1,r={},i={}){this.disposeIntermediateTensors(),n||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e));try{this.keepIntermediateTensors=ey().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(t){this.keepIntermediateTensors=!1}const s=new Gz(this.weightMap,r,i,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const a=await this.executeWithControlFlow(t,s,e,n),o=e.map((t=>WV(t,a,s))),l=o.map((t=>t.id)),h=Object.keys(t).map((e=>t[e].id)),u=new Set([...l,...h,...this.weightIds]);return Object.values(a).forEach((t=>{t.forEach((t=>{!t||t.isDisposed||u.has(t.id)||t.dispose()}))})),null==this.parent&&s.dispose(u),o}async executeFunctionAsync(t,e,n){const r=t.reduce(((t,e,n)=>(t[this.inputs[n].name]=e,t)),{});return this._executeAsync(r,this.outputNodes,!0,e,n)}async executeWithControlFlow(t,e,n,r){const i=Object.keys(t),s=i.map((t=>this.graph.nodes[jV(t)[0]])),a=n.map((t=>jV(t)[0])),o=new Set(a);let l=a.map((t=>this.graph.nodes[t]));0===l.length&&(l=this._outputs);const{usedNodes:h,missingInputs:u,dynamicNode:c,syncInputs:d}=Wz(t,l,this.weightMap,this._initNodes),p=[...s,...this.graph.weights,...this._initNodes||[]].map((t=>({node:t,contexts:e.currentContext}))),f=Object.assign({},this.weightMap);Object.keys(t).forEach((e=>{const[n,r]=jV(e),i=[];i[r]=t[e],f[n]=i}));const m={},g=this.getFrozenTensorIds(f),y={};for(;p.length>0;){const t=this.processStack(s,p,e,f,y,g,o,m,h);await Promise.all(t)}const v=l.filter((t=>!Kz(t)&&!WV(t.name,f,e))).map((t=>t.name));if(v.length>0){let t="";throw null!=c&&(t=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${d}]`),new Error(`Cannot compute the outputs [${v}] from the provided inputs [${i}]. Consider providing the following inputs: [${u}]. ${t}`)}return f}processStack(t,e,n,r,i,s,a,o,l){const h=[];for(;e.length>0;){const t=e.pop();n.currentContext=t.contexts;let u="";if("Enter"===t.node.op&&GV("isConstant",t.node,r,n)&&([u]=HV(t.node.name,n)),null==r[t.node.name]){const c=zz(t.node,r,n,this._resourceManager);u||([u]=HV(t.node.name,n));const d=n.currentContext;Zg(c)?h.push(c.then((h=>(r[u]=h,this.keepIntermediateTensors&&(this.clonedTensorsMap[u]=this.cloneTensorList(h)),n.currentContext=d,this.checkTensorForDisposal(u,t.node,r,n,s,a,o),this.processChildNodes(t.node,e,n,r,i,l),h)))):(r[u]=c,this.keepIntermediateTensors&&(this.clonedTensorsMap[u]=this.cloneTensorList(c)),this.checkTensorForDisposal(u,t.node,r,n,s,a,o),this.processChildNodes(t.node,e,n,r,i,l))}else this.processChildNodes(t.node,e,n,r,i,l)}return h}processChildNodes(t,e,n,r,i,s){t.children.forEach((t=>{const[a]=HV(t.name,n);!i[a]&&s.has(t.name)&&("Merge"===t.op?t.inputNames.some((t=>!!WV(t,r,n)))&&(i[a]=!0,e.push({contexts:n.currentContext,node:t})):t.inputNames.every((t=>!!WV(t,r,n)))&&(i[a]=!0,e.push({contexts:n.currentContext,node:t})))}))}dispose(){Object.keys(this.weightMap).forEach((t=>this.weightMap[t].forEach((t=>t.dispose()))))}checkInputShapeAndType(t){Object.keys(t).forEach((e=>{const n=t[e],[r]=jV(e),i=this.graph.nodes[r];if(i.attrParams.shape&&i.attrParams.shape.value){const t=i.attrParams.shape.value,e=t.length===n.shape.length&&n.shape.every(((e,n)=>-1===t[n]||t[n]===e));dg(e,(()=>`The shape of dict['${i.name}'] provided in model.execute(dict) must be [${t}], but was [${n.shape}]`))}i.attrParams.dtype&&i.attrParams.dtype.value&&dg(n.dtype===i.attrParams.dtype.value,(()=>`The dtype of dict['${i.name}'] provided in model.execute(dict) must be ${i.attrParams.dtype.value}, but was ${n.dtype}`))}))}mapInputs(t){var e,n;const r={};for(const i in t){const s=null===(n=null===(e=this._signature)||void 0===e?void 0:e.inputs)||void 0===n?void 0:n[i];null!=s?r[s.name]=t[i]:r[i]=t[i]}return r}checkInputs(t){const e=Object.keys(t).filter((t=>{const[e]=jV(t);return null==this.graph.nodes[e]}));if(e.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${e}] that are not part of graph`)}mapOutputs(t){return t.map((t=>{var e,n;const r=null===(n=null===(e=this._signature)||void 0===e?void 0:e.outputs)||void 0===n?void 0:n[t];return null!=r?r.name:t}),{})}checkOutputs(t){t.forEach((t=>{const[e]=jV(t);if(!this.graph.nodes[e])throw new Error(`The output '${t}' is not found in the graph`)}))}}class tG{constructor(t={},e={}){this.hashTableNameToHandle=t,this.hashTableMap=e}addHashTable(t,e){this.hashTableNameToHandle[t]=e.handle,this.hashTableMap[e.id]=e}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(const t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(const t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}class eG{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(t,e={},n=l){this.modelUrl=t,this.loadOptions=e,this.version="n/a",this.io=n,null==e&&(this.loadOptions={}),this.resourceManager=new tG}findIOHandler(){const t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(t,this.loadOptions);else{const e=this.io.getLoadHandlers(t,this.loadOptions);if(0===e.length)e.push(this.io.browserHTTPRequest(t,this.loadOptions));else if(e.length>1)throw new Error(`Found more than one (${e.length}) load handlers for URL '${[t]}'`);this.handler=e[0]}}load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const t=this.handler.load();return Zg(t)?t.then((t=>this.loadSync(t))):this.loadSync(t)}loadSync(t){this.artifacts=t;const e=this.artifacts.modelTopology;let n=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){const t=this.artifacts.userDefinedMetadata;null!=t.signature&&(n=t.signature),null!=t.structuredOutputKeys&&(this.structuredOutputKeys=t.structuredOutputKeys)}this.signature=n,this.version=`${e.versions.producer}.${e.versions.minConsumer}`;const r=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new Qz(gz.Instance.transformGraph(e,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=t.modelInitializer&&null!=t.modelInitializer.node){const e=gz.Instance.transformGraph(t.modelInitializer);this.initializer=new Qz(e),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=t.initializerSignature}return!0}async save(t,e){if("string"==typeof t){const e=this.io.getSaveHandlers(t);if(0===e.length)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new Error(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)}addStructuredOutputNames(t){if(this.structuredOutputKeys){const e={};return(t instanceof vw?[t]:t).forEach(((t,n)=>e[this.structuredOutputKeys[n]]=t)),e}return t}predict(t,e){const n=this.execute(t,this.outputNodes);return this.addStructuredOutputNames(n)}async predictAsync(t,e){const n=await this.executeAsync(t,this.outputNodes);return this.addStructuredOutputNames(n)}normalizeInputs(t){var e;if(!(t instanceof vw||Array.isArray(t))){const n=null===(e=this.signature)||void 0===e?void 0:e.inputs;if(null!=n)for(const e in n){const r=n[e];null!=r.resourceId&&(t[e]=this.resourceIdToCapturedInput[r.resourceId])}return t}t=Array.isArray(t)?t:[t];const n=Object.keys(this.resourceIdToCapturedInput).length;if(t.length+n!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-n} non-resource placeholders, while there are ${t.length} input tensors provided.`);let r=0;return this.inputNodes.reduce(((e,n)=>{var i,s,a;const o=null===(a=null===(s=null===(i=this.signature)||void 0===i?void 0:i.inputs)||void 0===s?void 0:s[n])||void 0===a?void 0:a.resourceId;return e[n]=null!=o?this.resourceIdToCapturedInput[o]:t[r++],e}),{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}executeInitializerGraph(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(t){if(this.resourceIdToCapturedInput={},this.initializerSignature){const e=this.initializerSignature.outputs,n=Object.keys(e);for(let r=0;r<n.length;r++){const i=e[n[r]];this.resourceIdToCapturedInput[i.resourceId]=t[r]}}}execute(t,e){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=this.executor.execute(t,e);return n.length>1?n:n[0]}async executeAsync(t,e){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=await this.executor.executeAsync(t,e);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce(((e,n)=>(e[n]=[t[n]],e)),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&mT(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function nG(t,e={},n=l){if(null==t)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==e&&(e={}),e.fromTFHub&&"string"==typeof t&&(t=function(t){t.endsWith("/")||(t+="/");return`${t}model.json?tfjs-format=file`}(t));const r=new eG(t,e,n);return await r.load(),r}function rG(t){if(null==t)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");let e;if(t instanceof Array){const[n,r]=t;if(!n)throw new Error("modelJSON must be the first element of the array");if(!(r&&r instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in n))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in n))throw new Error("Model JSON is missing 'weightsManifest'");e=CE(p_(n,g_(n.weightsManifest),r))}else if("load"in t)e=t;else{if(!("modelTopology"in t&&"weightSpecs"in t&&"weightData"in t))throw new Error("Unknown model format");e=CE(t)}const n=new eG(e);return n.load(),n}const iG="4.8.0";function sG(t,e,n=new Map,r=new Set){if(null==t)return null;if("function"==typeof Blob&&t instanceof Blob)return t.slice();if(r.has(t))throw new Error("Circular references are not supported.");if(n.has(t))return n.get(t);const i=e(t);if(i.recurse&&null!==i.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(i.recurse){if(uG(t)){const i=Array.isArray(t)?[]:{};r.add(t);for(const s in t){const a=sG(t[s],e,n,r);i[s]=a}return r.delete(t),t.__proto__&&(i.__proto__=t.__proto__),i}throw new Error(`Can't recurse into non-iterable type: ${t}`)}return n.set(t,i.value),i.value}function aG(t,e=lG){return oG(t,e)}function oG(t,e,n=new Set){const r=t[0];if(n.has(r))throw new Error("Circular references are not supported.");const i=e(t);if(i.recurse&&null!==i.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(i.recurse){if(uG(r)){const i=Array.isArray(r)?[]:{};n.add(r);for(const s in r){const r=t.map((t=>t[s])),a=oG(r,e,n);i[s]=a}return n.delete(r),i}throw new Error(`Can't recurse into non-iterable type: ${r}`)}return i.value}function lG(t){return null===t?null:uG(t[0])?{value:null,recurse:!0}:{value:t,recurse:!1}}async function hG(t,e){const n=new Map;sG(t,e,n);for(const t of Array.from(n.keys())){const e=n.get(t);if(Zg(e)){const r=await e;n.set(t,r)}}return sG(t,e,n)}function uG(t){let e=!1;if(ey().get("IS_BROWSER"))e=t instanceof TextDecoder;else{const{StringDecoder:r}=n(977);e=t instanceof r}return null!=t&&!ArrayBuffer.isView(t)&&(Array.isArray(t)||"object"==typeof t&&!(t instanceof vw)&&!(t instanceof Promise)&&!e)}function cG(t){return function(t,e){return sG(t,e)}(t,dG)}function dG(t){return t instanceof vw?{value:t.clone(),recurse:!1}:uG(t)?{value:null,recurse:!0}:{value:t,recurse:!1}}class pG{constructor(t){if(this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}wrap(t){for(;t<0;)t+=this.doubledCapacity;return t%this.doubledCapacity}get(t){if(t<0)throw new RangeError("Can't get item at a negative index.");return this.data[t%this.capacity]}set(t,e){if(t<0)throw new RangeError("Can't set item at a negative index.");this.data[t%this.capacity]=e}length(){let t=this.end-this.begin;return t<0&&(t=this.doubledCapacity+t),t}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,t),this.end=this.wrap(this.end+1)}pushAll(t){for(const e of t)this.push(e)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const t=this.get(this.end);return this.set(this.end,void 0),t}unshift(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,t)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),t}shuffleExcise(t){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.wrap(this.begin+t),n=this.get(e);return this.set(e,this.pop()),n}}class fG extends pG{constructor(){super(fG.INITIAL_CAPACITY)}isFull(){return!1}push(t){super.isFull()&&this.expand(),super.push(t)}unshift(t){super.isFull()&&this.expand(),super.unshift(t)}expand(){const t=2*this.capacity,e=new Array(t),n=this.length();for(let t=0;t<n;t++)e[t]=this.get(this.wrap(this.begin+t));this.data=e,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}function mG(t){return new xG(t)}function gG(t){return new bG(t)}function yG(t,e){return new RG(t,e)}fG.INITIAL_CAPACITY=32;class vG{async toArray(){const t=[];let e=await this.next();for(;!e.done;)t.push(e.value),e=await this.next();return t}async toArrayForTest(){const t=this.prefetch(100),e=[];let n=await t.next();for(;!n.done;)e.push(n.value),n=await t.next();return e}async resolveFully(){let t=await this.next();for(;!t.done;)t=await this.next()}async resolveWhile(t){let e=await this.next(),n=t(e.value);for(;!e.done&&n;)e=await this.next(),n=t(e.value)}handleErrors(t){return new kG(this,t)}filter(t){return new SG(this,t)}map(t){return new IG(this,t)}mapAsync(t){return new CG(this,t)}serialMapAsync(t){return new CG(this,t).serial()}flatmap(t){return new AG(this,t)}async forEachAsync(t){return this.map(t).resolveFully()}async serialForEach(t){return this.serialMapAsync(t).resolveWhile((t=>!0===t))}rowMajorBatch(t,e=!0){return new EG(this,t,e)}columnMajorBatch(t,e=!0,n=lG){return this.rowMajorBatch(t,e).map((t=>aG(t,n)))}concatenate(t,e){return new RG(mG([this,t]),e)}take(t){return t<0||null==t?this:new TG(this,t)}skip(t){return t<0||null==t?this:new _G(this,t)}prefetch(t){return new PG(this,t)}shuffle(t,e){return new DG(this,t,e)}serial(){return new wG(this)}}class xG extends vG{constructor(t){super(),this.items=t,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const t=this.items[this.trav];return this.trav++,{value:cG(t),done:!1}}}class bG extends vG{constructor(t){super(),this.nextFn=t}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(t){throw t.message=`Error thrown while iterating through a dataset: ${t.message}`,t}}}class wG extends vG{constructor(t){super(),this.upstream=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){return this.upstream.next()}}class _G extends vG{constructor(t,e){super(),this.upstream=t,this.maxCount=e,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const t=await this.upstream.next();if(t.done)return t;mT(t.value)}return this.upstream.next()}}class TG extends vG{constructor(t,e){super(),this.upstream=t,this.maxCount=e,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class EG extends vG{constructor(t,e,n=!0){super(),this.upstream=t,this.batchSize=e,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){const t=[];for(;t.length<this.batchSize;){const e=await this.upstream.next();if(e.done)return this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0};t.push(e.value)}return{value:t,done:!1}}}class SG extends vG{constructor(t,e){super(),this.upstream=t,this.predicate=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;){const t=await this.upstream.next();if(t.done||this.predicate(t.value))return t;mT(t.value)}}}class IG extends vG{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> Map`}async next(){const t=await this.upstream.next();if(t.done)return{value:null,done:!0};const e=Pw(t.value),n=this.transform(t.value),r=Pw(n);for(const t of e)Ow(t,r)||t.dispose();return{value:n,done:!1}}}class kG extends vG{constructor(t,e){super(),this.upstream=t,this.handler=e,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(t){if(!this.handler(t))return{value:null,done:!0}}}}class CG extends vG{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){const t=await this.upstream.next();if(t.done)return{value:null,done:!0};const e=Pw(t.value),n=await this.transform(t.value),r=Pw(n);for(const t of e)Ow(t,r)||t.dispose();return{value:n,done:!1}}}class NG extends vG{constructor(){super(),this.outputQueue=new fG,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class AG extends NG{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){const t=await this.upstream.next();if(t.done)return!1;const e=Pw(t.value),n=this.transform(t.value),r=Pw(n);this.outputQueue.pushAll(n);for(const t of e)Ow(t,r)||t.dispose();return!0}}class RG extends vG{constructor(t,e){super(),this.baseErrorHandler=e,this.lastRead=null,this.iterator=null,this.moreIterators=t}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(t){if(await t,null==this.iterator){const t=await this.moreIterators.next();if(t.done)return{value:null,done:!0};this.iterator=t.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const e=await this.iterator.next();return e.done?(this.iterator=null,this.readFromChain(t)):e}}var MG;!function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"}(MG||(MG={}));class OG extends vG{constructor(t,e=MG.FAIL){super(),this.iterators=t,this.mismatchMode=e,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}async nextState(t){await t;let e=0,n=0;const r=await hG(this.iterators,(function(t){if(t instanceof vG){return{value:t.next().then((t=>(e++,t.done&&n++,t.value))),recurse:!1}}return{value:null,recurse:!0}}));if(e===n)return{value:null,done:!0};if(n>0)switch(this.mismatchMode){case MG.FAIL:throw new Error(`Zipped streams should have the same length. Mismatched at element ${this.count}.`);case MG.SHORTEST:return{value:null,done:!0};case MG.LONGEST:}return this.count++,{value:r,done:!1}}async next(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise}}class PG extends vG{constructor(t,e){super(),this.upstream=t,this.bufferSize=e,this.buffer=new pG(e)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){const t=this.upstream.next();this.buffer.push(t)}}next(){return this.refill(),this.buffer.shift()}}class DG extends PG{constructor(t,e,n){super(t,e),this.upstream=t,this.windowSize=e,this.upstreamExhausted=!1,this.random=mC.alea(n||tw().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}randomInt(t){return Math.floor(this.random()*t)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const t=this.chooseIndex(),e=await this.buffer.shuffleExcise(t);if(!e.done)return this.refill(),e;this.upstreamExhausted=!0}return{value:null,done:!0}}}class FG{constructor(){this.size=null}batch(t,e=!0){const n=this;let r;return dg(t>0,(()=>`batchSize needs to be positive, but it is\n      ${t}`)),r=this.size===1/0||null==this.size?this.size:e?Math.ceil(this.size/t):Math.floor(this.size/t),LG((async()=>(await n.iterator()).columnMajorBatch(t,e,UG)),r)}concatenate(t){const e=this;let n;return n=this.size===1/0||t.size===1/0?1/0:null!=this.size&&null!=t.size?this.size+t.size:null,LG((async()=>(await e.iterator()).concatenate(await t.iterator())),n)}filter(t){const e=this;let n;return n=this.size===1/0?1/0:null,LG((async()=>(await e.iterator()).filter((e=>fT((()=>t(e)))))),n)}async forEachAsync(t){return(await this.iterator()).forEachAsync(t)}map(t){const e=this;return LG((async()=>(await e.iterator()).map((e=>fT((()=>t(e)))))),this.size)}mapAsync(t){const e=this;return LG((async()=>(await e.iterator()).mapAsync(t)),this.size)}prefetch(t){if(null==t)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const e=this;return LG((async()=>(await e.iterator()).prefetch(t)),this.size)}repeat(t){const e=this;let n;return n=null!=this.size&&t>0?this.size*t:0===t?0:null!=this.size&&(void 0===t||t<0)?1/0:null,LG((async()=>yG(gG((async()=>({value:await e.iterator(),done:!1}))).take(t))),n)}skip(t){const e=this;let n;return n=null!=this.size&&t>=0&&this.size>=t?this.size-t:null!=this.size&&(this.size<t||void 0===t||t<0)?0:null,LG((async()=>(await e.iterator()).skip(t)),n)}shuffle(t,e,n=!0){if(null==t||t<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const r=this,i=mC.alea(e||tw().toString());return LG((async()=>{let e=i.int32();return n&&(e+=i.int32()),(await r.iterator()).shuffle(t,e.toString())}),this.size)}take(t){const e=this;let n;return n=null!=this.size&&this.size>t?t:null!=this.size&&this.size<=t?this.size:null,LG((async()=>(await e.iterator()).take(t)),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function LG(t,e=null){return new class extends FG{constructor(){super(...arguments),this.size=e}async iterator(){return t()}}}function BG(t){return LG((async()=>mG(t)),t.length)}function $G(t){if(!uG(t))throw new Error("The argument to zip() must be an object or array.");let e;if(Array.isArray(t))for(let n=0;n<t.length;n++)e=null==e?t[n].size:Math.min(e,t[n].size);else if(t instanceof Object)for(const n in t)e=null==e?t[n].size:Math.min(e,t[n].size);return LG((async()=>function(t,e=MG.FAIL){return new OG(t,e)}(await hG(t,(t=>{if(t instanceof FG)return{value:t.iterator(),recurse:!1};if(uG(t))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})),MG.SHORTEST)),e)}function UG(t){if(null===t)return null;const e=t[0];if(null==(n=e)||null===(r=n)||"object"!=typeof r&&"function"!=typeof r||Array.isArray(n)||"object"==typeof n&&n instanceof vw||iw(n)){return{value:function(t){if(0===t.length)throw new Error("Can't make a batch of zero elements.");return t[0]instanceof vw?QC(t):n_(t)}(t),recurse:!1}}var n,r;return{value:null,recurse:!0}}FG.MAX_BUFFER_SIZE=1e4;class VG extends FG{constructor(t){super(),this.input=t}async iterator(){return(await this.input.iterator()).decodeUTF8().split("\n").map((t=>(t.endsWith("\r")&&(t=t.slice(0,-1)),t)))}}const zG='"',GG=Symbol("out"),WG=Symbol("field"),XG=Symbol("quote"),HG=Symbol("quoteafterquote"),YG=Symbol("quoteinquote");class jG extends FG{async columnNames(){return this.columnNamesValidated||await this.setColumnNames(),this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames}async setColumnNames(){const t=await this.maybeReadHeaderLine();if(!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");this.fullColumnNames&&t&&dg(t.length===this.fullColumnNames.length,(()=>"The length of provided columnNames ("+this.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+").")),this.fullColumnNames||(this.fullColumnNames=t);const e=this.fullColumnNames.reduce(((t,e)=>(t[e]=t[e]+1||1,t)),{}),n=Object.keys(e).filter((t=>e[t]>1));if(dg(0===n.length,(()=>"Duplicate column names found: "+n.toString())),this.columnConfigs)for(const t of Object.keys(this.columnConfigs)){if(-1===this.fullColumnNames.indexOf(t))throw new Error('The key "'+t+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}this.columnNamesValidated=!0}async maybeReadHeaderLine(){if(this.hasHeader){const t=await this.base.iterator(),e=await t.next();if(e.done)throw new Error("No data was found for CSV parsing.");const n=e.value;return this.parseRow(n,!1)}return null}constructor(t,e){super(),this.input=t,this.hasHeader=!0,this.fullColumnNames=null,this.columnNamesValidated=!1,this.columnConfigs=null,this.configuredColumnsOnly=!1,this.delimiter=",",this.delimWhitespace=!1,this.base=new VG(t),e||(e={}),this.hasHeader=!1!==e.hasHeader,this.fullColumnNames=e.columnNames,this.columnConfigs=e.columnConfigs,this.configuredColumnsOnly=e.configuredColumnsOnly,e.delimWhitespace?(dg(null==e.delimiter,(()=>"Delimiter should not be provided when delimWhitespace is true.")),this.delimWhitespace=!0,this.delimiter=" "):this.delimiter=e.delimiter?e.delimiter:","}async iterator(){this.columnNamesValidated||await this.setColumnNames();let t=await this.base.iterator();return this.hasHeader&&(t=t.skip(1)),t.map((t=>this.makeDataElement(t)))}makeDataElement(t){const e=this.parseRow(t),n={},r={};for(let i=0;i<this.fullColumnNames.length;i++){const s=this.fullColumnNames[i],a=this.columnConfigs?this.columnConfigs[s]:null;if(!this.configuredColumnsOnly||a){const o=e[i];let l=null;if(""===o)if(a&&void 0!==a.default)l=a.default;else{if(a&&(a.required||a.isLabel))throw new Error(`Required column ${s} is empty in this line: ${t}`);l=void 0}else{const t=Number(o);if(isNaN(t))l=a&&"bool"===a.dtype?this.getBoolean(o):o;else if(a&&a.dtype)switch(a.dtype){default:l=t;break;case"int32":l=Math.floor(t);break;case"bool":l=this.getBoolean(o)}else l=t}a&&a.isLabel?r[s]=l:n[s]=l}}return 0===Object.keys(r).length?n:{xs:n,ys:r}}getBoolean(t){return"1"===t||"true"===t.toLowerCase()?1:0}parseRow(t,e=!0){const n=[];let r=0;const i=t.length;let s=GG;for(let e=0;e<i;e++)switch(s){case GG:switch(t.charAt(e)){case zG:r=e+1,s=XG;break;case this.delimiter:if(r=e+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),s=GG;break;default:s=WG,r=e}break;case WG:if(t.charAt(e)===this.delimiter)n.push(t.substring(r,e)),s=GG,r=e+1;break;case XG:if(t.charAt(e)===zG)s=HG;break;case HG:switch(t.charAt(e)){case this.delimiter:n.push(t.substring(r,e-1)),s=GG,r=e+1;break;case zG:s=XG;break;default:s=YG}break;case YG:if(t.charAt(e)===zG)s=XG}if(s===HG?n.push(t.substring(r,i-1)):n.push(t.substring(r)),e&&n.length!==this.fullColumnNames.length)throw new Error(`Invalid row in csv file. Should have ${this.fullColumnNames.length} elements in a row, but got ${n}`);return n}}class qG extends vG{constructor(t){super(),this.microphoneConfig=t,this.isClosed=!1,this.fftSize=t.fftSize||1024;const e=Math.log2(this.fftSize);if(this.fftSize<0||e<4||e>14||!Number.isInteger(e))throw new Error(`Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ${this.fftSize}`);if(this.numFrames=t.numFramesPerSpectrogram||43,this.sampleRateHz=t.sampleRateHz,this.columnTruncateLength=t.columnTruncateLength||this.fftSize,this.audioTrackConstraints=t.audioTrackConstraints,this.smoothingTimeConstant=t.smoothingTimeConstant||0,this.includeSpectrogram=!1!==t.includeSpectrogram,this.includeWaveform=!0===t.includeWaveform,!this.includeSpectrogram&&!this.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.")}summary(){return"microphone"}static async create(t={}){if(!ey().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");const e=new qG(t);return await e.start(),e}async start(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1})}catch(t){throw new Error(`Error thrown while initializing video stream: ${t.message}`)}if(!this.stream)throw new Error("Could not obtain audio from microphone.");const t=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new t,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error(`Mismatch in sampling rate: Expected: ${this.sampleRateHz}; Actual: ${this.audioContext.sampleRate}`)}else this.sampleRateHz=this.audioContext.sampleRate;const e=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,e.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize)}async next(){if(this.isClosed)return{value:null,done:!0};let t,e;const n=await this.getAudioData();if(this.includeSpectrogram){const e=this.flattenQueue(n.freqDataQueue);t=this.getTensorFromAudioDataArray(e,[this.numFrames,this.columnTruncateLength,1])}if(this.includeWaveform){const t=this.flattenQueue(n.timeDataQueue);e=this.getTensorFromAudioDataArray(t,[this.numFrames*this.fftSize,1])}return{value:{spectrogram:t,waveform:e},done:!1}}async capture(){return(await this.next()).value}async getAudioData(){const t=[],e=[];let n=0;return new Promise((r=>{const i=setInterval((()=>{this.includeSpectrogram&&(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0&&r({freqDataQueue:t,timeDataQueue:e}),t.push(this.freqData.slice(0,this.columnTruncateLength))),this.includeWaveform&&(this.analyser.getFloatTimeDomainData(this.timeData),e.push(this.timeData.slice())),++n===this.numFrames&&(clearInterval(i),r({freqDataQueue:t,timeDataQueue:e}))}),this.fftSize/this.sampleRateHz*1e3)}))}stop(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}toArray(){throw new Error("Can not convert infinite audio stream to array.")}getSampleRate(){return this.sampleRateHz}flattenQueue(t){const e=t[0].length,n=new Float32Array(t.length*e);return t.forEach(((t,r)=>n.set(t,r*e))),n}getTensorFromAudioDataArray(t,e){const n=new Float32Array(mg(e));return n.set(t,n.length-t.length),n_(n,e)}}class KG extends vG{constructor(t,e){if(super(),this.webcamVideoElement=t,this.webcamConfig=e,this.isClosed=!0,this.resize=!1,this.needToResize())if(this.resize=!0,this.cropSize=[this.webcamConfig.resizeHeight,this.webcamConfig.resizeWidth],this.cropBoxInd=rN([0],"int32"),this.webcamConfig.centerCrop){const t=1*this.webcamConfig.resizeWidth/this.webcamVideoElement.width,e=1*this.webcamConfig.resizeHeight/this.webcamVideoElement.height,n=(1-t)/2,r=(1-e)/2,i=n+t,s=e+r;this.cropBox=iN([r,n,s,i],[1,4])}else this.cropBox=iN([0,0,1,1],[1,4])}summary(){return"webcam"}static async create(t,e={}){if(!ey().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!e.resizeWidth||!e.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=e.resizeWidth,t.height=e.resizeHeight}const n=new KG(t,e);return await n.start(),n}async start(){this.webcamConfig.facingMode&&dg("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,(()=>`Invalid webcam facing mode: ${this.webcamConfig.facingMode}. Please provide 'user' or 'environment'`));try{this.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})}catch(t){throw t.message=`Error thrown while initializing video stream: ${t.message}`,t}if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(t){this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,new Promise((t=>{this.webcamVideoElement.onloadedmetadata=()=>{t()}}))}async next(){if(this.isClosed)return{value:null,done:!0};let t;try{t=YE(this.webcamVideoElement)}catch(t){throw new Error(`Error thrown converting video to pixels: ${JSON.stringify(t)}`)}if(!this.resize)return{value:t,done:!1};try{return{value:this.cropAndResizeFrame(t),done:!1}}catch(t){throw new Error(`Error thrown cropping the video: ${t.message}`)}finally{t.dispose()}}needToResize(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)}cropAndResizeFrame(t){return fT((()=>{const e=ck(rT(t,"float32"),0);let n;n=DA.cropAndResize(e,this.cropBox,this.cropBoxInd,this.cropSize,"bilinear");const r=n.shape;return rI(n,r.slice(1))}))}async capture(){return(await this.next()).value}stop(){this.stream.getTracks().forEach((t=>t.stop()));try{this.webcamVideoElement.srcObject=null}catch(t){this.webcamVideoElement.src=null}this.isClosed=!0}toArray(){throw new Error("Can not convert infinite video stream to array.")}}class ZG{}class JG extends vG{split(t){return new QG(this,t)}}class QG extends JG{constructor(t,e){super(),this.upstream=t,this.impl=new tW(t,e)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class tW extends NG{constructor(t,e){super(),this.upstream=t,this.separator=e,this.carryover=""}summary(){return`${this.upstream.summary()} -> Split('${this.separator}')`}async pump(){const t=await this.upstream.next();if(t.done)return""!==this.carryover&&(this.outputQueue.push(this.carryover),this.carryover="",!0);const e=t.value.split(this.separator);e[0]=this.carryover+e[0];for(const t of e.slice(0,-1))this.outputQueue.push(t);return this.carryover=e[e.length-1],!0}}class eW extends vG{decodeUTF8(){return new nW(this)}}class nW extends JG{constructor(t){super(),this.upstream=t,this.impl=new rW(t)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class rW extends NG{constructor(t){if(super(),this.upstream=t,ey().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{const{StringDecoder:t}=n(601);this.decoder=new t("utf8")}}summary(){return`${this.upstream.summary()} -> Utf8`}async pump(){const t=await this.upstream.next();let e,n;return!t.done&&(e=t.value,n=ey().get("IS_BROWSER")?this.decoder.decode(e,{stream:!0}):this.decoder.write(Buffer.from(e.buffer)),this.outputQueue.push(n),!0)}}class iW extends eW{constructor(t,e={}){super(),this.file=t,this.options=e,dg(t instanceof Uint8Array||!!ey().get("IS_BROWSER")&&(t instanceof File||t instanceof Blob),(()=>"FileChunkIterator only supports File, Blob and Uint8Array right now.")),this.offset=e.offset||0,this.chunkSize=e.chunkSize||1048576}summary(){return`FileChunks ${this.file}`}async next(){if(this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size))return{value:null,done:!0};const t=new Promise(((t,e)=>{const n=this.offset+this.chunkSize;if(this.file instanceof Uint8Array)t(new Uint8Array(this.file.slice(this.offset,n)));else{const r=new FileReader;r.onload=n=>{let i=r.result;if(i instanceof ArrayBuffer&&(i=new Uint8Array(i)),!(i instanceof Uint8Array))return e(new TypeError("FileReader returned unknown type."));t(i)},r.onabort=t=>e(new Error("Aborted")),r.onerror=t=>e(new Error(t.type));const i=this.file.slice(this.offset,n);r.readAsArrayBuffer(i)}this.offset=n}));return{value:await t,done:!1}}}const sW=t=>({method:t.method,headers:t.headers,body:t.body,mode:t.mode,credentials:t.credentials,cache:t.cache,redirect:t.redirect,referrer:t.referrer,integrity:t.integrity});function aW(t){return"string"==typeof t&&"file://"===t.slice(0,7)}class oW extends ZG{constructor(t,e={}){super(),this.input=t,this.options=e}async iterator(){if(aW(this.input)&&ey().get("IS_NODE")){const t=n(792);this.input=t.readFileSync(this.input.slice(7))}return new iW(this.input,this.options)}}class lW extends ZG{constructor(t,e={}){super(),this.url=t,this.fileOptions=e}async iterator(){return aW(this.url)?new oW(this.url,this.fileOptions).iterator():async function(t,e={},n){let r,i;"string"==typeof t?r=t:(r=t.url,i=sW(t));const s=await(n||ew)(r,i);if(s.ok){const t=new Uint8Array(await s.arrayBuffer());return new iW(t,e)}throw new Error(s.statusText)}(this.url,this.fileOptions)}}function hW(t,e={}){return new jG(new lW(t),e)}function uW(t){const e=gG(t);return LG((async()=>e))}function cW(t){return LG((async()=>{const e=await t();return gG((()=>e.next()))}))}async function dW(t,e){return KG.create(t,e)}async function pW(t){return qG.create(t)}const fW="4.8.0";function mW(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>{null!=t&&dg("complex64"!==t.dtype,(()=>`${e} does not support complex64 tensors in the CPU backend.`))}))}const gW=gN;class yW extends ng{nextDataId(){return yW.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new eg(this,cT())}write(t,e,n){this.firstUse&&(this.firstUse=!1,ey().get("IS_NODE")&&Eb());const r={id:this.nextDataId()};return this.data.set(r,{values:t,dtype:n,refCount:1}),r}makeTensorInfo(t,e,n){let r;if("string"===e&&null!=n&&n.length>0&&Dg(n[0])){const i=n.map((t=>nw(t)));r=this.write(i,t,e)}else r=this.write(n,t,e);return{dataId:r,shape:t,dtype:e}}refCount(t){if(this.data.has(t)){return this.data.get(t).refCount}return 0}incRef(t){this.data.get(t).refCount++}decRef(t){if(this.data.has(t)){this.data.get(t).refCount--}}move(t,e,n,r,i){this.data.set(t,{values:e,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:e,complexTensorInfos:n}=this.data.get(t);if("complex64"===e){return dR(this.readSync(n.real.dataId),this.readSync(n.imag.dataId))}return Wg(this.data.get(t).values,e)}bufferSync(t){const e=this.readSync(t.dataId);if("string"===t.dtype)try{const n=e.map((t=>rw(t)));return nT(t.shape,t.dtype,n)}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return nT(t.shape,t.dtype,e)}makeOutput(t,e,n){return cT().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,t),this)}disposeData(t,e=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!e&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(t);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const e=tw();t();return{kernelMs:tw()-e}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){mW([t],"where");const e=this.readSync(t.dataId);return gW(t.shape,e)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}function vW(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}yW.nextDataId=0;const xW={kernelName:ay,backendName:"cpu",kernelFunc:t=>{const{x:e}=t.inputs,n=t.backend;mW(e,"abs");let r=new Float32Array(mg(e.shape));return r=vW(n.data.get(e.dataId).values),n.makeOutput(r,e.shape,e.dtype)}};function bW(t){return(e,n,r,i,s)=>{const a=iE(e,n),o=a.length,l=Vg(a),h=Cg(s,mg(a)),u=e.length,c=n.length,d=Vg(e),p=Vg(n),f=nE(e,a),m=nE(n,a);if(f.length+m.length===0)for(let e=0;e<h.length;++e)h[e]=t(r[e%r.length],i[e%i.length]);else for(let e=0;e<h.length;++e){const n=Kg(e,o,l),s=n.slice(-u);f.forEach((t=>s[t]=0));const a=qg(s,u,d),g=n.slice(-c);m.forEach((t=>g[t]=0));const y=qg(g,c,p);h[e]=t(r[a],i[y])}return[h,a]}}function wW(t){const{inputs:e,backend:n}=t,{real:r,imag:i}=e,s=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,o=n.makeTensorInfo(r.shape,"complex64");return n.data.get(o.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",s),imag:n.makeTensorInfo(i.shape,"float32",a)},o}const _W={kernelName:Oy,backendName:"cpu",kernelFunc:wW};function TW(t,e,n="float32"){if("complex64"===n){return wW({inputs:{real:TW(t,e,"float32"),imag:TW(t,e,"float32")},backend:t})}const r=Hg(mg(e),n);return t.makeTensorInfo(e,n,r)}function EW(t){const{inputs:e,backend:n}=t,{x:r}=e;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const SW={kernelName:_v,backendName:"cpu",kernelFunc:EW};function IW(t){const{inputs:e,backend:n}=t,{input:r}=e,i=n.data.get(r.dataId).complexTensorInfos.real,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}const kW={kernelName:bx,backendName:"cpu",kernelFunc:IW};function CW(t,e,n,r){if("int32"===r){return[e,"int32",Int32Array.from(t)]}if("bool"===r){const r=Qb([0],n),[i,s]=bW(((t,e)=>t!==e?1:0))(e,[],t,r,"bool");return[s,"bool",i]}throw new Error(`Error in Cast: failed to cast ${n} to ${r}`)}function NW(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dtype:s}=r;if("complex64"===s){if("complex64"===i.dtype)return EW({inputs:{x:i},backend:n});const t=TW(n,i.shape,i.dtype),e=NW({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),r=wW({inputs:{real:e,imag:t},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),r}if("complex64"===i.dtype){const t=IW({inputs:{input:i},backend:n}),e=NW({inputs:{x:t},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(t),e}if(!Mg(i.dtype,s)){const t=EW({inputs:{x:i},backend:n});return{dataId:t.dataId,shape:t.shape,dtype:s}}const a=n.data.get(i.dataId).values,[o,l,h]=CW(a,i.shape,i.dtype,s);return n.makeTensorInfo(o,l,h)}const AW={kernelName:Ay,backendName:"cpu",kernelFunc:NW};function RW(t,e,n,r){return null==n?({inputs:n,backend:i})=>{const{a:s,b:a}=n,o=i;mW([s,a],t);const l=o.data.get(s.dataId).values,h=o.data.get(a.dataId).values,u="string"===s.dtype?WR(l):l,c="string"===s.dtype?WR(h):h,d=r||s.dtype,[p,f]=e(s.shape,a.shape,u,c,d);return o.makeTensorInfo(f,d,p)}:({inputs:t,backend:i})=>{const{a:s,b:a}=t,o=i;if("complex64"===s.dtype||"complex64"===a.dtype){const t=NW({inputs:{x:s},backend:o,attrs:{dtype:"complex64"}}),e=o.data.get(t.dataId),r=e.complexTensorInfos.real,i=e.complexTensorInfos.imag,l=o.data.get(r.dataId).values,h=o.data.get(i.dataId).values,u=NW({inputs:{x:a},backend:o,attrs:{dtype:"complex64"}}),c=o.data.get(u.dataId),d=c.complexTensorInfos.real,p=c.complexTensorInfos.imag,f=o.data.get(d.dataId).values,m=o.data.get(p.dataId).values,[g,y,v]=n(s.shape,a.shape,l,h,f,m),x=o.makeTensorInfo(v,"float32",g),b=o.makeTensorInfo(v,"float32",y),w=wW({inputs:{real:x,imag:b},backend:o});return o.disposeIntermediateTensorInfo(t),o.disposeIntermediateTensorInfo(u),o.disposeIntermediateTensorInfo(x),o.disposeIntermediateTensorInfo(b),w}{const t=o.data.get(s.dataId).values,n=o.data.get(a.dataId).values,i=r||s.dtype,[l,h]=e(s.shape,a.shape,t,n,i);return o.makeTensorInfo(h,i,l)}}}function MW(t){return(e,n,r,i,s,a)=>{const o=iE(e,n),l=mg(o),h=o.length,u=Vg(o),c=Cg("float32",l),d=Cg("float32",l),p=nE(e,o),f=nE(n,o),m=dR(r,i),g=dR(s,a),y=e.length,v=Vg(e),x=n.length,b=Vg(n);if(p.length+f.length===0)for(let e=0;e<c.length;e++){const n=e%m.length,r=e%g.length,i=t(m[2*n],m[2*n+1],g[2*r],g[2*r+1]);c[e]=i.real,d[e]=i.imag}else for(let e=0;e<c.length;e++){const n=Kg(e,h,u),r=n.slice(-y);p.forEach((t=>r[t]=0));const i=qg(r,y,v),s=n.slice(-x);f.forEach((t=>s[t]=0));const a=qg(s,x,b),o=t(m[2*i],m[2*i+1],g[2*a],g[2*a+1]);c[e]=o.real,d[e]=o.imag}return[c,d,o]}}const OW=bW(((t,e)=>t+e)),PW=MW(((t,e,n,r)=>({real:t+n,imag:e+r}))),DW=RW(hy,OW,PW),FW={kernelName:hy,backendName:"cpu",kernelFunc:DW};function LW(t,e,n,r,i){const s=mg(r),a=Hg(i,n);for(let n=0;n<t.length;n++){const r=t[n];if(r<0)throw new Error("Input x must be non-negative!");r>=i||(a[r]+=s>0?e[n]:1)}return a}function BW(t,e,n,r=!1){const i=t.shape[0],s=t.shape[1],a=nT([i,n],e.dtype);for(let o=0;o<i;o++)for(let i=0;i<s;i++){const s=t.get(o,i);if(s<0)throw new Error("Input x must be non-negative!");s>=n||(r?a.set(1,o,s):e.size>0?a.set(a.get(o,s)+e.get(o,i),o,s):a.set(a.get(o,s)+1,o,s))}return a}const $W=bW(((t,e)=>t&e)),UW=RW(ky,$W),VW={kernelName:ky,backendName:"cpu",kernelFunc:UW};function zW(t){return(e,n,r)=>{const i=Ng(n,e.length);for(let n=0;n<e.length;++n)i[n]=t(e[n],r);return i}}function GW(t,e,n){return WW(t,zW(e),n)}function WW(t,e,n){return({inputs:r,attrs:i,backend:s})=>{const{x:a}=r;mW(a,t);const o=s,l=o.data.get(a.dataId).values;let h;if("string"===a.dtype){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");h=WR(l)}else h=l;const u=n||a.dtype,c=e(h,u,i);return o.makeTensorInfo(a.shape,u,c)}}const XW=zW((t=>Math.ceil(t))),HW=WW(Ry,XW),YW={kernelName:Ry,backendName:"cpu",kernelFunc:HW};function jW(t,e,n,r){const i=Ng(n,mg(e));if(r&&"string"!==n){let e=0;t.forEach((t=>{const n=mg(t.shape);i.set(t.vals,e),e+=n}))}else{let r=0;t.forEach((t=>{const s="string"===n?WR(t.vals):t.vals;let a=0;for(let n=0;n<t.shape[0];++n){const o=n*e[1]+r;for(let e=0;e<t.shape[1];++e)i[o+e]=s[a++]}r+=t.shape[1]}))}return i}const qW=bW(((t,e)=>t===e?1:0)),KW=RW(lv,qW,null,"bool"),ZW={kernelName:lv,backendName:"cpu",kernelFunc:KW},JW=zW((t=>Math.exp(t))),QW=WW(hv,JW,"float32"),tX={kernelName:hv,backendName:"cpu",kernelFunc:QW},eX=zW((t=>Math.expm1(t))),nX=WW(cv,eX),rX={kernelName:cv,backendName:"cpu",kernelFunc:nX},iX=zW((t=>Math.floor(t))),sX=WW(mv,iX),aX={kernelName:mv,backendName:"cpu",kernelFunc:sX},oX=bW(((t,e)=>Math.floor(t/e))),lX=RW(gv,oX,null,"int32"),hX={kernelName:gv,backendName:"cpu",kernelFunc:lX};function uX(t,e,n,r,i,s,a,o,l){const h=nT([r,s],n);for(let n=0;n<r;n++){const r=[];let u=0;for(let e=0;e<i;e++){const s=t[n*i+e];u+=s*a[e],r.push(s)}if(u<0||u>=l/s)throw new Error(`Invalid indices: ${r} does not index into ${o}`);for(let t=0;t<s;t++)h.values[n*s+t]=e.get(...e.indexToLoc(u*s+t))}return h}function cX(t,e,n){const r=nT(n,t.dtype);for(let n=0;n<r.size;++n){const i=r.indexToLoc(n).slice(),s=i[0],a=i[2],o=e.locToIndex([s,a]);i[2]=e.values[o];const l=t.locToIndex(i);0<=l&&l<t.values.length&&(r.values[n]=t.values[l])}return r}const dX=bW(((t,e)=>t>e?1:0)),pX=RW(bv,dX,null,"bool"),fX={kernelName:bv,backendName:"cpu",kernelFunc:pX},mX=bW(((t,e)=>t>=e?1:0)),gX=RW(wv,mX,null,"bool"),yX={kernelName:wv,backendName:"cpu",kernelFunc:gX},vX=bW(((t,e)=>t<e?1:0)),xX=RW(Nv,vX,null,"bool"),bX={kernelName:Nv,backendName:"cpu",kernelFunc:xX},wX=bW(((t,e)=>t<=e?1:0)),_X=RW(Av,wX,null,"bool"),TX={kernelName:Av,backendName:"cpu",kernelFunc:_X};function EX(t,e,n){const r=(e-t)/(n-1),i=Hg(n,"float32");i[0]=t;for(let t=1;t<i.length;t++)i[t]=i[t-1]+r;return i}const SX=zW((t=>Math.log(t))),IX=WW(Mv,SX),kX={kernelName:Mv,backendName:"cpu",kernelFunc:IX};function CX(t,e,n,r){const i=Cg(r,mg(n));for(let n=0;n<i.length;++n){const r=n*e;let s=t[r];for(let n=0;n<e;++n){const e=t[r+n];(Number.isNaN(e)||e>s)&&(s=e)}i[n]=s}return i}const NX=bW(((t,e)=>Math.max(t,e))),AX=RW(Wv,NX),RX={kernelName:Wv,backendName:"cpu",kernelFunc:AX},MX=bW(((t,e)=>Math.min(t,e))),OX=RW(Jv,MX),PX={kernelName:Jv,backendName:"cpu",kernelFunc:OX},DX=bW(((t,e)=>t*e)),FX=MW(((t,e,n,r)=>({real:t*n-e*r,imag:t*r+e*n}))),LX=RW(nx,DX,FX),BX={kernelName:nx,backendName:"cpu",kernelFunc:LX};function $X(t,e,n){const r=Jb(-1,n);return DX([],e,r,t,n)}const UX={kernelName:rx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e;mW(r,"neg");const i=n.data.get(r.dataId).values,[s,a]=$X(i,r.shape,r.dtype);return n.makeTensorInfo(a,r.dtype,s)}},VX=bW(((t,e)=>t!==e?1:0)),zX=RW(ix,VX,null,"bool"),GX={kernelName:ix,backendName:"cpu",kernelFunc:zX};function WX(t,e,n,r,i){const s=e.length,a=mg(e),o=Vg(e),l=Vg(i),h=Cg(n,mg(i));for(let e=0;e<a;++e){const n=Kg(e,s,o),i=new Array(n.length);for(let t=0;t<i.length;t++)i[t]=n[r[t]];h[qg(i,s,l)]=t[e]}return h}function XX(t){const{inputs:e,attrs:n,backend:r}=t,{x:i}=e,{perm:s}=n;mW(i,"transpose");const a=i.shape.length,o=new Array(a);for(let t=0;t<o.length;t++)o[t]=i.shape[s[t]];const l=WX(r.data.get(i.dataId).values,i.shape,i.dtype,s,o);return{dataId:r.write(l,o,i.dtype),shape:o,dtype:i.dtype}}const HX={kernelName:db,backendName:"cpu",kernelFunc:XX};function YX(t,e,n,r){const[i,s]=JI(t,r),a=kw(e,"int32"),o=Hg(mg(i),a),l=mg(s);for(let t=0;t<o.length;++t){const e=t*l;let r=1;for(let t=0;t<l;++t)r*=n[e+t];o[t]=r}return{outVals:o,outShape:i,outDtype:a}}const jX={kernelName:mx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:a}=r;mW(i,"prod");const o=i.shape.length,l=Ig(s,i.shape),h=ek(l,o);let u=l,c=i;const d=[];null!=h&&(c=XX({inputs:{x:i},backend:n,attrs:{perm:h}}),d.push(c),u=rk(u.length,o));const p=n.data.get(c.dataId).values,{outVals:f,outShape:m,outDtype:g}=YX(c.shape,c.dtype,p,u);let y=m;return a&&(y=QI(m,l)),d.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(y,g,f)}};function qX(t,e,n,r){const i=[];let s=0;const a=e.length-1+n.length,o=new Array(a).fill(null).map((()=>[0]));!function(t,e){for(let n=0;n<t.length;++n){const r=t[n],i=n===t.length-1?e:t[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>i)throw new Error("Ragged splits must not point past values");for(let t=1;t<r.length;++t)if(r[t-1]>r[t])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);let l=1;for(let t=0;t<e.length-1;++t){l*=e[t];const n=e[t+1];for(let e=1;e<l+1;++e)o[t].push(e*n)}for(let r=0;r<t.length;++r){let a=t[r],l=t[r]+1;for(let t=0;t<n.length;++t){const r=n[t],i=t+e.length-1;if(i>=0){const t=o[i],e=t[t.length-1]-r[a];for(let t=a;t<l;++t)o[i].push(r[t+1]+e)}a=r[a],l=r[l]}l!==a&&(i.push([a,l]),s+=l-a)}return{outSplits:o,valueSlices:i,numValues:s}}function KX(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let r=e;r<t.length;r++)n[e-1]*=t[r];return n}function ZX(t,e,n,r,i){const s=e.slice();s[0]=i;const a=Ng(n,mg(s)),o=t.length;return function(t,e,n,r,i,s){const a=KX(e,2)[1],o=KX(s,2)[1];let l=0;for(const e of n)for(let n=e[0];n<e[1];++n){for(let e=0;e<r;++e)i[l*o+e]=t[n*a+e];++l}}(t,e,r,0===o?0:o/e[0],a,s),[a,s]}function JX(t,e,n,r,i,s,a,o){if(0===t.length)throw new Error("paramsNestedSplits must be non empty");if(0===e[0].length)throw new Error("Split tensors must not be scalars");if(function(t,e,n){t.forEach(((t,r)=>{if(t<0||t>=n){const i=Kg(r,e.length,Vg(e)).join(",");throw new Error(`indices[${i}] = ${t} is not in [0, ${n})`)}}))}(s,a,e[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");const l=r[0],{outSplits:h,valueSlices:u,numValues:c}=qX(s,a,t,l),d=function(t){const e=[];for(let n=0;n<t.length;++n){const r=Ng("int32",t[n].length);e.push(r),t[n].forEach(((t,e)=>r[e]=t))}return e}(h),p=ZX(n,r,i,u,c);return[d,p[0],p[1]]}const QX=2147483647;function tH(t,e,n,r,i,s,a){if(e.length>1)throw new Error("starts must be a scalar or vector");if(i.length>1)throw new Error("limits must be a scalar or vector");if(a.length>1)throw new Error("deltas must be a scalar or vector");const o=0===e.length,l=0===i.length,h=0===a.length,u=[];o||u.push(e[0]),l||u.push(i[0]),h||u.push(a[0]);for(let t=1;t<u.length;++t)if(u[t]!==u[t-1])throw new Error("starts, limits, and deltas must have the same shape");const c=0===u.length?1:u[0],d=Ng("int32",c+1);d[0]=0;for(let e=0;e<c;++e){const n=o?t[0]:t[e],i=l?r[0]:r[e],a=h?s[0]:s[e];if(0===a)throw new Error("Requires delta != 0");let u;if(a>0&&i<n||a<0&&i>n)u=0;else if(u=Math.ceil(Math.abs((i-n)/a)),u>QX)throw new Error("Requires ((limit - start) / delta) <= 2147483647");d[e+1]=d[e]+u}const p=Ng(n,d[c]);let f=0;for(let e=0;e<c;++e){const n=d[e+1]-d[e];let r=o?t[0]:t[e];const i=h?s[0]:s[e];for(let t=0;t<n;++t)p[f++]=r,r+=i}return[d,p]}var eH=XA;class nH{constructor(t,e,n,r,i,s,a,o,l,h){this.shape=t,this.shapeShape=e,this.values=n,this.valuesShape=r,this.valuesDType=i,this.defaultValue=s,this.defaultValueShape=a,this.rowPartitionValues=o,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=YA(h),this.raggedRank=jA(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===eH.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===eH.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){const e=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case eH.VALUE_ROWIDS:return nH.getMaxWidthValueRowID(e);case eH.ROW_SPLITS:return nH.getMaxWidthRowSplit(e);default:throw new Error(`Cannot handle partition type ${eH[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){const e=t.length;if(0===e||1===e)return 0;let n=0;for(let r=0;r<e-1;++r){const e=t[r+1]-t[r];e>n&&(n=e)}return n}static getMaxWidthValueRowID(t){const e=t.length;if(0===e)return 0;let n=0,r=t[0],i=0;for(let s=1;s<e;++s){const e=t[s];e!==r&&(r=e,i=Math.max(s-n,i),n=s)}return Math.max(e-n,i)}tensorShapeFromTensor(t,e,n=!0){if(0===e.length){if(-1===t[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return iH(t,n)}calculateOutputSize(t){const e=this.valuesShape;qA(this.defaultValueShape,e);const n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=HA(this.raggedRank,n,e);r[0]<0&&(r[0]=t);for(let t=1;t<=this.raggedRank;++t)r[t]<0&&(r[t]=this.getMaxWidth(t));return r}calculateFirstParentOutputIndex(t,e,n){const r=Math.min(t,n),i=[];let s=0;for(let t=0;t<r;++t,s+=e)i.push(s);for(let e=r;e<t;++e)i.push(-1);return dg(i.length===t,(()=>"Final length of result must be equal to firstDimension.")),i}calculateOutputIndexRowSplit(t,e,n,r){const i=t.length,s=[];for(let a=0;a<i-1;++a){const i=t[a+1]-t[a];let o=Math.min(r,i),l=e[a];-1===l&&(o=0);for(let t=0;t<o;++t)s.push(l),l+=n;for(let t=0;t<i-o;++t)s.push(-1)}if(i>0&&s.length!==t[i-1])throw new Error("Invalid row split size.");return s}calculateOutputIndexValueRowID(t,e,n,r){const i=t.length,s=[];if(0===i)return[];let a=0,o=t[0];if(o>=e.length)throw new Error(`Got currentValueRowId=${o}, which is not less than ${e.length}`);let l=e[o];s.push(l);for(let h=1;h<i;++h){const i=t[h];if(i===o)l>=0&&(++a,a<r?l+=n:l=-1);else{if(a=0,o=i,i>=e.length)throw new Error(`Got nextValueRowId=${i} which is not less than ${e.length}`);l=e[i]}s.push(l)}if(s.length!==t.length)throw new Error("Invalid row ids.");return s}calculateOutputIndex(t,e,n,r){const i=this.getRowPartitionTensor(t),s=this.getRowPartitionTypeByDimension(t);switch(s){case eH.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,e,n,r);case eH.ROW_SPLITS:if(i.length-1>e.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${e.length}`);return this.calculateOutputIndexRowSplit(i,e,n,r);default:throw new Error(`Unsupported partition type: ${eH[s]}`)}}getFirstDimensionSize(){const t=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");const e=this.rowPartitionTypes[0];switch(e){case eH.FIRST_DIM_SIZE:return t[0];case eH.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case eH.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${eH[e]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),e=this.calculateOutputSize(t),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(let t=n.length-2;t>=0;--t)n[t]=n[t+1]*e[t+1];const r=iH(e,!1),i=Ng(this.valuesDType,mg(r));if(n[0]*e[0]>0){let s=this.calculateFirstParentOutputIndex(t,n[0],e[0]);for(let t=1;t<=this.raggedRank;++t){s=this.calculateOutputIndex(t-1,s,n[t],e[t])}this.setOutput(this.raggedRank,s,i,r)}return[r,i]}setOutput(t,e,n,r){if(0===n.length)return;const i=this.values,s=n;let a=r.slice();a=a.slice(t+1);const o=mg(a),l=e.length;let h=this.defaultValue;if(h.length!==o&&1!==h.length){const t=this.defaultValueShape;fT((()=>{const e=rI(h,t),n=xI(e,a);h=n.dataSync()}))}let u=0,c=0,d=0;for(let t=0;t<=l;++t){let r=t<l?e[t]:-1;if(r!==d){if(c<d){const t=i.subarray(u*o);rH(s.subarray(c*o),t,(d-c)*o)}if(t>=l){const t=n.length;r=Math.floor(t/o)}if(r>d)if(1===this.defaultValue.length)s.subarray(d*o,r*o).fill(this.defaultValue[0]),d=r;else for(;r>d;){rH(s.slice(d*o),h,o),++d}r<0?(u=t+1,c=d):(u=t,c=d,d=c+1)}else++d}}}function rH(t,e,n){for(let r=0;r<n;r++)t[r]=e[r]}function iH(t,e){const n=[];for(let r of t){if(r<0){if(!e)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function sH(t,e,n,r,i,s,a,o,l,h){return new nH(t,e,n,r,i,s,a,o,l,h).compute()}function aH(t,e,n,r){if(t===e||t<e&&n<0||e<t&&n>1)return Hg(0,r);const i=Hg(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),i[0]=t;for(let t=1;t<i.length;t++)i[t]=i[t-1]+n;return i}const oH=zW((t=>1/Math.sqrt(t))),lH=WW(Rx,oH),hH={kernelName:Rx,backendName:"cpu",kernelFunc:lH};function uH(t,e,n,r,i,s,a,o,l,h){const u=[r/i,i],c=t.values,d=e.values;if(0===r)return nT(n,e.dtype);const p=l instanceof fw?l:nT(u,e.dtype);"string"==typeof l||"number"==typeof l?p.values.fill(l):"boolean"==typeof l&&p.values.fill(+l);for(let t=0;t<s;t++){const s=[];let l=0;for(let e=0;e<a;e++){const n=c[t*a+e];s.push(n),l+=n*o[e]}if(l<0||l>=r/i)throw new Error(`Invalid indices: ${s} does not index into ${n}`);for(let n=0;n<i;n++)h?p.values[l*i+n]+=d[t*i+n]:p.values[l*i+n]=0===e.rank?d[0]:d[t*i+n]}return p}const cH=zW((t=>1/(1+Math.exp(-t)))),dH=GW(Vx,(t=>1/(1+Math.exp(-t)))),pH={kernelName:Vx,backendName:"cpu",kernelFunc:dH};function fH(t,e,n,r,i){const s=uS(r,e,n),a=mg(n),o=Vg(r);if(s){const n=cS(e,o);return"string"===i?t.slice(n,n+a):t.subarray(n,n+a)}const l=nT(r,i,"string"===i?WR(t):t),h=nT(n,i);for(let t=0;t<h.size;++t){const n=h.indexToLoc(t),r=n.map(((t,n)=>t+e[n]));h.set(l.get(...r),...n)}return"string"===i?XR(h.values):h.values}function mH(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,size:a}=r;mW(i,"slice");const[o,l]=dS(i,s,a);JE(i,o,l);const h=fH(n.data.get(i.dataId).values,o,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,h)}const gH={kernelName:Lx,backendName:"cpu",kernelFunc:mH};function yH(t,e,n,r,i,s,a){const o=e[0],l=s[0],h=new Array(l),u=new Array(o),c=e[1];if(0===l){if(0!==o)throw new Error(NR(o));return[Ng(n,0),[0,c],Ng(i,0),h,u]}let d=!0,p=0;const f=new Array(l).fill(0);for(let e=0;e<o;++e){const n=t[e*c];if(n<0)throw new Error(AR(e,n));if(n>=l)throw new Error(RR(e,n,l));++f[n],d=d&&n>=p,p=n}let m=!0;for(let t=0;t<l;++t){const e=0===f[t];h[t]=e,m=m&&!e,f[t]=Math.max(f[t],1),t>0&&(f[t]+=f[t-1])}if(m&&d){const e=t,n=r;for(let t=0;t<o;++t)u[t]=t;return[e,[o,c],n,h,u]}{const e=f[l-1],s=Ng(n,e*c),d=Ng(i,e),p=new Array(l).fill(0);for(let e=0;e<o;++e){const n=t[e*c],i=p[n],a=(0===n?0:f[n-1])+i;p[n]++;for(let n=0;n<c;++n)s[a*c+n]=t[e*c+n];d[a]=r[e],u[e]=a}for(let t=0;t<l;++t){if(0===p[t]){const e=0===t?0:f[t-1];s[e*c+0]=t;for(let t=1;t<c;++t)s[e*c+t]=0;d[e]=a}}return[s,[e,c],d,h,u]}}function vH(t,e,n,r,i){const s=mg(r),a=e[0],o=i.length,l=[];let h=1,u=-1;for(let t=0;t<o;++t){const e=i[t];if(-1===e){if(-1!==u)throw new Error(MR(u,t));u=t,l.push(1)}else{if(e<0)throw new Error(OR(t,e));h*=e,l.push(e)}}if(-1!==u){if(h<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");const t=Math.trunc(s/h);if(h*t!==s)throw new Error(DR(r,l));l[u]=t}if(mg(l)!==s)throw new Error(FR(r,l));const c=r.length,d=[];if(c>0){d[c-1]=1;for(let t=c-2;t>=0;--t)d[t]=d[t+1]*r[t+1]}const p=[];if(o>0){p[o-1]=1;for(let t=o-2;t>=0;--t)p[t]=p[t+1]*l[t+1]}const f=Ng(n,a*o);for(let e=0;e<a;++e){let n=0;for(let r=0;r<c;++r)n+=t[e*c+r]*d[r];for(let t=0;t<o;++t)f[e*o+t]=Math.trunc(n/p[t]),n%=p[t]}return[f,[a,o],l]}function xH(t,e,n,r,i,s=!1,a=0){const o=r.length,l=[e[0],t.length/e[0]],h=l[1],u=o>0?i[o-1]+1:0;if(u<0)throw new Error("segment ids must be >= 0");const c=e.slice();c[0]=u;const d=Ng(n,c.reduce(((t,e)=>t*e),1));if(0===o)return u>0&&d.fill(a),[d,c];if(u<=0)throw new Error("segment ids must be >= 0");let p=0,f=1,m=0,g=i[p];for(;;){let e=0;if(f<o){if(e=i[f],g===e){++f;continue}if(g>=e)throw new Error("segment ids are not increasing")}if(g<0||g>=u)throw new Error($R(g,u));g>m&&d.fill(a,m*h,g*h);for(let e=p;e<f;++e){const n=r[e];if(n<0||n>=l[0])throw new Error(UR(e,r[e],l[0]));for(let e=0;e<h;e++)d[g*h+e]+=t[n*h+e]}if(s)for(let t=0;t<h;t++)d[g*h+t]/=f-p;if(p=f,++f,m=g+1,g=e,f>o)break}return m<u&&d.fill(a,m*h,u*h),[d,c]}const bH=zW((t=>Math.sqrt(t))),wH=GW(Gx,(t=>Math.sqrt(t))),_H={kernelName:Gx,backendName:"cpu",kernelFunc:wH},TH=bW(((t,e)=>{const n=t-e;return n*n})),EH=RW(Qx,TH),SH={kernelName:Qx,backendName:"cpu",kernelFunc:EH},IH=zW(((t,e)=>{const{pattern:n,replaceGlobal:r,rewrite:i}=e;return t.replace(new RegExp(n,r?"g":""),i)})),kH=WW(eb,IH),CH={kernelName:eb,backendName:"cpu",kernelFunc:kH};function NH(t,e,n,r){const i=nT(t,e.dtype);for(let t=0;t<i.size;t++){const s=i.indexToLoc(t),a=new Array(s.length);for(let t=0;t<a.length;t++)a[t]=s[t]*n[t]+r[t];i.set(e.get(...a),...s)}return i}class AH{constructor(t,e,n,r,i,s){this.separator=nw(t),this.nGramWidths=e,this.leftPad=nw(n),this.rightPad=nw(r),this.padWidth=i,this.preserveShort=s}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,e){const n=this.getPadWidth(e);return Math.max(0,t+2*n-e+1)}createNGrams(t,e,n,r,i,s){for(let a=0;a<i;++a){const o=this.getPadWidth(s),l=Math.max(0,o-a),h=Math.max(0,o-(i-(a+1))),u=s-(l+h),c=e+(l>0?0:a-o);let d=0;d+=l*this.leftPad.length;for(let e=0;e<u;++e)d+=t[c+e].length;d+=h*this.rightPad.length;d+=(l+h+u-1)*this.separator.length,n[r+a]=new Uint8Array(d);const p=n[r+a];let f=0;const m=t=>t.forEach((t=>p[f++]=t));for(let t=0;t<l;++t)m(this.leftPad),m(this.separator);for(let e=0;e<u-1;++e)m(t[c+e]),m(this.separator);if(u>0){m(t[c+u-1]);for(let t=0;t<h;++t)m(this.separator),m(this.rightPad)}else{for(let t=0;t<h-1;++t)m(this.rightPad),m(this.separator);m(this.rightPad)}}}compute(t,e){const n=t.length,r=e.length;if(r>0){let t=e[0];if(0!==t)throw new Error(`First split value must be 0, got ${t}`);for(let i=1;i<r;++i){let r=e[i]>=t;if(r=r&&e[i]<=n,!r)throw new Error(`Invalid split value ${e[i]}, must be in [${t}, ${n}]`);t=e[i]}if(t!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${t}`)}const i=r-1,s=Ng("int32",r);if(0===n||0===r){const t=new Array(n);for(let t=0;t<=i;++t)s[t]=0;return[t,s]}s[0]=0;for(let t=1;t<=i;++t){const n=e[t]-e[t-1];let r=0;this.nGramWidths.forEach((t=>{r+=this.getNumNGrams(n,t)})),this.preserveShort&&n>0&&0===r&&(r=1),s[t]=s[t-1]+r}const a=new Array(s[i]);for(let n=0;n<i;++n){const r=e[n];let i=s[n];if(this.nGramWidths.forEach((s=>{const o=e[n+1]-e[n],l=this.getNumNGrams(o,s);this.createNGrams(t,r,a,i,l,s),i+=l})),this.preserveShort&&i===s[n]){const s=e[n+1]-e[n];if(0===s)continue;const o=s+2*this.padWidth,l=1;this.createNGrams(t,r,a,i,l,o)}}return[a,s]}}function RH(t,e,n,r,i,s,a,o){return new AH(n,r,i,s,a,o).compute(t,e)}function MH(t,e,n,r){if(!t.length)return;if(0===e.length){for(let e=0;e<t.length;++e)r.push(t.subarray(e,e+1));return}if(1===e.length){const i=e[0];let s=t.indexOf(i);for(;-1!==s;){const e=t.subarray(0,s);n&&0===e.length||r.push(e),s=(t=t.subarray(s+1)).indexOf(i)}return void(n&&0===t.length||r.push(t))}let i=0;for(let s=0;s<t.length+1;s++)if(s===t.length||-1!==e.indexOf(t[s])){const e=t.subarray(i,s);n&&0===e.length||r.push(e),i=s+1}}function OH(t,e,n){const r=t.length,i=[];let s=0,a=0;const o=new Array(r);for(let l=0;l<r;++l){const r=i.length;MH(t[l],e,n,i);const h=i.length-r;o[l]=h,s+=h,a=Math.max(a,h)}const l=Ng("int32",2*s),h=new Array(s),u=[r,a];let c=0;for(let t=0;t<r;++t)for(let e=0;e<o[t];++e)l[2*c]=t,l[2*c+1]=e,h[c]=i[c],++c;return[l,h,u]}function PH(t,e){const n=Ng("int32",t.length);for(let r=0;r<t.length;++r)n[r]=Zb(t[r]).modulo(e).getLowBitsUnsigned();return n}const DH=bW(((t,e)=>t-e)),FH=MW(((t,e,n,r)=>({real:t-n,imag:e-r}))),LH=RW(ab,DH,FH),BH={kernelName:ab,backendName:"cpu",kernelFunc:LH};function $H(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const r=nT(n,t.dtype);for(let e=0;e<r.values.length;++e){const n=r.indexToLoc(e),i=new Array(t.rank);for(let e=0;e<i.length;e++)i[e]=n[e]%t.shape[e];const s=t.locToIndex(i);r.values[e]=t.values[s]}return r}const UH=(t,e)=>{const n=e.value-t.value;return 0===n?t.index-e.index:n};function VH(t,e,n=0,r=t.length-1){for(;r>n;){if(r-n>600){const i=r-n+1,s=e-n+1,a=Math.log(i),o=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*o*(i-o)/i)*Math.sign(s-i/2);VH(t,e,Math.max(n,Math.floor(e-s*o/i+l)),Math.min(r,Math.floor(e+(i-s)*o/i+l)))}const i=t[e];let s=n,a=r;for(lg(t,n,e),UH(t[r],i)>0&&lg(t,n,r);s<a;){for(lg(t,s,a),s++,a--;UH(t[s],i)<0;)s+=1;for(;UH(t[a],i)>0;)a-=1}0===UH(t[n],i)?lg(t,n,a):(a+=1,lg(t,a,r)),a<=e&&(n=a+1),e<=a&&(r=a-1)}}function zH(t,e,n,r,i){const s=e[e.length-1],[a,o]=[t.length/s,s],l=Cg(n,a*r),h=Cg("int32",a*r);for(let e=0;e<a;e++){const n=e*o,s=t.subarray(n,n+o);let a=new Array(s.length);s.forEach(((t,e)=>a[e]={value:t,index:e})),r<a.length&&(VH(a,r),a=a.slice(0,r)),i&&a.sort(UH);const u=e*r,c=l.subarray(u,u+r),d=h.subarray(u,u+r);for(let t=0;t<r;t++)c[t]=a[t].value,d[t]=a[t].index}const u=e.slice();return u[u.length-1]=r,[nT(u,n,l),nT(u,"int32",h)]}function GH(t,e,n,r){const i=Ig(e,n)[0],s=[1,n[0],1];for(let t=0;t<i;t++)s[0]*=n[t];s[1]=n[i];for(let t=i+1;t<n.length;t++)s[2]*=n[t];const a=new Map,o=new Int32Array(n[i]),l=new fw(s,r,t),h=[],u=1===s[0]&&1===s[2];for(let e=0;e<n[i];e++){let n;if(u)n=t[e].toString();else{const t=[];for(let n=0;n<s[0];n++)for(let r=0;r<s[2];r++)t.push(l.get(n,e,r));n=t.join(",")}const r=a.get(n);if(null!=r)o[e]=r;else{const t=a.size;a.set(n,t),o[e]=t,h.push(e)}}const c=s.slice();c[1]=a.size;const d=new fw(c,r);h.forEach(((t,e)=>{for(let n=0;n<s[0];n++)for(let r=0;r<s[2];r++)d.set(l.get(n,t,r),n,e,r)}));const p=n.slice();return p[i]=c[1],{outputValues:d.values,outputShape:p,indices:o}}const WH="4.8.0";ET("cpu",(()=>new yW),1);const XH=GW(sv,(t=>t>=0?t:Math.exp(t)-1)),HH={kernelName:sv,backendName:"cpu",kernelFunc:XH};function YH(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{alpha:s}=r;mW([i],"leakyRelu");const a=mg(i.shape),o=n.data.get(i.dataId).values,l=Cg("float32",a);for(let t=0;t<o.length;t++)l[t]=o[t]<0?s*o[t]:o[t];return n.makeTensorInfo(i.shape,"float32",l)}const jH={kernelName:Cv,backendName:"cpu",kernelFunc:YH},qH=bW(((t,e)=>t<0?e*t:t));function KH(t){const{inputs:e,backend:n}=t,{x:r,alpha:i}=e;mW([r,i],"prelu");const s=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,[o,l]=qH(r.shape,i.shape,s,a,"float32");return n.makeTensorInfo(l,"float32",o)}const ZH={kernelName:fx,backendName:"cpu",kernelFunc:KH},JH=GW(_x,(t=>Math.max(0,t))),QH={kernelName:_x,backendName:"cpu",kernelFunc:JH},tY=GW(Cx,(t=>Math.min(Math.max(0,t),6))),eY={kernelName:Cx,backendName:"cpu",kernelFunc:tY};function nY(t,e,n,r,i){if("linear"===n)return EW({inputs:{x:e},backend:t});if("relu"===n)return JH({inputs:{x:e},backend:t});if("elu"===n)return XH({inputs:{x:e},backend:t});if("relu6"===n)return tY({inputs:{x:e},backend:t});if("prelu"===n)return KH({inputs:{x:e,alpha:r},backend:t});if("leakyrelu"===n)return YH({inputs:{x:e},backend:t,attrs:{alpha:i}});if("sigmoid"===n)return dH({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}function rY(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{shape:s}=r,a=mg(i.shape),o=Sg(s,a),l=mg(o);dg(a===l,(()=>`The new shape (${o}) has ${l} elements and the old shape (${i.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`)),n.incRef(i.dataId);const h=n.data.get(i.dataId);if(null!=h.complexTensorInfos){const t=h.complexTensorInfos.real,e=h.complexTensorInfos.imag;t.shape=o,e.shape=o}return{dataId:i.dataId,shape:o,dtype:i.dtype}}const iY={kernelName:Tx,backendName:"cpu",kernelFunc:rY};function sY(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s}=e,{transposeA:a,transposeB:o}=r;mW([i,s],"matMul");const l=i.shape.length,h=s.shape.length,u=a?i.shape[l-2]:i.shape[l-1],c=o?s.shape[h-1]:s.shape[h-2],d=a?i.shape[l-1]:i.shape[l-2],p=o?s.shape[h-2]:s.shape[h-1],f=i.shape.slice(0,-2),m=s.shape.slice(0,-2),g=mg(f),y=mg(m),v=iE(i.shape.slice(0,-2),s.shape.slice(0,-2)).concat([d,p]);dg(u===c,(()=>`Error in matMul: inner shapes (${u}) and (${c}) of Tensors with shapes ${i.shape} and ${s.shape} and transposeA=${a} and transposeB=${o} must match.`));const x=o?[y,p,c]:[y,c,p],b=rY({inputs:{x:i},backend:n,attrs:{shape:a?[g,u,d]:[g,d,u]}}),w=rY({inputs:{x:s},backend:n,attrs:{shape:x}}),_=a?b.shape[1]:b.shape[2],T=a?b.shape[2]:b.shape[1],E=o?w.shape[1]:w.shape[2],S=Math.max(g,y),I=n.data.get(b.dataId).values,k=n.data.get(w.dataId).values,C=Vg(b.shape),N=Vg(w.shape),[A,R,M]=a?[C[0],1,C[1]]:[C[0],C[1],1],[O,P,D]=o?[1,N[1],N[0]]:[N[1],1,N[0]],F=T*E,L=nT([S,T,E],b.dtype),B=L.values,$=n.blockSize;for(let t=0;t<S;t++){const e=t%g,n=t%y;for(let r=0;r<T;r+=$){const i=Math.min(r+$,T);for(let s=0;s<E;s+=$){const a=Math.min(s+$,E);for(let o=0;o<_;o+=$){const l=Math.min(o+$,_);for(let h=r;h<i;h++)for(let r=s;r<a;r++){let i=0;for(let t=o;t<l;t++){i+=I[e*A+h*R+t*M]*k[t*O+r*P+n*D]}B[t*F+(h*E+r)]+=i}}}}}return n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(w),n.makeTensorInfo(v,L.dtype,L.values)}const aY={kernelName:Ey,backendName:"cpu",kernelFunc:sY};const oY={kernelName:wb,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s,bias:a,preluActivationWeights:o}=e,{transposeA:l,transposeB:h,activation:u,leakyreluAlpha:c}=r;let d,p,f;const m=[];d=sY({inputs:{a:i,b:s},attrs:{transposeA:l,transposeB:h},backend:n}),a&&(p=DW({inputs:{a:d,b:a},backend:n}),m.push(d),d=p),u&&(f=nY(n,d,u,o,c),m.push(d),d=f);for(const t of m)n.disposeIntermediateTensorInfo(t);return d}},lY=GW(oy,(t=>Math.acos(t))),hY={kernelName:oy,backendName:"cpu",kernelFunc:lY},uY=GW(ly,(t=>Math.acosh(t))),cY={kernelName:ly,backendName:"cpu",kernelFunc:uY};const dY={kernelName:uy,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,r=e;mW(e,"addN");const i=r.map((t=>n.data.get(t.dataId).values)),s=nT(r[0].shape,r[0].dtype),a=s.values;for(let t=0;t<r.length;t++){const e=i[t];for(let t=0;t<a.length;t++)a[t]+=e[t]}return n.makeTensorInfo(s.shape,s.dtype,s.values)}};const pY={kernelName:cy,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:a}=r;mW(i,"all");const o=Ig(s,i.shape);let l=o;const h=ek(l,i.shape.length);let u=i;null!=h&&(u=XX({inputs:{x:i},backend:n,attrs:{perm:h}}),l=rk(l.length,i.shape.length)),tk("all",l,u.shape.length);const[c,d]=JI(u.shape,l),p=mg(d),f=Hg(mg(c),u.dtype),m=n.data.get(u.dataId).values;for(let t=0;t<f.length;++t){const e=t*p;let n=m[e];for(let t=0;t<p;++t){const r=m[e+t];n=n&&r}f[t]=n}null!=h&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(c,u.dtype,f);if(a){const t=rY({inputs:{x:g},backend:n,attrs:{shape:QI(c,o)}});return n.disposeIntermediateTensorInfo(g),t}return g}};const fY={kernelName:dy,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:a}=r;mW(i,"any");const o=Ig(s,i.shape);let l=o;const h=ek(l,i.shape.length);let u=i;null!=h&&(u=XX({inputs:{x:i},backend:n,attrs:{perm:h}}),l=rk(l.length,i.shape.length)),tk("any",l,u.shape.length);const[c,d]=JI(u.shape,l),p=mg(d),f=Hg(mg(c),u.dtype),m=n.data.get(u.dataId).values;for(let t=0;t<f.length;++t){const e=t*p;let n=m[e];for(let t=0;t<p;++t){const r=m[e+t];n=n||r}f[t]=n}null!=h&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(c,u.dtype,f);if(a){const t=rY({inputs:{x:g},backend:n,attrs:{shape:QI(c,o)}});return n.disposeIntermediateTensorInfo(g),t}return g}};const mY={kernelName:py,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;mW(i,"argMax");let a=Ig(s,i.shape);const o=ek(a,i.shape.length);let l=i;const h=[];null!=o&&(l=XX({inputs:{x:i},backend:n,attrs:{perm:o}}),h.push(l),a=rk(a.length,l.shape.length)),a=[a[0]],tk("argMax",a,l.shape.length);const[u,c]=JI(l.shape,a),d=Hg(mg(u),"int32"),p=mg(c),f=n.data.get(l.dataId).values;for(let t=0;t<d.length;++t){const e=t*p;let n=f[e],r=0;for(let t=0;t<p;++t){const i=f[e+t];i>n&&(n=i,r=t)}d[t]=r}return h.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(u,"int32",d)}};const gY={kernelName:fy,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;mW(i,"argMin");let a=Ig(s,i.shape);const o=ek(a,i.shape.length);let l=i;const h=[];null!=o&&(l=XX({inputs:{x:i},backend:n,attrs:{perm:o}}),h.push(l),a=rk(a.length,l.shape.length)),a=[a[0]],tk("argMin",a,l.shape.length);const[u,c]=JI(l.shape,a),d=Hg(mg(u),"int32"),p=mg(c),f=n.data.get(l.dataId).values;for(let t=0;t<d.length;++t){const e=t*p;let n=f[e],r=0;for(let t=0;t<p;++t){const i=f[e+t];i<n&&(n=i,r=t)}d[t]=r}return h.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(u,"int32",d)}},yY=GW(my,(t=>Math.asin(t))),vY={kernelName:my,backendName:"cpu",kernelFunc:yY},xY=GW(gy,(t=>Math.asinh(t))),bY={kernelName:gy,backendName:"cpu",kernelFunc:xY},wY=GW(yy,(t=>Math.atan(t))),_Y={kernelName:yy,backendName:"cpu",kernelFunc:wY},TY=bW(((t,e)=>Math.atan2(t,e))),EY=RW(xy,TY),SY={kernelName:xy,backendName:"cpu",kernelFunc:EY},IY=GW(vy,(t=>Math.atanh(t))),kY={kernelName:vy,backendName:"cpu",kernelFunc:IY};function CY(t,e,n,r,i,s){const a=i.strideHeight,o=i.strideWidth,l=i.dilationHeight,h=i.dilationWidth,u=i.effectiveFilterHeight,c=i.effectiveFilterWidth,d=i.padInfo.top,p=i.padInfo.left,f="max"===s?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=nT(i.outShape,n),g=m.values,y=i.outShape[1]*i.outShape[2]*i.outShape[3],v=i.outShape[2]*i.outShape[3],x=i.outShape[3];for(let e=0;e<i.batchSize;++e){const n=e*y,m=e*r[0];for(let e=0;e<i.inChannels;++e)for(let y=0;y<i.outHeight;++y){const b=y*a-d,w=Math.max(0,b),_=Math.min(i.inHeight,u+b),T=n+y*v;for(let n=0;n<i.outWidth;++n){const a=n*o-p,u=Math.max(0,a),d=Math.min(i.inWidth,c+a);let y=f,v=0,b=0;for(let n=w;n<_;n+=l){const i=m+n*r[1];for(let n=u;n<d;n+=h){const a=t[i+n*r[2]+e];"max"===s&&a>y?y=a:"avg"===s&&(v+=a,b++)}if(isNaN(y))break}g[T+n*x+e]="avg"===s?v/b:y}}}return m}function NY(t,e,n,r,i=!1,s=!1){const a=nT(r.outShape,"int32"),o=r.strideHeight,l=r.strideWidth,h=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,f=r.padInfo.left,m=nT(e,n,t);for(let t=0;t<r.batchSize;++t)for(let e=0;e<r.inChannels;++e)for(let n=0;n<r.outHeight;++n){const g=n*o-p;let y=g;for(;y<0;)y+=h;const v=Math.min(r.inHeight,c+g);for(let o=0;o<r.outWidth;++o){const c=o*l-f;let p=c;for(;p<0;)p+=u;const x=Math.min(r.inWidth,d+c);let b=Number.NEGATIVE_INFINITY,w=-1;for(let n=y;n<v;n+=h){const a=n-g;for(let o=p;o<x;o+=u){const l=o-c,h=m.get(t,n,o,e);h>b&&(b=h,w=i?s?((t*r.inHeight+n)*r.inWidth+o)*r.inChannels+e:(n*r.inWidth+o)*r.inChannels+e:a*d+l)}}a.set(w,t,n,o,e)}}return a}function AY(t,e,n,r,i,s){const a=i.strideDepth,o=i.strideHeight,l=i.strideWidth,h=i.dilationDepth,u=i.dilationHeight,c=i.dilationWidth,d=i.effectiveFilterDepth,p=i.effectiveFilterHeight,f=i.effectiveFilterWidth,m=i.padInfo.front,g=i.padInfo.top,y=i.padInfo.left,v="max"===s?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=nT(i.outShape,n),b=x.values,w=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],_=i.outShape[2]*i.outShape[3]*i.outShape[4],T=i.outShape[3]*i.outShape[4],E=i.outShape[4];for(let e=0;e<i.batchSize;++e){const n=e*w,x=e*r[0];for(let e=0;e<i.inChannels;++e)for(let w=0;w<i.outDepth;++w){const S=w*a-m;let I=S;for(;I<0;)I+=h;const k=Math.min(i.inDepth,d+S),C=n+w*_;for(let n=0;n<i.outHeight;++n){const a=n*o-g;let d=a;for(;d<0;)d+=u;const m=Math.min(i.inHeight,p+a),w=C+n*T;for(let n=0;n<i.outWidth;++n){const a=n*l-y;let o=a;for(;o<0;)o+=c;const p=Math.min(i.inWidth,f+a),g=w+n*E;let _=v,T=0,S=0;for(let n=I;n<k;n+=h){const i=x+n*r[1];for(let n=d;n<m;n+=u){const a=i+n*r[2];for(let n=o;n<p;n+=c){const i=t[a+n*r[3]+e];if("max"===s&&i>_?_=i:"avg"===s&&(T+=i,S++),isNaN(_))break}if(isNaN(_))break}if(isNaN(_))break}b[g+e]="avg"===s?T/Math.max(S,1):_}}}}return x}const RY={kernelName:by,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;mW(i,"avgPool");const{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=r;dg(QS(a,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${a} and dilations '1'`));const h=GS(i.shape,s,a,1,o,l);let u;if(1===h.filterWidth&&1===h.filterHeight&&vg(h.inShape,h.outShape))u=EW({inputs:{x:i},backend:n});else{const t=n.data.get(i.dataId).values,e=Vg(i.shape),r=CY(t,i.shape,i.dtype,e,h,"avg");u=n.makeTensorInfo(h.outShape,i.dtype,r.values)}return u}};const MY={kernelName:_y,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:a,pad:o,dimRoundingMode:l,dataFormat:h}=r;mW(i,"avgPool3d");const u=WS(i.shape,s,a,1,o,l,h),c=AY(n.data.get(i.dataId).values,i.shape,i.dtype,Vg(i.shape),u,"avg");return n.makeTensorInfo(c.shape,"float32",c.values)}};const OY={kernelName:Ty,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,{filterSize:a,strides:o,pad:l,dimRoundingMode:h}=r;mW([i,s],"avgPool3DGrad");const u=WS(s.shape,a,o,1,l,h),c=u.strideDepth,d=u.strideHeight,p=u.strideWidth,f=u.filterDepth,m=u.filterHeight,g=u.filterWidth,y=u.dilationDepth,v=u.dilationHeight,x=u.dilationWidth,b=u.effectiveFilterDepth,w=u.effectiveFilterHeight,_=u.effectiveFilterWidth,T=b-1-u.padInfo.front,E=_-1-u.padInfo.left,S=w-1-u.padInfo.top,I=nT(s.shape,"float32"),k=1/(f*m*g),C=n.bufferSync(i);for(let t=0;t<u.batchSize;++t)for(let e=0;e<u.inChannels;++e)for(let n=0;n<u.inDepth;++n)for(let r=0;r<u.inHeight;++r)for(let i=0;i<u.inWidth;++i){const s=n-T,a=r-S,o=i-E;let l=0;for(let n=0;n<b;n+=y){const r=(s+n)/c;if(!(r<0||r>=u.outDepth||Math.floor(r)!==r))for(let n=0;n<w;n+=v){const i=(a+n)/d;if(!(i<0||i>=u.outHeight||Math.floor(i)!==i))for(let n=0;n<_;n+=x){const s=(o+n)/p;if(s<0||s>=u.outWidth||Math.floor(s)!==s)continue;l+=C.get(t,r,i,s,e)}}}I.set(l*k,t,n,r,i,e)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}};const PY={kernelName:wy,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,a=s;mW([i,s],"avgPoolGrad");const{filterSize:o,strides:l,pad:h}=r,u=GS(a.shape,o,l,1,h),c=u.strideHeight,d=u.strideWidth,p=u.filterHeight,f=u.filterWidth,m=u.dilationHeight,g=u.dilationWidth,y=u.effectiveFilterHeight,v=u.effectiveFilterWidth,x=v-1-u.padInfo.left,b=y-1-u.padInfo.top,w=nT(a.shape,"float32"),_=1/(p*f),T=n.data.get(i.dataId).values,E=nT(i.shape,"float32",T);for(let t=0;t<u.batchSize;++t)for(let e=0;e<u.inChannels;++e)for(let n=0;n<u.inHeight;++n)for(let r=0;r<u.inWidth;++r){const i=n-b,s=r-x;let a=0;for(let n=0;n<y;n+=m){const r=(i+n)/c;if(!(r<0||r>=u.outHeight||Math.floor(r)!==r))for(let n=0;n<v;n+=g){const i=(s+n)/d;if(i<0||i>=u.outWidth||Math.floor(i)!==i)continue;a+=E.get(t,r,i,e)}}w.set(a*_,t,n,r,e)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};const DY={kernelName:yv,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,scale:s,offset:a,mean:o,variance:l}=e;dg(o.shape.length===l.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),dg(null==a||o.shape.length===a.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),dg(null==s||o.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks.")),mW([i,o,l,s,a],"batchNorm");let{varianceEpsilon:h}=r;null==h&&(h=.001);const u=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values,d=n.data.get(l.dataId).values,p=s?n.data.get(s.dataId).values:new Float32Array([1]),f=a?n.data.get(a.dataId).values:new Float32Array([0]),m=new Float32Array(u.length),g=f.length,y=p.length,v=d.length,x=c.length;let b=0,w=0,_=0,T=0;for(let t=0;t<u.length;++t)m[t]=f[b++]+(u[t]-c[w++])*p[_++]/Math.sqrt(d[T++]+h),b>=g&&(b=0),w>=x&&(w=0),_>=y&&(_=0),T>=v&&(T=0);return n.makeTensorInfo(i.shape,i.dtype,m)}};const FY={kernelName:Sy,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,crops:a}=r;mW([i],"batchToSpaceND");const o=s.reduce(((t,e)=>t*e)),l=QA(i.shape,s,o),h=tR(l.length,s.length),u=eR(i.shape,s,o),c=nR(a,s.length),d=rR(u,a,s.length),p=rY({inputs:{x:i},backend:n,attrs:{shape:l}}),f=XX({inputs:{x:p},backend:n,attrs:{perm:h}}),m=rY({inputs:{x:f},backend:n,attrs:{shape:u}}),g=mH({inputs:{x:m},backend:n,attrs:{begin:c,size:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}};const LY={kernelName:Iy,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:a}=r,o=LW(n.data.get(i.dataId).values,n.data.get(s.dataId).values,s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,o)}};const BY={kernelName:Ny,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{s0:r,s1:i}=e,s=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,o=iE(Array.from(s),Array.from(a));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}},$Y=GW(My,((t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t})),UY={kernelName:My,backendName:"cpu",kernelFunc:$Y},VY={kernelName:Py,backendName:"cpu",kernelFunc:t=>{const{x:e}=t.inputs,n=t.backend,r=new Float32Array(mg(e.shape)),i=n.data.get(e.dataId),s=i.complexTensorInfos.real,a=i.complexTensorInfos.imag,o=n.data.get(s.dataId).values,l=n.data.get(a.dataId).values;for(let t=0;t<o.length;t++){const e=o[t],n=l[t];r[t]=Math.hypot(e,n)}return n.makeOutput(r,e.shape,"float32")}};function zY(t){const{inputs:e,backend:n}=t,{input:r}=e,i=n.data.get(r.dataId).complexTensorInfos.imag,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}const GY={kernelName:Ev,backendName:"cpu",kernelFunc:zY};function WY(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r,s=Ig(i,e[0].shape)[0];GA(e.map((t=>t.shape)),s);let a=WA(e.map((t=>t.shape)),s);if(0===mg(a))return n.makeTensorInfo(a,e[0].dtype,[]);const o=e.filter((t=>mg(t.shape)>0));if(1===o.length)return EW({inputs:{x:o[0]},backend:n});if("complex64"===o[0].dtype){const t=o.map((t=>IW({inputs:{input:t},backend:n}))),e=o.map((t=>zY({inputs:{input:t},backend:n}))),r=WY({inputs:t,backend:n,attrs:{axis:s}}),i=WY({inputs:e,backend:n,attrs:{axis:s}}),a=wW({inputs:{real:r,imag:i},backend:n});return t.forEach((t=>n.disposeIntermediateTensorInfo(t))),e.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),a}const l=o.map((t=>{const e=mg(t.shape.slice(s));return rY({inputs:{x:t},backend:n,attrs:{shape:[-1,e]}})})),h=l.map((t=>({vals:n.data.get(t.dataId).values,shape:t.shape})));a=WA(l.map((t=>t.shape)),1);const u=1===l[0].shape[0],c=jW(h,a,e[0].dtype,u),d=WA(o.map((t=>t.shape)),s),p=n.makeTensorInfo(d,e[0].dtype,c);return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),p}const XY={kernelName:Dy,backendName:"cpu",kernelFunc:WY};function HY(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:a,pad:o,dataFormat:l,dilations:h,dimRoundingMode:u}=r;mW([i,s],"conv2d");const c=eI(l),d=XS(i.shape,s.shape,a,h,o,u,!1,c),p=d.filterHeight,f=d.filterWidth,m=d.dilationHeight,g=d.dilationWidth,y=d.padInfo.left,v=d.padInfo.top,x="channelsLast"===d.dataFormat,b=new fw(d.outShape,i.dtype),w=Vg(i.shape),_=Vg(s.shape),T=w[0],E=x?w[1]:w[2],S=x?w[2]:1,I=x?1:w[1],k=b.strides[0],C=x?b.strides[1]:b.strides[2],N=x?b.strides[2]:1,A=x?1:b.strides[1],R=n.data.get(i.dataId).values,M=n.data.get(s.dataId).values,O=b.values;for(let t=0;t<d.batchSize;++t){const e=t*T,n=t*k;for(let t=0;t<d.outHeight;++t){const r=n+t*C,i=t*d.strideHeight-v;for(let t=0;t<p;++t){const n=i+t*m;if(n<0||n>=d.inHeight)continue;const s=t*_[0],a=e+n*E;for(let t=0;t<d.outWidth;++t){const e=r+t*N,n=t*d.strideWidth-y;for(let t=0;t<f;++t){const r=n+t*g;if(r<0||r>=d.inWidth)continue;const i=a+r*S;let o=s+t*_[1];for(let t=0;t<d.inChannels;++t){const n=R[i+t*I];for(let t=0;t<d.outChannels;++t)O[e+t*A]+=n*M[o+t];o+=d.outChannels}}}}}}return n.makeTensorInfo(b.shape,b.dtype,O)}const YY={kernelName:Fy,backendName:"cpu",kernelFunc:HY};const jY={kernelName:Ly,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:a,pad:o,dataFormat:l,dimRoundingMode:h,filterShape:u}=r;mW([i,s],"conv2dBackpropFilter");const c=eI(l),d=XS(i.shape,u,a,1,o,h,!1,c),{strideHeight:p,strideWidth:f,filterHeight:m,filterWidth:g}=d,y="channelsLast"===d.dataFormat,v=new fw(d.filterShape,"float32"),x=d.padInfo.left,b=d.padInfo.top,w=n.data.get(i.dataId).values,_=n.data.get(s.dataId).values,T=new fw(i.shape,i.dtype,w),E=new fw(s.shape,s.dtype,_);for(let t=0;t<m;++t){const e=Math.max(0,Math.ceil((b-t)/p)),n=Math.min(d.outHeight,(d.inHeight+b-t)/p);for(let r=0;r<g;++r){const i=Math.max(0,Math.ceil((x-r)/f)),s=Math.min(d.outWidth,(d.inWidth+x-r)/f);for(let a=0;a<d.inChannels;++a)for(let o=0;o<d.outChannels;++o){let l=0;for(let h=0;h<d.batchSize;++h)for(let u=e;u<n;++u){const e=t+u*p-b;for(let t=i;t<s;++t){const n=r+t*f-x;l+=y?T.get(h,e,n,a)*E.get(h,u,t,o):T.get(h,a,e,n)*E.get(h,o,u,t)}}v.set(l,t,r,a,o)}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};const qY={kernelName:By,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{inputShape:a,strides:o,pad:l,dataFormat:h,dimRoundingMode:u}=r;mW([i,s],"conv2dBackpropInput");const c=Vg(s.shape),d=Vg(i.shape);let p=eI(h);const f=XS(a,s.shape,o,1,l,u,!1,p),m=new fw(f.inShape,"float32"),g=m.values,y=n.data.get(i.dataId).values,v=n.data.get(s.dataId).values,[x,b,w]=c,{batchSize:_,filterHeight:T,filterWidth:E,inChannels:S,inHeight:I,inWidth:k,outChannels:C,outHeight:N,outWidth:A,strideHeight:R,strideWidth:M}=f;p=f.dataFormat;const O=T-1-f.padInfo.top,P=E-1-f.padInfo.left,D="channelsLast"===p,F=m.strides[0],L=D?m.strides[1]:m.strides[2],B=D?m.strides[2]:1,$=D?1:m.strides[1],U=d[0],V=D?d[1]:d[2],z=D?d[2]:1,G=D?1:d[1];for(let t=0;t<_;++t)for(let e=0;e<S;++e)for(let n=0;n<I;++n){const r=n-O,i=Math.max(0,Math.ceil(r/R)),s=Math.min(N,(T+r)/R);for(let a=0;a<k;++a){const o=a-P,l=Math.max(0,Math.ceil(o/M)),h=Math.min(A,(E+o)/M);let u=0;for(let n=i;n<s;++n){const i=n*R-r;for(let r=l;r<h;++r){const s=U*t+V*n+z*r,a=x*(T-1-i)+b*(E-1-(r*M-o))+w*e;for(let t=0;t<C;++t){u+=y[s+G*t]*v[a+t]}}}g[F*t+L*n+B*a+$*e]=u}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};const KY={kernelName:$y,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:a,pad:o,dilations:l}=r;mW([i,s],"conv3d");const h=HS(i.shape,s.shape,a,l,o),{filterDepth:u,filterHeight:c,filterWidth:d,dilationDepth:p,dilationHeight:f,dilationWidth:m,padInfo:g}=h,y=g.front,v=g.left,x=g.top,b=new fw(h.outShape,i.dtype),w=n.data.get(i.dataId).values,_=n.data.get(s.dataId).values,T=b.values,E=Vg(i.shape),S=Vg(s.shape);for(let t=0;t<h.batchSize;++t){const e=t*E[0],n=t*b.strides[0];for(let t=0;t<h.outDepth;++t){const r=n+t*b.strides[1],i=t*h.strideDepth-y;for(let t=0;t<u;++t){const n=i+t*p;if(n<0||n>=h.inDepth)continue;const s=t*S[0],a=e+n*E[1];for(let t=0;t<h.outHeight;++t){const e=r+t*b.strides[2],n=t*h.strideHeight-x;for(let t=0;t<c;++t){const r=n+t*f;if(r<0||r>=h.inHeight)continue;const i=s+t*S[1],o=a+r*E[2];for(let t=0;t<h.outWidth;++t){const n=e+t*h.outChannels,r=t*h.strideWidth-v;for(let t=0;t<d;++t){const e=r+t*m;if(e<0||e>=h.inWidth)continue;const s=i+t*S[2],a=o+e*h.inChannels;let l=s;for(let t=0;t<h.inChannels;++t){const e=w[a+t];for(let t=0;t<h.outChannels;++t)T[n+t]+=e*_[l+t];l+=h.outChannels}}}}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};const ZY={kernelName:Uy,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:a,pad:o,filterShape:l}=r;mW([i,s],"conv3dBackpropFilterV2");const h=Vg(i.shape),u=Vg(s.shape),c=HS(i.shape,l,a,1,o),d=c.strideDepth,p=c.strideHeight,f=c.strideWidth,m=c.filterDepth,g=c.filterHeight,y=c.filterWidth,v=new fw(c.filterShape,"float32"),x=v.values,[b,w,_,T]=v.strides,E=n.data.get(s.dataId).values,[S,I,k,C]=u,N=n.data.get(i.dataId).values,[A,R,M,O]=h,P=c.padInfo.front,D=c.padInfo.left,F=c.padInfo.top;for(let t=0;t<m;++t){const e=Math.max(0,Math.ceil((P-t)/d)),n=Math.min(c.outDepth,(c.inDepth+P-t)/d),r=t*b;for(let i=0;i<g;++i){const s=Math.max(0,Math.ceil((F-i)/p)),a=Math.min(c.outHeight,(c.inHeight+F-i)/p),o=i*w+r;for(let r=0;r<y;++r){const l=Math.max(0,Math.ceil((D-r)/f)),h=Math.min(c.outWidth,(c.inWidth+D-r)/f),u=r*_+o;for(let o=0;o<c.inChannels;++o){const m=o*T+u;for(let u=0;u<c.outChannels;++u){let g=0;for(let m=0;m<c.batchSize;++m){const c=m*A,y=m*S;for(let m=e;m<n;++m){const e=(t+m*d-P)*R+c,n=m*I+y;for(let t=s;t<a;++t){const s=(i+t*p-F)*M+e,a=t*k+n;for(let t=l;t<h;++t){const e=t*C+a;g+=N[(r+t*f-D)*O+s+o]*E[e+u]}}}}x[m+u]=g}}}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};const JY={kernelName:Vy,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{pad:a,strides:o,inputShape:l}=r;mW([i],"conv3dBackpropInputV2");const h=Vg(i.shape),u=Vg(s.shape),c=HS(l,s.shape,o,1,a),d=new fw(c.inShape,"float32"),p=d.values,[f,m,g,y]=d.strides,v=n.data.get(i.dataId).values,[x,b,w,_]=h,T=n.data.get(s.dataId).values,[E,S,I,k]=u,{batchSize:C,filterDepth:N,filterHeight:A,filterWidth:R,inChannels:M,inDepth:O,inHeight:P,inWidth:D,outChannels:F,outDepth:L,outHeight:B,outWidth:$,strideDepth:U,strideHeight:V,strideWidth:z}=c,G=N-1-c.padInfo.front,W=A-1-c.padInfo.top,X=R-1-c.padInfo.left;for(let t=0;t<C;++t)for(let e=0;e<M;++e)for(let n=0;n<O;++n){const r=n-G,i=Math.max(0,Math.ceil(r/U)),s=Math.min(L,(N+r)/U);for(let a=0;a<P;++a){const o=a-W,l=Math.max(0,Math.ceil(o/V)),h=Math.min(B,(A+o)/V);for(let u=0;u<D;++u){const c=u-X,d=Math.max(0,Math.ceil(c/z)),C=Math.min($,(R+c)/z);let M=0;for(let n=i;n<s;++n){const i=n*U-r;for(let r=l;r<h;++r){const s=r*V-o;for(let a=d;a<C;++a){const o=x*t+b*n+w*r+_*a,l=E*(N-1-i)+S*(A-1-s)+I*(R-1-(a*z-c))+k*e;for(let t=0;t<F;++t){M+=v[o+t]*T[l+t]}}}}p[f*t+m*n+g*a+y*u+e]=M}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},QY=GW(zy,(t=>Math.cos(t))),tj={kernelName:zy,backendName:"cpu",kernelFunc:QY},ej=GW(Gy,(t=>Math.cosh(t))),nj={kernelName:Gy,backendName:"cpu",kernelFunc:ej};const rj={kernelName:Hy,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{image:i,boxes:s,boxInd:a}=e,{cropSize:o,method:l,extrapolationValue:h}=r,[u,c,d,p]=i.shape,f=s.shape[0],[m,g]=o,y=nT([f,m,g,p],"float32"),v=n.data.get(s.dataId).values,x=n.data.get(a.dataId).values,b=n.data.get(i.dataId).values,w=Vg(i.shape),_=Vg(y.shape);for(let t=0;t<f;t++){const e=4*t,n=v[e],r=v[e+1],i=v[e+2],s=v[e+3],a=x[t];if(a>=u)continue;const o=m>1?(i-n)*(c-1)/(m-1):0,f=g>1?(s-r)*(d-1)/(g-1):0;for(let e=0;e<m;e++){const u=m>1?n*(c-1)+e*o:.5*(n+i)*(c-1);if(u<0||u>c-1)for(let n=0;n<g;n++)for(let r=0;r<p;r++){const i=r+n*_[2]+e*_[1]+t*_[0];y.values[i]=h}else if("bilinear"===l){const n=Math.floor(u),i=Math.ceil(u),o=u-n;for(let l=0;l<g;l++){const u=g>1?r*(d-1)+l*f:.5*(r+s)*(d-1);if(u<0||u>d-1){for(let n=0;n<p;n++){const r=n+l*_[2]+e*_[1]+t*_[0];y.values[r]=h}continue}const c=Math.floor(u),m=Math.ceil(u),v=u-c;for(let r=0;r<p;r++){let s=r+c*w[2]+n*w[1]+a*w[0];const h=b[s];s=r+m*w[2]+n*w[1]+a*w[0];const u=b[s];s=r+c*w[2]+i*w[1]+a*w[0];const d=b[s];s=r+m*w[2]+i*w[1]+a*w[0];const p=h+(u-h)*v,f=d+(b[s]-d)*v;s=r+l*_[2]+e*_[1]+t*_[0],y.values[s]=p+(f-p)*o}}}else for(let n=0;n<g;++n){const i=g>1?r*(d-1)+n*f:.5*(r+s)*(d-1);if(i<0||i>d-1){for(let r=0;r<p;r++){const i=r+n*_[2]+e*_[1]+t*_[0];y.values[i]=h}continue}const o=Math.round(i),l=Math.round(u);for(let r=0;r<p;r++){const i=r+o*w[2]+l*w[1]+a*w[0],s=r+n*_[2]+e*_[1]+t*_[0];y.values[s]=b[i]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};const ij={kernelName:Wy,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:a,reverse:o}=r;mW(i,"cumprod");const l=ek([s],i.shape.length);let h=i;null!=l&&(h=XX({inputs:{x:i},backend:n,attrs:{perm:l}}));const u=rk(1,i.shape.length)[0];if(u!==h.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${h.shape.length-1} but got axis=${u}`);const c=kw(h.dtype,"int32"),d=Xg(mg(h.shape),c),p=n.data.get(h.dataId).values,f=h.shape[h.shape.length-1],m=o?(t,e)=>t+f-e-1:(t,e)=>t+e;for(let t=0;t<p.length;t+=f)for(let e=0;e<f;e++){const n=m(t,e);if(0===e)d[n]=a?1:p[n];else{const r=m(t,e-1);d[n]=a?p[r]*d[r]:p[n]*d[r]}}const g=n.makeTensorInfo(h.shape,c,d);if(null!=l){const t=XX({inputs:{x:g},backend:n,attrs:{perm:nk(l)}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(h),t}return g}};const sj={kernelName:Xy,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:a,reverse:o}=r;mW(i,"cumsum");const l=ek([s],i.shape.length);let h=i;null!=l&&(h=XX({inputs:{x:i},backend:n,attrs:{perm:l}}));const u=rk(1,i.shape.length)[0];if(u!==h.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${h.shape.length-1} but got axis=${u}`);const c=kw(h.dtype,"int32"),d=Hg(mg(h.shape),c),p=n.data.get(h.dataId).values,f=h.shape[h.shape.length-1],m=o?(t,e)=>t+f-e-1:(t,e)=>t+e;for(let t=0;t<p.length;t+=f)for(let e=0;e<f;e++){const n=m(t,e);if(0===e)d[n]=a?0:p[n];else{const r=m(t,e-1);d[n]=a?p[r]+d[r]:p[n]+d[r]}}const g=n.makeTensorInfo(h.shape,c,d);if(null!=l){const t=XX({inputs:{x:g},backend:n,attrs:{perm:nk(l)}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(h),t}return g}};const aj={kernelName:Yy,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:a,binaryOutput:o}=r;if(1===i.shape.length){const t=LW(n.data.get(i.dataId).values,n.data.get(s.dataId).values,s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,t)}if(2===i.shape.length){const t=BW(n.bufferSync(i),n.bufferSync(s),a,o);return n.makeTensorInfo(t.shape,s.dtype,t.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}};const oj={kernelName:jy,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockSize:s,dataFormat:a}=r;dg("NHWC"===a,(()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${a}`));const o=i.shape[0],l=i.shape[1],h=i.shape[2],u=i.shape[3],c=l*s,d=h*s,p=u/(s*s),f=n.data.get(i.dataId).values,m=new Float32Array(o*c*d*p);let g=0;for(let t=0;t<o;++t)for(let e=0;e<c;++e){const n=Math.floor(e/s),r=e%s;for(let e=0;e<d;++e){const i=Math.floor(e/s),a=(r*s+e%s)*p;for(let e=0;e<p;++e){const r=e+a+u*(i+h*(n+l*t));m[g++]=f[r]}}}return n.makeTensorInfo([o,c,d,p],i.dtype,m)}};function lj(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:a,pad:o,dilations:l,dimRoundingMode:h}=r;mW([i,s],"depthwiseConv2DNative");const u=Vg(i.shape),c=Vg(s.shape);let d=l;null==d&&(d=[1,1]),dg(QS(a,d),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${a} and dilations '${d}'`));const p=XS(i.shape,s.shape,a,d,o,h,!0),{filterHeight:f,filterWidth:m,dilationHeight:g,dilationWidth:y,padInfo:v}=p,x=v.left,b=v.top,w=p.outChannels/p.inChannels,_=new fw(p.outShape,i.dtype),T=n.data.get(i.dataId).values,E=n.data.get(s.dataId).values,S=_.values;for(let t=0;t<p.batchSize;++t){const e=t*u[0],n=t*_.strides[0];for(let t=0;t<p.outHeight;++t){const r=n+t*_.strides[1],i=t*p.strideHeight-b;for(let t=0;t<f;++t){const n=i+t*g;if(n<0||n>=p.inHeight)continue;const s=t*c[0],a=e+n*u[1];for(let t=0;t<p.outWidth;++t){const e=r+t*_.strides[2],n=t*p.strideWidth-x;for(let t=0;t<m;++t){const r=n+t*y;if(r<0||r>=p.inWidth)continue;const i=s+t*c[1],o=a+r*p.inChannels;let l=e,h=i;for(let t=0;t<p.inChannels;++t){const e=T[o+t];for(let t=0;t<w;++t)S[l+t]+=e*E[h+t];l+=w,h+=w}}}}}}return n.makeTensorInfo(_.shape,_.dtype,_.values)}const hj={kernelName:qy,backendName:"cpu",kernelFunc:lj};const uj={kernelName:Ky,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:a,dilations:o,pad:l,dimRoundingMode:h,filterShape:u}=r;mW([i,s],"depthwiseConv2dNativeBackpropFilter");const c=XS(i.shape,u,a,o,l,h,!0),{strideHeight:d,strideWidth:p,filterHeight:f,filterWidth:m}=c,g=new fw(c.filterShape,"float32"),y=c.padInfo.left,v=c.padInfo.top,x=c.outChannels/c.inChannels,b=n.data.get(i.dataId).values,w=new fw(i.shape,i.dtype,b),_=n.data.get(s.dataId).values,T=new fw(s.shape,s.dtype,_);for(let t=0;t<f;++t){const e=Math.max(0,Math.ceil((v-t)/d)),n=Math.min(c.outHeight,(c.inHeight+v-t)/d);for(let r=0;r<m;++r){const i=Math.max(0,Math.ceil((y-r)/p)),s=Math.min(c.outWidth,(c.inWidth+y-r)/p);for(let a=0;a<c.outChannels;++a){const o=Math.trunc(a/x),l=a%x;let h=0;for(let l=0;l<c.batchSize;++l)for(let u=e;u<n;++u){const e=t+u*d-v;for(let t=i;t<s;++t){const n=r+t*p-y;h+=w.get(l,e,n,o)*T.get(l,u,t,a)}}g.set(h,t,r,o,l)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}};const cj={kernelName:Zy,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{strides:a,dilations:o,pad:l,dimRoundingMode:h,inputShape:u}=r;mW([i,s],"depthwiseConv2DNativeBackpropInput");const c=Vg(i.shape),d=Vg(s.shape),p=XS(u,s.shape,a,o,l,h,!0),f=new fw(p.inShape,"float32"),m=f.values,[g,y,v]=f.strides,x=n.data.get(i.dataId).values,[b,w,_]=c,T=n.data.get(s.dataId).values,[E,S,I]=d,{batchSize:k,filterHeight:C,filterWidth:N,inChannels:A,inHeight:R,inWidth:M,outChannels:O,outHeight:P,outWidth:D,strideHeight:F,strideWidth:L}=p,B=C-1-p.padInfo.top,$=N-1-p.padInfo.left,U=O/A;for(let t=0;t<k;++t)for(let e=0;e<A;++e)for(let n=0;n<R;++n){const r=n-B,i=Math.max(0,Math.ceil(r/F)),s=Math.min(P,(C+r)/F);for(let a=0;a<M;++a){const o=a-$,l=Math.max(0,Math.ceil(o/L)),h=Math.min(D,(N+o)/L);let u=0;for(let n=i;n<s;++n){const i=n*F-r;for(let r=l;r<h;++r){const s=b*t+w*n+_*r,a=E*(C-1-i)+S*(N-1-(r*L-o))+I*e;for(let t=0;t<U;++t){u+=x[s+(e*U+t)]*T[a+t]}}}m[g*t+y*n+v*a+e]=u}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}};const dj={kernelName:Jy,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e,i=mg(r.shape),s=n.data.get(r.dataId).values,a=nT([i,i],r.dtype),o=a.values;for(let t=0;t<s.length;t++)o[t*i+t]=s[t];const l=[...r.shape,...r.shape];return n.makeTensorInfo(l,a.dtype,a.values)}},pj={kernelName:Qy,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:i}=t,{strides:s,pad:a,dilations:o}=n,l=e,h=l.data.get(r.dataId).values,u=r.shape.length,c=l.data.get(i.dataId).values,d=i.shape.length,{batchSize:p,inHeight:f,inWidth:m,inChannels:g,outHeight:y,outWidth:v,padInfo:x,strideHeight:b,strideWidth:w,filterHeight:_,filterWidth:T,dilationHeight:E,dilationWidth:S,outShape:I}=zS(r.shape,i.shape,s,a,"NHWC",o),k=mg(I),C=I.length,N=Ng(r.dtype,k);for(let t=0;t<p;++t)for(let e=0;e<y;++e){const n=e*b-x.top;for(let s=0;s<v;++s){const a=s*w-x.left;for(let o=0;o<g;++o){let l=Number.MIN_SAFE_INTEGER;for(let e=0;e<_;++e){const s=n+e*E;if(s>=0&&s<f)for(let n=0;n<T;++n){const p=a+n*S;if(p>=0&&p<m){const a=qg([t,s,p,o],u,Vg(r.shape)),f=qg([e,n,o],d,Vg(i.shape)),m=h[a]+c[f];m>l&&(l=m)}}}N[qg([t,e,s,o],C,Vg(I))]=l}}}return{dataId:l.write(Qb(N,r.dtype),I,r.dtype),shape:I,dtype:r.dtype}}},fj={kernelName:ev,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:i,dy:s}=t,{strides:a,pad:o,dilations:l}=n,h=e,u=Gg(r.shape,h.data.get(r.dataId).values),c=Gg(i.shape,h.data.get(i.dataId).values),{batchSize:d,inHeight:p,inWidth:f,inChannels:m,outHeight:g,outWidth:y,padInfo:v,strideHeight:x,strideWidth:b,filterHeight:w,filterWidth:_,dilationHeight:T,dilationWidth:E,outShape:S}=zS(r.shape,i.shape,a,o,"NHWC",l);dg(s.rank===S.length,(()=>`Error in ${ev}, dy must have the same rank as output ${S.length}, but got ${s.rank}`));const I=Gg(S,h.data.get(s.dataId).values),k=Yg(i.shape,i.dtype);for(let t=0;t<d;++t)for(let e=0;e<g;++e){const n=e*x-v.top;for(let r=0;r<y;++r){const i=r*b-v.left;for(let s=0;s<m;++s){let a=Number.MIN_SAFE_INTEGER,o=0,l=0;for(let e=0;e<w;++e){const r=n+e*T;if(r>=0&&r<p)for(let n=0;n<_;++n){const h=i+n*E;if(h>=0&&h<f){const i=u[t][r][h][s]+c[e][n][s];i>a&&(a=i,o=e,l=n)}}}k[o][l][s]+=I[t][e][r][s]}}}return{dataId:h.write(Qb(k,r.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},mj={kernelName:tv,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,filter:i,dy:s}=t,{strides:a,pad:o,dilations:l}=n,h=e,u=Gg(r.shape,h.data.get(r.dataId).values),c=Gg(i.shape,h.data.get(i.dataId).values),{batchSize:d,inHeight:p,inWidth:f,inChannels:m,outHeight:g,outWidth:y,padInfo:v,strideHeight:x,strideWidth:b,filterHeight:w,filterWidth:_,dilationHeight:T,dilationWidth:E,outShape:S}=zS(r.shape,i.shape,a,o,"NHWC",l);dg(s.rank===S.length,(()=>`Error in ${tv}, dy must have the same rank as output ${S.length}, but got ${s.rank}`));const I=Gg(S,h.data.get(s.dataId).values),k=Yg(r.shape,r.dtype);for(let t=0;t<d;++t)for(let e=0;e<g;++e){const n=e*x-v.top;for(let r=0;r<y;++r){const i=r*b-v.left;for(let s=0;s<m;++s){let a=Number.MIN_SAFE_INTEGER,o=n<0?0:n,l=i<0?0:i;for(let e=0;e<w;++e){const r=n+e*T;if(r>=0&&r<p)for(let n=0;n<_;++n){const h=i+n*E;if(h>=0&&h<f){const i=u[t][r][h][s]+c[e][n][s];i>a&&(a=i,o=r,l=h)}}}k[t][o][l][s]+=I[t][e][r][s]}}}return{dataId:h.write(Qb(k,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};const gj={kernelName:nv,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{image:i}=e,{canvas:s,options:a}=r,{contextOptions:o,imageOptions:l}=a||{},h=(null==l?void 0:l.alpha)||1,u=(null==o?void 0:o.contextType)||"2d";if("2d"!==u)throw new Error(`Context type ${o.contextType} is not supported by the CPU backend.`);const c=s.getContext(u,(null==o?void 0:o.contextAttributes)||{});if(null==c)throw new Error(`Could not get the context with ${u} type.`);const[d,p]=i.shape.slice(0,2),f=2===i.shape.length?1:i.shape[2],m=n.data.get(i.dataId).values,g="float32"===i.dtype?255:1,y=new Uint8ClampedArray(p*d*4);for(let t=0;t<d*p;++t){const e=[0,0,0,255*h];for(let n=0;n<f;n++){const r=m[t*f+n];if("float32"===i.dtype){if(r<0||r>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${r}.`)}else if("int32"===i.dtype&&(r<0||r>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${r}.`);1===f?(e[0]=r*g,e[1]=r*g,e[2]=r*g):e[n]=r*g}const n=4*t;y[n+0]=Math.round(e[0]),y[n+1]=Math.round(e[1]),y[n+2]=Math.round(e[2]),y[n+3]=Math.round(e[3])}s.width=p,s.height=d;const v=new ImageData(y,p,d);return c.putImageData(v,0,0),i}};function yj(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:a}=r;let o;mW(i,"sum"),o="bool"===i.dtype?NW({inputs:{x:i},backend:n,attrs:{dtype:"int32"}}):EW({inputs:{x:i},backend:n});const l=o.shape.length,h=Ig(s,o.shape),u=ek(h,l);let c=h,d=o;null!=u&&(d=XX({inputs:{x:o},backend:n,attrs:{perm:u}}),c=rk(c.length,l)),tk("sum",c,d.shape.length);const[p,f]=JI(d.shape,c);let m=TW(n,p,kw(d.dtype,"int32"));const g=mg(f),y=n.data.get(m.dataId).values,v=n.data.get(d.dataId).values;for(let t=0;t<y.length;++t){const e=t*g;let n=0;for(let t=0;t<g;++t)n+=v[e+t];y[t]=n}if(a){const t=m;m=rY({inputs:{x:m},backend:n,attrs:{shape:QI(m.shape,h)}}),n.disposeIntermediateTensorInfo(t)}return n.disposeIntermediateTensorInfo(o),null!=u&&n.disposeIntermediateTensorInfo(d),m}const vj={kernelName:Wx,backendName:"cpu",kernelFunc:yj};const xj={kernelName:iv,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{equation:i}=r,s=e,{allDims:a,summedDims:o,idDims:l}=_R(i,s.length);ER(a.length,l,s);const{path:h,steps:u}=SR(o,l),c=u.length;let d=null,p=a.length;const f=[];for(let t=0;t<c;++t){for(const e of u[t]){const{permutationIndices:t,expandDims:r}=TR(p,l[e]);let i;IR(t)?i=s[e]:(i=XX({inputs:{x:s[e]},backend:n,attrs:{perm:t}}),f.push(i));const a=i.shape.slice();for(let t=0;t<r.length;++t)a.splice(r[t],0,1);vg(i.shape,a)||(i=rY({inputs:{x:i},backend:n,attrs:{shape:a}}),f.push(i)),null===d?d=i:(d=LX({inputs:{a:i,b:d},backend:n}),f.push(d))}t<c-1&&(h[t]>=0&&(d=yj({inputs:{x:d},backend:n,attrs:{axis:h[t]-(a.length-p),keepDims:!1}}),f.push(d)),p--)}for(const t of f)t!==d&&n.disposeIntermediateTensorInfo(t);return d}};const bj={kernelName:av,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{dy:r,y:i}=e;mW([r,i],"eluGrad");const s=new Float32Array(mg(i.shape)),a=n.data.get(i.dataId).values,o=n.data.get(r.dataId).values;for(let t=0;t<a.length;++t){const e=a[t];s[t]=e>=0?o[t]:o[t]*(e+1)}return n.makeTensorInfo(i.shape,"float32",s)}},wj=aR,_j=oR,Tj=lR,Ej=hR,Sj=uR,Ij=cR,kj=GW(ov,(t=>{const e=Math.sign(t),n=Math.abs(t),r=1/(1+wj*n);return e*(1-((((Ij*r+Sj)*r+Ej)*r+Tj)*r+_j)*r*Math.exp(-n*n))})),Cj={kernelName:ov,backendName:"cpu",kernelFunc:kj};function Nj(t){const{inputs:e,backend:n,attrs:r}=t,{input:i}=e,{dim:s}=r,a=i.shape.length,o=i.shape.slice();let l=s;return s<0&&(dg(-(a+1)<=s,(()=>`Axis must be in the interval [${-(a+1)}, ${a}]`)),l=a+s+1),o.splice(l,0,1),rY({inputs:{x:i},backend:n,attrs:{shape:o}})}const Aj={kernelName:uv,backendName:"cpu",kernelFunc:Nj},Rj=bW(((t,e)=>t/e)),Mj=RW(rv,Rj),Oj={kernelName:rv,backendName:"cpu",kernelFunc:Mj};function Pj(t,e,n){const r=t.shape,i=r[0],s=r[1],a=n.data.get(t.dataId),o=a.complexTensorInfos.real,l=a.complexTensorInfos.imag,h=[i,s],u=mg(h),c=Cg("float32",u),d=Cg("float32",u);for(let t=0;t<i;t++){const r=mH({inputs:{x:o},backend:n,attrs:{begin:[t,0],size:[1,s]}}),i=mH({inputs:{x:l},backend:n,attrs:{begin:[t,0],size:[1,s]}}),a=wW({inputs:{real:r,imag:i},backend:n}),{real:h,imag:u}=Dj(a,e,n),p=dR(h,u);for(let e=0;e<s;e++){const n=gR(p,e);c[t*s+e]=n.real,d[t*s+e]=n.imag}n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a)}const p=n.makeTensorInfo(h,"float32",c),f=n.makeTensorInfo(h,"float32",d),m=wW({inputs:{real:p,imag:f},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),m}function Dj(t,e,n){const r=mg(t.shape),i=n.data.get(t.dataId),s=n.data.get(i.complexTensorInfos.real.dataId).values,a=n.data.get(i.complexTensorInfos.imag.dataId).values;if(0==((o=r)&o-1)){const i=Fj(s,a,r,e,n),o=[t.shape[0],t.shape[1]];if(e){const t=n.makeTensorInfo(o,"float32",i.real),e=n.makeTensorInfo(o,"float32",i.imag),s=n.makeTensorInfo([],"float32",Jb(r,"float32")),a=EW({inputs:{x:s},backend:n}),l=Oj.kernelFunc({inputs:{a:t,b:s},backend:n}),h=Oj.kernelFunc({inputs:{a:e,b:a},backend:n}),u=n.data.get(l.dataId).values,c=n.data.get(h.dataId).values;return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),{real:u,imag:c}}return i}{const t=function(t,e,n){const r=new Float32Array(2*e);for(let i=0;i<e;i++){let s=0,a=0;for(let r=0;r<e;r++){const o=xR(i*r,e,n),l=gR(t,r);s+=l.real*o.real-l.imag*o.imag,a+=l.real*o.imag+l.imag*o.real}n&&(s/=e,a/=e),yR(r,s,a,i)}return r}(dR(s,a),r,e);return pR(t)}var o}function Fj(t,e,n,r,i){if(1===n)return{real:t,imag:e};const s=dR(t,e),a=n/2,o=fR(s),l=o.real,h=o.imag,u=[l.length],c=i.makeTensorInfo(u,"float32",l),d=i.makeTensorInfo(u,"float32",h),p=wW({inputs:{real:c,imag:d},backend:i}),f=mR(s),m=f.real,g=f.imag,y=[m.length],v=i.makeTensorInfo(y,"float32",m),x=i.makeTensorInfo(y,"float32",g),b=wW({inputs:{real:v,imag:x},backend:i}),w=Fj(l,h,a,r,i),_=w.real,T=w.imag,E=[_.length],S=i.makeTensorInfo(E,"float32",_),I=i.makeTensorInfo(E,"float32",T),k=wW({inputs:{real:S,imag:I},backend:i}),C=Fj(m,g,a,r,i),N=C.real,A=C.imag,R=[N.length],M=i.makeTensorInfo(R,"float32",N),O=i.makeTensorInfo(R,"float32",A),P=wW({inputs:{real:M,imag:O},backend:i}),D=vR(n,r),F=[D.real.length],L=i.makeTensorInfo(F,"float32",D.real),B=i.makeTensorInfo(F,"float32",D.imag),$=wW({inputs:{real:L,imag:B},backend:i}),U=LX({inputs:{a:$,b:P},backend:i}),V=DW({inputs:{a:k,b:U},backend:i}),z=LH({inputs:{a:k,b:U},backend:i}),G=IW({inputs:{input:V},backend:i}),W=IW({inputs:{input:z},backend:i}),X=zY({inputs:{input:V},backend:i}),H=zY({inputs:{input:z},backend:i}),Y=WY({inputs:[G,W],backend:i,attrs:{axis:0}}),j=WY({inputs:[X,H],backend:i,attrs:{axis:0}}),q=i.data.get(Y.dataId).values,K=i.data.get(j.dataId).values;return i.disposeIntermediateTensorInfo(c),i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(p),i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(x),i.disposeIntermediateTensorInfo(b),i.disposeIntermediateTensorInfo(S),i.disposeIntermediateTensorInfo(I),i.disposeIntermediateTensorInfo(k),i.disposeIntermediateTensorInfo(M),i.disposeIntermediateTensorInfo(O),i.disposeIntermediateTensorInfo(P),i.disposeIntermediateTensorInfo(L),i.disposeIntermediateTensorInfo(B),i.disposeIntermediateTensorInfo($),i.disposeIntermediateTensorInfo(U),i.disposeIntermediateTensorInfo(V),i.disposeIntermediateTensorInfo(z),i.disposeIntermediateTensorInfo(G),i.disposeIntermediateTensorInfo(X),i.disposeIntermediateTensorInfo(W),i.disposeIntermediateTensorInfo(H),i.disposeIntermediateTensorInfo(Y),i.disposeIntermediateTensorInfo(j),{real:q,imag:K}}const Lj={kernelName:dv,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:r}=e,i=mg(r.shape),s=r.shape[r.shape.length-1],a=rY({inputs:{x:r},backend:n,attrs:{shape:[i/s,s]}}),o=Pj(a,!1,n),l=rY({inputs:{x:o},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(o),l}};function Bj(t){const{backend:e,attrs:n}=t,{shape:r,value:i,dtype:s}=n,a=s||Bg(i),o=Ng(a,mg(r));return function(t,e,n){t.fill(e)}(o,i),e.makeTensorInfo(r,a,o)}const $j={kernelName:pv,backendName:"cpu",kernelFunc:Bj};const Uj={kernelName:fv,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,i=n,s=Cg(r.dtype,mg(r.shape)),[a,o,l,h]=r.shape,u=i.data.get(r.dataId).values;for(let t=0;t<a;t++){const e=t*l*o*h;for(let t=0;t<o;t++){const n=t*(l*h);for(let t=0;t<l;t++){const r=t*h;for(let i=0;i<h;i++){const a=Math.round(l-t-1),o=e+n+r+i;let c=u[o];if(a>=0&&a<l){c=u[e+n+a*h+i]}s[o]=c}}}}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};const Vj={kernelName:_b,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:a,preluActivationWeights:o}=e,{strides:l,pad:h,dataFormat:u,dilations:c,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r;let m=HY({inputs:{x:i,filter:s},backend:n,attrs:{strides:l,pad:h,dataFormat:u,dilations:c,dimRoundingMode:d}});if(a){const t=m;if("NCHW"===u&&1===a.shape.length&&1!==a.shape[0]){const t=rY({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});m=DW({inputs:{a:m,b:t},backend:n}),n.disposeIntermediateTensorInfo(t)}else m=DW({inputs:{a:m,b:a},backend:n});n.disposeIntermediateTensorInfo(t)}if(p){const t=m;if("NCHW"===u&&"prelu"===p&&1===o.shape.length&&1!==o.shape[0]){const t=rY({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=nY(n,m,p,t,f),n.disposeIntermediateTensorInfo(t)}else m=nY(n,m,p,o,f);n.disposeIntermediateTensorInfo(t)}return m}};const zj={kernelName:Tb,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:a,preluActivationWeights:o}=e,{strides:l,pad:h,dataFormat:u,dilations:c,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r;let m=lj({inputs:{x:i,filter:s},backend:n,attrs:{strides:l,pad:h,dataFormat:u,dilations:c,dimRoundingMode:d}});if(a){const t=m;m=DW({inputs:{a:m,b:a},backend:n}),n.disposeIntermediateTensorInfo(t)}if(p){const t=m;m=nY(n,m,p,o,f),n.disposeIntermediateTensorInfo(t)}return m}};const Gj={kernelName:xv,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{params:r,indices:i}=e,s=mg(r.shape),a=i.shape,o=a[a.length-1],[l,h,u,c]=jE(r,i);if(0===h)return n.makeTensorInfo(l,r.dtype,[]);const d=uX(n.data.get(i.dataId).values,n.bufferSync(r),r.dtype,h,o,u,c,r.shape,s);return n.makeTensorInfo(l,r.dtype,d.values)}};const Wj={kernelName:vv,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,indices:s}=e,{axis:a,batchDims:o}=r;mW([i,s],"gatherV2");const l=Ig(a,i.shape)[0],h=n.data.get(s.dataId).values,u=i.shape[l];for(let t=0;t<h.length;++t){const e=h[t];dg(e<=u-1&&e>=0,(()=>`GatherV2: the index value ${e} is not in [0, ${u-1}]`))}let c=o;null==o&&(c=0);const d=mg(s.shape),p=GR(i,s,l,c),f=rY({inputs:{x:i},backend:n,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),m=rY({inputs:{x:s},backend:n,attrs:{shape:[p.batchSize,d/p.batchSize]}}),g=[p.batchSize,p.outerSize,d/p.batchSize,p.sliceSize],y=n.bufferSync(m),v=cX(n.bufferSync(f),y,g);return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.makeTensorInfo(p.outputShape,v.dtype,v.values)}};const Xj={kernelName:Tv,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:r}=e,i=mg(r.shape),s=r.shape[r.shape.length-1],a=rY({inputs:{x:r},backend:n,attrs:{shape:[i/s,s]}}),o=Pj(a,!0,n),l=rY({inputs:{x:o},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(o),l}},Hj=GW(Sv,(t=>Number.isFinite(t)?1:0),"bool"),Yj={kernelName:Sv,backendName:"cpu",kernelFunc:Hj},jj=GW(Iv,(t=>Math.abs(t)===1/0?1:0),"bool"),qj={kernelName:Iv,backendName:"cpu",kernelFunc:jj},Kj=GW(kv,(t=>Number.isNaN(t)?1:0),"bool"),Zj={kernelName:kv,backendName:"cpu",kernelFunc:Kj};const Jj={kernelName:Rv,backendName:"cpu",kernelFunc:function(t){const{backend:e,attrs:n}=t,{start:r,stop:i,num:s}=n,a=EX(r,i,s);return e.makeTensorInfo([a.length],"float32",a)}},Qj=GW(Ov,(t=>Math.log1p(t))),tq={kernelName:Ov,backendName:"cpu",kernelFunc:Qj},eq=bW(((t,e)=>t&&e)),nq=RW(Pv,eq,null,"bool"),rq={kernelName:Pv,backendName:"cpu",kernelFunc:nq},iq=GW(Dv,(t=>t?0:1),"bool"),sq={kernelName:Dv,backendName:"cpu",kernelFunc:iq},aq=bW(((t,e)=>t||e)),oq=RW(Fv,aq,null,"bool"),lq={kernelName:Fv,backendName:"cpu",kernelFunc:oq};const hq={kernelName:Uv,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{depthRadius:s,bias:a,alpha:o,beta:l}=r;mW(i,"LRN");const h=i.shape[3],u=h-1,c=n.data.get(i.dataId).values,d=mg(i.shape),p=new Float32Array(d);function f(t){const e=t%h;let n=t-e+Math.max(0,e-s);const r=t-e+Math.min(e+s,u);let i=0;for(;n<=r;n++){const t=c[n];i+=t*t}return i}for(let t=0;t<d;t++){const e=f(t),n=c[t]*Math.pow(a+o*e,-l);p[t]=n}return n.makeTensorInfo(i.shape,i.dtype,p)}};const uq={kernelName:Vv,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,y:s,dy:a}=e,{depthRadius:o,bias:l,alpha:h,beta:u}=r;mW(a,"LRNGrad");const c=mg(a.shape),d=a.shape[3],p=n.data.get(a.dataId).values,f=n.data.get(i.dataId).values,m=n.data.get(s.dataId).values,g=new Float32Array(c),y=c;for(let t=0;t<y;t++){const e=t%d,n=t-e+Math.max(0,e-o),r=t-e+Math.min(d,e+o+1);let i=0;for(let t=n;t<r;t++)i+=Math.pow(f[t],2);i=h*i+l;for(let e=n;e<r;e++){let n=-2*h*u*f[e]*m[t]/i;t===e&&(n+=Math.pow(i,-u)),n*=p[t],g[e]+=n}}return n.makeTensorInfo(a.shape,i.dtype,g)}};function cq(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reductionIndices:s,keepDims:a}=r,o=n;let l=i.shape;const h=l.length,u=Ig(s,l);let c=u;const d=ek(c,h);let p=o.data.get(i.dataId).values;if(null!=d){const t=new Array(h);for(let e=0;e<t.length;e++)t[e]=l[d[e]];p=WX(p,l,i.dtype,d,t),c=rk(c.length,h),l=t}mW(i,"max"),tk("max",c,h);const[f,m]=JI(l,c),g=CX(p,mg(m),f,i.dtype),y=o.write(g,f,i.dtype);let v=f;if(a){v=QI(f,u)}return{dataId:y,shape:v,dtype:i.dtype}}const dq={kernelName:Gv,backendName:"cpu",kernelFunc:cq};const pq={kernelName:Xv,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;mW(i,"maxPool");const{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=r;dg(QS(a,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '1'`));const h=GS(i.shape,s,a,1,o,l);let u;if(1===h.filterWidth&&1===h.filterHeight&&vg(h.inShape,h.outShape))u=EW({inputs:{x:i},backend:n});else{const t=n.data.get(i.dataId).values,e=Vg(i.shape),r=CY(t,i.shape,i.dtype,e,h,"max");u=n.makeTensorInfo(h.outShape,i.dtype,r.values)}return u}};const fq={kernelName:Yv,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:a,pad:o,dimRoundingMode:l,dataFormat:h}=r;mW(i,"maxPool3d");const u=WS(i.shape,s,a,1,o,l,h),c=AY(n.data.get(i.dataId).values,i.shape,i.dtype,Vg(i.shape),u,"max");return n.makeTensorInfo(c.shape,"float32",c.values)}};const mq={kernelName:jv,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,{filterSize:a,strides:o,pad:l,dimRoundingMode:h}=r;mW([i,s],"maxPool3DGrad");const u=WS(s.shape,a,o,1,l,h),c=function(t,e){const n=nT(e.outShape,"int32"),r=e.strideDepth,i=e.strideHeight,s=e.strideWidth,a=e.dilationDepth,o=e.dilationHeight,l=e.dilationWidth,h=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,d=e.padInfo.front,p=e.padInfo.top,f=e.padInfo.left;for(let m=0;m<e.batchSize;++m)for(let g=0;g<e.inChannels;++g)for(let y=0;y<e.outDepth;++y){const v=y*r-d;let x=v;for(;x<0;)x+=a;const b=Math.min(e.inDepth,h+v);for(let r=0;r<e.outHeight;++r){const h=r*i-p;let d=h;for(;d<0;)d+=o;const w=Math.min(e.inHeight,u+h);for(let i=0;i<e.outWidth;++i){const p=i*s-f;let _=p;for(;_<0;)_+=l;const T=Math.min(e.inWidth,c+p);let E=Number.NEGATIVE_INFINITY,S=-1;for(let e=x;e<b;e+=a){const n=e-v;for(let r=d;r<w;r+=o){const i=r-h;for(let s=_;s<T;s+=l){const a=s-p,o=t.get(m,e,r,s,g);o>=E&&(E=o,S=n*u*c+i*u+a)}}}n.set(S,m,y,r,i,g)}}}return n}(n.bufferSync(s),u),d=u.strideDepth,p=u.strideHeight,f=u.strideWidth,m=u.dilationDepth,g=u.dilationHeight,y=u.dilationWidth,v=u.effectiveFilterDepth,x=u.effectiveFilterHeight,b=u.effectiveFilterWidth,w=v-1-u.padInfo.front,_=b-1-u.padInfo.left,T=x-1-u.padInfo.top,E=nT(s.shape,"float32"),S=n.bufferSync(i);for(let t=0;t<u.batchSize;++t)for(let e=0;e<u.inChannels;++e)for(let n=0;n<u.inDepth;++n)for(let r=0;r<u.inHeight;++r)for(let i=0;i<u.inWidth;++i){const s=n-w,a=r-T,o=i-_;let l=0;for(let n=0;n<v;n+=m){const r=(s+n)/d;if(!(r<0||r>=u.outDepth||Math.floor(r)!==r))for(let i=0;i<x;i+=g){const s=(a+i)/p;if(!(s<0||s>=u.outHeight||Math.floor(s)!==s))for(let a=0;a<b;a+=y){const h=(o+a)/f;if(h<0||h>=u.outWidth||Math.floor(h)!==h)continue;const d=v*x*b-1-c.get(t,r,s,h,e)===n*x*b+i*b+a?1:0;if(0===d)continue;l+=S.get(t,r,s,h,e)*d}}}E.set(l,t,n,r,i,e)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}};const gq={kernelName:Hv,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s,output:a}=e,o=s;mW([s,a],"maxPoolGrad");const{filterSize:l,strides:h,pad:u,dimRoundingMode:c}=r,d=GS(o.shape,l,h,1,u,c),p=n.data.get(o.dataId).values,f=nT(d.outShape,o.dtype,NY(p,o.shape,o.dtype,d).values),m=d.strideHeight,g=d.strideWidth,y=d.dilationHeight,v=d.dilationWidth,x=d.effectiveFilterHeight,b=d.effectiveFilterWidth,w=b-1-d.padInfo.left,_=x-1-d.padInfo.top,T=nT(o.shape,"float32"),E=n.data.get(i.dataId).values,S=nT(i.shape,"float32",E);for(let t=0;t<d.batchSize;++t)for(let e=0;e<d.inChannels;++e)for(let n=0;n<d.inHeight;++n)for(let r=0;r<d.inWidth;++r){const i=n-_,s=r-w;let a=0;for(let n=0;n<x;n+=y){const r=(i+n)/m;if(!(r<0||r>=d.outHeight||Math.floor(r)!==r))for(let i=0;i<b;i+=v){const o=(s+i)/g;if(o<0||o>=d.outWidth||Math.floor(o)!==o)continue;const l=x*b-1-f.get(t,r,o,e)===n*b+i?1:0;if(0===l)continue;a+=S.get(t,r,o,e)*l}}T.set(a,t,n,r,e)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}};const yq={kernelName:qv,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{filterSize:i,strides:s,pad:a,includeBatchInIndex:o}=e,l=n;mW(r,"MaxPoolWithArgmax");const h=l.data.get(r.dataId).values,u=GS(r.shape,i,s,[1,1],a),[c,d]=function(t,e,n,r,i){const s=CY(t,0,n,Vg(e),i,"max"),a=NY(t,e,n,i,!0,r);return[s.values,a.values]}(h,r.shape,r.dtype,o,u),p=l.write(c,u.outShape,r.dtype),f=l.write(d,u.outShape,r.dtype);return[{dataId:p,shape:u.outShape,dtype:r.dtype},{dataId:f,shape:u.outShape,dtype:"int32"}]}};const vq={kernelName:Kv,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:a}=r,o=Ig(s,i.shape),l=mg(JI(i.shape,o)[1]),h=[],u=n.makeTensorInfo([],"float32",new Float32Array([l]));h.push(u);const c=NW({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});h.push(c);const d=Mj({inputs:{a:c,b:u},backend:n});h.push(d);const p=yj({inputs:{x:d},backend:n,attrs:{axis:s,keepDims:a}});return h.forEach((t=>n.disposeIntermediateTensorInfo(t))),p}};const xq={kernelName:Zv,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:a}=r;mW(i,"min");const o=Ig(s,i.shape);let l=o;const h=ek(l,i.shape.length);let u=i;null!=h&&(u=XX({inputs:{x:i},backend:n,attrs:{perm:h}}),l=rk(l.length,i.shape.length)),tk("min",l,u.shape.length);const[c,d]=JI(u.shape,l),p=mg(d),f=Hg(mg(c),u.dtype),m=n.data.get(u.dataId).values;for(let t=0;t<f.length;++t){const e=t*p;let n=m[e];for(let t=0;t<p;++t){const r=m[e+t];(Number.isNaN(r)||r<n)&&(n=r)}f[t]=n}null!=h&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(c,u.dtype,f);if(a){const t=rY({inputs:{x:g},backend:n,attrs:{shape:QI(c,o)}});return n.disposeIntermediateTensorInfo(g),t}return g}};const bq={kernelName:Qv,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{paddings:s,mode:a}=r;mW(i,"mirrorPad");const o=s.map(((t,e)=>t[0]+i.shape[e]+t[1])),l=s.map((t=>t[0])),h=s.map(((t,e)=>t[0]+i.shape[e])),u="reflect"===a?0:1,c=n.data.get(i.dataId).values,d=i.shape.length,p=Vg(i.shape),f=mg(o),m=o.length,g=Vg(o),y=Cg(i.dtype,f);for(let t=0;t<f;t++){let e=Kg(t,m,g);for(let t=0;t<m;t++)e[t]<l[t]?e[t]=2*l[t]-e[t]-u:e[t]>=h[t]&&(e[t]=2*(h[t]-1)-e[t]+u);e=e.map(((t,e)=>t-l[e]));const n=qg(e,d,p);y[t]=c[n]}return{dataId:n.write(y,o,i.dtype),shape:o,dtype:i.dtype}}},wq=bW(((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})),_q=RW(tx,wq),Tq={kernelName:tx,backendName:"cpu",kernelFunc:_q};function Eq(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{dim:s}=r,a=i.shape.length;let o=s;if(-1===o&&(o=a-1),o!==a-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${a} and dim was ${o}`);const l=Ig([o],i.shape),h=cq({inputs:{x:i},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),u=QI(h.shape,l),c=rY({inputs:{x:h},backend:n,attrs:{shape:u}}),d=LH({inputs:{a:i,b:c},backend:n}),p=QW({inputs:{x:d},backend:n}),f=yj({inputs:{x:p},backend:n,attrs:{axis:l,keepDims:!1}}),m=rY({inputs:{x:f},backend:n,attrs:{shape:u}}),g=Mj({inputs:{a:p,b:m},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}const Sq={kernelName:Yx,backendName:"cpu",kernelFunc:Eq};const Iq={kernelName:ex,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{numSamples:s,seed:a,normalized:o}=r;mW(i,"multinomial");const l=o?i:Eq({inputs:{logits:i},backend:n,attrs:{dim:-1}}),h=l.shape[0],u=l.shape[1],c=n.data.get(l.dataId).values,d=[h,s],p=Hg(mg(d),"int32");for(let t=0;t<h;++t){const e=t*u,n=new Float32Array(u-1);n[0]=c[e];for(let t=1;t<n.length;++t)n[t]=n[t-1]+c[e+t];const r=mC.alea(a.toString()),i=t*s;for(let t=0;t<s;++t){const e=r();p[i+t]=n.length;for(let r=0;r<n.length;r++)if(e<n[r]){p[i+t]=r;break}}}return o||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(d,"int32",p)}},kq=qN;const Cq={kernelName:sx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l}=r;mW(i,"NonMaxSuppression");const h=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,{selectedIndices:c}=kq(h,u,a,o,l);return n.makeTensorInfo([c.length],"int32",new Int32Array(c))}},Nq=KN;const Aq={kernelName:ax,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:h}=r;mW(i,"NonMaxSuppressionPadded");const u=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,{selectedIndices:d,validOutputs:p}=Nq(u,c,a,o,l,h);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},Rq=ZN;const Mq={kernelName:ox,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,softNmsSigma:h}=r;mW(i,"NonMaxSuppressionWithScore");const u=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,d=a,p=o,f=l,m=h,{selectedIndices:g,selectedScores:y}=Rq(u,c,d,p,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}};const Oq={kernelName:hx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{indices:i}=e,{dtype:s,depth:a,onValue:o,offValue:l}=r;mW(i,"oneHot");const h=mg(i.shape),u=new Float32Array(h*a);u.fill(l);const c=n.data.get(i.dataId).values;for(let t=0;t<h;++t)c[t]>=0&&c[t]<a&&(u[t*a+c[t]]=o);return n.makeTensorInfo([...i.shape,a],s,u)}};function Pq(t){const{inputs:e,backend:n}=t,{x:r}=e;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){const t=IW({inputs:{input:r},backend:n}),e=Pq({inputs:{x:t},backend:n}),i=zY({inputs:{input:r},backend:n}),s=Pq({inputs:{x:i},backend:n}),a=wW({inputs:{real:e,imag:s},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),a}return Bj({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const Dq={kernelName:yb,backendName:"cpu",kernelFunc:Pq};const Fq={kernelName:lx,backendName:"cpu",kernelFunc:function t(e){const{inputs:n,backend:r}=e,{x:i}=n;if("string"===i.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===i.dtype){const e=IW({inputs:{input:i},backend:r}),n=t({inputs:{x:e},backend:r}),s=zY({inputs:{input:i},backend:r}),a=Pq({inputs:{x:s},backend:r}),o=wW({inputs:{real:n,imag:a},backend:r});return r.disposeIntermediateTensorInfo(e),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(a),o}return Bj({backend:r,attrs:{shape:i.shape,value:1,dtype:i.dtype}})}};function Lq(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r;if(1===e.length)return Nj({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const s=e[0].shape,a=e[0].dtype;e.forEach((t=>{pg(s,t.shape,"All tensors passed to stack must have matching shapes"),dg(a===t.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const o=[],l=WY({inputs:e.map((t=>{const e=Nj({inputs:{input:t},backend:n,attrs:{dim:i}});return o.push(e),e})),backend:n,attrs:{axis:i}});return o.forEach((t=>n.disposeIntermediateTensorInfo(t))),l}const Bq={kernelName:ux,backendName:"cpu",kernelFunc:Lq};const $q={kernelName:cx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{paddings:s,constantValue:a}=r;mW(i,"pad");const o=s.map(((t,e)=>t[0]+i.shape[e]+t[1])),l=s.map((t=>t[0])),h=n.data.get(i.dataId).values,u=mg(i.shape),c=i.shape.length,d=Vg(i.shape),p=mg(o),f=o.length,m=Vg(o),g=Cg(i.dtype,p);0!==a&&g.fill(a);for(let t=0;t<u;t++){const e=Kg(t,c,d).map(((t,e)=>t+l[e]));g[qg(e,f,m)]=h[t]}return{dataId:n.write(g,o,i.dtype),shape:o,dtype:i.dtype}}},Uq=bW(((t,e)=>Math.pow(t,e))),Vq=RW(px,Uq),zq={kernelName:px,backendName:"cpu",kernelFunc:Vq};const Gq={kernelName:gx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{paramsNestedSplits:i,paramsDenseValues:s,indices:a}=e,{outputRaggedRank:o}=r,l=i.map((t=>n.data.get(t.dataId).values)),h=i.map((t=>t.shape)),u=n.data.get(s.dataId).values,c=n.data.get(a.dataId).values,[d,p,f]=JX(l,h,u,s.shape,s.dtype,c,a.shape),m=d.map((t=>n.makeTensorInfo([t.length],"int32",t))),g=n.makeTensorInfo(f,s.dtype,p);return m.concat([g])}};const Wq={kernelName:yx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{starts:r,limits:i,deltas:s}=e,a=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,[h,u]=tH(a,r.shape,r.dtype,o,i.shape,l,s.shape);return[n.makeTensorInfo([h.length],"int32",h),n.makeTensorInfo([u.length],r.dtype,u)]}};const Xq={kernelName:vx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{shape:i,values:s,defaultValue:a,rowPartitionTensors:o}=e,{rowPartitionTypes:l}=r,h=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,c=n.data.get(a.dataId).values,d=o.map((t=>n.data.get(t.dataId).values)),p=o.map((t=>t.shape)),[f,m]=sH(h,i.shape,u,s.shape,s.dtype,c,a.shape,d,p,l);return n.makeTensorInfo(f,s.dtype,m)}};const Hq={kernelName:xx,backendName:"cpu",kernelFunc:function(t){const{backend:e,attrs:n}=t,{start:r,stop:i,dtype:s,step:a}=n,o=aH(r,i,a,s);return e.makeTensorInfo([o.length],s,o)}},Yq=GW(wx,(t=>1/t)),jq={kernelName:wx,backendName:"cpu",kernelFunc:Yq};const qq={kernelName:Ix,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:a,size:o}=r;mW(i,"resizeBilinear");const l=Vg(i.shape),[h,u]=o,[c,d,p,f]=i.shape,m=n.data.get(i.dataId).values,g=new Float32Array(mg([c,h,u,f])),y=[s&&h>1?d-1:d,s&&u>1?p-1:p],v=[s&&h>1?h-1:h,s&&u>1?u-1:u];let x=0;const b=y[0]/v[0],w=y[1]/v[1];for(let t=0;t<c;t++)for(let e=0;e<h;e++){let n;n=a?b*(e+.5)-.5:b*e;const r=Math.max(0,Math.floor(n)),i=n-r,s=Math.min(d-1,Math.ceil(n)),o=t*l[0]+r*l[1],h=t*l[0]+s*l[1];for(let t=0;t<u;t++){let e;e=a?w*(t+.5)-.5:w*t;const n=Math.max(0,Math.floor(e)),r=e-n,s=Math.min(p-1,Math.ceil(e)),u=o+n*l[2],c=h+n*l[2],d=o+s*l[2],y=h+s*l[2];for(let t=0;t<f;t++){const e=m[u+t],n=m[c+t],s=e+(m[d+t]-e)*r,a=s+(n+(m[y+t]-n)*r-s)*i;g[x++]=a}}}return n.makeTensorInfo([c,h,u,f],"float32",g)}};const Kq={kernelName:kx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:a}=r;mW([s,i],"resizeBilinearGrad");const o=Vg(i.shape),[l,h,u,c]=i.shape,[,d,p]=s.shape,f=new Float32Array(l*h*u*c),m=[a&&d>1?h-1:h,a&&p>1?u-1:u],g=[a&&d>1?d-1:d,a&&p>1?p-1:p],y=m[0]/g[0],v=m[1]/g[1],x=n.data.get(s.dataId).values;let b=0;for(let t=0;t<l;t++){const e=t*o[0];for(let t=0;t<d;t++){const n=t*y,r=Math.floor(n),i=Math.min(Math.ceil(n),h-1),s=e+r*o[1],a=e+i*o[1],l=n-r,d=1-l;for(let t=0;t<p;t++){const e=t*v,n=Math.floor(e),r=Math.min(Math.ceil(e),u-1),i=e-n,h=1-i,p=s+n*o[2],m=s+r*o[2],g=a+n*o[2],y=a+r*o[2],w=d*h,_=d*i,T=l*h,E=l*i;for(let t=0;t<c;t++){const e=x[b++];f[p+t]+=e*w,f[m+t]+=e*_,f[g+t]+=e*T,f[y+t]+=e*E}}}}return n.makeTensorInfo([l,u,h,c],"float32",f)}};const Zq={kernelName:Ex,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:a,size:o}=r;mW(i,"resizeNearestNeighbor");const l=Vg(i.shape),[h,u]=o,[c,d,p,f]=i.shape,m=n.data.get(i.dataId).values,g=new Float32Array(c*h*u*f),y=[s&&h>1?d-1:d,s&&u>1?p-1:p],v=[s&&h>1?h-1:h,s&&u>1?u-1:u],x=y[0]/v[0],b=y[1]/v[1];let w=0;for(let t=0;t<c;t++){const e=t*l[0];for(let t=0;t<h;t++){const n=a?x*(t+.5):x*t;let r=Math.min(d-1,s?Math.round(n):Math.floor(n));a&&(r=Math.max(0,r));const i=e+r*l[1];for(let t=0;t<u;t++){const e=a?b*(t+.5):b*t;let n=Math.min(p-1,s?Math.round(e):Math.floor(e));a&&(n=Math.max(0,n));const r=i+n*l[2];for(let t=0;t<f;t++){const e=m[r+t];g[w++]=e}}}}return n.makeTensorInfo([c,h,u,f],i.dtype,g)}};const Jq={kernelName:Sx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:a}=r;mW([s,i],"resizeNearestNeighborGrad");const o=Vg(i.shape),l=Vg(s.shape),[h,u,c,d]=i.shape,[,p,f]=s.shape,m=new Float32Array(h*u*c*d),g=n.data.get(s.dataId).values,y=[a&&p>1?u-1:u,a&&f>1?c-1:c],v=[a&&p>1?p-1:p,a&&f>1?f-1:f],x=y[0]/v[0],b=y[1]/v[1],w=1/x,_=1/b,T=2*Math.ceil(w)+2,E=2*Math.ceil(_)+2;for(let t=0;t<h;t++){const e=t*o[0];for(let t=0;t<u;t++){const n=e+t*o[1],r=Math.floor(t*w),i=Math.floor(r-T/2);for(let r=0;r<c;r++){const s=n+r*o[2],h=Math.floor(r*_),y=Math.floor(h-E/2);for(let n=0;n<d;n++){let o=0;for(let s=0;s<T;s++){const h=s+i;if(h<0||h>=p)continue;const d=e+h*l[1],m=h*x;if(t===Math.min(u-1,a?Math.round(m):Math.floor(m)))for(let t=0;t<E;t++){const e=t+y;if(e<0||e>=f)continue;const i=d+e*l[2],s=e*b;r===Math.min(c-1,a?Math.round(s):Math.floor(s))&&(o+=g[i+n])}}m[s+n]=o}}}}return n.makeTensorInfo(i.shape,i.dtype,m)}};const Qq={kernelName:Nx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dims:s}=r;mW(i,"reverse");const a=i.shape.length,o=Ig(s,i.shape);if(0===a)return EW({inputs:{x:i},backend:n});const l=new fw(i.shape,i.dtype),h=n.bufferSync(i);for(let t=0;t<l.size;t++){const e=l.indexToLoc(t),n=e.slice();o.forEach((t=>n[t]=i.shape[t]-1-n[t])),l.set(h.get(...n),...e)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}},tK={kernelName:bb,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,{radians:i,fillValue:s,center:a}=e,o=n,l=Cg(r.dtype,mg(r.shape)),[h,u,c,d]=r.shape,[p,f]=JA(a,u,c),m=Math.sin(i),g=Math.cos(i),y=o.data.get(r.dataId).values;for(let t=0;t<h;t++){const e=t*c*u*d;for(let t=0;t<u;t++){const n=t*(c*d);for(let r=0;r<c;r++){const i=r*d;for(let a=0;a<d;a++){const o=[h,t,r,a],v=o[2],x=o[1];let b=(v-p)*g-(x-f)*m,w=(v-p)*m+(x-f)*g;b=Math.round(b+p),w=Math.round(w+f);let _=s;if("number"!=typeof s&&(_=3===a?255:s[a]),b>=0&&b<c&&w>=0&&w<u){_=y[e+w*(c*d)+b*d+a]}l[e+n+i+a]=_}}}}return{dataId:o.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},eK=GW(Ax,(t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2==0?e:e+1})),nK={kernelName:Ax,backendName:"cpu",kernelFunc:eK};const rK={kernelName:Mx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{indices:i,updates:s}=e,{shape:a}=r,{sliceRank:o,numUpdates:l,sliceSize:h,strides:u,outputSize:c}=ZE(0,i,a),d=uH(n.bufferSync(i),n.bufferSync(s),a,c,h,l,o,u,0,!0);return n.makeTensorInfo(a,d.dtype,d.values)}};function iK(t,e){let n=0,r=t.length,i=0;for(;n<r;)i=Math.floor((n+r)/2),t[i]<e?n=i+1:r=i;return r}function sK(t,e){let n=0,r=t.length,i=0;for(;n<r;)i=Math.floor((n+r)/2),t[i]<=e?n=i+1:r=i;return r}const aK={kernelName:Px,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sortedSequence:i,values:s}=e,{side:a}=r,o=function(t,e,n,r,i,s){const a=Ng("int32",n*i);for(let o=0;o<n;++o){const n=t.slice(o*r,(o+1)*r),l=o*i;for(let t=0;t<i;++t)a[l+t]="left"===s?iK(n,e[t+l]):sK(n,e[t+l])}return a}(n.data.get(i.dataId).values,n.data.get(s.dataId).values,i.shape[0],i.shape[1],s.shape[1],a);return n.makeTensorInfo(s.shape,"int32",o)}};const oK={kernelName:Dx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{condition:r,t:i,e:s}=e;mW([r,i,s],"select");const a=r.shape.length,o=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,h=n.data.get(s.dataId).values,u=kw(i.dtype,s.dtype),c=Hg(mg(i.shape),u);let d=0;const p=0===a||a>1||1===i.shape.length?1:mg(i.shape.slice(1));for(let t=0;t<o.length;t++)for(let e=0;e<p;e++)1===o[t]?c[d++]=l[t]:c[d++]=h[t];return n.makeTensorInfo(i.shape,u,c)}},lK=iR,hK=sR,uK=GW(Fx,(t=>t>=0?hK*t:lK*(Math.exp(t)-1))),cK={kernelName:Fx,backendName:"cpu",kernelFunc:uK},dK=GW(Ux,(t=>t<0?-1:t>0?1:0)),pK={kernelName:Ux,backendName:"cpu",kernelFunc:dK},fK=GW(Bx,(t=>Math.sin(t))),mK={kernelName:Bx,backendName:"cpu",kernelFunc:fK},gK=GW($x,(t=>Math.sinh(t))),yK={kernelName:$x,backendName:"cpu",kernelFunc:gK},vK=Math.log(1.1920928955078125e-7)+2,xK=GW(zx,(t=>{const e=t>-vK,n=t<vK,r=Math.exp(t);let i;return i=n?r:e?t:Math.log(1+r),i})),bK={kernelName:zx,backendName:"cpu",kernelFunc:xK};const wK={kernelName:Xx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,paddings:a}=r;mW([i],"spaceToBatchND");const o=mg(s),l=[[0,0]];l.push(...a);for(let t=1+s.length;t<i.shape.length;++t)l.push([0,0]);const h=$q.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),u=QA(h.shape,s,o,!1),c=tR(u.length,s.length,!1),d=eR(h.shape,s,o,!1),p=rY({inputs:{x:h},backend:n,attrs:{shape:u}}),f=XX({inputs:{x:p},backend:n,attrs:{perm:c}}),m=rY({inputs:{x:f},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),m}};const _K={kernelName:jx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{indices:r,values:i,denseShape:s,defaultValue:a}=e;if(1!==s.shape.length)throw new Error(`Dense shape must be a vector, saw:\n        ${s.shape}`);if(2!==r.shape.length)throw new Error(`Indices must be a matrix, saw:\n        ${r.shape}`);if(1!==i.shape.length)throw new Error(`Values must be a vector, saw:\n        ${i.shape}`);if(0!==a.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${a.shape}`);const o=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,h=n.data.get(s.dataId).values,u=n.data.get(a.dataId).values[0],[c,d,p,f,m]=yH(o,r.shape,r.dtype,l,i.dtype,h,u);return[n.makeTensorInfo(d,r.dtype,c),n.makeTensorInfo([d[0]],i.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map((t=>Number(t))))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}};const TK={kernelName:qx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{inputIndices:r,inputShape:i,newShape:s}=e;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape\n        ${r.shape}`);if(1!==i.shape.length)throw new Error(`Input shape should be a vector but received shape\n        ${i.shape}`);if(1!==s.shape.length)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const a=Array.from(n.data.get(i.dataId).values),o=n.data.get(r.dataId).values,l=Array.from(n.data.get(s.dataId).values),[h,u,c]=vH(o,r.shape,r.dtype,a,l);return[n.makeTensorInfo(u,r.dtype,h),n.makeTensorInfo([c.length],s.dtype,new Int32Array(c))]}};const EK={kernelName:Kx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n          ${i.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n          ${s.shape}`);if(i.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const a=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,[h,u]=xH(a,r.shape,r.dtype,o,l,!0);return n.makeTensorInfo(u,r.dtype,h)}};const SK={kernelName:Zx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n         ${i.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n         ${s.shape}`);if(i.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const a=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,[h,u]=xH(a,r.shape,r.dtype,o,l);return n.makeTensorInfo(u,r.dtype,h)}};const IK={kernelName:Jx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sparseIndices:i,sparseValues:s,defaultValue:a}=e,{outputShape:o}=r,{sliceRank:l,numUpdates:h,sliceSize:u,strides:c,outputSize:d}=ZE(0,i,o),p=!1,f=n.bufferSync(i);let m;switch(s.dtype){case"bool":m=uH(f,n.bufferSync(s),o,d,u,h,l,c,Boolean(n.data.get(a.dataId).values[0]),p);break;case"float32":m=uH(f,n.bufferSync(s),o,d,u,h,l,c,n.data.get(a.dataId).values[0],p);break;case"int32":m=uH(f,n.bufferSync(s),o,d,u,h,l,c,n.data.get(a.dataId).values[0],p);break;case"string":m=uH(f,n.bufferSync(s),o,d,u,h,l,c,rw(n.data.get(a.dataId).values[0]),p);break;default:throw new Error(`Unsupported type ${s.dtype}`)}return n.makeTensorInfo(o,m.dtype,m.values)}};const kK={kernelName:Hx,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{numOrSizeSplits:s,axis:a}=r,o=Ig(a,i.shape)[0],l=CR(i,s,o),h=new Array(i.shape.length).fill(0),u=i.shape.slice();return l.map((t=>{const e=[...u];e[o]=t;const r=mH({inputs:{x:i},backend:n,attrs:{begin:h,size:e}});return h[o]+=t,r}))}},CK={kernelName:tb,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,r=e;mW(n,"square");const i=r.data.get(n.dataId).values,s=new Float32Array(i.length);for(let t=0;t<i.length;++t){const e=i[t];s[t]=e*e}return{dataId:r.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},NK=GW(vb,((t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha})),AK={kernelName:vb,backendName:"cpu",kernelFunc:NK};const RK={kernelName:nb,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,end:a,strides:o,beginMask:l,endMask:h,ellipsisMask:u,newAxisMask:c,shrinkAxisMask:d}=r;mW(i,"stridedSlice");const{finalShapeSparse:p,finalShape:f,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:v,end:x,strides:b}=pS(i.shape,s,a,o,l,h,u,c,d);let w;if(m)w=rY({inputs:{x:i},backend:n,attrs:{shape:f}});else if(g||y){dg(i.shape.length>=1,(()=>`Input must have rank at least 1, got: ${i.shape.length}`));const t=tS(v,x,b),e=mH({inputs:{x:i},backend:n,attrs:{begin:v,size:t}});w=rY({inputs:{x:e},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(e)}else{const t=NH(p,n.bufferSync(i),b,v);w=n.makeTensorInfo(f,t.dtype,t.values)}return w}};const MK={kernelName:rb,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{separator:i,nGramWidths:s,leftPad:a,rightPad:o,padWidth:l,preserveShortSequences:h}=r,{data:u,dataSplits:c}=e,d=n.data.get(u.dataId).values,p=n.data.get(c.dataId).values,[f,m]=RH(d,p,i,s,a,o,l,h);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(c.shape,"int32",m)]}};const OK={kernelName:ib,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{skipEmpty:i}=r,{input:s,delimiter:a}=e;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(1!==s.shape.length)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(0!==a.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${a.shape}`);const o=n.data.get(s.dataId).values,l=n.data.get(a.dataId).values[0],[h,u,c]=OH(o,l,i),d=u.length;return[n.makeTensorInfo([d,2],"int32",h),n.makeTensorInfo([d],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(c))]}};const PK={kernelName:sb,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{numBuckets:i}=r,{input:s}=e;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const a=PH(n.data.get(s.dataId).values,i);return n.makeTensorInfo(s.shape,"int32",a)}},DK=GW(ob,(t=>Math.tan(t))),FK={kernelName:ob,backendName:"cpu",kernelFunc:DK},LK=GW(lb,(t=>Math.tanh(t)));const BK={kernelName:Ox,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n}=t,{tensor:r,indices:i,updates:s}=e,{sliceRank:a,numUpdates:o,sliceSize:l,strides:h,outputSize:u}=ZE(0,i,r.shape),c=n.bufferSync(i),d=n.bufferSync(s),p=n.bufferSync(r),f=uH(c,d,r.shape,u,l,o,a,h,p,!1);return n.makeTensorInfo(r.shape,f.dtype,f.values)}};const $K={kernelName:hb,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reps:s}=r;mW(i,"tile");const a=$H(n.bufferSync(i),s);return n.makeTensorInfo(a.shape,a.dtype,a.values)}};const UK={kernelName:ub,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{k:s,sorted:a}=r;mW(i,"topk");const o=n.data.get(i.dataId).values,[l,h]=zH(o,i.shape,i.dtype,s,a);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(h.shape,h.dtype,h.values)]}};const VK={kernelName:cb,backendName:"cpu",kernelFunc:function(t){const{inputs:e,attrs:n,backend:r}=t,{image:i,transforms:s}=e,{interpolation:a,fillMode:o,fillValue:l,outputShape:h}=n,[u,c,d,p]=i.shape,[f,m]=null!=h?h:[c,d],g=[u,f,m,p],y=Vg(i.shape),v=y[0],x=y[1],b=y[2],w=Vg(g),_=w[0],T=w[1],E=w[2],S=Cg(i.dtype,mg(g));S.fill(l);const I=r.data.get(i.dataId).values,k=r.data.get(s.dataId).values;for(let t=0;t<u;++t){const e=1===s.shape[0]?k:k.subarray(8*t,8*t+8);for(let n=0;n<f;++n)for(let r=0;r<m;++r)for(let i=0;i<p;++i){let s;const h=e[6]*r+e[7]*n+1;if(0===h)continue;const u=(e[0]*r+e[1]*n+e[2])/h,p=(e[3]*r+e[4]*n+e[5])/h,f=zK(u,d,o),m=zK(p,c,o);switch(a){case"nearest":s=WK(I,c,d,v,x,b,t,m,f,i,l);break;case"bilinear":s=XK(I,c,d,v,x,b,t,m,f,i,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${a}`)}S[t*_+n*T+r*E+i]=s}return r.makeTensorInfo(g,i.dtype,S)}return{dataId:r.write(S,g,i.dtype),shape:i.shape,dtype:i.dtype}}};function zK(t,e,n){switch(n){case"reflect":return function(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const t=2*e;n<t&&(n=t*Math.trunc(-n/t)+n),n=n<-e?n+t:-n-1}else if(n>e-1)if(e<=1)n=0;else{const t=2*e;n-=t*Math.trunc(n/t),n>=e&&(n=t-n-1)}return ag(0,n,e-1)}(t,e);case"wrap":return function(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const t=e-1;n+=e*(Math.trunc(-n/t)+1)}else if(n>e-1)if(e<=1)n=0;else{const t=e-1;n-=e*Math.trunc(n/t)}return ag(0,n,e-1)}(t,e);case"nearest":return function(t,e){return ag(0,t,e-1)}(t,e);default:return function(t,e){return t}(t)}}function GK(t,e,n,r,i,s,a,o,l,h,u){return 0<=o&&o<e&&0<=l&&l<n?t[a*r+o*i+l*s+h]:u}function WK(t,e,n,r,i,s,a,o,l,h,u){return GK(t,e,n,r,i,s,a,Math.round(o),Math.round(l),h,u)}function XK(t,e,n,r,i,s,a,o,l,h,u){const c=Math.floor(o),d=Math.floor(l),p=c+1,f=d+1;return(p-o)*((f-l)*GK(t,e,n,r,i,s,a,c,d,h,u)+(l-d)*GK(t,e,n,r,i,s,a,c,f,h,u))+(o-c)*((f-l)*GK(t,e,n,r,i,s,a,p,d,h,u)+(l-d)*GK(t,e,n,r,i,s,a,p,f,h,u))}const HK={kernelName:pb,backendName:"cpu",kernelFunc:function(t){const{inputs:e,attrs:n,backend:r}=t,{axis:i}=n,{x:s}=e;mW(s,"unique");const a=r.data.get(s.dataId).values,{outputValues:o,outputShape:l,indices:h}=GH(a,i,s.shape,s.dtype);return[r.makeTensorInfo(l,s.dtype,o),r.makeTensorInfo([h.length],"int32",h)]}};const YK={kernelName:fb,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{value:i}=e;let{axis:s}=r;s<0&&(s+=i.shape.length);const a=i.shape.length,o=i.shape[s],l=new Array(a-1);let h=0;for(let t=0;t<a;t++)t!==s&&(l[h++]=i.shape[t]);const u=new Array(a).fill(0),c=i.shape.slice();c[s]=1;const d=new Array(o);for(let t=0;t<d.length;t++){u[s]=t;const e=mH({inputs:{x:i},backend:n,attrs:{begin:u,size:c}});d[t]=rY({inputs:{x:e},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(e)}return d}};const jK={kernelName:mb,backendName:"cpu",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,segmentIds:s}=e,{numSegments:a}=r;mW(i,"unsortedSegmentSum");const o=[],l=[],h=i.shape.length-s.shape.length;let u=s;for(let t=0;t<h;++t){const e=Nj({inputs:{input:u},backend:n,attrs:{dim:t+1}});u=e,l.push(e)}for(let t=0;t<a;++t){const e=Jb(t,"int32"),r=n.makeTensorInfo([],"int32",e),s=KW({inputs:{a:r,b:u},backend:n}),a=NW({inputs:{x:s},backend:n,attrs:{dtype:"float32"}}),h=LX({inputs:{a,b:i},backend:n}),c=yj({inputs:{x:h},backend:n,attrs:{axis:0,keepDims:!1}});o.push(c),l.push(r),l.push(s),l.push(a),l.push(h),l.push(c)}const c=Lq({inputs:o,backend:n,attrs:{axis:0}});return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),c}},qK=[oY,xW,hY,cY,FW,dY,pY,fY,mY,gY,vY,bY,_Y,SY,kY,RY,MY,OY,PY,aY,DY,FY,LY,VW,BY,AW,YW,UY,_W,VY,XY,YY,jY,qY,KY,ZY,JY,tj,nj,rj,ij,sj,aj,oj,hj,uj,cj,dj,pj,fj,mj,gj,xj,HH,bj,ZW,Cj,tX,Aj,rX,Lj,$j,Uj,aX,hX,Vj,zj,Gj,Wj,fX,yX,SW,Xj,GY,Yj,qj,Zj,jH,bX,TX,Jj,kX,tq,rq,sq,lq,hq,uq,dq,RX,pq,fq,mq,gq,yq,vq,xq,PX,bq,Tq,Iq,BX,UX,Cq,Aq,Mq,GX,Oq,Fq,Bq,$q,zq,ZH,jX,Gq,Wq,Xq,Hq,kW,Oj,jq,QH,eY,iY,qq,Kq,Zq,Jq,Qq,tK,nK,hH,rK,aK,oK,cK,pH,pK,mK,yK,gH,Sq,bK,wK,_K,TK,EK,SK,IK,kK,_H,CK,SH,CH,AK,RK,MK,OK,PK,BH,vj,FK,{kernelName:lb,backendName:"cpu",kernelFunc:LK},BK,$K,UK,VK,HX,HK,YK,jK,Dq];for(const t of qK)Rb(t);const KK={},ZK={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function JK(t,e){KK[t]=e}function QK(t,e){if(!(t in KK)||null!=e){const n=function(t,e){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==e?function(t){if(ey().getBool("IS_SAFARI")||"undefined"==typeof OffscreenCanvas||2!==t){if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}return new OffscreenCanvas(300,150)}(t):e;n.addEventListener("webglcontextlost",(e=>{e.preventDefault(),delete KK[t]}),!1),ey().getBool("SOFTWARE_WEBGL_ENABLED")&&(ZK.failIfMajorPerformanceCaveat=!1);if(1===t)return n.getContext("webgl",ZK)||n.getContext("experimental-webgl",ZK);return n.getContext("webgl2",ZK)}(t,e);if(null===n)return null;KK[t]=n}const n=KK[t];return null==n||n.isContextLost()?(delete KK[t],QK(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),KK[t])}var tZ,eZ,nZ;function rZ(t,e){return[e,t]}function iZ(t){const e=mg(t);return wg(Math.ceil(e/4))}function sZ(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function aZ(t,e){const n=t;let r,i,s,a,o,l,h,u,c,d;return 2===ey().getNumber("WEBGL_VERSION")?(r=n.R32F,i=n.R16F,s=n.RGBA16F,a=n.RGBA32F,o=n.RED,h=4,u=1,c=n.HALF_FLOAT,d=n.FLOAT,l=n.RGBA8):(r=t.RGBA,i=t.RGBA,s=t.RGBA,a=n.RGBA,o=t.RGBA,h=4,u=4,c=null!=e?e.HALF_FLOAT_OES:null,d=t.FLOAT,l=t.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:a,textureFormatFloat:o,downloadTextureFormat:l,downloadUnpackNumChannels:h,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:d}}function oZ(t,e){const n=e();return ey().getBool("DEBUG")&&function(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+hZ(t,e))}(t),n}!function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"}(tZ||(tZ={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(eZ||(eZ={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(nZ||(nZ={}));function lZ(t){return!!(ey().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||5.96e-8<Math.abs(t)&&Math.abs(t)<65504)}function hZ(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function uZ(t,e){return DZ(t,(()=>t.getExtension(e)),'Extension "'+e+'" not supported on this browser.')}function cZ(t,e){const n=DZ(t,(()=>t.createShader(t.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(oZ(t,(()=>t.shaderSource(n,e))),oZ(t,(()=>t.compileShader(n))),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error("Failed to compile vertex shader.");return n}function dZ(t,e){const n=DZ(t,(()=>t.createShader(t.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(oZ(t,(()=>t.shaderSource(n,e))),oZ(t,(()=>t.compileShader(n))),ey().get("ENGINE_COMPILE_ONLY"))return n;if(!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw fZ(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const pZ=/ERROR: [0-9]+:([0-9]+):/g;function fZ(t,e){const n=pZ.exec(e);if(null==n)return;const r=+n[1],i=t.split("\n"),s=i.length.toString().length+2,a=i.map(((t,e)=>Tg((e+1).toString(),s)+t));let o=0;for(let t=0;t<a.length;t++)o=Math.max(a[t].length,o);a.slice(0,r-1),a.slice(r-1,r),a.slice(r)}function mZ(t){return DZ(t,(()=>t.createProgram()),"Unable to create WebGLProgram.")}function gZ(t,e){if(oZ(t,(()=>t.linkProgram(e))),!ey().get("ENGINE_COMPILE_ONLY")&&!1===t.getProgramParameter(e,t.LINK_STATUS))throw new Error("Failed to link vertex and fragment shaders.")}function yZ(t,e){if(oZ(t,(()=>t.validateProgram(e))),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw new Error("Shader program validation failed.")}function vZ(t,e){const n=DZ(t,(()=>t.createBuffer()),"Unable to create WebGLBuffer");return oZ(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n))),oZ(t,(()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW))),n}function xZ(t,e){const n=DZ(t,(()=>t.createBuffer()),"Unable to create WebGLBuffer");return oZ(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n))),oZ(t,(()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW))),n}function bZ(){return 2===ey().getNumber("WEBGL_VERSION")?1:4}function wZ(t){return DZ(t,(()=>t.createTexture()),"Unable to create WebGLTexture.")}function _Z(t,e){const n=ey().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){throw new Error("Requested texture size "+`[${t}x${e}]`+" is invalid.")}if(t>n||e>n){throw new Error("Requested texture size "+`[${t}x${e}]`+" greater than WebGL maximum on this browser / GPU "+`[${n}x${n}]`+".")}}function TZ(t){return DZ(t,(()=>t.createFramebuffer()),"Unable to create WebGLFramebuffer.")}function EZ(t,e,n,r,i,s,a){const o=t.getAttribLocation(e,n);return-1!==o&&(oZ(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,r))),oZ(t,(()=>t.vertexAttribPointer(o,i,t.FLOAT,!1,s,a))),oZ(t,(()=>t.enableVertexAttribArray(o))),!0)}function SZ(t,e,n){FZ(t,n),oZ(t,(()=>t.activeTexture(t.TEXTURE0+n))),oZ(t,(()=>t.bindTexture(t.TEXTURE_2D,e)))}function IZ(t,e){FZ(t,e),oZ(t,(()=>t.activeTexture(t.TEXTURE0+e))),oZ(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}function kZ(t,e,n){return DZ(t,(()=>t.getUniformLocation(e,n)),'uniform "'+n+'" not present in program.')}function CZ(t,e,n){return t.getUniformLocation(e,n)}function NZ(t,e,n,r){oZ(t,(()=>SZ(t,e,r))),oZ(t,(()=>t.uniform1i(n,r)))}function AZ(t){oZ(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,null))),oZ(t,(()=>t.viewport(0,0,t.canvas.width,t.canvas.height))),oZ(t,(()=>t.scissor(0,0,t.canvas.width,t.canvas.height)))}function RZ(t,e,n){oZ(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,n))),oZ(t,(()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)))}function MZ(t,e){oZ(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,e))),oZ(t,(()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)))}function OZ(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+PZ(t,e))}function PZ(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function DZ(t,e,n){const r=oZ(t,(()=>e()));if(null==r)throw new Error(n);return r}function FZ(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n){throw new Error(`textureUnit must be in ${`[gl.TEXTURE0, gl.TEXTURE${n}]`}.`)}}function LZ(t,e=2){return mg(t.slice(0,t.length-e))}function BZ(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function $Z(t){let e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[LZ(t),...BZ(t)]),e}function UZ(t,e=!1){let n=ey().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=ey().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(r===1/0&&ey().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),e&&(n*=2,r*=2,t=t.map(((e,n)=>n>=t.length-2?og(t[n]):t[n])),1===t.length&&(t=[2,t[0]])),2!==t.length){const e=kg(t);t=e.newShape}let i=mg(t),s=null;t.length<=1&&i<=n?s=[1,i]:2===t.length&&t[0]<=n&&t[1]<=n?s=t:3===t.length&&t[0]*t[1]<=n&&t[2]<=n?s=[t[0]*t[1],t[2]]:3===t.length&&t[0]<=n&&t[1]*t[2]<=n?s=[t[0],t[1]*t[2]]:4===t.length&&t[0]*t[1]*t[2]<=n&&t[3]<=n?s=[t[0]*t[1]*t[2],t[3]]:4===t.length&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(s=[t[0],t[1]*t[2]*t[3]]);const a=null!=s&&Math.max(...s)>r&&Math.min(...s)<=(e?2:1)&&Math.min(...s)>0;if(null==s||a)if(e){const e=LZ(t);let n=2,r=2;t.length&&([n,r]=BZ(t)),i=e*(n/2)*(r/2),s=wg(i).map((t=>2*t))}else s=wg(i);return s}function VZ(t){return t%2==0}function zZ(t,e){if(vg(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){const n=t[t.length-1],r=e[e.length-1];if(n===r)return!0;if(VZ(n)&&VZ(r)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&VZ(t[0])&&VZ(e[0])}let GZ,WZ;function XZ(t){if(null==GZ){const e=QK(t);GZ=e.getParameter(e.MAX_TEXTURE_SIZE)}return GZ}function HZ(){GZ=null}function YZ(){WZ=null}function jZ(t){if(null==WZ){const e=QK(t);WZ=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,WZ)}function qZ(t){if(0===t)return 0;let e;const n=QK(t);return e=KZ(n,"EXT_disjoint_timer_query_webgl2")&&2===t?2:KZ(n,"EXT_disjoint_timer_query")?1:0,e}function KZ(t,e){return null!=t.getExtension(e)}function ZZ(t){try{if(null!=QK(t))return!0}catch(t){return!1}return!1}function JZ(t){if(0===t)return!1;const e=QK(t);if(1===t){if(!KZ(e,"OES_texture_float"))return!1}else if(!KZ(e,"EXT_color_buffer_float"))return!1;return tJ(e)}function QZ(t){if(0===t)return!1;const e=QK(t);if(1!==t){if(KZ(e,"EXT_color_buffer_float"))return tJ(e);const t="EXT_color_buffer_half_float";if(KZ(e,t)){const n=e.getExtension(t);return function(t,e){const n=aZ(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);const i=1,s=1;t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,i,s,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const a=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(a),o}(e,n)}return!1}if(!KZ(e,"OES_texture_float"))return!1;if(!KZ(e,"WEBGL_color_buffer_float"))return!1;return tJ(e)}function tJ(t){const e=aZ(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),i}function eJ(t){if(2!==t)return!1;return null!=QK(t).fenceSync}function nJ(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>{null!=t&&dg("complex64"!==t.dtype,(()=>`${e} does not support complex64 tensors in the WebGL backend.`))}))}const rJ=ey();function iJ(){let t,e,n,r,i,s,a,o,l,h;return 2===ey().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",r="in",i="texture",s="outputColor",a="out vec4 outputColor;",o=ey().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",l="",h="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",r="varying",i="texture2D",s="gl_FragColor",a="",o="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",l="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",h="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:i,output:s,defineOutput:a,defineSpecialNaN:o,defineSpecialInf:l,defineRound:h}}function sJ(t,e,n="index"){const r=Vg(e);return r.map(((e,i)=>`${`int ${t[i]} = ${n} / ${e}`}; ${i===r.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${e}`:`index -= ${t[i]} * ${e}`};`)).join("")}function aJ(t,e,n="index"){const r=Vg(e);return r.map(((e,i)=>`${`int ${t[i]} = ${n} / outShapeStrides[${i}]`}; ${i===r.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * outShapeStrides[${i}]`:`index -= ${t[i]} * outShapeStrides[${i}]`};`)).join("")}function oJ(t,e,n="index"){const r=t.map(((t,e)=>e)),i=function(t,e){const n=t.length,r=t.map((t=>`${e}[${t}]`)),i=new Array(n-1);i[n-2]=r[n-1];for(let t=n-3;t>=0;--t)i[t]=`(${i[t+1]} * ${r[t+1]})`;return i}(r,e);return i.map(((e,r)=>`${`int ${t[r]} = ${n} / ${i[r]}`}; ${r===i.length-1?`int ${t[r+1]} = ${n} - ${t[r]} * ${i[r]}`:`index -= ${t[r]} * ${i[r]}`};`)).join("")}function lJ(t){const e=Vg(t).map((t=>t.toString()));return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;\n  }\n`}rJ.registerFlag("HAS_WEBGL",(()=>rJ.getNumber("WEBGL_VERSION")>0)),rJ.registerFlag("WEBGL_VERSION",(()=>ZZ(2)?2:ZZ(1)?1:0)),rJ.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),rJ.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===rJ.get("WEBGL_VERSION"))),rJ.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),rJ.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),rJ.registerFlag("WEBGL_PACK",(()=>rJ.getBool("HAS_WEBGL"))),rJ.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>rJ.getBool("WEBGL_PACK"))),rJ.registerFlag("WEBGL_PACK_CLIP",(()=>rJ.getBool("WEBGL_PACK"))),rJ.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>rJ.getBool("WEBGL_PACK"))),rJ.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>rJ.getBool("WEBGL_PACK"))),rJ.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>rJ.getBool("WEBGL_PACK"))),rJ.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>rJ.getBool("WEBGL_PACK"))),rJ.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>rJ.getBool("WEBGL_PACK"))),rJ.registerFlag("WEBGL_PACK_REDUCE",(()=>rJ.getBool("WEBGL_PACK"))),rJ.registerFlag("WEBGL_LAZILY_UNPACK",(()=>rJ.getBool("WEBGL_PACK"))),rJ.registerFlag("WEBGL_CONV_IM2COL",(()=>rJ.getBool("WEBGL_PACK"))),rJ.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>XZ(rJ.getNumber("WEBGL_VERSION")))),rJ.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>jZ(rJ.getNumber("WEBGL_VERSION")))),rJ.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const t=rJ.getNumber("WEBGL_VERSION");return 0===t?0:qZ(t)})),rJ.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>rJ.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Ww())),rJ.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>JZ(rJ.getNumber("WEBGL_VERSION")))),rJ.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!rJ.getBool("WEBGL_FORCE_F16_TEXTURES")&&rJ.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),rJ.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>QZ(rJ.getNumber("WEBGL_VERSION")))),rJ.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>eJ(rJ.getNumber("WEBGL_VERSION")))),rJ.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>rJ.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),rJ.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)})),rJ.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>Ww()?1:-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)})),rJ.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128)),rJ.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(()=>!1)),rJ.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e5)),rJ.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(()=>128)),rJ.registerFlag("WEBGL_EXP_CONV",(()=>!1)),rJ.registerFlag("SOFTWARE_WEBGL_ENABLED",(()=>rJ.getBool("IS_TEST"))),rJ.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(()=>1/0)),rJ.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(()=>!1)),rJ.registerFlag("WEBGL2_ISNAN_CUSTOM",(()=>!1)),rJ.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));const hJ="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:uJ}=y;function cJ(t,e,n){const r=[];if(t.forEach((t=>{const e=mg(t.shapeInfo.logicalShape);if(t.shapeInfo.isUniform?r.push(`uniform float ${t.name}${e>1?`[${e}]`:""};`):(r.push(`uniform sampler2D ${t.name};`),r.push(`uniform int offset${t.name};`)),n.enableShapeUniforms){const{uniformShape:e}=_J(n.packedInputs,t.shapeInfo.logicalShape,t.shapeInfo.texShape);switch(e.length){case 1:r.push(`uniform int ${t.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${t.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${t.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${t.name}Shape;`)}r.push(`uniform ivec2 ${t.name}TexShape;`)}})),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((t=>{r.push(`uniform ${t.type} ${t.name}${t.arrayIndex?`[${t.arrayIndex}]`:""};`)}));const i=r.join("\n"),s=t.map((t=>function(t,e,n=!1,r){let i="";i+=n?pJ(t,r):dJ(t,r);const s=t.shapeInfo.logicalShape,a=e.logicalShape;s.length<=a.length&&(i+=n?function(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",s=t.shapeInfo.logicalShape.length,a=e.logicalShape.length,o=uJ(t.shapeInfo.logicalShape,e.logicalShape),l=wJ(a),h=a-s;let u;const c=["x","y","z","w","u","v"];u=0===s?"":a<2&&o.length>=1?"coords = 0;":o.map((t=>`coords.${c[t+h]} = 0;`)).join("\n");let d="";d=a<2&&s>0?"coords":t.shapeInfo.logicalShape.map(((t,e)=>`coords.${c[e+h]}`)).join(", ");let p="return outputValue;";const f=1===mg(t.shapeInfo.logicalShape),m=1===mg(e.logicalShape);if(1!==s||f||m){if(f&&!m)p=1===a?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(o.length){const t=s-2,e=s-1;o.indexOf(t)>-1&&o.indexOf(e)>-1?p="return vec4(outputValue.x);":o.indexOf(t)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":o.indexOf(e)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${i}() {\n      ${l} coords = getOutputCoords();\n      ${u}\n      vec4 outputValue = get${r}(${d});\n      ${p}\n    }\n  `}(t,e):function(t,e){const n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",s=e.texShape,a=t.shapeInfo.texShape,o=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&o===l&&null==t.shapeInfo.flatOffset&&vg(a,s))return`\n      float ${i}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const h=wJ(l),u=uJ(t.shapeInfo.logicalShape,e.logicalShape),c=l-o;let d;const p=["x","y","z","w","u","v"];d=0===o?"":l<2&&u.length>=1?"coords = 0;":u.map((t=>`coords.${p[t+c]} = 0;`)).join("\n");let f="";f=l<2&&o>0?"coords":t.shapeInfo.logicalShape.map(((t,e)=>`coords.${p[e+c]}`)).join(", ");return`\n    float ${i}() {\n      ${h} coords = getOutputCoords();\n      ${d}\n      return get${r}(${f});\n    }\n  `}(t,e));return i}(t,e,n.packedInputs,n.enableShapeUniforms))).join("\n"),a=e.texShape,o=iJ(),l=function(t){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${t.texture2D}(textureSampler, uv).r;\n    }\n  `}(o);let h,u,c=function(t){return`${t.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${t.varyingFs} vec2 resultUV;\n    ${t.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${t.defineSpecialNaN}\n    ${t.defineSpecialInf}\n    ${t.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${fJ}\n    ${mJ}\n    ${gJ}\n  `}(o);e.isPacked?(h=function(t,e,n){switch(t.length){case 0:return vJ();case 1:return function(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${r[1]}.0);\n      }\n    `;if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${r[0]}.0);\n      }\n    `;if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);\n    }\n  `}(0,e,n);case 2:return function(t,e,n){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(vg(t,e))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));\n      }\n    `;const i=Math.ceil(t[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}(t,e,n);case 3:return function(t,e,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[2]/2),s=i*Math.ceil(t[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      int b = index / ${s};\n      index -= b * ${s};\n\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}(t,e,n);default:return function(t,e,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[t.length-1]/2),s=i*Math.ceil(t[t.length-2]/2);let a=s,o="",l="b, r, c";for(let e=2;e<t.length-1;e++)a*=t[t.length-e-1],o=`\n      int b${e} = index / ${a};\n      index -= b${e} * ${a};\n    `+o,l=`b${e}, `+l;return`\n    ivec${t.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      ${o}\n\n      int b = index / ${s};\n      index -= b * ${s};\n\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec${t.length}(${l});\n    }\n  `}(t,e,n)}}(e.logicalShape,a,n.enableShapeUniforms),u=function(t){return`\n    void setOutput(vec4 val) {\n      ${t.output} = val;\n    }\n  `}(o)):(h=function(t,e,n){switch(t.length){case 0:return vJ();case 1:return function(t,e,n){if(1===e[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.x * ${e[1]}.0);\n      }\n    `;if(1===e[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.y * ${e[0]}.0);\n      }\n    `;if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      return resTexRC.x * ${e[1]} + resTexRC.y;\n    }\n  `}(0,e,n);case 2:return function(t,e,n){if(vg(t,e))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));\n      }\n    `;if(1===t[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `;if(1===t[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `;if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      int r = index / ${t[1]};\n      int c = index - r * ${t[1]};\n      return ivec2(r, c);\n    }\n  `}(t,e,n);case 3:return function(t,e,n){if(n){return`\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ${aJ(["r","c","d"],t)}\n    return ivec3(r, c, d);\n  }\n`}const r=sJ(["r","c","d"],t);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${r}\n      return ivec3(r, c, d);\n    }\n  `}(t,e,n);case 4:return function(t,e,n){if(n){return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ${aJ(["r","c","d","d2"],t)}\n      return ivec4(r, c, d, d2);\n    }\n  `}const r=sJ(["r","c","d","d2"],t);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${r}\n      return ivec4(r, c, d, d2);\n    }\n  `}(t,e,n);case 5:return function(t,e){const n=sJ(["r","c","d","d2","d3"],t);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},\n                             ${e[1]}));\n\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}(t,e);case 6:return function(t,e){const n=sJ(["r","c","d","d2","d3","d4"],t);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}(e.logicalShape,a,n.enableShapeUniforms),u=function(t){return`\n    void setOutput(float val) {\n      ${t.output} = vec4(val, 0, 0, 0);\n    }\n  `}(o)),n.packedInputs&&(c+=yJ);return[c,l,u,i,h,s,n.userCode].join("\n")}function dJ(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;const[i,s]=t.shapeInfo.texShape;if(1===i&&1===s)return`\n      float ${r}() {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const a=xJ(n);if(e)return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${a});\n      return sampleTexture(${n}, uv);\n    }\n  `;const[o,l]=t.shapeInfo.texShape;return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${o}, ${l}, ${a});\n      return sampleTexture(${n}, uv);\n    }\n  `}(t,e);case 1:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`\n      float ${r}(int index) {\n        ${bJ(t)}\n      }\n    `;const i=t.shapeInfo.texShape,s=i[0],a=i[1];if(1===a&&1===s)return`\n      float ${r}(int index) {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const o=xJ(n);if(1===a)return e?`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / float(${n}TexShape[0]));\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / ${s}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(1===s)return e?`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${o}) + 0.5) / float(${n}TexShape[1]), 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${o}) + 0.5) / ${a}.0, 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(e)return`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `;return`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${s}, ${a}, index + ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `}(t,e);case 2:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t.shapeInfo.texShape;if(null!=s&&vg(n,s)){if(e)return`\n      float ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `;const t=s[0];return`\n    float ${i}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${s[1]}.0, ${t}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `}const{newShape:a,keptDims:o}=kg(n),l=a;if(l.length<n.length){const n=["row","col"];return`\n      ${dJ(TJ(t,l),e)}\n      float ${i}(int row, int col) {\n        return ${i}(${EJ(n,o)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));\n        ${bJ(t)}\n      }\n    `;const h=s[0],u=s[1],c=xJ(r);if(1===u)return e?`\n      float ${i}(int row, int col) {\n        float index = dot(vec3(row, col, ${c}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col) {\n      float index = dot(vec3(row, col, ${c}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${h}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;if(1===h)return e?`\n      float ${i}(int row, int col) {\n        float index = dot(vec3(row, col, ${c}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col) {\n      float index = dot(vec3(row, col, ${c}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);\n      return sampleTexture(${r}, uv);\n    }\n  `;if(e)return`\n      float ${i}(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${r}Shape[1] + col + ${c};\n        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n        return sampleTexture(${r}, uv);\n      }\n    `;return`\n  float ${i}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${n[1]} + col + ${c};\n    vec2 uv = uvFromFlat(${h}, ${u}, index);\n    return sampleTexture(${r}, uv);\n  }\n`}(t,e);case 3:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[1]*n[2],a=n[2],{newShape:o,keptDims:l}=kg(n),h=o;if(h.length<n.length){const n=["row","col","depth"];return`\n        ${dJ(TJ(t,h),e)}\n        float ${i}(int row, int col, int depth) {\n          return ${i}(${EJ(n,l)});\n        }\n      `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${s}, ${a}, 1)));\n        ${bJ(t)}\n      }\n    `;const u=t.shapeInfo.texShape,c=u[0],d=u[1],p=t.shapeInfo.flatOffset;if(d===s&&null==p)return e?`\n      float ${i}(int row, int col, int depth) {\n        int stride1 = ${r}Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n        float ${i}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${a}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${d}.0, ${c}.0);\n          return sampleTexture(${r}, uv);\n        }\n      `;if(d===a&&null==p)return e?`\n      float ${i}(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${c}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;const f=xJ(r);if(e)return`\n    float ${i}(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ${r}Shape[1] * ${r}Shape[2];\n      int stride1 = ${r}Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ${f};\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n      return sampleTexture(${r}, uv);\n    }\n    `;return`\n      float ${i}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${s} + col * ${a} + depth + ${f};\n        vec2 uv = uvFromFlat(${c}, ${d}, index);\n        return sampleTexture(${r}, uv);\n      }\n  `}(t,e);case 4:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[3],a=n[2]*s,o=n[1]*a,{newShape:l,keptDims:h}=kg(n);if(l.length<n.length){const n=["row","col","depth","depth2"];return`\n      ${dJ(TJ(t,l),e)}\n      float ${i}(int row, int col, int depth, int depth2) {\n        return ${i}(${EJ(n,h)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${o}, ${a}, ${s}, 1)));\n        ${bJ(t)}\n      }\n    `;const u=t.shapeInfo.flatOffset,c=t.shapeInfo.texShape,d=c[0],p=c[1],f=`int stride2 = ${r}Shape[3];`,m=`int stride1 = ${r}Shape[2] * stride2;`,g=`int stride0 = ${r}Shape[1] * stride1;`;if(p===o&&null==u)return e?`\n      float ${i}(int row, int col, int depth, int depth2) {\n        ${f}\n        ${m}\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${a}, ${s}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${d}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;if(p===s&&null==u)return e?`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${n[1]*n[2]}, ${n[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${d}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;const y=xJ(r);if(e)return`\n    float ${i}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ${f}\n      ${m}\n      ${g}\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `;return`\n    float ${i}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${o} + col * ${a} +\n          depth * ${s} + depth2;\n      vec2 uv = uvFromFlat(${d}, ${p}, index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `}(t,e);case 5:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[4],s=e[3]*i,a=e[2]*s,o=e[1]*a,{newShape:l,keptDims:h}=kg(e);if(l.length<e.length){const e=["row","col","depth","depth2","depth3"];return`\n      ${dJ(TJ(t,l))}\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        return ${r}(${EJ(e,h)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${o}, ${a}, ${s}, ${i})) +\n          depth3;\n        ${bJ(t)}\n      }\n    `;const u=t.shapeInfo.flatOffset,c=t.shapeInfo.texShape,d=c[0],p=c[1];if(p===o&&null==u)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${a}, ${s}, ${i}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${d}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(p===i&&null==u)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${e[1]*e[2]*e[3]},\n               ${e[2]*e[3]}, ${e[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${d}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const f=xJ(n);return`\n    float ${r}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${o} + col * ${a} + depth * ${s} +\n          depth2 * ${i} + depth3 + ${f};\n      vec2 uv = uvFromFlat(${d}, ${p}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(t);case 6:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:s}=kg(e);if(i.length<e.length){const e=["row","col","depth","depth2","depth3","depth4"];return`\n      ${dJ(TJ(t,i))}\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${r}(${EJ(e,s)});\n      }\n    `}const a=e[5],o=e[4]*a,l=e[3]*o,h=e[2]*l,u=e[1]*h;if(t.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${u}, ${h}, ${l}, ${o})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${a}, 1)));\n        ${bJ(t)}\n      }\n    `;const c=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,p=d[0],f=d[1];if(f===u&&null==c)return`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${h}, ${l}, ${o}, ${a})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(f===a&&null==c)return`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${e[1]*e[2]*e[3]*e[4]},\n               ${e[2]*e[3]*e[4]},\n               ${e[3]*e[4]},\n               ${e[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${f}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const m=xJ(n);return`\n    float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${u} + col * ${h} + depth * ${l} +\n          depth2 * ${o} + depth3 * ${a} + depth4 + ${m};\n      vec2 uv = uvFromFlat(${p}, ${f}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function pJ(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return function(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=iJ();return`\n    vec4 ${n}() {\n      return ${r.texture2D}(${e}, halfCR);\n    }\n  `}(t);case 1:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,s=iJ();if(e)return`\n    vec4 ${r}(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ${s.texture2D}(${n}, uv);\n    }\n  `;const a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`\n    vec4 ${r}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${a[0]}, ${a[1]}, index);\n      return ${s.texture2D}(${n}, uv);\n    }\n  `}(t,e);case 2:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t.shapeInfo.texShape,a=s[0],o=s[1],l=iJ();if(null!=s&&vg(n,s))return e?`\n      vec4 ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n\n        return ${l.texture2D}(${r}, uv);\n      }\n    `:`\n      vec4 ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${o}.0, ${a}.0);\n\n        return ${l.texture2D}(${r}, uv);\n      }\n    `;if(e)return`\n    vec4 ${i}(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ${l.texture2D}(${r}, uv);\n    }\n  `;const h=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],u=Math.ceil(n[1]/2);return`\n    vec4 ${i}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${u}, ${h[0]}, ${h[1]}, row, col);\n      return ${l.texture2D}(${r}, uv);\n    }\n  `}(t,e);case 3:return function(t,e){const n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t.shapeInfo.texShape,a=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(1===n[0]){const r=[1,2],s=["b","row","col"];return`\n        ${pJ(TJ(t,n.slice(1)),e)}\n        vec4 ${i}(int b, int row, int col) {\n          return ${i}(${EJ(s,r)});\n        }\n      `}const o=iJ();if(e)return`\n    vec4 ${i}(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ${o.texture2D}(${r}, uv);\n    }\n  `;const l=a[0],h=a[1],u=Math.ceil(n[2]/2),c=u*Math.ceil(n[1]/2);return`\n    vec4 ${i}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${l}, ${h}, ${c}, ${u}, b, row, col);\n      return ${o.texture2D}(${r}, uv);\n    }\n  `}(t,e);default:return function(t,e){const n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=iJ();if(e)return`\n    vec4 ${r}(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ${n}Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${n}, uv);\n    }\n  `;const s=t.shapeInfo.logicalShape,a=s.length,o=t.shapeInfo.texShape,l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],h=l[0],u=l[1],c=Math.ceil(s[a-1]/2);let d=c*Math.ceil(s[a-2]/2),p="int b, int row, int col",f=`b * ${d} + (row / 2) * ${c} + (col / 2)`;for(let t=2;t<a-1;t++)p=`int b${t}, `+p,d*=s[a-t-1],f=`b${t} * ${d} + `+f;return`\n    vec4 ${r}(${p}) {\n      int index = ${f};\n      int texR = index / ${u};\n      int texC = index - texR * ${u};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${h});\n      return ${i.texture2D}(${n}, uv);\n    }\n  `}(t,e)}}const fJ="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",mJ="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",gJ="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",yJ="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function vJ(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function xJ(t){return`offset${t}`}function bJ(t){const e=t.name,n=mg(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${e}[i];\n      }\n    }\n  `}function wJ(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function _J(t,e,n){const{newShape:r,keptDims:i}=kg(e),s=e.length,a=t&&3===s&&1===e[0],o=a?e.slice(1):r,l=!t&&s>1&&!vg(e,n)&&r.length<s||a;return{useSqueezeShape:l,uniformShape:l?o:e,keptDims:i}}function TJ(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function EJ(t,e){return e.map((e=>t[e])).join(", ")}function SJ(t,e,n){const r=[],i=[];let s,a,o,l=null,h=null;h=t.getUniformLocation(n,"NAN",!1),1===ey().getNumber("WEBGL_VERSION")&&(l=t.getUniformLocation(n,"INFINITY",!1));const u=!1;for(const i of e.variableNames){const s={name:i,uniform:t.getUniformLocation(n,i,u),offset:t.getUniformLocation(n,`offset${i}`,u)};e.enableShapeUniforms&&(s.shape=t.getUniformLocation(n,`${i}Shape`,u),s.texShape=t.getUniformLocation(n,`${i}TexShape`,u)),r.push(s)}if(e.enableShapeUniforms&&(s=t.getUniformLocation(n,"outShape",u),o=t.getUniformLocation(n,"outShapeStrides",u),a=t.getUniformLocation(n,"outTexShape",u)),e.customUniforms)for(const r of e.customUniforms)i.push(t.getUniformLocation(n,r.name,u));return{variablesLocations:r,customUniformLocations:i,infLoc:l,nanLoc:h,outShapeLocation:s,outShapeStridesLocation:o,outTexShapeLocation:a}}function IJ(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach(((t,n)=>{const r=t.logicalShape,i=e[n],s=i.shape;if(!vg(r,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${s} must match`);if(t.isUniform&&i.isUniform)return;const a=t.texShape,o=i.isUniform?null:i.texData.texShape;if(!vg(a,o))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${o} must match`)}))}function kJ(t){return ey().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}class CJ{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=tZ.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=iJ();this.outputShape=t,this.enableShapeUniforms=kJ(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?aJ(["r","c","d"],t):sJ(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${e.output} = result;\n      }\n    `}}class NJ{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=tZ.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const e=iJ();this.outputShape=t,this.enableShapeUniforms=kJ(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?aJ(["r","c","d"],t):sJ(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${e.output} = result;\n      }\n    `}}class AJ{constructor(t){this.variableNames=["A"],this.outTexUsage=eZ.DOWNLOAD;const e=iJ();this.outputShape=t,this.userCode=`\n      ${hJ}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${e.output} = encode_float(x);\n      }\n    `}}class RJ{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=eZ.DOWNLOAD;const e=iJ();this.outputShape=t,this.userCode=`\n      ${hJ}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${e.output} = encode_float(x);\n      }\n    `}}const MJ={R:0,G:1,B:2,A:3};class OJ{constructor(t,e=!1,n="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=iJ();this.outputShape=t,this.enableShapeUniforms=kJ(this.outputShape.length);let i="result";e&&(i="floor(result * 255. + 0.5)");let s="";for(let t=0;t<n.length;t++){const e=n[t];s+=`\n          if(offset == ${t}) {\n            result = values[${MJ[e]}];\n          }`}this.userCode=`\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":lJ(t)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ${n.length});\n\n        flatIndex = idiv(flatIndex, ${n.length}, 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ${r.texture2D}(A, uv);\n          ${s}\n        }\n        ${r.output} = vec4(${i}, 0., 0., 0.);\n      }\n    `}}class PJ{constructor(t,e=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=iJ();this.outputShape=t,this.enableShapeUniforms=kJ(this.outputShape.length);let r="",i="result";e&&(i="floor(result * 255. + 0.5)");for(let e=0;e<=1;e++)for(let i=0;i<=1;i++){const s=2*e+i;r+=`\n          localCoords = coords;\n          if(localCoords[2] + ${i} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {\n          localCoords[2] += ${i};\n          if (localCoords[1] + ${e} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {\n            localCoords[1] += ${e};\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ${n.texture2D}(A, uv);\n\n            if (offset == 0) {\n              result[${s}] = values[0];\n            } else if (offset == 1) {\n              result[${s}] = values[1];\n            } else if (offset == 2) {\n              result[${s}] = values[2];\n            } else {\n              result[${s}] = values[3];\n            }\n          }\n        }\n        `}this.userCode=`\n        ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":lJ(t)}\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ${r}\n\n          ${n.output} = ${i};\n        }\n    `}}function DJ(t){const e=iJ();return cZ(t,`${e.version}\n    precision highp float;\n    ${e.attribute} vec3 clipSpacePos;\n    ${e.attribute} vec2 uv;\n    ${e.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}function FJ(t){return vZ(t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function LJ(t){return xZ(t,new Uint16Array([0,1,2,2,1,3]))}function BJ(t,e,n,r,i,s){_Z(e,n);const a=wZ(t),o=t.TEXTURE_2D;return oZ(t,(()=>t.bindTexture(o,a))),oZ(t,(()=>t.texParameteri(o,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE))),oZ(t,(()=>t.texParameteri(o,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE))),oZ(t,(()=>t.texParameteri(o,t.TEXTURE_MIN_FILTER,t.NEAREST))),oZ(t,(()=>t.texParameteri(o,t.TEXTURE_MAG_FILTER,t.NEAREST))),1===ey().getNumber("WEBGL_VERSION")?oZ(t,(()=>t.texImage2D(o,0,r,e,n,0,i,s,null))):oZ(t,(()=>t.texStorage2D(o,1,r,e,n))),oZ(t,(()=>t.bindTexture(t.TEXTURE_2D,null))),{texture:a,texShape:[n,e]}}function $J(t){return t.internalFormatFloat}function UJ(t,e,n,r){const[i,s]=rZ(e,n);return BJ(t,i,s,$J(r),r.textureFormatFloat,t.FLOAT)}function VJ(t){return t.internalFormatHalfFloat}function zJ(t,e,n,r){const[i,s]=rZ(e,n);return BJ(t,i,s,VJ(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function GJ(t){return t.downloadTextureFormat}function WJ(t,e,n,r){const[i,s]=rZ(e,n);return BJ(t,i,s,GJ(r),t.RGBA,t.UNSIGNED_BYTE)}function XJ(t){return t.internalFormatPackedFloat}function HJ(t,e,n,r){const[i,s]=sZ(e,n);return BJ(t,i,s,XJ(r),t.RGBA,t.FLOAT)}function YJ(t){return t.internalFormatPackedHalfFloat}function jJ(t,e,n,r){const[i,s]=sZ(e,n);return BJ(t,i,s,YJ(r),t.RGBA,r.textureTypeHalfFloat)}function qJ(t,e,n){oZ(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n)));return EZ(t,e,"clipSpacePos",n,3,20,0)&&EZ(t,e,"uv",n,2,20,12)}function KJ(t,e,n,r,i,s){let a,o,l;oZ(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),i instanceof Uint8Array?(a=new Uint8Array(n*r*4),o=t.UNSIGNED_BYTE,l=t.RGBA):(a=new Float32Array(n*r*4),o=t.FLOAT,l=s.internalFormatPackedFloat),a.set(i),2===ey().getNumber("WEBGL_VERSION")?oZ(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,t.RGBA,o,a))):oZ(t,(()=>t.texImage2D(t.TEXTURE_2D,0,l,n,r,0,t.RGBA,o,a))),oZ(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}function ZJ(t,e,n){oZ(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),n.data instanceof Uint8Array?2===ey().getNumber("WEBGL_VERSION")?oZ(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data))):oZ(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data))):2===ey().getNumber("WEBGL_VERSION")?oZ(t,(()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n))):oZ(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n))),oZ(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}function JJ(t,e,n,r){const i=t.createBuffer();oZ(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,i)));const s=16*e*n;return oZ(t,(()=>t.bufferData(t.PIXEL_PACK_BUFFER,s,t.STREAM_READ))),oZ(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0))),oZ(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null))),i}function QJ(t,e,n){const r=t,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function tQ(t,e,n,r){const[i,s]=rZ(e,n),a=new Uint8Array(e*n*4);return oZ(t,(()=>t.readPixels(0,0,i,s,r.downloadTextureFormat,t.UNSIGNED_BYTE,a))),new Float32Array(a.buffer)}function eQ(t,e,n,r,i,s,a,o){const l=t,h=new Float32Array(function(t,e){const[n,r]=sZ(t,e);return n*r*4}(s,a));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,h),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),h}function nQ(t,e,n){const r=new Float32Array(e*n*4);return oZ(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,r))),r}class rQ{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const e=ey().getNumber("WEBGL_VERSION");if(null!=t?(this.gl=t,JK(e,t)):this.gl=QK(e),t=this.gl,2===ey().getNumber("WEBGL_VERSION")){const e=t;this.createVertexArray=()=>oZ(e,(()=>e.createVertexArray())),this.bindVertexArray=t=>oZ(e,(()=>e.bindVertexArray(t))),this.deleteVertexArray=t=>oZ(e,(()=>e.deleteVertexArray(t))),this.getVertexArray=()=>oZ(e,(()=>e.getParameter(e.VERTEX_ARRAY_BINDING)))}else if(null!=t){const e=t.getExtension("OES_vertex_array_object");if(null==e)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>oZ(t,(()=>e.createVertexArrayOES())),this.bindVertexArray=n=>oZ(t,(()=>e.bindVertexArrayOES(n))),this.deleteVertexArray=n=>oZ(t,(()=>e.deleteVertexArrayOES(n))),this.getVertexArray=()=>oZ(t,(()=>t.getParameter(e.VERTEX_ARRAY_BINDING_OES)))}let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===ey().getNumber("WEBGL_VERSION")){const t="OES_texture_float",e="OES_texture_half_float";if(this.textureFloatExtension=uZ(this.gl,t),KZ(this.gl,e))this.textureHalfFloatExtension=uZ(this.gl,e);else if(ey().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),KZ(this.gl,r))this.colorBufferHalfFloatExtension=uZ(this.gl,r);else if(ey().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",KZ(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!KZ(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=FJ(this.gl),this.indexBuffer=LJ(this.gl),this.framebuffer=TZ(this.gl),this.textureConfig=aZ(this.gl,this.textureHalfFloatExtension)}get debug(){return ey().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program,this.outputTexture;const t=this.gl;oZ(t,(()=>t.finish())),oZ(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,null))),oZ(t,(()=>t.deleteFramebuffer(this.framebuffer))),oZ(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,null))),oZ(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null))),oZ(t,(()=>t.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),UJ(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),zJ(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),WJ(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),ZJ(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,n,r){this.throwIfDisposed(),KJ(this.gl,t,e,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),jJ(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),HJ(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(MZ(this.gl,this.framebuffer),this.outputTexture=null),oZ(this.gl,(()=>this.gl.deleteTexture(t)))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>tQ(this.gl,e,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(t,e,n,r,i,s){return eQ(this.gl,t,0,0,0,i,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,e){return QJ(this.gl,t,e)}createBufferFromTexture(t,e,n){this.bindTextureToFrameBuffer(t);const r=JJ(this.gl,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,n;if(ey().getBool("WEBGL_FENCE_API_ENABLED")){const r=t,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=()=>{const t=r.clientWaitSync(i,0,0);return t===r.ALREADY_SIGNALED||t===r.CONDITION_SATISFIED},e=i}else ey().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(e,ey().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:e,isFencePassed:n}}downloadMatrixFromPackedTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>nQ(this.gl,e,n)))}createProgram(t){this.throwIfDisposed();const e=this.gl;null==this.vertexShader&&(this.vertexShader=DJ(e));const n=mZ(e);oZ(e,(()=>e.attachShader(n,this.vertexShader))),oZ(e,(()=>e.attachShader(n,t))),gZ(e,n);const r=Object.assign(n,{vao:this.createVertexArray()});return this.debug&&yZ(e,r),r}buildVao(t){this.setProgram(t),this.bindVertexArray(t.vao);const e=this.gl;oZ(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer))),qJ(e,t,this.vertexBuffer)}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&(oZ(this.gl,(()=>this.gl.deleteProgram(t))),this.deleteVertexArray(t.vao))}setProgram(t){this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&yZ(this.gl,this.program),oZ(this.gl,(()=>this.gl.useProgram(t)))}getUniformLocation(t,e,n=!0){return this.throwIfDisposed(),n?kZ(this.gl,t,e):CZ(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),oZ(this.gl,(()=>this.gl.getAttribLocation(t,e)))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),NZ(this.gl,t,e,n)}setOutputMatrixTexture(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)}setOutputPackedMatrixTexture(t,e,n){this.throwIfDisposed();const[r,i]=sZ(e,n);this.setOutputMatrixTextureDriver(t,r,i)}setOutputMatrixWriteRegion(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)}setOutputPackedMatrixWriteRegion(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&yZ(this.gl,this.program),OZ(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;if(this.debug){this.getVertexArray();this.debugValidate()}oZ(t,(()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),oZ(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=uZ(this.gl,2===ey().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===ey().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}const t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(2===ey().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2();return void t.endQuery(e.TIME_ELAPSED_EXT)}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await Eg((()=>this.disposed||this.isQueryAvailable(t,ey().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(t,ey().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,e){if(0===e)return null;if(2===e){const e=this.gl;return e.getQueryParameter(t,e.QUERY_RESULT)/1e6}{const e=this.getQueryTimerExtensionWebGL1();return e.getQueryObjectEXT(t,e.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,e){if(0===e)return!0;if(2===e){const e=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const e=this.getQueryTimerExtensionWebGL1(),n=e.getQueryObjectEXT(t,e.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(e.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(t){return new Promise((e=>{this.addItemToPoll((()=>t.isFencePassed()),(()=>e()))}))}pollItems(){const t=function(t){let e=0;for(;e<t.length;++e){if(!t[e]())break}return e-1}(this.itemsToPoll.map((t=>t.isDoneFn)));for(let e=0;e<=t;++e){const{resolveFn:t}=this.itemsToPoll[e];t()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in ey().platform&&(n=ey().platform.setTimeoutCustom.bind(ey().platform)),Eg((()=>(this.pollItems(),0===this.itemsToPoll.length)),(()=>0),null,n)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),RZ(this.gl,t,this.framebuffer),this.debug&&OZ(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(RZ(this.gl,this.outputTexture,this.framebuffer),this.debug&&OZ(this.gl)):MZ(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);const n=e();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(t,e,n){this.throwIfDisposed();const r=this.gl;RZ(r,t,this.framebuffer),this.debug&&OZ(r),this.outputTexture=t,oZ(r,(()=>r.viewport(0,0,e,n))),oZ(r,(()=>r.scissor(0,0,e,n)))}setOutputMatrixWriteRegionDriver(t,e,n,r){this.throwIfDisposed(),oZ(this.gl,(()=>this.gl.scissor(t,e,n,r)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{addImpl:iQ,bincountImpl:sQ,bincountReduceImpl:aQ,bitwiseAndImpl:oQ,castImpl:lQ,ceilImpl:hQ,concatImpl:uQ,equalImpl:cQ,expImpl:dQ,expm1Impl:pQ,floorImpl:fQ,gatherNdImpl:mQ,gatherV2Impl:gQ,greaterImpl:yQ,greaterEqualImpl:vQ,lessImpl:xQ,lessEqualImpl:bQ,linSpaceImpl:wQ,logImpl:_Q,maxImpl:TQ,maximumImpl:EQ,minimumImpl:SQ,multiplyImpl:IQ,negImpl:kQ,notEqualImpl:CQ,prodImpl:NQ,raggedGatherImpl:AQ,raggedRangeImpl:RQ,raggedTensorToTensorImpl:MQ,rangeImpl:OQ,rsqrtImpl:PQ,scatterImpl:DQ,sigmoidImpl:FQ,simpleAbsImpl:LQ,sliceImpl:BQ,sparseFillEmptyRowsImpl:$Q,sparseReshapeImpl:UQ,sparseSegmentReductionImpl:VQ,sqrtImpl:zQ,staticRegexReplaceImpl:GQ,stridedSliceImpl:WQ,stringNGramsImpl:XQ,stringSplitImpl:HQ,stringToHashBucketFastImpl:YQ,subImpl:jQ,tileImpl:qQ,topKImpl:KQ,transposeImpl:ZQ,uniqueImpl:JQ}=H;function QQ(t,e){return["x","y","z","w","u","v"].slice(0,e).map((e=>`${t}.${e}`))}function t0(t,e){return 1===e?[t]:QQ(t,e)}class e0{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=kJ(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const t=t0("rc",this.rank),e=wJ(this.rank),n=this.getOutOfBoundsCondition(t),r=this.getSetup(t),i=this.getOutput(t);this.userCode=`\n        void main() {\n          ${e} rc = getOutputCoords();\n\n          if(${n}) {\n            setOutput(vec4(0));\n          } else {\n            ${r}\n\n            setOutput(vec4(${i}));\n          }\n        }\n      `}}getSourceCoordsArr(t){const e=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let i=`${0===n?"r":"rp1"}, ${0===r?"c":"cp1"}`;for(let e=2;e<this.rank;e++)i=`${t[t.length-1-e]},`+i;e.push(i)}return e}getOutOfBoundsCondition(t){if(1===this.rank)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let e="";for(let n=this.rank-2;n<this.rank;n++)e+=`${t[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(e+="||");return e}getSetup(t){if(1===this.rank)return"";const e=t.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`\n      int r = ${e[0]};\n      int c = ${e[1]};\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ${n};\n      bool rEdge = rp1 >= ${r};\n    `}getOutput(t){const e=this.getSourceCoordsArr(t);if(1===this.rank){return`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`}return`getA(${e[0]}),\n            cEdge ? 0. : getA(${e[1]}),\n            rEdge ? 0. : getA(${e[2]}),\n            rEdge || cEdge ? 0. : getA(${e[3]})`}}class n0{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=kJ(this.outputShape.length);let n="";for(let t=0;t<4;t++){let e="thisRC = rc;";t%2==1&&(e+="thisRC.z += 1;"),t>1&&(e+="thisRC.y += 1;"),n+=`\n        ${e}\n        ${t>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${t}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${t>0?"}":""}\n      `}var r,i;this.userCode=`\n      ${r=e,i=this.enableShapeUniforms,`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${i?oJ(["r","c","d"],"inputShape"):sJ(["r","c","d"],r)}\n      return ivec3(r, c, d);\n    }\n  `}\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":lJ(t)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};\n        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}class r0{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(t,e,n){const r=s0(e,n),i=a0(t,r,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const s=i0(t,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();const t=this.freeTextures[i].pop();return this.usedTextures[i].push(t),t}let a;return r===nZ.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):r===nZ.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):r===nZ.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):r===nZ.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):r===nZ.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),a}releaseTexture(t,e,n,r){if(null==this.freeTextures)return;const i=s0(n,r),s=a0(e,i,r);s in this.freeTextures||(this.freeTextures[s]=[]);const a=i0(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),o=ey().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==o&&this._numBytesAllocated>o?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=a):(this.freeTextures[s].push(t),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const l=this.usedTextures[s],h=l&&l.indexOf(t);if(null==h||h<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[h]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;this.numFreeTextures,this.numUsedTextures,this._numBytesFree,this._numBytesAllocated}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const t in this.freeTextures)this.freeTextures[t].forEach((t=>{this.gpgpu.deleteMatrixTexture(t.texture)}));for(const t in this.usedTextures)this.usedTextures[t].forEach((t=>{this.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function i0(t,e,n,r,i){const s=function(t,e){switch(t){case nZ.PACKED_2X2_FLOAT32:return XJ(e);case nZ.PACKED_2X2_FLOAT16:return YJ(e);case nZ.UNPACKED_FLOAT32:return $J(e);case nZ.UNPACKED_FLOAT16:return VJ(e);case nZ.PACKED_4X1_UNSIGNED_BYTE:return GJ(e);default:throw new Error(`Unknown physical texture type ${t}`)}}(e,r);let a;if(i){const[e,n]=sZ(t[0],t[1]);a=e*n}else{const[e,n]=rZ(t[0],t[1]);a=e*n}const o=function(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}(n,s);return a*o}function s0(t,e){if(t===eZ.UPLOAD)return nZ.PACKED_2X2_FLOAT32;if(t===eZ.RENDER||null==t)return function(t){return ey().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?nZ.PACKED_2X2_FLOAT32:nZ.UNPACKED_FLOAT32:t?nZ.PACKED_2X2_FLOAT16:nZ.UNPACKED_FLOAT16}(e);if(t===eZ.DOWNLOAD||t===eZ.PIXELS)return nZ.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function a0(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}class o0{constructor(t,e){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=kJ(this.outputShape.length),this.userCode=`\n      float unaryOperation(float x) {\n        ${e}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const l0="return abs(x);";const h0="return x;";class u0{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=kJ(this.outputShape.length),this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${e}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}class c0{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=kJ(this.outputShape.length);const e=t.length,n=t0("rc",e),r=wJ(e),i=function(t,e){if(1===t)return"rc";let n="";for(let r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),s=n.slice(-2),a=e<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`\n      void main() {\n        ${r} rc = getOutputCoords();\n        vec4 packedInput = getA(${i});\n\n        setOutput(getChannel(packedInput, ${a}));\n      }\n    `}}const d0=gN,p0={};const f0=ey().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class m0 extends ng{nextDataId(){return m0.nextDataId++}constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!ey().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let e;if(null!=t){if(t instanceof rQ)e=t;else{const n=QK(ey().getNumber("WEBGL_VERSION"),t);e=new rQ(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const t=QK(ey().getNumber("WEBGL_VERSION"));e=new rQ(t),this.binaryCache=((n=ey().getNumber("WEBGL_VERSION"))in p0||(p0[n]={}),p0[n]),this.gpgpuCreatedLocally=!0}var n;this.gpgpu=e,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new r0(this.gpgpu),this.numMBBeforeWarning=null==ey().global.screen?1024:ey().global.screen.height*ey().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new eg(this,cT())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,e,n,r,i,s){const a=this.makeTensorInfo(e,n),o=this.texData.get(a.dataId);o.isPacked=!1,o.texture={texture:t,texShape:[r,i]},o.texShape=[r,i];const l=$Z(e),h=new OJ(l,!1,s),u=this.runWebGLProgram(h,[a],n,[[r,i]]);return u.shape=e,o.texture=null,this.disposeIntermediateTensorInfo(a),u.dataId}write(t,e,n){if((ey().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ey().getBool("DEBUG"))&&this.checkNumericalProblems(t),"complex64"===n&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:e,dtype:n,values:t,usage:eZ.UPLOAD,refCount:1}),r}refCount(t){if(this.texData.has(t)){return this.texData.get(t).refCount}return 0}incRef(t){this.texData.get(t).refCount++}decRef(t){if(this.texData.has(t)){this.texData.get(t).refCount--}}move(t,e,n,r,i){if(ey().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:n,dtype:r,values:e,usage:eZ.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const e=this.texData.get(t),{values:n,dtype:r,complexTensorInfos:i,slice:s,shape:a,isPacked:o}=e;if(null!=s){let e;e=o?new u0(a,h0):new o0(a,h0);const n=this.runWebGLProgram(e,[{dataId:t,shape:a,dtype:r}],r),i=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),i}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===r)return n;const l=null!=this.activeTimers;let h,u;if(l&&(h=tw()),"complex64"===r){u=dR(this.readSync(i.real.dataId),this.readSync(i.imag.dataId))}else u=this.getValuesFromTexture(t);return l&&(this.downloadWaitMs+=tw()-h),this.convertAndCacheOnCPU(t,u)}async read(t){if(this.pendingRead.has(t)){const e=this.pendingRead.get(t);return new Promise((t=>e.push(t)))}const e=this.texData.get(t),{values:n,shape:r,slice:i,dtype:s,complexTensorInfos:a,isPacked:o}=e;if(null!=i){let e;e=o?new u0(r,h0):new o0(r,h0);const n=this.runWebGLProgram(e,[{dataId:t,shape:r,dtype:s}],s),i=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),i}if(null!=n)return this.convertAndCacheOnCPU(t);if(ey().getBool("DEBUG")&&!ey().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===ey().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l,h,u=null;if("complex64"!==s&&ey().get("WEBGL_BUFFER_SUPPORTED")){l=this.decode(t);const e=this.texData.get(l.dataId);u=this.gpgpu.createBufferFromTexture(e.texture.texture,...iZ(r))}if(this.pendingRead.set(t,[]),"complex64"!==s&&await this.gpgpu.createAndWaitForFence(),"complex64"===s){const t=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]);h=dR(t[0],t[1])}else if(null==u)h=this.getValuesFromTexture(t);else{const t=mg(r);h=this.gpgpu.downloadFloat32MatrixFromBuffer(u,t)}if(null!=l&&this.disposeIntermediateTensorInfo(l),null!=u){const t=this.gpgpu.gl;oZ(t,(()=>t.deleteBuffer(u)))}const c=this.convertAndCacheOnCPU(t,h),d=this.pendingRead.get(t);return this.pendingRead.delete(t),d.forEach((t=>t(c))),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&cT().removeDataId(t,this),this.pendingDeletes--),c}readToGPU(t,e={}){const n=this.texData.get(t),{values:r,shape:i,slice:s,dtype:a,isPacked:o,texture:l}=n;if("complex64"===a)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=s){let n;n=o?new u0(i,h0):new o0(i,h0);const r=this.runWebGLProgram(n,[{dataId:t,shape:i,dtype:a}],a),s=this.readToGPU(r,e);return this.disposeIntermediateTensorInfo(r),s}if(null==l)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const h=this.decode(t,e.customTexShape),u=cT().makeTensorFromTensorInfo(h),c=this.texData.get(h.dataId);return Object.assign({tensorRef:u},c.texture)}bufferSync(t){const e=this.readSync(t.dataId);if("string"===t.dtype)try{const n=e.map((t=>rw(t)));return nT(t.shape,t.dtype,n)}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return nT(t.shape,t.dtype,e)}checkNumericalProblems(t){if(null!=t)for(let e=0;e<t.length;e++){const n=t[e];if(!lZ(n)){if(ey().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(t){const{shape:e,dtype:n,isPacked:r}=this.texData.get(t),i=mg(e);if(ey().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(t),r=this.texData.get(n.dataId),s=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...iZ(e)).subarray(0,i);return this.disposeIntermediateTensorInfo(n),s}const s=ey().getBool("WEBGL_PACK")&&!0===r,a=s?$Z(e):e,o=s?new RJ(a):new AJ(a),l=this.runWebGLProgram(o,[{shape:a,dtype:n,dataId:t}],"float32"),h=this.texData.get(l.dataId),u=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture.texture,h.texShape[0],h.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(l),u}timerAvailable(){return ey().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const e=this.activeTimers,n=[];let r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t();const i=sw(this.activeTimers.map((t=>t.query))).filter((t=>null!=t)),s=sw(this.activeTimers.map((t=>t.name))).filter((t=>null!=t));this.activeTimers=e,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(ey().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const t=await Promise.all(i);a.kernelMs=hg(t),a.getExtraProfileInfo=()=>t.map(((t,e)=>({name:s[e],ms:t}))).map((t=>`${t.name}: ${t.ms}`)).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return ey().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:tw(),endMs:null}}endTimer(t){return ey().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=tw(),t)}async getQueryTime(t){if(ey().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const e=t;return e.endMs-e.startMs}disposeData(t,e=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(e?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!e&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:n}=this.texData.get(t);return null!=n&&(this.disposeData(n.real.dataId,e),this.disposeData(n.imag.dataId,e)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:e,dtype:n,texShape:r,usage:i,isPacked:s,slice:a}=this.texData.get(t),o=a&&a.origDataId||t,l=this.dataRefCount.get(o);l>1?this.dataRefCount.set(o,l-1):(this.dataRefCount.delete(o),null!=e&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(e,r,i,s)));const h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,e=f0){return ey().getBool("WEBGL_CPU_FORWARD")&&t.every((t=>null==this.texData.get(t.dataId).texture&&mg(t.shape)<e))}getGPGPUContext(){return this.gpgpu}where(t){Eb();const e=t.dataSync();return d0(t.shape,e)}packedUnaryOp(t,e,n){const r=new u0(t.shape,e),i=this.compileAndRun(r,[t],n);return cT().makeTensorFromTensorInfo(i)}abs(t){if(this.shouldExecuteOnCPU([t])&&"complex64"!==t.dtype){const e=LQ(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,e)}if(ey().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,l0,t.dtype);const e=new o0(t.shape,l0),n=this.compileAndRun(e,[t]);return cT().makeTensorFromTensorInfo(n)}makeTensorInfo(t,e,n){let r;if("string"===e&&null!=n&&n.length>0&&Dg(n[0])){const i=n.map((t=>nw(t)));r=this.write(i,t,e)}else r=this.write(n,t,e);return this.texData.get(r).usage=null,{dataId:r,shape:t,dtype:e}}makeOutput(t,e,n){return cT().makeTensorFromTensorInfo(this.makeTensorInfo(t,e,n),this)}unpackTensor(t){const e=new c0(t.shape);return this.runWebGLProgram(e,[t],t.dtype)}packTensor(t){const e=new e0(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)}packedReshape(t,e){const n=[LZ(t.shape),...BZ(t.shape)],r={dtype:t.dtype,shape:n,dataId:t.dataId},i=[LZ(e),...BZ(e)],s=new n0(i,n),a=[n],o=this.runWebGLProgram(s,[r],t.dtype,a,!0);return{dataId:o.dataId,shape:e,dtype:o.dtype}}decode(t,e){const n=this.texData.get(t),{isPacked:r,shape:i,dtype:s}=n;if(null!=e){dg(mg(i)<=e[0]*e[1]*4,(()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."))}const a=$Z(i);let o;o=r?new NJ(a):new CJ(a);const l=[null!=e?e:iZ(a)];return{dtype:s,shape:i,dataId:this.runWebGLProgram(o,[{shape:a,dtype:s,dataId:t}],s,l,!0,e).dataId}}runWebGLProgram(t,e,n,r,i=!1,s){const a=this.makeTensorInfo(t.outputShape,n),o=this.texData.get(a.dataId);if(t.packedOutput&&(o.isPacked=!0),t.outPackingScheme===tZ.DENSE){const e=null!=s?s:iZ(t.outputShape);o.texShape=e.map((t=>2*t))}if(null!=t.outTexUsage&&(o.usage=t.outTexUsage),0===mg(a.shape))return o.values=Cg(a.dtype,0),a;const l=[],h=e.map((e=>{if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(e.dataId);if(null==n.texture){if(!t.packedInputs&&mg(e.shape)<=ey().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.packedInputs&&(n.isPacked=!0,n.shape=e.shape)}if(this.uploadToGPU(e.dataId),!!n.isPacked!=!!t.packedInputs)e=n.isPacked?this.unpackTensor(e):this.packTensor(e),l.push(e),n=this.texData.get(e.dataId);else if(n.isPacked&&!zZ(n.shape,e.shape)){const t=e,r=e.shape;e.shape=n.shape,e=this.packedReshape(e,r),l.push(e),n=this.texData.get(e.dataId),t.shape=r}return{shape:e.shape,texData:n,isUniform:!1}}));this.uploadToGPU(a.dataId);const u={shape:a.shape,texData:o,isUniform:!1},c=function(t,e,n){let r="";e.concat(n).forEach((e=>{const i=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!e.isUniform){const s=e.texData.texShape,{useSqueezeShape:a,uniformShape:o,keptDims:l}=_J(t.packedInputs,e.shape,s);let h="",u="",c="";if(1===o.length&&t.packedInputs){const t=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];h=`${t[0]>1}_${t[1]>1}`}else if(2!==o.length||t.packedInputs){if(o.length>2&&!t.packedInputs){const t=Vg(o);c=`${t[0]===s[1]}_${t[t.length-1]===s[1]}`}}else u=`${o[0]>1}_${o[1]>1}`;const d=e.shape.length,p=2===o.length&&vg(e.shape,s),f=1===mg(e.shape),m=nE(e.shape,n.shape),g=!t.packedInputs&&d===n.shape.length&&vg(s,n.texData.texShape),y=t.packedInputs||o.length>2?"":`${s[0]>1}_${s[1]>1}`;r+=`${d}_${g}_${a?l:""}_${o.length}_${f}_${m}_${p}_${h}_${u}_${c}_${y}_${i}`}else{const t=e.isUniform?"uniform":e.texData.texShape;r+=`${e.shape}_${t}_${i}`}}));const i=t.userCode;let s=t.constructor.name;return s+="_"+r+"_"+i+`${ey().getNumber("WEBGL_VERSION")}`,s}(t,h,u),d=this.getAndSaveBinary(c,(()=>function(t,e,n,r){const i=n.map(((t,n)=>{const r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}})),s=i.map((t=>t.shapeInfo)),a={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},o=cJ(i,a,e),l=dZ(t.gl,o),h=t.createProgram(l);return ey().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:o,webGLProgram:h,inShapeInfos:s,outShapeInfo:a,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(h),Object.assign({program:e,fragmentShader:l,source:o,webGLProgram:h,inShapeInfos:s,outShapeInfo:a},SJ(t,e,h)))}(this.gpgpu,t,h,u))),p=null!=this.activeTimers;let f;p&&(f=this.startTimer()),ey().get("ENGINE_COMPILE_ONLY")||function(t,e,n,r,i){e.program.enableShapeUniforms||(IJ(e.inShapeInfos,n),IJ([e.outShapeInfo],[r]));const s=r.texData.texture,a=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(s.texture,a[0],a[1]):t.setOutputMatrixTexture(s.texture,a[0],a[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),1===ey().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN);for(let r=0;r<n.length;++r){const i=n[r],{uniform:s,offset:a,shape:o,texShape:l}=e.variablesLocations[r];if(o){const{uniformShape:n}=_J(e.program.packedInputs,i.shape,i.texData.texShape);switch(n.length){case 1:t.gl.uniform1iv(o,new Int32Array(n));break;case 2:t.gl.uniform2iv(o,new Int32Array(n));break;case 3:t.gl.uniform3iv(o,new Int32Array(n));break;case 4:t.gl.uniform4iv(o,new Int32Array(n))}}if(l&&t.gl.uniform2i(l,i.texData.texShape[0],i.texData.texShape[1]),null!=s)if(i.isUniform)if(mg(i.shape)<2)t.gl.uniform1f(s,i.uniformValues[0]);else{let e=i.uniformValues;e instanceof Float32Array||(e=new Float32Array(e)),t.gl.uniform1fv(s,e)}else null!=i.texData.slice&&null!=a&&t.gl.uniform1i(a,i.texData.slice.flatOffset),t.setInputMatrixTexture(i.texData.texture.texture,s,r)}const o=e.outShapeLocation;if(o)switch(r.shape.length){case 1:t.gl.uniform1iv(o,new Int32Array(r.shape));break;case 2:t.gl.uniform2iv(o,new Int32Array(r.shape));break;case 3:t.gl.uniform3iv(o,new Int32Array(r.shape));break;case 4:t.gl.uniform4iv(o,new Int32Array(r.shape))}if(e.outShapeStridesLocation){const n=Vg(r.shape);switch(r.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(n));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(n));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(n))}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&i)for(let n=0;n<e.program.customUniforms.length;++n){const r=e.program.customUniforms[n],s=e.customUniformLocations[n],a=i[n];if("float"===r.type)t.gl.uniform1fv(s,a);else if("vec2"===r.type)t.gl.uniform2fv(s,a);else if("vec3"===r.type)t.gl.uniform3fv(s,a);else if("vec4"===r.type)t.gl.uniform4fv(s,a);else if("int"===r.type)t.gl.uniform1iv(s,a);else if("ivec2"===r.type)t.gl.uniform2iv(s,a);else if("ivec3"===r.type)t.gl.uniform3iv(s,a);else{if("ivec4"!==r.type)throw Error(`uniform type ${r.type} is not supported yet.`);t.gl.uniform4iv(s,a)}}t.executeProgram()}(this.gpgpu,d,h,u,r),l.forEach((t=>this.disposeIntermediateTensorInfo(t))),p&&(f=this.endTimer(f),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(f)}));const m=ey().get("WEBGL_FLUSH_THRESHOLD");if(m>0){const t=tw();t-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=t)}if(!ey().getBool("WEBGL_LAZILY_UNPACK")&&o.isPacked&&!1===i){const t=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),t}return a}compileAndRun(t,e,n,r,i=!1){n=n||e[0].dtype;return this.runWebGLProgram(t,e,n,r,i)}getAndSaveBinary(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){if(!this.disposed){if(!ey().getBool("IS_TEST")){Object.keys(this.binaryCache).forEach((t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}))}this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=fT((()=>{if(!ey().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=ey().getBool("DEBUG");ey().set("DEBUG",!1);const e=this.abs(VT(1e-8)).dataSync()[0];if(ey().set("DEBUG",t),e>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(t){const e=this.texData.get(t),{shape:n,dtype:r,values:i,texture:s,usage:a,isPacked:o}=e;if(null!=s)return;const l=null!=this.activeTimers;let h;l&&(h=tw());let u=e.texShape;if(null==u&&(u=UZ(n,o),e.texShape=u),null!=i){const t=$Z(n);let s,a=u[1],c=u[0];const d=i instanceof Uint8Array||i instanceof Uint8ClampedArray;!o&&d||([a,c]=sZ(u[0],u[1])),s=o?new PJ(t,d):new OJ(t,d);const p=d?[c,a]:u,f=this.makeTensorInfo(p,r),m=this.texData.get(f.dataId);m.usage=d?eZ.PIXELS:eZ.UPLOAD,m.texShape=p,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(f.dataId),a,c,i);const g=[[c,a]],y=!0,v=this.runWebGLProgram(s,[f],r,g,y),x=this.texData.get(v.dataId);e.texShape=x.texShape,e.isPacked=x.isPacked,e.usage=x.usage,ey().get("ENGINE_COMPILE_ONLY")?this.disposeData(v.dataId):(e.texture=x.texture,e.values=null,this.texData.delete(v.dataId)),this.disposeIntermediateTensorInfo(f),l&&(this.uploadWaitMs+=tw()-h)}else{const t=this.acquireTexture(u,a,r,o);e.texture=t}}convertAndCacheOnCPU(t,e){const n=this.texData.get(t),{dtype:r}=n;return null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){const n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length);for(let e=0;e<n.length;++e)n[e]=Math.round(t[e]);return n}throw new Error(`Unknown dtype ${e}`)}(e,r)),n.values}acquireTexture(t,e,n,r){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0}return this.textureManager.acquireTexture(t,e,r)}computeBytes(t,e){return t[0]*t[1]*Og(e)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,e]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(e));return Promise.all(t)}for(const[,e]of Object.entries(this.binaryCache)){const n=new Promise((t=>{try{this.checkCompletion_(e),t(!0)}catch(t){throw t}}));t.push(n)}return Promise.all(t)}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await zA(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(!1===this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(!1===this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw fZ(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const t of Object.values(this.binaryCache)){this.gpgpu.buildVao(t.webGLProgram);const{variablesLocations:e,customUniformLocations:n,infLoc:r,nanLoc:i,outShapeLocation:s,outShapeStridesLocation:a,outTexShapeLocation:o}=SJ(this.gpgpu,t.program,t.webGLProgram);t.variablesLocations=e,t.customUniformLocations=n,t.infLoc=r,t.nanLoc=i,t.outShapeLocation=s,t.outShapeStridesLocation=a,t.outTexShapeLocation=o}}createTensorFromGPUData(t,e,n){t.channels=t.channels||"RGBA";const{texture:r,height:i,width:s,channels:a}=t,o=cT().backend;if(!o.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=o.writeTexture(r,e,n,i,s,a);return cT().makeTensorFromDataId(l,e,n,o)}}m0.nextDataId=0;const g0="4.8.0";function y0(){ey().set("WEBGL_FORCE_F16_TEXTURES",!0)}Xw()&&ET("webgl",(()=>new m0),2);const v0={forceHalfFloat:y0};class x0{constructor(t,e,n){this.variableNames=["A","B"],this.outputShape=iE(e,n),this.enableShapeUniforms=kJ(this.outputShape.length),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${t}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}const b0="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n";class w0{constructor(t,e,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=iE(e,n);const i=this.outputShape.length;this.enableShapeUniforms=kJ(i);let s="";if(r)if(0===i||1===mg(this.outputShape))s="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{if(s=`\n          ${wJ(i)} coords = getOutputCoords();\n        `,1===i)this.enableShapeUniforms?s+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":s+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const t=t0("coords",i);this.enableShapeUniforms?s+=`\n            bool nextRowOutOfBounds =\n              (${t[i-2]} + 1) >= outShape[${i} - 2];\n            bool nextColOutOfBounds =\n              (${t[i-1]} + 1) >= outShape[${i} - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `:s+=`\n            bool nextRowOutOfBounds =\n              (${t[i-2]} + 1) >= ${this.outputShape[i-2]};\n            bool nextColOutOfBounds =\n              (${t[i-1]} + 1) >= ${this.outputShape[i-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${t}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${s}\n\n        setOutput(result);\n      }\n    `}}function _0(t){const{inputs:e,backend:n}=t,{x:r}=e;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const T0={kernelName:_v,backendName:"webgl",kernelFunc:_0};function E0(t){const{inputs:e,backend:n}=t,{real:r,imag:i}=e,s=n.makeTensorInfo(r.shape,"complex64"),a=n.texData.get(s.dataId),o=_0({inputs:{x:r},backend:n}),l=_0({inputs:{x:i},backend:n});return a.complexTensorInfos={real:o,imag:l},s}const S0={kernelName:Oy,backendName:"webgl",kernelFunc:E0},I0="return (a < 0.) ? b * a : a;",k0="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";const C0={kernelName:Cv,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{alpha:s}=r,a=n.makeTensorInfo([],"float32",Jb(s,"float32")),o=ey().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new w0(k0,i.shape,a.shape):new x0(I0,i.shape,a.shape),l=n.runWebGLProgram(o,[i,a],"float32");return n.disposeIntermediateTensorInfo(a),l}},N0="return (a < 0.) ? b * a : a;",A0="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";const R0={kernelName:fx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r,alpha:i}=e,s=ey().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new w0(A0,r.shape,i.shape):new x0(N0,r.shape,i.shape);return n.runWebGLProgram(s,[r,i],"float32")}};function M0({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:r}){return({inputs:i,backend:s})=>{const{x:a}=i,o=s,l=r||a.dtype;if(o.shouldExecuteOnCPU([a])&&null!=n){const t=o.texData.get(a.dataId),e=n(t.values,l);return o.makeTensorInfo(a.shape,l,e)}let h;return h=ey().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=e?new u0(a.shape,e):new o0(a.shape,t),o.runWebGLProgram(h,[a],l)}}function O0({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:i,dtype:s}){return({inputs:a,backend:o})=>{const{a:l,b:h}=a,u=o;if(r&&"complex64"===l.dtype){const e=u.texData.get(l.dataId),n=u.texData.get(h.dataId),[r,i]=[[e.complexTensorInfos.real,n.complexTensorInfos.real],[e.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((e=>{const[n,r]=e,i={dataId:n.dataId,dtype:n.dtype,shape:l.shape},s={dataId:r.dataId,dtype:r.dtype,shape:h.shape},a=new x0(t,l.shape,h.shape);return u.runWebGLProgram(a,[i,s],kw(n.dtype,r.dtype))})),s=E0({inputs:{real:r,imag:i},backend:u});return u.disposeIntermediateTensorInfo(r),u.disposeIntermediateTensorInfo(i),s}const c=s||kw(l.dtype,h.dtype);if(("string"===l.dtype||"string"===h.dtype||u.shouldExecuteOnCPU([l,h]))&&null!=i){const t=u.texData.get(l.dataId).values,e=u.texData.get(h.dataId).values,n="string"===l.dtype?WR(t):t,r="string"===l.dtype?WR(e):e,[s,a]=i(l.shape,h.shape,n,r,c),o=u.makeTensorInfo(a,c);return u.texData.get(o.dataId).values=s,o}let d;return d=ey().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=e?new w0(e,l.shape,h.shape,n):new x0(t,l.shape,h.shape),u.runWebGLProgram(d,[l,h],c)}}function P0(t,e=!1){if("linear"===t)return"return x;";if("relu"===t)return e?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n";if("elu"===t)return e?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===t)return e?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n";if("prelu"===t)return e?A0:N0;if("leakyrelu"===t)return e?k0:I0;if("sigmoid"===t)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}class D0{constructor(t,e,n,r=!1,i=!1,s=!1,a=null,o=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=kJ(this.outputShape.length);const h=r?t[1]:t[2],u=Math.ceil(h/2),c=r?"i * 2, rc.y":"rc.y, i * 2",d=i?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",g="";a&&(m=o?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${a}\n        }`:l?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${a}\n        }`:`vec4 activation(vec4 x) {\n          ${a}\n        }`,g="result = activation(result);");const y=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let v="rc.x",x="rc.x";t[0]<e[0]?v=`imod(rc.x, ${t[0]})`:e[0]<t[0]&&(x=`imod(rc.x, ${e[0]})`),this.userCode=`\n      ${m}\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ${u}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ${v};\n        int batchB = ${x};\n        for (int i = 0; i < ${u}; i++) {\n          vec4 a = getMatrixA(batchA, ${c});\n          vec4 b = getMatrixB(batchB, ${d});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${p[0]} * ${f[0]});\n          result += (${p[1]} * ${f[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${y}\n\n        ${g}\n\n        setOutput(result);\n      }\n    `}}const F0="return areal * breal - aimag * bimag;",L0="return areal * bimag + aimag * breal;";class B0{constructor(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=iE(e,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${t}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}const $0="return a * b;";function U0(t){const{inputs:e,backend:n}=t,{a:r,b:i}=e,s=kw(r.dtype,i.dtype);if("complex64"===r.dtype){const t=n.texData.get(r.dataId),e=n.texData.get(i.dataId),s=new B0(F0,r.shape,i.shape),a=new B0(L0,r.shape,i.shape),o=[{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:r.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:i.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:i.shape}],l=n.runWebGLProgram(s,o,"float32"),h=n.runWebGLProgram(a,o,"float32"),u=E0({inputs:{real:l,imag:h},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),u}if(n.shouldExecuteOnCPU([r,i])){const t=n.texData.get(r.dataId),e=n.texData.get(i.dataId),[a,o]=IQ(r.shape,i.shape,t.values,e.values,s),l=n.makeTensorInfo(o,s);return n.texData.get(l.dataId).values=a,l}let a;return a=ey().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new w0($0,r.shape,i.shape):new x0($0,r.shape,i.shape),n.runWebGLProgram(a,[r,i],s)}const V0={kernelName:nx,backendName:"webgl",kernelFunc:U0};function z0(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{shape:s}=r,a=n,o=mg(i.shape),l=Sg(s,o),h=mg(l);dg(o===h,(()=>`The new shape (${l}) has ${h} elements and the old shape (${i.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`));const u=a.texData.get(i.dataId);return!u.isPacked||zZ(i.shape,l)||null!==u.texture&&zZ(u.shape,l)?(a.incRef(i.dataId),{dataId:i.dataId,shape:l,dtype:i.dtype}):function(t,e,n){const r=[LZ(t.shape),...BZ(t.shape)],i={dtype:t.dtype,shape:r,dataId:t.dataId},s=[LZ(e),...BZ(e)],a=new n0(s,r),o=[r],l=n.runWebGLProgram(a,[i],t.dtype,o,!0);return{dataId:l.dataId,shape:e,dtype:l.dtype}}(i,l,a)}const G0={kernelName:Tx,backendName:"webgl",kernelFunc:z0};class W0{constructor(t,e){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:s}=t;this.outputShape=[r,s];const a=4*Math.floor(n/4),o=n%4;let l="sumValue += dot(values, ones);";if(null!=e){const t=1/e;l=`sumValue += dot(values * ${xg(t)?t.toPrecision(2):t}, ones);`}let h="";i%n>0&&(h=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${h}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${a}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${l}\n        }\n\n        int inIdx = inOffset + ${a};\n        if (${1===o}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${l}\n        } else if (${2===o}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${l}\n        } else if (${3===o}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${l}\n        }\n        setOutput(sumValue);\n      }\n    `}}class X0{constructor(t,e){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:s}=t;this.outputShape=[r,s];let a="0.0",o="";"prod"===e?a="1.0":"min"===e?(a="1.0 / 1e-20",o="min"):"max"===e&&(a="-1.0 / 1e-20",o="max");let l=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===e?l="sumValue":"prod"===e?l="prodValue":"all"===e?l="allValue":"any"===e&&(l="anyValue");const h=4*Math.floor(n/4),u=n%4;let c=`\n      if (${"sum"===e}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===e}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${o}(values, minMaxValue);\n        if (${"min"===e} || ${"max"===e}) {\n          minMaxValue = ${o}(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    `,d="vec4";"all"===e?(a="1.0",c="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===e&&(a="0.0",c="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");let p="";i%n>0&&(p=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${a};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${p}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${a});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${h}; i += 4) {\n          int inIdx = inOffset + i;\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${c}\n        }\n\n        int inIdx = inOffset + ${h};\n        if (${1===u}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${c}\n        } else if (${2===u}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${c}\n        } else if (${3===u}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${c}\n        }\n        setOutput(${l});\n      }\n    `}}function H0(t,e,n,r){const i=function(t){const e=[];for(;0===e.length||1!==e[e.length-1].outSize;){const n=e.length?e[e.length-1].outSize:t[1],r=ZA(n);e.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return e}(t.shape);let s=t;for(let a=0;a<i.length;a++){const{inSize:o,windowSize:l,outSize:h}=i[a];let u,c;u="mean"===n?0===a?new W0({windowSize:l,inSize:o,batchSize:t.shape[0],outSize:h},o):new W0({windowSize:l,inSize:o,batchSize:t.shape[0],outSize:h}):new X0({windowSize:l,inSize:o,batchSize:t.shape[0],outSize:h},n),c=s,s=r.runWebGLProgram(u,[s],e),c.dataId!==t.dataId&&r.disposeIntermediateTensorInfo(c)}return s}class Y0{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;const r=wJ(this.rank),i=function(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let e=0;e<t.length;e++)r[t[e]]=n[e];return r.join()}(e);this.userCode=`\n    void main() {\n      ${r} resRC = getOutputCoords();\n      setOutput(getA(${i}));\n    }\n    `}}class j0{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=wJ(this.rank),i=QQ("rc",this.rank),s=new Array(this.rank);for(let t=0;t<e.length;t++)s[e[t]]=i[t];const a=`vec2(${s.slice(-2).join()})`,o=`++${i[this.rank-1]} < ${n[this.rank-1]}`,l=`getChannel(getA(${s.join()}), ${a})`;this.userCode=`\n    void main() {\n      ${r} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${l};\n      if(${o}) {\n        result[1] = ${l};\n      }\n      --${i[this.rank-1]};\n      if(++${i[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${l};\n        if(${o}) {\n          result[3] = ${l};\n        }\n      }\n      setOutput(result);\n    }\n    `}}function q0(t,e,n){const r=ey().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new j0(t.shape,e):new Y0(t.shape,e);return n.runWebGLProgram(r,[t],t.dtype)}function K0(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:a}=r;return function(t,e,n,r){const i=e,s=t.shape.length,a=Ig(i,t.shape);let o=a;const l=ek(o,s),h=null!=l;let u=t;h&&(u=q0(t,l,r),o=rk(o.length,s)),tk("sum",o,s);const[c,d]=JI(u.shape,o);let p=c;n&&(p=QI(c,a));const f=mg(d),m=z0({inputs:{x:u},attrs:{shape:[mg(t.shape)/f,f]},backend:r}),g=H0(m,Cw(t.dtype),"sum",r),y=z0({inputs:{x:g},attrs:{shape:p},backend:r});return r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),h&&r.disposeIntermediateTensorInfo(u),y}(i,s,a,n)}const Z0={kernelName:Wx,backendName:"webgl",kernelFunc:K0};function J0(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{perm:s}=r,a=n,o=i.shape.length,l=new Array(o);for(let t=0;t<l.length;t++)l[t]=i.shape[s[t]];let h;if(a.shouldExecuteOnCPU([i])){const t=a.texData.get(i.dataId).values,e=ZQ(t,i.shape,i.dtype,s,l);h=a.makeTensorInfo(l,i.dtype);a.texData.get(h.dataId).values=e}else h=q0(i,s,a);return h}const Q0={kernelName:db,backendName:"webgl",kernelFunc:J0};function t1({a:t,b:e,transposeA:n,transposeB:r,backend:i,bias:s=null,preluActivationWeights:a=null,leakyreluAlpha:o=0,activation:l=null}){const h=t.shape.length,u=e.shape.length,c=n?t.shape[h-2]:t.shape[h-1],d=r?e.shape[u-1]:e.shape[u-2],p=n?t.shape[h-1]:t.shape[h-2],f=r?e.shape[u-2]:e.shape[u-1],m=t.shape.slice(0,-2),g=e.shape.slice(0,-2),y=mg(m),v=mg(g),x=iE(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,f]);dg(c===d,(()=>`Error in matMul: inner shapes (${c}) and (${d}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${r} must match.`));const b=n?[y,c,p]:[y,p,c],w=r?[v,f,d]:[v,d,f],_=z0({inputs:{x:t},backend:i,attrs:{shape:b}}),T=z0({inputs:{x:e},backend:i,attrs:{shape:w}}),E=[_,T],S=Math.max(y,v),I=n?_.shape[1]:_.shape[2],k=null!=s,C=null!=a,N="leakyrelu"===l,A=null!=l?P0(l,!0):null;let R;if((1===p||1===f)&&I>1e3&&!1===(k||C||N||null!=A)){let t=_,e=T;n&&(t=J0({inputs:{x:_},backend:i,attrs:{perm:[0,2,1]}}),E.push(t)),r&&(e=J0({inputs:{x:T},backend:i,attrs:{perm:[0,2,1]}}),E.push(e));const s=1===f;let a=t;1!==f&&(a=z0({inputs:{x:t},backend:i,attrs:{shape:[S,I,1]}}),E.push(a));const o=1===f?2:1;let l=e;s&&(l=z0({inputs:{x:e},backend:i,attrs:{shape:[S,1,I]}}),E.push(l));const h=U0({inputs:{a,b:l},backend:i});R=K0({inputs:{x:h},backend:i,attrs:{axis:o,keepDims:!0}}),E.push(h)}else{const l=kw(t.dtype,e.dtype),h=new D0(b,w,[S,p,f],n,r,k,A,C,N),u=[_,T];if(null!=s&&u.push(s),C&&u.push(a),N){const t=i.makeTensorInfo([],"float32",Jb(o,"float32"));u.push(t),E.push(t)}R=i.runWebGLProgram(h,u,l)}const M=z0({inputs:{x:R},backend:i,attrs:{shape:x}});E.push(R);for(const t of E)i.disposeIntermediateTensorInfo(t);return M}const e1={kernelName:wb,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s,bias:a,preluActivationWeights:o}=e,{transposeA:l,transposeB:h,activation:u,leakyreluAlpha:c}=r;return t1({a:i,b:s,transposeA:l,transposeB:h,backend:n,bias:a,preluActivationWeights:o,leakyreluAlpha:c,activation:u})}},n1="return abs(x);";const r1={kernelName:ay,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])&&"complex64"!==r.dtype){const t=n.texData.get(r.dataId),e=LQ(t.values);return n.makeTensorInfo(r.shape,r.dtype,e)}let i;return i=ey().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new u0(r.shape,n1):new o0(r.shape,n1),n.runWebGLProgram(i,[r],r.dtype)}},i1=M0({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),s1={kernelName:oy,backendName:"webgl",kernelFunc:i1},a1=M0({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),o1={kernelName:ly,backendName:"webgl",kernelFunc:a1},l1="return a + b;",h1=O0({opSnippet:l1,packedOpSnippet:l1,supportsComplex:!0,cpuKernelImpl:iQ}),u1={kernelName:hy,backendName:"webgl",kernelFunc:h1};class c1{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`float v${t} = get${t}AtOutCoords();`)}));const r=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${r};\n        setOutput(result);\n      }\n    `}}class d1{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`vec4 v${t} = get${t}AtOutCoords();`)}));const r=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${r};\n        setOutput(result);\n      }\n    `}}const p1={kernelName:uy,backendName:"webgl",kernelFunc:function t(e){const{inputs:n,backend:r}=e,i=n;if(1===i.length)return _0({inputs:{x:i[0]},backend:r});if(i.length>ey().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const e=Math.floor(i.length/2),n=t({inputs:i.slice(0,e),backend:r}),s=t({inputs:i.slice(e),backend:r});return t({inputs:[n,s],backend:r})}const s=i.map((t=>t.dtype)).reduce(((t,e)=>kw(t,e))),a=i.map((t=>t.shape)),o=ey().getBool("WEBGL_PACK")?new d1(i[0].shape,a):new c1(i[0].shape,a);return r.runWebGLProgram(o,i,s)}};const f1={kernelName:cy,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:a}=r,o=i.shape.length,l=Ig(s,i.shape);let h=l;const u=ek(h,o);let c=i;null!=u&&(c=J0({inputs:{x:i},backend:n,attrs:{perm:u}}),h=rk(h.length,o)),tk("all",h,o);const[d,p]=JI(c.shape,h),f=z0({inputs:{x:c},backend:n,attrs:{shape:[-1,mg(p)]}}),m=H0(f,f.dtype,"all",n);let g;if(a){g=z0({inputs:{x:m},backend:n,attrs:{shape:QI(d,l)}})}else g=z0({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),null!=u&&n.disposeIntermediateTensorInfo(c),g}};const m1={kernelName:dy,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:a}=r,o=i.shape.length,l=Ig(s,i.shape);let h=l;const u=ek(h,o);let c=i;null!=u&&(c=J0({inputs:{x:i},backend:n,attrs:{perm:u}}),h=rk(h.length,o)),tk("any",h,o);const[d,p]=JI(c.shape,h),f=z0({inputs:{x:c},backend:n,attrs:{shape:[-1,mg(p)]}}),m=H0(f,f.dtype,"any",n);let g;if(a){g=z0({inputs:{x:m},backend:n,attrs:{shape:QI(d,l)}})}else g=z0({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),null!=u&&n.disposeIntermediateTensorInfo(c),g}};class g1{constructor(t,e,n){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:s}=t;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];const a="max"===e?">":"<",o=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${r};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${r}; i++) {\n          int inIdx = ${o};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${a} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}class y1{constructor(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,dg(t.length>2,(()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`));const i=t[t.length-1],s=Math.ceil(i/e);this.outputShape=t.slice(0,-1),s>1&&this.outputShape.push(s),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,o=a.length,l=wJ(o),h=t0("coords",o);let u,c;if(1===s){c=o+1;const t=wJ(c);u=`\n        ${t} sourceLocR = ${t}(${h.join()}, 0);\n        ++${h[o-1]};\n        ${t} sourceLocG = ${t}(${h.join()}, 0);\n        ++${h[o-2]};\n        ${t} sourceLocA = ${t}(${h.join()}, 0);\n        --${h[o-1]};\n        ${t} sourceLocB = ${t}(${h.join()}, 0);\n        --${h[o-2]};`}else c=o,u=`\n        ${l} sourceLocR = coords;\n        ++${h[o-1]};\n        ${l} sourceLocG = coords;\n        ++${h[o-2]};\n        ${l} sourceLocA = coords;\n        --${h[o-1]};\n        ${l} sourceLocB = coords;\n        --${h[o-2]};`;const d=["x","y","z","w","u","v"].slice(0,c),p="."+d[c-1],f=d.map((t=>"int "+t)),m=t0("sourceLocR",c-1).concat("inIdx.r"),g=t0("sourceLocG",c-1).concat("inIdx.g"),y=t0("sourceLocB",c-1).concat("inIdx.b"),v=t0("sourceLocA",c-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",b=r?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${m.join()}),\n                             getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${v.join()})));`,w=`vec4(\n            getAChannel(${m.join()}),\n            hasNextCol ? getAChannel(${g.join()}) : 0.,\n            hasNextRow ? getAChannel(${y.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,_=r?"":`\n      float getBestIndicesAChannel(${f.join()}) {\n        return getChannel(getBestIndicesA(${d.join()}),\n                                          vec2(${d.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${f.join()}) {\n        return getChannel(getA(${d.join()}),\n                               vec2(${d.slice(-2).join()}));\n      }\n      ${_}\n      void main() {\n        ${l} coords = getOutputCoords();\n        bool hasNextCol = ${h[o-1]} < ${a[o-1]-1};\n        bool hasNextRow = ${h[o-2]} < ${a[o-2]-1};\n        ${u}\n        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},\n          sourceLocB${p}, sourceLocA${p}) * ${e};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${w};\n\n        for (int i = 0; i < ${e}; i++) {\n          inIdx = srcIdx;\n          ${b}\n          vec4 candidate = ${w};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${x}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}function v1(t,e,n,r=null){let i=e.shape[0],s=e.shape[1];null!=r&&(i=r.shape[0],s=r.shape[1]);const a=ZA(s),o={windowSize:a,inSize:s,batchSize:i,outSize:Math.ceil(s/a)},l=new g1(o,n,null==r),h=[e];null!=r&&h.push(r);const u=t.runWebGLProgram(l,h,"int32");if(1===u.shape[1])return u;const c=v1(t,e,n,u);return t.disposeIntermediateTensorInfo(u),c}function x1(t,e,n,r=null){const i=null!=r?r.shape:e.shape,s=ZA(i[i.length-1]),a=new y1(i,s,n,null==r),o=null==r?[e]:[e,r],l=t.runWebGLProgram(a,o,"int32");if(l.shape.length===e.shape.length){const r=x1(t,e,n,l);return t.disposeIntermediateTensorInfo(l),r}return l}function b1(t,e,n,r){const i=[n];if(tk("arg"+r.charAt(0).toUpperCase()+r.slice(1),i,e.shape.length),!ey().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const n=[],s=t.texData.get(e.dataId);let a=e;null!==s&&s.isPacked&&(a=t.unpackTensor(e),n.push(a));const[o,l]=JI(a.shape,i),h=mg(l),u=z0({inputs:{x:a},backend:t,attrs:{shape:[-1,h]}});n.push(u);const c=v1(t,u,r);n.push(c);const d=z0({inputs:{x:c},backend:t,attrs:{shape:o}});return n.forEach((e=>t.disposeIntermediateTensorInfo(e))),d}return x1(t,e,r)}const w1={kernelName:py,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;let a=Ig(s,i.shape);const o=ek(a,i.shape.length);let l=i;const h=[];null!=o&&(l=J0({inputs:{x:i},backend:n,attrs:{perm:o}}),h.push(l),a=rk(a.length,l.shape.length)),tk("argMax",[a[0]],l.shape.length);const u=b1(n,l,a[0],"max");return h.forEach((t=>n.disposeIntermediateTensorInfo(t))),u}};const _1={kernelName:fy,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s}=r;let a=Ig(s,i.shape);const o=ek(a,i.shape.length);let l=i;const h=[];null!=o&&(l=J0({inputs:{x:i},backend:n,attrs:{perm:o}}),h.push(l),a=rk(a.length,l.shape.length)),tk("argMin",[a[0]],l.shape.length);const u=b1(n,l,a[0],"min");return h.forEach((t=>n.disposeIntermediateTensorInfo(t))),u}},T1=M0({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),E1={kernelName:my,backendName:"webgl",kernelFunc:T1},S1=M0({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"}),I1={kernelName:gy,backendName:"webgl",kernelFunc:S1},k1=M0({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"}),C1={kernelName:yy,backendName:"webgl",kernelFunc:k1},N1=O0({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"}),A1={kernelName:xy,backendName:"webgl",kernelFunc:N1},R1=M0({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),M1={kernelName:vy,backendName:"webgl",kernelFunc:R1};class O1{constructor(t,e,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const s=t.filterWidth,a=t.strideHeight,o=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;const f="avg"===e,m=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,g=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let y="0.0";if(f||(y="-1.0 / 1e-20"),n){const e=">=";return void(this.userCode=`\n        const ivec2 strides = ivec2(${a}, ${o});\n        const ivec2 pads = ivec2(${d}, ${p});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${u};\n              wR += ${l}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${c};\n                wC += ${h}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ${e} currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${r?i?m:g:`wR * ${c} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let v=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(v="avgValue / max(count, 1.0)");const x=4*Math.floor(s/4),b=s%4,w=`\n      if (${f}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${a}, ${o});\n      const ivec2 pads = ivec2(${d}, ${p});\n      const float initializationValue = ${y};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${y});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${u};\n            wR += ${l}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${x}; wC += 4) {\n            int xC = xCCorner + wC * ${h};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${h}, d),\n              getValue(batch, xR, xC + 2 * ${h}, d),\n              getValue(batch, xR, xC + 3 * ${h}, d)\n            );\n\n            ${w}\n          }\n\n          int xC = xCCorner + ${x};\n          if (${1===b}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${w}\n          } else if (${2===b}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${h}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${w}\n          } else if (${3===b}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${h}, d),\n              getValue(batch, xR, xC + 2 * ${h}, d),\n              initializationValue\n            );\n\n            ${w}\n          }\n        }\n        setOutput(${v});\n      }\n    `}}class P1{constructor(t,e,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const s=t.filterWidth,a=t.strideDepth,o=t.strideHeight,l=t.strideWidth,h=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,f=t.effectiveFilterWidth,m=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;const v="avg"===e;let x="0.0";if(v||(x="-1.0 / 1e-20"),n){const e=">=";return void(this.userCode=`\n        const ivec3 strides =\n            ivec3(${a}, ${o}, ${l});\n        const ivec3 pads = ivec3(${m}, ${g}, ${y});\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ${d};\n              wD += ${h}) {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int wR = 0; wR < ${p};\n                wR += ${u}) {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int wC = 0; wC < ${f};\n                  wC += ${c}) {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ${e} currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ${r?i?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${p} * ${f} +\n                      wR * ${f} + wC`};\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let b=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(b="avgValue / max(count, 1.0)");const w=4*Math.floor(s/4),_=s%4,T=`\n      if (${v}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec3 strides =\n        ivec3(${a}, ${o}, ${l});\n      const ivec3 pads = ivec3(${m}, ${g}, ${y});\n      const float initializationValue = ${x};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${x});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ${d};\n            wD += ${h}) {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${p};\n            wR += ${u}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${w}; wC += 4) {\n              int xC = xCCorner + wC * ${c};\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${c}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${c}, ch),\n                getValue(batch, xD, xR, xC + 3 * ${c}, ch)\n              );\n\n              ${T}\n            }\n\n            int xC = xCCorner + ${w};\n            if (${1===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ${T}\n            } else if (${2===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${c}, ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ${T}\n            } else if (${3===_}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${c}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${c}, ch),\n                initializationValue\n              );\n\n              ${T}\n            }\n          }\n        }\n        setOutput(${b});\n      }\n    `}}const D1={kernelName:by,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;nJ(i,"avgPool");const{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=r;dg(QS(a,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${a} and dilations '1'`));const h=GS(i.shape,s,a,1,o,l);if(1===h.filterWidth&&1===h.filterHeight&&vg(h.inShape,h.outShape))return _0({inputs:{x:i},backend:n});const u=new O1(h,"avg",!1);return n.runWebGLProgram(u,[i],"float32")}};const F1={kernelName:_y,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:a,pad:o,dimRoundingMode:l,dataFormat:h}=r,u=WS(i.shape,s,a,[1,1,1],o,l,h),c=new P1(u,"avg",!1);return n.runWebGLProgram(c,[i],"float32")}};class L1{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,s=t.dilationHeight,a=t.dilationWidth,o=t.effectiveFilterHeight,l=t.effectiveFilterWidth,h=o-1-t.padInfo.top,u=l-1-t.padInfo.left,c=1/(e*n);this.userCode=`\n      const ivec2 pads = ivec2(${h}, ${u});\n      const float avgMultiplier = float(${c});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${o};\n            wR += ${s}) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${l};\n            wC+= ${a}) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class B1{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,s=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,l=t.dilationHeight,h=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=u-1-t.padInfo.front,f=c-1-t.padInfo.top,m=d-1-t.padInfo.left,g=1/(e*n*r);this.userCode=`\n      const ivec3 pads = ivec3(${p}, ${f}, ${m});\n      const float avgMultiplier = float(${g});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${u};\n            wD += ${o}) {\n          float dyD = float(dyDCorner + wD) / ${i}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${c};\n              wR += ${l}) {\n            float dyR = float(dyRCorner + wR) / ${s}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${d};\n                wC += ${h}) {\n              float dyC = float(dyCCorner + wC) / ${a}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const $1={kernelName:Ty,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,a=s,{filterSize:o,strides:l,pad:h,dimRoundingMode:u}=r,c=WS(a.shape,o,l,[1,1,1],h,u),d=new B1(c);return n.runWebGLProgram(d,[i],a.dtype)}};const U1={kernelName:wy,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,a=s;nJ([i,s],"avgPoolGrad");const{filterSize:o,strides:l,pad:h}=r,u=GS(a.shape,o,l,1,h),c=new L1(u);return n.runWebGLProgram(c,[i],a.dtype)}};const V1={kernelName:Ey,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{a:i,b:s}=e,{transposeA:a,transposeB:o}=r;return t1({a:i,b:s,transposeA:a,transposeB:o,backend:n})}};class z1{constructor(t,e,n,r,i,s){this.outputShape=[],this.variableNames=["x","mean","variance"],iE(t,e),iE(t,n);let a="0.0";null!=r&&(iE(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let o="1.0";null!=i&&(iE(t,i),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${a};\n        float scale = ${o};\n        float inv = scale * inversesqrt(variance + float(${s}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}class G1{constructor(t,e,n,r,i,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],iE(t,e),iE(t,n);let a="vec4(0.0)";null!=r&&(iE(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let o="vec4(1.0)";null!=i&&(iE(t,i),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        vec4 offset = ${a};\n        vec4 scale = ${o};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${s}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}const W1={kernelName:yv,backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r,mean:i,variance:s,offset:a,scale:o}=t;dg(i.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),dg(null==a||i.shape.length===a.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),dg(null==o||i.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));let{varianceEpsilon:l}=n;null==l&&(l=.001);const h=[r,i,s];let u=null;null!=a&&(u=a.shape,h.push(a));let c=null;null!=o&&(c=o.shape,h.push(o));const d=ey().getBool("WEBGL_PACK_NORMALIZATION")?new G1(r.shape,i.shape,s.shape,u,c,l):new z1(r.shape,i.shape,s.shape,u,c,l);return e.runWebGLProgram(d,h,h[0].dtype)}};class X1{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const e=wJ(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(t){if(1===t)return"sourceLoc";if(t<=6)return H1.slice(0,t).map((t=>"sourceLoc."+t)).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}(this.rank);let r;const i=t.map(((t,e)=>`sourceLoc.${H1[e]} = start[${e}] + coords.${H1[e]};`));r=`\n        ${e} sourceLoc;\n        ${e} coords = getOutputCoords();\n        ${i.join("\n")}\n      `,this.userCode=`\n      void main() {\n        ${r}\n        setOutput(getSource(${n}));\n      }\n    `}}const H1=["x","y","z","w","u","v"];class Y1{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const e=wJ(this.rank),n=t0("coords",this.rank),r=t0("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":`vec2(${r.slice(-2).join()})`,s=`getChannel(getSource(${r.join()}), ${i})`,a=`\n      result.x = ${s};\n      if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n        ++${r[this.rank-1]};\n        result.y = ${s};\n        --${r[this.rank-1]};\n      }\n    `,o=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${t[this.rank-2]}) {\n        ++${r[this.rank-2]};\n        result.z = ${s};\n        if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n          ++${r[this.rank-1]};\n          result.w = ${s};\n        }\n      }\n    `,l=this.rank<=4?`sourceLoc = coords +\n            ${e}(${t.map(((t,e)=>`start[${e}]`)).join()});`:t.map(((t,e)=>`${r[e]} = ${n[e]} + start[${e}];`)).join("\n");this.userCode=`\n      void main() {\n        ${e} coords = getOutputCoords();\n        ${e} sourceLoc;\n        ${l}\n        vec4 result = vec4(0.);\n        ${a}\n        ${o}\n        setOutput(result);\n      }\n    `}}function j1(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,size:a}=r,[o,l]=dS(i,s,a);if(JE(i,o,l),0===mg(l))return n.makeTensorInfo(l,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||"string"===i.dtype){const t=n.texData.get(i.dataId),e=BQ(t.values,o,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,e)}const{isPacked:h}=n.texData.get(i.dataId),u=uS(i.shape,o,l);if(h||!u){const t=ey().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Y1(l):new X1(l),e=[o];return n.runWebGLProgram(t,[i],i.dtype,e)}return n.uploadToGPU(i.dataId),function(t,e,n,r){const i=r.texData.get(t.dataId),s=r.makeTensorInfo(n,t.dtype),a=r.texData.get(s.dataId);Object.assign(a,i),a.refCount=1,a.shape=n,a.dtype=t.dtype;let o=cS(e,Vg(t.shape));i.slice&&(o+=i.slice.flatOffset),a.slice={flatOffset:o,origDataId:i.slice&&i.slice.origDataId||t.dataId};const l=r.dataRefCount.get(a.slice.origDataId)||1;return r.dataRefCount.set(a.slice.origDataId,l+1),s}(i,o,l,n)}const q1={kernelName:Lx,backendName:"webgl",kernelFunc:j1},K1={kernelName:Sy,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,crops:a}=r;dg(i.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));const o=s.reduce(((t,e)=>t*e)),l=QA(i.shape,s,o),h=tR(l.length,s.length),u=eR(i.shape,s,o),c=nR(a,s.length),d=rR(u,a,s.length),p=[],f=z0({inputs:{x:i},backend:n,attrs:{shape:l}}),m=J0({inputs:{x:f},backend:n,attrs:{perm:h}}),g=z0({inputs:{x:m},backend:n,attrs:{shape:u}}),y=j1({inputs:{x:g},backend:n,attrs:{begin:c,size:d}});return p.push(f),p.push(m),p.push(g),p.forEach((t=>n.disposeIntermediateTensorInfo(t))),y}};const Z1={kernelName:Iy,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:a}=r,o=n.readSync(i.dataId),l=n.readSync(s.dataId),h=sQ(o,l,s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,h)}};const J1={kernelName:ky,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{a:r,b:i}=e,s=ey().getBool("WEBGL_PACK_BINARY_OPERATIONS"),a=ey().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([r,i])||1===a){const t=n.texData.get(r.dataId).values,e=n.texData.get(i.dataId).values,[s,a]=oQ(r.shape,i.shape,t,e,r.dtype),o=n.makeTensorInfo(a,r.dtype);return n.texData.get(o.dataId).values=s,o}let o;return o=s?new w0("\n  int r = int(a.r) & int(b.r);\n  int g = int(a.g) & int(b.g);\n  int rb = int(a.b) & int(b.b);\n  int ra = int(a.a) & int(b.a);\n  return vec4(r, g, rb, ra);\n",r.shape,i.shape,!1):new x0("\n  return float(int(a.r) & int(b.r));\n",r.shape,i.shape),n.runWebGLProgram(o,[r,i],r.dtype)}};const Q1={kernelName:Ny,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{s0:r,s1:i}=e,s=n.readSync(r.dataId),a=n.readSync(i.dataId),o=iE(Array.from(s),Array.from(a));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}},t2=O0({opSnippet:"return float(a != b);",cpuKernelImpl:CQ,dtype:"bool"}),e2={kernelName:ix,backendName:"webgl",kernelFunc:t2};function n2(t){const{inputs:e,backend:n}=t,{input:r}=e;return _0({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const r2={kernelName:bx,backendName:"webgl",kernelFunc:n2};const i2={kernelName:Ay,backendName:"webgl",kernelFunc:function t(e){const{inputs:n,backend:r,attrs:i}=e,{x:s}=n,{dtype:a}=i;if("complex64"===a){if("complex64"===s.dtype)return _0({inputs:{x:s},backend:r});const e=Wk(s.shape),n=t({inputs:{x:s},backend:r,attrs:{dtype:"float32"}}),i=E0({inputs:{real:n,imag:e},backend:r});return e.dispose(),r.disposeIntermediateTensorInfo(n),i}if("complex64"===s.dtype){const e=n2({inputs:{input:s},backend:r}),n=t({inputs:{x:e},backend:r,attrs:{dtype:a}});return r.disposeIntermediateTensorInfo(e),n}if(!Mg(s.dtype,a)){const t=_0({inputs:{x:s},backend:r});return{dataId:t.dataId,shape:t.shape,dtype:a}}if(r.shouldExecuteOnCPU([s])){const t=r.texData.get(s.dataId).values,[e,n,i]=lQ(t,s.shape,s.dtype,a);return r.makeTensorInfo(e,n,i)}if("int32"===a)return function(t,e){const n=new o0(t.shape,"return float(int(x));"),r=e.runWebGLProgram(n,[t],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(s,r);if("bool"===a){const t=r.makeTensorInfo([],"bool",Cg("bool",1)),e=t2({inputs:{a:s,b:t},backend:r});return r.disposeIntermediateTensorInfo(t),e}throw new Error(`Error in Cast: failed to cast ${s.dtype} to ${a}`)}},s2="return ceil(x);",a2=M0({opSnippet:s2,packedOpSnippet:s2,cpuKernelImpl:hQ}),o2={kernelName:Ry,backendName:"webgl",kernelFunc:a2};class l2{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}class h2{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}const u2={kernelName:My,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{clipValueMin:s,clipValueMax:a}=r;let o;o=ey().getBool("WEBGL_PACK_CLIP")?new h2(i.shape):new l2(i.shape);const l=[[s],[a]];return n.runWebGLProgram(o,[i],i.dtype,l)}};class c2{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}function d2(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}const p2={kernelName:Py,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e,i=n.texData.get(r.dataId),s=new c2(r.shape),a=[d2(r,i.complexTensorInfos.real),d2(r,i.complexTensorInfos.imag)];return n.runWebGLProgram(s,a,a[0].dtype)}};class f2{constructor(t){this.outputShape=[],this.outputShape=WA(t,1),this.variableNames=t.map(((t,e)=>`T${e}`));const e=new Array(t.length-1);e[0]=t[0][1];for(let n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];const n=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let t=1;t<e.length;t++){const r=e[t-1];n.push(`else if (yC < ${e[t]}) setOutput(getT${t}(yR, yC-${r}));`)}const r=e.length,i=e[e.length-1];n.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}class m2{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=WA(t,e);const n=this.outputShape,r=n.length,i=wJ(r),s=t0("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(((t,e)=>`T${e}`));const o=new Array(t.length-1);o[0]=t[0][e];for(let n=1;n<o.length;n++)o[n]=o[n-1]+t[n][e];const l=a[e],h=a.slice(-2),u=a.join();let c=`if (${l} < ${o[0]}) {\n        return getChannel(\n            getT0(${u}), vec2(${h.join()}));\n        }`;for(let t=1;t<o.length;t++){const e=o[t-1];c+=`\n        if (${l} < ${o[t]}  && ${l} >= ${o[t-1]}) {\n          return getChannel(\n            getT${t}(${g2(a,l,e)}),\n            vec2(${g2(h,l,e)}));\n        }`}const d=o.length,p=o[o.length-1];c+=`\n        return getChannel(\n          getT${d}(${g2(a,l,p)}),\n          vec2(${g2(h,l,p)}));`,this.userCode=`\n      float getValue(${a.map((t=>"int "+t))}) {\n        ${c}\n      }\n\n      void main() {\n        ${i} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${s}), 0., 0., 0.);\n\n        ${s[r-1]} = ${s[r-1]} + 1;\n        if (${s[r-1]} < ${n[r-1]}) {\n          result.g = getValue(${s});\n        }\n\n        ${s[r-2]} = ${s[r-2]} + 1;\n        if (${s[r-2]} < ${n[r-2]}) {\n          result.a = getValue(${s});\n        }\n\n        ${s[r-1]} = ${s[r-1]} - 1;\n        if (${s[r-2]} < ${n[r-2]} &&\n            ${s[r-1]} < ${n[r-1]}) {\n          result.b = getValue(${s});\n        }\n        setOutput(result);\n      }\n    `}}function g2(t,e,n){const r=t.indexOf(e),i=t.map(((t,e)=>e===r?`${t} - ${n}`:t));return i.join()}function y2(t){const{inputs:e,backend:n}=t,{input:r}=e;return _0({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}const v2={kernelName:Ev,backendName:"webgl",kernelFunc:y2};function x2(t,e,n){const r=t[0].dtype;if("complex64"===r){const r=t.map((t=>n2({inputs:{input:t},backend:n}))),i=t.map((t=>y2({inputs:{input:t},backend:n}))),s=x2(r,e,n),a=x2(i,e,n),o=E0({inputs:{real:s,imag:a},backend:n});return r.forEach((t=>n.disposeIntermediateTensorInfo(t))),i.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(a),o}let i=n.shouldExecuteOnCPU(t);if("string"===r&&(i=!0),i){const i=t.map((t=>{const r=mg(t.shape.slice(e));return z0({inputs:{x:t},backend:n,attrs:{shape:[-1,r]}})})),s=i.map((t=>({vals:n.readSync(t.dataId),shape:t.shape}))),a=WA(i.map((t=>t.shape)),1),o=1===i[0].shape[0],l=uQ(s,a,r,o),h=WA(t.map((t=>t.shape)),e),u=n.makeTensorInfo(h,r,l);return i.forEach((t=>n.disposeIntermediateTensorInfo(t))),u}const s=t.filter((t=>mg(t.shape)>0)),a=ey().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(1===s.length){const e=a?new o0(t[0].shape,h0):new u0(t[0].shape,h0);return n.runWebGLProgram(e,t,r)}const o=ey().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>o){const t=[];for(let r=0;r<s.length;r+=o){const i=s.slice(r,r+o);t.push(x2(i,e,n))}const r=x2(t,e,n);for(const e of t)n.disposeIntermediateTensorInfo(e);return r}if(a){const t=new m2(s.map((t=>t.shape)),e);return n.runWebGLProgram(t,s,r)}const{tensors2D:l,outShape:h}=function(t,e,n){const r=WA(t.map((t=>t.shape)),e),i=t.map((t=>z0({inputs:{x:t},attrs:{shape:[-1,mg(t.shape.slice(e))]},backend:n})));return{tensors2D:i,outShape:r}}(s,e,n),u=new f2(l.map((t=>t.shape))),c=n.runWebGLProgram(u,l,r);l.forEach((t=>n.disposeIntermediateTensorInfo(t)));const d=z0({inputs:{x:c},attrs:{shape:h},backend:n});return n.disposeIntermediateTensorInfo(c),d}function b2(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r,s=Ig(i,e[0].shape)[0];GA(e.map((t=>t.shape)),s);const a=WA(e.map((t=>t.shape)),s);if(0===mg(a))return n.makeTensorInfo(a,e[0].dtype,[]);const o=e.filter((t=>mg(t.shape)>0));return 1===o.length?_0({inputs:{x:o[0]},backend:n}):x2(o,s,n)}const w2={kernelName:Dy,backendName:"webgl",kernelFunc:b2};class _2{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const s=t.padInfo.top,a=t.padInfo.left,o=t.strideHeight,l=t.strideWidth,h=t.dilationHeight,u=t.dilationWidth,c=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),f=t.inChannels%4,m="channelsLast"===t.dataFormat,g=m?1:2,y=m?2:3,v=m?3:1;let x="",b="";n&&(x=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,b="result = activation(result);");const w=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${x}\n\n      const ivec2 strides = ivec2(${o}, ${l});\n      const ivec2 pads = ivec2(${s}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${v}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${g}], coords[${y}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${c}; wR++) {\n          int xR = xRCorner + wR * ${h};\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${d}; wC++) {\n            int xC = xCCorner + wC * ${u};\n\n            if (xC < 0 || xC >= ${t.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${p}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${m}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===f}) {\n\n              if (${m}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${p}) *\n                    getW(wR, wC, ${p}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${p}, xR, xC) *\n                    getW(wR, wC, ${p}, d2);\n              }\n\n            } else if (${2===f}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2)\n              );\n\n              if (${m}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===f}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${p}, d2),\n                getW(wR, wC, ${p} + 1, d2),\n                getW(wR, wC, ${p} + 2, d2)\n              );\n\n              if (${m}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${p}),\n                  getX(batch, xR, xC, ${p} + 1),\n                  getX(batch, xR, xC, ${p} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${p}, xR, xC),\n                  getX(batch, ${p} + 1, xR, xC),\n                  getX(batch, ${p} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${w}\n        ${b}\n        setOutput(result);\n      }\n    `}}class T2{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,i=t.strideDepth,s=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,l=t.dilationHeight,h=t.dilationWidth,u=t.filterDepth,c=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),f=t.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${i}, ${s}, ${a});\n      const ivec3 pads = ivec3(${e}, ${n}, ${r});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${u}; wF++) {\n          int xF = xFCorner + wF * ${o};\n\n          if (xF < 0 || xF >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${c}; wR++) {\n            int xR = xRCorner + wR * ${l};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${d}; wC++) {\n              int xC = xCCorner + wC * ${h};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${p}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===f}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${p}) *\n                  getW(wF, wR, wC, ${p}, d2);\n              } else if (${2===f}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===f}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${p}),\n                  getX(batch, xF, xR, xC, ${p} + 1),\n                  getX(batch, xF, xR, xC, ${p} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${p}, d2),\n                  getW(wF, wR, wC, ${p} + 1, d2),\n                  getW(wF, wR, wC, ${p} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class E2{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=kJ(this.outputShape.length);const s=t.padInfo.left,a=t.strideWidth,o=t.dilationWidth,l=t.filterHeight,h=t.filterWidth,u=h;let c="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;";for(let t=0;t<h;t++)c+=`\n           vec4 xTexelC${2*t};\n           int xTexelC${2*t}Ready;\n           vec4 xTexelC${2*t+1};\n           int xTexelC${2*t+1}Ready;\n           vec4 xC${t};`;c+=`\n     for (int r = 0; r < ${l}; r++) {\n      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {\n       `;for(let t=0;t<h;t++)c+=`\n           xTexelC${2*t} = vec4(0.0);\n           xTexelC${2*t}Ready = 0;\n           xTexelC${2*t+1} = vec4(0.0);\n           xTexelC${2*t+1}Ready = 0;\n           xC${t} = vec4(0.0);`;c+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(let e=0;e<(u+1)/2;e++){const n=2*e;if(c+=`\n           xC = xCCorner + ${n*o};\n           `,1===a){if(n<h&&(s%2==1?(c+=`\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n               `,c+=1===o&&n>0?`\n                 xC${n} = vec4(xTexelC${n-2}.zw, xTexelC${n}.xy);\n                 `:`\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC${n} = vec4(previous.zw, xTexelC${n}.xy);\n                   } else {\n                     xC${n} = vec4(0.0, 0.0, xTexelC${n}.xy);\n                   }\n                   `):c+=`\n                 if (xC >= 0 && xC < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 xC${n} = xTexelC${n};\n                 `,n+1<h)){const t=s%2==0?og(o):o;o%2==0&&s%2==1||o%2!=0&&s%2!=1?(c+=`\n                   xCOffset = xC + imod(pads[1], 2) + ${t};\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                     xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC${n+1}.zw = vec2(0.0);\n                     }\n                     xTexelC${n+1}Ready = 1;\n                   }\n                   `,c+=o>1?`\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC${n+1} = vec4(previous.zw, xTexelC${n+1}.xy);\n                     } else {\n                      xC${n+1} = vec4(0.0, 0.0, xTexelC${n+1}.xy);\n                     }\n                     `:`\n                     xC${n+1} = vec4(xTexelC${n}.zw, xTexelC${n+1}.xy);\n                     `):c+=1===t?`\n                     xC${n+1} = xTexelC${n};\n                     `:`\n                     xCOffset = xC + ${t};\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                       xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC${n+1}.zw = vec2(0.0);\n                       }\n                       xTexelC${n+1}Ready = 1;\n                     }\n\n                     xC${n+1} = xTexelC${n+1};\n                     `}}else n<h&&(s%2==1?(c+=`\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${n+1}Ready == 0) {\n                   xTexelC${n+1} = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC${n+1}.zw = vec2(0.0);\n                   }\n                   xTexelC${n+1}Ready = 1;\n                 }\n\n                 xC${n} = vec4(xTexelC${n}.zw, xTexelC${n+1}.zw);\n               `,n+1<h&&(c+=`\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC${n+1} = vec4(xTexelC${n+1}.xy, final.xy);\n                 `)):(c+=`\n                 if(xC >= 0 && xC < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                   xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n+1}.zw = vec2(0.);\n                   }\n                   xTexelC${n+1}Ready = 1;\n                 }\n\n                 xC${n} = vec4(\n                   xTexelC${n}.xy, xTexelC${n+1}.xy);\n               `,n+1<h&&(c+=`\n                   xC${n+1} = vec4(xTexelC${n}.zw, xTexelC${n+1}.zw);\n                 `)));n<h&&(c+=`\n             wTexel = getW(r, ${n}, d1, d2);\n             dotProd += xC${n}.xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ${t.inChannels}) {\n               dotProd += xC${n}.yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           `,n+1<h&&(c+=`\n               wTexel = getW(r, ${n+1}, d1, d2);\n               dotProd += xC${n+1}.xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ${t.inChannels}) {\n                 dotProd += xC${n+1}.yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             `))}c+="\n     }\n   ",c+="\n     }\n   ",c+="\n     }\n   ";let d="",p="";n&&(d=r?`vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ${n}\n         }`:i?`vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ${n}\n         }`:`vec4 activation(vec4 x) {\n           ${n}\n         }`,p="result = activation(result);");const f=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n       ${d}\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ${c}\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ${f}\n         ${p}\n         setOutput(result);\n       }\n     `}}class S2{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=kJ(this.outputShape.length);const{dataFormat:n}=e,r=iJ(),i="channelsLast"===n,s=i?1:2,a=i?2:3,o=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`;let l="";for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)l+=`\n          blockIndex = rc.z + ${e};\n          pos = rc.y + ${t};\n\n          ${o}\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[${s}] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[${a}] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (${i}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*t+e}] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*t+e}] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${l}\n\n        ${r.output} = result;\n      }\n    `}}function I2(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&1===n&&t[0]>1?[t[0],1]:null}function k2({x:t,filter:e,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:a=0,activation:o=null}){const l=t.shape,h=r.texData.get(t.dataId),u=n.inChannels,c=l[0]*l[1]*l[2],d=n.outChannels,p="channelsLast"===n.dataFormat;let f;const m=[];if(null!=s){const t=I2(s.shape,p);null!=t&&(s=z0({inputs:{x:s},backend:r,attrs:{shape:t}}),m.push(s))}if(null!=i){const t=I2(i.shape,p);null!=t&&(i=z0({inputs:{x:i},backend:r,attrs:{shape:t}}),m.push(i))}if(!((1===c||1===d)&&u>1e3)&&h.isPacked&&p&&null!=h.texture&&l[2]%2!=0&&vg(h.shape.slice(-3),l.slice(-3))){const u=l[0]*l[1]*(l[2]+1),c={dataId:t.dataId,shape:[1,u,n.inChannels],dtype:t.dtype},d=h.shape;h.shape=h.shape.slice(),h.shape[h.shape.length-2]++,dg(zZ(h.shape,c.shape),(()=>`packed reshape ${h.shape} to ${c.shape} isn't free`));const p=z0({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});m.push(p);const g=t1({a:c,b:p,backend:r,transposeA:false,transposeB:false,bias:i,activation:o,preluActivationWeights:s,leakyreluAlpha:a}),y=r.texData.get(g.dataId);dg(y.isPacked,(()=>"batchMatMul result is expected to be packed")),h.shape=d,y.shape=n.outShape,f=_0({inputs:{x:g},backend:r}),f.shape=n.outShape,m.push(g)}else{const l=n.outHeight*n.outWidth,h=z0({inputs:{x:t},backend:r,attrs:{shape:p?[n.batchSize,l,n.inChannels]:[n.batchSize,n.inChannels,l]}}),u=z0({inputs:{x:e},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),c=t1({a:p?h:u,b:p?u:h,transposeA:!p,transposeB:false,backend:r,bias:i,activation:o,preluActivationWeights:s,leakyreluAlpha:a});f=z0({inputs:{x:c},backend:r,attrs:{shape:n.outShape}}),m.push(h),m.push(u),m.push(c)}for(const t of m)r.disposeIntermediateTensorInfo(t);return f}function C2({x:t,filter:e,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:a=0,activation:o=null}){const{filterWidth:l,filterHeight:h,inChannels:u,outWidth:c,outHeight:d,dataFormat:p}=n,f="channelsLast"===p,m=l*h*u,g=d*c,y=[n.batchSize,m,g],v=[];if(null!=s){const t=I2(s.shape,f);null!=t&&(s=z0({inputs:{x:s},backend:r,attrs:{shape:t}}),v.push(s))}if(null!=i){const t=I2(i.shape,f);null!=t&&(i=z0({inputs:{x:i},backend:r,attrs:{shape:t}}),v.push(i))}const x=z0({inputs:{x:e},backend:r,attrs:{shape:[1,m,mg(e.shape)/m]}});v.push(x);const b=new S2(y,n),w=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],_=r.runWebGLProgram(b,[t],"float32",w),T=z0({inputs:{x:_},backend:r,attrs:{shape:y}});v.push(_),v.push(T);const E=null!=i,S=null!=s,I="leakyrelu"===o,k=o?P0(o,!0):null,C=new D0(f?T.shape:x.shape,f?x.shape:T.shape,f?[n.batchSize,g,n.outChannels]:[n.batchSize,n.outChannels,g],!0,!1,E,k,S,I),N=f?[T,x]:[x,T];if(i&&N.push(i),S&&N.push(s),I){const t=r.makeTensorInfo([],"float32",Jb(a,"float32"));N.push(t),v.push(t)}const A=r.runWebGLProgram(C,N,"float32"),R=z0({inputs:{x:A},backend:r,attrs:{shape:n.outShape}});v.push(A);for(const t of v)r.disposeIntermediateTensorInfo(t);return R}const N2={kernelName:Fy,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:a,pad:o,dataFormat:l,dilations:h,dimRoundingMode:u}=r,c=eI(l),d=XS(i.shape,s.shape,a,h,o,u,!1,c);let p;if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(d.strideWidth<=2&&"channelsLast"===c&&ey().getBool("WEBGL_EXP_CONV")){const t=new E2(d),e=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];p=n.runWebGLProgram(t,[i,s],"float32",e)}else if(ey().getBool("WEBGL_CONV_IM2COL"))p=C2({x:i,filter:s,convInfo:d,backend:n});else{const t=new _2(d);p=n.runWebGLProgram(t,[i,s],"float32")}else p=k2({x:i,filter:s,convInfo:d,backend:n});const f=z0({inputs:{x:p},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(p),f}};class A2{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,s="channelsLast"===t.dataFormat;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${r};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${i};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              ${s?"float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);":"float dyValue = getDy(b, d2, yR, yC);\n              float xValue = getX(b, d1, xR, xC);\n              dotProd += (xValue * dyValue);"}\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class R2{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,s="channelsLast"===t.dataFormat,a=e-1-t.padInfo.top,o=n-1-t.padInfo.left,l=s?1:2,h=s?2:3,u=s?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${a}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${u}];\n\n        ivec2 dyCorner = ivec2(coords[${l}], coords[${h}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n\n              if (${s}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class M2{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.padInfo.front,s=t.padInfo.top,a=t.padInfo.left;this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yF = 0; yF < ${t.outDepth}; yF++) {\n            int xF = wF + yF * ${e} - ${i};\n\n            if (xF < 0 || xF >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${t.outHeight}; yR++) {\n              int xR = wR + yR * ${n} - ${s};\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${t.outWidth}; yC++) {\n                int xC = wC + yC * ${r} - ${a};\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class O2{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,s=t.strideHeight,a=t.strideWidth,o=e-1-t.padInfo.front,l=n-1-t.padInfo.top,h=r-1-t.padInfo.left;this.userCode=`\n      const ivec3 pads = ivec3(${o}, ${l}, ${h});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${e}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${i}.0;\n\n          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${e} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${s}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${r}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${a}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${r} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const P2={kernelName:Ly,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:a,pad:o,dataFormat:l,dimRoundingMode:h,filterShape:u}=r,c=eI(l),d=XS(i.shape,u,a,1,o,h,!1,c),p=new A2(d);return n.runWebGLProgram(p,[i,s],"float32")}};class D2{constructor(t){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=kJ(this.outputShape.length);const e=t.filterHeight,n=t.filterWidth,r=e-1-t.padInfo.top,i=n-1-t.padInfo.left;this.userCode=`\n      const ivec2 pads = ivec2(${r}, ${i});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        vec4 result = vec4(0.);\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / strides[0];\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            int wCPerm = ${n} - 1 - wC;\n\n            float dyC = float(dyCCorner + wC) / strides[1];\n            bool idyCVal = (dyC >= 0.0) && (dyC < ${t.outWidth}.0)\n              && (fract(dyC) == 0.0);\n            int idyC = int(dyC);\n\n            float dyC2 = float(dyCCorner + wC + 1) / strides[1];\n            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${t.outWidth}.0)\n              && (fract(dyC2) == 0.0);\n            int idyC2 = int(dyC2);\n\n            if (idyCVal && idyCVal2) {\n              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?\n                  dySample : getDy(batch, idyR, idyC2, d2);\n\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n\n                dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample2.xy : dySample2.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal) {\n              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal2) {\n              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC2, d2);\n                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            }\n          }\n        }\n        setOutput(result);\n      }\n    `}}const F2={kernelName:By,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{inputShape:a,strides:o,pad:l,dataFormat:h,dimRoundingMode:u}=r,c=eI(h),d=XS(a,s.shape,o,1,l,u,!1,c);if(ey().getBool("WEBGL_PACK")&&"channelsLast"===c){const t=[[d.strideHeight,d.strideWidth]],e=new D2(d);return n.runWebGLProgram(e,[i,s],"float32",t)}{const t=new R2(d);return n.runWebGLProgram(t,[i,s],"float32")}}};const L2={kernelName:$y,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:a,pad:o,dilations:l}=r,h=HS(i.shape,s.shape,a,l,o),u=new T2(h);return n.runWebGLProgram(u,[i,s],"float32")}};const B2={kernelName:Uy,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:a,pad:o,filterShape:l}=r,h=HS(i.shape,l,a,1,o),u=new M2(h);return n.runWebGLProgram(u,[i,s],"float32")}};const $2={kernelName:Vy,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{pad:a,strides:o,inputShape:l}=r,h=HS(l,s.shape,o,1,a),u=new O2(h);return n.runWebGLProgram(u,[i,s],"float32")}},U2=M0({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n",packedOpSnippet:`\n  vec4 result = cos(x);\n  bvec4 isNaN = isnan(x);\n  ${b0}\n  return result;\n`}),V2={kernelName:zy,backendName:"webgl",kernelFunc:U2},z2=M0({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),G2={kernelName:Gy,backendName:"webgl",kernelFunc:z2};class W2{constructor(t,e,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[s,a,o,l]=t,[h]=e,[u,c]=n;this.outputShape=[h,u,c,l];const d="bilinear"===r?1:0,[p,f]=[a-1+".0",o-1+".0"],[m,g,y]=u>1?[""+(a-1)/(u-1),"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[v,x,b]=c>1?[""+(o-1)/(c-1),"(x2-x1) * width_ratio",`x1*${f} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${f}`];this.userCode=`\n      const float height_ratio = float(${m});\n      const float width_ratio = float(${v});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${s}) {\n          return;\n        }\n\n        float height_scale = ${g};\n        float width_scale = ${x};\n\n        float in_y = ${y};\n        if( in_y < 0.0 || in_y > ${p} ) {\n          setOutput(float(${i}));\n          return;\n        }\n        float in_x = ${b};\n        if( in_x < 0.0 || in_x > ${f} ) {\n          setOutput(float(${i}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${d} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}const X2={kernelName:Hy,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{image:i,boxes:s,boxInd:a}=e,{cropSize:o,method:l,extrapolationValue:h}=r,u=new W2(i.shape,s.shape,o,l,h);return n.runWebGLProgram(u,[i,s,a],"float32")}};var H2;!function(t){t.Prod="*",t.Sum="+"}(H2||(H2={}));class Y2{constructor(t,e,n,r){this.op=t,this.outputShape=e,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,s=this.op===H2.Prod?"1.0":"0.0",a=n?s:`getX(${j2(i,"coords",this.op)})`,o=this.outputShape[this.outputShape.length-1];let l="",h="";n?(l=r?"end != "+(o-1):"end != 0",h=r?"end + 1":"end - 1"):(l=r?`end + pow2 < ${o}`:"end >= pow2",h=r?"end + pow2":"end - pow2"),this.userCode=`\n      void main() {\n        ${wJ(i)} coords = getOutputCoords();\n        int end = ${q2(i,"coords",this.op)};\n        float val = ${a};\n        int pow2 = int(pow(2.0, index));\n        if (${l}) {\n          int idx = ${h};\n          ${q2(i,"coords",this.op)} = idx;\n          val ${this.op}= getX(${j2(i,"coords",this.op)});\n        }\n        setOutput(val);\n      }\n    `}}function j2(t,e,n){if(1===t)return`${e}`;if(2===t)return`${e}.x, ${e}.y`;if(3===t)return`${e}.x, ${e}.y, ${e}.z`;if(4===t)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function q2(t,e,n){if(1===t)return`${e}`;if(2===t)return`${e}.y`;if(3===t)return`${e}.z`;if(4===t)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function K2(t,e,n,r,i,s){const a=e.shape.length,o=ek([r],a);let l=e;null!=o&&(l=J0({inputs:{x:e},backend:n,attrs:{perm:o}}));const h=rk(1,a)[0];if(h!==a-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${r}`);const u=l.shape[h];let c=_0({inputs:{x:l},backend:n});for(let e=0;e<=Math.ceil(Math.log2(u))-1;e++){const r=new Y2(t,l.shape,!1,s),i=[[e]],a=c;c=n.runWebGLProgram(r,[c],c.dtype,i),n.disposeIntermediateTensorInfo(a)}if(i){const e=new Y2(t,l.shape,i,s),r=c;c=n.runWebGLProgram(e,[c],c.dtype),n.disposeIntermediateTensorInfo(r)}if(null!=o){const t=J0({inputs:{x:c},backend:n,attrs:{perm:nk(o)}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),t}return c}const Z2={kernelName:Wy,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:a,reverse:o}=r;return K2(H2.Prod,i,n,s,a,o)}};const J2={kernelName:Xy,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,exclusive:a,reverse:o}=r;return K2(H2.Sum,i,n,s,a,o)}};const Q2={kernelName:Yy,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,weights:s}=e,{size:a,binaryOutput:o}=r;if(1===i.shape.length){const t=n.readSync(i.dataId),e=n.readSync(s.dataId),r=sQ(t,e,s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,r)}if(2===i.shape.length){const t=n.bufferSync(i),e=n.bufferSync(s),r=aQ(t,e,a,o);return n.makeTensorInfo(r.shape,s.dtype,r.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}};class t3{constructor(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${e};\n      int offset_h = imod(h, ${e});\n      int in_w = w / ${e};\n      int offset_w = imod(w, ${e});\n      int offset_d = (offset_h * ${e} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}const e3={kernelName:jy,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockSize:s,dataFormat:a}=r,o=i.shape[0],l=("NHWC"===a?i.shape[1]:i.shape[2])*s,h=("NHWC"===a?i.shape[2]:i.shape[3])*s,u=("NHWC"===a?i.shape[3]:i.shape[1])/(s*s),c=new t3("NHWC"===a?[o,l,h,u]:[o,u,l,h],s,a);return n.runWebGLProgram(c,[i],i.dtype)}};class n3{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=kJ(this.outputShape.length);const s=t.filterHeight,a=t.filterWidth,o=t.outChannels/t.inChannels;let l="",h="";n&&(l=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,h="result = activation(result);");const u=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${l}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${o};\n        int q = d2 - d1 * ${o};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${s}; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${a}; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${u}\n        ${h}\n        setOutput(result);\n      }\n    `}}class r3{constructor(t,e=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=kJ(this.outputShape.length);const s=t.outChannels/t.inChannels,a=t.padInfo.left,o=t.strideWidth,l=t.dilationWidth,h=t.filterHeight,u=t.filterWidth,c=u;let d="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let t=0;t<u;t++)d+=`\n          vec4 xTexelC${2*t};\n          int xTexelC${2*t}Ready;\n          vec4 xTexelC${2*t+1};\n          int xTexelC${2*t+1}Ready;\n          vec4 xC${t};`;d+=`\n    for (int r = 0; r < ${h}; r++) {\n      `;for(let t=0;t<u;t++)d+=`\n          xTexelC${2*t} = vec4(0.0);\n          xTexelC${2*t}Ready = 0;\n          xTexelC${2*t+1} = vec4(0.0);\n          xTexelC${2*t+1}Ready = 0;\n          xC${t} = vec4(0.0);`;d+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let t=0;t<(c+1)/2;t++){const e=2*t;if(d+=`\n          xC = xCCorner + ${e*l};\n          `,1===o){if(e<u&&(a%2==1?(d+=`\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n              `,d+=1===l&&e>0?`\n                xC${e} = vec4(xTexelC${e-2}.zw, xTexelC${e}.xy);\n                `:`\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC${e} = vec4(previous.zw, xTexelC${e}.xy);\n                  } else {\n                    xC${e} = vec4(0.0, 0.0, xTexelC${e}.xy);\n                  }\n                  `):d+=`\n                if (xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                xC${e} = xTexelC${e};\n                `,e+1<u)){const t=a%2==0?og(l):l;l%2==0&&a%2==1||l%2!=0&&a%2!=1?(d+=`\n                  xCOffset = xC + imod(pads[1], 2) + ${t};\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                    xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC${e+1}.zw = vec2(0.0);\n                    }\n                    xTexelC${e+1}Ready = 1;\n                  }\n                  `,d+=l>1?`\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC${e+1} = vec4(previous.zw, xTexelC${e+1}.xy);\n                    } else {\n                     xC${e+1} = vec4(0.0, 0.0, xTexelC${e+1}.xy);\n                    }\n                    `:`\n                    xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.xy);\n                    `):d+=1===t?`\n                    xC${e+1} = xTexelC${e};\n                    `:`\n                    xCOffset = xC + ${t};\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                      xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC${e+1}.zw = vec2(0.0);\n                      }\n                      xTexelC${e+1}Ready = 1;\n                    }\n\n                    xC${e+1} = xTexelC${e+1};\n                    `}}else e<u&&(a%2==1?(d+=`\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${e+1}Ready == 0) {\n                  xTexelC${e+1} = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC${e+1}.zw = vec2(0.0);\n                  }\n                  xTexelC${e+1}Ready = 1;\n                }\n\n                xC${e} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n              `,e+1<u&&(d+=`\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC${e+1} = vec4(xTexelC${e+1}.xy, final.xy);\n                `)):(d+=`\n                if(xC >= 0 && xC < inDims[1] && xTexelC${e}Ready == 0) {\n                  xTexelC${e} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${e}.zw = vec2(0.0);\n                  }\n                  xTexelC${e}Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${e+1}Ready == 0) {\n                  xTexelC${e+1} = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${e+1}.zw = vec2(0.);\n                  }\n                  xTexelC${e+1}Ready = 1;\n                }\n\n                xC${e} = vec4(\n                  xTexelC${e}.xy, xTexelC${e+1}.xy);\n              `,e+1<u&&(d+=`\n                  xC${e+1} = vec4(xTexelC${e}.zw, xTexelC${e+1}.zw);\n                `)));e<u&&(d+=`\n            wTexel = getW(r, ${e}, d1, q);\n            dotProd += xC${e} * vec4(wTexel.xz, wTexel.xz);\n          `,e+1<u&&(d+=`\n              wTexel = getW(r, ${e+1}, d1, q);\n              dotProd += xC${e+1} * vec4(wTexel.xz, wTexel.xz);\n            `))}d+="\n    }\n  ",d+="\n      }\n    ";let p="",f="";n&&(p=r?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,f="result = activation(result);");const m=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${p}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${s};\n        int q = d2 - d1 * ${s};\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ${d}\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ${m}\n        ${f}\n        setOutput(result);\n      }\n    `}}const i3={kernelName:qy,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:a,pad:o,dilations:l,dimRoundingMode:h}=r;let u=l;null==u&&(u=[1,1]),dg(QS(a,u),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${a} and dilations '${u}'`));const c=XS(i.shape,s.shape,a,u,o,h,!0);let d;d=ey().getBool("WEBGL_PACK_DEPTHWISECONV")&&c.strideWidth<=2&&c.outChannels/c.inChannels==1?new r3(c):new n3(c);const p=[[c.padInfo.top,c.padInfo.left],[c.strideHeight,c.strideWidth],[c.dilationHeight,c.dilationWidth],[c.inHeight,c.inWidth]];return n.runWebGLProgram(d,[i,s],"float32",p)}};class s3{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,s=t.outChannels/t.inChannels;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${s} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${r};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${i};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class a3{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,s=e-1-t.padInfo.top,a=n-1-t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${s}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${o}; dm++) {\n              int d2 = d1 * ${o} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const o3={kernelName:Ky,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,dy:s}=e,{strides:a,dilations:o,pad:l,dimRoundingMode:h,filterShape:u}=r,c=XS(i.shape,u,a,o,l,h,!0),d=new s3(c);return n.runWebGLProgram(d,[i,s],"float32")}};const l3={kernelName:Zy,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,filter:s}=e,{strides:a,dilations:o,pad:l,dimRoundingMode:h,inputShape:u}=r,c=XS(u,s.shape,a,o,l,h,!0),d=new a3(c);return n.runWebGLProgram(d,[i,s],"float32")}};class h3{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}const u3={kernelName:Jy,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e,i=[...r.shape,...r.shape],s=mg(r.shape),a=z0({inputs:{x:r},backend:n,attrs:{shape:[s]}}),o=new h3(s),l=n.runWebGLProgram(o,[a],a.dtype),h=z0({inputs:{x:l},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),h}};class c3{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:e,inWidth:n,padInfo:r,strideHeight:i,strideWidth:s,filterHeight:a,filterWidth:o,dilationHeight:l,dilationWidth:h}=t,{top:u,left:c}=r;this.userCode=`\n      const ivec2 strides = ivec2(${i}, ${s});\n      const ivec2 pads = ivec2(${u}, ${c});\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ${a}; h++) {\n          int hIn = hBeg + h * ${l};\n\n          if (hIn >= 0 && hIn < ${e}) {\n            for (int w = 0; w < ${o}; w++) {\n              int wIn = wBeg + w * ${h};\n\n              if (wIn >= 0 && wIn < ${n}) {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    `}}const d3={kernelName:Qy,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s}=e,{strides:a,pad:o,dilations:l}=r,h=zS(i.shape,s.shape,a,o,"NHWC",l);let u;const c=new c3(h);u=n.runWebGLProgram(c,[i,s],"float32");const d=z0({inputs:{x:u},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(u),d}};const p3={kernelName:iv,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{equation:i}=r,s=e,{allDims:a,summedDims:o,idDims:l}=_R(i,s.length);ER(a.length,l,s);const{path:h,steps:u}=SR(o,l),c=u.length;let d=null,p=a.length;const f=[];for(let t=0;t<c;++t){for(const e of u[t]){const{permutationIndices:t,expandDims:r}=TR(p,l[e]);let i;IR(t)?i=s[e]:(i=J0({inputs:{x:s[e]},backend:n,attrs:{perm:t}}),f.push(i));const a=i.shape.slice();for(let t=0;t<r.length;++t)a.splice(r[t],0,1);vg(i.shape,a)||(i=z0({inputs:{x:i},backend:n,attrs:{shape:a}}),f.push(i)),null===d?d=i:(d=U0({inputs:{a:i,b:d},backend:n}),f.push(d))}t<c-1&&(h[t]>=0&&(d=K0({inputs:{x:d},backend:n,attrs:{axis:h[t]-(a.length-p),keepDims:!1}}),f.push(d)),p--)}for(const t of f)t!==d&&n.disposeIntermediateTensorInfo(t);return d}},f3=M0({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),m3={kernelName:sv,backendName:"webgl",kernelFunc:f3},g3={kernelName:av,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n}=t,{dy:r,y:i}=e,s=ey().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new w0("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,i.shape):new x0("return (b >= 0.0) ? a : a * (b + 1.0);",r.shape,i.shape);return n.runWebGLProgram(s,[r,i],r.dtype)}},y3=O0({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:cQ}),v3={kernelName:lv,backendName:"webgl",kernelFunc:y3},x3=M0({opSnippet:`\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = ${aR};\n  float a1 = ${oR};\n  float a2 = ${lR};\n  float a3 = ${hR};\n  float a4 = ${uR};\n  float a5 = ${cR};\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n`}),b3={kernelName:ov,backendName:"webgl",kernelFunc:x3},w3=M0({opSnippet:"if (isnan(x)) return x;\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:dQ,dtype:"float32"}),_3={kernelName:hv,backendName:"webgl",kernelFunc:w3};function T3(t){const{inputs:e,attrs:n,backend:r}=t,{dim:i}=n,{input:s}=e,a=s.shape.length,o=s.shape.slice();let l=i;return i<0&&(dg(-(a+1)<=i,(()=>`Axis must be in the interval [${-(a+1)}, ${a}]`)),l=a+i+1),o.splice(l,0,1),z0({inputs:{x:s},backend:r,attrs:{shape:o}})}const E3={kernelName:uv,backendName:"webgl",kernelFunc:T3},S3="return exp(x) - 1.0;",I3=M0({opSnippet:S3,packedOpSnippet:S3,cpuKernelImpl:pQ}),k3={kernelName:cv,backendName:"webgl",kernelFunc:I3};class C3{constructor(t,e,n){this.variableNames=["real","imag"];const r=e[1];this.outputShape=e;const i=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=n?`${r}.0`:"1.0";let a;if("real"===t)a="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);a="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${i};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${a}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${r});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${r}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${s};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}function N3(t,e,n){const r=n.texData.get(t.dataId),i=mg(t.shape),s=t.shape[t.shape.length-1],a=z0({inputs:{x:t},backend:n,attrs:{shape:[i/s,s]}}),o=a.shape,l=new C3("real",o,e),h=new C3("imag",o,e),u=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:o},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:o}],c=n.runWebGLProgram(l,u,"float32"),d=n.runWebGLProgram(h,u,"float32"),p=E0({inputs:{real:c,imag:d},backend:n});n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d);const f=z0({inputs:{x:p},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),f}const A3={kernelName:dv,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:r}=e;return N3(r,!1,n)}};class R3{constructor(t,e){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}function M3(t){const{backend:e,attrs:n}=t,{shape:r,value:i}=n;let{dtype:s}=n;if(s=s||Bg(i),"string"===s){const t=Ng(s,mg(r));return t.fill(i),e.makeTensorInfo(r,s,t)}{const t=new R3(r,i),n=[[i]];return e.runWebGLProgram(t,[],s,n)}}const O3={kernelName:pv,backendName:"webgl",kernelFunc:M3};class P3{constructor(t){this.variableNames=["Image"],this.outputShape=[];const e=t[2];this.outputShape=t,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${e} - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${e}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}const D3={kernelName:fv,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,r=e,i=new P3(n.shape);return r.runWebGLProgram(i,[n],n.dtype)}},F3="return floor(x);",L3=M0({opSnippet:F3,packedOpSnippet:F3,cpuKernelImpl:fQ}),B3={kernelName:mv,backendName:"webgl",kernelFunc:L3},$3=O0({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),U3={kernelName:gv,backendName:"webgl",kernelFunc:$3};class V3{constructor(t){this.variableNames=["A"];const e=iJ(),[n,r]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);\n\n        vec4 values = ${e.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}class z3{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const e=iJ(),[n,r]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${r}.0, ${n}.0);\n            vec4 values = ${e.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${e.output} = result;\n      }\n    `}}const G3={kernelName:xb,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t;let{pixels:i}=e;const{numChannels:s}=r,a="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,o="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,[l,h]=a?[i.videoWidth,i.videoHeight]:[i.width,i.height],u=[h,l],c=[h,l,s];if(o||a){const t=ey().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=W3&&t===X3||(X3=t,W3=document.createElement("canvas").getContext("2d",{willReadFrequently:X3})),W3.canvas.width=l,W3.canvas.height=h,W3.drawImage(i,0,0,l,h),i=W3.canvas}const d=n.makeTensorInfo(u,"int32");n.texData.get(d.dataId).usage=eZ.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),i);const p=ey().getBool("WEBGL_PACK")?new z3(c):new V3(c),f=n.runWebGLProgram(p,[d],"int32");return n.disposeData(d.dataId),f}};let W3,X3=ey().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");const H3={kernelName:_b,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:a,preluActivationWeights:o}=e,{strides:l,pad:h,dataFormat:u,dilations:c,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,m=eI(u),g=XS(i.shape,s.shape,l,c,h,d,!1,m);let y;const v=[],x=null!=a,b=null!=o,w="leakyrelu"===p,_=()=>{const t=[i,s],e=(t,e)=>{if("NCHW"===e&&1===t.shape.length&&1!==t.shape[0]){const e=z0({inputs:{x:t},backend:n,attrs:{shape:[t.shape[0],1,1]}});return v.push(e),e}return t};if(x&&t.push(e(a,u)),b&&t.push(e(o,u)),w){const e=n.makeTensorInfo([],"float32",Jb(f,"float32"));t.push(e),v.push(e)}return t};if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(g.strideWidth<=2&&"channelsLast"===m&&ey().getBool("WEBGL_EXP_CONV")){const t=p?P0(p,!0):null,e=new E2(g,x,t,b,w),r=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],i=_();y=n.runWebGLProgram(e,i,"float32",r)}else if(ey().getBool("WEBGL_CONV_IM2COL"))y=C2({x:i,filter:s,convInfo:g,backend:n,bias:a,activation:p,preluActivationWeights:o,leakyreluAlpha:f});else{const t=p?P0(p,!1):null,e=new _2(g,x,t,b,w),r=_();y=n.runWebGLProgram(e,r,"float32")}else y=k2({x:i,filter:s,convInfo:g,backend:n,bias:a,activation:p,preluActivationWeights:o,leakyreluAlpha:f});const T=z0({inputs:{x:y},backend:n,attrs:{shape:g.outShape}});return v.push(y),v.forEach((t=>n.disposeIntermediateTensorInfo(t))),T}};const Y3={kernelName:Tb,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,filter:s,bias:a,preluActivationWeights:o}=e,{strides:l,pad:h,dilations:u,dimRoundingMode:c,activation:d,leakyreluAlpha:p}=r,f=[];let m=u;null==m&&(m=[1,1]),dg(QS(l,m),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`));const g=XS(i.shape,s.shape,l,m,h,c,!0),y=ey().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels==1,v=d?P0(d,y):null,x=[i,s],b=null!=a,w=null!=o,_="leakyrelu"===d;if(b&&x.push(a),w&&x.push(o),_){const t=n.makeTensorInfo([],"float32",Jb(p,"float32"));x.push(t),f.push(t)}let T;T=y?new r3(g,b,v,w,_):new n3(g,b,v,w,_);const E=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],S=n.runWebGLProgram(T,x,"float32",E);return f.forEach((t=>n.disposeIntermediateTensorInfo(t))),S}};class j3{constructor(t,e,n,r){this.sliceDim=t,this.strides=e,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=n;const i=wJ(n.length);let s="\n    int index;";for(let t=0;t<this.sliceDim;t++)s+=`\n          index = round(getIndices(coords[0], ${t}));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[t]};\n          flattenIndex += index * ${this.strides[t]};`;this.userCode=`\n         void main() {\n          ${i} coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ${s}\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      `}}const q3={kernelName:xv,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{params:r,indices:i}=e,s=i.shape,a=s[s.length-1],o=mg(r.shape),[l,h,u,c]=jE(r,i),d=z0({inputs:{x:i},backend:n,attrs:{shape:[h,a]}}),p=z0({inputs:{x:r},backend:n,attrs:{shape:[mg(r.shape)/u,u]}});if(n.shouldExecuteOnCPU([r,i])||"string"===r.dtype){const t=n.readSync(i.dataId),e=n.bufferSync(r),s=mQ(t,e,r.dtype,h,a,u,c,r.shape,o);return n.makeTensorInfo(l,r.dtype,s.values)}const f=new j3(a,c,[h,u],r.shape),m=n.runWebGLProgram(f,[p,d],p.dtype),g=z0({inputs:{x:m},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}};class K3{constructor(t,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;const n=wJ(this.rank),r=function(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let e=0;e<t.length;e++)2===e?r.push("index"):r.push(`${n[e]}`);return r.join()}(t);this.userCode=`\n      void main() {\n        ${n} resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;\n        setOutput(inBounds * getA(${r}));\n      }\n    `}}function Z3(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,indices:s}=e,{axis:a,batchDims:o}=r,l=Ig(a,i.shape)[0];if(ey().get("DEBUG")){const t=n.readSync(s.dataId),e=i.shape[l];for(let n=0;n<t.length;++n){const r=t[n];dg(r<=e-1&&r>=0,(()=>`GatherV2: the index value ${r} is not in [0, ${e-1}]`))}}const h=GR(i,s,l,o),u=mg(s.shape),c=[],d=z0({inputs:{x:i},backend:n,attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]}}),p=z0({inputs:{x:s},backend:n,attrs:{shape:[h.batchSize,u/h.batchSize]}});c.push(d),c.push(p);const f=[h.batchSize,h.outerSize,u/h.batchSize,h.sliceSize];if(n.shouldExecuteOnCPU([i,s])||"string"===i.dtype){const t=n.bufferSync(p),e=n.bufferSync(d),r=gQ(e,t,f);return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(h.outputShape,r.dtype,r.values)}const m=new K3(d.shape,f),g=n.runWebGLProgram(m,[d,p],d.dtype);c.push(g);const y=z0({inputs:{x:g},backend:n,attrs:{shape:h.outputShape}});return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),y}const J3={kernelName:vv,backendName:"webgl",kernelFunc:Z3},Q3=O0({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:yQ,dtype:"bool"}),t4={kernelName:bv,backendName:"webgl",kernelFunc:Q3},e4=O0({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:vQ}),n4={kernelName:wv,backendName:"webgl",kernelFunc:e4};const r4={kernelName:Tv,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{input:r}=e;return N3(r,!0,n)}},i4=M0({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),s4={kernelName:Sv,backendName:"webgl",kernelFunc:i4},a4=M0({opSnippet:"return float(isinf(x));",dtype:"bool"}),o4={kernelName:Iv,backendName:"webgl",kernelFunc:a4},l4=M0({opSnippet:"return float(isnan(x));",dtype:"bool"}),h4={kernelName:kv,backendName:"webgl",kernelFunc:l4},u4=O0({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:xQ,dtype:"bool"}),c4={kernelName:Nv,backendName:"webgl",kernelFunc:u4},d4=O0({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:bQ,dtype:"bool"}),p4={kernelName:Av,backendName:"webgl",kernelFunc:d4};const f4={kernelName:Rv,backendName:"webgl",kernelFunc:function(t){const{backend:e,attrs:n}=t,{start:r,stop:i,num:s}=n,a=wQ(r,i,s);return e.makeTensorInfo([a.length],"float32",a)}},m4=M0({opSnippet:"if (isnan(x)) return x;\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:_Q}),g4={kernelName:Mv,backendName:"webgl",kernelFunc:m4},y4=M0({opSnippet:"if (isnan(x)) return x;\n  return log(1.0 + x);\n"}),v4={kernelName:Ov,backendName:"webgl",kernelFunc:y4},x4=O0({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),b4={kernelName:Pv,backendName:"webgl",kernelFunc:x4},w4=M0({opSnippet:"return float(!(x >= 1.0));"}),_4={kernelName:Dv,backendName:"webgl",kernelFunc:w4},T4=O0({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),E4={kernelName:Fv,backendName:"webgl",kernelFunc:T4};class S4{constructor(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[];const s=e,a=t[3]-1;let o;this.outputShape=t;const l=`float(${n}) + float(${r}) * sum`;o=.5===i?`inversesqrt(${l})`:1===i?`1.0/(${l})`:`exp(log(${l}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${s}; j <= ${s}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${a}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${o};\n        setOutput(val);\n      }\n    `}}class I4{constructor(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const s=e,a=t[3]-1;let o;this.outputShape=t;const l=`float(${n}) + float(${r}) * sum`;o=.5===i?`inversesqrt(${l})`:1===i?`1.0/(${l})`:`exp(log(${l}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${s};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${s}; j <= ${s}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${o};\n        setOutput(result);\n      }\n    `}}const k4={kernelName:Uv,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{depthRadius:s,bias:a,alpha:o,beta:l}=r,h=ey().getBool("WEBGL_PACK_NORMALIZATION")?new I4(i.shape,s,a,o,l):new S4(i.shape,s,a,o,l);return n.runWebGLProgram(h,[i],i.dtype)}};class C4{constructor(t,e,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=i,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ${this.depth}; ++d) {\n          int depthBegin = int(max(0.0, float(d - ${e})));\n          int depthEnd = int(min(float(${this.depth}),\n              float(d + ${e} + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ${this.depth};\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(${r}) * norm + float(${n});\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(${r})\n                * float(${i})\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ${i});\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    `}}const N4={kernelName:Vv,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i,y:s,dy:a}=e,{depthRadius:o,bias:l,alpha:h,beta:u}=r,c=new C4(i.shape,o,l,h,u);return n.runWebGLProgram(c,[i,s,a],i.dtype)}};function A4(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reductionIndices:s,keepDims:a}=r,o=i.shape.length,l=Ig(s,i.shape);let h=l;const u=ek(h,o),c=null!=u,d=n.shouldExecuteOnCPU([i]);let p=i;if(c){if(d){const t=n.texData.get(p.dataId).values,e=new Array(o);for(let t=0;t<e.length;t++)e[t]=i.shape[u[t]];const r=ZQ(t,i.shape,i.dtype,u,e);p=n.makeTensorInfo(e,i.dtype);n.texData.get(p.dataId).values=r}else p=q0(i,u,n);h=rk(h.length,o)}tk("max",h,o);const[f,m]=JI(p.shape,h);let g,y=f;if(a&&(y=QI(f,l)),d){const t=n.texData.get(p.dataId).values,e=TQ(t,mg(m),y,i.dtype);g=n.makeTensorInfo(y,i.dtype);n.texData.get(g.dataId).values=e}else g=function(t,e,n,r){const i=mg(e),s=z0({inputs:{x:t},attrs:{shape:[mg(t.shape)/i,i]},backend:r}),a=H0(s,t.dtype,"max",r),o=z0({inputs:{x:a},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(a),o}(p,m,y,n);return c&&n.disposeIntermediateTensorInfo(p),g}const R4={kernelName:Gv,backendName:"webgl",kernelFunc:A4},M4=O0({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:EQ}),O4={kernelName:Wv,backendName:"webgl",kernelFunc:M4};const P4={kernelName:Xv,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;nJ(i,"maxPool");const{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=r;dg(QS(a,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '1'`));const h=GS(i.shape,s,a,1,o,l);if(1===h.filterWidth&&1===h.filterHeight&&vg(h.inShape,h.outShape))return _0({inputs:{x:i},backend:n});const u=new O1(h,"max",!1);return n.runWebGLProgram(u,[i],i.dtype)}};const D4={kernelName:Yv,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{filterSize:s,strides:a,pad:o,dataFormat:l,dimRoundingMode:h}=r,u=WS(i.shape,s,a,[1,1,1],o,h,l),c=new P1(u,"max",!1);return n.runWebGLProgram(c,[i],i.dtype)}};class F4{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideHeight,n=t.strideWidth,r=t.dilationHeight,i=t.effectiveFilterHeight,s=t.effectiveFilterWidth,a=i-1-t.padInfo.top,o=s-1-t.padInfo.left,l=i*s-1;this.userCode=`\n      const ivec2 pads = ivec2(${a}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${i};\n          wR += ${r}) {\n          float dyR = float(dyRCorner + wR) / ${e}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${s}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${n}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${s} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class L4{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,a=t.dilationWidth,o=t.effectiveFilterDepth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,u=o-1-t.padInfo.front,c=l-1-t.padInfo.top,d=h-1-t.padInfo.left,p=o*l*h-1;this.userCode=`\n      const ivec3 pads = ivec3(${u}, ${c}, ${d});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${o};\n           wD += ${i}) {\n          float dyD = float(dyDCorner + wD) / ${e}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${l};\n              wR += ${s}) {\n            float dyR = float(dyRCorner + wR) / ${n}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${h};\n                wC += ${a}) {\n              float dyC = float(dyCCorner + wC) / ${r}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${p} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${l} * ${h} +\n                  wR * ${h} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const B4={kernelName:jv,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s}=e,a=s,{filterSize:o,strides:l,pad:h,dimRoundingMode:u}=r,c=WS(a.shape,o,l,[1,1,1],h,u),d=new P1(c,"max",!0),p=n.runWebGLProgram(d,[a],a.dtype),f=new L4(c),m=n.runWebGLProgram(f,[i,p],a.dtype);return n.disposeIntermediateTensorInfo(p),m}};const $4={kernelName:Hv,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{dy:i,input:s,output:a}=e,o=s;nJ([s,a],"maxPoolGrad");const{filterSize:l,strides:h,pad:u,dimRoundingMode:c}=r,d=GS(o.shape,l,h,1,u,c),p=new O1(d,"max",!0),f=n.runWebGLProgram(p,[o],o.dtype),m=new F4(d),g=n.runWebGLProgram(m,[i,f],o.dtype);return n.disposeIntermediateTensorInfo(f),g}};const U4={kernelName:qv,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{filterSize:i,strides:s,pad:a,includeBatchInIndex:o}=e,l=n;dg(4===r.shape.length,(()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`));const h=[1,1];dg(QS(s,h),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${h}'`));const u=GS(r.shape,i,s,h,a),[c,d]=function(t,e,n,r){let i=new O1(n,"max",!1);const s=r.runWebGLProgram(i,[t],"float32");return i=new O1(n,"max",!0,!0,e),[s,r.runWebGLProgram(i,[t],"float32")]}(r,o,u,l);return[c,d]}};const V4={kernelName:Kv,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{keepDims:i,axis:s}=e,a=n,o=r.shape.length,l=Ig(s,r.shape);let h=l;const u=ek(h,o),c=null!=u,d=a.shouldExecuteOnCPU([r]),p=[];let f=r;if(c){if(d){const t=a.texData.get(f.dataId).values,e=new Array(o);for(let t=0;t<e.length;t++)e[t]=r.shape[u[t]];const n=ZQ(t,r.shape,r.dtype,u,e);f=a.makeTensorInfo(e,r.dtype);a.texData.get(f.dataId).values=n}else f=q0(r,u,a);p.push(f),h=rk(h.length,o)}tk("sum",h,o);const[m,g]=JI(f.shape,h);let y=m;i&&(y=QI(m,l));const v=function(t,e,n,r){const i=mg(e),s=z0({inputs:{x:t},attrs:{shape:[mg(t.shape)/i,i]},backend:r}),a=H0(s,"float32","mean",r),o=z0({inputs:{x:a},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(a),o}(f,g,y,a);for(const t of p)a.disposeIntermediateTensorInfo(t);return v}};const z4={kernelName:Zv,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:a}=r,o=i.shape.length,l=Ig(s,i.shape);let h=l;const u=ek(h,o);let c=i;null!=u&&(c=J0({inputs:{x:i},backend:n,attrs:{perm:u}}),h=rk(h.length,i.shape.length)),tk("min",h,o);const[d,p]=JI(c.shape,h),f=z0({inputs:{x:c},backend:n,attrs:{shape:[-1,mg(p)]}}),m=H0(f,f.dtype,"min",n);let g;if(a){g=z0({inputs:{x:m},backend:n,attrs:{shape:QI(d,l)}})}else g=z0({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),null!=u&&n.disposeIntermediateTensorInfo(c),g}},G4=O0({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:SQ}),W4={kernelName:Jv,backendName:"webgl",kernelFunc:G4};class X4{constructor(t,e,n){this.variableNames=["x"],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,i=wJ(r),s=e.map((t=>t[0])).join(","),a=e.map(((e,n)=>e[0]+t[n])).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l="reflect"===n?0:1;this.userCode=1!==r?`\n      ${i} start = ${i}(${s});\n      ${i} end = ${i}(${a});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        for (int i = 0; i < ${r}; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ${l};\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};\n          }\n        }\n        ${i} coords = outC - start;\n        setOutput(getX(${o}));\n      }\n    `:`\n        int start = ${s};\n        int end = ${a};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ${l};\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ${l};\n          }\n          setOutput(getX(outC - start));\n        }\n      `}}class H4{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,i=wJ(r),s=e.map((t=>t[0])).join(","),a=e.map(((e,n)=>e[0]+t[n])).join(","),o=t0("rc",r),l=t0("source",r),h=`${o[r-1]} < ${this.outputShape[r-1]}`,u=1===r?"source":`vec2(${l.slice(-2).join()})`,c="reflect"===n?0:1;let d="";if(1===r){const t=`\n        ${i} source = rc;\n        if (source < start) {\n          source = start * 2 - source - ${c};\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ${c};\n        }\n        source -= start;\n      `;d=`\n        ${i} rc = outputLoc;\n        ${t}\n        result[0] = getChannel(getX(${l.join()}), ${u});\n        ${o[r-1]} += 1;\n        if(${h}) {\n          ${t}\n          result[1] = getChannel(getX(${l.join()}), ${u});\n        }\n      `}else{const t=`\n        ${i} source = rc;\n        ${i} lt = ${i}(lessThan(source, start));\n        ${i} gte = ${i}(greaterThanEqual(source, end));\n        ${i} orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ${c}) +\n                gte * ((end - 1) * 2 - source + ${c});\n        source -= start;\n      `;d=`\n        ${i} rc = outputLoc;\n        ${t}\n        result[0] = getChannel(getX(${l.join()}), ${u});\n        ${o[r-1]} += 1;\n        if(${h}) {\n          ${t}\n          result[1] = getChannel(getX(${l.join()}), ${u});\n        }\n        rc = outputLoc;\n        ${o[r-2]} += 1;\n        if(${o[r-2]} < ${this.outputShape[r-2]}) {\n          ${t}\n          result[2] = getChannel(getX(${l.join()}), ${u});\n          ${o[r-1]} += 1;\n          if(${h}) {\n            ${t}\n            result[3] = getChannel(getX(${l.join()}), ${u});\n          }\n        }\n      `}this.userCode=`\n      const ${i} start = ${i}(${s});\n      const ${i} end = ${i}(${a});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${d}\n        setOutput(result);\n      }\n    `}}const Y4={kernelName:Qv,backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:r}=t,{paddings:i,mode:s}=n,a=ey().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new H4(r.shape,i,s):new X4(r.shape,i,s);return e.runWebGLProgram(a,[r],r.dtype)}},j4=O0({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"}),q4={kernelName:tx,backendName:"webgl",kernelFunc:j4};class K4{constructor(t,e,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,n],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ${e-1}; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(${e-1}));\n      }\n    `}}const Z4=O0({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),J4={kernelName:rv,backendName:"webgl",kernelFunc:Z4},Q4="return a - b;",t5=O0({opSnippet:Q4,packedOpSnippet:Q4,supportsComplex:!0,cpuKernelImpl:jQ}),e5={kernelName:ab,backendName:"webgl",kernelFunc:t5};function n5(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{dim:s}=r,a=Ig([s],i.shape),o=A4({inputs:{x:i},backend:n,attrs:{reductionIndices:a,keepDims:!1}}),l=QI(o.shape,a),h=z0({inputs:{x:o},backend:n,attrs:{shape:l}}),u=t5({inputs:{a:i,b:h},backend:n}),c=w3({inputs:{x:u},backend:n}),d=K0({inputs:{x:c},backend:n,attrs:{axis:a,keepDims:!1}}),p=z0({inputs:{x:d},backend:n,attrs:{shape:l}}),f=Z4({inputs:{a:c,b:p},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}const r5={kernelName:Yx,backendName:"webgl",kernelFunc:n5};const i5={kernelName:ex,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{logits:i}=e,{numSamples:s,seed:a,normalized:o}=r,l=o?i:n5({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),h=l.shape[0],u=l.shape[1],c=new K4(h,u,s),d=[[a]],p=n.runWebGLProgram(c,[l],"int32",d);return o||n.disposeIntermediateTensorInfo(l),p}};const s5={kernelName:rx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{x:r}=e;if(n.shouldExecuteOnCPU([r])){const t=n.texData.get(r.dataId),[e,i]=kQ(t.values,r.shape,r.dtype);return n.makeTensorInfo(i,r.dtype,e)}let i;return i=ey().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new u0(r.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new o0(r.shape,"if (isnan(x)) return x;\n  return -x;\n"),n.runWebGLProgram(i,[r],r.dtype)}},a5=qN;const o5={kernelName:sx,backendName:"webgl",kernelFunc:function(t){Eb();const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l}=r,h=n.readSync(i.dataId),u=n.readSync(s.dataId),{selectedIndices:c}=a5(h,u,a,o,l);return n.makeTensorInfo([c.length],"int32",new Int32Array(c))}},l5=KN;const h5={kernelName:ax,backendName:"webgl",kernelFunc:function(t){Eb();const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:h}=r,u=n.readSync(i.dataId),c=n.readSync(s.dataId),{selectedIndices:d,validOutputs:p}=l5(u,c,a,o,l,h);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},u5=ZN;const c5={kernelName:ox,backendName:"webgl",kernelFunc:function(t){Eb();const{inputs:e,backend:n,attrs:r}=t,{boxes:i,scores:s}=e,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,softNmsSigma:h}=r,u=n.readSync(i.dataId),c=n.readSync(s.dataId),d=a,p=o,f=l,m=h,{selectedIndices:g,selectedScores:y}=u5(u,c,d,p,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}};class d5{constructor(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(${r}), float(${n}),\n                      float(index == coords.y)));\n      }\n    `}}const p5={kernelName:hx,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{indices:i}=e,{dtype:s,depth:a,onValue:o,offValue:l}=r,h=mg(i.shape),u=new d5(h,a,o,l),c=z0({inputs:{x:i},backend:n,attrs:{shape:[h]}}),d=n.runWebGLProgram(u,[c],s);n.disposeIntermediateTensorInfo(c);const p=z0({inputs:{x:d},backend:n,attrs:{shape:[...i.shape,a]}});return n.disposeIntermediateTensorInfo(d),p}};function f5(t){const{inputs:e,backend:n}=t,{x:r}=e;if("complex64"===r.dtype){const t=n2({inputs:{input:r},backend:n}),e=f5({inputs:{x:t},backend:n}),i=y2({inputs:{input:r},backend:n}),s=f5({inputs:{x:i},backend:n}),a=E0({inputs:{real:e,imag:s},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),a}return M3({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}const m5={kernelName:yb,backendName:"webgl",kernelFunc:f5};const g5={kernelName:lx,backendName:"webgl",kernelFunc:function t(e){const{inputs:n,backend:r}=e,{x:i}=n;if("string"===i.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===i.dtype){const e=n2({inputs:{input:i},backend:r}),n=t({inputs:{x:e},backend:r}),s=y2({inputs:{input:i},backend:r}),a=f5({inputs:{x:s},backend:r}),o=E0({inputs:{real:n,imag:a},backend:r});return r.disposeIntermediateTensorInfo(e),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(a),o}return M3({attrs:{shape:i.shape,dtype:i.dtype,value:1},backend:r})}};const y5={kernelName:ux,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{axis:i}=r;if(1===e.length)return T3({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const s=e[0].shape,a=e[0].dtype;e.forEach((t=>{pg(s,t.shape,"All tensors passed to stack must have matching shapes"),dg(a===t.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const o=[],l=b2({inputs:e.map((t=>{const e=T3({inputs:{input:t},backend:n,attrs:{dim:i}});return o.push(e),e})),backend:n,attrs:{axis:i}});return o.forEach((t=>n.disposeIntermediateTensorInfo(t))),l}};class v5{constructor(t,e,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,i=wJ(r),s=e.map((t=>t[0])).join(","),a=e.map(((e,n)=>e[0]+t[n])).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?`\n      ${i} start = ${i}(${s});\n      ${i} end = ${i}(${a});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ${i} coords = outC - start;\n          setOutput(getX(${o}));\n        }\n      }\n    `:`\n        int start = ${s};\n        int end = ${a};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}class x5{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const r=t.length,i=wJ(r),s=e.map((t=>t[0])).join(","),a=e.map(((e,n)=>e[0]+t[n])).join(","),o=t0("rc",r),l=t0("source",r),h=`${o[r-1]} < ${this.outputShape[r-1]}`,u=1===r?"source":`vec2(${l.slice(-2).join()})`,c=[`${i} rc = outputLoc;`,`${o[r-1]} += 1;\n       if(${h}) {\n      `,1===r?"":`}\n       rc = outputLoc;\n       ${o[r-2]} += 1;\n       if(${o[r-2]} < ${this.outputShape[r-2]}) {`,1===r?"":`  ${o[r-1]} += 1;\n         if(${h}) {`],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let t=0,e=1===r?2:4;t<e;t++)p+=`\n        ${c[t]}\n        if (${d}) {\n          result[${t}] = float(value);\n        } else {\n          ${i} source = rc - start;\n          result[${t}] = getChannel(getX(${l.join()}), ${u});\n        }\n      `;p+=1===r?"} ":"}}",this.userCode=`\n      const ${i} start = ${i}(${s});\n      const ${i} end = ${i}(${a});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${p}\n        setOutput(result);\n      }\n    `}}const b5=t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{paddings:s,constantValue:a}=r;if(0===mg(i.shape)){const t=s.map(((t,e)=>t[0]+i.shape[e]+t[1]));return M3({backend:n,attrs:{shape:t,value:a,dtype:i.dtype}})}const o=ey().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new x5(i.shape,s,a):new v5(i.shape,s,a),l=[[a]];return n.runWebGLProgram(o,[i],i.dtype,l)},w5={kernelName:cx,backendName:"webgl",kernelFunc:b5},_5=O0({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"}),T5={kernelName:px,backendName:"webgl",kernelFunc:_5};const E5={kernelName:mx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{axis:s,keepDims:a}=r,o=i.shape.length,l=[],h=Ig(s,i.shape);let u=h;const c=ek(u,o);let d,p=i;if(null!=c&&(p=J0({inputs:{x:i},backend:n,attrs:{perm:c}}),u=rk(u.length,o),l.push(p)),tk("prod",u,o),n.shouldExecuteOnCPU([p])){const t=n.texData.get(p.dataId).values,{outVals:e,outShape:r,outDtype:i}=NQ(p.shape,p.dtype,t,u);d=n.makeTensorInfo(r,i,e)}else{const[t,e]=JI(p.shape,u),r=mg(e),s=z0({inputs:{x:p},backend:n,attrs:{shape:[-1,r]}}),a=H0(s,Cw(i.dtype),"prod",n);d=z0({inputs:{x:a},backend:n,attrs:{shape:t}}),l.push(s),l.push(a)}if(a){l.push(d);const t=QI(d.shape,h);d=z0({inputs:{x:d},backend:n,attrs:{shape:t}})}return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),d}};const S5={kernelName:gx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{paramsNestedSplits:i,paramsDenseValues:s,indices:a}=e,{outputRaggedRank:o}=r,l=i.map((t=>n.readSync(t.dataId))),h=i.map((t=>t.shape)),u=n.readSync(s.dataId),c=n.readSync(a.dataId),[d,p,f]=AQ(l,h,u,s.shape,s.dtype,c,a.shape,o),m=d.map((t=>n.makeTensorInfo([t.length],"int32",t))),g=n.makeTensorInfo(f,s.dtype,p);return m.concat([g])}};const I5={kernelName:yx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{starts:r,limits:i,deltas:s}=e,a=n.readSync(r.dataId),o=n.readSync(i.dataId),l=n.readSync(s.dataId),[h,u]=RQ(a,r.shape,r.dtype,o,i.shape,l,s.shape);return[n.makeTensorInfo([h.length],"int32",h),n.makeTensorInfo([u.length],r.dtype,u)]}};const k5={kernelName:vx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{shape:i,values:s,defaultValue:a,rowPartitionTensors:o}=e,{rowPartitionTypes:l}=r,h=n.readSync(i.dataId),u=n.readSync(s.dataId),c=n.readSync(a.dataId),d=o.map((t=>n.readSync(t.dataId))),p=o.map((t=>t.shape)),[f,m]=MQ(h,i.shape,u,s.shape,s.dtype,c,a.shape,d,p,l);return n.makeTensorInfo(f,s.dtype,m)}},C5=t=>{const{backend:e,attrs:n}=t,{start:r,stop:i,step:s,dtype:a}=n,o=OQ(r,i,s,a);return e.makeTensorInfo([o.length],a,o)},N5={kernelName:xx,backendName:"webgl",kernelFunc:C5},A5=M0({opSnippet:"return 1.0 / x;"}),R5={kernelName:wx,backendName:"webgl",kernelFunc:A5},M5=M0({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),O5={kernelName:_x,backendName:"webgl",kernelFunc:M5},P5=M0({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),D5={kernelName:Cx,backendName:"webgl",kernelFunc:P5};class F5{constructor(t,e,n,r,i){this.variableNames=["A"],this.outputShape=[];const[s,a,o,l]=t;this.outputShape=[s,e,n,l];const h=[r&&e>1?a-1:a,r&&n>1?o-1:o],u=[r&&e>1?e-1:e,r&&n>1?n-1:n];let c;c=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${h[0]/u[0]},\n          ${h[1]/u[1]});\n      const vec2 inputShapeRC = vec2(${a}.0, ${o}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${c};\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}class L5{constructor(t,e,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,a,o,l]=t;this.outputShape=[s,e,n,l];const h=[r&&e>1?a-1:a,r&&n>1?o-1:o],u=[r&&e>1?e-1:e,r&&n>1?n-1:n];let c;c=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${h[0]/u[0]},\n          ${h[1]/u[1]},\n          ${h[1]/u[1]});\n      const vec3 inputShapeRC = vec3(${a}.0, ${o}.0,\n                                     ${o}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${c};\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${l-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}const B5={kernelName:Ix,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:a,size:o}=r,[l,h]=o,u=ey().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new L5(i.shape,l,h,s,a):new F5(i.shape,l,h,s,a);return n.runWebGLProgram(u,[i],"float32")}};class $5{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,i]=e,[,s,a]=t,o=[n&&s>1?r-1:r,n&&a>1?i-1:i],l=[n&&s>1?s-1:s,n&&a>1?a-1:a],h=o[0]/l[0],u=o[1]/l[1],c=1/h,d=1/u,p=2*Math.ceil(c)+2,f=2*Math.ceil(d)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${h});\n        const float widthScale = float(${u});\n\n        const float invHeightScale = float(${c});\n        const float invWidthScale = float(${d});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${f});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${s}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${a}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}const U5={kernelName:kx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:a}=r,o=new $5(s.shape,i.shape,a);return n.runWebGLProgram(o,[s],s.dtype)}};class V5{constructor(t,e,n,r,i){this.variableNames=["A"],this.outputShape=[];const[s,a,o,l]=t;this.outputShape=[s,e,n,l];const h=[r&&e>1?a-1:a,r&&n>1?o-1:o],u=[r&&e>1?e-1:e,r&&n>1?n-1:n],c=r?"0.5":"0.0";let d;d=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${h[0]/u[0]},\n          ${h[1]/u[1]});\n      const vec2 inputShapeRC = vec2(${a}.0, ${o}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${d};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${c})));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    `}}class z5{constructor(t,e,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[s,a,o,l]=t;this.outputShape=[s,e,n,l];const h=[r&&e>1?a-1:a,r&&n>1?o-1:o],u=[r&&e>1?e-1:e,r&&n>1?n-1:n],c=r?"0.5":"0.0";let d;d=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${h[0]/u[0]},\n          ${h[1]/u[1]},\n          ${h[1]/u[1]});\n      const vec3 inputShapeRC = vec3(${a}.0, ${o}.0,\n                                     ${o}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${d};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${c})));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${l-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    `}}const G5={kernelName:Ex,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i}=e,{alignCorners:s,halfPixelCenters:a,size:o}=r,[l,h]=o,u=ey().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new z5(i.shape,l,h,s,a):new V5(i.shape,l,h,s,a);return n.runWebGLProgram(u,[i],i.dtype)}};class W5{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,r,i]=e,[,s,a]=t,o=[n&&s>1?r-1:r,n&&a>1?i-1:i],l=[n&&s>1?s-1:s,n&&a>1?a-1:a],h=o[0]/l[0],u=o[1]/l[1],c=1/h,d=1/u,p=2*Math.ceil(c)+2,f=2*Math.ceil(d)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${h});\n        const float widthScale = float(${u});\n\n        const float invHeightScale = float(${c});\n        const float invWidthScale = float(${d});\n\n        const int winHeight = int(${p});\n        const int winWidth = int(${f});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${s}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${a}) {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(${o[0]}) *\n                (float(dyR) / float(${l[0]}));\n\n            float sourceFracCol =\n                float(${o[1]}) *\n                  (float(dyC) / float(${l[1]}));\n\n            int sourceNearestRow = int(min(\n                float(int(${r}) - 1),\n                ${n} ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(${i}) - 1),\n                ${n} ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}const X5={kernelName:Sx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{images:i,dy:s}=e,{alignCorners:a}=r,o=new W5(s.shape,i.shape,a);return n.runWebGLProgram(o,[s],s.dtype)}};class H5{constructor(t,e){this.variableNames=["x"];const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=t,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${t[0]} - coord - 1));\n        }\n      `);const r=t.map(((n,r)=>(n=>-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - coords[${n}] - 1`:`coords[${n}]`)(r))).join(","),i=wJ(n);this.userCode=`\n      void main() {\n        ${i} coords = getOutputCoords();\n        setOutput(getX(${r}));\n      }\n    `}}class Y5{constructor(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=t;const r=t0("rc",n),i=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,s=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,a=wJ(n);function o(n){const r=t.map(((r,i)=>function(n,r){return-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - ${r[n]} - 1`:`${r[n]}`}(i,n)));return`getChannel(getX(${r.join(",")}), vec2(${r.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${t[0]} - rc - 1),\n            ${t[0]} - rc - 1);\n          if(${i}){\n              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),\n                ${t[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${a} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${function(t){return o(t)}(r.slice())};\n          if(${i}){\n            result.g = ${function(t){return t[n-1]="("+t[n-1]+" + 1)",o(t)}(r.slice())};\n          }\n          if(${s}) {\n            result.b = ${function(t){return t[n-2]="("+t[n-2]+" + 1)",o(t)}(r.slice())};\n            if(${i}) {\n              result.a = ${function(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",o(t)}(r.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}const j5={kernelName:Nx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{dims:s}=r,a=i.shape.length,o=Ig(s,i.shape);if(0===a)return _0({inputs:{x:i},backend:n});const l=ey().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Y5(i.shape,o):new H5(i.shape,o);return n.runWebGLProgram(l,[i],i.dtype)}};class q5{constructor(t,e){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=t[1],r=t[2];this.outputShape=t;let i="";i="number"==typeof e?`float outputValue = ${e.toFixed(2)};`:`\n        vec3 fill = vec3(${e.join(",")});\n        float outputValue = fill[coords[3]];`,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ${i}\n          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${n}) {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}const K5={kernelName:bb,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,{radians:i,fillValue:s,center:a}=e,o=n,l=new q5(r.shape,s),[h,u]=JA(a,r.shape[1],r.shape[2]),c=[[h,u,Math.sin(i),Math.cos(i)]];return o.runWebGLProgram(l,[r],r.dtype,c)}},Z5=M0({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),J5={kernelName:Ax,backendName:"webgl",kernelFunc:Z5},Q5=M0({opSnippet:"return inversesqrt(x);",cpuKernelImpl:PQ}),t6={kernelName:Rx,backendName:"webgl",kernelFunc:Q5};class e6{constructor(t,e,n,r,i,s,a=!0,o=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;const l=wJ(i.length),h=wJ(s.length);let u="";1===n?u="i":2===n&&(u="i, j");const c=`getIndices(${u})`;let d="";1===r?d="i":2===r&&(d="i, coords[1]");const p=`getUpdates(${d})`;let f="";o&&(f="coords[0], coords[1]");const m=`getDefaultValue(${f})`,g=e>1?"strides[j]":"strides";this.userCode=`\n        ${l} strides = ${l}(${i});\n\n        void main() {\n          ${h} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${t}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${e}; j++) {\n              int index = round(${c});\n              flattenedIndex += index * ${g};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ${p};\n              found = true;\n            }\n          }\n          setOutput(mix(${m}, sum, float(found)));\n        }\n      `}}class n6{constructor(t,e,n,r,i,s,a=!0,o=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s;const l=wJ(i.length),h=wJ(s.length);let u="";1===n?u="i":2===n&&(u="i, j");const c=`getIndices(${u})`;let d="";1===r?d="i":2===r&&(d="i, coords[1]");const p=`getUpdates(${d})`;let f="";o&&(f="coords[0], coords[1]");const m=`getDefaultValue(${f})`,g=e>1?"strides[j]":"strides",y=e>1?"strides[j + 1]":"strides";this.userCode=`\n        ${l} strides = ${l}(${i});\n\n        void main() {\n          ${h} coords = getOutputCoords();\n          vec4 sum = vec4(0.);\n          vec4 found = vec4(0.);\n          for (int i = 0; i < ${t}; i+=2) {\n            ivec2 flattenedIndex = ivec2(0);\n            for (int j = 0; j < ${e}; j+=2) {\n              ivec4 index = round(${c});\n              flattenedIndex += index.xz * ${g};\n              if (j + 1 < ${e}) {\n                flattenedIndex += index.yw * ${y};\n              }\n            }\n            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||\n                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {\n              vec4 updVals = ${p};\n              if (flattenedIndex[0] == coords[0]) {\n                sum.xy += updVals.xy;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[0] == coords[0] + 1) {\n                sum.zw += updVals.xy;\n                found.zw = vec2(1.);\n              }\n              if (flattenedIndex[1] == coords[0]) {\n                sum.xy += updVals.zw;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[1] == coords[0] + 1) {\n                sum.zw += updVals.zw;\n                found.zw = vec2(1.);\n              }\n            }\n          }\n          setOutput(mix(${m}, sum, found));\n        }\n      `}}const r6={kernelName:Mx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{indices:i,updates:s}=e,{shape:a}=r,{sliceRank:o,numUpdates:l,sliceSize:h,strides:u,outputSize:c}=ZE(0,i,a),d=[c/h,h];if(0===c)return n.makeTensorInfo(a,i.dtype);const p=z0({inputs:{x:i},backend:n,attrs:{shape:[l,o]}}),f=z0({inputs:{x:s},backend:n,attrs:{shape:[l,h]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0]));let g;g=ey().getBool("WEBGL_PACK")?new n6(l,o,p.shape.length,f.shape.length,u,d):new e6(l,o,p.shape.length,f.shape.length,u,d);const y=n.runWebGLProgram(g,[f,p,m],f.dtype),v=z0({inputs:{x:y},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(m),v}};class i6{constructor(t,e,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,n];const i=`for (int i = 0; i < ${Math.ceil(Math.log2(e+1))}; ++i) { if (left >= right) break;`,s=2===ey().getNumber("WEBGL_VERSION")?"while (left < right) {":i,a="left"===r?"<":"<=";this.userCode=`\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ${s}\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ${a} value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     `}}const s6={kernelName:Px,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sortedSequence:i,values:s}=e,{side:a}=r,o=new i6(i.shape[0],i.shape[1],s.shape[1],a),l=[[i.shape[1]]];return n.runWebGLProgram(o,[i,s],"int32",l)}};class a6{constructor(t,e,n){let r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)i="resRC",r="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],a=[];for(let r=0;r<e.length;r++)a.push(`${n[r]}`),r<t&&s.push(`${n[r]}`);r=s.join(),i=a.join()}const s=wJ(n);this.userCode=`\n      void main() {\n        ${s} resRC = getOutputCoords();\n        float cVal = getC(${r});\n        if (cVal >= 1.0) {\n          setOutput(getA(${i}));\n        } else {\n          setOutput(getB(${i}));\n        }\n      }\n    `}}const o6={kernelName:Dx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{condition:r,t:i,e:s}=e,a=new a6(r.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(a,[r,i,s],kw(i.dtype,s.dtype))}},l6=M0({opSnippet:`\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ${iR};\n  float scale = ${sR};\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n`}),h6={kernelName:Fx,backendName:"webgl",kernelFunc:l6},u6=M0({opSnippet:"if (isnan(x)) return x;\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:FQ}),c6={kernelName:Vx,backendName:"webgl",kernelFunc:u6},d6=M0({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),p6={kernelName:Ux,backendName:"webgl",kernelFunc:d6},f6=M0({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n",packedOpSnippet:`\n  vec4 result = sin(x);\n  bvec4 isNaN = isnan(x);\n  ${b0}\n  return result;\n`}),m6={kernelName:Bx,backendName:"webgl",kernelFunc:f6},g6=M0({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),y6={kernelName:$x,backendName:"webgl",kernelFunc:g6},v6=M0({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),x6={kernelName:zx,backendName:"webgl",kernelFunc:v6},b6={kernelName:Xx,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{blockShape:s,paddings:a}=r;dg(i.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));const o=s.reduce(((t,e)=>t*e)),l=[[0,0]];l.push(...a);for(let t=1+s.length;t<i.shape.length;++t)l.push([0,0]);const h=[],u=b5({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),c=QA(u.shape,s,o,!1),d=tR(c.length,s.length,!1),p=eR(u.shape,s,o,!1),f=z0({inputs:{x:u},backend:n,attrs:{shape:c}}),m=J0({inputs:{x:f},backend:n,attrs:{perm:d}}),g=z0({inputs:{x:m},backend:n,attrs:{shape:p}});return h.push(u),h.push(f),h.push(m),h.forEach((t=>n.disposeIntermediateTensorInfo(t))),g}};const w6={kernelName:jx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{indices:r,values:i,denseShape:s,defaultValue:a}=e;if(1!==s.shape.length)throw new Error(`Dense shape must be a vector, saw:\n         ${s.shape}`);if(2!==r.shape.length)throw new Error(`Indices must be a matrix, saw:\n         ${r.shape}`);if(1!==i.shape.length)throw new Error(`Values must be a vector, saw:\n         ${i.shape}`);if(0!==a.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${a.shape}`);const o=n.readSync(r.dataId),l=n.readSync(i.dataId),h=n.readSync(s.dataId),u=n.readSync(a.dataId)[0],[c,d,p,f,m]=$Q(o,r.shape,r.dtype,l,i.dtype,h,u);return[n.makeTensorInfo(d,r.dtype,c),n.makeTensorInfo([d[0]],i.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map((t=>Number(t))))),n.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}};const _6={kernelName:qx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{inputIndices:r,inputShape:i,newShape:s}=e;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(1!==i.shape.length)throw new Error(`Input shape should be a vector but received shape ${i.shape}`);if(1!==s.shape.length)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const a=Array.from(n.readSync(i.dataId)),o=n.readSync(r.dataId),l=Array.from(n.readSync(s.dataId)),[h,u,c]=UQ(o,r.shape,r.dtype,a,l);return[n.makeTensorInfo(u,r.dtype,h),n.makeTensorInfo([c.length],s.dtype,new Int32Array(c))]}};const T6={kernelName:Kx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n              ${i.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n              ${s.shape}`);const a=n.readSync(r.dataId),o=n.readSync(i.dataId),l=n.readSync(s.dataId),[h,u]=VQ(a,r.shape,r.dtype,o,l,!0);return n.makeTensorInfo(u,r.dtype,h)}};const E6={kernelName:Zx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n}=t,{data:r,indices:i,segmentIds:s}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n             ${i.shape}`);if(1!==s.shape.length)throw new Error(`Segment ids should be a vector but received shape\n             ${s.shape}`);const a=n.readSync(r.dataId),o=n.readSync(i.dataId),l=n.readSync(s.dataId),[h,u]=VQ(a,r.shape,r.dtype,o,l);return n.makeTensorInfo(u,r.dtype,h)}};const S6={kernelName:Jx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{sparseIndices:i,sparseValues:s,defaultValue:a}=e,{outputShape:o}=r,{sliceRank:l,numUpdates:h,sliceSize:u,strides:c,outputSize:d}=ZE(0,i,o);if("string"===s.dtype){const t=n.bufferSync(i),e=n.bufferSync(s),r=rw(n.readSync(a.dataId)[0]),p=DQ(t,e,o,d,u,h,l,c,r,false);return n.makeTensorInfo(o,p.dtype,p.values)}const p=new e6(h,l,i.shape.length,s.shape.length,c,[d,1],false),f=n.runWebGLProgram(p,[s,i,a],s.dtype),m=z0({inputs:{x:f},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(f),m}};const I6={kernelName:Hx,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{numOrSizeSplits:s,axis:a}=r,o=Ig(a,i.shape)[0],l=CR(i,s,o),h=i.shape.length,u=new Array(h).fill(0),c=i.shape.slice();return l.map((t=>{const e=[...c];e[o]=t;const r=j1({inputs:{x:i},backend:n,attrs:{begin:u,size:e}});return u[o]+=t,r}))}},k6="return sqrt(x);",C6=M0({opSnippet:k6,packedOpSnippet:k6,cpuKernelImpl:zQ}),N6={kernelName:Gx,backendName:"webgl",kernelFunc:C6},A6=M0({opSnippet:"return x * x;"}),R6={kernelName:tb,backendName:"webgl",kernelFunc:A6},M6="return (a - b) * (a - b);",O6=O0({opSnippet:M6,packedOpSnippet:M6}),P6={kernelName:Qx,backendName:"webgl",kernelFunc:O6};const D6={kernelName:eb,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e;if("string"!==i.dtype)throw new Error("Input must be of datatype string");const s=WR(n.readSync(i.dataId)),a=GQ(s,"string",r);return n.makeTensorInfo(i.shape,"string",a)}};const F6={kernelName:vb,backendName:"webgl",kernelFunc:function({inputs:t,attrs:e,backend:n}){const{x:r}=t,i=`if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(${e.alpha});\n  `,s=new o0(r.shape,i);return n.runWebGLProgram(s,[r],r.dtype)}};class L6{constructor(t,e,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,i=wJ(n.length),s=wJ(n.length);let a="";if(1===r)a="coords * strides + begin";else{let t=0;a=n.map(((e,r)=>(t++,1===n.length?`coords * strides[${r}] + begin[${r}]`:`coords[${t-1}] * strides[${r}] + begin[${r}]`))).join(",")}this.userCode=`\n      ${i} begin = ${i}(${t});\n      ${i} strides = ${i}(${e});\n\n      void main() {\n        ${s} coords = getOutputCoords();\n        setOutput(getX(${a}));\n      }\n    `}}const B6={kernelName:nb,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{begin:s,end:a,strides:o,beginMask:l,endMask:h,ellipsisMask:u,newAxisMask:c,shrinkAxisMask:d}=r,{finalShapeSparse:p,finalShape:f,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:v,end:x,strides:b}=pS(i.shape,s,a,o,l,h,u,c,d);let w;if(m)w=z0({inputs:{x:i},backend:n,attrs:{shape:f}});else if(g||y){dg(i.shape.length>=1,(()=>`Input must have rank at least 1, got: ${i.shape.length}`));const t=tS(v,x,b),e=j1({inputs:{x:i},backend:n,attrs:{begin:v,size:t}});w=z0({inputs:{x:e},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(e)}else{if(n.shouldExecuteOnCPU([i])){const t=n.readSync(i.dataId),e=nT(i.shape,i.dtype,t),r=WQ(p,e,b,v);w=n.makeTensorInfo(f,i.dtype,r.values)}else{const t=new L6(v,b,p);w=n.runWebGLProgram(t,[i],i.dtype)}}const _=z0({inputs:{x:w},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(w),_}};const $6={kernelName:rb,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{separator:i,nGramWidths:s,leftPad:a,rightPad:o,padWidth:l,preserveShortSequences:h}=r,{data:u,dataSplits:c}=e,d=n.readSync(u.dataId),p=n.readSync(c.dataId),[f,m]=XQ(d,p,i,s,a,o,l,h);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(c.shape,"int32",m)]}};const U6={kernelName:ib,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{skipEmpty:i}=r,{input:s,delimiter:a}=e;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(1!==s.shape.length)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(0!==a.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${a.shape}`);const o=n.readSync(s.dataId),l=n.readSync(a.dataId)[0],[h,u,c]=HQ(o,l,i),d=u.length;return[n.makeTensorInfo([d,2],"int32",h),n.makeTensorInfo([d],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(c))]}};const V6={kernelName:sb,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{numBuckets:i}=r,{input:s}=e;if("string"!==s.dtype)throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const a=n.readSync(s.dataId),o=YQ(a,i);return n.makeTensorInfo(s.shape,"int32",o)}},z6=M0({opSnippet:"return tan(x);"}),G6={kernelName:ob,backendName:"webgl",kernelFunc:z6},W6=M0({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),X6={kernelName:lb,backendName:"webgl",kernelFunc:W6};const H6={kernelName:Ox,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{tensor:i,indices:s,updates:a}=e,{}=r,{sliceRank:o,numUpdates:l,sliceSize:h,strides:u,outputSize:c}=ZE(0,s,i.shape),d=[c/h,h];if(0===c)return n.makeTensorInfo(i.shape,s.dtype);const p=z0({inputs:{x:s},backend:n,attrs:{shape:[l,o]}}),f=z0({inputs:{x:a},backend:n,attrs:{shape:[l,h]}}),m=z0({inputs:{x:i},backend:n,attrs:{shape:d}}),g=new e6(l,o,p.shape.length,f.shape.length,u,d,!1,!0),y=n.runWebGLProgram(g,[f,p,m],m.dtype),v=z0({inputs:{x:y},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),v}};class Y6{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;const r=wJ(this.rank),i=function(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(1===e)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let e=0;e<t.length;e++)r.push(`imod(${n[e]}, ${t[e]})`);return r.join()}(t);this.userCode=`\n      void main() {\n        ${r} resRC = getOutputCoords();\n        setOutput(getA(${i}));\n      }\n    `}}function j6(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{reps:s}=r;if("string"===i.dtype||i.shape.length>5){const t=n.readSync(i.dataId),e="string"===i.dtype?t.map((t=>rw(t))):t,r=nT(i.shape,i.dtype,e),a=qQ(r,s);return n.makeTensorInfo(a.shape,a.dtype,a.values)}const a=new Y6(i.shape,s);return n.runWebGLProgram(a,[i],i.dtype)}const q6={kernelName:hb,backendName:"webgl",kernelFunc:j6};class K6{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}class Z6{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}}function J6(t,e){null!==e&&t.disposeIntermediateTensorInfo(e)}function Q6(t){let e=1;for(;e<t;)e*=2;return e}const t8={kernelName:ub,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i}=e,{k:s,sorted:a}=r,o=ey().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=ey().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),h=i.shape,u=h[h.length-1];if(n.shouldExecuteOnCPU([i])||u<o||s>l){const t=n.readSync(i.dataId),[e,r]=KQ(t,h,i.dtype,s,a);return[n.makeTensorInfo(e.shape,e.dtype,e.values),n.makeTensorInfo(r.shape,r.dtype,r.values)]}if(0===s)return h[h.length-1]=0,[n.makeTensorInfo(h,i.dtype,[]),n.makeTensorInfo(h,"int32",[])];if(1===u)return[i,M3({attrs:{shape:h,dtype:"int32",value:0},backend:n})];const c=n.texData.get(i.dataId),d=null!==c&&c.isPacked,p=d?n.unpackTensor(i):i,f=mg(h)/u,m=z0({inputs:{x:p},attrs:{shape:[f,u]},backend:n});d&&J6(n,p);const g=Q6(s),y=Q6(u);let v=null;const x=()=>null===v?[m,m]:[m,v],b=(t,e,r)=>{const i=x(),s=new K6(r),a=[[u],[null===v?1:0],[Number.NEGATIVE_INFINITY],[t],[e]],o=v;v=n.runWebGLProgram(s,i,"int32",a),J6(n,o)};for(let t=1;t<g;t*=2){const e=2*t;for(let n=t;n>=1;n/=2)b(e,n,[f,y])}for(let t=y;t>g;t/=2){const e=x(),r=new Z6([f,t/2]),i=[[u],[null===v?1:0],[g]],s=v;v=n.runWebGLProgram(r,e,"int32",i),J6(n,s);const a=g/2,o=2*a;for(let t=a;t>=1;t/=2)b(o,t,v.shape)}let w=v;v=j1({inputs:{x:v},backend:n,attrs:{begin:0,size:[f,s]}}),J6(n,w);let _=Z3({inputs:{x:m,indices:v},backend:n,attrs:{axis:1,batchDims:1}});J6(n,m);const T=h.slice(0,-1);T.push(s),w=v,v=z0({inputs:{x:v},attrs:{shape:T},backend:n}),J6(n,w);const E=_;return _=z0({inputs:{x:_},attrs:{shape:T},backend:n}),J6(n,E),[_,v]}};class e8{constructor(t,e,n,r,i,s){this.variableNames=["Image","Transforms"],this.outputShape=s;const a="nearest"===n?1:2;let o;switch(r){default:o=1;break;case"reflect":o=2;break;case"wrap":o=3;break;case"nearest":o=4}this.userCode=`\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(${o} == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${o} == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${o} == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${e}) {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(${i});\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(${i});\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(${e}));\n                float mapY = mapCoord(inY, float(${t}));\n\n                if (${a} == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        `}}const n8={kernelName:cb,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{image:i,transforms:s}=e,{interpolation:a,fillMode:o,fillValue:l,outputShape:h}=r,[u,c,d,p]=i.shape,[f,m]=null!=h?h:[c,d],g=new e8(c,d,a,o,l,[u,f,m,p]);return n.runWebGLProgram(g,[i,s],"float32")}};const r8={kernelName:pb,backendName:"webgl",kernelFunc:function(t){const{inputs:e,attrs:n,backend:r}=t,{axis:i}=n,{x:s}=e;nJ(s,"unique");const a=r.readSync(s.dataId),{outputValues:o,outputShape:l,indices:h}=JQ(a,i,s.shape,s.dtype);return[r.makeTensorInfo(l,s.dtype,o),r.makeTensorInfo([h.length],"int32",h)]}};const i8={kernelName:fb,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{value:i}=e;let{axis:s}=r;s<0&&(s+=i.shape.length);const a=i,o=a.shape.length,l=i.shape[s],h=new Array(o-1);let u=0;for(let t=0;t<o;t++)t!==s&&(h[u++]=a.shape[t]);const c=[],d=new Array(o).fill(0),p=a.shape.slice();p[s]=1;const f=new Array(l);for(let t=0;t<f.length;t++){d[s]=t;const e=j1({inputs:{x:a},backend:n,attrs:{begin:d,size:p}}),r=z0({inputs:{x:e},backend:n,attrs:{shape:h}});f[t]=r,c.push(e)}return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),f}};class s8{constructor(t,e){this.variableNames=["x","segmentIds"];const n=t.windowSize,r=t.batchSize,i=t.inSize,s=t.numSegments,a=s*Math.ceil(i/n);this.outputShape=[r,a];const o=4*Math.floor(n/4),l=n%4,h="\n        sumValue += dot(values, segFilter);\n    ";let u="";i%n>0&&(u=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `);let c="";i%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return -1.0;\n        }\n      `),this.userCode=`\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ${u}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${c}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${s})) * float(${n}));\n        int currentSeg = int(mod(float(outIdx), float(${s})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${o}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${h}\n        }\n\n        int inIdx = inOffset + ${o};\n        if (${1===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${h}\n        } else if (${2===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${h}\n        } else if (${3===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${h}\n        }\n        setOutput(sumValue);\n      }\n    `}}const a8={kernelName:mb,backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t,{x:i,segmentIds:s}=e,{numSegments:a}=r,o=i.shape.length,l=[];let h=0;const u=ek([h],o);let c=i;null!=u&&(c=J0({inputs:{x:i},backend:n,attrs:{perm:u}}),l.push(c),h=rk(1,o)[0]);const d=zR(c.shape,h,a),p=mg([c.shape[h]]),f=z0({inputs:{x:c},backend:n,attrs:{shape:[-1,p]}});l.push(f);const m=Cw(i.dtype),g=(t,e,r,i,s)=>{const a=t.shape[0],o=t.shape[1],h=VR(o,s),u=new s8({windowSize:h,inSize:o,batchSize:a,numSegments:s},e),c=n.compileAndRun(u,[t,r],i);if(l.push(c),c.shape[1]===s)return c;const d=C5({backend:n,attrs:{start:0,stop:s,step:1,dtype:"float32"}}),p=j6({inputs:{x:d},backend:n,attrs:{reps:[o/h]}});l.push(d),l.push(p);return g(c,e,p,i,s)},y=z0({inputs:{x:g(f,"unsortedSegmentSum",s,m,a)},backend:n,attrs:{shape:d}});let v=y;if(null!=u){l.push(y);const t=nk(u);v=J0({inputs:{x:v},backend:n,attrs:{perm:t}})}return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),v}},o8=[e1,r1,s1,o1,u1,p1,f1,m1,w1,_1,E1,I1,C1,A1,M1,D1,F1,$1,U1,V1,W1,K1,Z1,J1,Q1,i2,o2,u2,S0,p2,w2,N2,P2,F2,L2,B2,$2,V2,G2,X2,Z2,J2,Q2,e3,i3,o3,l3,u3,d3,p3,m3,g3,v3,b3,_3,E3,k3,A3,O3,D3,B3,U3,G3,H3,Y3,q3,J3,t4,n4,T0,r4,v2,s4,o4,h4,C0,c4,p4,f4,g4,v4,b4,_4,E4,k4,N4,R4,O4,P4,D4,B4,$4,U4,V4,z4,W4,Y4,q4,i5,V0,s5,o5,h5,c5,e2,p5,g5,y5,w5,T5,R0,E5,S5,I5,k5,N5,r2,J4,R5,O5,D5,G0,B5,U5,G5,X5,j5,K5,J5,t6,r6,s6,o6,h6,c6,p6,m6,y6,q1,r5,x6,b6,w6,_6,T6,E6,S6,I6,N6,R6,P6,D6,F6,B6,$6,U6,V6,e5,Z0,G6,X6,H6,q6,t8,n8,Q0,r8,i8,a8,m5];for(const t of o8)Rb(t);const l8={"tfjs-core":CS,"tfjs-backend-cpu":WH,"tfjs-backend-webgl":g0,"tfjs-data":fW,"tfjs-layers":tL,"tfjs-converter":iG,tfjs:"4.8.0"};class h8{constructor(){}static get width(){return h8._width}static get height(){return h8._height}static get ratio(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)/Math.max(document.documentElement.clientHeight,window.innerHeight||0)>.665?1:2}static initialize(t=750,e=1334,n=0){h8._width=t,h8._height=e;const r={view:document.getElementById("pixi-canvas"),autoDensity:!0,backgroundColor:n,width:t,height:e,antialias:!0};h8.app=new qs(r),globalThis.__PIXI_APP__=h8.app,globalThis.tf=q,h8.app.ticker.add(h8.update),h8.app.stage.sortableChildren=!0,window.addEventListener("resize",h8.resizeRelative),h8.resizeRelative(),h8.particles=new tg,h8.particles.zIndex=500,h8.app.stage.addChild(h8.particles),h8.app.renderer.plugins.interaction.on("pointerdown",(t=>h8.ClickEffect(t)))}static backgroundColor(t=0){h8.app.renderer.backgroundColor=t}static update(t){h8.currentScene&&h8.currentScene.update(t),h8.particles&&h8.particles.update()}static changeScene(t){h8.currentScene&&(h8.app.stage.removeChild(h8.currentScene),h8.currentScene.destroy(),em.killTweensOf("*")),h8.currentScene=t,h8.app.stage.addChild(t)}static resizeFixed(){let t=0,e=document.documentElement.clientWidth,n=document.documentElement.clientHeight;if(e/n>.665)t=n/(h8.height/2),h8.app.view.style.marginLeft=(e-h8.width/2*t)/2+"px";else{t=e/(h8.width/2),h8.app.view.style.marginLeft="0px";let r=(n-h8.height/2*t)/2;h8.app.view.style.marginTop=(r>0?r:0)+"px"}h8.app.view.style.width=h8.width/2*t+"px",h8.app.view.style.height=h8.height/2*t+"px"}static resizeRelative(){const t=Math.max(document.documentElement.clientWidth,window.innerWidth||0),e=Math.max(document.documentElement.clientHeight,window.innerHeight||0),n=Math.min(t/h8.width,e/h8.height),r=Math.floor(n*h8.width),i=Math.floor(n*h8.height),s=(t-r)/2,a=(e-i)/2;h8.app.view.style.width=`${r}px`,h8.app.view.style.height=`${i}px`,h8.app.view.style.marginLeft=h8.app.view.style.marginRight=`${s}px`,h8.app.view.style.marginTop=h8.app.view.style.marginBottom=`${a}px`}static ClickEffect(t){let e=.3;var n=Qo.from("c1"),r=Qo.from("c2"),i=Qo.from("c3");h8.app.stage.addChild(n,r,i),n.tint=16777215,r.tint=16724889,i.tint=16777215,[n,r,i].forEach((e=>{e.zIndex=500,e.scale.set(.1),e.anchor.set(.5),e.x=t.data.global.x,e.y=t.data.global.y})),em.to(n.scale,{duration:.3,x:e,y:e}),em.to(r.scale,{duration:.3,x:e,y:e}),em.to(i.scale,{delay:.1,duration:.3,x:e,y:e}),em.to(n,{delay:.2,duration:.3,tint:16724889,alpha:0}).eventCallback("onComplete",(()=>n.destroy())),em.to(r,{delay:.1,duration:.3,alpha:0}).eventCallback("onComplete",(()=>r.destroy())),em.to(i,{delay:.3,duration:.3,alpha:0}).eventCallback("onComplete",(()=>i.destroy()))}}h8.notify=[],h8.scenes=[];class u8 extends or{update(t){}}let c8=[];c8.push([{name:"role06",url:"./images/pp.png"},{name:"leg",url:"./girl/leg.jpeg"},{name:"q",url:"./images/q.png"},{name:"trail",url:"./images/trail.png"},{name:"gh",url:"./images/gh.png"},{name:"huo",url:"./game/huo.json"},{name:"fg",url:"./game/fg.json"},{name:"fg_2",url:"./game/fg_2.json"},{name:"fg_3",url:"./game/fg_3.json"},{name:"c1",url:"./game/c1.png"},{name:"c2",url:"./game/c2.png"},{name:"c3",url:"./game/c3.png"},{name:"click",url:"./sound/click.mp3"},{name:"r1",url:"./game/roles/r1.json"},{name:"r1n",url:"./game/roles/r1n.json"},{name:"r1nz",url:"./game/roles/r1nz.json"},{name:"r2n",url:"./game/roles/r2n.json"},{name:"r2nz",url:"./game/roles/r2nz.json"},{name:"r3nz",url:"./game/roles/r3nz.json"},{name:"n1",url:"./game/roles/n1.json"},{name:"n1n",url:"./game/roles/n1n.json"},{name:"n3",url:"./game/roles/n3.json"},{name:"n3n",url:"./game/roles/n3n.json"},{name:"spine",url:"./spine/girl07_2da7002/girl07_2da7022.json"},{name:"blood",url:"./game/blood.json"},{name:"buff",url:"./game/buff.json"},{name:"skill_wlhd",url:"./game/wlhd.json"},{name:"skill_hfhy",url:"./game/hfhy.json"},{name:"skill_psdh",url:"./game/psdh.json"},{name:"skill_pi",url:"./game/pi.json"},{name:"map_zz",url:"./game/map_zz.json"},{name:"num1",url:"./game/num1.json"},{name:"num2",url:"./game/num2.json"},{name:"dead_fl",url:"./game/dead_fl.json"},{name:"dead_all",url:"./game/dead_all.json"},{name:"dead_1",url:"./game/dead_1.png"},{name:"dead_2",url:"./game/dead_2.png"},{name:"game_win",url:"./game/win.png"},{name:"game_fail",url:"./game/fail.png"},{name:"game_row",url:"./game/row.png"},{name:"m_1",url:"./game/m_1.png"},{name:"home_nav",url:"./ui/home_nav.json"},{name:"home_nav_text",url:"./ui/home_nav_text.json"},{name:"chat_bar",url:"./ui/chat_bar.json"},{name:"chat_current",url:"./ui/chat_current.png"},{name:"chat_input",url:"./ui/chat_input.png"},{name:"chat_input_bg",url:"./ui/chat_input_bg.png"},{name:"chat_send",url:"./ui/chat_send.png"},{name:"edge",url:"./ui/edge.png"},{name:"home_title",url:"./ui/home_title.png"},{name:"home_map",url:"./ui/home_map.png"},{name:"but",url:"./ui/but.png"},{name:"home_bg",url:"./ui/home_bg.png"},{name:"home_avatar",url:"./ui/home_avatar.png"},{name:"home_slave",url:"./ui/home_slave.png"},{name:"home_data",url:"./ui/home_data.png"},{name:"hpmp_bg",url:"./ui/hpmp_bg.png"},{name:"home_hp",url:"./ui/home_hp.png"},{name:"home_mp",url:"./ui/home_mp.png"},{name:"home_chat",url:"./ui/home_chat.png"},{name:"home_column",url:"./ui/home_column.png"},{name:"home_columns",url:"./ui/home_columns.png"},{name:"home_button",url:"./ui/home_button.png"},{name:"bg10",url:"./ui/bg_10.png"},{name:"game_title",url:"./ui/game_title.png"},{name:"button_yun",url:"./ui/button_yun.png"},{name:"title_name",url:"./ui/title_name.png"},{name:"select_skill",url:"./ui/select_skill.png"},{name:"row_skill",url:"./ui/row_skill.png"},{name:"f_jt",url:"./ui/f_jt.png"},{name:"confirm_box",url:"./ui/confirm_box.png"},{name:"chat_bg",url:"./ui/chat_bg.png"},{name:"th",url:"./ui/th.json"},{name:"npc_jt",url:"./ui/npc_jt.json"},{name:"tit_m",url:"./ui/tit_m.json"},{name:"fx_b",url:"./ui/fx_b.png"},{name:"fx_l",url:"./ui/fx_l.png"},{name:"fx_r",url:"./ui/fx_r.png"},{name:"fx_t",url:"./ui/fx_t.png"},{name:"map_0",url:"./ui/map_0.png"},{name:"map_1",url:"./ui/map_1.png"},{name:"map_2",url:"./ui/map_2.png"},{name:"map_3",url:"./ui/map_3.png"},{name:"map_4",url:"./ui/map_4.png"},{name:"map_5",url:"./ui/map_5.png"},{name:"map_6",url:"./ui/map_6.png"},{name:"ss_1",url:"./ui/ss_m_1.png"},{name:"ss_2",url:"./ui/ss_m_2.png"},{name:"ss_3",url:"./ui/ss_m_3.png"},{name:"ss_4",url:"./ui/ss_m_4.png"},{name:"ss_5",url:"./ui/ss_m_5.png"},{name:"ss_6",url:"./ui/ss_m_6.png"},{name:"ss_7",url:"./ui/ss_m_7.png"},{name:"ss_8",url:"./ui/ss_m_8.png"},{name:"ss_9",url:"./ui/ss_m_9.png"},{name:"avatar",url:"./avatar/avatar.png"}]);const d8=c8;var p8=n(374),f8=n.n(p8);class m8{constructor(t){this.parent=t,this.paused=!1}destroy(){}down(t){return!1}move(t){return!1}up(t){return!1}wheel(t){return!1}update(t){}resize(){}reset(){}pause(){this.paused=!0}resume(){this.paused=!1}}function g8(t,e){return t?"function"==typeof t?t:"string"==typeof t?f8()[t]:void 0:f8()[e]}const y8={removeOnInterrupt:!1,ease:"linear",time:1e3};class v8 extends m8{__init(){this.startWidth=null}__init2(){this.startHeight=null}__init3(){this.deltaWidth=null}__init4(){this.deltaHeight=null}__init5(){this.width=null}__init6(){this.height=null}__init7(){this.time=0}constructor(t,e={}){super(t),v8.prototype.__init.call(this),v8.prototype.__init2.call(this),v8.prototype.__init3.call(this),v8.prototype.__init4.call(this),v8.prototype.__init5.call(this),v8.prototype.__init6.call(this),v8.prototype.__init7.call(this),this.options=Object.assign({},y8,e),this.options.ease=g8(this.options.ease),this.setupPosition(),this.setupZoom(),this.time=0}setupPosition(){void 0!==this.options.position?(this.startX=this.parent.center.x,this.startY=this.parent.center.y,this.deltaX=this.options.position.x-this.parent.center.x,this.deltaY=this.options.position.y-this.parent.center.y,this.keepCenter=!1):this.keepCenter=!0}setupZoom(){this.width=null,this.height=null,void 0!==this.options.scale?this.width=this.parent.screenWidth/this.options.scale:void 0!==this.options.scaleX||void 0!==this.options.scaleY?(void 0!==this.options.scaleX&&(this.width=this.parent.screenWidth/this.options.scaleX),void 0!==this.options.scaleY&&(this.height=this.parent.screenHeight/this.options.scaleY)):(void 0!==this.options.width&&(this.width=this.options.width),void 0!==this.options.height&&(this.height=this.options.height)),null!==this.width&&(this.startWidth=this.parent.screenWidthInWorldPixels,this.deltaWidth=this.width-this.startWidth),null!==this.height&&(this.startHeight=this.parent.screenHeightInWorldPixels,this.deltaHeight=this.height-this.startHeight)}down(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("animate"),!1}complete(){this.parent.plugins.remove("animate"),null!==this.width&&this.parent.fitWidth(this.width,this.keepCenter,null===this.height),null!==this.height&&this.parent.fitHeight(this.height,this.keepCenter,null===this.width),this.keepCenter||this.parent.moveCenter(this.options.position),this.parent.emit("animate-end",this.parent),this.options.callbackOnComplete&&this.options.callbackOnComplete(this.parent)}update(t){if(!this.paused)if(this.time+=t,this.time>=this.options.time)this.complete();else{const t=new En(this.parent.scale.x,this.parent.scale.y),e=this.options.ease(this.time,0,1,this.options.time);if(null!==this.width){const t=this.startWidth,n=this.deltaWidth;this.parent.fitWidth(t+n*e,this.keepCenter,null===this.height)}if(null!==this.height){const t=this.startHeight,n=this.deltaHeight;this.parent.fitHeight(t+n*e,this.keepCenter,null===this.width)}if(null===this.width?this.parent.scale.x=this.parent.scale.y:null===this.height&&(this.parent.scale.y=this.parent.scale.x),!this.keepCenter){const t=this.startX,n=this.startY,r=this.deltaX,i=this.deltaY,s=new En(this.parent.x,this.parent.y);this.parent.moveCenter(t+r*e,n+i*e),this.parent.emit("moved",{viewport:this.parent,original:s,type:"animate"})}(this.width||this.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:t,type:"animate"})}}}function x8(t){let e,n=t[0],r=1;for(;r<t.length;){const i=t[r],s=t[r+1];if(r+=2,("optionalAccess"===i||"optionalCall"===i)&&null==n)return;"access"===i||"optionalAccess"===i?(e=n,n=s(n)):"call"!==i&&"optionalCall"!==i||(n=s(((...t)=>n.call(e,...t))),e=void 0)}return n}const b8={sides:"all",friction:.5,time:150,ease:"easeInOutSine",underflow:"center",bounceBox:null};class w8 extends m8{constructor(t,e={}){super(t),this.options=Object.assign({},b8,e),this.ease=g8(this.options.ease,"easeInOutSine"),this.options.sides?"all"===this.options.sides?this.top=this.bottom=this.left=this.right=!0:"horizontal"===this.options.sides?(this.right=this.left=!0,this.top=this.bottom=!1):"vertical"===this.options.sides?(this.left=this.right=!1,this.top=this.bottom=!0):(this.top=-1!==this.options.sides.indexOf("top"),this.bottom=-1!==this.options.sides.indexOf("bottom"),this.left=-1!==this.options.sides.indexOf("left"),this.right=-1!==this.options.sides.indexOf("right")):this.left=this.top=this.right=this.bottom=!1;const n=this.options.underflow.toLowerCase();"center"===n?(this.underflowX=0,this.underflowY=0):(this.underflowX=-1!==n.indexOf("left")?-1:-1!==n.indexOf("right")?1:0,this.underflowY=-1!==n.indexOf("top")?-1:-1!==n.indexOf("bottom")?1:0),this.reset()}isActive(){return null!==this.toX||null!==this.toY}down(){return this.toX=this.toY=null,!1}up(){return this.bounce(),!1}update(t){if(!this.paused){if(this.bounce(),this.toX){const e=this.toX;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-x"}),e.time>=this.options.time?(this.parent.x=e.end,this.toX=null,this.parent.emit("bounce-x-end",this.parent)):this.parent.x=this.ease(e.time,e.start,e.delta,this.options.time)}if(this.toY){const e=this.toY;e.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-y"}),e.time>=this.options.time?(this.parent.y=e.end,this.toY=null,this.parent.emit("bounce-y-end",this.parent)):this.parent.y=this.ease(e.time,e.start,e.delta,this.options.time)}}}calcUnderflowX(){let t;switch(this.underflowX){case-1:t=0;break;case 1:t=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:t=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}return t}calcUnderflowY(){let t;switch(this.underflowY){case-1:t=0;break;case 1:t=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:t=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}return t}oob(){const t=this.options.bounceBox;if(t){const e=void 0===t.x?0:t.x,n=void 0===t.y?0:t.y,r=void 0===t.width?this.parent.worldWidth:t.width,i=void 0===t.height?this.parent.worldHeight:t.height;return{left:this.parent.left<e,right:this.parent.right>r,top:this.parent.top<n,bottom:this.parent.bottom>i,topLeft:new En(e*this.parent.scale.x,n*this.parent.scale.y),bottomRight:new En(r*this.parent.scale.x-this.parent.screenWidth,i*this.parent.scale.y-this.parent.screenHeight)}}return{left:this.parent.left<0,right:this.parent.right>this.parent.worldWidth,top:this.parent.top<0,bottom:this.parent.bottom>this.parent.worldHeight,topLeft:new En(0,0),bottomRight:new En(this.parent.worldWidth*this.parent.scale.x-this.parent.screenWidth,this.parent.worldHeight*this.parent.scale.y-this.parent.screenHeight)}}bounce(){if(this.paused)return;let t,e=this.parent.plugins.get("decelerate",!0);e&&(e.x||e.y)&&(e.x&&e.percentChangeX===x8([e,"access",t=>t.options,"optionalAccess",t=>t.friction])||e.y&&e.percentChangeY===x8([e,"access",t=>t.options,"optionalAccess",t=>t.friction]))&&(t=this.oob(),(t.left&&this.left||t.right&&this.right)&&(e.percentChangeX=this.options.friction),(t.top&&this.top||t.bottom&&this.bottom)&&(e.percentChangeY=this.options.friction));const n=this.parent.plugins.get("drag",!0)||{},r=this.parent.plugins.get("pinch",!0)||{};if(e=e||{},!(x8([n,"optionalAccess",t=>t.active])||x8([r,"optionalAccess",t=>t.active])||this.toX&&this.toY||e.x&&e.y)){t=t||this.oob();const n=t.topLeft,r=t.bottomRight;if(!this.toX&&!e.x){let e=null;t.left&&this.left?e=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-n.x:t.right&&this.right&&(e=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-r.x),null!==e&&this.parent.x!==e&&(this.toX={time:0,start:this.parent.x,delta:e-this.parent.x,end:e},this.parent.emit("bounce-x-start",this.parent))}if(!this.toY&&!e.y){let e=null;t.top&&this.top?e=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-n.y:t.bottom&&this.bottom&&(e=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-r.y),null!==e&&this.parent.y!==e&&(this.toY={time:0,start:this.parent.y,delta:e-this.parent.y,end:e},this.parent.emit("bounce-y-start",this.parent))}}}reset(){this.toX=this.toY=null,this.bounce()}}const _8={left:!1,right:!1,top:!1,bottom:!1,direction:null,underflow:"center"};class T8 extends m8{constructor(t,e={}){super(t),this.options=Object.assign({},_8,e),this.options.direction&&(this.options.left="x"===this.options.direction||"all"===this.options.direction||null,this.options.right="x"===this.options.direction||"all"===this.options.direction||null,this.options.top="y"===this.options.direction||"all"===this.options.direction||null,this.options.bottom="y"===this.options.direction||"all"===this.options.direction||null),this.parseUnderflow(),this.last={x:null,y:null,scaleX:null,scaleY:null},this.update()}parseUnderflow(){const t=this.options.underflow.toLowerCase();"none"===t?this.noUnderflow=!0:"center"===t?(this.underflowX=this.underflowY=0,this.noUnderflow=!1):(this.underflowX=-1!==t.indexOf("left")?-1:-1!==t.indexOf("right")?1:0,this.underflowY=-1!==t.indexOf("top")?-1:-1!==t.indexOf("bottom")?1:0,this.noUnderflow=!1)}move(){return this.update(),!1}update(){if(this.paused)return;if(this.parent.x===this.last.x&&this.parent.y===this.last.y&&this.parent.scale.x===this.last.scaleX&&this.parent.scale.y===this.last.scaleY)return;const t={x:this.parent.x,y:this.parent.y},e=this.parent.plugins.decelerate||{};if(null!==this.options.left||null!==this.options.right){let n=!1;if(!this.noUnderflow&&this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:0!==this.parent.x&&(this.parent.x=0,n=!0);break;case 1:this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth&&(this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth,n=!0);break;default:this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2&&(this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2,n=!0)}else null!==this.options.left&&this.parent.left<(!0===this.options.left?0:this.options.left)&&(this.parent.x=-(!0===this.options.left?0:this.options.left)*this.parent.scale.x,e.x=0,n=!0),null!==this.options.right&&this.parent.right>(!0===this.options.right?this.parent.worldWidth:this.options.right)&&(this.parent.x=-(!0===this.options.right?this.parent.worldWidth:this.options.right)*this.parent.scale.x+this.parent.screenWidth,e.x=0,n=!0);n&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-x"})}if(null!==this.options.top||null!==this.options.bottom){let n=!1;if(!this.noUnderflow&&this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:0!==this.parent.y&&(this.parent.y=0,n=!0);break;case 1:this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight&&(this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight,n=!0);break;default:this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2&&(this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2,n=!0)}else null!==this.options.top&&this.parent.top<(!0===this.options.top?0:this.options.top)&&(this.parent.y=-(!0===this.options.top?0:this.options.top)*this.parent.scale.y,e.y=0,n=!0),null!==this.options.bottom&&this.parent.bottom>(!0===this.options.bottom?this.parent.worldHeight:this.options.bottom)&&(this.parent.y=-(!0===this.options.bottom?this.parent.worldHeight:this.options.bottom)*this.parent.scale.y+this.parent.screenHeight,e.y=0,n=!0);n&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-y"})}this.last.x=this.parent.x,this.last.y=this.parent.y,this.last.scaleX=this.parent.scale.x,this.last.scaleY=this.parent.scale.y}reset(){this.update()}}const E8={minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,minScale:null,maxScale:null};class S8 extends m8{constructor(t,e={}){super(t),this.options=Object.assign({},E8,e),this.clamp()}resize(){this.clamp()}clamp(){if(!this.paused)if(this.options.minWidth||this.options.minHeight||this.options.maxWidth||this.options.maxHeight){let t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight;if(null!==this.options.minWidth&&t<this.options.minWidth){const n=this.parent.scale.x;this.parent.fitWidth(this.options.minWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/n,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.maxWidth&&t>this.options.maxWidth){const n=this.parent.scale.x;this.parent.fitWidth(this.options.maxWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/n,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.minHeight&&e<this.options.minHeight){const n=this.parent.scale.y;this.parent.fitHeight(this.options.minHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/n,t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(null!==this.options.maxHeight&&e>this.options.maxHeight){const t=this.parent.scale.y;this.parent.fitHeight(this.options.maxHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/t,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}}else if(this.options.minScale||this.options.maxScale){const t={x:null,y:null},e={x:null,y:null};if("number"==typeof this.options.minScale)t.x=this.options.minScale,t.y=this.options.minScale;else if(null!==this.options.minScale){const e=this.options.minScale;t.x=void 0===e.x?null:e.x,t.y=void 0===e.y?null:e.y}if("number"==typeof this.options.maxScale)e.x=this.options.maxScale,e.y=this.options.maxScale;else if(null!==this.options.maxScale){const t=this.options.maxScale;e.x=void 0===t.x?null:t.x,e.y=void 0===t.y?null:t.y}let n=this.parent.scale.x,r=this.parent.scale.y;null!==t.x&&n<t.x&&(n=t.x),null!==e.x&&n>e.x&&(n=e.x),null!==t.y&&r<t.y&&(r=t.y),null!==e.y&&r>e.y&&(r=e.y),n===this.parent.scale.x&&r===this.parent.scale.y||(this.parent.scale.set(n,r),this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"}))}}reset(){this.clamp()}}const I8={friction:.98,bounce:.8,minSpeed:.01},k8=16;class C8 extends m8{constructor(t,e={}){super(t),this.options=Object.assign({},I8,e),this.saved=[],this.timeSinceRelease=0,this.reset(),this.parent.on("moved",(t=>this.moved(t)))}down(){return this.saved=[],this.x=this.y=null,!1}isActive(){return!(!this.x&&!this.y)}move(){if(this.paused)return!1;const t=this.parent.input.count();return(1===t||t>1&&!this.parent.plugins.get("pinch",!0))&&(this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()}),this.saved.length>60&&this.saved.splice(0,30)),!1}moved(t){if(this.saved.length){const e=this.saved[this.saved.length-1];"clamp-x"===t.type?e.x===t.original.x&&(e.x=this.parent.x):"clamp-y"===t.type&&e.y===t.original.y&&(e.y=this.parent.y)}}up(){if(0===this.parent.input.count()&&this.saved.length){const t=performance.now();for(const e of this.saved)if(e.time>=t-100){const n=t-e.time;this.x=(this.parent.x-e.x)/n,this.y=(this.parent.y-e.y)/n,this.percentChangeX=this.percentChangeY=this.options.friction,this.timeSinceRelease=0;break}}return!1}activate(t){void 0!==(t=t||{}).x&&(this.x=t.x,this.percentChangeX=this.options.friction),void 0!==t.y&&(this.y=t.y,this.percentChangeY=this.options.friction)}update(t){if(this.paused)return;const e=this.x||this.y,n=this.timeSinceRelease,r=this.timeSinceRelease+t;if(this.x){const e=this.percentChangeX,i=Math.log(e);this.parent.x+=this.x*k8/i*(Math.pow(e,r/k8)-Math.pow(e,n/k8)),this.x*=Math.pow(this.percentChangeX,t/k8)}if(this.y){const e=this.percentChangeY,i=Math.log(e);this.parent.y+=this.y*k8/i*(Math.pow(e,r/k8)-Math.pow(e,n/k8)),this.y*=Math.pow(this.percentChangeY,t/k8)}this.timeSinceRelease+=t,this.x&&this.y?Math.abs(this.x)<this.options.minSpeed&&Math.abs(this.y)<this.options.minSpeed&&(this.x=0,this.y=0):(Math.abs(this.x||0)<this.options.minSpeed&&(this.x=0),Math.abs(this.y||0)<this.options.minSpeed&&(this.y=0)),e&&this.parent.emit("moved",{viewport:this.parent,type:"decelerate"})}reset(){this.x=this.y=null}}const N8={direction:"all",pressDrag:!0,wheel:!0,wheelScroll:1,reverse:!1,clampWheel:!1,underflow:"center",factor:1,mouseButtons:"all",keyToPress:null,ignoreKeyToPressOnTouch:!1,lineHeight:20};class A8 extends m8{constructor(t,e={}){super(t),this.options=Object.assign({},N8,e),this.moved=!1,this.reverse=this.options.reverse?1:-1,this.xDirection=!this.options.direction||"all"===this.options.direction||"x"===this.options.direction,this.yDirection=!this.options.direction||"all"===this.options.direction||"y"===this.options.direction,this.keyIsPressed=!1,this.parseUnderflow(),this.mouseButtons(this.options.mouseButtons),this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){window.addEventListener("keydown",(e=>{t.includes(e.code)&&(this.keyIsPressed=!0)})),window.addEventListener("keyup",(e=>{t.includes(e.code)&&(this.keyIsPressed=!1)}))}mouseButtons(t){this.mouse=t&&"all"!==t?[-1!==t.indexOf("left"),-1!==t.indexOf("middle"),-1!==t.indexOf("right")]:[!0,!0,!0]}parseUnderflow(){const t=this.options.underflow.toLowerCase();"center"===t?(this.underflowX=0,this.underflowY=0):(t.includes("left")?this.underflowX=-1:t.includes("right")?this.underflowX=1:this.underflowX=0,t.includes("top")?this.underflowY=-1:t.includes("bottom")?this.underflowY=1:this.underflowY=0)}checkButtons(t){const e="mouse"===t.data.pointerType,n=this.parent.input.count();return!(!(1===n||n>1&&!this.parent.plugins.get("pinch",!0))||e&&!this.mouse[t.data.button])}checkKeyPress(t){return!this.options.keyToPress||this.keyIsPressed||this.options.ignoreKeyToPressOnTouch&&"touch"===t.data.pointerType}down(t){return!(this.paused||!this.options.pressDrag)&&(this.checkButtons(t)&&this.checkKeyPress(t)?(this.last={x:t.data.global.x,y:t.data.global.y},this.current=t.data.pointerId,!0):(this.last=null,!1))}get active(){return this.moved}move(t){if(this.paused||!this.options.pressDrag)return!1;if(this.last&&this.current===t.data.pointerId){const e=t.data.global.x,n=t.data.global.y,r=this.parent.input.count();if(1===r||r>1&&!this.parent.plugins.get("pinch",!0)){const r=e-this.last.x,i=n-this.last.y;if(this.moved||this.xDirection&&this.parent.input.checkThreshold(r)||this.yDirection&&this.parent.input.checkThreshold(i)){const r={x:e,y:n};return this.xDirection&&(this.parent.x+=(r.x-this.last.x)*this.options.factor),this.yDirection&&(this.parent.y+=(r.y-this.last.y)*this.options.factor),this.last=r,this.moved||this.parent.emit("drag-start",{event:t,screen:new En(this.last.x,this.last.y),world:this.parent.toWorld(new En(this.last.x,this.last.y)),viewport:this.parent}),this.moved=!0,this.parent.emit("moved",{viewport:this.parent,type:"drag"}),!0}}else this.moved=!1}return!1}up(t){if(this.paused)return!1;const e=this.parent.input.touches;if(1===e.length){const t=e[0];return t.last&&(this.last={x:t.last.x,y:t.last.y},this.current=t.id),this.moved=!1,!0}if(this.last&&this.moved){const e=new En(this.last.x,this.last.y);return this.parent.emit("drag-end",{event:t,screen:e,world:this.parent.toWorld(e),viewport:this.parent}),this.last=null,this.moved=!1,!0}return!1}wheel(t){if(this.paused)return!1;if(this.options.wheel){const e=this.parent.plugins.get("wheel",!0);if(!e||!e.options.wheelZoom&&!t.ctrlKey){const e=t.deltaMode?this.options.lineHeight:1;return this.xDirection&&(this.parent.x+=t.deltaX*e*this.options.wheelScroll*this.reverse),this.yDirection&&(this.parent.y+=t.deltaY*e*this.options.wheelScroll*this.reverse),this.options.clampWheel&&this.clamp(),this.parent.emit("wheel-scroll",this.parent),this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.options.passiveWheel||t.preventDefault(),this.parent.options.stopPropagation&&t.stopPropagation(),!0}}return!1}resume(){this.last=null,this.paused=!1}clamp(){const t=this.parent.plugins.get("decelerate",!0)||{};if("y"!==this.options.clampWheel)if(this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}else this.parent.left<0?(this.parent.x=0,t.x=0):this.parent.right>this.parent.worldWidth&&(this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth,t.x=0);if("x"!==this.options.clampWheel)if(this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}else this.parent.top<0&&(this.parent.y=0,t.y=0),this.parent.bottom>this.parent.worldHeight&&(this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight,t.y=0)}}const R8={speed:0,acceleration:null,radius:null};class M8 extends m8{constructor(t,e,n={}){super(t),this.target=e,this.options=Object.assign({},R8,n),this.velocity={x:0,y:0}}update(t){if(this.paused)return;const e=this.parent.center;let n=this.target.x,r=this.target.y;if(this.options.radius){if(!(Math.sqrt(Math.pow(this.target.y-e.y,2)+Math.pow(this.target.x-e.x,2))>this.options.radius))return;{const t=Math.atan2(this.target.y-e.y,this.target.x-e.x);n=this.target.x-Math.cos(t)*this.options.radius,r=this.target.y-Math.sin(t)*this.options.radius}}const i=n-e.x,s=r-e.y;if(i||s)if(this.options.speed)if(this.options.acceleration){const a=Math.atan2(r-e.y,n-e.x),o=Math.sqrt(Math.pow(i,2)+Math.pow(s,2));if(o){const l=(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2))/(2*this.options.acceleration);this.velocity=o>l?{x:Math.min(this.velocity.x+this.options.acceleration*t,this.options.speed),y:Math.min(this.velocity.y+this.options.acceleration*t,this.options.speed)}:{x:Math.max(this.velocity.x-this.options.acceleration*this.options.speed,0),y:Math.max(this.velocity.y-this.options.acceleration*this.options.speed,0)};const h=Math.cos(a)*this.velocity.x,u=Math.sin(a)*this.velocity.y,c=Math.abs(h)>Math.abs(i)?n:e.x+h,d=Math.abs(u)>Math.abs(s)?r:e.y+u;this.parent.moveCenter(c,d),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{const t=Math.atan2(r-e.y,n-e.x),a=Math.cos(t)*this.options.speed,o=Math.sin(t)*this.options.speed,l=Math.abs(a)>Math.abs(i)?n:e.x+a,h=Math.abs(o)>Math.abs(s)?r:e.y+o;this.parent.moveCenter(l,h),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}else this.parent.moveCenter(n,r),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}const O8={radius:null,distance:null,top:null,bottom:null,left:null,right:null,speed:8,reverse:!1,noDecelerate:!1,linear:!1,allowButtons:!1};class P8 extends m8{constructor(t,e={}){super(t),this.options=Object.assign({},O8,e),this.reverse=this.options.reverse?1:-1,this.radiusSquared="number"==typeof this.options.radius?Math.pow(this.options.radius,2):null,this.resize()}resize(){const t=this.options.distance;null!==t?(this.left=t,this.top=t,this.right=this.parent.worldScreenWidth-t,this.bottom=this.parent.worldScreenHeight-t):this.options.radius||(this.left=this.options.left,this.top=this.options.top,this.right=null===this.options.right?null:this.parent.worldScreenWidth-this.options.right,this.bottom=null===this.options.bottom?null:this.parent.worldScreenHeight-this.options.bottom)}down(){return this.paused||this.options.allowButtons||(this.horizontal=this.vertical=null),!1}move(t){if(this.paused)return!1;if("mouse"!==t.data.pointerType&&1!==t.data.identifier||!this.options.allowButtons&&0!==t.data.buttons)return!1;const e=t.data.global.x,n=t.data.global.y;if(this.radiusSquared){const t=this.parent.toScreen(this.parent.center);if(Math.pow(t.x-e,2)+Math.pow(t.y-n,2)>=this.radiusSquared){const r=Math.atan2(t.y-n,t.x-e);this.options.linear?(this.horizontal=Math.round(Math.cos(r))*this.options.speed*this.reverse*.06,this.vertical=Math.round(Math.sin(r))*this.options.speed*this.reverse*.06):(this.horizontal=Math.cos(r)*this.options.speed*this.reverse*.06,this.vertical=Math.sin(r)*this.options.speed*this.reverse*.06)}else this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=0}else null!==this.left&&e<this.left?this.horizontal=Number(this.reverse)*this.options.speed*.06:null!==this.right&&e>this.right?this.horizontal=-1*this.reverse*this.options.speed*.06:(this.decelerateHorizontal(),this.horizontal=0),null!==this.top&&n<this.top?this.vertical=Number(this.reverse)*this.options.speed*.06:null!==this.bottom&&n>this.bottom?this.vertical=-1*this.reverse*this.options.speed*.06:(this.decelerateVertical(),this.vertical=0);return!1}decelerateHorizontal(){const t=this.parent.plugins.get("decelerate",!0);this.horizontal&&t&&!this.options.noDecelerate&&t.activate({x:this.horizontal*this.options.speed*this.reverse/(1e3/60)})}decelerateVertical(){const t=this.parent.plugins.get("decelerate",!0);this.vertical&&t&&!this.options.noDecelerate&&t.activate({y:this.vertical*this.options.speed*this.reverse/(1e3/60)})}up(){return this.paused||(this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=null),!1}update(){if(!this.paused&&(this.horizontal||this.vertical)){const t=this.parent.center;this.horizontal&&(t.x+=this.horizontal*this.options.speed),this.vertical&&(t.y+=this.vertical*this.options.speed),this.parent.moveCenter(t),this.parent.emit("moved",{viewport:this.parent,type:"mouse-edges"})}}}const D8={noDrag:!1,percent:1,center:null,factor:1,axis:"all"};class F8 extends m8{__init(){this.active=!1}__init2(){this.pinching=!1}__init3(){this.moved=!1}constructor(t,e={}){super(t),F8.prototype.__init.call(this),F8.prototype.__init2.call(this),F8.prototype.__init3.call(this),this.options=Object.assign({},D8,e)}down(){return this.parent.input.count()>=2&&(this.active=!0,!0)}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}move(t){if(this.paused||!this.active)return!1;const e=t.data.global.x,n=t.data.global.y,r=this.parent.input.touches;if(r.length>=2){const i=r[0],s=r[1],a=i.last&&s.last?Math.sqrt(Math.pow(s.last.x-i.last.x,2)+Math.pow(s.last.y-i.last.y,2)):null;if(i.id===t.data.pointerId?i.last={x:e,y:n,data:t.data}:s.id===t.data.pointerId&&(s.last={x:e,y:n,data:t.data}),a){let t;const e={x:i.last.x+(s.last.x-i.last.x)/2,y:i.last.y+(s.last.y-i.last.y)/2};this.options.center||(t=this.parent.toLocal(e));let n=Math.sqrt(Math.pow(s.last.x-i.last.x,2)+Math.pow(s.last.y-i.last.y,2));n=0===n?n=1e-10:n;const r=(1-a/n)*this.options.percent*(this.isAxisX()?this.parent.scale.x:this.parent.scale.y);this.isAxisX()&&(this.parent.scale.x+=r),this.isAxisY()&&(this.parent.scale.y+=r),this.parent.emit("zoomed",{viewport:this.parent,type:"pinch",center:e});const o=this.parent.plugins.get("clamp-zoom",!0);if(o&&o.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const n=this.parent.toGlobal(t);this.parent.x+=(e.x-n.x)*this.options.factor,this.parent.y+=(e.y-n.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}!this.options.noDrag&&this.lastCenter&&(this.parent.x+=(e.x-this.lastCenter.x)*this.options.factor,this.parent.y+=(e.y-this.lastCenter.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})),this.lastCenter=e,this.moved=!0}else this.pinching||(this.parent.emit("pinch-start",this.parent),this.pinching=!0);return!0}return!1}up(){return!!(this.pinching&&this.parent.input.touches.length<=1)&&(this.active=!1,this.lastCenter=null,this.pinching=!1,this.moved=!1,this.parent.emit("pinch-end",this.parent),!0)}}const L8={topLeft:!1,friction:.8,time:1e3,ease:"easeInOutSine",interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1};class B8 extends m8{constructor(t,e,n,r={}){super(t),this.options=Object.assign({},L8,r),this.ease=g8(r.ease,"easeInOutSine"),this.x=e,this.y=n,this.options.forceStart&&this.snapStart()}snapStart(){this.percent=0,this.snapping={time:0};const t=this.options.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-t.x,this.deltaY=this.y-t.y,this.startX=t.x,this.startY=t.y,this.parent.emit("snap-start",this.parent)}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap"):this.options.interrupt&&(this.snapping=null),!1}up(){if(0===this.parent.input.count()){const t=this.parent.plugins.get("decelerate",!0);t&&(t.x||t.y)&&(t.percentChangeX=t.percentChangeY=this.options.friction)}return!1}update(t){if(!(this.paused||this.options.interrupt&&0!==this.parent.input.count()))if(this.snapping){const e=this.snapping;let n,r,i;e.time+=t;const s=this.startX,a=this.startY,o=this.deltaX,l=this.deltaY;if(e.time>this.options.time)n=!0,r=s+o,i=a+l;else{const t=this.ease(e.time,0,1,this.options.time);r=s+o*t,i=a+l*t}this.options.topLeft?this.parent.moveCorner(r,i):this.parent.moveCenter(r,i),this.parent.emit("moved",{viewport:this.parent,type:"snap"}),n&&(this.options.removeOnComplete&&this.parent.plugins.remove("snap"),this.parent.emit("snap-end",this.parent),this.snapping=null)}else{const t=this.options.topLeft?this.parent.corner:this.parent.center;t.x===this.x&&t.y===this.y||this.snapStart()}}}const $8={width:0,height:0,time:1e3,ease:"easeInOutSine",center:null,interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1,noMove:!1};class U8 extends m8{constructor(t,e={}){super(t),this.options=Object.assign({},$8,e),this.ease=g8(this.options.ease),this.xIndependent=!1,this.yIndependent=!1,this.xScale=0,this.yScale=0,this.options.width>0&&(this.xScale=t.screenWidth/this.options.width,this.xIndependent=!0),this.options.height>0&&(this.yScale=t.screenHeight/this.options.height,this.yIndependent=!0),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale,0===this.options.time?(t.container.scale.x=this.xScale,t.container.scale.y=this.yScale,this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom")):e.forceStart&&this.createSnapping()}createSnapping(){const t=this.parent.worldScreenWidth,e=this.parent.worldScreenHeight,n=this.parent.screenWidth/this.xScale,r=this.parent.screenHeight/this.yScale;this.snapping={time:0,startX:t,startY:e,deltaX:n-t,deltaY:r-e},this.parent.emit("snap-zoom-start",this.parent)}resize(){this.snapping=null,this.options.width>0&&(this.xScale=this.parent.screenWidth/this.options.width),this.options.height>0&&(this.yScale=this.parent.screenHeight/this.options.height),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap-zoom"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap-zoom"):this.options.interrupt&&(this.snapping=null),!1}update(t){if(this.paused)return;if(this.options.interrupt&&0!==this.parent.input.count())return;let e;if(this.options.center||this.options.noMove||(e=this.parent.center),this.snapping){if(this.snapping){const n=this.snapping;if(n.time+=t,n.time>=this.options.time)this.parent.scale.set(this.xScale,this.yScale),this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom"),this.parent.emit("snap-zoom-end",this.parent),this.snapping=null;else{const t=this.snapping,e=this.ease(t.time,t.startX,t.deltaX,this.options.time),n=this.ease(t.time,t.startY,t.deltaY,this.options.time);this.parent.scale.x=this.parent.screenWidth/e,this.parent.scale.y=this.parent.screenHeight/n}const r=this.parent.plugins.get("clamp-zoom",!0);r&&r.clamp(),this.options.noMove||(this.options.center?this.parent.moveCenter(this.options.center):this.parent.moveCenter(e))}}else this.parent.scale.x===this.xScale&&this.parent.scale.y===this.yScale||this.createSnapping()}resume(){this.snapping=null,super.resume()}}const V8={percent:.1,smooth:!1,interrupt:!0,reverse:!1,center:null,lineHeight:20,axis:"all",keyToPress:null,trackpadPinch:!1,wheelZoom:!0};class z8 extends m8{constructor(t,e={}){super(t),this.options=Object.assign({},V8,e),this.keyIsPressed=!1,this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){window.addEventListener("keydown",(e=>{t.includes(e.code)&&(this.keyIsPressed=!0)})),window.addEventListener("keyup",(e=>{t.includes(e.code)&&(this.keyIsPressed=!1)}))}checkKeyPress(){return!this.options.keyToPress||this.keyIsPressed}down(){return this.options.interrupt&&(this.smoothing=null),!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}update(){if(this.smoothing){const t=this.smoothingCenter,e=this.smoothing;let n;this.options.center||(n=this.parent.toLocal(t)),this.isAxisX()&&(this.parent.scale.x+=e.x),this.isAxisY()&&(this.parent.scale.y+=e.y),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const r=this.parent.plugins.get("clamp-zoom",!0);if(r&&r.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const e=this.parent.toGlobal(n);this.parent.x+=t.x-e.x,this.parent.y+=t.y-e.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.smoothingCount++,this.smoothingCount>=this.options.smooth&&(this.smoothing=null)}}pinch(t){if(this.paused)return;const e=this.parent.input.getPointerPosition(t),n=-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/200,r=Math.pow(2,(1+this.options.percent)*n);let i;this.options.center||(i=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=r),this.isAxisY()&&(this.parent.scale.y*=r),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const s=this.parent.plugins.get("clamp-zoom",!0);if(s&&s.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const t=this.parent.toGlobal(i);this.parent.x+=e.x-t.x,this.parent.y+=e.y-t.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel",{wheel:{dx:t.deltaX,dy:t.deltaY,dz:t.deltaZ},event:t,viewport:this.parent})}wheel(t){if(this.paused)return!1;if(!this.checkKeyPress())return!1;if(t.ctrlKey&&this.options.trackpadPinch)this.pinch(t);else if(this.options.wheelZoom){const e=this.parent.input.getPointerPosition(t),n=(this.options.reverse?-1:1)*-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/500,r=Math.pow(2,(1+this.options.percent)*n);if(this.options.smooth){const t={x:this.smoothing?this.smoothing.x*(this.options.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.options.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+t.x)*r-this.parent.scale.x)/this.options.smooth,y:((this.parent.scale.y+t.y)*r-this.parent.scale.y)/this.options.smooth},this.smoothingCount=0,this.smoothingCenter=e}else{let t;this.options.center||(t=this.parent.toLocal(e)),this.isAxisX()&&(this.parent.scale.x*=r),this.isAxisY()&&(this.parent.scale.y*=r),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const n=this.parent.plugins.get("clamp-zoom",!0);if(n&&n.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const n=this.parent.toGlobal(t);this.parent.x+=e.x-n.x,this.parent.y+=e.y-n.y}}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel",{wheel:{dx:t.deltaX,dy:t.deltaY,dz:t.deltaZ},event:t,viewport:this.parent})}return!this.parent.options.passiveWheel}}class G8{constructor(t){this.viewport=t,this.touches=[],this.addListeners()}addListeners(){this.viewport.interactive=!0,this.viewport.forceHitArea||(this.viewport.hitArea=new xn(0,0,this.viewport.worldWidth,this.viewport.worldHeight)),this.viewport.on("pointerdown",this.down,this),this.viewport.on("pointermove",this.move,this),this.viewport.on("pointerup",this.up,this),this.viewport.on("pointerupoutside",this.up,this),this.viewport.on("pointercancel",this.up,this),this.viewport.on("pointerout",this.up,this),this.wheelFunction=t=>this.handleWheel(t),this.viewport.options.divWheel.addEventListener("wheel",this.wheelFunction,{passive:this.viewport.options.passiveWheel}),this.isMouseDown=!1}destroy(){this.viewport.options.divWheel.removeEventListener("wheel",this.wheelFunction)}down(t){if(this.viewport.pause||!this.viewport.worldVisible)return;if("mouse"===t.data.pointerType?this.isMouseDown=!0:this.get(t.data.pointerId)||this.touches.push({id:t.data.pointerId,last:null}),1===this.count()){this.last=t.data.global.clone();const e=this.viewport.plugins.get("decelerate",!0),n=this.viewport.plugins.get("bounce",!0);e&&e.isActive()||n&&n.isActive()?this.clickedAvailable=!1:this.clickedAvailable=!0}else this.clickedAvailable=!1;this.viewport.plugins.down(t)&&this.viewport.options.stopPropagation&&t.stopPropagation()}clear(){this.isMouseDown=!1,this.touches=[],this.last=null}checkThreshold(t){return Math.abs(t)>=this.viewport.threshold}move(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const e=this.viewport.plugins.move(t);if(this.clickedAvailable&&this.last){const e=t.data.global.x-this.last.x,n=t.data.global.y-this.last.y;(this.checkThreshold(e)||this.checkThreshold(n))&&(this.clickedAvailable=!1)}e&&this.viewport.options.stopPropagation&&t.stopPropagation()}up(t){if(this.viewport.pause||!this.viewport.worldVisible)return;"mouse"===t.data.pointerType&&(this.isMouseDown=!1),"mouse"!==t.data.pointerType&&this.remove(t.data.pointerId);const e=this.viewport.plugins.up(t);this.clickedAvailable&&0===this.count()&&this.last&&(this.viewport.emit("clicked",{event:t,screen:this.last,world:this.viewport.toWorld(this.last),viewport:this}),this.clickedAvailable=!1),e&&this.viewport.options.stopPropagation&&t.stopPropagation()}getPointerPosition(t){const e=new En;return this.viewport.options.interaction?this.viewport.options.interaction.mapPositionToPoint(e,t.clientX,t.clientY):(e.x=t.clientX,e.y=t.clientY),e}handleWheel(t){if(this.viewport.pause||!this.viewport.worldVisible)return;if(this.viewport.options.interaction&&this.viewport.options.interaction.interactionDOMElement!==t.target)return;const e=this.viewport.toLocal(this.getPointerPosition(t));if(this.viewport.left<=e.x&&e.x<=this.viewport.right&&this.viewport.top<=e.y&&e.y<=this.viewport.bottom){this.viewport.plugins.wheel(t)&&!this.viewport.options.passiveWheel&&t.preventDefault()}}pause(){this.touches=[],this.isMouseDown=!1}get(t){for(const e of this.touches)if(e.id===t)return e;return null}remove(t){for(let e=0;e<this.touches.length;e++)if(this.touches[e].id===t)return void this.touches.splice(e,1)}count(){return(this.isMouseDown?1:0)+this.touches.length}}function W8(t){let e,n=t[0],r=1;for(;r<t.length;){const i=t[r],s=t[r+1];if(r+=2,("optionalAccess"===i||"optionalCall"===i)&&null==n)return;"access"===i||"optionalAccess"===i?(e=n,n=s(n)):"call"!==i&&"optionalCall"!==i||(n=s(((...t)=>n.call(e,...t))),e=void 0)}return n}const X8=["drag","pinch","wheel","follow","mouse-edges","decelerate","animate","bounce","snap-zoom","clamp-zoom","snap","clamp"];class H8{constructor(t){this.viewport=t,this.list=[],this.plugins={}}add(t,e,n=X8.length){this.plugins[t]=e;const r=X8.indexOf(t);-1!==r&&X8.splice(r,1),X8.splice(n,0,t),this.sort()}get(t,e){return e&&W8([this,"access",t=>t.plugins,"access",e=>e[t],"optionalAccess",t=>t.paused])?null:this.plugins[t]}update(t){for(const e of this.list)e.update(t)}resize(){for(const t of this.list)t.resize()}reset(){for(const t of this.list)t.reset()}removeAll(){this.plugins={},this.sort()}remove(t){this.plugins[t]&&(delete this.plugins[t],this.viewport.emit(`${t}-remove`),this.sort())}pause(t){W8([this,"access",t=>t.plugins,"access",e=>e[t],"optionalAccess",t=>t.pause,"call",t=>t()])}resume(t){W8([this,"access",t=>t.plugins,"access",e=>e[t],"optionalAccess",t=>t.resume,"call",t=>t()])}sort(){this.list=[];for(const t of X8)this.plugins[t]&&this.list.push(this.plugins[t])}down(t){let e=!1;for(const n of this.list)n.down(t)&&(e=!0);return e}move(t){let e=!1;for(const n of this.viewport.plugins.list)n.move(t)&&(e=!0);return e}up(t){let e=!1;for(const n of this.list)n.up(t)&&(e=!0);return e}wheel(t){let e=!1;for(const n of this.list)n.wheel(t)&&(e=!0);return e}}const Y8={screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:null,worldHeight:null,threshold:5,passiveWheel:!0,stopPropagation:!1,forceHitArea:null,noTicker:!1,interaction:null,disableOnContextMenu:!1,ticker:dr.shared};class j8 extends or{__init(){this._disableOnContextMenu=t=>t.preventDefault()}constructor(t={}){super(),j8.prototype.__init.call(this),this.options=Object.assign({},{divWheel:document.body},Y8,t),this.screenWidth=this.options.screenWidth,this.screenHeight=this.options.screenHeight,this._worldWidth=this.options.worldWidth,this._worldHeight=this.options.worldHeight,this.forceHitArea=this.options.forceHitArea,this.threshold=this.options.threshold,this.options.divWheel=this.options.divWheel||document.body,this.options.disableOnContextMenu&&this.options.divWheel.addEventListener("contextmenu",this._disableOnContextMenu),this.options.noTicker||(this.tickerFunction=()=>this.update(this.options.ticker.elapsedMS),this.options.ticker.add(this.tickerFunction)),this.input=new G8(this),this.plugins=new H8(this)}destroy(t){!this.options.noTicker&&this.tickerFunction&&this.options.ticker.remove(this.tickerFunction),this.options.disableOnContextMenu&&this.options.divWheel.removeEventListener("contextmenu",this._disableOnContextMenu),this.input.destroy(),super.destroy(t)}update(t){this.pause||(this.plugins.update(t),this.lastViewport&&(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y?this.moving=!0:this.moving&&(this.emit("moved-end",this),this.moving=!1),this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y?this.zooming=!0:this.zooming&&(this.emit("zoomed-end",this),this.zooming=!1)),this.forceHitArea||(this._hitAreaDefault=new xn(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight),this.hitArea=this._hitAreaDefault),this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y,this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y},this.emit("frame-end",this))}resize(t=window.innerWidth,e=window.innerHeight,n,r){this.screenWidth=t,this.screenHeight=e,void 0!==n&&(this._worldWidth=n),void 0!==r&&(this._worldHeight=r),this.plugins.resize(),this.dirty=!0}get worldWidth(){return this._worldWidth?this._worldWidth:this.width/this.scale.x}set worldWidth(t){this._worldWidth=t,this.plugins.resize()}get worldHeight(){return this._worldHeight?this._worldHeight:this.height/this.scale.y}set worldHeight(t){this._worldHeight=t,this.plugins.resize()}getVisibleBounds(){return new xn(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight)}toWorld(t,e){return 2===arguments.length?this.toLocal(new En(t,e)):this.toLocal(t)}toScreen(t,e){return 2===arguments.length?this.toGlobal(new En(t,e)):this.toGlobal(t)}get worldScreenWidth(){return this.screenWidth/this.scale.x}get worldScreenHeight(){return this.screenHeight/this.scale.y}get screenWorldWidth(){return this.worldWidth*this.scale.x}get screenWorldHeight(){return this.worldHeight*this.scale.y}get center(){return new En(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y)}set center(t){this.moveCenter(t)}moveCenter(...t){let e,n;"number"==typeof t[0]?(e=t[0],n=t[1]):(e=t[0].x,n=t[0].y);const r=(this.worldScreenWidth/2-e)*this.scale.x,i=(this.worldScreenHeight/2-n)*this.scale.y;return this.x===r&&this.y===i||(this.position.set(r,i),this.plugins.reset(),this.dirty=!0),this}get corner(){return new En(-this.x/this.scale.x,-this.y/this.scale.y)}set corner(t){this.moveCorner(t)}moveCorner(...t){let e,n;return 1===t.length?(e=-t[0].x*this.scale.x,n=-t[0].y*this.scale.y):(e=-t[0]*this.scale.x,n=-t[1]*this.scale.y),e===this.x&&n===this.y||(this.position.set(e,n),this.plugins.reset(),this.dirty=!0),this}get screenWidthInWorldPixels(){return this.screenWidth/this.scale.x}get screenHeightInWorldPixels(){return this.screenHeight/this.scale.y}findFitWidth(t){return this.screenWidth/t}findFitHeight(t){return this.screenHeight/t}findFit(t,e){const n=this.screenWidth/t,r=this.screenHeight/e;return Math.min(n,r)}findCover(t,e){const n=this.screenWidth/t,r=this.screenHeight/e;return Math.max(n,r)}fitWidth(t=this.worldWidth,e,n=!0,r){let i;e&&(i=this.center),this.scale.x=this.screenWidth/t,n&&(this.scale.y=this.scale.x);const s=this.plugins.get("clamp-zoom",!0);return!r&&s&&s.clamp(),e&&i&&this.moveCenter(i),this}fitHeight(t=this.worldHeight,e,n=!0,r){let i;e&&(i=this.center),this.scale.y=this.screenHeight/t,n&&(this.scale.x=this.scale.y);const s=this.plugins.get("clamp-zoom",!0);return!r&&s&&s.clamp(),e&&i&&this.moveCenter(i),this}fitWorld(t){let e;t&&(e=this.center),this.scale.x=this.screenWidth/this.worldWidth,this.scale.y=this.screenHeight/this.worldHeight,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const n=this.plugins.get("clamp-zoom",!0);return n&&n.clamp(),t&&e&&this.moveCenter(e),this}fit(t,e=this.worldWidth,n=this.worldHeight){let r;t&&(r=this.center),this.scale.x=this.screenWidth/e,this.scale.y=this.screenHeight/n,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const i=this.plugins.get("clamp-zoom",!0);return i&&i.clamp(),t&&r&&this.moveCenter(r),this}setZoom(t,e){let n;e&&(n=this.center),this.scale.set(t);const r=this.plugins.get("clamp-zoom",!0);return r&&r.clamp(),e&&n&&this.moveCenter(n),this}zoomPercent(t,e){return this.setZoom(this.scale.x+this.scale.x*t,e)}zoom(t,e){return this.fitWidth(t+this.worldScreenWidth,e),this}get scaled(){return this.scale.x}set scaled(t){this.setZoom(t,!0)}snapZoom(t){return this.plugins.add("snap-zoom",new U8(this,t)),this}OOB(){return{left:this.left<0,right:this.right>this.worldWidth,top:this.top<0,bottom:this.bottom>this.worldHeight,cornerPoint:new En(this.worldWidth*this.scale.x-this.screenWidth,this.worldHeight*this.scale.y-this.screenHeight)}}get right(){return-this.x/this.scale.x+this.worldScreenWidth}set right(t){this.x=-t*this.scale.x+this.screenWidth,this.plugins.reset()}get left(){return-this.x/this.scale.x}set left(t){this.x=-t*this.scale.x,this.plugins.reset()}get top(){return-this.y/this.scale.y}set top(t){this.y=-t*this.scale.y,this.plugins.reset()}get bottom(){return-this.y/this.scale.y+this.worldScreenHeight}set bottom(t){this.y=-t*this.scale.y+this.screenHeight,this.plugins.reset()}get dirty(){return!!this._dirty}set dirty(t){this._dirty=t}get forceHitArea(){return this._forceHitArea}set forceHitArea(t){t?(this._forceHitArea=t,this.hitArea=t):(this._forceHitArea=null,this.hitArea=new xn(0,0,this.worldWidth,this.worldHeight))}drag(t){return this.plugins.add("drag",new A8(this,t)),this}clamp(t){return this.plugins.add("clamp",new T8(this,t)),this}decelerate(t){return this.plugins.add("decelerate",new C8(this,t)),this}bounce(t){return this.plugins.add("bounce",new w8(this,t)),this}pinch(t){return this.plugins.add("pinch",new F8(this,t)),this}snap(t,e,n){return this.plugins.add("snap",new B8(this,t,e,n)),this}follow(t,e){return this.plugins.add("follow",new M8(this,t,e)),this}wheel(t){return this.plugins.add("wheel",new z8(this,t)),this}animate(t){return this.plugins.add("animate",new v8(this,t)),this}clampZoom(t){return this.plugins.add("clamp-zoom",new S8(this,t)),this}mouseEdges(t){return this.plugins.add("mouse-edges",new P8(this,t)),this}get pause(){return!!this._pause}set pause(t){this._pause=t,this.lastViewport=null,this.moving=!1,this.zooming=!1,t&&this.input.pause()}ensureVisible(t,e,n,r,i){i&&(n>this.worldScreenWidth||r>this.worldScreenHeight)&&(this.fit(!0,n,r),this.emit("zoomed",{viewport:this,type:"ensureVisible"}));let s=!1;t<this.left?(this.left=t,s=!0):t+n>this.right&&(this.right=t+n,s=!0),e<this.top?(this.top=e,s=!0):e+r>this.bottom&&(this.bottom=e+r,s=!0),s&&this.emit("moved",{viewport:this,type:"ensureVisible"})}}var q8="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{};var K8=function(t){var e={exports:{}};return t(e,e.exports),e.exports}((function(t,e){(function(){var e;e={linear:function(t,e,n,r){return n*t/r+e},easeInQuad:function(t,e,n,r){return n*(t/=r)*t+e},easeOutQuad:function(t,e,n,r){return-n*(t/=r)*(t-2)+e},easeInOutQuad:function(t,e,n,r){return(t/=r/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,n,r){return n*(t/=r)*t*t+e},easeOutCubic:function(t,e,n,r){return n*((t=t/r-1)*t*t+1)+e},easeInOutCubic:function(t,e,n,r){return(t/=r/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,n,r){return n*(t/=r)*t*t*t+e},easeOutQuart:function(t,e,n,r){return-n*((t=t/r-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,n,r){return(t/=r/2)<1?n/2*t*t*t*t+e:-n/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,n,r){return n*(t/=r)*t*t*t*t+e},easeOutQuint:function(t,e,n,r){return n*((t=t/r-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,n,r){return(t/=r/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,n,r){return-n*Math.cos(t/r*(Math.PI/2))+n+e},easeOutSine:function(t,e,n,r){return n*Math.sin(t/r*(Math.PI/2))+e},easeInOutSine:function(t,e,n,r){return-n/2*(Math.cos(Math.PI*t/r)-1)+e},easeInExpo:function(t,e,n,r){return 0===t?e:n*Math.pow(2,10*(t/r-1))+e},easeOutExpo:function(t,e,n,r){return t===r?e+n:n*(1-Math.pow(2,-10*t/r))+e},easeInOutExpo:function(t,e,n,r){return(t/=r/2)<1?n/2*Math.pow(2,10*(t-1))+e:n/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,n,r){return-n*(Math.sqrt(1-(t/=r)*t)-1)+e},easeOutCirc:function(t,e,n,r){return n*Math.sqrt(1-(t=t/r-1)*t)+e},easeInOutCirc:function(t,e,n,r){return(t/=r/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+e:n/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(t,e,n,r){var i,s,a;return a=1.70158,0===t||(t/=r),(s=0)||(s=.3*r),(i=n)<Math.abs(n)?(i=n,a=s/4):a=s/(2*Math.PI)*Math.asin(n/i),-i*Math.pow(2,10*(t-=1))*Math.sin((t*r-a)*(2*Math.PI)/s)+e},easeOutElastic:function(t,e,n,r){var i,s,a;return a=1.70158,0===t||(t/=r),(s=0)||(s=.3*r),(i=n)<Math.abs(n)?(i=n,a=s/4):a=s/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*t)*Math.sin((t*r-a)*(2*Math.PI)/s)+n+e},easeInOutElastic:function(t,e,n,r){var i,s,a;return a=1.70158,0===t||(t/=r/2),(s=0)||(s=r*(.3*1.5)),(i=n)<Math.abs(n)?(i=n,a=s/4):a=s/(2*Math.PI)*Math.asin(n/i),t<1?i*Math.pow(2,10*(t-=1))*Math.sin((t*r-a)*(2*Math.PI)/s)*-.5+e:i*Math.pow(2,-10*(t-=1))*Math.sin((t*r-a)*(2*Math.PI)/s)*.5+n+e},easeInBack:function(t,e,n,r,i){return void 0===i&&(i=1.70158),n*(t/=r)*t*((i+1)*t-i)+e},easeOutBack:function(t,e,n,r,i){return void 0===i&&(i=1.70158),n*((t=t/r-1)*t*((i+1)*t+i)+1)+e},easeInOutBack:function(t,e,n,r,i){return void 0===i&&(i=1.70158),(t/=r/2)<1?n/2*(t*t*((1+(i*=1.525))*t-i))+e:n/2*((t-=2)*t*((1+(i*=1.525))*t+i)+2)+e},easeInBounce:function(t,n,r,i){return r-e.easeOutBounce(i-t,0,r,i)+n},easeOutBounce:function(t,e,n,r){return(t/=r)<1/2.75?n*(7.5625*t*t)+e:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInOutBounce:function(t,n,r,i){return t<i/2?.5*e.easeInBounce(2*t,0,r,i)+n:.5*e.easeOutBounce(2*t-i,0,r,i)+.5*r+n}},function(e){t.exports=e}(e)}).call(q8)}));const Z8={boxWidth:100,boxHeight:100,scrollbarSize:10,scrollbarBackground:14540253,scrollbarBackgroundAlpha:1,scrollbarForeground:8947848,scrollbarForegroundAlpha:1,dragScroll:!0,stopPropagation:!0,scrollbarOffsetHorizontal:0,scrollbarOffsetVertical:0,underflow:"top-left",fadeScrollbar:!1,fadeScrollbarTime:1e3,fadeScrollboxWait:3e3,fadeScrollboxEase:"easeInOutSine",passiveWheel:!1,clampWheel:!0};class J8 extends or{constructor(t={}){if(super(),this.options=Object.assign({},Z8,t),t.overflow&&(this.options.overflowX=this.options.overflowY=t.overflow),this.ease="function"==typeof this.options.fadeScrollboxEase?this.options.fadeScrollboxEase:K8[this.options.fadeScrollboxEase],this.content=this.addChild(new j8({passiveWheel:!1,stopPropagation:this.options.stopPropagation,screenWidth:this.options.boxWidth,screenHeight:this.options.boxHeight,interaction:this.options.interaction,divWheel:this.options.divWheel})),this.content.decelerate().on("moved",(()=>this._drawScrollbars())),t.ticker)this.options.ticker=t.ticker;else{let n;const r=e;n=parseInt(/^(\d+)\./.exec(vu)[1])<5?r.ticker.shared:r.Ticker.shared,this.options.ticker=t.ticker||n}this.scrollbar=this.addChild(new Yo),this.scrollbar.interactive=!0,this.scrollbar.on("pointerdown",this.scrollbarDown,this),this.interactive=!0,this.on("pointermove",this.scrollbarMove,this),this.on("pointerup",this.scrollbarUp,this),this.on("pointercancel",this.scrollbarUp,this),this.on("pointerupoutside",this.scrollbarUp,this),this._maskContent=this.addChild(new Yo),this.update(),this.options.noTicker||(this.tickerFunction=()=>this.updateLoop(Math.min(this.options.ticker.elapsedMS,16.6667)),this.options.ticker.add(this.tickerFunction))}get scrollbarOffsetHorizontal(){return this.options.scrollbarOffsetHorizontal}set scrollbarOffsetHorizontal(t){this.options.scrollbarOffsetHorizontal=t}get scrollbarOffsetVertical(){return this.options.scrollbarOffsetVertical}set scrollbarOffsetVertical(t){this.options.scrollbarOffsetVertical=t}get disable(){return this._disabled}set disable(t){this._disabled!==t&&(this._disabled=t,this.update())}get stopPropagation(){return this.options.stopPropagation}set stopPropagation(t){this.options.stopPropagation=t}get dragScroll(){return this.options.dragScroll}set dragScroll(t){this.options.dragScroll=t,t?this.content.drag():void 0!==this.content.removePlugin?this.content.removePlugin("drag"):this.content.plugins.remove("drag"),this.update()}get boxWidth(){return this.options.boxWidth}set boxWidth(t){this.options.boxWidth=t,this.content.screenWidth=t,this.update()}get overflow(){return this.options.overflow}set overflow(t){this.options.overflow=t,this.options.overflowX=t,this.options.overflowY=t,this.update()}get overflowX(){return this.options.overflowX}set overflowX(t){this.options.overflowX=t,this.update()}get overflowY(){return this.options.overflowY}set overflowY(t){this.options.overflowY=t,this.update()}get boxHeight(){return this.options.boxHeight}set boxHeight(t){this.options.boxHeight=t,this.content.screenHeight=t,this.update()}get scrollbarSize(){return this.options.scrollbarSize}set scrollbarSize(t){this.options.scrollbarSize=t}get contentWidth(){return this.options.boxWidth-(this.isScrollbarVertical?this.options.scrollbarSize:0)}get contentHeight(){return this.options.boxHeight-(this.isScrollbarHorizontal?this.options.scrollbarSize:0)}get isScrollbarVertical(){return this._isScrollbarVertical}get isScrollbarHorizontal(){return this._isScrollbarHorizontal}get scrollTop(){return this.content.top}set scrollTop(t){this.content.top=t,this._drawScrollbars()}get scrollLeft(){return this.content.left}set scrollLeft(t){this.content.left=t,this._drawScrollbars()}get scrollWidth(){return this._scrollWidth||this.content.width}set scrollWidth(t){this._scrollWidth=t}get scrollHeight(){return this._scrollHeight||this.content.height}set scrollHeight(t){this._scrollHeight=t}_drawScrollbars(){this._isScrollbarHorizontal="scroll"===this.overflowX||-1===["hidden","none"].indexOf(this.overflowX)&&this.scrollWidth>this.options.boxWidth,this._isScrollbarVertical="scroll"===this.overflowY||-1===["hidden","none"].indexOf(this.overflowY)&&this.scrollHeight>this.options.boxHeight,this.scrollbar.clear(),this.scrollWidth,this._isScrollbarVertical&&this.options.scrollbarSize,this.scrollHeight,this.isScrollbarHorizontal&&this.options.scrollbarSize;const t=this.scrollWidth+(this.isScrollbarVertical?this.options.scrollbarSize:0),e=this.scrollHeight+(this.isScrollbarHorizontal?this.options.scrollbarSize:0);this.scrollbarTop=this.content.top/e*this.boxHeight,this.scrollbarTop=this.scrollbarTop<0?0:this.scrollbarTop,this.scrollbarHeight=this.boxHeight/e*this.boxHeight,this.scrollbarHeight=this.scrollbarTop+this.scrollbarHeight>this.boxHeight?this.boxHeight-this.scrollbarTop:this.scrollbarHeight,this.scrollbarLeft=this.content.left/t*this.boxWidth,this.scrollbarLeft=this.scrollbarLeft<0?0:this.scrollbarLeft,this.scrollbarWidth=this.boxWidth/t*this.boxWidth,this.scrollbarWidth=this.scrollbarWidth+this.scrollbarLeft>this.boxWidth?this.boxWidth-this.scrollbarLeft:this.scrollbarWidth,this.isScrollbarVertical&&this.scrollbar.beginFill(this.options.scrollbarBackground,this.options.scrollbarBackgroundAlpha).drawRect(this.boxWidth-this.scrollbarSize+this.options.scrollbarOffsetVertical,0,this.scrollbarSize,this.boxHeight).endFill(),this.isScrollbarHorizontal&&this.scrollbar.beginFill(this.options.scrollbarBackground,this.options.scrollbarBackgroundAlpha).drawRect(0,this.boxHeight-this.scrollbarSize+this.options.scrollbarOffsetHorizontal,this.boxWidth,this.scrollbarSize).endFill(),this.isScrollbarVertical&&this.scrollbar.beginFill(this.options.scrollbarForeground,this.options.scrollbarForegroundAlpha).drawRect(this.boxWidth-this.scrollbarSize+this.options.scrollbarOffsetVertical,this.scrollbarTop,this.scrollbarSize,this.scrollbarHeight).endFill(),this.isScrollbarHorizontal&&this.scrollbar.beginFill(this.options.scrollbarForeground,this.options.scrollbarForegroundAlpha).drawRect(this.scrollbarLeft,this.boxHeight-this.scrollbarSize+this.options.scrollbarOffsetHorizontal,this.scrollbarWidth,this.scrollbarSize).endFill(),this.activateFade()}_drawMask(){this._maskContent.beginFill(0).drawRect(0,0,this.boxWidth,this.boxHeight).endFill(),this.content.mask=this._maskContent}update(){if(this.content.mask=null,this._maskContent.clear(),!this._disabled){this._drawScrollbars(),this._drawMask();const t=this.isScrollbarHorizontal&&this.isScrollbarVertical?"all":this.isScrollbarHorizontal?"x":"y";null!==t&&(this.options.dragScroll&&this.content.drag({clampWheel:this.options.clampWheel,direction:t}),this.content.clamp({direction:t,underflow:this.options.underflow}))}}updateLoop(t){if(this.fade){if(this.fade.wait>0){if(this.fade.wait-=t,!(this.fade.wait<=0))return;t+=this.fade.wait}this.fade.duration+=t,this.fade.duration>=this.options.fadeScrollbarTime?(this.fade=null,this.scrollbar.alpha=0):this.scrollbar.alpha=this.ease(this.fade.duration,1,-1,this.options.fadeScrollbarTime),this.content.dirty=!0}}get dirty(){return this.content.dirty}set dirty(t){this.content.dirty=t}activateFade(){!this.fade&&this.options.fade&&(this.scrollbar.alpha=1,this.fade={wait:this.options.fadeScrollboxWait,duration:0})}scrollbarDown(t){const e=this.toLocal(t.data.global);return this.isScrollbarHorizontal&&e.y>this.boxHeight-this.scrollbarSize?(e.x>=this.scrollbarLeft&&e.x<=this.scrollbarLeft+this.scrollbarWidth?this.pointerDown={type:"horizontal",last:e}:e.x>this.scrollbarLeft?(this.content.left+=this.content.worldScreenWidth,this.update()):(this.content.left-=this.content.worldScreenWidth,this.update()),void(this.options.stopPropagation&&t.stopPropagation())):this.isScrollbarVertical&&e.x>this.boxWidth-this.scrollbarSize?(e.y>=this.scrollbarTop&&e.y<=this.scrollbarTop+this.scrollbarWidth?this.pointerDown={type:"vertical",last:e}:e.y>this.scrollbarTop?(this.content.top+=this.content.worldScreenHeight,this.update()):(this.content.top-=this.content.worldScreenHeight,this.update()),void(this.options.stopPropagation&&t.stopPropagation())):void 0}scrollbarMove(t){if(this.pointerDown){if("horizontal"===this.pointerDown.type){const e=this.toLocal(t.data.global),n=this.scrollWidth+(this.isScrollbarVertical?this.options.scrollbarSize:0);this.scrollbarLeft+=e.x-this.pointerDown.last.x,this.content.left=this.scrollbarLeft/this.boxWidth*n,this.pointerDown.last=e,this.update()}else if("vertical"===this.pointerDown.type){const e=this.toLocal(t.data.global),n=this.scrollHeight+(this.isScrollbarHorizontal?this.options.scrollbarSize:0);this.scrollbarTop+=e.y-this.pointerDown.last.y,this.content.top=this.scrollbarTop/this.boxHeight*n,this.pointerDown.last=e,this.update()}this.options.stopPropagation&&t.stopPropagation()}}scrollbarUp(){this.pointerDown=null}resize(t){this.options.boxWidth=void 0!==t.boxWidth?t.boxWidth:this.options.boxWidth,this.options.boxHeight=void 0!==t.boxHeight?t.boxHeight:this.options.boxHeight,t.scrollWidth&&(this.scrollWidth=t.scrollWidth),t.scrollHeight&&(this.scrollHeight=t.scrollHeight),this.content.resize(this.options.boxWidth,this.options.boxHeight,this.scrollWidth,this.scrollHeight),this.update()}ensureVisible(t,e,n,r){this.content.ensureVisible(t,e,n,r),this._drawScrollbars()}}var Q8,t9,e9,n9,r9,i9,s9,a9,o9,l9=function(){return"undefined"!=typeof window},h9=function(){return Q8||l9()&&(Q8=window.gsap)&&Q8.registerPlugin&&Q8},u9=function(t){return"function"==typeof t},c9=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],d9=.212671,p9=.71516,f9=.072169,m9=function(t,e){var n,r,i=[],s=0,a=0;for(n=0;n<4;n++){for(r=0;r<5;r++)a=4===r?t[s+4]:0,i[s+r]=t[s]*e[r]+t[s+1]*e[r+5]+t[s+2]*e[r+10]+t[s+3]*e[r+15]+a;s+=5}return i},g9=function(t,e){var n=1-e,r=n*d9,i=n*p9,s=n*f9;return m9([r+e,i,s,0,0,r,i+e,s,0,0,r,i,s+e,0,0,0,0,0,1,0],t)},y9=function(t,e,n){var r=e9(e),i=r[0]/255,s=r[1]/255,a=r[2]/255,o=1-n;return m9([o+n*i*d9,n*i*p9,n*i*f9,0,0,n*s*d9,o+n*s*p9,n*s*f9,0,0,n*a*d9,n*a*p9,o+n*a*f9,0,0,0,0,0,1,0],t)},v9=function(t,e){e*=Math.PI/180;var n=Math.cos(e),r=Math.sin(e);return m9([d9+n*(1-d9)+r*-d9,p9+n*-p9+r*-p9,f9+n*-f9+r*(1-f9),0,0,d9+n*-d9+.143*r,p9+.28484*n+.14*r,f9+n*-f9+-.283*r,0,0,d9+n*-d9+-.787329*r,p9+n*-p9+r*p9,f9+n*(1-f9)+r*f9,0,0,0,0,0,1,0,0,0,0,0,1],t)},x9=function(t,e){return m9([e,0,0,0,.5*(1-e),0,e,0,0,.5*(1-e),0,0,e,0,.5*(1-e),0,0,0,1,0],t)},b9=function(t,e){for(var n,r=n9.filters[e],i=t.filters||[],s=i.length;--s>-1;)if(i[s]instanceof r)return i[s];return n=new r,"BlurFilter"===e&&(n.blur=0),i.push(n),t.filters=i,n},w9=function(t,e,n,r){e.add(n,t,n[t],r[t]),e._props.push(t)},_9=function(t,e){var n=new n9.filters.ColorMatrixFilter;return n.matrix=e,n.brightness(t,!0),n.matrix},T9={contrast:1,saturation:1,colorizeAmount:0,colorize:"rgb(255,255,255)",hue:0,brightness:1},E9=function(t,e,n){var r,i,s,a=b9(t,"ColorMatrixFilter"),o=t._gsColorMatrixFilter=t._gsColorMatrixFilter||function(t){var e,n={};for(e in t)n[e]=t[e];return n}(T9),l=e.combineCMF&&!("colorMatrixFilter"in e&&!e.colorMatrixFilter);s=a.matrix,e.resolution&&(a.resolution=e.resolution),e.matrix&&e.matrix.length===s.length?(i=e.matrix,1!==o.contrast&&w9("contrast",n,o,T9),o.hue&&w9("hue",n,o,T9),1!==o.brightness&&w9("brightness",n,o,T9),o.colorizeAmount&&(w9("colorize",n,o,T9),w9("colorizeAmount",n,o,T9)),1!==o.saturation&&w9("saturation",n,o,T9)):(i=c9.slice(),null!=e.contrast?(i=x9(i,+e.contrast),w9("contrast",n,o,e)):1!==o.contrast&&(l?i=x9(i,o.contrast):w9("contrast",n,o,T9)),null!=e.hue?(i=v9(i,+e.hue),w9("hue",n,o,e)):o.hue&&(l?i=v9(i,o.hue):w9("hue",n,o,T9)),null!=e.brightness?(i=_9(+e.brightness,i),w9("brightness",n,o,e)):1!==o.brightness&&(l?i=_9(o.brightness,i):w9("brightness",n,o,T9)),null!=e.colorize?(e.colorizeAmount="colorizeAmount"in e?+e.colorizeAmount:1,i=y9(i,e.colorize,e.colorizeAmount),w9("colorize",n,o,e),w9("colorizeAmount",n,o,e)):o.colorizeAmount&&(l?i=y9(i,o.colorize,o.colorizeAmount):(w9("colorize",n,o,T9),w9("colorizeAmount",n,o,T9))),null!=e.saturation?(i=g9(i,+e.saturation),w9("saturation",n,o,e)):1!==o.saturation&&(l?i=g9(i,o.saturation):w9("saturation",n,o,T9))),r=i.length;for(;--r>-1;)i[r]!==s[r]&&n.add(s,r,s[r],i[r],"colorMatrixFilter");n._props.push("colorMatrixFilter")},S9=function(t,e){var n=e.t,r=e.p,i=e.color;(0,e.set)(n,r,i[0]<<16|i[1]<<8|i[2])},I9=function(t,e){var n=e.g;n&&(n.dirty++,n.clearDirty++)},k9=function(t,e){e.t.visible=!!e.t.alpha},C9=function(t,e,n,r){var i=t[e],s=e9(u9(i)?t[e.indexOf("set")||!u9(t["get"+e.substr(3)])?e:"get"+e.substr(3)]():i),a=e9(n);r._pt=new r9(r._pt,t,e,0,0,S9,{t,p:e,color:s,set:i9(t,e)}),r.add(s,0,s[0],a[0]),r.add(s,1,s[1],a[1]),r.add(s,2,s[2],a[2])},N9={tint:1,lineColor:1,fillColor:1},A9="position,scale,skew,pivot,anchor,tilePosition,tileScale".split(","),R9={x:"position",y:"position",tileX:"tilePosition",tileY:"tilePosition"},M9={colorMatrixFilter:1,saturation:1,contrast:1,hue:1,colorize:1,colorizeAmount:1,brightness:1,combineCMF:1},O9=Math.PI/180,P9=function(t){return"string"==typeof t},D9=function(t){return P9(t)&&"="===t.charAt(1)?t.substr(0,2)+parseFloat(t.substr(2))*O9:t*O9},F9=function(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e5*(e.s+e.c*t))/1e5,e)},L9=function(t,e,n,r,i,s){var a,o,l=360*(s?O9:1),h=P9(i),u=h&&"="===i.charAt(1)?+(i.charAt(0)+"1"):0,c=parseFloat(u?i.substr(2):i)*(s?O9:1),d=u?c*u:c-r,p=r+d;return h&&("short"===(a=i.split("_")[1])&&(d%=l)!==d%(l/2)&&(d+=d<0?l:-l),"cw"===a&&d<0?d=(d+1e10*l)%l-~~(d/l)*l:"ccw"===a&&d>0&&(d=(d-1e10*l)%l-~~(d/l)*l)),t._pt=o=new r9(t._pt,e,n,r,d,F9),o.e=p,o},B9=function(){l9()&&(t9=window,Q8=h9(),n9=n9||t9.PIXI,s9=n9&&n9.VERSION&&"4"===n9.VERSION.charAt(0),e9=function(t){return Q8.utils.splitColor("0x"===(t+"").substr(0,2)?"#"+t.substr(2):t)})};for(a9=0;a9<A9.length;a9++)o9=A9[a9],R9[o9+"X"]=o9,R9[o9+"Y"]=o9;var $9,U9={version:"3.9.1",name:"pixi",register:function(t,e,n){Q8=t,r9=n,i9=e.getSetter,B9()},registerPIXI:function(t){n9=t},init:function(t,e,n,r,i){if(n9||B9(),!(n9&&t instanceof n9.DisplayObject))return!1;var s,a,o,l,h,u,c,d,p;for(u in e){if(s=R9[u],o=e[u],s)a=~u.charAt(u.length-1).toLowerCase().indexOf("x")?"x":"y",this.add(t[s],a,t[s][a],"skew"===s?D9(o):o);else if("scale"===u||"anchor"===u||"pivot"===u||"tileScale"===u)this.add(t[u],"x",t[u].x,o),this.add(t[u],"y",t[u].y,o);else if("rotation"===u||"angle"===u)L9(this,t,u,t[u],o,"rotation"===u);else if(M9[u])l||(E9(t,e.colorMatrixFilter||e,this),l=!0);else if("blur"===u||"blurX"===u||"blurY"===u||"blurPadding"===u){if(h=b9(t,"BlurFilter"),this.add(h,u,h[u],o),0!==e.blurPadding)for(c=e.blurPadding||2*Math.max(h[u],o),d=t.filters.length;--d>-1;)t.filters[d].padding=Math.max(t.filters[d].padding,c)}else if(N9[u])if(("lineColor"===u||"fillColor"===u)&&t instanceof n9.Graphics)for(p=(t.geometry||t).graphicsData,this._pt=new r9(this._pt,t,u,0,0,I9,{g:t.geometry||t}),d=p.length;--d>-1;)C9(s9?p[d]:p[d][u.substr(0,4)+"Style"],s9?u:"color",o,this);else C9(t,u,o,this);else"autoAlpha"===u?(this._pt=new r9(this._pt,t,"visible",0,0,k9),this.add(t,"alpha",t.alpha,o),this._props.push("alpha","visible")):"resolution"!==u&&this.add(t,u,"get",o);this._props.push(u)}}};h9()&&Q8.registerPlugin(U9);class V9 extends or{constructor(){super();let t=new est,e=new nst;h8.backgroundColor(3538995);let n=new rst("排行榜",{fontSize:38,fill:"#F7EDCA",stroke:"#d3393c",strokeThickness:10,lineJoin:"round"});n.y=100,n.x=h8.width/2-n.width/2,this.addChild(n);var r=76;["玩家","教派","副将","教派"].forEach((t=>{var e=new sst(t,{fill:["#76174d"],fontSize:46},14591232);e.x=r,e.y=200,r+=e.width+10,this.addChild(e),e.on("pointertap",(()=>h8.changeScene(new V9)))}));r=76;["高手","富","排","美","战"].forEach((t=>{var e=new sst(t,{fontSize:46},15156480,(t=>{t.butWidth*=1.3}));e.x=r,e.y=270,r+=e.width+10,this.addChild(e),e.on("pointertap",(()=>h8.changeScene(new V9)))}));let i=new Yo;i.beginFill(16777215,.8).drawRect(0,0,.8*h8.width,4),i.endFill(),i.y=350,i.x=h8.width/2-i.width/2,this.addChild(i),this.list(),this.addChild(e,t,new ast(Hit))}update(){}list(){var t=new or;for(let n=0;n<V9.data.length;n++){var e=new or;e.x=80,e.y=400+70*n;let r=new rst((n+1+".").toString()),i=new rst(V9.data[n].nick,{fontSize:40,fill:"#F7EDCA",stroke:"#D3393C",strokeThickness:6,lineJoin:"round"});i.x=r.width;let s=new rst("("+V9.data[n].lv+"级)",{fontSize:40});s.x=r.width+i.width;let a=new Yo;a.beginFill(16777215,.2).drawRect(-6,-6,.8*h8.width,60),a.endFill(),n%2==0&&e.addChild(a),e.addChild(r,i,s),t.addChild(e)}this.addChild(t)}}class z9 extends u8{constructor(){super();let t=new est,e=new nst,n=new Qit("宝物"),r=new tst;h8.backgroundColor(3538995),this.scrollbox=new Zit,this.infos(),this.addChild(this.scrollbox),this.scrollbox.y=t.height+n.height,this.scrollbox.x=h8.width/2-this.scrollbox.width/2,r.x=this.scrollbox.width/2-r.width/2,this.scrollbox.content.addChild(r),this.addChild(e,t,n,new ast(Hit))}structure(t){let e=new or;for(const r in t){let i=0;for(const s in t[r]){let a=t[r][s];var n=null;if("text"==a.type){let t=Object.assign({fontSize:40},a.style);n=new rst(a.name+" : "+a.value,t)}else n=new sst(a.name,a.style,a.color);n.x=20+i+Number(s),n.y=50+70*Number(r),i+=n.width+6,n.on("pointertap",(()=>a.calllback()),this),e.addChild(n)}}return e}infos(){let t=[[{type:"button",name:"获取金砖",value:"",style:{fontSize:46},color:16711680,calllback:()=>{}},{type:"button",name:"求助帮助",value:"",style:{fontSize:46},color:12976323,calllback:()=>{}}],[{type:"button",name:"宝物",value:"",style:{fontSize:46,fill:6488157},color:14591232,calllback:()=>{}},{type:"button",name:"经验书",value:"",style:{fontSize:46,fill:6488157},color:14591232,calllback:()=>{}},{type:"button",name:"副将",value:"",style:{fontSize:46,fill:6488157},color:14591232,calllback:()=>{ost.send({route:["Slave","slave"],attr:"up"})}}]];this.scrollbox.content.addChild(this.structure(t))}}class G9 extends u8{constructor(){super();let t=new est,e=new nst,n=new Qit("招贤馆"),r=new tst;h8.backgroundColor(3538995),this.scrollbox=new Zit,this.infos(),this.lists(),this.addChild(this.scrollbox),this.scrollbox.y=t.height+n.height,this.scrollbox.x=h8.width/2-this.scrollbox.width/2,r.x=this.scrollbox.width/2-r.width/2,r.y=280,this.scrollbox.content.addChild(r),this.addChild(e,t,n,new ast(Hit))}structure(t){let e=new or;for(const r in t){let i=0;for(const s in t[r]){let a=t[r][s];var n=null;if("text"==a.type){let t=Object.assign({fontSize:40},a.style);n=new rst(a.name+" : "+a.value,t)}else n=new sst(a.name,a.style,a.color);n.x=20+i+Number(s),n.y=50+70*Number(r),i+=n.width+6,n.on("pointertap",(()=>a.calllback()),this),e.addChild(n)}}return e}infos(){let t=[[{type:"button",name:"招募副将",value:"",style:{fontSize:46},color:12976323,calllback:()=>{h8.currentScene.addChild(new ist("确定招募副将?",(()=>{ost.send({route:["Slave","get"]}),h8.changeScene(new G9)})))}},{type:"button",name:"猛将传介绍",value:"",style:{fontSize:46},color:12976323,calllback:()=>{}}],[{type:"button",name:"常人",value:"",style:{fontSize:46,fill:6488157},color:14591232,calllback:()=>{}},{type:"button",name:"英才",value:"",style:{fontSize:46,fill:6488157},color:14591232,calllback:()=>{}},{type:"button",name:"将才",value:"",style:{fontSize:46,fill:6488157},color:14591232,calllback:()=>{}}],[{type:"button",name:"成长",value:"",style:{fontSize:46,fill:6488157},color:14591232,calllback:()=>{ost.send({route:["Slave","slave"],attr:"up"})}},{type:"button",name:"血",value:"",style:{fontSize:46,fill:6488157},color:14591232,calllback:()=>{ost.send({route:["Slave","slave"],attr:"x"})}},{type:"button",name:"精",value:"",style:{fontSize:46,fill:6488157},color:14591232,calllback:()=>{ost.send({route:["Slave","slave"],attr:"j"})}},{type:"button",name:"攻",value:"",style:{fontSize:46,fill:6488157},color:14591232,calllback:()=>{ost.send({route:["Slave","slave"],attr:"g"})}},{type:"button",name:"速",value:"",style:{fontSize:46,fill:6488157},color:14591232,calllback:()=>{ost.send({route:["Slave","slave"],attr:"s"})}}]];this.scrollbox.content.addChild(this.structure(t))}lists(){var t=new or;let e=G9.data.list,n=G9.data.attr;for(let i=0;i<e.length;i++){var r=new or;r.x=20,r.y=300+70*i;let s=new rst(e[i].name,{fontSize:40,fill:"#F7EDCA",stroke:"#D3393C",strokeThickness:6,lineJoin:"round"});s.on("pointertap",(()=>h8.changeScene(new W9(e[i],G9))));let a=new rst("  (0.85-"+e[i][n]+")",{fontSize:40});a.x=s.width;let o=new Yo;o.beginFill(16777215,.2).drawRect(-6,-6,.8*h8.width,60),o.endFill(),i%2==0&&r.addChild(o),r.addChild(s,a),t.addChild(r)}this.scrollbox.content.addChild(t)}}class W9 extends u8{constructor(t,e){super();let n=new est,r=new nst,i=new Qit(t.name);this.lists(t),this.addChild(new Jit({avatar:t.sid,y:150})),this.addChild(r,n,i,new ast(e))}structure(t){let e=new or;for(const r in t){let i=0;for(const s in t[r]){let a=t[r][s];var n=null;if("text"==a.type){let t=Object.assign({fontSize:40},a.style);n=new rst(a.name+" : "+a.value,t)}else n=new sst(a.name,a.style,a.color);n.x=80+i+Number(s),n.y=170+80*Number(r),i+=n.width+6,n.on("pointertap",(()=>a.calllback()),this),e.addChild(n)}}return e}lists(t){let e=[[{type:"text",name:"头衔",value:"将才",style:{},color:12976323,calllback:()=>{}}],[{type:"text",name:"成长率",value:t.up,style:{},color:12976323,calllback:()=>{}}],[{type:"text",name:"气血初值",value:t.x,style:{},color:12976323,calllback:()=>{}}],[{type:"text",name:"智力初值",value:t.j,style:{},color:12976323,calllback:()=>{}}],[{type:"text",name:"攻击初值",value:t.g,style:{},color:12976323,calllback:()=>{}}],[{type:"text",name:"敏捷初值",value:t.s,style:{},color:12976323,calllback:()=>{}}],[{type:"button",name:"生平",value:"",style:{},color:12976323,calllback:()=>{}},{type:"button",name:"数据说明",value:"",style:{},color:12976323,calllback:()=>{}}]];this.addChild(this.structure(e))}}class X9 extends u8{constructor(){super();let t=new est,e=new nst,n=new Qit("副将");h8.backgroundColor(65844);let r=new rst("当前战斗力: 56000",{});r.y=200,r.x=80,this.addChild(r);let i=X9.data.list;for(let t=0;t<i.length;t++){let e=i[t],n=new Yo;n.beginFill(16777215,.14).drawRect(0,0,h8.width,80),n.y=284+80*t,t%2||this.addChild(n);let r=new sst(e.up?"休":"战",{fontSize:46},5132469);r.y=300+80*t-4,r.x=550,this.addChild(r),r.on("pointertap",(()=>{ost.send({route:["Slave","up"],sid:e.id,up:e.up})}));let s={fontSize:40,fill:"#f7edca",lineJoin:"round",stroke:e.up?"#d3393c":"#140fe1",strokeThickness:5},a=["","武","文","异"],o="("+e.lv+"级)"+e.slave.name+"."+a[e.js],l=new rst(o,s);l.y=300+80*t,l.x=80,l.on("pointertap",(()=>{H9.data=e,H9.selectedIndex=t,h8.changeScene(new H9)})),this.addChild(l)}this.addChild(e,t,n,new ast(Hit))}}class H9 extends u8{constructor(){super();let t=new est,e=new nst;var n=H9.data;let r=new Qit("副将:"+n.slave.name);this.addChild(new Jit({avatar:n.sid,y:180}));var i=4*n.lv-n.attr_atk-n.attr_hp-n.attr_mp-n.attr_spd;let s=[[{type:"text",name:"头衔",value:"将才",style:{},calllback:()=>{}},{type:"buttton",name:"休息",value:"",style:{x:-150},calllback:()=>{ost.send({route:["Slave","up"],sid:n.id,up:n.up})}}],[{type:"text",name:"等级",value:n.lv+"级武士",style:{},calllback:()=>{}}],[{type:"text",name:"升级",value:"需"+n.exp+"经验",style:{},calllback:()=>{}},{type:"button",name:"升级",value:"",style:{},calllback:()=>{this.addChild(new ist("确定使用副将心法?",(()=>{ost.send({route:["Goods","useVaria"],id:n.id,type:3,num:1})})))}}],[{type:"text",name:"气血",value:n.d.x,style:{stroke:"#d3393c",strokeThickness:8},calllback:()=>{}}],[{type:"text",name:"精力",value:n.d.j,style:{stroke:"#346eed",strokeThickness:8},calllback:()=>{}}],[{type:"text",name:"攻击",value:n.d.g,style:!1,calllback:()=>{}},{type:"text",name:"防御",value:"3200",style:!1,calllback:()=>{}}],[{type:"text",name:"速度",value:n.d.s,style:!1,calllback:()=>{}}],[{type:"text",name:"属性点",value:i,style:!1,calllback:()=>{}},{type:"button",name:i>0?"分配":"查看",value:"100",style:{butColor:i>0?16711680:5132469},calllback:()=>h8.changeScene(new j9)}],[{type:"button",name:"查看技能",value:"100",style:!1,calllback:()=>h8.changeScene(new Y9)}],[{type:"button",name:"战斗能力",value:"100",style:!1,calllback:()=>h8.changeScene(new q9)},{type:"button",name:"初值培养",value:"100",style:!1,calllback:()=>{h8.changeScene(new W9(n.slave,H9))}}],[{type:"button",name:"副将生平",value:"100",style:!1,calllback:()=>{h8.changeScene(new W9(n.slave,H9))}},{type:"button",name:"解雇副将",value:"100",style:!1,calllback:()=>{this.addChild(new ist("即将解雇副将!!!",(()=>{ost.send({route:["Slave","del"],id:n.id})})))}}]];var a=new or;a.x=80,a.y=200;for(const t in s)for(const e in s[t]){let n=s[t][e];var o=null;let r=Object.assign({fontSize:40},n.style);"text"==n.type?o=new rst(n.name+" : "+n.value,r):(r.fontSize=46,o=new sst(n.name,r,r.butColor?r.butColor:5132469),o.y=-10,o.x="x"in r?Number(r.x):0),o.x+=370*Number(e),o.y+=85*Number(t),o.on("pointertap",(()=>n.calllback()),this),a.addChild(o)}this.addChild(a),this.addChild(e,t,r,new ast(X9))}}H9.selectedIndex=0;class Y9 extends u8{constructor(){super();var t=H9.data;Y9.data=t;let e=new est,n=new nst,r=new Qit(t.slave.name+"技能");this.lists(),this.addChild(n,e,r,new ast(H9))}structure(t){let e=new or;for(const r in t){let i=0;for(const s in t[r]){let a=t[r][s];var n=null;if("text"==a.type){let t=Object.assign({fontSize:37},a.style);n=new rst(a.name+""+a.value,t)}else n=new sst(a.name,a.style,a.color,(()=>{}),!1);n.x="x"in a.style?Number(a.style.x):i+Number(s),n.y="y"in a.style?Number(a.style.y)*Number(r):86*Number(r)+6,i+=n.width+6,n.on("pointertap",(()=>a.calllback()),this),e.addChild(n)}}return e.x=80,e.y=200,e}lists(){var t=Y9.data,e=[];for(let r=0;r<t.skill.length;r++){var n=t.skill[r];let i=[{type:"text",name:n.skill_name,value:`(${n.lv})级`,style:{},color:12976323,calllback:()=>{}},{type:"text",name:"熟练度:",value:n.sld,style:{},color:12976323,calllback:()=>{}},{type:"button",name:n.sld/6e3>=n.lv?"升级":"提高",value:"",style:{x:480,y:78},color:n.sld/6e3>=n.lv?16711680:5132469,calllback:()=>{var e=t.skill[r];this.addChild(new ist("确定使用"+{1:"一",2:"二",3:"三",4:"四",5:"五"}[e.lv]+"级技能书?",(()=>{ost.send({route:["Goods","useVaria"],id:e.id,type:2,num:1})})))}}];e.push(i)}e.push([{type:"button",name:"学习技能",value:"",style:{},color:5132469,calllback:()=>{this.addChild(new ist("确定学习新技能?",(()=>{ost.send({route:["Slave","skillStudy"],usid:t.id})})))}}]),this.addChild(this.structure(e))}}class j9 extends u8{constructor(){super(),this.attr={},this.attr_num=0;var t=H9.data;j9.data=t;let e=new est,n=new nst,r=new Qit(t.slave.name+"属性点");this.infos();var i=new sst("确认分配",{},16711680,(()=>{}),!0);i.x=72,i.y=.86*h8.height,this.addChild(i),i.on("pointertap",(()=>ost.send({route:["Slave","setAttr"],attr:this.attr,id:t.id})));var s=new sst("重新分配",{},5132469,(()=>{}),!0);s.x=i.x+i.width+50,s.y=i.y,this.addChild(s),s.on("pointertap",(()=>h8.changeScene(new j9))),this.addChild(n,e,r,new ast(H9))}structure(t){let e=new or;for(const r in t){let i=0,s=new or;for(const e in t[r]){let a=t[r][e];var n=null;if("text"==a.type){let t=Object.assign({fontSize:40},a.style);n=new rst(a.name+" "+a.value,t)}else n=new sst(a.name,a.style,a.color,(()=>{}),!1);n.x="x"in a.style?Number(a.style.x):i+Number(e),n.y=70*Number(r),i+=n.width+6,n.on("pointertap",(()=>a.calllback(n)),this),s.addChild(n)}e.addChild(s)}return e.x=80,e.y=200,e}infos(){var t=j9.data;this.attr_num=4*t.lv-t.attr_atk-t.attr_hp-t.attr_mp-t.attr_spd,this.attr={attr_hp:0,attr_mp:0,attr_atk:0,attr_spd:0};let e=[[{type:"text",name:"目前剩于点数",value:this.attr_num,style:{fill:16185344},color:14591232,calllback:()=>{}}],[{type:"text",name:"气血",value:t.d.x,style:{},color:14591232,calllback:()=>{}}],[{type:"text",name:`体质点:${t.attr_hp}`,value:"",style:{},color:14591232,calllback:()=>{}},{type:"text",name:"+",value:this.attr.attr_hp,style:{},color:14591232,calllback:()=>{}},{type:"button",name:"分配全部",value:"",style:{x:350},color:11486211,calllback:t=>this.actionAttr(t,this.attr_num,"hp")}],[{type:"button",name:" +1 ",value:0,style:{},color:5132469,calllback:t=>this.actionAttr(t,1,"hp")},{type:"button",name:" +3 ",value:0,style:{},color:5132469,calllback:t=>this.actionAttr(t,3,"hp")},{type:"button",name:" -1 ",value:0,style:{x:350},color:5132469,calllback:t=>this.actionAttr(t,-1,"hp")},{type:"button",name:" -3 ",value:0,style:{x:468},color:5132469,calllback:t=>this.actionAttr(t,-3,"hp")}],[{type:"text",name:"精力",value:t.d.x,style:{},color:14591232,calllback:()=>{}}],[{type:"text",name:`智力点:${t.attr_mp}`,value:"",style:{},color:14591232,calllback:()=>{}},{type:"text",name:"+",value:this.attr.attr_mp,style:{},color:14591232,calllback:()=>{}},{type:"button",name:"分配全部",value:"",style:{x:350},color:11486211,calllback:t=>this.actionAttr(t,this.attr_num,"mp")}],[{type:"button",name:" +1 ",value:0,style:{},color:5132469,calllback:t=>this.actionAttr(t,1,"mp")},{type:"button",name:" +3 ",value:0,style:{},color:5132469,calllback:t=>this.actionAttr(t,3,"mp")},{type:"button",name:" -1 ",value:0,style:{x:350},color:5132469,calllback:t=>this.actionAttr(t,-1,"mp")},{type:"button",name:" -3 ",value:0,style:{x:468},color:5132469,calllback:t=>this.actionAttr(t,-3,"mp")}],[{type:"text",name:"攻击",value:t.d.g,style:{},color:14591232,calllback:()=>{}}],[{type:"text",name:`力量点:${t.attr_atk}`,value:"",style:{},color:14591232,calllback:()=>{}},{type:"text",name:"+",value:this.attr.attr_atk,style:{},color:14591232,calllback:()=>{}},{type:"button",name:"分配全部",value:"",style:{x:350},color:11486211,calllback:t=>this.actionAttr(t,this.attr_num,"atk")}],[{type:"button",name:" +1 ",value:0,style:{},color:5132469,calllback:t=>this.actionAttr(t,1,"atk")},{type:"button",name:" +3 ",value:0,style:{},color:5132469,calllback:t=>this.actionAttr(t,3,"atk")},{type:"button",name:" -1 ",value:0,style:{x:350},color:5132469,calllback:t=>this.actionAttr(t,-1,"atk")},{type:"button",name:" -3 ",value:0,style:{x:468},color:5132469,calllback:t=>this.actionAttr(t,-3,"atk")}],[{type:"text",name:"速度",value:t.d.s,style:{},color:14591232,calllback:()=>{}}],[{type:"text",name:`敏捷点:${t.attr_spd}`,value:"",style:{},color:14591232,calllback:()=>{}},{type:"text",name:"+",value:this.attr.attr_spd,style:{},color:14591232,calllback:()=>{}},{type:"button",name:"分配全部",value:"",style:{x:350},color:11486211,calllback:t=>this.actionAttr(t,this.attr_num,"spd")}],[{type:"button",name:" +1 ",value:0,style:{},color:5132469,calllback:t=>this.actionAttr(t,1,"spd")},{type:"button",name:" +3 ",value:0,style:{},color:5132469,calllback:t=>this.actionAttr(t,3,"spd")},{type:"button",name:" -1 ",value:0,style:{x:350},color:5132469,calllback:t=>this.actionAttr(t,-1,"spd")},{type:"button",name:" -3 ",value:0,style:{x:468},color:5132469,calllback:t=>this.actionAttr(t,-3,"spd")}]];this.addChild(this.structure(e))}actionAttr(t,e,n){this.attr_num-e<0||this.attr["attr_"+n]+e<0||(this.attr["attr_"+n]+=e,t.parent.parent.children[{hp:2,mp:5,atk:8,spd:11}[n]].children[1].text.text="+ "+this.attr["attr_"+n],this.attr_num-=e,t.parent.parent.children[0].children[0].children[0].text="目前剩于点数 "+this.attr_num)}}class q9 extends u8{constructor(){super();let t=new est,e=new nst,n=new Qit("战斗能力");this.addChild(e,t,n,new ast(H9))}}!function(t){t[t.Region=0]="Region",t[t.BoundingBox=1]="BoundingBox",t[t.Mesh=2]="Mesh",t[t.LinkedMesh=3]="LinkedMesh",t[t.Path=4]="Path",t[t.Point=5]="Point",t[t.Clipping=6]="Clipping"}($9||($9={}));var K9,Z9,J9,Q9,t7,e7=function(){function t(t,e,n,r){void 0===e&&(e=new Array),void 0===n&&(n=0),void 0===r&&(r=new DataView(t.buffer)),this.strings=e,this.index=n,this.buffer=r}return t.prototype.readByte=function(){return this.buffer.getInt8(this.index++)},t.prototype.readUnsignedByte=function(){return this.buffer.getUint8(this.index++)},t.prototype.readShort=function(){var t=this.buffer.getInt16(this.index);return this.index+=2,t},t.prototype.readInt32=function(){var t=this.buffer.getInt32(this.index);return this.index+=4,t},t.prototype.readInt=function(t){var e=this.readByte(),n=127&e;return 0!=(128&e)&&(n|=(127&(e=this.readByte()))<<7,0!=(128&e)&&(n|=(127&(e=this.readByte()))<<14,0!=(128&e)&&(n|=(127&(e=this.readByte()))<<21,0!=(128&e)&&(n|=(127&(e=this.readByte()))<<28)))),t?n:n>>>1^-(1&n)},t.prototype.readStringRef=function(){var t=this.readInt(!0);return 0==t?null:this.strings[t-1]},t.prototype.readString=function(){var t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;for(var e="",n=0;n<t;){var r=this.readByte();switch(r>>4){case 12:case 13:e+=String.fromCharCode((31&r)<<6|63&this.readByte()),n+=2;break;case 14:e+=String.fromCharCode((15&r)<<12|(63&this.readByte())<<6|63&this.readByte()),n+=3;break;default:e+=String.fromCharCode(r),n++}}return e},t.prototype.readFloat=function(){var t=this.buffer.getFloat32(this.index);return this.index+=4,t},t.prototype.readBoolean=function(){return 0!=this.readByte()},t}();!function(t){t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add"}(K9||(K9={})),function(t){t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut"}(Z9||(Z9={})),function(t){t[t.Fixed=0]="Fixed",t[t.Percent=1]="Percent"}(J9||(J9={})),function(t){t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale"}(Q9||(Q9={})),function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(t7||(t7={}));var n7,r7,i7=function(t,e){return i7=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},i7(t,e)};function s7(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}i7(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function a7(t){switch(t.toLowerCase()){case"nearest":return n7.Nearest;case"linear":return n7.Linear;case"mipmap":return n7.MipMap;case"mipmapnearestnearest":return n7.MipMapNearestNearest;case"mipmaplinearnearest":return n7.MipMapLinearNearest;case"mipmapnearestlinear":return n7.MipMapNearestLinear;case"mipmaplinearlinear":return n7.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+t)}}!function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(n7||(n7={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(r7||(r7={}));var o7=function(){function t(){this.size=null,this.names=null,this.values=null}return Object.defineProperty(t.prototype,"width",{get:function(){var t=this.texture;return t.trim?t.trim.width:t.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){var t=this.texture;return t.trim?t.trim.height:t.orig.height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"u",{get:function(){return this.texture._uvs.x0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"v",{get:function(){return this.texture._uvs.y0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"u2",{get:function(){return this.texture._uvs.x2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"v2",{get:function(){return this.texture._uvs.y2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetX",{get:function(){var t=this.texture;return t.trim?t.trim.x:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetY",{get:function(){return this.spineOffsetY},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pixiOffsetY",{get:function(){var t=this.texture;return t.trim?t.trim.y:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spineOffsetY",{get:function(){var t=this.texture;return this.originalHeight-this.height-(t.trim?t.trim.y:0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"originalWidth",{get:function(){return this.texture.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"originalHeight",{get:function(){return this.texture.orig.height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this.texture.frame.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.texture.frame.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotate",{get:function(){return 0!==this.texture.rotate},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"degrees",{get:function(){return(360-45*this.texture.rotate)%360},enumerable:!1,configurable:!0}),t}(),l7=function(){this.x=0,this.y=0,this.width=0,this.height=0,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0,this.rotate=0,this.index=0},h7=function(){function t(t,e,n){this.pages=new Array,this.regions=new Array,t&&this.addSpineAtlas(t,e,n)}return t.prototype.addTexture=function(t,e){for(var n=this.pages,r=null,i=0;i<n.length;i++)if(n[i].baseTexture===e.baseTexture){r=n[i];break}if(null===r){(r=new c7).name="texturePage";var s=e.baseTexture;r.width=s.realWidth,r.height=s.realHeight,r.baseTexture=s,r.minFilter=r.magFilter=n7.Nearest,r.uWrap=r7.ClampToEdge,r.vWrap=r7.ClampToEdge,n.push(r)}var a=new d7;return a.name=t,a.page=r,a.texture=e,a.index=-1,this.regions.push(a),a},t.prototype.addTextureHash=function(t,e){for(var n in t)t.hasOwnProperty(n)&&this.addTexture(e&&-1!==n.indexOf(".")?n.substr(0,n.lastIndexOf(".")):n,t[n])},t.prototype.addSpineAtlas=function(t,e,n){return this.load(t,e,n)},t.prototype.load=function(t,e,n){var r=this;if(null==e)throw new Error("textureLoader cannot be null.");var i=new u7(t),s=new Array(4),a=null,o={},l=null;o.size=function(){a.width=parseInt(s[1]),a.height=parseInt(s[2])},o.format=function(){},o.filter=function(){a.minFilter=a7(s[1]),a.magFilter=a7(s[2])},o.repeat=function(){-1!=s[1].indexOf("x")&&(a.uWrap=r7.Repeat),-1!=s[1].indexOf("y")&&(a.vWrap=r7.Repeat)},o.pma=function(){a.pma="true"==s[1]};for(var h={xy:function(){l.x=parseInt(s[1]),l.y=parseInt(s[2])},size:function(){l.width=parseInt(s[1]),l.height=parseInt(s[2])},bounds:function(){l.x=parseInt(s[1]),l.y=parseInt(s[2]),l.width=parseInt(s[3]),l.height=parseInt(s[4])},offset:function(){l.offsetX=parseInt(s[1]),l.offsetY=parseInt(s[2])},orig:function(){l.originalWidth=parseInt(s[1]),l.originalHeight=parseInt(s[2])},offsets:function(){l.offsetX=parseInt(s[1]),l.offsetY=parseInt(s[2]),l.originalWidth=parseInt(s[3]),l.originalHeight=parseInt(s[4])},rotate:function(){var t=s[1],e=0;e="true"==t.toLocaleLowerCase()?6:"false"==t.toLocaleLowerCase()?0:(720-parseFloat(t))%360/45,l.rotate=e},index:function(){l.index=parseInt(s[1])}},u=i.readLine();null!=u&&0==u.trim().length;)u=i.readLine();for(;null!=u&&0!=u.trim().length&&0!=i.readEntry(s,u);)u=i.readLine();var c=function(){for(;;){if(null==u)return n&&n(r);if(0==u.trim().length)a=null,u=i.readLine();else{if(null===a){for((a=new c7).name=u.trim();0!=i.readEntry(s,u=i.readLine());){(f=o[s[0]])&&f()}r.pages.push(a),e(a.name,(function(t){if(null===t)return r.pages.splice(r.pages.indexOf(a),1),n&&n(null);a.baseTexture=t,a.pma&&(t.alphaMode=fe.PMA),t.valid||t.setSize(a.width,a.height),r.pages.push(a),a.setFilters(),a.width&&a.height||(a.width=t.realWidth,a.height=t.realHeight,!a.width||a.height),c()})),r.pages.push(a);break}l=new l7;var t=new d7;t.name=u,t.page=a;for(var d=null,p=null;;){var f,m=i.readEntry(s,u=i.readLine());if(0==m)break;if(f=h[s[0]])f();else{null==d&&(d=[],p=[]),d.push(s[0]);for(var g=[],y=0;y<m;y++)g.push(parseInt(s[y+1]));p.push(g)}}0==l.originalWidth&&0==l.originalHeight&&(l.originalWidth=l.width,l.originalHeight=l.height);var v=a.baseTexture.resolution;l.x/=v,l.y/=v,l.width/=v,l.height/=v,l.originalWidth/=v,l.originalHeight/=v,l.offsetX/=v,l.offsetY/=v;var x=l.rotate%4!=0,b=new xn(l.x,l.y,x?l.height:l.width,x?l.width:l.height),w=new xn(0,0,l.originalWidth,l.originalHeight),_=new xn(l.offsetX,l.originalHeight-l.height-l.offsetY,l.width,l.height);t.texture=new Yr(t.page.baseTexture,b,w,_,l.rotate),t.index=l.index,t.texture.updateUvs(),r.regions.push(t)}}};c()},t.prototype.findRegion=function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null},t.prototype.dispose=function(){for(var t=0;t<this.pages.length;t++)this.pages[t].baseTexture.dispose()},t}(),u7=function(){function t(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}return t.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},t.prototype.readEntry=function(t,e){if(null==e)return 0;if(0==(e=e.trim()).length)return 0;var n=e.indexOf(":");if(-1==n)return 0;t[0]=e.substr(0,n).trim();for(var r=1,i=n+1;;r++){var s=e.indexOf(",",i);if(-1==s)return t[r]=e.substr(i).trim(),r;if(t[r]=e.substr(i,s-i).trim(),i=s+1,4==r)return 4}},t}(),c7=function(){function t(){this.minFilter=n7.Nearest,this.magFilter=n7.Nearest,this.uWrap=r7.ClampToEdge,this.vWrap=r7.ClampToEdge}return t.prototype.setFilters=function(){var t=this.baseTexture,e=this.minFilter;e==n7.Linear?t.scaleMode=ce.LINEAR:this.minFilter==n7.Nearest?t.scaleMode=ce.NEAREST:(t.mipmap=pe.POW2,e==n7.MipMapNearestNearest?t.scaleMode=ce.NEAREST:t.scaleMode=ce.LINEAR)},t}(),d7=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s7(e,t),e}(o7),p7=function(t){return function(e){return t[0]=e,t[0]}}(new Float32Array(1)),f7=Math.fround||p7,m7=function(){function t(){this.array=new Array}return t.prototype.add=function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e},t.prototype.contains=function(t){return null!=this.array[0|t]},t.prototype.remove=function(t){this.array[0|t]=void 0},t.prototype.clear=function(){this.array.length=0},t}(),g7=function(){function t(){this.entries={},this.size=0}return t.prototype.add=function(t){var e=this.entries[t];return this.entries[t]=!0,!e&&(this.size++,!0)},t.prototype.addAll=function(t){for(var e=this.size,n=0,r=t.length;n<r;n++)this.add(t[n]);return e!=this.size},t.prototype.contains=function(t){return this.entries[t]},t.prototype.clear=function(){this.entries={},this.size=0},t}(),y7=function(){function t(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),this.r=t,this.g=e,this.b=n,this.a=r}return t.prototype.set=function(t,e,n,r){return this.r=t,this.g=e,this.b=n,this.a=r,this.clamp()},t.prototype.setFromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.setFromString=function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=8!=t.length?1:parseInt(t.substr(6,2),16)/255,this},t.prototype.add=function(t,e,n,r){return this.r+=t,this.g+=e,this.b+=n,this.a+=r,this.clamp()},t.prototype.clamp=function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this},t.rgba8888ToColor=function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255},t.rgb888ToColor=function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255},t.fromString=function(e){return(new t).setFromString(e)},t.WHITE=new t(1,1,1,1),t.RED=new t(1,0,0,1),t.GREEN=new t(0,1,0,1),t.BLUE=new t(0,0,1,1),t.MAGENTA=new t(1,0,1,1),t}(),v7=function(){function t(){}return t.clamp=function(t,e,n){return t<e?e:t>n?n:t},t.cosDeg=function(e){return Math.cos(e*t.degRad)},t.sinDeg=function(e){return Math.sin(e*t.degRad)},t.signum=function(t){return t>0?1:t<0?-1:0},t.toInt=function(t){return t>0?Math.floor(t):Math.ceil(t)},t.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e},t.randomTriangular=function(e,n){return t.randomTriangularWith(e,n,.5*(e+n))},t.randomTriangularWith=function(t,e,n){var r=Math.random(),i=e-t;return r<=(n-t)/i?t+Math.sqrt(r*i*(n-t)):e-Math.sqrt((1-r)*i*(e-n))},t.PI=3.1415927,t.PI2=2*t.PI,t.radiansToDegrees=180/t.PI,t.radDeg=t.radiansToDegrees,t.degreesToRadians=t.PI/180,t.degRad=t.degreesToRadians,t}(),x7=function(t){function e(e){var n=t.call(this)||this;return n.power=2,n.power=e,n}return s7(e,t),e.prototype.applyInternal=function(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1},e}(function(){function t(){}return t.prototype.apply=function(t,e,n){return t+(e-t)*this.applyInternal(n)},t}()),b7=function(t){function e(e){return t.call(this,e)||this}return s7(e,t),e.prototype.applyInternal=function(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1},e}(x7),w7=function(){function t(){}return t.arrayCopy=function(t,e,n,r,i){for(var s=e,a=r;s<e+i;s++,a++)n[a]=t[s]},t.arrayFill=function(t,e,n,r){for(var i=e;i<n;i++)t[i]=r},t.setArraySize=function(t,e,n){void 0===n&&(n=0);var r=t.length;if(r==e)return t;if(t.length=e,r<e)for(var i=r;i<e;i++)t[i]=n;return t},t.ensureArrayCapacity=function(e,n,r){return void 0===r&&(r=0),e.length>=n?e:t.setArraySize(e,n,r)},t.newArray=function(t,e){for(var n=new Array(t),r=0;r<t;r++)n[r]=e;return n},t.newFloatArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);for(var n=new Array(e),r=0;r<n.length;r++)n[r]=0;return n},t.newShortArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);for(var n=new Array(e),r=0;r<n.length;r++)n[r]=0;return n},t.toFloatArray=function(e){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e},t.toSinglePrecision=function(e){return t.SUPPORTS_TYPED_ARRAYS?f7(e):e},t.webkit602BugfixHelper=function(t,e){},t.contains=function(t,e,n){for(var r=0;r<t.length;r++)if(t[r]==e)return!0;return!1},t.enumValue=function(t,e){return t[e[0].toUpperCase()+e.slice(1)]},t.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,t}(),_7=(function(){function t(){}t.logBones=function(t){for(var e=0;e<t.bones.length;e++)t.bones[e].matrix}}(),function(){function t(t){this.items=new Array,this.instantiator=t}return t.prototype.obtain=function(){return this.items.length>0?this.items.pop():this.instantiator()},t.prototype.free=function(t){t.reset&&t.reset(),this.items.push(t)},t.prototype.freeAll=function(t){for(var e=0;e<t.length;e++)this.free(t[e])},t.prototype.clear=function(){this.items.length=0},t}()),T7=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},t.prototype.normalize=function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this},t}(),E7=(function(){function t(){this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}t.prototype.update=function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)}}(),function(){function t(t){void 0===t&&(t=32),this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(t)}t.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length},t.prototype.addValue=function(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0},t.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){for(var t=0,e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0}}(),!0),S7=!1,I7=!0,k7=0,C7=[0,0,0],N7=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.region=null,e.attachment=null,e}return s7(e,t),e}(Qo),A7=function(t){function e(e,n,r,i,s){var a=t.call(this,e,n,r,i,s)||this;return a.region=null,a.attachment=null,a}return s7(e,t),e}(fu),R7=function(t){function e(e){var n=t.call(this)||this;if(!e)throw new Error("The spineData param is required.");if("string"==typeof e)throw new Error('spineData param cant be string. Please use spine.Spine.fromAtlas("YOUR_RESOURCE_NAME") from now on.');n.spineData=e,n.createSkeleton(e),n.slotContainers=[],n.tempClipContainers=[];for(var r=0,i=n.skeleton.slots.length;r<i;r++){var s=n.skeleton.slots[r],a=s.getAttachment(),o=n.newContainer();if(n.slotContainers.push(o),n.addChild(o),n.tempClipContainers.push(null),a)if(a.type===$9.Region){var l=a.region.name,h=n.createSprite(s,a,l);s.currentSprite=h,s.currentSpriteName=l,o.addChild(h)}else if(a.type===$9.Mesh){var u=n.createMesh(s,a);s.currentMesh=u,s.currentMeshId=a.id,s.currentMeshName=a.name,o.addChild(u)}else a.type===$9.Clipping&&(n.createGraphics(s,a),o.addChild(s.clippingContainer),o.addChild(s.currentGraphics))}return n.tintRgb=new Float32Array([1,1,1]),n.autoUpdate=!0,n.visible=!0,n}return s7(e,t),Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,this.updateTransform=t?e.prototype.autoUpdateTransform:or.prototype.updateTransform)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return Le(this.tintRgb)},set:function(t){this.tintRgb=Pe(t,this.tintRgb)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"delayLimit",{get:function(){return(void 0!==this.localDelayLimit?this.localDelayLimit:k7)||Number.MAX_VALUE},enumerable:!1,configurable:!0}),e.prototype.update=function(t){var e=this.delayLimit;if(t>e&&(t=e),this.state.update(t),this.state.apply(this.skeleton),this.skeleton){this.skeleton.updateWorldTransform();var n=this.skeleton.slots,r=this.color,i=null,s=null;r?(i=r.light,s=r.dark):i=this.tintRgb;for(var a=0,o=n.length;a<o;a++){var l=(I=n[a]).getAttachment(),h=this.slotContainers[a];if(l){var u=null,c=l.color;switch(l.type){case $9.Region:var d=l.region;if(d){I.currentMesh&&(I.currentMesh.visible=!1,I.currentMesh=null,I.currentMeshId=void 0,I.currentMeshName=void 0);var p=d;if(I.currentSpriteName&&I.currentSpriteName===p.name)I.currentSpriteName!==p.name||I.hackRegion||this.setSpriteRegion(l,I.currentSprite,d);else{var f=p.name;if(I.currentSprite&&(I.currentSprite.visible=!1),I.sprites=I.sprites||{},void 0!==I.sprites[f])I.sprites[f].visible=!0;else{var m=this.createSprite(I,l,f);h.addChild(m)}I.currentSprite=I.sprites[f],I.currentSpriteName=f}}h.transform.setFromMatrix(I.bone.matrix),I.currentSprite.color?u=I.currentSprite.color:(C7[0]=i[0]*I.color.r*c.r,C7[1]=i[1]*I.color.g*c.g,C7[2]=i[2]*I.color.b*c.b,I.currentSprite.tint=Le(C7)),I.currentSprite.blendMode=I.blendMode;break;case $9.Mesh:if(I.currentSprite){I.currentSprite.visible=!1,I.currentSprite=null,I.currentSpriteName=void 0;var g=new Dn;g._parentID=-1,g._worldID=h.transform._worldID,h.transform=g}var y=l.id;if(!I.currentMeshId||I.currentMeshId!==y){var v=y;if(I.currentMesh&&(I.currentMesh.visible=!1),I.meshes=I.meshes||{},void 0!==I.meshes[v])I.meshes[v].visible=!0;else{var x=this.createMesh(I,l);h.addChild(x)}I.currentMesh=I.meshes[v],I.currentMeshName=l.name,I.currentMeshId=v}l.computeWorldVerticesOld(I,I.currentMesh.vertices),I.currentMesh.color?u=I.currentMesh.color:(C7[0]=i[0]*I.color.r*c.r,C7[1]=i[1]*I.color.g*c.g,C7[2]=i[2]*I.color.b*c.b,I.currentMesh.tint=Le(C7)),I.currentMesh.blendMode=I.blendMode;break;case $9.Clipping:I.currentGraphics||(this.createGraphics(I,l),h.addChild(I.clippingContainer),h.addChild(I.currentGraphics)),this.updateGraphics(I,l),h.alpha=1,h.visible=!0;continue;default:h.visible=!1;continue}if(h.visible=!0,u){var b=I.color.r*c.r,w=I.color.g*c.g,_=I.color.b*c.b;u.setLight(i[0]*b+s[0]*(1-b),i[1]*w+s[1]*(1-w),i[2]*_+s[2]*(1-_)),I.darkColor?(b=I.darkColor.r,w=I.darkColor.g,_=I.darkColor.b):(b=0,w=0,_=0),u.setDark(i[0]*b+s[0]*(1-b),i[1]*w+s[1]*(1-w),i[2]*_+s[2]*(1-_))}h.alpha=I.color.a}else h.visible=!1}var T=this.skeleton.drawOrder,E=null,S=null;for(a=0,o=T.length;a<o;a++){var I=n[T[a].data.index];h=this.slotContainers[T[a].data.index];if(S||null!==h.parent&&h.parent!==this&&(h.parent.removeChild(h),h.parent=this),I.currentGraphics&&I.getAttachment())S=I.clippingContainer,E=I.getAttachment(),S.children.length=0,this.children[a]=h,E.endSlot===I.data&&(E.endSlot=null);else if(S){var k=this.tempClipContainers[a];k||((k=this.tempClipContainers[a]=this.newContainer()).visible=!1),this.children[a]=k,h.parent=null,S.addChild(h),E.endSlot==I.data&&(S.renderable=!0,S=null,E=null)}else this.children[a]=h}}},e.prototype.setSpriteRegion=function(t,e,n){e.attachment===t&&e.region===n||(e.region=n,e.attachment=t,e.texture=n.texture,e.rotation=t.rotation*v7.degRad,e.position.x=t.x,e.position.y=t.y,e.alpha=t.color.a,n.size?(e.scale.x=n.size.width/n.originalWidth,e.scale.y=-n.size.height/n.originalHeight):(e.scale.x=t.scaleX*t.width/n.originalWidth,e.scale.y=-t.scaleY*t.height/n.originalHeight))},e.prototype.setMeshRegion=function(t,e,n){e.attachment===t&&e.region===n||(e.region=n,e.attachment=t,e.texture=n.texture,n.texture.updateUvs(),e.uvBuffer.update(t.regionUVs))},e.prototype.autoUpdateTransform=function(){if(I7){this.lastTime=this.lastTime||Date.now();var t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.update(t)}else this.lastTime=0;or.prototype.updateTransform.call(this)},e.prototype.createSprite=function(t,e,n){var r=e.region;t.hackAttachment===e&&(r=t.hackRegion);var i=r.texture,s=this.newSprite(i);return s.anchor.set(.5),this.setSpriteRegion(e,s,e.region),t.sprites=t.sprites||{},t.sprites[n]=s,s},e.prototype.createMesh=function(t,e){var n=e.region;t.hackAttachment===e&&(n=t.hackRegion,t.hackAttachment=null,t.hackRegion=null);var r=this.newMesh(n.texture,new Float32Array(e.regionUVs.length),e.regionUVs,new Uint16Array(e.triangles),ae.TRIANGLES);return void 0!==r._canvasPadding&&(r._canvasPadding=1.5),r.alpha=e.color.a,r.region=e.region,this.setMeshRegion(e,r,n),t.meshes=t.meshes||{},t.meshes[e.id]=r,r},e.prototype.createGraphics=function(t,e){var n=this.newGraphics(),r=new _n([]);return n.clear(),n.beginFill(16777215,1),n.drawPolygon(r),n.renderable=!1,t.currentGraphics=n,t.clippingContainer=this.newContainer(),t.clippingContainer.mask=t.currentGraphics,n},e.prototype.updateGraphics=function(t,e){var n=t.currentGraphics.geometry,r=n.graphicsData[0].shape.points,i=e.worldVerticesLength;r.length=i,e.computeWorldVertices(t,0,i,r,0,2),n.invalidate()},e.prototype.hackTextureBySlotIndex=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=null);var r=this.skeleton.slots[t];if(!r)return!1;var i=r.getAttachment(),s=i.region;return e?((s=new o7).texture=e,s.size=n,r.hackRegion=s,r.hackAttachment=i):(r.hackRegion=null,r.hackAttachment=null),r.currentSprite&&r.currentSprite.region!=s?(this.setSpriteRegion(i,r.currentSprite,s),r.currentSprite.region=s):r.currentMesh&&r.currentMesh.region!=s&&this.setMeshRegion(i,r.currentMesh,s),!0},e.prototype.hackTextureBySlotName=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=null);var r=this.skeleton.findSlotIndex(t);return-1!=r&&this.hackTextureBySlotIndex(r,e,n)},e.prototype.hackTextureAttachment=function(t,e,n,r){void 0===r&&(r=null);var i=this.skeleton.findSlotIndex(t),s=this.skeleton.getAttachmentByName(t,e);s.region.texture=n;var a=this.skeleton.slots[i];if(!a)return!1;var o=a.getAttachment();if(e===o.name){var l=s.region;return n?((l=new o7).texture=n,l.size=r,a.hackRegion=l,a.hackAttachment=o):(a.hackRegion=null,a.hackAttachment=null),a.currentSprite&&a.currentSprite.region!=l?(this.setSpriteRegion(o,a.currentSprite,l),a.currentSprite.region=l):a.currentMesh&&a.currentMesh.region!=l&&this.setMeshRegion(o,a.currentMesh,l),!0}return!1},e.prototype.newContainer=function(){return new or},e.prototype.newSprite=function(t){return new N7(t)},e.prototype.newGraphics=function(){return new Yo},e.prototype.newMesh=function(t,e,n,r,i){return new A7(t,e,n,r,i)},e.prototype.transformHack=function(){return 1},e.prototype.hackAttachmentGroups=function(t,e,n){if(t){for(var r=[],i=[],s=0,a=this.skeleton.slots.length;s<a;s++){var o=this.skeleton.slots[s],l=o.currentSpriteName||o.currentMeshName||"",h=o.currentSprite||o.currentMesh;l.endsWith(t)?(h.parentGroup=e,i.push(h)):n&&h&&(h.parentGroup=n,r.push(h))}return[r,i]}},e.prototype.destroy=function(e){for(var n=0,r=this.skeleton.slots.length;n<r;n++){var i=this.skeleton.slots[n];for(var s in i.meshes)i.meshes[s].destroy(e);for(var a in i.meshes=null,i.sprites)i.sprites[a].destroy(e);i.sprites=null}for(n=0,r=this.slotContainers.length;n<r;n++)this.slotContainers[n].destroy(e);this.spineData=null,this.skeleton=null,this.slotContainers=null,this.stateData=null,this.state=null,this.tempClipContainers=null,t.prototype.destroy.call(this,e)},e.clippingPolygon=[],e}(or);Object.defineProperty(R7.prototype,"visible",{get:function(){return this._visible},set:function(t){t!==this._visible&&(this._visible=t,t&&(this.lastTime=0))}}),la.setExtensionXhrType("skel",la.XHR_RESPONSE_TYPE.BUFFER);var M7=function(){function t(){}return t.prototype.genMiddleware=function(){var t=this;return{use:function(e,n){if(!e.data)return n();var r=function(t){return t.type===la.TYPE.JSON}(e)&&e.data.bones,i=function(t){return t.xhrType===la.XHR_RESPONSE_TYPE.BUFFER}(e)&&("skel"===e.extension||e.metadata&&e.metadata.spineMetadata);if(!r&&!i)return n();var s=null,a=e.data;r?s=t.createJsonParser():(s=t.createBinaryParser(),e.data instanceof ArrayBuffer&&(a=new Uint8Array(e.data)));var o=e.metadata||{},l=o?o.spineSkeletonScale:null;l&&(s.scale=l);var h=o.spineAtlas;if(!1===h)return n();if(h&&h.pages)return t.parseData(e,s,h,a),n();var u=o.spineAtlasSuffix||".atlas",c=e.url,d=c.indexOf("?");d>0&&(c=c.substr(0,d)),c=c.substr(0,c.lastIndexOf("."))+u,o.spineAtlasFile&&(c=o.spineAtlasFile),c=c.replace(this.baseUrl,"");var p={crossOrigin:e.crossOrigin,xhrType:la.XHR_RESPONSE_TYPE.TEXT,metadata:o.spineMetadata||null,parentResource:e},f={crossOrigin:e.crossOrigin,metadata:o.imageMetadata||null,parentResource:e},m=e.url.substr(0,e.url.lastIndexOf("/")+1);m=m.replace(this.baseUrl,"");var g=o.imageNamePrefix||e.name+"_atlas_page_",y=o.images?O7(o.images):o.image?O7({default:o.image}):o.imageLoader?o.imageLoader(this,g,m,f):function(t,e,n,r){n&&n.lastIndexOf("/")!==n.length-1&&(n+="/");return function(i,s){var a=e+i,o=n+i,l=t.resources[a];if(l){var h=function(){s(l.texture.baseTexture)};l.texture?h():l.onAfterMiddleware.add(h)}else t.add(a,o,r,(function(t){t.error?s(null):(i.indexOf("-pma.")>=0&&(t.texture.baseTexture.alphaMode=fe.PMA),s(t.texture.baseTexture))}))}}(this,g,m,f);function v(r){new h7(r,y,(function(r){r&&t.parseData(e,s,r,a),n()}))}o.atlasRawData?v(o.atlasRawData):this.add(e.name+"_atlas",c,p,(function(t){t.error?n():v(t.data)}))}}},t}();function O7(t){return function(e,n){var r=t[e]||t.default;r&&r.baseTexture?n(r.baseTexture):n(r)}}var P7=function(t,e){return P7=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},P7(t,e)};function D7(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}P7(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var F7,L7=function(t){if(null==t)throw new Error("name cannot be null.");this.name=t},B7=function(t){function e(n){var r=t.call(this,n)||this;return r.id=(65535&e.nextID++)<<11,r.worldVerticesLength=0,r.deformAttachment=r,r}return D7(e,t),e.prototype.computeWorldVerticesOld=function(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)},e.prototype.computeWorldVertices=function(t,e,n,r,i,s){n=i+(n>>1)*s;var a=t.bone.skeleton,o=t.deform,l=this.vertices,h=this.bones;if(null!=h){for(var u=0,c=0,d=0;d<e;d+=2){u+=(g=h[u])+1,c+=g}var p=a.bones;if(0==o.length)for(C=i,E=3*c;C<n;C+=s){var f=0,m=0,g=h[u++];for(g+=u;u<g;u++,E+=3){b=p[h[u]].matrix,N=l[E],A=l[E+1];var y=l[E+2];f+=(N*b.a+A*b.c+b.tx)*y,m+=(N*b.b+A*b.d+b.ty)*y}r[C]=f,r[C+1]=m}else for(var v=o,x=(C=i,E=3*c,c<<1);C<n;C+=s){f=0,m=0,g=h[u++];for(g+=u;u<g;u++,E+=3,x+=2){b=p[h[u]].matrix,N=l[E]+v[x],A=l[E+1]+v[x+1],y=l[E+2];f+=(N*b.a+A*b.c+b.tx)*y,m+=(N*b.b+A*b.d+b.ty)*y}r[C]=f,r[C+1]=m}}else{o.length>0&&(l=o);for(var b,w=(b=t.bone.matrix).tx,_=b.ty,T=b.a,E=b.c,S=b.b,I=b.d,k=e,C=i;C<n;k+=2,C+=s){var N=l[k],A=l[k+1];r[C]=N*T+A*E+w,r[C+1]=N*S+A*I+_}}},e.prototype.copyTo=function(t){null!=this.bones?(t.bones=new Array(this.bones.length),w7.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,null!=this.vertices?(t.vertices=w7.newFloatArray(this.vertices.length),w7.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment},e.nextID=0,e}(L7),$7=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.BoundingBox,n.color=new y7(1,1,1,1),n}return D7(e,t),e.prototype.copy=function(){var t=new e(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t},e}(B7),U7=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.Clipping,n.color=new y7(.2275,.2275,.8078,1),n}return D7(e,t),e.prototype.copy=function(){var t=new e(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t},e}(B7),V7=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.Mesh,n.color=new y7(1,1,1,1),n.tempColor=new y7(0,0,0,0),n}return D7(e,t),e.prototype.getParentMesh=function(){return this.parentMesh},e.prototype.setParentMesh=function(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)},e.prototype.copy=function(){if(null!=this.parentMesh)return this.newLinkedMesh();var t=new e(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Float32Array(this.regionUVs.length),w7.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.triangles=new Array(this.triangles.length),w7.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,null!=this.edges&&(t.edges=new Array(this.edges.length),w7.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t},e.prototype.newLinkedMesh=function(){var t=new e(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t},e}(B7),z7=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.Path,n.closed=!1,n.constantSpeed=!1,n.color=new y7(1,1,1,1),n}return D7(e,t),e.prototype.copy=function(){var t=new e(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),w7.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t},e}(B7),G7=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.Point,n.color=new y7(.38,.94,0,1),n}return D7(e,t),e.prototype.computeWorldPosition=function(t,e){var n=t.matrix;return e.x=this.x*n.a+this.y*n.c+t.worldX,e.y=this.x*n.b+this.y*n.d+t.worldY,e},e.prototype.computeWorldRotation=function(t){var e=t.matrix,n=v7.cosDeg(this.rotation),r=v7.sinDeg(this.rotation),i=n*e.a+r*e.c,s=n*e.b+r*e.d;return Math.atan2(s,i)*v7.radDeg},e.prototype.copy=function(){var t=new e(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t},e}(B7),W7=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.Region,n.x=0,n.y=0,n.scaleX=1,n.scaleY=1,n.rotation=0,n.width=0,n.height=0,n.color=new y7(1,1,1,1),n.offset=w7.newFloatArray(8),n.uvs=w7.newFloatArray(8),n.tempColor=new y7(1,1,1,1),n}return D7(e,t),e.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX,n=this.height/this.region.originalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.region.offsetX*t,i=-this.height/2*this.scaleY+this.region.offsetY*n,s=r+this.region.width*t,a=i+this.region.height*n,o=this.rotation*Math.PI/180,l=Math.cos(o),h=Math.sin(o),u=r*l+this.x,c=r*h,d=i*l+this.y,p=i*h,f=s*l+this.x,m=s*h,g=a*l+this.y,y=a*h,v=this.offset;v[e.OX1]=u-p,v[e.OY1]=d+c,v[e.OX2]=u-y,v[e.OY2]=g+c,v[e.OX3]=f-y,v[e.OY3]=g+m,v[e.OX4]=f-p,v[e.OY4]=d+m},e.prototype.setRegion=function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)},e.prototype.computeWorldVertices=function(t,n,r,i){var s=this.offset,a=t.matrix,o=a.tx,l=a.ty,h=a.a,u=a.c,c=a.b,d=a.d,p=0,f=0;p=s[e.OX1],f=s[e.OY1],n[r]=p*h+f*u+o,n[r+1]=p*c+f*d+l,r+=i,p=s[e.OX2],f=s[e.OY2],n[r]=p*h+f*u+o,n[r+1]=p*c+f*d+l,r+=i,p=s[e.OX3],f=s[e.OY3],n[r]=p*h+f*u+o,n[r+1]=p*c+f*d+l,r+=i,p=s[e.OX4],f=s[e.OY4],n[r]=p*h+f*u+o,n[r+1]=p*c+f*d+l},e.prototype.copy=function(){var t=new e(this.name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,w7.arrayCopy(this.uvs,0,t.uvs,0,8),w7.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t},e.OX1=0,e.OY1=1,e.OX2=2,e.OY2=3,e.OX3=4,e.OY3=5,e.OX4=6,e.OY4=7,e.X1=0,e.Y1=1,e.C1R=2,e.C1G=3,e.C1B=4,e.C1A=5,e.U1=6,e.V1=7,e.X2=8,e.Y2=9,e.C2R=10,e.C2G=11,e.C2B=12,e.C2A=13,e.U2=14,e.V2=15,e.X3=16,e.Y3=17,e.C3R=18,e.C3G=19,e.C3B=20,e.C3A=21,e.U3=22,e.V3=23,e.X4=24,e.Y4=25,e.C4R=26,e.C4G=27,e.C4B=28,e.C4A=29,e.U4=30,e.V4=31,e}(L7),X7=function(){function t(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}return t.prototype.begin=function(t){},t.prototype.transform=function(t,e,n,r){t.x+=v7.randomTriangular(-this.jitterX,this.jitterY),t.y+=v7.randomTriangular(-this.jitterX,this.jitterY)},t.prototype.end=function(){},t}(),H7=function(){function t(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}return t.prototype.begin=function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY},t.prototype.transform=function(e,n,r,i){var s=this.angle*v7.degreesToRadians,a=e.x-this.worldX,o=e.y-this.worldY,l=Math.sqrt(a*a+o*o);if(l<this.radius){var h=t.interpolation.apply(0,s,(this.radius-l)/this.radius),u=Math.cos(h),c=Math.sin(h);e.x=u*a-c*o+this.worldX,e.y=c*a+u*o+this.worldY}},t.prototype.end=function(){},t.interpolation=new b7(2),t}(),Y7=function(){function t(t,e,n){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(var r=0;r<e.length;r++)this.timelineIds[e[r].getPropertyId()]=!0;this.duration=n}return t.prototype.hasTimeline=function(t){return 1==this.timelineIds[t]},t.prototype.apply=function(t,e,n,r,i,s,a,o){if(null==t)throw new Error("skeleton cannot be null.");r&&0!=this.duration&&(n%=this.duration,e>0&&(e%=this.duration));for(var l=this.timelines,h=0,u=l.length;h<u;h++)l[h].apply(t,e,n,i,s,a,o)},t.binarySearch=function(t,e,n){void 0===n&&(n=1);var r=0,i=t.length/n-2;if(0==i)return n;for(var s=i>>>1;;){if(t[(s+1)*n]<=e?r=s+1:i=s,r==i)return(r+1)*n;s=r+i>>>1}},t.linearSearch=function(t,e,n){for(var r=0,i=t.length-n;r<=i;r+=n)if(t[r]>e)return r;return-1},t}();!function(t){t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor"}(F7||(F7={}));var j7,q7=function(){function t(e){if(e<=0)throw new Error("frameCount must be > 0: "+e);this.curves=w7.newFloatArray((e-1)*t.BEZIER_SIZE)}return t.prototype.getFrameCount=function(){return this.curves.length/t.BEZIER_SIZE+1},t.prototype.setLinear=function(e){this.curves[e*t.BEZIER_SIZE]=t.LINEAR},t.prototype.setStepped=function(e){this.curves[e*t.BEZIER_SIZE]=t.STEPPED},t.prototype.getCurveType=function(e){var n=e*t.BEZIER_SIZE;if(n==this.curves.length)return t.LINEAR;var r=this.curves[n];return r==t.LINEAR?t.LINEAR:r==t.STEPPED?t.STEPPED:t.BEZIER},t.prototype.setCurve=function(e,n,r,i,s){var a=.03*(2*-n+i),o=.03*(2*-r+s),l=.006*(3*(n-i)+1),h=.006*(3*(r-s)+1),u=2*a+l,c=2*o+h,d=.3*n+a+.16666667*l,p=.3*r+o+.16666667*h,f=e*t.BEZIER_SIZE,m=this.curves;m[f++]=t.BEZIER;for(var g=d,y=p,v=f+t.BEZIER_SIZE-1;f<v;f+=2)m[f]=g,m[f+1]=y,d+=u,p+=c,u+=l,c+=h,g+=d,y+=p},t.prototype.getCurvePercent=function(e,n){n=v7.clamp(n,0,1);var r=this.curves,i=e*t.BEZIER_SIZE,s=r[i];if(s==t.LINEAR)return n;if(s==t.STEPPED)return 0;for(var a=0,o=++i,l=i+t.BEZIER_SIZE-1;i<l;i+=2)if((a=r[i])>=n){var h=void 0,u=void 0;return i==o?(h=0,u=0):(h=r[i-2],u=r[i-1]),u+(r[i+1]-u)*(n-h)/(a-h)}var c=r[i-1];return c+(1-c)*(n-a)/(1-a)},t.LINEAR=0,t.STEPPED=1,t.BEZIER=2,t.BEZIER_SIZE=19,t}(),K7=function(t){function e(e){var n=t.call(this,e)||this;return n.frames=w7.newFloatArray(e<<1),n}return D7(e,t),e.prototype.getPropertyId=function(){return(F7.rotate<<24)+this.boneIndex},e.prototype.setFrame=function(t,n,r){t<<=1,this.frames[t]=n,this.frames[t+e.ROTATION]=r},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.bones[this.boneIndex];if(h.active)if(r<l[0])switch(a){case K9.setup:return void(h.rotation=h.data.rotation);case K9.first:var u=h.data.rotation-h.rotation;h.rotation+=(u-360*(16384-(16384.499999999996-u/360|0)))*s}else if(r>=l[l.length-e.ENTRIES]){var c=l[l.length+e.PREV_ROTATION];switch(a){case K9.setup:h.rotation=h.data.rotation+c*s;break;case K9.first:case K9.replace:c+=h.data.rotation-h.rotation,c-=360*(16384-(16384.499999999996-c/360|0));case K9.add:h.rotation+=c*s}}else{var d=Y7.binarySearch(l,r,e.ENTRIES),p=l[d+e.PREV_ROTATION],f=l[d],m=this.getCurvePercent((d>>1)-1,1-(r-f)/(l[d+e.PREV_TIME]-f)),g=l[d+e.ROTATION]-p;switch(g=p+(g-360*(16384-(16384.499999999996-g/360|0)))*m,a){case K9.setup:h.rotation=h.data.rotation+(g-360*(16384-(16384.499999999996-g/360|0)))*s;break;case K9.first:case K9.replace:g+=h.data.rotation-h.rotation;case K9.add:h.rotation+=(g-360*(16384-(16384.499999999996-g/360|0)))*s}}},e.ENTRIES=2,e.PREV_TIME=-2,e.PREV_ROTATION=-1,e.ROTATION=1,e}(q7),Z7=function(t){function e(n){var r=t.call(this,n)||this;return r.frames=w7.newFloatArray(n*e.ENTRIES),r}return D7(e,t),e.prototype.getPropertyId=function(){return(F7.translate<<24)+this.boneIndex},e.prototype.setFrame=function(t,n,r,i){t*=e.ENTRIES,this.frames[t]=n,this.frames[t+e.X]=r,this.frames[t+e.Y]=i},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.bones[this.boneIndex];if(h.active)if(r<l[0])switch(a){case K9.setup:return h.x=h.data.x,void(h.y=h.data.y);case K9.first:h.x+=(h.data.x-h.x)*s,h.y+=(h.data.y-h.y)*s}else{var u=0,c=0;if(r>=l[l.length-e.ENTRIES])u=l[l.length+e.PREV_X],c=l[l.length+e.PREV_Y];else{var d=Y7.binarySearch(l,r,e.ENTRIES);u=l[d+e.PREV_X],c=l[d+e.PREV_Y];var p=l[d],f=this.getCurvePercent(d/e.ENTRIES-1,1-(r-p)/(l[d+e.PREV_TIME]-p));u+=(l[d+e.X]-u)*f,c+=(l[d+e.Y]-c)*f}switch(a){case K9.setup:h.x=h.data.x+u*s,h.y=h.data.y+c*s;break;case K9.first:case K9.replace:h.x+=(h.data.x+u-h.x)*s,h.y+=(h.data.y+c-h.y)*s;break;case K9.add:h.x+=u*s,h.y+=c*s}}},e.ENTRIES=3,e.PREV_TIME=-3,e.PREV_X=-2,e.PREV_Y=-1,e.X=1,e.Y=2,e}(q7),J7=function(t){function e(e){return t.call(this,e)||this}return D7(e,t),e.prototype.getPropertyId=function(){return(F7.scale<<24)+this.boneIndex},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.bones[this.boneIndex];if(h.active)if(r<l[0])switch(a){case K9.setup:return h.scaleX=h.data.scaleX,void(h.scaleY=h.data.scaleY);case K9.first:h.scaleX+=(h.data.scaleX-h.scaleX)*s,h.scaleY+=(h.data.scaleY-h.scaleY)*s}else{var u=0,c=0;if(r>=l[l.length-e.ENTRIES])u=l[l.length+e.PREV_X]*h.data.scaleX,c=l[l.length+e.PREV_Y]*h.data.scaleY;else{var d=Y7.binarySearch(l,r,e.ENTRIES);u=l[d+e.PREV_X],c=l[d+e.PREV_Y];var p=l[d],f=this.getCurvePercent(d/e.ENTRIES-1,1-(r-p)/(l[d+e.PREV_TIME]-p));u=(u+(l[d+e.X]-u)*f)*h.data.scaleX,c=(c+(l[d+e.Y]-c)*f)*h.data.scaleY}if(1==s)a==K9.add?(h.scaleX+=u-h.data.scaleX,h.scaleY+=c-h.data.scaleY):(h.scaleX=u,h.scaleY=c);else{var m=0,g=0;if(o==Z9.mixOut)switch(a){case K9.setup:m=h.data.scaleX,g=h.data.scaleY,h.scaleX=m+(Math.abs(u)*v7.signum(m)-m)*s,h.scaleY=g+(Math.abs(c)*v7.signum(g)-g)*s;break;case K9.first:case K9.replace:m=h.scaleX,g=h.scaleY,h.scaleX=m+(Math.abs(u)*v7.signum(m)-m)*s,h.scaleY=g+(Math.abs(c)*v7.signum(g)-g)*s;break;case K9.add:m=h.scaleX,g=h.scaleY,h.scaleX=m+(Math.abs(u)*v7.signum(m)-h.data.scaleX)*s,h.scaleY=g+(Math.abs(c)*v7.signum(g)-h.data.scaleY)*s}else switch(a){case K9.setup:m=Math.abs(h.data.scaleX)*v7.signum(u),g=Math.abs(h.data.scaleY)*v7.signum(c),h.scaleX=m+(u-m)*s,h.scaleY=g+(c-g)*s;break;case K9.first:case K9.replace:m=Math.abs(h.scaleX)*v7.signum(u),g=Math.abs(h.scaleY)*v7.signum(c),h.scaleX=m+(u-m)*s,h.scaleY=g+(c-g)*s;break;case K9.add:m=v7.signum(u),g=v7.signum(c),h.scaleX=Math.abs(h.scaleX)*m+(u-Math.abs(h.data.scaleX)*m)*s,h.scaleY=Math.abs(h.scaleY)*g+(c-Math.abs(h.data.scaleY)*g)*s}}}},e}(Z7),Q7=function(t){function e(e){return t.call(this,e)||this}return D7(e,t),e.prototype.getPropertyId=function(){return(F7.shear<<24)+this.boneIndex},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.bones[this.boneIndex];if(h.active)if(r<l[0])switch(a){case K9.setup:return h.shearX=h.data.shearX,void(h.shearY=h.data.shearY);case K9.first:h.shearX+=(h.data.shearX-h.shearX)*s,h.shearY+=(h.data.shearY-h.shearY)*s}else{var u=0,c=0;if(r>=l[l.length-e.ENTRIES])u=l[l.length+e.PREV_X],c=l[l.length+e.PREV_Y];else{var d=Y7.binarySearch(l,r,e.ENTRIES);u=l[d+e.PREV_X],c=l[d+e.PREV_Y];var p=l[d],f=this.getCurvePercent(d/e.ENTRIES-1,1-(r-p)/(l[d+e.PREV_TIME]-p));u+=(l[d+e.X]-u)*f,c+=(l[d+e.Y]-c)*f}switch(a){case K9.setup:h.shearX=h.data.shearX+u*s,h.shearY=h.data.shearY+c*s;break;case K9.first:case K9.replace:h.shearX+=(h.data.shearX+u-h.shearX)*s,h.shearY+=(h.data.shearY+c-h.shearY)*s;break;case K9.add:h.shearX+=u*s,h.shearY+=c*s}}},e}(Z7),ttt=function(t){function e(n){var r=t.call(this,n)||this;return r.frames=w7.newFloatArray(n*e.ENTRIES),r}return D7(e,t),e.prototype.getPropertyId=function(){return(F7.color<<24)+this.slotIndex},e.prototype.setFrame=function(t,n,r,i,s,a){t*=e.ENTRIES,this.frames[t]=n,this.frames[t+e.R]=r,this.frames[t+e.G]=i,this.frames[t+e.B]=s,this.frames[t+e.A]=a},e.prototype.apply=function(t,n,r,i,s,a,o){var l=t.slots[this.slotIndex];if(l.bone.active){var h=this.frames;if(r<h[0])switch(a){case K9.setup:return void l.color.setFromColor(l.data.color);case K9.first:var u=l.color,c=l.data.color;u.add((c.r-u.r)*s,(c.g-u.g)*s,(c.b-u.b)*s,(c.a-u.a)*s)}else{var d=0,p=0,f=0,m=0;if(r>=h[h.length-e.ENTRIES]){var g=h.length;d=h[g+e.PREV_R],p=h[g+e.PREV_G],f=h[g+e.PREV_B],m=h[g+e.PREV_A]}else{var y=Y7.binarySearch(h,r,e.ENTRIES);d=h[y+e.PREV_R],p=h[y+e.PREV_G],f=h[y+e.PREV_B],m=h[y+e.PREV_A];var v=h[y],x=this.getCurvePercent(y/e.ENTRIES-1,1-(r-v)/(h[y+e.PREV_TIME]-v));d+=(h[y+e.R]-d)*x,p+=(h[y+e.G]-p)*x,f+=(h[y+e.B]-f)*x,m+=(h[y+e.A]-m)*x}if(1==s)l.color.set(d,p,f,m);else{u=l.color;a==K9.setup&&u.setFromColor(l.data.color),u.add((d-u.r)*s,(p-u.g)*s,(f-u.b)*s,(m-u.a)*s)}}}},e.ENTRIES=5,e.PREV_TIME=-5,e.PREV_R=-4,e.PREV_G=-3,e.PREV_B=-2,e.PREV_A=-1,e.R=1,e.G=2,e.B=3,e.A=4,e}(q7),ett=function(t){function e(n){var r=t.call(this,n)||this;return r.frames=w7.newFloatArray(n*e.ENTRIES),r}return D7(e,t),e.prototype.getPropertyId=function(){return(F7.twoColor<<24)+this.slotIndex},e.prototype.setFrame=function(t,n,r,i,s,a,o,l,h){t*=e.ENTRIES,this.frames[t]=n,this.frames[t+e.R]=r,this.frames[t+e.G]=i,this.frames[t+e.B]=s,this.frames[t+e.A]=a,this.frames[t+e.R2]=o,this.frames[t+e.G2]=l,this.frames[t+e.B2]=h},e.prototype.apply=function(t,n,r,i,s,a,o){var l=t.slots[this.slotIndex];if(l.bone.active){var h=this.frames;if(r<h[0])switch(a){case K9.setup:return l.color.setFromColor(l.data.color),void l.darkColor.setFromColor(l.data.darkColor);case K9.first:var u=l.color,c=l.darkColor,d=l.data.color,p=l.data.darkColor;u.add((d.r-u.r)*s,(d.g-u.g)*s,(d.b-u.b)*s,(d.a-u.a)*s),c.add((p.r-c.r)*s,(p.g-c.g)*s,(p.b-c.b)*s,0)}else{var f=0,m=0,g=0,y=0,v=0,x=0,b=0;if(r>=h[h.length-e.ENTRIES]){var w=h.length;f=h[w+e.PREV_R],m=h[w+e.PREV_G],g=h[w+e.PREV_B],y=h[w+e.PREV_A],v=h[w+e.PREV_R2],x=h[w+e.PREV_G2],b=h[w+e.PREV_B2]}else{var _=Y7.binarySearch(h,r,e.ENTRIES);f=h[_+e.PREV_R],m=h[_+e.PREV_G],g=h[_+e.PREV_B],y=h[_+e.PREV_A],v=h[_+e.PREV_R2],x=h[_+e.PREV_G2],b=h[_+e.PREV_B2];var T=h[_],E=this.getCurvePercent(_/e.ENTRIES-1,1-(r-T)/(h[_+e.PREV_TIME]-T));f+=(h[_+e.R]-f)*E,m+=(h[_+e.G]-m)*E,g+=(h[_+e.B]-g)*E,y+=(h[_+e.A]-y)*E,v+=(h[_+e.R2]-v)*E,x+=(h[_+e.G2]-x)*E,b+=(h[_+e.B2]-b)*E}if(1==s)l.color.set(f,m,g,y),l.darkColor.set(v,x,b,1);else{u=l.color,c=l.darkColor;a==K9.setup&&(u.setFromColor(l.data.color),c.setFromColor(l.data.darkColor)),u.add((f-u.r)*s,(m-u.g)*s,(g-u.b)*s,(y-u.a)*s),c.add((v-c.r)*s,(x-c.g)*s,(b-c.b)*s,0)}}}},e.ENTRIES=8,e.PREV_TIME=-8,e.PREV_R=-7,e.PREV_G=-6,e.PREV_B=-5,e.PREV_A=-4,e.PREV_R2=-3,e.PREV_G2=-2,e.PREV_B2=-1,e.R=1,e.G=2,e.B=3,e.A=4,e.R2=5,e.G2=6,e.B2=7,e}(q7),ntt=function(){function t(t){this.frames=w7.newFloatArray(t),this.attachmentNames=new Array(t)}return t.prototype.getPropertyId=function(){return(F7.attachment<<24)+this.slotIndex},t.prototype.getFrameCount=function(){return this.frames.length},t.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.attachmentNames[t]=n},t.prototype.apply=function(t,e,n,r,i,s,a){var o=t.slots[this.slotIndex];if(o.bone.active)if(a!=Z9.mixOut){var l=this.frames;if(n<l[0])s!=K9.setup&&s!=K9.first||this.setAttachment(t,o,o.data.attachmentName);else{var h=0;h=n>=l[l.length-1]?l.length-1:Y7.binarySearch(l,n,1)-1;var u=this.attachmentNames[h];t.slots[this.slotIndex].setAttachment(null==u?null:t.getAttachment(this.slotIndex,u))}}else s==K9.setup&&this.setAttachment(t,o,o.data.attachmentName)},t.prototype.setAttachment=function(t,e,n){e.setAttachment(null==n?null:t.getAttachment(this.slotIndex,n))},t}(),rtt=null,itt=function(t){function e(e){var n=t.call(this,e)||this;return n.frames=w7.newFloatArray(e),n.frameVertices=new Array(e),null==rtt&&(rtt=w7.newFloatArray(64)),n}return D7(e,t),e.prototype.getPropertyId=function(){return(F7.deform<<27)+ +this.attachment.id+this.slotIndex},e.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.frameVertices[t]=n},e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.slots[this.slotIndex];if(o.bone.active){var l=o.getAttachment();if(l instanceof B7&&l.deformAttachment==this.attachment){var h=o.deform;0==h.length&&(s=K9.setup);var u=this.frameVertices,c=u[0].length,d=this.frames;if(n<d[0]){var p=l;switch(s){case K9.setup:return void(h.length=0);case K9.first:if(1==i){h.length=0;break}var f=w7.setArraySize(h,c);if(null==p.bones)for(var m=p.vertices,g=0;g<c;g++)f[g]+=(m[g]-f[g])*i;else{i=1-i;for(g=0;g<c;g++)f[g]*=i}}}else{var y=w7.setArraySize(h,c);if(n>=d[d.length-1]){var v=u[d.length-1];if(1==i)if(s==K9.add)if(null==(p=l).bones){m=p.vertices;for(var x=0;x<c;x++)y[x]+=v[x]-m[x]}else for(var b=0;b<c;b++)y[b]+=v[b];else w7.arrayCopy(v,0,y,0,c);else switch(s){case K9.setup:var w=l;if(null==w.bones){m=w.vertices;for(var _=0;_<c;_++){var T=m[_];y[_]=T+(v[_]-T)*i}}else for(var E=0;E<c;E++)y[E]=v[E]*i;break;case K9.first:case K9.replace:for(var S=0;S<c;S++)y[S]+=(v[S]-y[S])*i;break;case K9.add:if(null==(p=l).bones){m=p.vertices;for(var I=0;I<c;I++)y[I]+=(v[I]-m[I])*i}else for(var k=0;k<c;k++)y[k]+=v[k]*i}}else{var C=Y7.binarySearch(d,n),N=u[C-1],A=u[C],R=d[C],M=this.getCurvePercent(C-1,1-(n-R)/(d[C-1]-R));if(1==i)if(s==K9.add)if(null==(p=l).bones){m=p.vertices;for(var O=0;O<c;O++){var P=N[O];y[O]+=P+(A[O]-P)*M-m[O]}}else for(var D=0;D<c;D++){P=N[D];y[D]+=P+(A[D]-P)*M}else for(var F=0;F<c;F++){P=N[F];y[F]=P+(A[F]-P)*M}else switch(s){case K9.setup:var L=l;if(null==L.bones){m=L.vertices;for(var B=0;B<c;B++){P=N[B],T=m[B];y[B]=T+(P+(A[B]-P)*M-T)*i}}else for(var $=0;$<c;$++){P=N[$];y[$]=(P+(A[$]-P)*M)*i}break;case K9.first:case K9.replace:for(var U=0;U<c;U++){P=N[U];y[U]+=(P+(A[U]-P)*M-y[U])*i}break;case K9.add:if(null==(p=l).bones){m=p.vertices;for(var V=0;V<c;V++){P=N[V];y[V]+=(P+(A[V]-P)*M-m[V])*i}}else for(var z=0;z<c;z++){P=N[z];y[z]+=(P+(A[z]-P)*M)*i}}}}}}},e}(q7),stt=function(){function t(t){this.frames=w7.newFloatArray(t),this.events=new Array(t)}return t.prototype.getPropertyId=function(){return F7.event<<24},t.prototype.getFrameCount=function(){return this.frames.length},t.prototype.setFrame=function(t,e){this.frames[t]=e.time,this.events[t]=e},t.prototype.apply=function(t,e,n,r,i,s,a){if(null!=r){var o=this.frames,l=this.frames.length;if(e>n)this.apply(t,e,Number.MAX_VALUE,r,i,s,a),e=-1;else if(e>=o[l-1])return;if(!(n<o[0])){var h=0;if(e<o[0])h=0;else for(var u=o[h=Y7.binarySearch(o,e)];h>0&&o[h-1]==u;)h--;for(;h<l&&n>=o[h];h++)r.push(this.events[h])}}},t}(),att=function(){function t(t){this.frames=w7.newFloatArray(t),this.drawOrders=new Array(t)}return t.prototype.getPropertyId=function(){return F7.drawOrder<<24},t.prototype.getFrameCount=function(){return this.frames.length},t.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.drawOrders[t]=n},t.prototype.apply=function(t,e,n,r,i,s,a){var o=t.drawOrder,l=t.slots;if(a!=Z9.mixOut||s!=K9.setup){var h=this.frames;if(n<h[0])s!=K9.setup&&s!=K9.first||w7.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);else{var u=0;u=n>=h[h.length-1]?h.length-1:Y7.binarySearch(h,n)-1;var c=this.drawOrders[u];if(null==c)w7.arrayCopy(l,0,o,0,l.length);else for(var d=0,p=c.length;d<p;d++)o[d]=l[c[d]]}}else w7.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)},t}(),ott=function(t){function e(n){var r=t.call(this,n)||this;return r.frames=w7.newFloatArray(n*e.ENTRIES),r}return D7(e,t),e.prototype.getPropertyId=function(){return(F7.ikConstraint<<24)+this.ikConstraintIndex},e.prototype.setFrame=function(t,n,r,i,s,a,o){t*=e.ENTRIES,this.frames[t]=n,this.frames[t+e.MIX]=r,this.frames[t+e.SOFTNESS]=i,this.frames[t+e.BEND_DIRECTION]=s,this.frames[t+e.COMPRESS]=a?1:0,this.frames[t+e.STRETCH]=o?1:0},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.ikConstraints[this.ikConstraintIndex];if(h.active)if(r<l[0])switch(a){case K9.setup:return h.mix=h.data.mix,h.softness=h.data.softness,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,void(h.stretch=h.data.stretch);case K9.first:h.mix+=(h.data.mix-h.mix)*s,h.softness+=(h.data.softness-h.softness)*s,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch}else if(r>=l[l.length-e.ENTRIES])a==K9.setup?(h.mix=h.data.mix+(l[l.length+e.PREV_MIX]-h.data.mix)*s,h.softness=h.data.softness+(l[l.length+e.PREV_SOFTNESS]-h.data.softness)*s,o==Z9.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=l[l.length+e.PREV_BEND_DIRECTION],h.compress=0!=l[l.length+e.PREV_COMPRESS],h.stretch=0!=l[l.length+e.PREV_STRETCH])):(h.mix+=(l[l.length+e.PREV_MIX]-h.mix)*s,h.softness+=(l[l.length+e.PREV_SOFTNESS]-h.softness)*s,o==Z9.mixIn&&(h.bendDirection=l[l.length+e.PREV_BEND_DIRECTION],h.compress=0!=l[l.length+e.PREV_COMPRESS],h.stretch=0!=l[l.length+e.PREV_STRETCH]));else{var u=Y7.binarySearch(l,r,e.ENTRIES),c=l[u+e.PREV_MIX],d=l[u+e.PREV_SOFTNESS],p=l[u],f=this.getCurvePercent(u/e.ENTRIES-1,1-(r-p)/(l[u+e.PREV_TIME]-p));a==K9.setup?(h.mix=h.data.mix+(c+(l[u+e.MIX]-c)*f-h.data.mix)*s,h.softness=h.data.softness+(d+(l[u+e.SOFTNESS]-d)*f-h.data.softness)*s,o==Z9.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=l[u+e.PREV_BEND_DIRECTION],h.compress=0!=l[u+e.PREV_COMPRESS],h.stretch=0!=l[u+e.PREV_STRETCH])):(h.mix+=(c+(l[u+e.MIX]-c)*f-h.mix)*s,h.softness+=(d+(l[u+e.SOFTNESS]-d)*f-h.softness)*s,o==Z9.mixIn&&(h.bendDirection=l[u+e.PREV_BEND_DIRECTION],h.compress=0!=l[u+e.PREV_COMPRESS],h.stretch=0!=l[u+e.PREV_STRETCH]))}},e.ENTRIES=6,e.PREV_TIME=-6,e.PREV_MIX=-5,e.PREV_SOFTNESS=-4,e.PREV_BEND_DIRECTION=-3,e.PREV_COMPRESS=-2,e.PREV_STRETCH=-1,e.MIX=1,e.SOFTNESS=2,e.BEND_DIRECTION=3,e.COMPRESS=4,e.STRETCH=5,e}(q7),ltt=function(t){function e(n){var r=t.call(this,n)||this;return r.frames=w7.newFloatArray(n*e.ENTRIES),r}return D7(e,t),e.prototype.getPropertyId=function(){return(F7.transformConstraint<<24)+this.transformConstraintIndex},e.prototype.setFrame=function(t,n,r,i,s,a){t*=e.ENTRIES,this.frames[t]=n,this.frames[t+e.ROTATE]=r,this.frames[t+e.TRANSLATE]=i,this.frames[t+e.SCALE]=s,this.frames[t+e.SHEAR]=a},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.transformConstraints[this.transformConstraintIndex];if(h.active)if(r<l[0]){var u=h.data;switch(a){case K9.setup:return h.rotateMix=u.rotateMix,h.translateMix=u.translateMix,h.scaleMix=u.scaleMix,void(h.shearMix=u.shearMix);case K9.first:h.rotateMix+=(u.rotateMix-h.rotateMix)*s,h.translateMix+=(u.translateMix-h.translateMix)*s,h.scaleMix+=(u.scaleMix-h.scaleMix)*s,h.shearMix+=(u.shearMix-h.shearMix)*s}}else{var c=0,d=0,p=0,f=0;if(r>=l[l.length-e.ENTRIES]){var m=l.length;c=l[m+e.PREV_ROTATE],d=l[m+e.PREV_TRANSLATE],p=l[m+e.PREV_SCALE],f=l[m+e.PREV_SHEAR]}else{var g=Y7.binarySearch(l,r,e.ENTRIES);c=l[g+e.PREV_ROTATE],d=l[g+e.PREV_TRANSLATE],p=l[g+e.PREV_SCALE],f=l[g+e.PREV_SHEAR];var y=l[g],v=this.getCurvePercent(g/e.ENTRIES-1,1-(r-y)/(l[g+e.PREV_TIME]-y));c+=(l[g+e.ROTATE]-c)*v,d+=(l[g+e.TRANSLATE]-d)*v,p+=(l[g+e.SCALE]-p)*v,f+=(l[g+e.SHEAR]-f)*v}if(a==K9.setup){u=h.data;h.rotateMix=u.rotateMix+(c-u.rotateMix)*s,h.translateMix=u.translateMix+(d-u.translateMix)*s,h.scaleMix=u.scaleMix+(p-u.scaleMix)*s,h.shearMix=u.shearMix+(f-u.shearMix)*s}else h.rotateMix+=(c-h.rotateMix)*s,h.translateMix+=(d-h.translateMix)*s,h.scaleMix+=(p-h.scaleMix)*s,h.shearMix+=(f-h.shearMix)*s}},e.ENTRIES=5,e.PREV_TIME=-5,e.PREV_ROTATE=-4,e.PREV_TRANSLATE=-3,e.PREV_SCALE=-2,e.PREV_SHEAR=-1,e.ROTATE=1,e.TRANSLATE=2,e.SCALE=3,e.SHEAR=4,e}(q7),htt=function(t){function e(n){var r=t.call(this,n)||this;return r.frames=w7.newFloatArray(n*e.ENTRIES),r}return D7(e,t),e.prototype.getPropertyId=function(){return(F7.pathConstraintPosition<<24)+this.pathConstraintIndex},e.prototype.setFrame=function(t,n,r){t*=e.ENTRIES,this.frames[t]=n,this.frames[t+e.VALUE]=r},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(r<l[0])switch(a){case K9.setup:return void(h.position=h.data.position);case K9.first:h.position+=(h.data.position-h.position)*s}else{var u=0;if(r>=l[l.length-e.ENTRIES])u=l[l.length+e.PREV_VALUE];else{var c=Y7.binarySearch(l,r,e.ENTRIES);u=l[c+e.PREV_VALUE];var d=l[c],p=this.getCurvePercent(c/e.ENTRIES-1,1-(r-d)/(l[c+e.PREV_TIME]-d));u+=(l[c+e.VALUE]-u)*p}a==K9.setup?h.position=h.data.position+(u-h.data.position)*s:h.position+=(u-h.position)*s}},e.ENTRIES=2,e.PREV_TIME=-2,e.PREV_VALUE=-1,e.VALUE=1,e}(q7),utt=function(t){function e(e){return t.call(this,e)||this}return D7(e,t),e.prototype.getPropertyId=function(){return(F7.pathConstraintSpacing<<24)+this.pathConstraintIndex},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(r<l[0])switch(a){case K9.setup:return void(h.spacing=h.data.spacing);case K9.first:h.spacing+=(h.data.spacing-h.spacing)*s}else{var u=0;if(r>=l[l.length-e.ENTRIES])u=l[l.length+e.PREV_VALUE];else{var c=Y7.binarySearch(l,r,e.ENTRIES);u=l[c+e.PREV_VALUE];var d=l[c],p=this.getCurvePercent(c/e.ENTRIES-1,1-(r-d)/(l[c+e.PREV_TIME]-d));u+=(l[c+e.VALUE]-u)*p}a==K9.setup?h.spacing=h.data.spacing+(u-h.data.spacing)*s:h.spacing+=(u-h.spacing)*s}},e}(htt),ctt=function(t){function e(n){var r=t.call(this,n)||this;return r.frames=w7.newFloatArray(n*e.ENTRIES),r}return D7(e,t),e.prototype.getPropertyId=function(){return(F7.pathConstraintMix<<24)+this.pathConstraintIndex},e.prototype.setFrame=function(t,n,r,i){t*=e.ENTRIES,this.frames[t]=n,this.frames[t+e.ROTATE]=r,this.frames[t+e.TRANSLATE]=i},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(r<l[0])switch(a){case K9.setup:return h.rotateMix=h.data.rotateMix,void(h.translateMix=h.data.translateMix);case K9.first:h.rotateMix+=(h.data.rotateMix-h.rotateMix)*s,h.translateMix+=(h.data.translateMix-h.translateMix)*s}else{var u=0,c=0;if(r>=l[l.length-e.ENTRIES])u=l[l.length+e.PREV_ROTATE],c=l[l.length+e.PREV_TRANSLATE];else{var d=Y7.binarySearch(l,r,e.ENTRIES);u=l[d+e.PREV_ROTATE],c=l[d+e.PREV_TRANSLATE];var p=l[d],f=this.getCurvePercent(d/e.ENTRIES-1,1-(r-p)/(l[d+e.PREV_TIME]-p));u+=(l[d+e.ROTATE]-u)*f,c+=(l[d+e.TRANSLATE]-c)*f}a==K9.setup?(h.rotateMix=h.data.rotateMix+(u-h.data.rotateMix)*s,h.translateMix=h.data.translateMix+(c-h.data.translateMix)*s):(h.rotateMix+=(u-h.rotateMix)*s,h.translateMix+=(c-h.translateMix)*s)}},e.ENTRIES=3,e.PREV_TIME=-3,e.PREV_ROTATE=-2,e.PREV_TRANSLATE=-1,e.ROTATE=1,e.TRANSLATE=2,e}(q7),dtt=function(){function t(t){this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new ftt(this),this.propertyIDs=new m7,this.animationsChanged=!1,this.trackEntryPool=new _7((function(){return new ptt})),this.data=t}return t.prototype.update=function(t){t*=this.timeScale;for(var e=this.tracks,n=0,r=e.length;n<r;n++){var i=e[n];if(null!=i){i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast;var s=t*i.timeScale;if(i.delay>0){if(i.delay-=s,i.delay>0)continue;s=-i.delay,i.delay=0}var a=i.next;if(null!=a){var o=i.trackLast-a.delay;if(o>=0){for(a.delay=0,a.trackTime+=0==i.timeScale?0:(o/i.timeScale+t)*a.timeScale,i.trackTime+=s,this.setCurrent(n,a,!0);null!=a.mixingFrom;)a.mixTime+=t,a=a.mixingFrom;continue}}else if(i.trackLast>=i.trackEnd&&null==i.mixingFrom){e[n]=null,this.queue.end(i),this.disposeNext(i);continue}if(null!=i.mixingFrom&&this.updateMixingFrom(i,t)){var l=i.mixingFrom;for(i.mixingFrom=null,null!=l&&(l.mixingTo=null);null!=l;)this.queue.end(l),l=l.mixingFrom}i.trackTime+=s}}this.queue.drain()},t.prototype.updateMixingFrom=function(t,e){var n=t.mixingFrom;if(null==n)return!0;var r=this.updateMixingFrom(n,e);return n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=n.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=n.mixingFrom,null!=n.mixingFrom&&(n.mixingFrom.mixingTo=t),t.interruptAlpha=n.interruptAlpha,this.queue.end(n)),r):(n.trackTime+=e*n.timeScale,t.mixTime+=e,!1)},t.prototype.apply=function(e){if(null==e)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var n=this.events,r=this.tracks,i=!1,s=0,a=r.length;s<a;s++){var o=r[s];if(!(null==o||o.delay>0)){i=!0;var l=0==s?K9.first:o.mixBlend,h=o.alpha;null!=o.mixingFrom?h*=this.applyMixingFrom(o,e,l):o.trackTime>=o.trackEnd&&null==o.next&&(h=0);var u=o.animationLast,c=o.getAnimationTime(),d=o.animation.timelines.length,p=o.animation.timelines;if(0==s&&1==h||l==K9.add)for(var f=0;f<d;f++){w7.webkit602BugfixHelper(h,l);var m=p[f];m instanceof ntt?this.applyAttachmentTimeline(m,e,c,l,!0):m.apply(e,u,c,n,h,l,Z9.mixIn)}else{var g=o.timelineMode,y=0==o.timelinesRotation.length;y&&w7.setArraySize(o.timelinesRotation,d<<1,null);var v=o.timelinesRotation;for(f=0;f<d;f++){var x=p[f],b=g[f]==t.SUBSEQUENT?l:K9.setup;x instanceof K7?this.applyRotateTimeline(x,e,c,h,b,v,f<<1,y):x instanceof ntt?this.applyAttachmentTimeline(x,e,c,l,!0):(w7.webkit602BugfixHelper(h,l),x.apply(e,u,c,n,h,b,Z9.mixIn))}}this.queueEvents(o,c),n.length=0,o.nextAnimationLast=c,o.nextTrackLast=o.trackTime}}for(var w=this.unkeyedState+t.SETUP,_=e.slots,T=0,E=e.slots.length;T<E;T++){var S=_[T];if(S.attachmentState==w){var I=S.data.attachmentName;S.setAttachment(null==I?null:e.getAttachment(S.data.index,I))}}return this.unkeyedState+=2,this.queue.drain(),i},t.prototype.applyMixingFrom=function(e,n,r){var i=e.mixingFrom;null!=i.mixingFrom&&this.applyMixingFrom(i,n,r);var s=0;0==e.mixDuration?(s=1,r==K9.first&&(r=K9.setup)):((s=e.mixTime/e.mixDuration)>1&&(s=1),r!=K9.first&&(r=i.mixBlend));var a=s<i.eventThreshold?this.events:null,o=s<i.attachmentThreshold,l=s<i.drawOrderThreshold,h=i.animationLast,u=i.getAnimationTime(),c=i.animation.timelines.length,d=i.animation.timelines,p=i.alpha*e.interruptAlpha,f=p*(1-s);if(r==K9.add)for(var m=0;m<c;m++)d[m].apply(n,h,u,a,f,r,Z9.mixOut);else{var g=i.timelineMode,y=i.timelineHoldMix,v=0==i.timelinesRotation.length;v&&w7.setArraySize(i.timelinesRotation,c<<1,null);var x=i.timelinesRotation;i.totalAlpha=0;for(m=0;m<c;m++){var b=d[m],w=Z9.mixOut,_=void 0,T=0;switch(g[m]){case t.SUBSEQUENT:if(!l&&b instanceof att)continue;_=r,T=f;break;case t.FIRST:_=K9.setup,T=f;break;case t.HOLD_SUBSEQUENT:_=r,T=p;break;case t.HOLD_FIRST:_=K9.setup,T=p;break;default:_=K9.setup;var E=y[m];T=p*Math.max(0,1-E.mixTime/E.mixDuration)}i.totalAlpha+=T,b instanceof K7?this.applyRotateTimeline(b,n,u,T,_,x,m<<1,v):b instanceof ntt?this.applyAttachmentTimeline(b,n,u,_,o):(w7.webkit602BugfixHelper(T,r),l&&b instanceof att&&_==K9.setup&&(w=Z9.mixIn),b.apply(n,h,u,a,T,_,w))}}return e.mixDuration>0&&this.queueEvents(i,u),this.events.length=0,i.nextAnimationLast=u,i.nextTrackLast=i.trackTime,s},t.prototype.applyAttachmentTimeline=function(e,n,r,i,s){var a=n.slots[e.slotIndex];if(a.bone.active){var o,l=e.frames;if(r<l[0])i!=K9.setup&&i!=K9.first||this.setAttachment(n,a,a.data.attachmentName,s);else o=r>=l[l.length-1]?l.length-1:Y7.binarySearch(l,r)-1,this.setAttachment(n,a,e.attachmentNames[o],s);a.attachmentState<=this.unkeyedState&&(a.attachmentState=this.unkeyedState+t.SETUP)}},t.prototype.setAttachment=function(e,n,r,i){n.setAttachment(null==r?null:e.getAttachment(n.data.index,r)),i&&(n.attachmentState=this.unkeyedState+t.CURRENT)},t.prototype.applyRotateTimeline=function(t,e,n,r,i,s,a,o){if(o&&(s[a]=0),1!=r){var l=t,h=l.frames,u=e.bones[l.boneIndex];if(u.active){var c=0,d=0;if(n<h[0])switch(i){case K9.setup:u.rotation=u.data.rotation;default:return;case K9.first:c=u.rotation,d=u.data.rotation}else if(c=i==K9.setup?u.data.rotation:u.rotation,n>=h[h.length-K7.ENTRIES])d=u.data.rotation+h[h.length+K7.PREV_ROTATION];else{var p=Y7.binarySearch(h,n,K7.ENTRIES),f=h[p+K7.PREV_ROTATION],m=h[p],g=l.getCurvePercent((p>>1)-1,1-(n-m)/(h[p+K7.PREV_TIME]-m));d=h[p+K7.ROTATION]-f,d=f+(d-=360*(16384-(16384.499999999996-d/360|0)))*g+u.data.rotation,d-=360*(16384-(16384.499999999996-d/360|0))}var y=0,v=d-c;if(0==(v-=360*(16384-(16384.499999999996-v/360|0))))y=s[a];else{var x=0,b=0;o?(x=0,b=v):(x=s[a],b=s[a+1]);var w=v>0,_=x>=0;v7.signum(b)!=v7.signum(v)&&Math.abs(b)<=90&&(Math.abs(x)>180&&(x+=360*v7.signum(x)),_=w),y=v+x-x%360,_!=w&&(y+=360*v7.signum(x)),s[a]=y}s[a+1]=v,c+=y*r,u.rotation=c-360*(16384-(16384.499999999996-c/360|0))}}else t.apply(e,0,n,null,1,i,Z9.mixIn)},t.prototype.queueEvents=function(t,e){for(var n=t.animationStart,r=t.animationEnd,i=r-n,s=t.trackLast%i,a=this.events,o=0,l=a.length;o<l;o++){var h=a[o];if(h.time<s)break;h.time>r||this.queue.event(t,h)}for((t.loop?0==i||s>t.trackTime%i:e>=r&&t.animationLast<r)&&this.queue.complete(t);o<l;o++){a[o].time<n||this.queue.event(t,a[o])}},t.prototype.clearTracks=function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,n=this.tracks.length;e<n;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()},t.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(null!=e){this.queue.end(e),this.disposeNext(e);for(var n=e;;){var r=n.mixingFrom;if(null==r)break;this.queue.end(r),n.mixingFrom=null,n.mixingTo=null,n=r}this.tracks[e.trackIndex]=null,this.queue.drain()}}},t.prototype.setCurrent=function(t,e,n){var r=this.expandToIndex(t);this.tracks[t]=e,null!=r&&(n&&this.queue.interrupt(r),e.mixingFrom=r,r.mixingTo=e,e.mixTime=0,null!=r.mixingFrom&&r.mixDuration>0&&(e.interruptAlpha*=Math.min(1,r.mixTime/r.mixDuration)),r.timelinesRotation.length=0),this.queue.start(e)},t.prototype.setAnimation=function(t,e,n){var r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,r,n)},t.prototype.setAnimationWith=function(t,e,n){if(null==e)throw new Error("animation cannot be null.");var r=!0,i=this.expandToIndex(t);null!=i&&(-1==i.nextTrackLast?(this.tracks[t]=i.mixingFrom,this.queue.interrupt(i),this.queue.end(i),this.disposeNext(i),i=i.mixingFrom,r=!1):this.disposeNext(i));var s=this.trackEntry(t,e,n,i);return this.setCurrent(t,s,r),this.queue.drain(),s},t.prototype.addAnimation=function(t,e,n,r){var i=this.data.skeletonData.findAnimation(e);if(null==i)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,i,n,r)},t.prototype.addAnimationWith=function(t,e,n,r){if(null==e)throw new Error("animation cannot be null.");var i=this.expandToIndex(t);if(null!=i)for(;null!=i.next;)i=i.next;var s=this.trackEntry(t,e,n,i);if(null==i)this.setCurrent(t,s,!0),this.queue.drain();else if(i.next=s,r<=0){var a=i.animationEnd-i.animationStart;0!=a?(i.loop?r+=a*(1+(i.trackTime/a|0)):r+=Math.max(a,i.trackTime),r-=this.data.getMix(i.animation,e)):r=i.trackTime}return s.delay=r,s},t.prototype.setEmptyAnimation=function(e,n){var r=this.setAnimationWith(e,t.emptyAnimation,!1);return r.mixDuration=n,r.trackEnd=n,r},t.prototype.addEmptyAnimation=function(e,n,r){r<=0&&(r-=n);var i=this.addAnimationWith(e,t.emptyAnimation,!1,r);return i.mixDuration=n,i.trackEnd=n,i},t.prototype.setEmptyAnimations=function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var n=0,r=this.tracks.length;n<r;n++){var i=this.tracks[n];null!=i&&this.setEmptyAnimation(i.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()},t.prototype.expandToIndex=function(t){return t<this.tracks.length?this.tracks[t]:(w7.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)},t.prototype.trackEntry=function(t,e,n,r){var i=this.trackEntryPool.obtain();return i.trackIndex=t,i.animation=e,i.loop=n,i.holdPrevious=!1,i.eventThreshold=0,i.attachmentThreshold=0,i.drawOrderThreshold=0,i.animationStart=0,i.animationEnd=e.duration,i.animationLast=-1,i.nextAnimationLast=-1,i.delay=0,i.trackTime=0,i.trackLast=-1,i.nextTrackLast=-1,i.trackEnd=Number.MAX_VALUE,i.timeScale=1,i.alpha=1,i.interruptAlpha=1,i.mixTime=0,i.mixDuration=null==r?0:this.data.getMix(r.animation,e),i.mixBlend=K9.replace,i},t.prototype.disposeNext=function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null},t.prototype._animationsChanged=function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var t=0,e=this.tracks.length;t<e;t++){var n=this.tracks[t];if(null!=n){for(;null!=n.mixingFrom;)n=n.mixingFrom;do{null!=n.mixingFrom&&n.mixBlend==K9.add||this.computeHold(n),n=n.mixingTo}while(null!=n)}}},t.prototype.computeHold=function(e){var n=e.mixingTo,r=e.animation.timelines,i=e.animation.timelines.length,s=w7.setArraySize(e.timelineMode,i);e.timelineHoldMix.length=0;var a=w7.setArraySize(e.timelineHoldMix,i),o=this.propertyIDs;if(null!=n&&n.holdPrevious)for(var l=0;l<i;l++)s[l]=o.add(r[l].getPropertyId())?t.HOLD_FIRST:t.HOLD_SUBSEQUENT;else t:for(l=0;l<i;l++){var h=r[l],u=h.getPropertyId();if(o.add(u))if(null==n||h instanceof ntt||h instanceof att||h instanceof stt||!n.animation.hasTimeline(u))s[l]=t.FIRST;else{for(var c=n.mixingTo;null!=c;c=c.mixingTo)if(!c.animation.hasTimeline(u)){if(e.mixDuration>0){s[l]=t.HOLD_MIX,a[l]=c;continue t}break}s[l]=t.HOLD_FIRST}else s[l]=t.SUBSEQUENT}},t.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},t.prototype.addListener=function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)},t.prototype.removeListener=function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)},t.prototype.clearListeners=function(){this.listeners.length=0},t.prototype.clearListenerNotifications=function(){this.queue.clear()},t.prototype.setAnimationByName=function(e,n,r){t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.setAnimation(e,n,r)},t.prototype.addAnimationByName=function(e,n,r,i){t.deprecatedWarning2||(t.deprecatedWarning2=!0),this.addAnimation(e,n,r,i)},t.prototype.hasAnimation=function(t){return null!==this.data.skeletonData.findAnimation(t)},t.prototype.hasAnimationByName=function(e){return t.deprecatedWarning3||(t.deprecatedWarning3=!0),this.hasAnimation(e)},t.emptyAnimation=new Y7("<empty>",[],0),t.SUBSEQUENT=0,t.FIRST=1,t.HOLD_SUBSEQUENT=2,t.HOLD_FIRST=3,t.HOLD_MIX=4,t.SETUP=1,t.CURRENT=2,t.deprecatedWarning1=!1,t.deprecatedWarning2=!1,t.deprecatedWarning3=!1,t}(),ptt=function(){function t(){this.mixBlend=K9.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}return t.prototype.reset=function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0},t.prototype.getAnimationTime=function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)},t.prototype.setAnimationLast=function(t){this.animationLast=t,this.nextAnimationLast=t},t.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},t.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0},Object.defineProperty(t.prototype,"time",{get:function(){return t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.trackTime},set:function(e){t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.trackTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endTime",{get:function(){return t.deprecatedWarning2||(t.deprecatedWarning2=!0),this.trackTime},set:function(e){t.deprecatedWarning2||(t.deprecatedWarning2=!0),this.trackTime=e},enumerable:!1,configurable:!0}),t.prototype.loopsCount=function(){return Math.floor(this.trackTime/this.trackEnd)},t.deprecatedWarning1=!1,t.deprecatedWarning2=!1,t}(),ftt=function(){function t(t){this.objects=[],this.drainDisabled=!1,this.animState=t}return t.prototype.start=function(t){this.objects.push(j7.start),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.interrupt=function(t){this.objects.push(j7.interrupt),this.objects.push(t)},t.prototype.end=function(t){this.objects.push(j7.end),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.dispose=function(t){this.objects.push(j7.dispose),this.objects.push(t)},t.prototype.complete=function(t){this.objects.push(j7.complete),this.objects.push(t)},t.prototype.event=function(t,e){this.objects.push(j7.event),this.objects.push(t),this.objects.push(e)},t.prototype.deprecateStuff=function(){return t.deprecatedWarning1||(t.deprecatedWarning1=!0),!0},t.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,n=0;n<t.length;n+=2){var r=t[n],i=t[n+1];switch(r){case j7.start:null!=i.listener&&i.listener.start&&i.listener.start(i);for(var s=0;s<e.length;s++)e[s].start&&e[s].start(i);i.onStart&&this.deprecateStuff()&&i.onStart(i.trackIndex),this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(i.trackIndex);break;case j7.interrupt:null!=i.listener&&i.listener.interrupt&&i.listener.interrupt(i);for(s=0;s<e.length;s++)e[s].interrupt&&e[s].interrupt(i);break;case j7.end:null!=i.listener&&i.listener.end&&i.listener.end(i);for(s=0;s<e.length;s++)e[s].end&&e[s].end(i);i.onEnd&&this.deprecateStuff()&&i.onEnd(i.trackIndex),this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(i.trackIndex);case j7.dispose:null!=i.listener&&i.listener.dispose&&i.listener.dispose(i);for(s=0;s<e.length;s++)e[s].dispose&&e[s].dispose(i);this.animState.trackEntryPool.free(i);break;case j7.complete:null!=i.listener&&i.listener.complete&&i.listener.complete(i);for(s=0;s<e.length;s++)e[s].complete&&e[s].complete(i);var a=v7.toInt(i.loopsCount());i.onComplete&&this.deprecateStuff()&&i.onComplete(i.trackIndex,a),this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(i.trackIndex,a);break;case j7.event:var o=t[2+n++];null!=i.listener&&i.listener.event&&i.listener.event(i,o);for(s=0;s<e.length;s++)e[s].event&&e[s].event(i,o);i.onEvent&&this.deprecateStuff()&&i.onEvent(i.trackIndex,o),this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(i.trackIndex,o)}}this.clear(),this.drainDisabled=!1}},t.prototype.clear=function(){this.objects.length=0},t.deprecatedWarning1=!1,t}();!function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(j7||(j7={}));var mtt,gtt=function(){function t(){}return t.prototype.start=function(t){},t.prototype.interrupt=function(t){},t.prototype.end=function(t){},t.prototype.dispose=function(t){},t.prototype.complete=function(t){},t.prototype.event=function(t,e){},t}(),ytt=function(){function t(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}return t.prototype.setMix=function(t,e,n){var r=this.skeletonData.findAnimation(t);if(null==r)throw new Error("Animation not found: "+t);var i=this.skeletonData.findAnimation(e);if(null==i)throw new Error("Animation not found: "+e);this.setMixWith(r,i,n)},t.prototype.setMixByName=function(e,n,r){t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.setMix(e,n,r)},t.prototype.setMixWith=function(t,e,n){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");var r=t.name+"."+e.name;this.animationToMixTime[r]=n},t.prototype.getMix=function(t,e){var n=t.name+"."+e.name,r=this.animationToMixTime[n];return void 0===r?this.defaultMix:r},t.deprecatedWarning1=!1,t}(),vtt=function(){function t(t){this.atlas=t}return t.prototype.newRegionAttachment=function(t,e,n){var r=this.atlas.findRegion(n);if(null==r)throw new Error("Region not found in atlas: "+n+" (region attachment: "+e+")");var i=new W7(e);return i.region=r,i},t.prototype.newMeshAttachment=function(t,e,n){var r=this.atlas.findRegion(n);if(null==r)throw new Error("Region not found in atlas: "+n+" (mesh attachment: "+e+")");var i=new V7(e);return i.region=r,i},t.prototype.newBoundingBoxAttachment=function(t,e){return new $7(e)},t.prototype.newPathAttachment=function(t,e){return new z7(e)},t.prototype.newPointAttachment=function(t,e){return new G7(e)},t.prototype.newClippingAttachment=function(t,e){return new U7(e)},t}(),xtt=function(){function t(t,e,n){if(this.matrix=new In,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=n,this.setToSetupPose()}return Object.defineProperty(t.prototype,"worldX",{get:function(){return this.matrix.tx},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldY",{get:function(){return this.matrix.ty},enumerable:!1,configurable:!0}),t.prototype.isActive=function(){return this.active},t.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},t.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},t.prototype.updateWorldTransformWith=function(t,e,n,r,i,s,a){this.ax=t,this.ay=e,this.arotation=n,this.ascaleX=r,this.ascaleY=i,this.ashearX=s,this.ashearY=a,this.appliedValid=!0;var o=this.parent,l=this.matrix,h=this.skeleton.scaleX,u=E7?-this.skeleton.scaleY:this.skeleton.scaleY;if(null==o){var c=this.skeleton,d=n+90+a;return l.a=v7.cosDeg(n+s)*r*h,l.c=v7.cosDeg(d)*i*h,l.b=v7.sinDeg(n+s)*r*u,l.d=v7.sinDeg(d)*i*u,l.tx=t*h+c.x,void(l.ty=e*u+c.y)}var p=o.matrix.a,f=o.matrix.c,m=o.matrix.b,g=o.matrix.d;switch(l.tx=p*t+f*e+o.matrix.tx,l.ty=m*t+g*e+o.matrix.ty,this.data.transformMode){case t7.Normal:d=n+90+a;var y=v7.cosDeg(n+s)*r,v=v7.cosDeg(d)*i,x=v7.sinDeg(n+s)*r,b=v7.sinDeg(d)*i;return l.a=p*y+f*x,l.c=p*v+f*b,l.b=m*y+g*x,void(l.d=m*v+g*b);case t7.OnlyTranslation:d=n+90+a;l.a=v7.cosDeg(n+s)*r,l.c=v7.cosDeg(d)*i,l.b=v7.sinDeg(n+s)*r,l.d=v7.sinDeg(d)*i;break;case t7.NoRotationOrReflection:var w=0;(E=p*p+m*m)>1e-4?(E=Math.abs(p*g-f*m)/E,p/=this.skeleton.scaleX,f=(m/=this.skeleton.scaleY)*E,g=p*E,w=Math.atan2(m,p)*v7.radDeg):(p=0,m=0,w=90-Math.atan2(g,f)*v7.radDeg);var _=n+s-w,T=n+a-w+90;y=v7.cosDeg(_)*r,v=v7.cosDeg(T)*i,x=v7.sinDeg(_)*r,b=v7.sinDeg(T)*i;l.a=p*y-f*x,l.c=p*v-f*b,l.b=m*y+g*x,l.d=m*v+g*b;break;case t7.NoScale:case t7.NoScaleOrReflection:var E,S=v7.cosDeg(n),I=v7.sinDeg(n),k=(p*S+f*I)/h,C=(m*S+g*I)/u;(E=Math.sqrt(k*k+C*C))>1e-5&&(E=1/E),k*=E,C*=E,E=Math.sqrt(k*k+C*C),this.data.transformMode==t7.NoScale&&p*g-f*m<0!=(E7?this.skeleton.scaleX<0!=this.skeleton.scaleY>0:this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(E=-E);var N=Math.PI/2+Math.atan2(C,k),A=Math.cos(N)*E,R=Math.sin(N)*E;y=v7.cosDeg(s)*r,v=v7.cosDeg(90+a)*i,x=v7.sinDeg(s)*r,b=v7.sinDeg(90+a)*i;l.a=k*y+A*x,l.c=k*v+A*b,l.b=C*y+R*x,l.d=C*v+R*b}l.a*=h,l.c*=h,l.b*=u,l.d*=u},t.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY},t.prototype.getWorldRotationX=function(){return Math.atan2(this.matrix.b,this.matrix.a)*v7.radDeg},t.prototype.getWorldRotationY=function(){return Math.atan2(this.matrix.d,this.matrix.c)*v7.radDeg},t.prototype.getWorldScaleX=function(){var t=this.matrix;return Math.sqrt(t.a*t.a+t.c*t.c)},t.prototype.getWorldScaleY=function(){var t=this.matrix;return Math.sqrt(t.b*t.b+t.d*t.d)},t.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var t=this.parent,e=this.matrix;if(null==t)return this.ax=e.tx,this.ay=e.ty,this.arotation=Math.atan2(e.b,e.a)*v7.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*v7.radDeg);var n=t.matrix,r=1/(n.a*n.d-n.b*n.c),i=e.tx-n.tx,s=e.ty-n.ty;this.ax=i*n.d*r-s*n.c*r,this.ay=s*n.a*r-i*n.b*r;var a=r*n.d,o=r*n.a,l=r*n.c,h=r*n.b,u=a*e.a-l*e.b,c=a*e.c-l*e.d,d=o*e.b-h*e.a,p=o*e.d-h*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(u*u+d*d),this.ascaleX>1e-4){var f=u*p-c*d;this.ascaleY=f/this.ascaleX,this.ashearY=Math.atan2(u*c+d*p,f)*v7.radDeg,this.arotation=Math.atan2(d,u)*v7.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(c*c+p*p),this.ashearY=0,this.arotation=90-Math.atan2(p,c)*v7.radDeg},t.prototype.worldToLocal=function(t){var e=this.matrix,n=e.a,r=e.c,i=e.b,s=e.d,a=1/(n*s-r*i),o=t.x-e.tx,l=t.y-e.ty;return t.x=o*s*a-l*r*a,t.y=l*n*a-o*i*a,t},t.prototype.localToWorld=function(t){var e=this.matrix,n=t.x,r=t.y;return t.x=n*e.a+r*e.c+e.tx,t.y=n*e.b+r*e.d+e.ty,t},t.prototype.worldToLocalRotation=function(t){var e=v7.sinDeg(t),n=v7.cosDeg(t),r=this.matrix;return Math.atan2(r.a*e-r.b*n,r.d*n-r.c*e)*v7.radDeg},t.prototype.localToWorldRotation=function(t){var e=v7.sinDeg(t),n=v7.cosDeg(t),r=this.matrix;return Math.atan2(n*r.b+e*r.d,n*r.a+e*r.c)*v7.radDeg},t.prototype.rotateWorld=function(t){var e=this.matrix,n=e.a,r=e.c,i=e.b,s=e.d,a=v7.cosDeg(t),o=v7.sinDeg(t);e.a=a*n-o*i,e.c=a*r-o*s,e.b=o*n+a*i,e.d=o*r+a*s,this.appliedValid=!1},t}(),btt=function(t,e,n){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=t7.Normal,this.skinRequired=!1,this.color=new y7,t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=n},wtt=function(t,e,n){this.name=t,this.order=e,this.skinRequired=n},_tt=function(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e},Ttt=function(t){this.name=t},Ett=function(){function t(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(var n=0;n<t.bones.length;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)}return t.prototype.isActive=function(){return this.active},t.prototype.apply=function(){this.update()},t.prototype.update=function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}},t.prototype.apply1=function(t,e,n,r,i,s,a){t.appliedValid||t.updateAppliedTransform();var o=t.parent.matrix,l=o.a,h=o.c,u=o.b,c=o.d,d=-t.ashearX-t.arotation,p=0,f=0;switch(t.data.transformMode){case t7.OnlyTranslation:p=e-t.worldX,f=n-t.worldY;break;case t7.NoRotationOrReflection:var m=Math.abs(l*c-h*u)/(l*l+u*u),g=l/t.skeleton.scaleX,y=u/t.skeleton.scaleY;h=-y*m*t.skeleton.scaleX,c=g*m*t.skeleton.scaleY,d+=Math.atan2(y,g)*v7.radDeg;default:var v=e-o.tx,x=n-o.ty,b=l*c-h*u;p=(v*c-x*h)/b-t.ax,f=(x*l-v*u)/b-t.ay}d+=Math.atan2(f,p)*v7.radDeg,t.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);var w=t.ascaleX,_=t.ascaleY;if(r||i){switch(t.data.transformMode){case t7.NoScale:case t7.NoScaleOrReflection:p=e-t.worldX,f=n-t.worldY}var T=t.data.length*w,E=Math.sqrt(p*p+f*f);if(r&&E<T||i&&E>T&&T>1e-4)w*=m=(E/T-1)*a+1,s&&(_*=m)}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+d*a,w,_,t.ashearX,t.ashearY)},t.prototype.apply2=function(t,e,n,r,i,s,a,o){if(0!=o){t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();var l=t.ax,h=t.ay,u=t.ascaleX,c=u,d=t.ascaleY,p=e.ascaleX,f=t.matrix,m=0,g=0,y=0;u<0?(u=-u,m=180,y=-1):(m=0,y=1),d<0&&(d=-d,y=-y),p<0?(p=-p,g=180):g=0;var v=e.ax,x=0,b=0,w=0,_=f.a,T=f.c,E=f.b,S=f.d,I=Math.abs(u-d)<=1e-4;I?(b=_*v+T*(x=e.ay)+f.tx,w=E*v+S*x+f.ty):(x=0,b=_*v+f.tx,w=E*v+f.ty);var k=t.parent.matrix;_=k.a,T=k.c,E=k.b;var C,N,A=1/(_*(S=k.d)-T*E),R=b-k.tx,M=w-k.ty,O=(R*S-M*T)*A-l,P=(M*_-R*E)*A-h,D=Math.sqrt(O*O+P*P),F=e.data.length*p;if(D<1e-4)return this.apply1(t,n,r,!1,s,!1,o),void e.updateWorldTransformWith(v,x,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);var L=((R=n-k.tx)*S-(M=r-k.ty)*T)*A-l,B=(M*_-R*E)*A-h,$=L*L+B*B;if(0!=a){a*=u*(p+1)/2;var U=Math.sqrt($),V=U-D-F*u+a;if(V>0){var z=Math.min(1,V/(2*a))-1;$=(L-=(z=(V-a*(1-z*z))/U)*L)*L+(B-=z*B)*B}}t:if(I){var G=($-D*D-(F*=u)*F)/(2*D*F);G<-1?G=-1:G>1&&(G=1,s&&(c*=(Math.sqrt($)/(D+F)-1)*o+1)),N=Math.acos(G)*i,_=D+F*G,T=F*Math.sin(N),C=Math.atan2(B*_-L*T,L*_+B*T)}else{var W=(_=u*F)*_,X=(T=d*F)*T,H=Math.atan2(B,L),Y=-2*X*D,j=X-W;if((S=Y*Y-4*j*(E=X*D*D+W*$-W*X))>=0){var q=Math.sqrt(S);Y<0&&(q=-q);var K=(q=-(Y+q)/2)/j,Z=E/q,J=Math.abs(K)<Math.abs(Z)?K:Z;if(J*J<=$){M=Math.sqrt($-J*J)*i,C=H-Math.atan2(M,J),N=Math.atan2(M/d,(J-D)/u);break t}}var Q=v7.PI,tt=D-_,et=tt*tt,nt=0,rt=0,it=D+_,st=it*it,at=0;(E=-_*D/(W-X))>=-1&&E<=1&&(E=Math.acos(E),(S=(R=_*Math.cos(E)+D)*R+(M=T*Math.sin(E))*M)<et&&(Q=E,et=S,tt=R,nt=M),S>st&&(rt=E,st=S,it=R,at=M)),$<=(et+st)/2?(C=H-Math.atan2(nt*i,tt),N=Q*i):(C=H-Math.atan2(at*i,it),N=rt*i)}var ot=Math.atan2(x,v)*y,lt=t.arotation;(C=(C-ot)*v7.radDeg+m-lt)>180?C-=360:C<-180&&(C+=360),t.updateWorldTransformWith(l,h,lt+C*o,c,t.ascaleY,0,0),lt=e.arotation,(N=((N+ot)*v7.radDeg-e.ashearX)*y+g-lt)>180?N-=360:N<-180&&(N+=360),e.updateWorldTransformWith(v,x,lt+N*o,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}else e.updateWorldTransform()},t}(),Stt=function(t){function e(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n.bendDirection=1,n.compress=!1,n.stretch=!1,n.uniform=!1,n.mix=1,n.softness=0,n}return D7(e,t),e}(wtt),Itt=function(t){function e(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n}return D7(e,t),e}(wtt);!function(t){t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent"}(mtt||(mtt={}));var ktt=function(){function t(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(var n=0,r=t.bones.length;n<r;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}return t.prototype.isActive=function(){return this.active},t.prototype.apply=function(){this.update()},t.prototype.update=function(){var e=this.target.getAttachment();if(e instanceof z7){var n=this.rotateMix,r=this.translateMix,i=n>0;if(r>0||i){var s=this.data,a=s.spacingMode,o=a==mtt.Length,l=s.rotateMode,h=l==Q9.Tangent,u=l==Q9.ChainScale,c=this.bones.length,d=h?c:c+1,p=this.bones,f=w7.setArraySize(this.spaces,d),m=null,g=this.spacing;if(u||o){u&&(m=w7.setArraySize(this.lengths,c));for(var y=0,v=d-1;y<v;){var x=(N=p[y]).data.length;if(x<t.epsilon)u&&(m[y]=0),f[++y]=0;else{var b=x*N.matrix.a,w=x*N.matrix.b,_=Math.sqrt(b*b+w*w);u&&(m[y]=_),f[++y]=(o?x+g:g)*_/x}}}else for(y=1;y<d;y++)f[y]=g;var T=this.computeWorldPositions(e,d,h,s.positionMode==J9.Percent,a==mtt.Percent),E=T[0],S=T[1],I=s.offsetRotation,k=!1;if(0==I)k=l==Q9.Chain;else k=!1,I*=(C=this.target.bone.matrix).a*C.d-C.b*C.c>0?v7.degRad:-v7.degRad;y=0;for(var C=3;y<c;y++,C+=3){var N,A=(N=p[y]).matrix;A.tx+=(E-A.tx)*r,A.ty+=(S-A.ty)*r;var R=(b=T[C])-E,M=(w=T[C+1])-S;if(u){var O=m[y];if(0!=O){var P=(Math.sqrt(R*R+M*M)/O-1)*n+1;A.a*=P,A.b*=P}}if(E=b,S=w,i){var D=A.a,F=A.c,L=A.b,B=A.d,$=0,U=0,V=0;if($=h?T[C-1]:0==f[y+1]?T[C+2]:Math.atan2(M,R),$-=Math.atan2(L,D),k){U=Math.cos($),V=Math.sin($);var z=N.data.length;E+=(z*(U*D-V*L)-R)*n,S+=(z*(V*D+U*L)-M)*n}else $+=I;$>v7.PI?$-=v7.PI2:$<-v7.PI&&($+=v7.PI2),$*=n,U=Math.cos($),V=Math.sin($),A.a=U*D-V*L,A.c=U*F-V*B,A.b=V*D+U*L,A.d=V*F+U*B}N.appliedValid=!1}}}},t.prototype.computeWorldPositions=function(e,n,r,i,s){var a=this.target,o=this.position,l=this.spaces,h=w7.setArraySize(this.positions,3*n+2),u=null,c=e.closed,d=e.worldVerticesLength,p=d/6,f=t.NONE;if(!e.constantSpeed){var m=e.lengths,g=m[p-=c?1:2];if(i&&(o*=g),s)for(var y=0;y<n;y++)l[y]*=g;u=w7.setArraySize(this.world,8);y=0;for(var v=0,x=0;y<n;y++,v+=3){var b=o+=W=l[y];if(c)(b%=g)<0&&(b+=g),x=0;else{if(b<0){f!=t.BEFORE&&(f=t.BEFORE,e.computeWorldVertices(a,2,4,u,0,2)),this.addBeforePosition(b,u,0,h,v);continue}if(b>g){f!=t.AFTER&&(f=t.AFTER,e.computeWorldVertices(a,d-6,4,u,0,2)),this.addAfterPosition(b-g,u,0,h,v);continue}}for(;;x++){var w=m[x];if(!(b>w)){if(0==x)b/=w;else b=(b-(j=m[x-1]))/(w-j);break}}x!=f&&(f=x,c&&x==p?(e.computeWorldVertices(a,d-4,4,u,0,2),e.computeWorldVertices(a,0,4,u,4,2)):e.computeWorldVertices(a,6*x+2,8,u,0,2)),this.addCurvePosition(b,u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],h,v,r||y>0&&0==W)}return h}c?(d+=2,u=w7.setArraySize(this.world,d),e.computeWorldVertices(a,2,d-4,u,0,2),e.computeWorldVertices(a,0,2,u,d-4,2),u[d-2]=u[0],u[d-1]=u[1]):(p--,d-=4,u=w7.setArraySize(this.world,d),e.computeWorldVertices(a,2,d,u,0,2));for(var _=w7.setArraySize(this.curves,p),T=0,E=u[0],S=u[1],I=0,k=0,C=0,N=0,A=0,R=0,M=0,O=0,P=0,D=0,F=0,L=0,B=0,$=0,U=(y=0,2);y<p;y++,U+=6)I=u[U],k=u[U+1],C=u[U+2],N=u[U+3],F=2*(M=.1875*(E-2*I+C))+(P=.09375*(3*(I-C)-E+(A=u[U+4]))),L=2*(O=.1875*(S-2*k+N))+(D=.09375*(3*(k-N)-S+(R=u[U+5]))),B=.75*(I-E)+M+.16666667*P,$=.75*(k-S)+O+.16666667*D,T+=Math.sqrt(B*B+$*$),B+=F,$+=L,F+=P,L+=D,T+=Math.sqrt(B*B+$*$),B+=F,$+=L,T+=Math.sqrt(B*B+$*$),B+=F+P,$+=L+D,T+=Math.sqrt(B*B+$*$),_[y]=T,E=A,S=R;if(i&&(o*=T),s)for(y=0;y<n;y++)l[y]*=T;for(var V=this.segments,z=0,G=(y=0,v=0,x=0,0);y<n;y++,v+=3){var W;b=o+=W=l[y];if(c)(b%=T)<0&&(b+=T),x=0;else{if(b<0){this.addBeforePosition(b,u,0,h,v);continue}if(b>T){this.addAfterPosition(b-T,u,d-4,h,v);continue}}for(;;x++){var X=_[x];if(!(b>X)){if(0==x)b/=X;else b=(b-(j=_[x-1]))/(X-j);break}}if(x!=f){f=x;var H=6*x;for(E=u[H],S=u[H+1],I=u[H+2],k=u[H+3],C=u[H+4],N=u[H+5],F=2*(M=.03*(E-2*I+C))+(P=.006*(3*(I-C)-E+(A=u[H+6]))),L=2*(O=.03*(S-2*k+N))+(D=.006*(3*(k-N)-S+(R=u[H+7]))),B=.3*(I-E)+M+.16666667*P,$=.3*(k-S)+O+.16666667*D,z=Math.sqrt(B*B+$*$),V[0]=z,H=1;H<8;H++)B+=F,$+=L,F+=P,L+=D,z+=Math.sqrt(B*B+$*$),V[H]=z;B+=F,$+=L,z+=Math.sqrt(B*B+$*$),V[8]=z,B+=F+P,$+=L+D,z+=Math.sqrt(B*B+$*$),V[9]=z,G=0}for(b*=z;;G++){var Y=V[G];if(!(b>Y)){var j;if(0==G)b/=Y;else b=G+(b-(j=V[G-1]))/(Y-j);break}}this.addCurvePosition(.1*b,E,S,I,k,C,N,A,R,h,v,r||y>0&&0==W)}return h},t.prototype.addBeforePosition=function(t,e,n,r,i){var s=e[n],a=e[n+1],o=e[n+2]-s,l=e[n+3]-a,h=Math.atan2(l,o);r[i]=s+t*Math.cos(h),r[i+1]=a+t*Math.sin(h),r[i+2]=h},t.prototype.addAfterPosition=function(t,e,n,r,i){var s=e[n+2],a=e[n+3],o=s-e[n],l=a-e[n+1],h=Math.atan2(l,o);r[i]=s+t*Math.cos(h),r[i+1]=a+t*Math.sin(h),r[i+2]=h},t.prototype.addCurvePosition=function(t,e,n,r,i,s,a,o,l,h,u,c){(0==t||isNaN(t))&&(t=1e-4);var d=t*t,p=d*t,f=1-t,m=f*f,g=m*f,y=f*t,v=3*y,x=f*v,b=v*t,w=e*g+r*x+s*b+o*p,_=n*g+i*x+a*b+l*p;h[u]=w,h[u+1]=_,c&&(h[u+2]=Math.atan2(_-(n*m+i*y*2+a*d),w-(e*m+r*y*2+s*d)))},t.NONE=-1,t.BEFORE=-2,t.AFTER=-3,t.epsilon=1e-5,t}(),Ctt=function(){function t(t,e){if(this.deform=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new y7,this.darkColor=null==t.darkColor?null:new y7,this.setToSetupPose(),this.blendMode=this.data.blendMode}return t.prototype.getAttachment=function(){return this.attachment},t.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)},t.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t},t.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},t.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},t}(),Ntt=function(){function t(t,e){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new T7,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(var n=0;n<t.bones.length;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)}return t.prototype.isActive=function(){return this.active},t.prototype.apply=function(){this.update()},t.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()},t.prototype.applyAbsoluteWorld=function(){for(var t=this.rotateMix,e=this.translateMix,n=this.scaleMix,r=this.shearMix,i=this.target,s=i.matrix,a=s.a,o=s.c,l=s.b,h=s.d,u=a*h-o*l>0?v7.degRad:-v7.degRad,c=this.data.offsetRotation*u,d=this.data.offsetShearY*u,p=this.bones,f=0,m=p.length;f<m;f++){var g=p[f],y=!1,v=g.matrix;if(0!=t){var x=v.a,b=v.c,w=v.b,_=v.d;(C=Math.atan2(l,a)-Math.atan2(w,x)+c)>v7.PI?C-=v7.PI2:C<-v7.PI&&(C+=v7.PI2),C*=t;var T=Math.cos(C),E=Math.sin(C);v.a=T*x-E*w,v.c=T*b-E*_,v.b=E*x+T*w,v.d=E*b+T*_,y=!0}if(0!=e){var S=this.temp;i.localToWorld(S.set(this.data.offsetX,this.data.offsetY)),v.tx+=(S.x-v.tx)*e,v.ty+=(S.y-v.ty)*e,y=!0}if(n>0){var I=Math.sqrt(v.a*v.a+v.b*v.b),k=Math.sqrt(a*a+l*l);I>1e-5&&(I=(I+(k-I+this.data.offsetScaleX)*n)/I),v.a*=I,v.b*=I,I=Math.sqrt(v.c*v.c+v.d*v.d),k=Math.sqrt(o*o+h*h),I>1e-5&&(I=(I+(k-I+this.data.offsetScaleY)*n)/I),v.c*=I,v.d*=I,y=!0}if(r>0){b=v.c,_=v.d;var C,N=Math.atan2(_,b);(C=Math.atan2(h,o)-Math.atan2(l,a)-(N-Math.atan2(v.b,v.a)))>v7.PI?C-=v7.PI2:C<-v7.PI&&(C+=v7.PI2),C=N+(C+d)*r;I=Math.sqrt(b*b+_*_);v.c=Math.cos(C)*I,v.d=Math.sin(C)*I,y=!0}y&&(g.appliedValid=!1)}},t.prototype.applyRelativeWorld=function(){for(var t=this.rotateMix,e=this.translateMix,n=this.scaleMix,r=this.shearMix,i=this.target,s=i.matrix,a=s.a,o=s.c,l=s.b,h=s.d,u=a*h-o*l>0?v7.degRad:-v7.degRad,c=this.data.offsetRotation*u,d=this.data.offsetShearY*u,p=this.bones,f=0,m=p.length;f<m;f++){var g=p[f],y=!1,v=g.matrix;if(0!=t){var x=v.a,b=v.c,w=v.b,_=v.d;(k=Math.atan2(l,a)+c)>v7.PI?k-=v7.PI2:k<-v7.PI&&(k+=v7.PI2),k*=t;var T=Math.cos(k),E=Math.sin(k);v.a=T*x-E*w,v.c=T*b-E*_,v.b=E*x+T*w,v.d=E*b+T*_,y=!0}if(0!=e){var S=this.temp;i.localToWorld(S.set(this.data.offsetX,this.data.offsetY)),v.tx+=S.x*e,v.ty+=S.y*e,y=!0}if(n>0){var I=(Math.sqrt(a*a+l*l)-1+this.data.offsetScaleX)*n+1;v.a*=I,v.b*=I,I=(Math.sqrt(o*o+h*h)-1+this.data.offsetScaleY)*n+1,v.c*=I,v.d*=I,y=!0}if(r>0){var k;(k=Math.atan2(h,o)-Math.atan2(l,a))>v7.PI?k-=v7.PI2:k<-v7.PI&&(k+=v7.PI2);b=v.c,_=v.d;k=Math.atan2(_,b)+(k-v7.PI/2+d)*r;I=Math.sqrt(b*b+_*_);v.c=Math.cos(k)*I,v.d=Math.sin(k)*I,y=!0}y&&(g.appliedValid=!1)}},t.prototype.applyAbsoluteLocal=function(){var t=this.rotateMix,e=this.translateMix,n=this.scaleMix,r=this.shearMix,i=this.target;i.appliedValid||i.updateAppliedTransform();for(var s=this.bones,a=0,o=s.length;a<o;a++){var l=s[a];l.appliedValid||l.updateAppliedTransform();var h=l.arotation;if(0!=t){var u=i.arotation-h+this.data.offsetRotation;h+=(u-=360*(16384-(16384.499999999996-u/360|0)))*t}var c=l.ax,d=l.ay;0!=e&&(c+=(i.ax-c+this.data.offsetX)*e,d+=(i.ay-d+this.data.offsetY)*e);var p=l.ascaleX,f=l.ascaleY;n>0&&(p>1e-5&&(p=(p+(i.ascaleX-p+this.data.offsetScaleX)*n)/p),f>1e-5&&(f=(f+(i.ascaleY-f+this.data.offsetScaleY)*n)/f));var m=l.ashearY;if(r>0){u=i.ashearY-m+this.data.offsetShearY;u-=360*(16384-(16384.499999999996-u/360|0)),l.shearY+=u*r}l.updateWorldTransformWith(c,d,h,p,f,l.ashearX,m)}},t.prototype.applyRelativeLocal=function(){var t=this.rotateMix,e=this.translateMix,n=this.scaleMix,r=this.shearMix,i=this.target;i.appliedValid||i.updateAppliedTransform();for(var s=this.bones,a=0,o=s.length;a<o;a++){var l=s[a];l.appliedValid||l.updateAppliedTransform();var h=l.arotation;0!=t&&(h+=(i.arotation+this.data.offsetRotation)*t);var u=l.ax,c=l.ay;0!=e&&(u+=(i.ax+this.data.offsetX)*e,c+=(i.ay+this.data.offsetY)*e);var d=l.ascaleX,p=l.ascaleY;n>0&&(d>1e-5&&(d*=(i.ascaleX-1+this.data.offsetScaleX)*n+1),p>1e-5&&(p*=(i.ascaleY-1+this.data.offsetScaleY)*n+1));var f=l.ashearY;r>0&&(f+=(i.ashearY+this.data.offsetShearY)*r),l.updateWorldTransformWith(u,c,h,d,p,l.ashearX,f)}},t}(),Att=function(){function t(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(var e=0;e<t.bones.length;e++){var n=t.bones[e],r=void 0;if(null==n.parent)r=new xtt(n,this,null);else{var i=this.bones[n.parent.index];r=new xtt(n,this,i),i.children.push(r)}this.bones.push(r)}this.slots=new Array,this.drawOrder=new Array;for(e=0;e<t.slots.length;e++){var s=t.slots[e],a=(r=this.bones[s.boneData.index],new Ctt(s,r));this.slots.push(a),this.drawOrder.push(a)}this.ikConstraints=new Array;for(e=0;e<t.ikConstraints.length;e++){var o=t.ikConstraints[e];this.ikConstraints.push(new Ett(o,this))}this.transformConstraints=new Array;for(e=0;e<t.transformConstraints.length;e++){var l=t.transformConstraints[e];this.transformConstraints.push(new Ntt(l,this))}this.pathConstraints=new Array;for(e=0;e<t.pathConstraints.length;e++){var h=t.pathConstraints[e];this.pathConstraints.push(new ktt(h,this))}this.color=new y7(1,1,1,1),this.updateCache()}return t.prototype.updateCache=function(){this._updateCache.length=0,this.updateCacheReset.length=0;for(var t=this.bones,e=0,n=t.length;e<n;e++){(i=t[e]).sorted=i.data.skinRequired,i.active=!i.sorted}if(null!=this.skin){var r=this.skin.bones;for(e=0,n=this.skin.bones.length;e<n;e++){var i=this.bones[r[e].index];do{i.sorted=!1,i.active=!0,i=i.parent}while(null!=i)}}var s=this.ikConstraints,a=this.transformConstraints,o=this.pathConstraints,l=s.length,h=a.length,u=o.length,c=l+h+u;t:for(e=0;e<c;e++){for(var d=0;d<l;d++){if((p=s[d]).data.order==e){this.sortIkConstraint(p);continue t}}for(d=0;d<h;d++){if((p=a[d]).data.order==e){this.sortTransformConstraint(p);continue t}}for(d=0;d<u;d++){var p;if((p=o[d]).data.order==e){this.sortPathConstraint(p);continue t}}}for(e=0,n=t.length;e<n;e++)this.sortBone(t[e])},t.prototype.sortIkConstraint=function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&w7.contains(this.skin.constraints,t.data,!0)),t.active){var e=t.target;this.sortBone(e);var n=t.bones,r=n[0];if(this.sortBone(r),n.length>1){var i=n[n.length-1];this._updateCache.indexOf(i)>-1||this.updateCacheReset.push(i)}this._updateCache.push(t),this.sortReset(r.children),n[n.length-1].sorted=!0}},t.prototype.sortPathConstraint=function(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||null!=this.skin&&w7.contains(this.skin.constraints,t.data,!0)),t.active){var e=t.target,n=e.data.index,r=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,n,r),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,n,r);for(var i=0,s=this.data.skins.length;i<s;i++)this.sortPathConstraintAttachment(this.data.skins[i],n,r);var a=e.getAttachment();a instanceof z7&&this.sortPathConstraintAttachmentWith(a,r);var o=t.bones,l=o.length;for(i=0;i<l;i++)this.sortBone(o[i]);this._updateCache.push(t);for(i=0;i<l;i++)this.sortReset(o[i].children);for(i=0;i<l;i++)o[i].sorted=!0}},t.prototype.sortTransformConstraint=function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&w7.contains(this.skin.constraints,t.data,!0)),t.active){this.sortBone(t.target);var e=t.bones,n=e.length;if(t.data.local)for(var r=0;r<n;r++){var i=e[r];this.sortBone(i.parent),this._updateCache.indexOf(i)>-1||this.updateCacheReset.push(i)}else for(r=0;r<n;r++)this.sortBone(e[r]);this._updateCache.push(t);for(var s=0;s<n;s++)this.sortReset(e[s].children);for(s=0;s<n;s++)e[s].sorted=!0}},t.prototype.sortPathConstraintAttachment=function(t,e,n){var r=t.attachments[e];if(r)for(var i in r)this.sortPathConstraintAttachmentWith(r[i],n)},t.prototype.sortPathConstraintAttachmentWith=function(t,e){if(t instanceof z7){var n=t.bones;if(null==n)this.sortBone(e);else for(var r=this.bones,i=0;i<n.length;)for(var s=n[i++],a=i+s;i<a;i++){var o=n[i];this.sortBone(r[o])}}},t.prototype.sortBone=function(t){if(!t.sorted){var e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}},t.prototype.sortReset=function(t){for(var e=0,n=t.length;e<n;e++){var r=t[e];r.active&&(r.sorted&&this.sortReset(r.children),r.sorted=!1)}},t.prototype.updateWorldTransform=function(){for(var t=this.updateCacheReset,e=0,n=t.length;e<n;e++){var r=t[e];r.ax=r.x,r.ay=r.y,r.arotation=r.rotation,r.ascaleX=r.scaleX,r.ascaleY=r.scaleY,r.ashearX=r.shearX,r.ashearY=r.shearY,r.appliedValid=!0}var i=this._updateCache;for(e=0,n=i.length;e<n;e++)i[e].update()},t.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},t.prototype.setBonesToSetupPose=function(){for(var t=this.bones,e=0,n=t.length;e<n;e++)t[e].setToSetupPose();var r=this.ikConstraints;for(e=0,n=r.length;e<n;e++){(o=r[e]).mix=o.data.mix,o.softness=o.data.softness,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch}var i=this.transformConstraints;for(e=0,n=i.length;e<n;e++){var s=(o=i[e]).data;o.rotateMix=s.rotateMix,o.translateMix=s.translateMix,o.scaleMix=s.scaleMix,o.shearMix=s.shearMix}var a=this.pathConstraints;for(e=0,n=a.length;e<n;e++){var o;s=(o=a[e]).data;o.position=s.position,o.spacing=s.spacing,o.rotateMix=s.rotateMix,o.translateMix=s.translateMix}},t.prototype.setSlotsToSetupPose=function(){var t=this.slots;w7.arrayCopy(t,0,this.drawOrder,0,t.length);for(var e=0,n=t.length;e<n;e++)t[e].setToSetupPose()},t.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},t.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,r=e.length;n<r;n++){var i=e[n];if(i.data.name==t)return i}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,r=e.length;n<r;n++)if(e[n].data.name==t)return n;return-1},t.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,r=e.length;n<r;n++){var i=e[n];if(i.data.name==t)return i}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,r=e.length;n<r;n++)if(e[n].data.name==t)return n;return-1},t.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)},t.prototype.setSkin=function(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,n=0,r=e.length;n<r;n++){var i=e[n],s=i.data.attachmentName;if(null!=s){var a=t.getAttachment(n,s);null!=a&&i.setAttachment(a)}}this.skin=t,this.updateCache()}},t.prototype.getAttachmentByName=function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)},t.prototype.getAttachment=function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var n=this.skin.getAttachment(t,e);if(null!=n)return n}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},t.prototype.setAttachment=function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var n=this.slots,r=0,i=n.length;r<i;r++){var s=n[r];if(s.data.name==t){var a=null;if(null!=e&&null==(a=this.getAttachment(r,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void s.setAttachment(a)}}throw new Error("Slot not found: "+t)},t.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.data.name==t)return i}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.data.name==t)return i}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.data.name==t)return i}return null},t.prototype.getBounds=function(t,e,n){if(void 0===n&&(n=new Array(2)),null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");for(var r=this.drawOrder,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,l=0,h=r.length;l<h;l++){var u=r[l];if(u.bone.active){var c=0,d=null,p=u.getAttachment();if(p instanceof W7)c=8,d=w7.setArraySize(n,c,0),p.computeWorldVertices(u.bone,d,0,2);else if(p instanceof V7){var f=p;c=f.worldVerticesLength,d=w7.setArraySize(n,c,0),f.computeWorldVertices(u,0,c,d,0,2)}if(null!=d)for(var m=0,g=d.length;m<g;m+=2){var y=d[m],v=d[m+1];i=Math.min(i,y),s=Math.min(s,v),a=Math.max(a,y),o=Math.max(o,v)}}}t.set(i,s),e.set(a-i,o-s)},t.prototype.update=function(t){this.time+=t},Object.defineProperty(t.prototype,"flipX",{get:function(){return-1==this.scaleX},set:function(e){t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.scaleX=e?1:-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"flipY",{get:function(){return-1==this.scaleY},set:function(e){t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.scaleY=e?1:-1},enumerable:!1,configurable:!0}),t.deprecatedWarning1=!1,t}(),Rtt=function(){function t(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}return t.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1},t.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1},t.prototype.findSkin=function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findEvent=function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findAnimation=function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findPathConstraintIndex=function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1},t}(),Mtt=function(t,e,n){if(this.color=new y7(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==n)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=n},Ott=function(t){function e(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n.rotateMix=0,n.translateMix=0,n.scaleMix=0,n.shearMix=0,n.offsetRotation=0,n.offsetX=0,n.offsetY=0,n.offsetScaleX=0,n.offsetScaleY=0,n.offsetShearY=0,n.relative=!1,n.local=!1,n}return D7(e,t),e}(wtt),Ptt=function(t,e,n){this.slotIndex=t,this.name=e,this.attachment=n},Dtt=function(){function t(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==t)throw new Error("name cannot be null.");this.name=t}return t.prototype.setAttachment=function(t,e,n){if(null==n)throw new Error("attachment cannot be null.");var r=this.attachments;t>=r.length&&(r.length=t+1),r[t]||(r[t]={}),r[t][e]=n},t.prototype.addSkin=function(t){for(var e=0;e<t.bones.length;e++){for(var n=t.bones[e],r=!1,i=0;i<this.bones.length;i++)if(this.bones[i]==n){r=!0;break}r||this.bones.push(n)}for(e=0;e<t.constraints.length;e++){var s=t.constraints[e];for(r=!1,i=0;i<this.constraints.length;i++)if(this.constraints[i]==s){r=!0;break}r||this.constraints.push(s)}var a=t.getAttachments();for(e=0;e<a.length;e++){var o=a[e];this.setAttachment(o.slotIndex,o.name,o.attachment)}},t.prototype.copySkin=function(t){for(var e=0;e<t.bones.length;e++){for(var n=t.bones[e],r=!1,i=0;i<this.bones.length;i++)if(this.bones[i]==n){r=!0;break}r||this.bones.push(n)}for(e=0;e<t.constraints.length;e++){var s=t.constraints[e];for(r=!1,i=0;i<this.constraints.length;i++)if(this.constraints[i]==s){r=!0;break}r||this.constraints.push(s)}var a=t.getAttachments();for(e=0;e<a.length;e++){var o=a[e];null!=o.attachment&&(o.attachment instanceof V7?(o.attachment=o.attachment.newLinkedMesh(),this.setAttachment(o.slotIndex,o.name,o.attachment)):(o.attachment=o.attachment.copy(),this.setAttachment(o.slotIndex,o.name,o.attachment)))}},t.prototype.getAttachment=function(t,e){var n=this.attachments[t];return n?n[e]:null},t.prototype.removeAttachment=function(t,e){var n=this.attachments[t];n&&(n[e]=null)},t.prototype.getAttachments=function(){for(var t=new Array,e=0;e<this.attachments.length;e++){var n=this.attachments[e];if(n)for(var r in n){var i=n[r];i&&t.push(new Ptt(e,r,i))}}return t},t.prototype.getAttachmentsForSlot=function(t,e){var n=this.attachments[t];if(n)for(var r in n){var i=n[r];i&&e.push(new Ptt(t,r,i))}},t.prototype.clear=function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0},t.prototype.attachAll=function(t,e){for(var n=0,r=0;r<t.slots.length;r++){var i=t.slots[r],s=i.getAttachment();if(s&&n<e.attachments.length){var a=e.attachments[n];for(var o in a){if(s==a[o]){var l=this.getAttachment(n,o);null!=l&&i.setAttachment(l);break}}}n++}},t}(),Ftt=function(){function t(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return t.prototype.readSkeletonData=function(e){var n=this.scale,r=new Rtt;r.name="";var i=new e7(e);if(r.hash=i.readString(),r.version=i.readString(),"3.8.75"===r.version);r.x=i.readFloat(),r.y=i.readFloat(),r.width=i.readFloat(),r.height=i.readFloat();var s=i.readBoolean();s&&(r.fps=i.readFloat(),r.imagesPath=i.readString(),r.audioPath=i.readString());var a=0;a=i.readInt(!0);for(var o=0;o<a;o++)i.strings.push(i.readString());a=i.readInt(!0);for(o=0;o<a;o++){var l=i.readString(),h=0==o?null:r.bones[i.readInt(!0)];(d=new btt(o,l,h)).rotation=i.readFloat(),d.x=i.readFloat()*n,d.y=i.readFloat()*n,d.scaleX=i.readFloat(),d.scaleY=i.readFloat(),d.shearX=i.readFloat(),d.shearY=i.readFloat(),d.length=i.readFloat()*n,d.transformMode=t.TransformModeValues[i.readInt(!0)],d.skinRequired=i.readBoolean(),s&&y7.rgba8888ToColor(d.color,i.readInt32()),r.bones.push(d)}a=i.readInt(!0);for(o=0;o<a;o++){var u=i.readString(),c=r.bones[i.readInt(!0)],d=new Mtt(o,u,c);y7.rgba8888ToColor(d.color,i.readInt32());var p=i.readInt32();-1!=p&&y7.rgb888ToColor(d.darkColor=new y7,p),d.attachmentName=i.readStringRef(),d.blendMode=t.BlendModeValues[i.readInt(!0)],r.slots.push(d)}a=i.readInt(!0);o=0;for(var f=void 0;o<a;o++){(d=new Stt(i.readString())).order=i.readInt(!0),d.skinRequired=i.readBoolean(),f=i.readInt(!0);for(var m=0;m<f;m++)d.bones.push(r.bones[i.readInt(!0)]);d.target=r.bones[i.readInt(!0)],d.mix=i.readFloat(),d.softness=i.readFloat()*n,d.bendDirection=i.readByte(),d.compress=i.readBoolean(),d.stretch=i.readBoolean(),d.uniform=i.readBoolean(),r.ikConstraints.push(d)}a=i.readInt(!0);for(o=0,f=void 0;o<a;o++){(d=new Ott(i.readString())).order=i.readInt(!0),d.skinRequired=i.readBoolean(),f=i.readInt(!0);for(m=0;m<f;m++)d.bones.push(r.bones[i.readInt(!0)]);d.target=r.bones[i.readInt(!0)],d.local=i.readBoolean(),d.relative=i.readBoolean(),d.offsetRotation=i.readFloat(),d.offsetX=i.readFloat()*n,d.offsetY=i.readFloat()*n,d.offsetScaleX=i.readFloat(),d.offsetScaleY=i.readFloat(),d.offsetShearY=i.readFloat(),d.rotateMix=i.readFloat(),d.translateMix=i.readFloat(),d.scaleMix=i.readFloat(),d.shearMix=i.readFloat(),r.transformConstraints.push(d)}a=i.readInt(!0);for(o=0,f=void 0;o<a;o++){(d=new Itt(i.readString())).order=i.readInt(!0),d.skinRequired=i.readBoolean(),f=i.readInt(!0);for(m=0;m<f;m++)d.bones.push(r.bones[i.readInt(!0)]);d.target=r.slots[i.readInt(!0)],d.positionMode=t.PositionModeValues[i.readInt(!0)],d.spacingMode=t.SpacingModeValues[i.readInt(!0)],d.rotateMode=t.RotateModeValues[i.readInt(!0)],d.offsetRotation=i.readFloat(),d.position=i.readFloat(),d.positionMode==J9.Fixed&&(d.position*=n),d.spacing=i.readFloat(),d.spacingMode!=mtt.Length&&d.spacingMode!=mtt.Fixed||(d.spacing*=n),d.rotateMix=i.readFloat(),d.translateMix=i.readFloat(),r.pathConstraints.push(d)}var g=this.readSkin(i,r,!0,s);null!=g&&(r.defaultSkin=g,r.skins.push(g));o=r.skins.length;for(w7.setArraySize(r.skins,a=o+i.readInt(!0));o<a;o++)r.skins[o]=this.readSkin(i,r,!1,s);a=this.linkedMeshes.length;for(o=0;o<a;o++){var y=this.linkedMeshes[o],v=null==y.skin?r.defaultSkin:r.findSkin(y.skin);if(null==v)throw new Error("Skin not found: "+y.skin);var x=v.getAttachment(y.slotIndex,y.parent);if(null==x)throw new Error("Parent mesh not found: "+y.parent);y.mesh.deformAttachment=y.inheritDeform?x:y.mesh,y.mesh.setParentMesh(x)}this.linkedMeshes.length=0,a=i.readInt(!0);for(o=0;o<a;o++){(d=new Ttt(i.readStringRef())).intValue=i.readInt(!1),d.floatValue=i.readFloat(),d.stringValue=i.readString(),d.audioPath=i.readString(),null!=d.audioPath&&(d.volume=i.readFloat(),d.balance=i.readFloat()),r.events.push(d)}a=i.readInt(!0);for(o=0;o<a;o++)r.animations.push(this.readAnimation(i,i.readString(),r));return r},t.prototype.readSkin=function(t,e,n,r){var i=null,s=0;if(n){if(0==(s=t.readInt(!0)))return null;i=new Dtt("default")}else{(i=new Dtt(t.readStringRef())).bones.length=t.readInt(!0);for(var a=0,o=i.bones.length;a<o;a++)i.bones[a]=e.bones[t.readInt(!0)];for(a=0,o=t.readInt(!0);a<o;a++)i.constraints.push(e.ikConstraints[t.readInt(!0)]);for(a=0,o=t.readInt(!0);a<o;a++)i.constraints.push(e.transformConstraints[t.readInt(!0)]);for(a=0,o=t.readInt(!0);a<o;a++)i.constraints.push(e.pathConstraints[t.readInt(!0)]);s=t.readInt(!0)}for(a=0;a<s;a++)for(var l=t.readInt(!0),h=0,u=t.readInt(!0);h<u;h++){var c=t.readStringRef(),d=this.readAttachment(t,e,i,l,c,r);null!=d&&i.setAttachment(l,c,d)}return i},t.prototype.readAttachment=function(e,n,r,i,s,a){var o=this.scale,l=e.readStringRef();null==l&&(l=s);var h=e.readByte();switch(t.AttachmentTypeValues[h]){case $9.Region:var u=e.readStringRef(),c=e.readFloat(),d=e.readFloat(),p=e.readFloat(),f=e.readFloat(),m=e.readFloat(),g=e.readFloat(),y=e.readFloat(),v=e.readInt32();null==u&&(u=l);var x=this.attachmentLoader.newRegionAttachment(r,l,u);return null==x?null:(x.path=u,x.x=d*o,x.y=p*o,x.scaleX=f,x.scaleY=m,x.rotation=c,x.width=g*o,x.height=y*o,y7.rgba8888ToColor(x.color,v),x);case $9.BoundingBox:var b=e.readInt(!0),w=this.readVertices(e,b),_=(v=a?e.readInt32():0,this.attachmentLoader.newBoundingBoxAttachment(r,l));return null==_?null:(_.worldVerticesLength=b<<1,_.vertices=w.vertices,_.bones=w.bones,a&&y7.rgba8888ToColor(_.color,v),_);case $9.Mesh:u=e.readStringRef(),v=e.readInt32(),b=e.readInt(!0);var T=this.readFloatArray(e,b<<1,1),E=this.readShortArray(e),S=(w=this.readVertices(e,b),e.readInt(!0)),I=null;g=0,y=0;return a&&(I=this.readShortArray(e),g=e.readFloat(),y=e.readFloat()),null==u&&(u=l),null==(k=this.attachmentLoader.newMeshAttachment(r,l,u))?null:(k.path=u,y7.rgba8888ToColor(k.color,v),k.bones=w.bones,k.vertices=w.vertices,k.worldVerticesLength=b<<1,k.triangles=E,k.regionUVs=new Float32Array(T),k.hullLength=S<<1,a&&(k.edges=I,k.width=g*o,k.height=y*o),k);case $9.LinkedMesh:u=e.readStringRef(),v=e.readInt32();var k,C=e.readStringRef(),N=e.readStringRef(),A=e.readBoolean();g=0,y=0;return a&&(g=e.readFloat(),y=e.readFloat()),null==u&&(u=l),null==(k=this.attachmentLoader.newMeshAttachment(r,l,u))?null:(k.path=u,y7.rgba8888ToColor(k.color,v),a&&(k.width=g*o,k.height=y*o),this.linkedMeshes.push(new Ltt(k,C,i,N,A)),k);case $9.Path:for(var R=e.readBoolean(),M=e.readBoolean(),O=(b=e.readInt(!0),w=this.readVertices(e,b),w7.newArray(b/3,0)),P=0,D=O.length;P<D;P++)O[P]=e.readFloat()*o;v=a?e.readInt32():0;return null==(u=this.attachmentLoader.newPathAttachment(r,l))?null:(u.closed=R,u.constantSpeed=M,u.worldVerticesLength=b<<1,u.vertices=w.vertices,u.bones=w.bones,u.lengths=O,a&&y7.rgba8888ToColor(u.color,v),u);case $9.Point:c=e.readFloat(),d=e.readFloat(),p=e.readFloat(),v=a?e.readInt32():0;var F=this.attachmentLoader.newPointAttachment(r,l);return null==F?null:(F.x=d*o,F.y=p*o,F.rotation=c,a&&y7.rgba8888ToColor(F.color,v),F);case $9.Clipping:var L=e.readInt(!0),B=(b=e.readInt(!0),w=this.readVertices(e,b),v=a?e.readInt32():0,this.attachmentLoader.newClippingAttachment(r,l));return null==B?null:(B.endSlot=n.slots[L],B.worldVerticesLength=b<<1,B.vertices=w.vertices,B.bones=w.bones,a&&y7.rgba8888ToColor(B.color,v),B)}return null},t.prototype.readVertices=function(t,e){var n=e<<1,r=new Btt,i=this.scale;if(!t.readBoolean())return r.vertices=this.readFloatArray(t,n,i),r;for(var s=new Array,a=new Array,o=0;o<e;o++){var l=t.readInt(!0);a.push(l);for(var h=0;h<l;h++)a.push(t.readInt(!0)),s.push(t.readFloat()*i),s.push(t.readFloat()*i),s.push(t.readFloat())}return r.vertices=w7.toFloatArray(s),r.bones=a,r},t.prototype.readFloatArray=function(t,e,n){var r=new Array(e);if(1==n)for(var i=0;i<e;i++)r[i]=t.readFloat();else for(i=0;i<e;i++)r[i]=t.readFloat()*n;return r},t.prototype.readShortArray=function(t){for(var e=t.readInt(!0),n=new Array(e),r=0;r<e;r++)n[r]=t.readShort();return n},t.prototype.readAnimation=function(e,n,r){for(var i=new Array,s=this.scale,a=0,o=new y7,l=new y7,h=0,u=e.readInt(!0);h<u;h++)for(var c=e.readInt(!0),d=0,p=e.readInt(!0);d<p;d++){var f=e.readByte(),m=e.readInt(!0);switch(f){case t.SLOT_ATTACHMENT:(x=new ntt(m)).slotIndex=c;for(var g=0;g<m;g++)x.setFrame(g,e.readFloat(),e.readStringRef());i.push(x),a=Math.max(a,x.frames[m-1]);break;case t.SLOT_COLOR:(x=new ttt(m)).slotIndex=c;for(g=0;g<m;g++){var y=e.readFloat();y7.rgba8888ToColor(o,e.readInt32()),x.setFrame(g,y,o.r,o.g,o.b,o.a),g<m-1&&this.readCurve(e,g,x)}i.push(x),a=Math.max(a,x.frames[(m-1)*ttt.ENTRIES]);break;case t.SLOT_TWO_COLOR:(x=new ett(m)).slotIndex=c;for(g=0;g<m;g++){y=e.readFloat();y7.rgba8888ToColor(o,e.readInt32()),y7.rgb888ToColor(l,e.readInt32()),x.setFrame(g,y,o.r,o.g,o.b,o.a,l.r,l.g,l.b),g<m-1&&this.readCurve(e,g,x)}i.push(x),a=Math.max(a,x.frames[(m-1)*ett.ENTRIES])}}for(h=0,u=e.readInt(!0);h<u;h++){var v=e.readInt(!0);for(d=0,p=e.readInt(!0);d<p;d++){f=e.readByte(),m=e.readInt(!0);switch(f){case t.BONE_ROTATE:(x=new K7(m)).boneIndex=v;for(g=0;g<m;g++)x.setFrame(g,e.readFloat(),e.readFloat()),g<m-1&&this.readCurve(e,g,x);i.push(x),a=Math.max(a,x.frames[(m-1)*K7.ENTRIES]);break;case t.BONE_TRANSLATE:case t.BONE_SCALE:case t.BONE_SHEAR:var x=void 0,b=1;f==t.BONE_SCALE?x=new J7(m):f==t.BONE_SHEAR?x=new Q7(m):(x=new Z7(m),b=s),x.boneIndex=v;for(g=0;g<m;g++)x.setFrame(g,e.readFloat(),e.readFloat()*b,e.readFloat()*b),g<m-1&&this.readCurve(e,g,x);i.push(x),a=Math.max(a,x.frames[(m-1)*Z7.ENTRIES])}}}for(h=0,u=e.readInt(!0);h<u;h++){var w=e.readInt(!0);m=e.readInt(!0);(x=new ott(m)).ikConstraintIndex=w;for(g=0;g<m;g++)x.setFrame(g,e.readFloat(),e.readFloat(),e.readFloat()*s,e.readByte(),e.readBoolean(),e.readBoolean()),g<m-1&&this.readCurve(e,g,x);i.push(x),a=Math.max(a,x.frames[(m-1)*ott.ENTRIES])}for(h=0,u=e.readInt(!0);h<u;h++){w=e.readInt(!0),m=e.readInt(!0);(x=new ltt(m)).transformConstraintIndex=w;for(g=0;g<m;g++)x.setFrame(g,e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat()),g<m-1&&this.readCurve(e,g,x);i.push(x),a=Math.max(a,x.frames[(m-1)*ltt.ENTRIES])}for(h=0,u=e.readInt(!0);h<u;h++){w=e.readInt(!0);var _=r.pathConstraints[w];for(d=0,p=e.readInt(!0);d<p;d++){f=e.readByte(),m=e.readInt(!0);switch(f){case t.PATH_POSITION:case t.PATH_SPACING:x=void 0,b=1;f==t.PATH_SPACING?(x=new utt(m),_.spacingMode!=mtt.Length&&_.spacingMode!=mtt.Fixed||(b=s)):(x=new htt(m),_.positionMode==J9.Fixed&&(b=s)),x.pathConstraintIndex=w;for(g=0;g<m;g++)x.setFrame(g,e.readFloat(),e.readFloat()*b),g<m-1&&this.readCurve(e,g,x);i.push(x),a=Math.max(a,x.frames[(m-1)*htt.ENTRIES]);break;case t.PATH_MIX:(x=new ctt(m)).pathConstraintIndex=w;for(g=0;g<m;g++)x.setFrame(g,e.readFloat(),e.readFloat(),e.readFloat()),g<m-1&&this.readCurve(e,g,x);i.push(x),a=Math.max(a,x.frames[(m-1)*ctt.ENTRIES])}}}for(h=0,u=e.readInt(!0);h<u;h++){var T=r.skins[e.readInt(!0)];for(d=0,p=e.readInt(!0);d<p;d++){c=e.readInt(!0);for(var E=0,S=e.readInt(!0);E<S;E++){var I=T.getAttachment(c,e.readStringRef()),k=null!=I.bones,C=I.vertices,N=k?C.length/3*2:C.length;m=e.readInt(!0);(x=new itt(m)).slotIndex=c,x.attachment=I;for(g=0;g<m;g++){y=e.readFloat();var A=void 0,R=e.readInt(!0);if(0==R)A=k?w7.newFloatArray(N):C;else{A=w7.newFloatArray(N);var M=e.readInt(!0);if(R+=M,1==s)for(var O=M;O<R;O++)A[O]=e.readFloat();else for(O=M;O<R;O++)A[O]=e.readFloat()*s;if(!k){O=0;for(var P=A.length;O<P;O++)A[O]+=C[O]}}x.setFrame(g,y,A),g<m-1&&this.readCurve(e,g,x)}i.push(x),a=Math.max(a,x.frames[m-1])}}}var D=e.readInt(!0);if(D>0){x=new att(D);var F=r.slots.length;for(h=0;h<D;h++){y=e.readFloat();var L=e.readInt(!0),B=w7.newArray(F,0);for(d=F-1;d>=0;d--)B[d]=-1;var $=w7.newArray(F-L,0),U=0,V=0;for(d=0;d<L;d++){for(c=e.readInt(!0);U!=c;)$[V++]=U++;B[U+e.readInt(!0)]=U++}for(;U<F;)$[V++]=U++;for(d=F-1;d>=0;d--)-1==B[d]&&(B[d]=$[--V]);x.setFrame(h,y,B)}i.push(x),a=Math.max(a,x.frames[D-1])}var z=e.readInt(!0);if(z>0){for(x=new stt(z),h=0;h<z;h++){y=e.readFloat();var G=r.events[e.readInt(!0)],W=new _tt(y,G);W.intValue=e.readInt(!1),W.floatValue=e.readFloat(),W.stringValue=e.readBoolean()?e.readString():G.stringValue,null!=W.data.audioPath&&(W.volume=e.readFloat(),W.balance=e.readFloat()),x.setFrame(h,W)}i.push(x),a=Math.max(a,x.frames[z-1])}return new Y7(n,i,a)},t.prototype.readCurve=function(e,n,r){switch(e.readByte()){case t.CURVE_STEPPED:r.setStepped(n);break;case t.CURVE_BEZIER:this.setCurve(r,n,e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat())}},t.prototype.setCurve=function(t,e,n,r,i,s){t.setCurve(e,n,r,i,s)},t.AttachmentTypeValues=[0,1,2,3,4,5,6],t.TransformModeValues=[t7.Normal,t7.OnlyTranslation,t7.NoRotationOrReflection,t7.NoScale,t7.NoScaleOrReflection],t.PositionModeValues=[J9.Fixed,J9.Percent],t.SpacingModeValues=[mtt.Length,mtt.Fixed,mtt.Percent],t.RotateModeValues=[Q9.Tangent,Q9.Chain,Q9.ChainScale],t.BlendModeValues=[se.NORMAL,se.ADD,se.MULTIPLY,se.SCREEN],t.BONE_ROTATE=0,t.BONE_TRANSLATE=1,t.BONE_SCALE=2,t.BONE_SHEAR=3,t.SLOT_ATTACHMENT=0,t.SLOT_COLOR=1,t.SLOT_TWO_COLOR=2,t.PATH_POSITION=0,t.PATH_SPACING=1,t.PATH_MIX=2,t.CURVE_LINEAR=0,t.CURVE_STEPPED=1,t.CURVE_BEZIER=2,t}(),Ltt=function(t,e,n,r,i){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=r,this.inheritDeform=i},Btt=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.bones=t,this.vertices=e},$tt=function(){function t(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new _7((function(){return w7.newFloatArray(16)}))}return t.prototype.update=function(t,e){if(null==t)throw new Error("skeleton cannot be null.");var n=this.boundingBoxes,r=this.polygons,i=this.polygonPool,s=t.slots,a=s.length;n.length=0,i.freeAll(r),r.length=0;for(var o=0;o<a;o++){var l=s[o];if(l.bone.active){var h=l.getAttachment();if(h instanceof $7){var u=h;n.push(u);var c=i.obtain();c.length!=u.worldVerticesLength&&(c=w7.newFloatArray(u.worldVerticesLength)),r.push(c),u.computeWorldVertices(l,0,u.worldVerticesLength,c,0,2)}}}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},t.prototype.aabbCompute=function(){for(var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=this.polygons,s=0,a=i.length;s<a;s++)for(var o=i[s],l=o,h=0,u=o.length;h<u;h+=2){var c=l[h],d=l[h+1];t=Math.min(t,c),e=Math.min(e,d),n=Math.max(n,c),r=Math.max(r,d)}this.minX=t,this.minY=e,this.maxX=n,this.maxY=r},t.prototype.aabbContainsPoint=function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},t.prototype.aabbIntersectsSegment=function(t,e,n,r){var i=this.minX,s=this.minY,a=this.maxX,o=this.maxY;if(t<=i&&n<=i||e<=s&&r<=s||t>=a&&n>=a||e>=o&&r>=o)return!1;var l=(r-e)/(n-t),h=l*(i-t)+e;if(h>s&&h<o)return!0;if((h=l*(a-t)+e)>s&&h<o)return!0;var u=(s-e)/l+t;return u>i&&u<a||(u=(o-e)/l+t)>i&&u<a},t.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},t.prototype.containsPoint=function(t,e){for(var n=this.polygons,r=0,i=n.length;r<i;r++)if(this.containsPointPolygon(n[r],t,e))return this.boundingBoxes[r];return null},t.prototype.containsPointPolygon=function(t,e,n){for(var r=t,i=t.length,s=i-2,a=!1,o=0;o<i;o+=2){var l=r[o+1],h=r[s+1];if(l<n&&h>=n||h<n&&l>=n){var u=r[o];u+(n-l)/(h-l)*(r[s]-u)<e&&(a=!a)}s=o}return a},t.prototype.intersectsSegment=function(t,e,n,r){for(var i=this.polygons,s=0,a=i.length;s<a;s++)if(this.intersectsSegmentPolygon(i[s],t,e,n,r))return this.boundingBoxes[s];return null},t.prototype.intersectsSegmentPolygon=function(t,e,n,r,i){for(var s=t,a=t.length,o=e-r,l=n-i,h=e*i-n*r,u=s[a-2],c=s[a-1],d=0;d<a;d+=2){var p=s[d],f=s[d+1],m=u*f-c*p,g=u-p,y=c-f,v=o*y-l*g,x=(h*g-o*m)/v;if((x>=u&&x<=p||x>=p&&x<=u)&&(x>=e&&x<=r||x>=r&&x<=e)){var b=(h*y-l*m)/v;if((b>=c&&b<=f||b>=f&&b<=c)&&(b>=n&&b<=i||b>=i&&b<=n))return!0}u=p,c=f}return!1},t.prototype.getPolygon=function(t){if(null==t)throw new Error("boundingBox cannot be null.");var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},t.prototype.getWidth=function(){return this.maxX-this.minX},t.prototype.getHeight=function(){return this.maxY-this.minY},t}(),Utt=function(){function t(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return t.prototype.readSkeletonData=function(e){var n=this.scale,r=new Rtt,i="string"==typeof e?JSON.parse(e):e,s=i.skeleton;if(null!=s){if(r.hash=s.hash,r.version=s.spine,"3.8"!==r.version.substr(0,3))s.spine;if("3.8.75"===r.version);r.x=s.x,r.y=s.y,r.width=s.width,r.height=s.height,r.fps=s.fps,r.imagesPath=s.images}if(i.bones)for(var a=0;a<i.bones.length;a++){var o=i.bones[a],l=null,h=this.getValue(o,"parent",null);if(null!=h&&null==(l=r.findBone(h)))throw new Error("Parent bone not found: "+h);(p=new btt(r.bones.length,o.name,l)).length=this.getValue(o,"length",0)*n,p.x=this.getValue(o,"x",0)*n,p.y=this.getValue(o,"y",0)*n,p.rotation=this.getValue(o,"rotation",0),p.scaleX=this.getValue(o,"scaleX",1),p.scaleY=this.getValue(o,"scaleY",1),p.shearX=this.getValue(o,"shearX",0),p.shearY=this.getValue(o,"shearY",0),p.transformMode=t.transformModeFromString(this.getValue(o,"transform","normal")),p.skinRequired=this.getValue(o,"skin",!1),r.bones.push(p)}if(i.slots)for(a=0;a<i.slots.length;a++){var u=(S=i.slots[a]).name,c=S.bone,d=r.findBone(c);if(null==d)throw new Error("Slot bone not found: "+c);var p=new Mtt(r.slots.length,u,d),f=this.getValue(S,"color",null);null!=f&&p.color.setFromString(f);var m=this.getValue(S,"dark",null);null!=m&&(p.darkColor=new y7(1,1,1,1),p.darkColor.setFromString(m)),p.attachmentName=this.getValue(S,"attachment",null),p.blendMode=t.blendModeFromString(this.getValue(S,"blend","normal")),r.slots.push(p)}if(i.ik)for(a=0;a<i.ik.length;a++){var g=i.ik[a];(p=new Stt(g.name)).order=this.getValue(g,"order",0),p.skinRequired=this.getValue(g,"skin",!1);for(var y=0;y<g.bones.length;y++){c=g.bones[y];if(null==(_=r.findBone(c)))throw new Error("IK bone not found: "+c);p.bones.push(_)}var v=g.target;if(p.target=r.findBone(v),null==p.target)throw new Error("IK target bone not found: "+v);p.mix=this.getValue(g,"mix",1),p.softness=this.getValue(g,"softness",0)*n,p.bendDirection=this.getValue(g,"bendPositive",!0)?1:-1,p.compress=this.getValue(g,"compress",!1),p.stretch=this.getValue(g,"stretch",!1),p.uniform=this.getValue(g,"uniform",!1),r.ikConstraints.push(p)}if(i.transform)for(a=0;a<i.transform.length;a++){g=i.transform[a];(p=new Ott(g.name)).order=this.getValue(g,"order",0),p.skinRequired=this.getValue(g,"skin",!1);for(y=0;y<g.bones.length;y++){c=g.bones[y];if(null==(_=r.findBone(c)))throw new Error("Transform constraint bone not found: "+c);p.bones.push(_)}v=g.target;if(p.target=r.findBone(v),null==p.target)throw new Error("Transform constraint target bone not found: "+v);p.local=this.getValue(g,"local",!1),p.relative=this.getValue(g,"relative",!1),p.offsetRotation=this.getValue(g,"rotation",0),p.offsetX=this.getValue(g,"x",0)*n,p.offsetY=this.getValue(g,"y",0)*n,p.offsetScaleX=this.getValue(g,"scaleX",0),p.offsetScaleY=this.getValue(g,"scaleY",0),p.offsetShearY=this.getValue(g,"shearY",0),p.rotateMix=this.getValue(g,"rotateMix",1),p.translateMix=this.getValue(g,"translateMix",1),p.scaleMix=this.getValue(g,"scaleMix",1),p.shearMix=this.getValue(g,"shearMix",1),r.transformConstraints.push(p)}if(i.path)for(a=0;a<i.path.length;a++){g=i.path[a];(p=new Itt(g.name)).order=this.getValue(g,"order",0),p.skinRequired=this.getValue(g,"skin",!1);for(y=0;y<g.bones.length;y++){c=g.bones[y];if(null==(_=r.findBone(c)))throw new Error("Transform constraint bone not found: "+c);p.bones.push(_)}v=g.target;if(p.target=r.findSlot(v),null==p.target)throw new Error("Path target slot not found: "+v);p.positionMode=t.positionModeFromString(this.getValue(g,"positionMode","percent")),p.spacingMode=t.spacingModeFromString(this.getValue(g,"spacingMode","length")),p.rotateMode=t.rotateModeFromString(this.getValue(g,"rotateMode","tangent")),p.offsetRotation=this.getValue(g,"rotation",0),p.position=this.getValue(g,"position",0),p.positionMode==J9.Fixed&&(p.position*=n),p.spacing=this.getValue(g,"spacing",0),p.spacingMode!=mtt.Length&&p.spacingMode!=mtt.Fixed||(p.spacing*=n),p.rotateMix=this.getValue(g,"rotateMix",1),p.translateMix=this.getValue(g,"translateMix",1),r.pathConstraints.push(p)}if(i.skins)for(a=0;a<i.skins.length;a++){var x=i.skins[a],b=new Dtt(x.name);if(x.bones)for(var w=0;w<x.bones.length;w++){var _;if(null==(_=r.findBone(x.bones[w])))throw new Error("Skin bone not found: "+x.bones[a]);b.bones.push(_)}if(x.ik)for(w=0;w<x.ik.length;w++){if(null==(T=r.findIkConstraint(x.ik[w])))throw new Error("Skin IK constraint not found: "+x.ik[a]);b.constraints.push(T)}if(x.transform)for(w=0;w<x.transform.length;w++){if(null==(T=r.findTransformConstraint(x.transform[w])))throw new Error("Skin transform constraint not found: "+x.transform[a]);b.constraints.push(T)}if(x.path)for(w=0;w<x.path.length;w++){var T;if(null==(T=r.findPathConstraint(x.path[w])))throw new Error("Skin path constraint not found: "+x.path[a]);b.constraints.push(T)}for(var u in x.attachments){var E=r.findSlot(u);if(null==E)throw new Error("Slot not found: "+u);var S=x.attachments[u];for(var I in S){var k=this.readAttachment(S[I],b,E.index,I,r);null!=k&&b.setAttachment(E.index,I,k)}}r.skins.push(b),"default"==b.name&&(r.defaultSkin=b)}a=0;for(var C=this.linkedMeshes.length;a<C;a++){var N=this.linkedMeshes[a];if(null==(b=null==N.skin?r.defaultSkin:r.findSkin(N.skin)))throw new Error("Skin not found: "+N.skin);var A=b.getAttachment(N.slotIndex,N.parent);if(null==A)throw new Error("Parent mesh not found: "+N.parent);N.mesh.deformAttachment=N.inheritDeform?A:N.mesh,N.mesh.setParentMesh(A)}if(this.linkedMeshes.length=0,i.events)for(var R in i.events){var M=i.events[R];(p=new Ttt(R)).intValue=this.getValue(M,"int",0),p.floatValue=this.getValue(M,"float",0),p.stringValue=this.getValue(M,"string",""),p.audioPath=this.getValue(M,"audio",null),null!=p.audioPath&&(p.volume=this.getValue(M,"volume",1),p.balance=this.getValue(M,"balance",0)),r.events.push(p)}if(i.animations)for(var O in i.animations){var P=i.animations[O];this.readAnimation(P,O,r)}return r},t.prototype.readAttachment=function(t,e,n,r,i){var s=this.scale;switch(r=this.getValue(t,"name",r),this.getValue(t,"type","region")){case"region":var a=this.getValue(t,"path",r),o=this.attachmentLoader.newRegionAttachment(e,r,a);return null==o?null:(o.path=a,o.x=this.getValue(t,"x",0)*s,o.y=this.getValue(t,"y",0)*s,o.scaleX=this.getValue(t,"scaleX",1),o.scaleY=this.getValue(t,"scaleY",1),o.rotation=this.getValue(t,"rotation",0),o.width=t.width*s,o.height=t.height*s,null!=(x=this.getValue(t,"color",null))&&o.color.setFromString(x),o);case"boundingbox":var l=this.attachmentLoader.newBoundingBoxAttachment(e,r);return null==l?null:(this.readVertices(t,l,t.vertexCount<<1),null!=(x=this.getValue(t,"color",null))&&l.color.setFromString(x),l);case"mesh":case"linkedmesh":a=this.getValue(t,"path",r);var h=this.attachmentLoader.newMeshAttachment(e,r,a);if(null==h)return null;h.path=a,null!=(x=this.getValue(t,"color",null))&&h.color.setFromString(x),h.width=this.getValue(t,"width",0)*s,h.height=this.getValue(t,"height",0)*s;var u=this.getValue(t,"parent",null);if(null!=u)return this.linkedMeshes.push(new Vtt(h,this.getValue(t,"skin",null),n,u,this.getValue(t,"deform",!0))),h;var c=t.uvs;return this.readVertices(t,h,c.length),h.triangles=t.triangles,h.regionUVs=new Float32Array(c),h.edges=this.getValue(t,"edges",null),h.hullLength=2*this.getValue(t,"hull",0),h;case"path":if(null==(a=this.attachmentLoader.newPathAttachment(e,r)))return null;a.closed=this.getValue(t,"closed",!1),a.constantSpeed=this.getValue(t,"constantSpeed",!0);var d=t.vertexCount;this.readVertices(t,a,d<<1);for(var p=w7.newArray(d/3,0),f=0;f<t.lengths.length;f++)p[f]=t.lengths[f]*s;return a.lengths=p,null!=(x=this.getValue(t,"color",null))&&a.color.setFromString(x),a;case"point":var m=this.attachmentLoader.newPointAttachment(e,r);return null==m?null:(m.x=this.getValue(t,"x",0)*s,m.y=this.getValue(t,"y",0)*s,m.rotation=this.getValue(t,"rotation",0),null!=(x=this.getValue(t,"color",null))&&m.color.setFromString(x),m);case"clipping":var g=this.attachmentLoader.newClippingAttachment(e,r);if(null==g)return null;var y=this.getValue(t,"end",null);if(null!=y){var v=i.findSlot(y);if(null==v)throw new Error("Clipping end slot not found: "+y);g.endSlot=v}var x;d=t.vertexCount;return this.readVertices(t,g,d<<1),null!=(x=this.getValue(t,"color",null))&&g.color.setFromString(x),g}return null},t.prototype.readVertices=function(t,e,n){var r=this.scale;e.worldVerticesLength=n;var i=t.vertices;if(n!=i.length){var s=new Array,a=new Array;for(u=0,c=i.length;u<c;){var o=i[u++];a.push(o);for(var l=u+4*o;u<l;u+=4)a.push(i[u]),s.push(i[u+1]*r),s.push(i[u+2]*r),s.push(i[u+3])}e.bones=a,e.vertices=w7.toFloatArray(s)}else{var h=w7.toFloatArray(i);if(1!=r)for(var u=0,c=i.length;u<c;u++)h[u]*=r;e.vertices=h}},t.prototype.readAnimation=function(t,e,n){var r=this.scale,i=new Array,s=0;if(t.slots)for(var a in t.slots){var o=t.slots[a];if(-1==(q=n.findSlotIndex(a)))throw new Error("Slot not found: "+a);for(var l in o){var h=o[l];if("attachment"==l){(x=new ntt(h.length)).slotIndex=q;for(var u=0,c=0;c<h.length;c++){var d=h[c];x.setFrame(u++,this.getValue(d,"time",0),d.name)}i.push(x),s=Math.max(s,x.frames[x.getFrameCount()-1])}else if("color"==l){(x=new ttt(h.length)).slotIndex=q;for(u=0,c=0;c<h.length;c++){d=h[c];var p=new y7;p.setFromString(d.color||"ffffffff"),x.setFrame(u,this.getValue(d,"time",0),p.r,p.g,p.b,p.a),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[(x.getFrameCount()-1)*ttt.ENTRIES])}else{if("twoColor"!=l)throw new Error("Invalid timeline type for a slot: "+l+" ("+a+")");(x=new ett(h.length)).slotIndex=q;for(u=0,c=0;c<h.length;c++){d=h[c];var f=new y7,m=new y7;f.setFromString(d.light),m.setFromString(d.dark),x.setFrame(u,this.getValue(d,"time",0),f.r,f.g,f.b,f.a,m.r,m.g,m.b),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[(x.getFrameCount()-1)*ett.ENTRIES])}}}if(t.bones)for(var g in t.bones){var y=t.bones[g],v=n.findBoneIndex(g);if(-1==v)throw new Error("Bone not found: "+g);for(var l in y){h=y[l];if("rotate"===l){(x=new K7(h.length)).boneIndex=v;for(u=0,c=0;c<h.length;c++){d=h[c];x.setFrame(u,this.getValue(d,"time",0),this.getValue(d,"angle",0)),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[(x.getFrameCount()-1)*K7.ENTRIES])}else{if("translate"!==l&&"scale"!==l&&"shear"!==l)throw new Error("Invalid timeline type for a bone: "+l+" ("+g+")");var x=null,b=1,w=0;"scale"===l?(x=new J7(h.length),w=1):"shear"===l?x=new Q7(h.length):(x=new Z7(h.length),b=r),x.boneIndex=v;for(u=0,c=0;c<h.length;c++){d=h[c];var _=this.getValue(d,"x",w),T=this.getValue(d,"y",w);x.setFrame(u,this.getValue(d,"time",0),_*b,T*b),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[(x.getFrameCount()-1)*Z7.ENTRIES])}}}if(t.ik)for(var E in t.ik){var S=t.ik[E],I=n.findIkConstraint(E);(x=new ott(S.length)).ikConstraintIndex=n.ikConstraints.indexOf(I);for(u=0,c=0;c<S.length;c++){d=S[c];x.setFrame(u,this.getValue(d,"time",0),this.getValue(d,"mix",1),this.getValue(d,"softness",0)*r,this.getValue(d,"bendPositive",!0)?1:-1,this.getValue(d,"compress",!1),this.getValue(d,"stretch",!1)),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[(x.getFrameCount()-1)*ott.ENTRIES])}if(t.transform)for(var E in t.transform){S=t.transform[E],I=n.findTransformConstraint(E);(x=new ltt(S.length)).transformConstraintIndex=n.transformConstraints.indexOf(I);for(u=0,c=0;c<S.length;c++){d=S[c];x.setFrame(u,this.getValue(d,"time",0),this.getValue(d,"rotateMix",1),this.getValue(d,"translateMix",1),this.getValue(d,"scaleMix",1),this.getValue(d,"shearMix",1)),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[(x.getFrameCount()-1)*ltt.ENTRIES])}if(t.path)for(var E in t.path){S=t.path[E];var k=n.findPathConstraintIndex(E);if(-1==k)throw new Error("Path constraint not found: "+E);var C=n.pathConstraints[k];for(var l in S){h=S[l];if("position"===l||"spacing"===l){x=null,b=1;"spacing"===l?(x=new utt(h.length),C.spacingMode!=mtt.Length&&C.spacingMode!=mtt.Fixed||(b=r)):(x=new htt(h.length),C.positionMode==J9.Fixed&&(b=r)),x.pathConstraintIndex=k;for(u=0,c=0;c<h.length;c++){d=h[c];x.setFrame(u,this.getValue(d,"time",0),this.getValue(d,l,0)*b),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[(x.getFrameCount()-1)*htt.ENTRIES])}else if("mix"===l){(x=new ctt(h.length)).pathConstraintIndex=k;for(u=0,c=0;c<h.length;c++){d=h[c];x.setFrame(u,this.getValue(d,"time",0),this.getValue(d,"rotateMix",1),this.getValue(d,"translateMix",1)),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[(x.getFrameCount()-1)*ctt.ENTRIES])}}}if(t.deform)for(var N in t.deform){var A=t.deform[N],R=n.findSkin(N);if(null!=R)for(var a in A){o=A[a];if(-1==(q=n.findSlotIndex(a)))throw new Error("Slot not found: "+o.name);for(var l in o){h=o[l];var M=R.getAttachment(q,l);if(null==M)throw new Error("Deform attachment not found: "+h.name);var O=null!=M.bones,P=M.vertices,D=O?P.length/3*2:P.length;(x=new itt(h.length)).slotIndex=q,x.attachment=M;u=0;for(var F=0;F<h.length;F++){d=h[F];var L=void 0,B=this.getValue(d,"vertices",null);if(null==B)L=O?w7.newFloatArray(D):P;else{L=w7.newFloatArray(D);var $=this.getValue(d,"offset",0);if(w7.arrayCopy(B,0,L,$,B.length),1!=r)for(var U=(c=$)+B.length;c<U;c++)L[c]*=r;if(!O)for(c=0;c<D;c++)L[c]+=P[c]}x.setFrame(u,this.getValue(d,"time",0),L),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[x.getFrameCount()-1])}}else if(S7)throw new Error("Skin not found: "+N)}var V=t.drawOrder;if(null==V&&(V=t.draworder),null!=V){x=new att(V.length);var z=n.slots.length;for(u=0,F=0;F<V.length;F++){var G=V[F],W=null,X=this.getValue(G,"offsets",null);if(null!=X){W=w7.newArray(z,-1);var H=w7.newArray(z-X.length,0),Y=0,j=0;for(c=0;c<X.length;c++){var q,K=X[c];if(-1==(q=n.findSlotIndex(K.slot)))throw new Error("Slot not found: "+K.slot);for(;Y!=q;)H[j++]=Y++;W[Y+K.offset]=Y++}for(;Y<z;)H[j++]=Y++;for(c=z-1;c>=0;c--)-1==W[c]&&(W[c]=H[--j])}x.setFrame(u++,this.getValue(G,"time",0),W)}i.push(x),s=Math.max(s,x.frames[x.getFrameCount()-1])}if(t.events){for(x=new stt(t.events.length),u=0,c=0;c<t.events.length;c++){var Z=t.events[c],J=n.findEvent(Z.name);if(null==J)throw new Error("Event not found: "+Z.name);var Q=new _tt(w7.toSinglePrecision(this.getValue(Z,"time",0)),J);Q.intValue=this.getValue(Z,"int",J.intValue),Q.floatValue=this.getValue(Z,"float",J.floatValue),Q.stringValue=this.getValue(Z,"string",J.stringValue),null!=Q.data.audioPath&&(Q.volume=this.getValue(Z,"volume",1),Q.balance=this.getValue(Z,"balance",0)),x.setFrame(u++,Q)}i.push(x),s=Math.max(s,x.frames[x.getFrameCount()-1])}if(isNaN(s))throw new Error("Error while parsing animation, duration is NaN");n.animations.push(new Y7(e,i,s))},t.prototype.readCurve=function(t,e,n){if(t.hasOwnProperty("curve"))if("stepped"===t.curve)e.setStepped(n);else{var r=t.curve;e.setCurve(n,r,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1))}},t.prototype.getValue=function(t,e,n){return void 0!==t[e]?t[e]:n},t.blendModeFromString=function(t){if("normal"==(t=t.toLowerCase()))return se.NORMAL;if("additive"==t)return se.ADD;if("multiply"==t)return se.MULTIPLY;if("screen"==t)return se.SCREEN;throw new Error("Unknown blend mode: "+t)},t.positionModeFromString=function(t){if("fixed"==(t=t.toLowerCase()))return J9.Fixed;if("percent"==t)return J9.Percent;throw new Error("Unknown position mode: "+t)},t.spacingModeFromString=function(t){if("length"==(t=t.toLowerCase()))return mtt.Length;if("fixed"==t)return mtt.Fixed;if("percent"==t)return mtt.Percent;throw new Error("Unknown position mode: "+t)},t.rotateModeFromString=function(t){if("tangent"==(t=t.toLowerCase()))return Q9.Tangent;if("chain"==t)return Q9.Chain;if("chainscale"==t)return Q9.ChainScale;throw new Error("Unknown rotate mode: "+t)},t.transformModeFromString=function(t){if("normal"==(t=t.toLowerCase()))return t7.Normal;if("onlytranslation"==t)return t7.OnlyTranslation;if("norotationorreflection"==t)return t7.NoRotationOrReflection;if("noscale"==t)return t7.NoScale;if("noscaleorreflection"==t)return t7.NoScaleOrReflection;throw new Error("Unknown transform mode: "+t)},t}(),Vtt=function(t,e,n,r,i){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=r,this.inheritDeform=i},ztt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return D7(e,t),e.prototype.createSkeleton=function(t){this.skeleton=new Att(t),this.skeleton.updateWorldTransform(),this.stateData=new ytt(t),this.state=new dtt(this.stateData)},e}(R7),Gtt=function(t,e){return Gtt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},Gtt(t,e)};function Wtt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}Gtt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var Xtt,Htt=function(t){if(null==t)throw new Error("name cannot be null.");this.name=t},Ytt=function(t){function e(n){var r=t.call(this,n)||this;return r.id=(65535&e.nextID++)<<11,r.worldVerticesLength=0,r}return Wtt(e,t),e.prototype.computeWorldVerticesOld=function(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)},e.prototype.computeWorldVertices=function(t,e,n,r,i,s){n=i+(n>>1)*s;var a=t.bone.skeleton,o=t.attachmentVertices,l=this.vertices,h=this.bones;if(null!=h){for(var u=0,c=0,d=0;d<e;d+=2){u+=(g=h[u])+1,c+=g}var p=a.bones;if(0==o.length)for(C=i,E=3*c;C<n;C+=s){var f=0,m=0,g=h[u++];for(g+=u;u<g;u++,E+=3){b=p[h[u]].matrix,N=l[E],A=l[E+1];var y=l[E+2];f+=(N*b.a+A*b.c+b.tx)*y,m+=(N*b.b+A*b.d+b.ty)*y}r[C]=f,r[C+1]=m}else for(var v=o,x=(C=i,E=3*c,c<<1);C<n;C+=s){f=0,m=0,g=h[u++];for(g+=u;u<g;u++,E+=3,x+=2){b=p[h[u]].matrix,N=l[E]+v[x],A=l[E+1]+v[x+1],y=l[E+2];f+=(N*b.a+A*b.c+b.tx)*y,m+=(N*b.b+A*b.d+b.ty)*y}r[C]=f,r[C+1]=m}}else{o.length>0&&(l=o);for(var b,w=(b=t.bone.matrix).tx,_=b.ty,T=b.a,E=b.c,S=b.b,I=b.d,k=e,C=i;C<n;k+=2,C+=s){var N=l[k],A=l[k+1];r[C]=N*T+A*E+w,r[C+1]=N*S+A*I+_}}},e.prototype.applyDeform=function(t){return this==t},e.nextID=0,e}(Htt),jtt=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.BoundingBox,n.color=new y7(1,1,1,1),n}return Wtt(e,t),e}(Ytt),qtt=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.Clipping,n.color=new y7(.2275,.2275,.8078,1),n}return Wtt(e,t),e}(Ytt),Ktt=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.Mesh,n.color=new y7(1,1,1,1),n.inheritDeform=!1,n.tempColor=new y7(0,0,0,0),n}return Wtt(e,t),e.prototype.applyDeform=function(t){return this==t||this.inheritDeform&&this.parentMesh==t},e.prototype.getParentMesh=function(){return this.parentMesh},e.prototype.setParentMesh=function(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)},e}(Ytt),Ztt=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.Path,n.closed=!1,n.constantSpeed=!1,n.color=new y7(1,1,1,1),n}return Wtt(e,t),e}(Ytt),Jtt=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.Point,n.color=new y7(.38,.94,0,1),n}return Wtt(e,t),e.prototype.computeWorldPosition=function(t,e){var n=t.matrix;return e.x=this.x*n.a+this.y*n.c+t.worldX,e.y=this.x*n.b+this.y*n.d+t.worldY,e},e.prototype.computeWorldRotation=function(t){var e=t.matrix,n=v7.cosDeg(this.rotation),r=v7.sinDeg(this.rotation),i=n*e.a+r*e.c,s=n*e.b+r*e.d;return Math.atan2(s,i)*v7.radDeg},e}(Ytt),Qtt=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.Region,n.x=0,n.y=0,n.scaleX=1,n.scaleY=1,n.rotation=0,n.width=0,n.height=0,n.color=new y7(1,1,1,1),n.offset=w7.newFloatArray(8),n.uvs=w7.newFloatArray(8),n.tempColor=new y7(1,1,1,1),n}return Wtt(e,t),e.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX,n=this.height/this.region.originalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.region.offsetX*t,i=-this.height/2*this.scaleY+this.region.offsetY*n,s=r+this.region.width*t,a=i+this.region.height*n,o=this.rotation*Math.PI/180,l=Math.cos(o),h=Math.sin(o),u=r*l+this.x,c=r*h,d=i*l+this.y,p=i*h,f=s*l+this.x,m=s*h,g=a*l+this.y,y=a*h,v=this.offset;v[e.OX1]=u-p,v[e.OY1]=d+c,v[e.OX2]=u-y,v[e.OY2]=g+c,v[e.OX3]=f-y,v[e.OY3]=g+m,v[e.OX4]=f-p,v[e.OY4]=d+m},e.prototype.setRegion=function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)},e.prototype.computeWorldVertices=function(t,n,r,i){var s=this.offset,a=t.matrix,o=a.tx,l=a.ty,h=a.a,u=a.c,c=a.b,d=a.d,p=0,f=0;p=s[e.OX1],f=s[e.OY1],n[r]=p*h+f*u+o,n[r+1]=p*c+f*d+l,r+=i,p=s[e.OX2],f=s[e.OY2],n[r]=p*h+f*u+o,n[r+1]=p*c+f*d+l,r+=i,p=s[e.OX3],f=s[e.OY3],n[r]=p*h+f*u+o,n[r+1]=p*c+f*d+l,r+=i,p=s[e.OX4],f=s[e.OY4],n[r]=p*h+f*u+o,n[r+1]=p*c+f*d+l},e.OX1=0,e.OY1=1,e.OX2=2,e.OY2=3,e.OX3=4,e.OY3=5,e.OX4=6,e.OY4=7,e.X1=0,e.Y1=1,e.C1R=2,e.C1G=3,e.C1B=4,e.C1A=5,e.U1=6,e.V1=7,e.X2=8,e.Y2=9,e.C2R=10,e.C2G=11,e.C2B=12,e.C2A=13,e.U2=14,e.V2=15,e.X3=16,e.Y3=17,e.C3R=18,e.C3G=19,e.C3B=20,e.C3A=21,e.U3=22,e.V3=23,e.X4=24,e.Y4=25,e.C4R=26,e.C4G=27,e.C4B=28,e.C4A=29,e.U4=30,e.V4=31,e}(Htt),tet=function(){function t(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}return t.prototype.begin=function(t){},t.prototype.transform=function(t,e,n,r){t.x+=v7.randomTriangular(-this.jitterX,this.jitterY),t.y+=v7.randomTriangular(-this.jitterX,this.jitterY)},t.prototype.end=function(){},t}(),eet=function(){function t(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}return t.prototype.begin=function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY},t.prototype.transform=function(e,n,r,i){var s=this.angle*v7.degreesToRadians,a=e.x-this.worldX,o=e.y-this.worldY,l=Math.sqrt(a*a+o*o);if(l<this.radius){var h=t.interpolation.apply(0,s,(this.radius-l)/this.radius),u=Math.cos(h),c=Math.sin(h);e.x=u*a-c*o+this.worldX,e.y=c*a+u*o+this.worldY}},t.prototype.end=function(){},t.interpolation=new b7(2),t}(),net=function(){function t(t,e,n){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.duration=n}return t.prototype.apply=function(t,e,n,r,i,s,a,o){if(null==t)throw new Error("skeleton cannot be null.");r&&0!=this.duration&&(n%=this.duration,e>0&&(e%=this.duration));for(var l=this.timelines,h=0,u=l.length;h<u;h++)l[h].apply(t,e,n,i,s,a,o)},t.binarySearch=function(t,e,n){void 0===n&&(n=1);var r=0,i=t.length/n-2;if(0==i)return n;for(var s=i>>>1;;){if(t[(s+1)*n]<=e?r=s+1:i=s,r==i)return(r+1)*n;s=r+i>>>1}},t.linearSearch=function(t,e,n){for(var r=0,i=t.length-n;r<=i;r+=n)if(t[r]>e)return r;return-1},t}();!function(t){t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor"}(Xtt||(Xtt={}));var ret,iet=function(){function t(e){if(e<=0)throw new Error("frameCount must be > 0: "+e);this.curves=w7.newFloatArray((e-1)*t.BEZIER_SIZE)}return t.prototype.getFrameCount=function(){return this.curves.length/t.BEZIER_SIZE+1},t.prototype.setLinear=function(e){this.curves[e*t.BEZIER_SIZE]=t.LINEAR},t.prototype.setStepped=function(e){this.curves[e*t.BEZIER_SIZE]=t.STEPPED},t.prototype.getCurveType=function(e){var n=e*t.BEZIER_SIZE;if(n==this.curves.length)return t.LINEAR;var r=this.curves[n];return r==t.LINEAR?t.LINEAR:r==t.STEPPED?t.STEPPED:t.BEZIER},t.prototype.setCurve=function(e,n,r,i,s){var a=.03*(2*-n+i),o=.03*(2*-r+s),l=.006*(3*(n-i)+1),h=.006*(3*(r-s)+1),u=2*a+l,c=2*o+h,d=.3*n+a+.16666667*l,p=.3*r+o+.16666667*h,f=e*t.BEZIER_SIZE,m=this.curves;m[f++]=t.BEZIER;for(var g=d,y=p,v=f+t.BEZIER_SIZE-1;f<v;f+=2)m[f]=g,m[f+1]=y,d+=u,p+=c,u+=l,c+=h,g+=d,y+=p},t.prototype.getCurvePercent=function(e,n){n=v7.clamp(n,0,1);var r=this.curves,i=e*t.BEZIER_SIZE,s=r[i];if(s==t.LINEAR)return n;if(s==t.STEPPED)return 0;for(var a=0,o=++i,l=i+t.BEZIER_SIZE-1;i<l;i+=2)if((a=r[i])>=n){var h=void 0,u=void 0;return i==o?(h=0,u=0):(h=r[i-2],u=r[i-1]),u+(r[i+1]-u)*(n-h)/(a-h)}var c=r[i-1];return c+(1-c)*(n-a)/(1-a)},t.LINEAR=0,t.STEPPED=1,t.BEZIER=2,t.BEZIER_SIZE=19,t}(),set=function(t){function e(e){var n=t.call(this,e)||this;return n.frames=w7.newFloatArray(e<<1),n}return Wtt(e,t),e.prototype.getPropertyId=function(){return(Xtt.rotate<<24)+this.boneIndex},e.prototype.setFrame=function(t,n,r){t<<=1,this.frames[t]=n,this.frames[t+e.ROTATION]=r},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.bones[this.boneIndex];if(r<l[0])switch(a){case K9.setup:return void(h.rotation=h.data.rotation);case K9.first:var u=h.data.rotation-h.rotation;h.rotation+=(u-360*(16384-(16384.499999999996-u/360|0)))*s}else if(r>=l[l.length-e.ENTRIES]){var c=l[l.length+e.PREV_ROTATION];switch(a){case K9.setup:h.rotation=h.data.rotation+c*s;break;case K9.first:case K9.replace:c+=h.data.rotation-h.rotation,c-=360*(16384-(16384.499999999996-c/360|0));case K9.add:h.rotation+=c*s}}else{var d=net.binarySearch(l,r,e.ENTRIES),p=l[d+e.PREV_ROTATION],f=l[d],m=this.getCurvePercent((d>>1)-1,1-(r-f)/(l[d+e.PREV_TIME]-f)),g=l[d+e.ROTATION]-p;switch(g=p+(g-360*(16384-(16384.499999999996-g/360|0)))*m,a){case K9.setup:h.rotation=h.data.rotation+(g-360*(16384-(16384.499999999996-g/360|0)))*s;break;case K9.first:case K9.replace:g+=h.data.rotation-h.rotation;case K9.add:h.rotation+=(g-360*(16384-(16384.499999999996-g/360|0)))*s}}},e.ENTRIES=2,e.PREV_TIME=-2,e.PREV_ROTATION=-1,e.ROTATION=1,e}(iet),aet=function(t){function e(n){var r=t.call(this,n)||this;return r.frames=w7.newFloatArray(n*e.ENTRIES),r}return Wtt(e,t),e.prototype.getPropertyId=function(){return(Xtt.translate<<24)+this.boneIndex},e.prototype.setFrame=function(t,n,r,i){t*=e.ENTRIES,this.frames[t]=n,this.frames[t+e.X]=r,this.frames[t+e.Y]=i},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.bones[this.boneIndex];if(r<l[0])switch(a){case K9.setup:return h.x=h.data.x,void(h.y=h.data.y);case K9.first:h.x+=(h.data.x-h.x)*s,h.y+=(h.data.y-h.y)*s}else{var u=0,c=0;if(r>=l[l.length-e.ENTRIES])u=l[l.length+e.PREV_X],c=l[l.length+e.PREV_Y];else{var d=net.binarySearch(l,r,e.ENTRIES);u=l[d+e.PREV_X],c=l[d+e.PREV_Y];var p=l[d],f=this.getCurvePercent(d/e.ENTRIES-1,1-(r-p)/(l[d+e.PREV_TIME]-p));u+=(l[d+e.X]-u)*f,c+=(l[d+e.Y]-c)*f}switch(a){case K9.setup:h.x=h.data.x+u*s,h.y=h.data.y+c*s;break;case K9.first:case K9.replace:h.x+=(h.data.x+u-h.x)*s,h.y+=(h.data.y+c-h.y)*s;break;case K9.add:h.x+=u*s,h.y+=c*s}}},e.ENTRIES=3,e.PREV_TIME=-3,e.PREV_X=-2,e.PREV_Y=-1,e.X=1,e.Y=2,e}(iet),oet=function(t){function e(e){return t.call(this,e)||this}return Wtt(e,t),e.prototype.getPropertyId=function(){return(Xtt.scale<<24)+this.boneIndex},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.bones[this.boneIndex];if(r<l[0])switch(a){case K9.setup:return h.scaleX=h.data.scaleX,void(h.scaleY=h.data.scaleY);case K9.first:h.scaleX+=(h.data.scaleX-h.scaleX)*s,h.scaleY+=(h.data.scaleY-h.scaleY)*s}else{var u=0,c=0;if(r>=l[l.length-e.ENTRIES])u=l[l.length+e.PREV_X]*h.data.scaleX,c=l[l.length+e.PREV_Y]*h.data.scaleY;else{var d=net.binarySearch(l,r,e.ENTRIES);u=l[d+e.PREV_X],c=l[d+e.PREV_Y];var p=l[d],f=this.getCurvePercent(d/e.ENTRIES-1,1-(r-p)/(l[d+e.PREV_TIME]-p));u=(u+(l[d+e.X]-u)*f)*h.data.scaleX,c=(c+(l[d+e.Y]-c)*f)*h.data.scaleY}if(1==s)a==K9.add?(h.scaleX+=u-h.data.scaleX,h.scaleY+=c-h.data.scaleY):(h.scaleX=u,h.scaleY=c);else{var m=0,g=0;if(o==Z9.mixOut)switch(a){case K9.setup:m=h.data.scaleX,g=h.data.scaleY,h.scaleX=m+(Math.abs(u)*v7.signum(m)-m)*s,h.scaleY=g+(Math.abs(c)*v7.signum(g)-g)*s;break;case K9.first:case K9.replace:m=h.scaleX,g=h.scaleY,h.scaleX=m+(Math.abs(u)*v7.signum(m)-m)*s,h.scaleY=g+(Math.abs(c)*v7.signum(g)-g)*s;break;case K9.add:m=h.scaleX,g=h.scaleY,h.scaleX=m+(Math.abs(u)*v7.signum(m)-h.data.scaleX)*s,h.scaleY=g+(Math.abs(c)*v7.signum(g)-h.data.scaleY)*s}else switch(a){case K9.setup:m=Math.abs(h.data.scaleX)*v7.signum(u),g=Math.abs(h.data.scaleY)*v7.signum(c),h.scaleX=m+(u-m)*s,h.scaleY=g+(c-g)*s;break;case K9.first:case K9.replace:m=Math.abs(h.scaleX)*v7.signum(u),g=Math.abs(h.scaleY)*v7.signum(c),h.scaleX=m+(u-m)*s,h.scaleY=g+(c-g)*s;break;case K9.add:m=v7.signum(u),g=v7.signum(c),h.scaleX=Math.abs(h.scaleX)*m+(u-Math.abs(h.data.scaleX)*m)*s,h.scaleY=Math.abs(h.scaleY)*g+(c-Math.abs(h.data.scaleY)*g)*s}}}},e}(aet),het=function(t){function e(e){return t.call(this,e)||this}return Wtt(e,t),e.prototype.getPropertyId=function(){return(Xtt.shear<<24)+this.boneIndex},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.bones[this.boneIndex];if(r<l[0])switch(a){case K9.setup:return h.shearX=h.data.shearX,void(h.shearY=h.data.shearY);case K9.first:h.shearX+=(h.data.shearX-h.shearX)*s,h.shearY+=(h.data.shearY-h.shearY)*s}else{var u=0,c=0;if(r>=l[l.length-e.ENTRIES])u=l[l.length+e.PREV_X],c=l[l.length+e.PREV_Y];else{var d=net.binarySearch(l,r,e.ENTRIES);u=l[d+e.PREV_X],c=l[d+e.PREV_Y];var p=l[d],f=this.getCurvePercent(d/e.ENTRIES-1,1-(r-p)/(l[d+e.PREV_TIME]-p));u+=(l[d+e.X]-u)*f,c+=(l[d+e.Y]-c)*f}switch(a){case K9.setup:h.shearX=h.data.shearX+u*s,h.shearY=h.data.shearY+c*s;break;case K9.first:case K9.replace:h.shearX+=(h.data.shearX+u-h.shearX)*s,h.shearY+=(h.data.shearY+c-h.shearY)*s;break;case K9.add:h.shearX+=u*s,h.shearY+=c*s}}},e}(aet),uet=function(t){function e(n){var r=t.call(this,n)||this;return r.frames=w7.newFloatArray(n*e.ENTRIES),r}return Wtt(e,t),e.prototype.getPropertyId=function(){return(Xtt.color<<24)+this.slotIndex},e.prototype.setFrame=function(t,n,r,i,s,a){t*=e.ENTRIES,this.frames[t]=n,this.frames[t+e.R]=r,this.frames[t+e.G]=i,this.frames[t+e.B]=s,this.frames[t+e.A]=a},e.prototype.apply=function(t,n,r,i,s,a,o){var l=t.slots[this.slotIndex],h=this.frames;if(r<h[0])switch(a){case K9.setup:return void l.color.setFromColor(l.data.color);case K9.first:var u=l.color,c=l.data.color;u.add((c.r-u.r)*s,(c.g-u.g)*s,(c.b-u.b)*s,(c.a-u.a)*s)}else{var d=0,p=0,f=0,m=0;if(r>=h[h.length-e.ENTRIES]){var g=h.length;d=h[g+e.PREV_R],p=h[g+e.PREV_G],f=h[g+e.PREV_B],m=h[g+e.PREV_A]}else{var y=net.binarySearch(h,r,e.ENTRIES);d=h[y+e.PREV_R],p=h[y+e.PREV_G],f=h[y+e.PREV_B],m=h[y+e.PREV_A];var v=h[y],x=this.getCurvePercent(y/e.ENTRIES-1,1-(r-v)/(h[y+e.PREV_TIME]-v));d+=(h[y+e.R]-d)*x,p+=(h[y+e.G]-p)*x,f+=(h[y+e.B]-f)*x,m+=(h[y+e.A]-m)*x}if(1==s)l.color.set(d,p,f,m);else{u=l.color;a==K9.setup&&u.setFromColor(l.data.color),u.add((d-u.r)*s,(p-u.g)*s,(f-u.b)*s,(m-u.a)*s)}}},e.ENTRIES=5,e.PREV_TIME=-5,e.PREV_R=-4,e.PREV_G=-3,e.PREV_B=-2,e.PREV_A=-1,e.R=1,e.G=2,e.B=3,e.A=4,e}(iet),cet=function(t){function e(n){var r=t.call(this,n)||this;return r.frames=w7.newFloatArray(n*e.ENTRIES),r}return Wtt(e,t),e.prototype.getPropertyId=function(){return(Xtt.twoColor<<24)+this.slotIndex},e.prototype.setFrame=function(t,n,r,i,s,a,o,l,h){t*=e.ENTRIES,this.frames[t]=n,this.frames[t+e.R]=r,this.frames[t+e.G]=i,this.frames[t+e.B]=s,this.frames[t+e.A]=a,this.frames[t+e.R2]=o,this.frames[t+e.G2]=l,this.frames[t+e.B2]=h},e.prototype.apply=function(t,n,r,i,s,a,o){var l=t.slots[this.slotIndex],h=this.frames;if(r<h[0])switch(a){case K9.setup:return l.color.setFromColor(l.data.color),void l.darkColor.setFromColor(l.data.darkColor);case K9.first:var u=l.color,c=l.darkColor,d=l.data.color,p=l.data.darkColor;u.add((d.r-u.r)*s,(d.g-u.g)*s,(d.b-u.b)*s,(d.a-u.a)*s),c.add((p.r-c.r)*s,(p.g-c.g)*s,(p.b-c.b)*s,0)}else{var f=0,m=0,g=0,y=0,v=0,x=0,b=0;if(r>=h[h.length-e.ENTRIES]){var w=h.length;f=h[w+e.PREV_R],m=h[w+e.PREV_G],g=h[w+e.PREV_B],y=h[w+e.PREV_A],v=h[w+e.PREV_R2],x=h[w+e.PREV_G2],b=h[w+e.PREV_B2]}else{var _=net.binarySearch(h,r,e.ENTRIES);f=h[_+e.PREV_R],m=h[_+e.PREV_G],g=h[_+e.PREV_B],y=h[_+e.PREV_A],v=h[_+e.PREV_R2],x=h[_+e.PREV_G2],b=h[_+e.PREV_B2];var T=h[_],E=this.getCurvePercent(_/e.ENTRIES-1,1-(r-T)/(h[_+e.PREV_TIME]-T));f+=(h[_+e.R]-f)*E,m+=(h[_+e.G]-m)*E,g+=(h[_+e.B]-g)*E,y+=(h[_+e.A]-y)*E,v+=(h[_+e.R2]-v)*E,x+=(h[_+e.G2]-x)*E,b+=(h[_+e.B2]-b)*E}if(1==s)l.color.set(f,m,g,y),l.darkColor.set(v,x,b,1);else{u=l.color,c=l.darkColor;a==K9.setup&&(u.setFromColor(l.data.color),c.setFromColor(l.data.darkColor)),u.add((f-u.r)*s,(m-u.g)*s,(g-u.b)*s,(y-u.a)*s),c.add((v-c.r)*s,(x-c.g)*s,(b-c.b)*s,0)}}},e.ENTRIES=8,e.PREV_TIME=-8,e.PREV_R=-7,e.PREV_G=-6,e.PREV_B=-5,e.PREV_A=-4,e.PREV_R2=-3,e.PREV_G2=-2,e.PREV_B2=-1,e.R=1,e.G=2,e.B=3,e.A=4,e.R2=5,e.G2=6,e.B2=7,e}(iet),det=function(){function t(t){this.frames=w7.newFloatArray(t),this.attachmentNames=new Array(t)}return t.prototype.getPropertyId=function(){return(Xtt.attachment<<24)+this.slotIndex},t.prototype.getFrameCount=function(){return this.frames.length},t.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.attachmentNames[t]=n},t.prototype.apply=function(t,e,n,r,i,s,a){var o=t.slots[this.slotIndex];if(a!=Z9.mixOut||s!=K9.setup){var l=this.frames;if(n<l[0]){if(s==K9.setup||s==K9.first){var h=o.data.attachmentName;o.setAttachment(null==h?null:t.getAttachment(this.slotIndex,h))}}else{var u=0;u=n>=l[l.length-1]?l.length-1:net.binarySearch(l,n,1)-1;var c=this.attachmentNames[u];t.slots[this.slotIndex].setAttachment(null==c?null:t.getAttachment(this.slotIndex,c))}}else{var d=o.data.attachmentName;o.setAttachment(null==d?null:t.getAttachment(this.slotIndex,d))}},t}(),pet=null,fet=function(t){function e(e){var n=t.call(this,e)||this;return n.frames=w7.newFloatArray(e),n.frameVertices=new Array(e),null==pet&&(pet=w7.newFloatArray(64)),n}return Wtt(e,t),e.prototype.getPropertyId=function(){return(Xtt.deform<<27)+ +this.attachment.id+this.slotIndex},e.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.frameVertices[t]=n},e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.slots[this.slotIndex],l=o.getAttachment();if(l instanceof Ytt&&l.applyDeform(this.attachment)){var h=o.attachmentVertices;0==h.length&&(s=K9.setup);var u=this.frameVertices,c=u[0].length,d=this.frames;if(n<d[0]){var p=l;switch(s){case K9.setup:return void(h.length=0);case K9.first:if(1==i){h.length=0;break}var f=w7.setArraySize(h,c);if(null==p.bones)for(var m=p.vertices,g=0;g<c;g++)f[g]+=(m[g]-f[g])*i;else{i=1-i;for(g=0;g<c;g++)f[g]*=i}}}else{var y=w7.setArraySize(h,c);if(n>=d[d.length-1]){var v=u[d.length-1];if(1==i)if(s==K9.add)if(null==(p=l).bones)for(m=p.vertices,g=0;g<c;g++)y[g]+=v[g]-m[g];else for(g=0;g<c;g++)y[g]+=v[g];else w7.arrayCopy(v,0,y,0,c);else switch(s){case K9.setup:var x=l;if(null==x.bones)for(m=x.vertices,g=0;g<c;g++){var b=m[g];y[g]=b+(v[g]-b)*i}else for(g=0;g<c;g++)y[g]=v[g]*i;break;case K9.first:case K9.replace:for(g=0;g<c;g++)y[g]+=(v[g]-y[g])*i;case K9.add:if(null==(p=l).bones)for(m=p.vertices,g=0;g<c;g++)y[g]+=(v[g]-m[g])*i;else for(g=0;g<c;g++)y[g]+=v[g]*i}}else{var w=net.binarySearch(d,n),_=u[w-1],T=u[w],E=d[w],S=this.getCurvePercent(w-1,1-(n-E)/(d[w-1]-E));if(1==i)if(s==K9.add)if(null==(p=l).bones)for(m=p.vertices,g=0;g<c;g++){var I=_[g];y[g]+=I+(T[g]-I)*S-m[g]}else for(g=0;g<c;g++){I=_[g];y[g]+=I+(T[g]-I)*S}else for(g=0;g<c;g++){I=_[g];y[g]=I+(T[g]-I)*S}else switch(s){case K9.setup:var k=l;if(null==k.bones)for(m=k.vertices,g=0;g<c;g++){I=_[g],b=m[g];y[g]=b+(I+(T[g]-I)*S-b)*i}else for(g=0;g<c;g++){I=_[g];y[g]=(I+(T[g]-I)*S)*i}break;case K9.first:case K9.replace:for(g=0;g<c;g++){I=_[g];y[g]+=(I+(T[g]-I)*S-y[g])*i}break;case K9.add:if(null==(p=l).bones)for(m=p.vertices,g=0;g<c;g++){I=_[g];y[g]+=(I+(T[g]-I)*S-m[g])*i}else for(g=0;g<c;g++){I=_[g];y[g]+=(I+(T[g]-I)*S)*i}}}}}},e}(iet),met=function(){function t(t){this.frames=w7.newFloatArray(t),this.events=new Array(t)}return t.prototype.getPropertyId=function(){return Xtt.event<<24},t.prototype.getFrameCount=function(){return this.frames.length},t.prototype.setFrame=function(t,e){this.frames[t]=e.time,this.events[t]=e},t.prototype.apply=function(t,e,n,r,i,s,a){if(null!=r){var o=this.frames,l=this.frames.length;if(e>n)this.apply(t,e,Number.MAX_VALUE,r,i,s,a),e=-1;else if(e>=o[l-1])return;if(!(n<o[0])){var h=0;if(e<o[0])h=0;else for(var u=o[h=net.binarySearch(o,e)];h>0&&o[h-1]==u;)h--;for(;h<l&&n>=o[h];h++)r.push(this.events[h])}}},t}(),get=function(){function t(t){this.frames=w7.newFloatArray(t),this.drawOrders=new Array(t)}return t.prototype.getPropertyId=function(){return Xtt.drawOrder<<24},t.prototype.getFrameCount=function(){return this.frames.length},t.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.drawOrders[t]=n},t.prototype.apply=function(t,e,n,r,i,s,a){var o=t.drawOrder,l=t.slots;if(a!=Z9.mixOut||s!=K9.setup){var h=this.frames;if(n<h[0])s!=K9.setup&&s!=K9.first||w7.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);else{var u=0;u=n>=h[h.length-1]?h.length-1:net.binarySearch(h,n)-1;var c=this.drawOrders[u];if(null==c)w7.arrayCopy(l,0,o,0,l.length);else for(var d=0,p=c.length;d<p;d++)o[d]=l[c[d]]}}else w7.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)},t}(),yet=function(t){function e(n){var r=t.call(this,n)||this;return r.frames=w7.newFloatArray(n*e.ENTRIES),r}return Wtt(e,t),e.prototype.getPropertyId=function(){return(Xtt.ikConstraint<<24)+this.ikConstraintIndex},e.prototype.setFrame=function(t,n,r,i,s,a){t*=e.ENTRIES,this.frames[t]=n,this.frames[t+e.MIX]=r,this.frames[t+e.BEND_DIRECTION]=i,this.frames[t+e.COMPRESS]=s?1:0,this.frames[t+e.STRETCH]=a?1:0},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.ikConstraints[this.ikConstraintIndex];if(r<l[0])switch(a){case K9.setup:return h.mix=h.data.mix,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,void(h.stretch=h.data.stretch);case K9.first:h.mix+=(h.data.mix-h.mix)*s,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch}else if(r>=l[l.length-e.ENTRIES])a==K9.setup?(h.mix=h.data.mix+(l[l.length+e.PREV_MIX]-h.data.mix)*s,o==Z9.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=l[l.length+e.PREV_BEND_DIRECTION],h.compress=0!=l[l.length+e.PREV_COMPRESS],h.stretch=0!=l[l.length+e.PREV_STRETCH])):(h.mix+=(l[l.length+e.PREV_MIX]-h.mix)*s,o==Z9.mixIn&&(h.bendDirection=l[l.length+e.PREV_BEND_DIRECTION],h.compress=0!=l[l.length+e.PREV_COMPRESS],h.stretch=0!=l[l.length+e.PREV_STRETCH]));else{var u=net.binarySearch(l,r,e.ENTRIES),c=l[u+e.PREV_MIX],d=l[u],p=this.getCurvePercent(u/e.ENTRIES-1,1-(r-d)/(l[u+e.PREV_TIME]-d));a==K9.setup?(h.mix=h.data.mix+(c+(l[u+e.MIX]-c)*p-h.data.mix)*s,o==Z9.mixOut?(h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch):(h.bendDirection=l[u+e.PREV_BEND_DIRECTION],h.compress=0!=l[u+e.PREV_COMPRESS],h.stretch=0!=l[u+e.PREV_STRETCH])):(h.mix+=(c+(l[u+e.MIX]-c)*p-h.mix)*s,o==Z9.mixIn&&(h.bendDirection=l[u+e.PREV_BEND_DIRECTION],h.compress=0!=l[u+e.PREV_COMPRESS],h.stretch=0!=l[u+e.PREV_STRETCH]))}},e.ENTRIES=5,e.PREV_TIME=-5,e.PREV_MIX=-4,e.PREV_BEND_DIRECTION=-3,e.PREV_COMPRESS=-2,e.PREV_STRETCH=-1,e.MIX=1,e.BEND_DIRECTION=2,e.COMPRESS=3,e.STRETCH=4,e}(iet),vet=function(t){function e(n){var r=t.call(this,n)||this;return r.frames=w7.newFloatArray(n*e.ENTRIES),r}return Wtt(e,t),e.prototype.getPropertyId=function(){return(Xtt.transformConstraint<<24)+this.transformConstraintIndex},e.prototype.setFrame=function(t,n,r,i,s,a){t*=e.ENTRIES,this.frames[t]=n,this.frames[t+e.ROTATE]=r,this.frames[t+e.TRANSLATE]=i,this.frames[t+e.SCALE]=s,this.frames[t+e.SHEAR]=a},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.transformConstraints[this.transformConstraintIndex];if(r<l[0]){var u=h.data;switch(a){case K9.setup:return h.rotateMix=u.rotateMix,h.translateMix=u.translateMix,h.scaleMix=u.scaleMix,void(h.shearMix=u.shearMix);case K9.first:h.rotateMix+=(u.rotateMix-h.rotateMix)*s,h.translateMix+=(u.translateMix-h.translateMix)*s,h.scaleMix+=(u.scaleMix-h.scaleMix)*s,h.shearMix+=(u.shearMix-h.shearMix)*s}}else{var c=0,d=0,p=0,f=0;if(r>=l[l.length-e.ENTRIES]){var m=l.length;c=l[m+e.PREV_ROTATE],d=l[m+e.PREV_TRANSLATE],p=l[m+e.PREV_SCALE],f=l[m+e.PREV_SHEAR]}else{var g=net.binarySearch(l,r,e.ENTRIES);c=l[g+e.PREV_ROTATE],d=l[g+e.PREV_TRANSLATE],p=l[g+e.PREV_SCALE],f=l[g+e.PREV_SHEAR];var y=l[g],v=this.getCurvePercent(g/e.ENTRIES-1,1-(r-y)/(l[g+e.PREV_TIME]-y));c+=(l[g+e.ROTATE]-c)*v,d+=(l[g+e.TRANSLATE]-d)*v,p+=(l[g+e.SCALE]-p)*v,f+=(l[g+e.SHEAR]-f)*v}if(a==K9.setup){u=h.data;h.rotateMix=u.rotateMix+(c-u.rotateMix)*s,h.translateMix=u.translateMix+(d-u.translateMix)*s,h.scaleMix=u.scaleMix+(p-u.scaleMix)*s,h.shearMix=u.shearMix+(f-u.shearMix)*s}else h.rotateMix+=(c-h.rotateMix)*s,h.translateMix+=(d-h.translateMix)*s,h.scaleMix+=(p-h.scaleMix)*s,h.shearMix+=(f-h.shearMix)*s}},e.ENTRIES=5,e.PREV_TIME=-5,e.PREV_ROTATE=-4,e.PREV_TRANSLATE=-3,e.PREV_SCALE=-2,e.PREV_SHEAR=-1,e.ROTATE=1,e.TRANSLATE=2,e.SCALE=3,e.SHEAR=4,e}(iet),xet=function(t){function e(n){var r=t.call(this,n)||this;return r.frames=w7.newFloatArray(n*e.ENTRIES),r}return Wtt(e,t),e.prototype.getPropertyId=function(){return(Xtt.pathConstraintPosition<<24)+this.pathConstraintIndex},e.prototype.setFrame=function(t,n,r){t*=e.ENTRIES,this.frames[t]=n,this.frames[t+e.VALUE]=r},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(r<l[0])switch(a){case K9.setup:return void(h.position=h.data.position);case K9.first:h.position+=(h.data.position-h.position)*s}else{var u=0;if(r>=l[l.length-e.ENTRIES])u=l[l.length+e.PREV_VALUE];else{var c=net.binarySearch(l,r,e.ENTRIES);u=l[c+e.PREV_VALUE];var d=l[c],p=this.getCurvePercent(c/e.ENTRIES-1,1-(r-d)/(l[c+e.PREV_TIME]-d));u+=(l[c+e.VALUE]-u)*p}a==K9.setup?h.position=h.data.position+(u-h.data.position)*s:h.position+=(u-h.position)*s}},e.ENTRIES=2,e.PREV_TIME=-2,e.PREV_VALUE=-1,e.VALUE=1,e}(iet),bet=function(t){function e(e){return t.call(this,e)||this}return Wtt(e,t),e.prototype.getPropertyId=function(){return(Xtt.pathConstraintSpacing<<24)+this.pathConstraintIndex},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(r<l[0])switch(a){case K9.setup:return void(h.spacing=h.data.spacing);case K9.first:h.spacing+=(h.data.spacing-h.spacing)*s}else{var u=0;if(r>=l[l.length-e.ENTRIES])u=l[l.length+e.PREV_VALUE];else{var c=net.binarySearch(l,r,e.ENTRIES);u=l[c+e.PREV_VALUE];var d=l[c],p=this.getCurvePercent(c/e.ENTRIES-1,1-(r-d)/(l[c+e.PREV_TIME]-d));u+=(l[c+e.VALUE]-u)*p}a==K9.setup?h.spacing=h.data.spacing+(u-h.data.spacing)*s:h.spacing+=(u-h.spacing)*s}},e}(xet),wet=function(t){function e(n){var r=t.call(this,n)||this;return r.frames=w7.newFloatArray(n*e.ENTRIES),r}return Wtt(e,t),e.prototype.getPropertyId=function(){return(Xtt.pathConstraintMix<<24)+this.pathConstraintIndex},e.prototype.setFrame=function(t,n,r,i){t*=e.ENTRIES,this.frames[t]=n,this.frames[t+e.ROTATE]=r,this.frames[t+e.TRANSLATE]=i},e.prototype.apply=function(t,n,r,i,s,a,o){var l=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(r<l[0])switch(a){case K9.setup:return h.rotateMix=h.data.rotateMix,void(h.translateMix=h.data.translateMix);case K9.first:h.rotateMix+=(h.data.rotateMix-h.rotateMix)*s,h.translateMix+=(h.data.translateMix-h.translateMix)*s}else{var u=0,c=0;if(r>=l[l.length-e.ENTRIES])u=l[l.length+e.PREV_ROTATE],c=l[l.length+e.PREV_TRANSLATE];else{var d=net.binarySearch(l,r,e.ENTRIES);u=l[d+e.PREV_ROTATE],c=l[d+e.PREV_TRANSLATE];var p=l[d],f=this.getCurvePercent(d/e.ENTRIES-1,1-(r-p)/(l[d+e.PREV_TIME]-p));u+=(l[d+e.ROTATE]-u)*f,c+=(l[d+e.TRANSLATE]-c)*f}a==K9.setup?(h.rotateMix=h.data.rotateMix+(u-h.data.rotateMix)*s,h.translateMix=h.data.translateMix+(c-h.data.translateMix)*s):(h.rotateMix+=(u-h.rotateMix)*s,h.translateMix+=(c-h.translateMix)*s)}},e.ENTRIES=3,e.PREV_TIME=-3,e.PREV_ROTATE=-2,e.PREV_TRANSLATE=-1,e.ROTATE=1,e.TRANSLATE=2,e}(iet),_et=function(){function t(t){this.tracks=new Array,this.events=new Array,this.listeners=new Array,this.queue=new Eet(this),this.propertyIDs=new m7,this.animationsChanged=!1,this.timeScale=1,this.trackEntryPool=new _7((function(){return new Tet})),this.data=t}return t.prototype.update=function(t){t*=this.timeScale;for(var e=this.tracks,n=0,r=e.length;n<r;n++){var i=e[n];if(null!=i){i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast;var s=t*i.timeScale;if(i.delay>0){if(i.delay-=s,i.delay>0)continue;s=-i.delay,i.delay=0}var a=i.next;if(null!=a){var o=i.trackLast-a.delay;if(o>=0){for(a.delay=0,a.trackTime=0==i.timeScale?0:(o/i.timeScale+t)*a.timeScale,i.trackTime+=s,this.setCurrent(n,a,!0);null!=a.mixingFrom;)a.mixTime+=t,a=a.mixingFrom;continue}}else if(i.trackLast>=i.trackEnd&&null==i.mixingFrom){e[n]=null,this.queue.end(i),this.disposeNext(i);continue}if(null!=i.mixingFrom&&this.updateMixingFrom(i,t)){var l=i.mixingFrom;for(i.mixingFrom=null,null!=l&&(l.mixingTo=null);null!=l;)this.queue.end(l),l=l.mixingFrom}i.trackTime+=s}}this.queue.drain()},t.prototype.updateMixingFrom=function(t,e){var n=t.mixingFrom;if(null==n)return!0;var r=this.updateMixingFrom(n,e);return n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=n.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=n.mixingFrom,null!=n.mixingFrom&&(n.mixingFrom.mixingTo=t),t.interruptAlpha=n.interruptAlpha,this.queue.end(n)),r):(n.trackTime+=e*n.timeScale,t.mixTime+=e,!1)},t.prototype.apply=function(e){if(null==e)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var n=this.events,r=this.tracks,i=!1,s=0,a=r.length;s<a;s++){var o=r[s];if(!(null==o||o.delay>0)){i=!0;var l=0==s?K9.first:o.mixBlend,h=o.alpha;null!=o.mixingFrom?h*=this.applyMixingFrom(o,e,l):o.trackTime>=o.trackEnd&&null==o.next&&(h=0);var u=o.animationLast,c=o.getAnimationTime(),d=o.animation.timelines.length,p=o.animation.timelines;if(0==s&&1==h||l==K9.add)for(var f=0;f<d;f++)w7.webkit602BugfixHelper(h,l),p[f].apply(e,u,c,n,h,l,Z9.mixIn);else{var m=o.timelineMode,g=0==o.timelinesRotation.length;g&&w7.setArraySize(o.timelinesRotation,d<<1,null);var y=o.timelinesRotation;for(f=0;f<d;f++){var v=p[f],x=m[f]==t.SUBSEQUENT?l:K9.setup;v instanceof set?this.applyRotateTimeline(v,e,c,h,x,y,f<<1,g):(w7.webkit602BugfixHelper(h,l),v.apply(e,u,c,n,h,x,Z9.mixIn))}}this.queueEvents(o,c),n.length=0,o.nextAnimationLast=c,o.nextTrackLast=o.trackTime}}return this.queue.drain(),i},t.prototype.applyMixingFrom=function(e,n,r){var i=e.mixingFrom;null!=i.mixingFrom&&this.applyMixingFrom(i,n,r);var s=0;0==e.mixDuration?(s=1,r==K9.first&&(r=K9.setup)):((s=e.mixTime/e.mixDuration)>1&&(s=1),r!=K9.first&&(r=i.mixBlend));var a=s<i.eventThreshold?this.events:null,o=s<i.attachmentThreshold,l=s<i.drawOrderThreshold,h=i.animationLast,u=i.getAnimationTime(),c=i.animation.timelines.length,d=i.animation.timelines,p=i.alpha*e.interruptAlpha,f=p*(1-s);if(r==K9.add)for(var m=0;m<c;m++)d[m].apply(n,h,u,a,f,r,Z9.mixOut);else{var g=i.timelineMode,y=i.timelineHoldMix,v=0==i.timelinesRotation.length;v&&w7.setArraySize(i.timelinesRotation,c<<1,null);var x=i.timelinesRotation;i.totalAlpha=0;for(m=0;m<c;m++){var b=d[m],w=Z9.mixOut,_=void 0,T=0;switch(g[m]){case t.SUBSEQUENT:if(!o&&b instanceof det)continue;if(!l&&b instanceof get)continue;_=r,T=f;break;case t.FIRST:_=K9.setup,T=f;break;case t.HOLD:_=K9.setup,T=p;break;default:_=K9.setup;var E=y[m];T=p*Math.max(0,1-E.mixTime/E.mixDuration)}i.totalAlpha+=T,b instanceof set?this.applyRotateTimeline(b,n,u,T,_,x,m<<1,v):(w7.webkit602BugfixHelper(T,r),_==K9.setup&&(b instanceof det?o&&(w=Z9.mixOut):b instanceof get&&l&&(w=Z9.mixOut)),b.apply(n,h,u,a,T,_,w))}}return e.mixDuration>0&&this.queueEvents(i,u),this.events.length=0,i.nextAnimationLast=u,i.nextTrackLast=i.trackTime,s},t.prototype.applyRotateTimeline=function(t,e,n,r,i,s,a,o){if(o&&(s[a]=0),1!=r){var l=t,h=l.frames,u=e.bones[l.boneIndex],c=0,d=0;if(n<h[0])switch(i){case K9.setup:u.rotation=u.data.rotation;default:return;case K9.first:c=u.rotation,d=u.data.rotation}else if(c=i==K9.setup?u.data.rotation:u.rotation,n>=h[h.length-set.ENTRIES])d=u.data.rotation+h[h.length+set.PREV_ROTATION];else{var p=net.binarySearch(h,n,set.ENTRIES),f=h[p+set.PREV_ROTATION],m=h[p],g=l.getCurvePercent((p>>1)-1,1-(n-m)/(h[p+set.PREV_TIME]-m));d=h[p+set.ROTATION]-f,d=f+(d-=360*(16384-(16384.499999999996-d/360|0)))*g+u.data.rotation,d-=360*(16384-(16384.499999999996-d/360|0))}var y=0,v=d-c;if(0==(v-=360*(16384-(16384.499999999996-v/360|0))))y=s[a];else{var x=0,b=0;o?(x=0,b=v):(x=s[a],b=s[a+1]);var w=v>0,_=x>=0;v7.signum(b)!=v7.signum(v)&&Math.abs(b)<=90&&(Math.abs(x)>180&&(x+=360*v7.signum(x)),_=w),y=v+x-x%360,_!=w&&(y+=360*v7.signum(x)),s[a]=y}s[a+1]=v,c+=y*r,u.rotation=c-360*(16384-(16384.499999999996-c/360|0))}else t.apply(e,0,n,null,1,i,Z9.mixIn)},t.prototype.queueEvents=function(t,e){for(var n=t.animationStart,r=t.animationEnd,i=r-n,s=t.trackLast%i,a=this.events,o=0,l=a.length;o<l;o++){var h=a[o];if(h.time<s)break;h.time>r||this.queue.event(t,h)}for((t.loop?0==i||s>t.trackTime%i:e>=r&&t.animationLast<r)&&this.queue.complete(t);o<l;o++){a[o].time<n||this.queue.event(t,a[o])}},t.prototype.clearTracks=function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,n=this.tracks.length;e<n;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()},t.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(null!=e){this.queue.end(e),this.disposeNext(e);for(var n=e;;){var r=n.mixingFrom;if(null==r)break;this.queue.end(r),n.mixingFrom=null,n.mixingTo=null,n=r}this.tracks[e.trackIndex]=null,this.queue.drain()}}},t.prototype.setCurrent=function(t,e,n){var r=this.expandToIndex(t);this.tracks[t]=e,null!=r&&(n&&this.queue.interrupt(r),e.mixingFrom=r,r.mixingTo=e,e.mixTime=0,null!=r.mixingFrom&&r.mixDuration>0&&(e.interruptAlpha*=Math.min(1,r.mixTime/r.mixDuration)),r.timelinesRotation.length=0),this.queue.start(e)},t.prototype.setAnimation=function(t,e,n){var r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,r,n)},t.prototype.setAnimationWith=function(t,e,n){if(null==e)throw new Error("animation cannot be null.");var r=!0,i=this.expandToIndex(t);null!=i&&(-1==i.nextTrackLast?(this.tracks[t]=i.mixingFrom,this.queue.interrupt(i),this.queue.end(i),this.disposeNext(i),i=i.mixingFrom,r=!1):this.disposeNext(i));var s=this.trackEntry(t,e,n,i);return this.setCurrent(t,s,r),this.queue.drain(),s},t.prototype.addAnimation=function(t,e,n,r){var i=this.data.skeletonData.findAnimation(e);if(null==i)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,i,n,r)},t.prototype.addAnimationWith=function(t,e,n,r){if(null==e)throw new Error("animation cannot be null.");var i=this.expandToIndex(t);if(null!=i)for(;null!=i.next;)i=i.next;var s=this.trackEntry(t,e,n,i);if(null==i)this.setCurrent(t,s,!0),this.queue.drain();else if(i.next=s,r<=0){var a=i.animationEnd-i.animationStart;0!=a?(i.loop?r+=a*(1+(i.trackTime/a|0)):r+=Math.max(a,i.trackTime),r-=this.data.getMix(i.animation,e)):r=i.trackTime}return s.delay=r,s},t.prototype.setEmptyAnimation=function(e,n){var r=this.setAnimationWith(e,t.emptyAnimation,!1);return r.mixDuration=n,r.trackEnd=n,r},t.prototype.addEmptyAnimation=function(e,n,r){r<=0&&(r-=n);var i=this.addAnimationWith(e,t.emptyAnimation,!1,r);return i.mixDuration=n,i.trackEnd=n,i},t.prototype.setEmptyAnimations=function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var n=0,r=this.tracks.length;n<r;n++){var i=this.tracks[n];null!=i&&this.setEmptyAnimation(i.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()},t.prototype.expandToIndex=function(t){return t<this.tracks.length?this.tracks[t]:(w7.ensureArrayCapacity(this.tracks,t-this.tracks.length+1,null),this.tracks.length=t+1,null)},t.prototype.trackEntry=function(t,e,n,r){var i=this.trackEntryPool.obtain();return i.trackIndex=t,i.animation=e,i.loop=n,i.holdPrevious=!1,i.eventThreshold=0,i.attachmentThreshold=0,i.drawOrderThreshold=0,i.animationStart=0,i.animationEnd=e.duration,i.animationLast=-1,i.nextAnimationLast=-1,i.delay=0,i.trackTime=0,i.trackLast=-1,i.nextTrackLast=-1,i.trackEnd=Number.MAX_VALUE,i.timeScale=1,i.alpha=1,i.interruptAlpha=1,i.mixTime=0,i.mixDuration=null==r?0:this.data.getMix(r.animation,e),i},t.prototype.disposeNext=function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null},t.prototype._animationsChanged=function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var t=0,e=this.tracks.length;t<e;t++){var n=this.tracks[t];if(null!=n){for(;null!=n.mixingFrom;)n=n.mixingFrom;do{null!=n.mixingFrom&&n.mixBlend==K9.add||this.setTimelineModes(n),n=n.mixingTo}while(null!=n)}}},t.prototype.setTimelineModes=function(e){var n=e.mixingTo,r=e.animation.timelines,i=e.animation.timelines.length,s=w7.setArraySize(e.timelineMode,i);e.timelineHoldMix.length=0;var a=w7.setArraySize(e.timelineHoldMix,i),o=this.propertyIDs;if(null!=n&&n.holdPrevious)for(var l=0;l<i;l++)o.add(r[l].getPropertyId()),s[l]=t.HOLD;else t:for(l=0;l<i;l++){var h=r[l].getPropertyId();if(o.add(h))if(null!=n&&this.hasTimeline(n,h)){for(var u=n.mixingTo;null!=u;u=u.mixingTo)if(!this.hasTimeline(u,h)){if(e.mixDuration>0){s[l]=t.HOLD_MIX,a[l]=u;continue t}break}s[l]=t.HOLD}else s[l]=t.FIRST;else s[l]=t.SUBSEQUENT}},t.prototype.hasTimeline=function(t,e){for(var n=t.animation.timelines,r=0,i=n.length;r<i;r++)if(n[r].getPropertyId()==e)return!0;return!1},t.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},t.prototype.addListener=function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)},t.prototype.removeListener=function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)},t.prototype.clearListeners=function(){this.listeners.length=0},t.prototype.clearListenerNotifications=function(){this.queue.clear()},t.prototype.setAnimationByName=function(e,n,r){t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.setAnimation(e,n,r)},t.prototype.addAnimationByName=function(e,n,r,i){t.deprecatedWarning2||(t.deprecatedWarning2=!0),this.addAnimation(e,n,r,i)},t.prototype.hasAnimation=function(t){return null!==this.data.skeletonData.findAnimation(t)},t.prototype.hasAnimationByName=function(e){return t.deprecatedWarning3||(t.deprecatedWarning3=!0),this.hasAnimation(e)},t.emptyAnimation=new net("<empty>",[],0),t.SUBSEQUENT=0,t.FIRST=1,t.HOLD=2,t.HOLD_MIX=3,t.deprecatedWarning1=!1,t.deprecatedWarning2=!1,t.deprecatedWarning3=!1,t}(),Tet=function(){function t(){this.mixBlend=K9.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}return t.prototype.reset=function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0},t.prototype.getAnimationTime=function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)},t.prototype.setAnimationLast=function(t){this.animationLast=t,this.nextAnimationLast=t},t.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},t.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0},Object.defineProperty(t.prototype,"time",{get:function(){return t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.trackTime},set:function(e){t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.trackTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endTime",{get:function(){return t.deprecatedWarning2||(t.deprecatedWarning2=!0),this.trackTime},set:function(e){t.deprecatedWarning2||(t.deprecatedWarning2=!0),this.trackTime=e},enumerable:!1,configurable:!0}),t.prototype.loopsCount=function(){return Math.floor(this.trackTime/this.trackEnd)},t.deprecatedWarning1=!1,t.deprecatedWarning2=!1,t}(),Eet=function(){function t(t){this.objects=[],this.drainDisabled=!1,this.animState=t}return t.prototype.start=function(t){this.objects.push(ret.start),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.interrupt=function(t){this.objects.push(ret.interrupt),this.objects.push(t)},t.prototype.end=function(t){this.objects.push(ret.end),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.dispose=function(t){this.objects.push(ret.dispose),this.objects.push(t)},t.prototype.complete=function(t){this.objects.push(ret.complete),this.objects.push(t)},t.prototype.event=function(t,e){this.objects.push(ret.event),this.objects.push(t),this.objects.push(e)},t.prototype.deprecateStuff=function(){return t.deprecatedWarning1||(t.deprecatedWarning1=!0),!0},t.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,n=0;n<t.length;n+=2){var r=t[n],i=t[n+1];switch(r){case ret.start:null!=i.listener&&i.listener.start&&i.listener.start(i);for(var s=0;s<e.length;s++)e[s].start&&e[s].start(i);i.onStart&&this.deprecateStuff()&&i.onStart(i.trackIndex),this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(i.trackIndex);break;case ret.interrupt:null!=i.listener&&i.listener.interrupt&&i.listener.interrupt(i);for(s=0;s<e.length;s++)e[s].interrupt&&e[s].interrupt(i);break;case ret.end:null!=i.listener&&i.listener.end&&i.listener.end(i);for(s=0;s<e.length;s++)e[s].end&&e[s].end(i);i.onEnd&&this.deprecateStuff()&&i.onEnd(i.trackIndex),this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(i.trackIndex);case ret.dispose:null!=i.listener&&i.listener.dispose&&i.listener.dispose(i);for(s=0;s<e.length;s++)e[s].dispose&&e[s].dispose(i);this.animState.trackEntryPool.free(i);break;case ret.complete:null!=i.listener&&i.listener.complete&&i.listener.complete(i);for(s=0;s<e.length;s++)e[s].complete&&e[s].complete(i);var a=v7.toInt(i.loopsCount());i.onComplete&&this.deprecateStuff()&&i.onComplete(i.trackIndex,a),this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(i.trackIndex,a);break;case ret.event:var o=t[2+n++];null!=i.listener&&i.listener.event&&i.listener.event(i,o);for(s=0;s<e.length;s++)e[s].event&&e[s].event(i,o);i.onEvent&&this.deprecateStuff()&&i.onEvent(i.trackIndex,o),this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(i.trackIndex,o)}}this.clear(),this.drainDisabled=!1}},t.prototype.clear=function(){this.objects.length=0},t.deprecatedWarning1=!1,t}();!function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(ret||(ret={}));var Iet,ket=function(){function t(){}return t.prototype.start=function(t){},t.prototype.interrupt=function(t){},t.prototype.end=function(t){},t.prototype.dispose=function(t){},t.prototype.complete=function(t){},t.prototype.event=function(t,e){},t}(),Cet=function(){function t(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}return t.prototype.setMix=function(t,e,n){var r=this.skeletonData.findAnimation(t);if(null==r)throw new Error("Animation not found: "+t);var i=this.skeletonData.findAnimation(e);if(null==i)throw new Error("Animation not found: "+e);this.setMixWith(r,i,n)},t.prototype.setMixByName=function(e,n,r){t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.setMix(e,n,r)},t.prototype.setMixWith=function(t,e,n){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");var r=t.name+"."+e.name;this.animationToMixTime[r]=n},t.prototype.getMix=function(t,e){var n=t.name+"."+e.name,r=this.animationToMixTime[n];return void 0===r?this.defaultMix:r},t.deprecatedWarning1=!1,t}(),Net=function(){function t(t){this.atlas=t}return t.prototype.newRegionAttachment=function(t,e,n){var r=this.atlas.findRegion(n);if(null==r)throw new Error("Region not found in atlas: "+n+" (region attachment: "+e+")");var i=new Qtt(e);return i.region=r,i},t.prototype.newMeshAttachment=function(t,e,n){var r=this.atlas.findRegion(n);if(null==r)throw new Error("Region not found in atlas: "+n+" (mesh attachment: "+e+")");var i=new Ktt(e);return i.region=r,i},t.prototype.newBoundingBoxAttachment=function(t,e){return new jtt(e)},t.prototype.newPathAttachment=function(t,e){return new Ztt(e)},t.prototype.newPointAttachment=function(t,e){return new Jtt(e)},t.prototype.newClippingAttachment=function(t,e){return new qtt(e)},t}(),Aet=function(){function t(t,e,n){if(this.matrix=new In,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.sorted=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=n,this.setToSetupPose()}return Object.defineProperty(t.prototype,"worldX",{get:function(){return this.matrix.tx},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldY",{get:function(){return this.matrix.ty},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},t.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},t.prototype.updateWorldTransformWith=function(t,e,n,r,i,s,a){this.ax=t,this.ay=e,this.arotation=n,this.ascaleX=r,this.ascaleY=i,this.ashearX=s,this.ashearY=a,this.appliedValid=!0;var o=this.parent,l=this.matrix,h=this.skeleton.scaleX,u=E7?-this.skeleton.scaleY:this.skeleton.scaleY;if(null==o){var c=this.skeleton,d=n+90+a;return l.a=v7.cosDeg(n+s)*r*h,l.c=v7.cosDeg(d)*i*h,l.b=v7.sinDeg(n+s)*r*u,l.d=v7.sinDeg(d)*i*u,l.tx=t*h+c.x,void(l.ty=e*u+c.y)}var p=o.matrix.a,f=o.matrix.c,m=o.matrix.b,g=o.matrix.d;switch(l.tx=p*t+f*e+o.matrix.tx,l.ty=m*t+g*e+o.matrix.ty,this.data.transformMode){case t7.Normal:d=n+90+a;var y=v7.cosDeg(n+s)*r,v=v7.cosDeg(d)*i,x=v7.sinDeg(n+s)*r,b=v7.sinDeg(d)*i;return l.a=p*y+f*x,l.c=p*v+f*b,l.b=m*y+g*x,void(l.d=m*v+g*b);case t7.OnlyTranslation:d=n+90+a;l.a=v7.cosDeg(n+s)*r,l.c=v7.cosDeg(d)*i,l.b=v7.sinDeg(n+s)*r,l.d=v7.sinDeg(d)*i;break;case t7.NoRotationOrReflection:var w=0;(E=p*p+m*m)>1e-4?(f=m*(E=Math.abs(p*g-f*m)/E),g=p*E,w=Math.atan2(m,p)*v7.radDeg):(p=0,m=0,w=90-Math.atan2(g,f)*v7.radDeg);var _=n+s-w,T=n+a-w+90;y=v7.cosDeg(_)*r,v=v7.cosDeg(T)*i,x=v7.sinDeg(_)*r,b=v7.sinDeg(T)*i;l.a=p*y-f*x,l.c=p*v-f*b,l.b=m*y+g*x,l.d=m*v+g*b;break;case t7.NoScale:case t7.NoScaleOrReflection:var E,S=v7.cosDeg(n),I=v7.sinDeg(n),k=(p*S+f*I)/h,C=(m*S+g*I)/u;(E=Math.sqrt(k*k+C*C))>1e-5&&(E=1/E),k*=E,C*=E,E=Math.sqrt(k*k+C*C),this.data.transformMode==t7.NoScale&&p*g-f*m<0!=(E7?this.skeleton.scaleX<0!=this.skeleton.scaleY>0:this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(E=-E);var N=Math.PI/2+Math.atan2(C,k),A=Math.cos(N)*E,R=Math.sin(N)*E;y=v7.cosDeg(s)*r,v=v7.cosDeg(90+a)*i,x=v7.sinDeg(s)*r,b=v7.sinDeg(90+a)*i;l.a=k*y+A*x,l.c=k*v+A*b,l.b=C*y+R*x,l.d=C*v+R*b}l.a*=h,l.c*=h,l.b*=u,l.d*=u},t.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY},t.prototype.getWorldRotationX=function(){return Math.atan2(this.matrix.b,this.matrix.a)*v7.radDeg},t.prototype.getWorldRotationY=function(){return Math.atan2(this.matrix.d,this.matrix.c)*v7.radDeg},t.prototype.getWorldScaleX=function(){var t=this.matrix;return Math.sqrt(t.a*t.a+t.c*t.c)},t.prototype.getWorldScaleY=function(){var t=this.matrix;return Math.sqrt(t.b*t.b+t.d*t.d)},t.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var t=this.parent,e=this.matrix;if(null==t)return this.ax=e.tx,this.ay=e.ty,this.arotation=Math.atan2(e.b,e.a)*v7.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*v7.radDeg);var n=t.matrix,r=1/(n.a*n.d-n.b*n.c),i=e.tx-n.tx,s=e.ty-n.ty;this.ax=i*n.d*r-s*n.c*r,this.ay=s*n.a*r-i*n.b*r;var a=r*n.d,o=r*n.a,l=r*n.c,h=r*n.b,u=a*e.a-l*e.b,c=a*e.c-l*e.d,d=o*e.b-h*e.a,p=o*e.d-h*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(u*u+d*d),this.ascaleX>1e-4){var f=u*p-c*d;this.ascaleY=f/this.ascaleX,this.ashearY=Math.atan2(u*c+d*p,f)*v7.radDeg,this.arotation=Math.atan2(d,u)*v7.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(c*c+p*p),this.ashearY=0,this.arotation=90-Math.atan2(p,c)*v7.radDeg},t.prototype.worldToLocal=function(t){var e=this.matrix,n=e.a,r=e.c,i=e.b,s=e.d,a=1/(n*s-r*i),o=t.x-e.tx,l=t.y-e.ty;return t.x=o*s*a-l*r*a,t.y=l*n*a-o*i*a,t},t.prototype.localToWorld=function(t){var e=this.matrix,n=t.x,r=t.y;return t.x=n*e.a+r*e.c+e.tx,t.y=n*e.b+r*e.d+e.ty,t},t.prototype.worldToLocalRotation=function(t){var e=v7.sinDeg(t),n=v7.cosDeg(t),r=this.matrix;return Math.atan2(r.a*e-r.b*n,r.d*n-r.c*e)*v7.radDeg},t.prototype.localToWorldRotation=function(t){var e=v7.sinDeg(t),n=v7.cosDeg(t),r=this.matrix;return Math.atan2(n*r.b+e*r.d,n*r.a+e*r.c)*v7.radDeg},t.prototype.rotateWorld=function(t){var e=this.matrix,n=e.a,r=e.c,i=e.b,s=e.d,a=v7.cosDeg(t),o=v7.sinDeg(t);e.a=a*n-o*i,e.c=a*r-o*s,e.b=o*n+a*i,e.d=o*r+a*s,this.appliedValid=!1},t}(),Ret=function(t,e,n){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=t7.Normal,t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=n},Met=function(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e},Oet=function(t){this.name=t},Pet=function(){function t(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(var n=0;n<t.bones.length;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)}return t.prototype.getOrder=function(){return this.data.order},t.prototype.apply=function(){this.update()},t.prototype.update=function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.mix)}},t.prototype.apply1=function(t,e,n,r,i,s,a){t.appliedValid||t.updateAppliedTransform();var o=t.parent.matrix,l=1/(o.a*o.d-o.b*o.c),h=e-o.tx,u=n-o.ty,c=(h*o.d-u*o.c)*l-t.ax,d=(u*o.a-h*o.b)*l-t.ay,p=Math.atan2(d,c)*v7.radDeg-t.ashearX-t.arotation;t.ascaleX<0&&(p+=180),p>180?p-=360:p<-180&&(p+=360);var f=t.ascaleX,m=t.ascaleY;if(r||i){var g=t.data.length*f,y=Math.sqrt(c*c+d*d);if(r&&y<g||i&&y>g&&g>1e-4){var v=(y/g-1)*a+1;f*=v,s&&(m*=v)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+p*a,f,m,t.ashearX,t.ashearY)},t.prototype.apply2=function(t,e,n,r,i,s,a){if(0!=a){t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();var o=t.ax,l=t.ay,h=t.ascaleX,u=h,c=t.ascaleY,d=e.ascaleX,p=t.matrix,f=0,m=0,g=0;h<0?(h=-h,f=180,g=-1):(f=0,g=1),c<0&&(c=-c,g=-g),d<0?(d=-d,m=180):m=0;var y=e.ax,v=0,x=0,b=0,w=p.a,_=p.c,T=p.b,E=p.d,S=Math.abs(h-c)<=1e-4;S?(x=w*y+_*(v=e.ay)+p.tx,b=T*y+E*v+p.ty):(v=0,x=w*y+p.tx,b=T*y+p.ty);var I=t.parent.matrix;w=I.a,_=I.c,T=I.b;var k=1/(w*(E=I.d)-_*T),C=n-I.tx,N=r-I.ty,A=(C*E-N*_)*k-o,R=(N*w-C*T)*k-l,M=A*A+R*R,O=((C=x-I.tx)*E-(N=b-I.ty)*_)*k-o,P=(N*w-C*T)*k-l,D=Math.sqrt(O*O+P*P),F=e.data.length*d,L=0,B=0;t:if(S){var $=(M-D*D-(F*=h)*F)/(2*D*F);$<-1?$=-1:$>1&&($=1,s&&D+F>1e-4&&(u*=(Math.sqrt(M)/(D+F)-1)*a+1)),B=Math.acos($)*i,w=D+F*$,_=F*Math.sin(B),L=Math.atan2(R*w-A*_,A*w+R*_)}else{var U=(w=h*F)*w,V=(_=c*F)*_,z=Math.atan2(R,A),G=-2*V*D,W=V-U;if((E=G*G-4*W*(T=V*D*D+U*M-U*V))>=0){var X=Math.sqrt(E);G<0&&(X=-X);var H=(X=-(G+X)/2)/W,Y=T/X,j=Math.abs(H)<Math.abs(Y)?H:Y;if(j*j<=M){N=Math.sqrt(M-j*j)*i,L=z-Math.atan2(N,j),B=Math.atan2(N/c,(j-D)/h);break t}}var q=v7.PI,K=D-w,Z=K*K,J=0,Q=0,tt=D+w,et=tt*tt,nt=0;(T=-w*D/(U-V))>=-1&&T<=1&&(T=Math.acos(T),(E=(C=w*Math.cos(T)+D)*C+(N=_*Math.sin(T))*N)<Z&&(q=T,Z=E,K=C,J=N),E>et&&(Q=T,et=E,tt=C,nt=N)),M<=(Z+et)/2?(L=z-Math.atan2(J*i,K),B=q*i):(L=z-Math.atan2(nt*i,tt),B=Q*i)}var rt=Math.atan2(v,y)*g,it=t.arotation;(L=(L-rt)*v7.radDeg+f-it)>180?L-=360:L<-180&&(L+=360),t.updateWorldTransformWith(o,l,it+L*a,u,t.ascaleY,0,0),it=e.arotation,(B=((B+rt)*v7.radDeg-e.ashearX)*g+m-it)>180?B-=360:B<-180&&(B+=360),e.updateWorldTransformWith(y,v,it+B*a,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}else e.updateWorldTransform()},t}(),Det=function(t){this.order=0,this.bones=new Array,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.name=t},Fet=function(t){this.order=0,this.bones=new Array,this.name=t};!function(t){t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent"}(Iet||(Iet={}));var Let=function(){function t(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(var n=0,r=t.bones.length;n<r;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}return t.prototype.apply=function(){this.update()},t.prototype.update=function(){var e=this.target.getAttachment();if(e instanceof Ztt){var n=this.rotateMix,r=this.translateMix,i=n>0;if(r>0||i){var s=this.data,a=s.spacingMode,o=a==Iet.Length,l=s.rotateMode,h=l==Q9.Tangent,u=l==Q9.ChainScale,c=this.bones.length,d=h?c:c+1,p=this.bones,f=w7.setArraySize(this.spaces,d),m=null,g=this.spacing;if(u||o){u&&(m=w7.setArraySize(this.lengths,c));for(var y=0,v=d-1;y<v;){var x=(N=p[y]).data.length;if(x<t.epsilon)u&&(m[y]=0),f[++y]=0;else{var b=x*N.matrix.a,w=x*N.matrix.b,_=Math.sqrt(b*b+w*w);u&&(m[y]=_),f[++y]=(o?x+g:g)*_/x}}}else for(y=1;y<d;y++)f[y]=g;var T=this.computeWorldPositions(e,d,h,s.positionMode==J9.Percent,a==Iet.Percent),E=T[0],S=T[1],I=s.offsetRotation,k=!1;if(0==I)k=l==Q9.Chain;else k=!1,I*=(C=this.target.bone.matrix).a*C.d-C.b*C.c>0?v7.degRad:-v7.degRad;y=0;for(var C=3;y<c;y++,C+=3){var N,A=(N=p[y]).matrix;A.tx+=(E-A.tx)*r,A.ty+=(S-A.ty)*r;var R=(b=T[C])-E,M=(w=T[C+1])-S;if(u){var O=m[y];if(0!=O){var P=(Math.sqrt(R*R+M*M)/O-1)*n+1;A.a*=P,A.b*=P}}if(E=b,S=w,i){var D=A.a,F=A.c,L=A.b,B=A.d,$=0,U=0,V=0;if($=h?T[C-1]:0==f[y+1]?T[C+2]:Math.atan2(M,R),$-=Math.atan2(L,D),k){U=Math.cos($),V=Math.sin($);var z=N.data.length;E+=(z*(U*D-V*L)-R)*n,S+=(z*(V*D+U*L)-M)*n}else $+=I;$>v7.PI?$-=v7.PI2:$<-v7.PI&&($+=v7.PI2),$*=n,U=Math.cos($),V=Math.sin($),A.a=U*D-V*L,A.c=U*F-V*B,A.b=V*D+U*L,A.d=V*F+U*B}N.appliedValid=!1}}}},t.prototype.computeWorldPositions=function(e,n,r,i,s){var a=this.target,o=this.position,l=this.spaces,h=w7.setArraySize(this.positions,3*n+2),u=null,c=e.closed,d=e.worldVerticesLength,p=d/6,f=t.NONE;if(!e.constantSpeed){var m=e.lengths,g=m[p-=c?1:2];if(i&&(o*=g),s)for(var y=0;y<n;y++)l[y]*=g;u=w7.setArraySize(this.world,8);y=0;for(var v=0,x=0;y<n;y++,v+=3){var b=o+=W=l[y];if(c)(b%=g)<0&&(b+=g),x=0;else{if(b<0){f!=t.BEFORE&&(f=t.BEFORE,e.computeWorldVertices(a,2,4,u,0,2)),this.addBeforePosition(b,u,0,h,v);continue}if(b>g){f!=t.AFTER&&(f=t.AFTER,e.computeWorldVertices(a,d-6,4,u,0,2)),this.addAfterPosition(b-g,u,0,h,v);continue}}for(;;x++){var w=m[x];if(!(b>w)){if(0==x)b/=w;else b=(b-(j=m[x-1]))/(w-j);break}}x!=f&&(f=x,c&&x==p?(e.computeWorldVertices(a,d-4,4,u,0,2),e.computeWorldVertices(a,0,4,u,4,2)):e.computeWorldVertices(a,6*x+2,8,u,0,2)),this.addCurvePosition(b,u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],h,v,r||y>0&&0==W)}return h}c?(d+=2,u=w7.setArraySize(this.world,d),e.computeWorldVertices(a,2,d-4,u,0,2),e.computeWorldVertices(a,0,2,u,d-4,2),u[d-2]=u[0],u[d-1]=u[1]):(p--,d-=4,u=w7.setArraySize(this.world,d),e.computeWorldVertices(a,2,d,u,0,2));for(var _=w7.setArraySize(this.curves,p),T=0,E=u[0],S=u[1],I=0,k=0,C=0,N=0,A=0,R=0,M=0,O=0,P=0,D=0,F=0,L=0,B=0,$=0,U=(y=0,2);y<p;y++,U+=6)I=u[U],k=u[U+1],C=u[U+2],N=u[U+3],F=2*(M=.1875*(E-2*I+C))+(P=.09375*(3*(I-C)-E+(A=u[U+4]))),L=2*(O=.1875*(S-2*k+N))+(D=.09375*(3*(k-N)-S+(R=u[U+5]))),B=.75*(I-E)+M+.16666667*P,$=.75*(k-S)+O+.16666667*D,T+=Math.sqrt(B*B+$*$),B+=F,$+=L,F+=P,L+=D,T+=Math.sqrt(B*B+$*$),B+=F,$+=L,T+=Math.sqrt(B*B+$*$),B+=F+P,$+=L+D,T+=Math.sqrt(B*B+$*$),_[y]=T,E=A,S=R;if(i&&(o*=T),s)for(y=0;y<n;y++)l[y]*=T;for(var V=this.segments,z=0,G=(y=0,v=0,x=0,0);y<n;y++,v+=3){var W;b=o+=W=l[y];if(c)(b%=T)<0&&(b+=T),x=0;else{if(b<0){this.addBeforePosition(b,u,0,h,v);continue}if(b>T){this.addAfterPosition(b-T,u,d-4,h,v);continue}}for(;;x++){var X=_[x];if(!(b>X)){if(0==x)b/=X;else b=(b-(j=_[x-1]))/(X-j);break}}if(x!=f){f=x;var H=6*x;for(E=u[H],S=u[H+1],I=u[H+2],k=u[H+3],C=u[H+4],N=u[H+5],F=2*(M=.03*(E-2*I+C))+(P=.006*(3*(I-C)-E+(A=u[H+6]))),L=2*(O=.03*(S-2*k+N))+(D=.006*(3*(k-N)-S+(R=u[H+7]))),B=.3*(I-E)+M+.16666667*P,$=.3*(k-S)+O+.16666667*D,z=Math.sqrt(B*B+$*$),V[0]=z,H=1;H<8;H++)B+=F,$+=L,F+=P,L+=D,z+=Math.sqrt(B*B+$*$),V[H]=z;B+=F,$+=L,z+=Math.sqrt(B*B+$*$),V[8]=z,B+=F+P,$+=L+D,z+=Math.sqrt(B*B+$*$),V[9]=z,G=0}for(b*=z;;G++){var Y=V[G];if(!(b>Y)){var j;if(0==G)b/=Y;else b=G+(b-(j=V[G-1]))/(Y-j);break}}this.addCurvePosition(.1*b,E,S,I,k,C,N,A,R,h,v,r||y>0&&0==W)}return h},t.prototype.addBeforePosition=function(t,e,n,r,i){var s=e[n],a=e[n+1],o=e[n+2]-s,l=e[n+3]-a,h=Math.atan2(l,o);r[i]=s+t*Math.cos(h),r[i+1]=a+t*Math.sin(h),r[i+2]=h},t.prototype.addAfterPosition=function(t,e,n,r,i){var s=e[n+2],a=e[n+3],o=s-e[n],l=a-e[n+1],h=Math.atan2(l,o);r[i]=s+t*Math.cos(h),r[i+1]=a+t*Math.sin(h),r[i+2]=h},t.prototype.addCurvePosition=function(t,e,n,r,i,s,a,o,l,h,u,c){(0==t||isNaN(t))&&(t=1e-4);var d=t*t,p=d*t,f=1-t,m=f*f,g=m*f,y=f*t,v=3*y,x=f*v,b=v*t,w=e*g+r*x+s*b+o*p,_=n*g+i*x+a*b+l*p;h[u]=w,h[u+1]=_,c&&(h[u+2]=Math.atan2(_-(n*m+i*y*2+a*d),w-(e*m+r*y*2+s*d)))},t.prototype.getOrder=function(){return this.data.order},t.NONE=-1,t.BEFORE=-2,t.AFTER=-3,t.epsilon=1e-5,t}(),Bet=function(){function t(t,e){if(this.attachmentVertices=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new y7,this.darkColor=null==t.darkColor?null:new y7,this.setToSetupPose(),this.blendMode=this.data.blendMode}return t.prototype.getAttachment=function(){return this.attachment},t.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0)},t.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t},t.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},t.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},t}(),$et=function(){function t(t,e){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new T7,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(var n=0;n<t.bones.length;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)}return t.prototype.apply=function(){this.update()},t.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()},t.prototype.applyAbsoluteWorld=function(){for(var t=this.rotateMix,e=this.translateMix,n=this.scaleMix,r=this.shearMix,i=this.target,s=i.matrix,a=s.a,o=s.c,l=s.b,h=s.d,u=a*h-o*l>0?v7.degRad:-v7.degRad,c=this.data.offsetRotation*u,d=this.data.offsetShearY*u,p=this.bones,f=0,m=p.length;f<m;f++){var g=p[f],y=!1,v=g.matrix;if(0!=t){var x=v.a,b=v.c,w=v.b,_=v.d;(C=Math.atan2(l,a)-Math.atan2(w,x)+c)>v7.PI?C-=v7.PI2:C<-v7.PI&&(C+=v7.PI2),C*=t;var T=Math.cos(C),E=Math.sin(C);v.a=T*x-E*w,v.c=T*b-E*_,v.b=E*x+T*w,v.d=E*b+T*_,y=!0}if(0!=e){var S=this.temp;i.localToWorld(S.set(this.data.offsetX,this.data.offsetY)),v.tx+=(S.x-v.tx)*e,v.ty+=(S.y-v.ty)*e,y=!0}if(n>0){var I=Math.sqrt(v.a*v.a+v.b*v.b),k=Math.sqrt(a*a+l*l);I>1e-5&&(I=(I+(k-I+this.data.offsetScaleX)*n)/I),v.a*=I,v.b*=I,I=Math.sqrt(v.c*v.c+v.d*v.d),k=Math.sqrt(o*o+h*h),I>1e-5&&(I=(I+(k-I+this.data.offsetScaleY)*n)/I),v.c*=I,v.d*=I,y=!0}if(r>0){b=v.c,_=v.d;var C,N=Math.atan2(_,b);(C=Math.atan2(h,o)-Math.atan2(l,a)-(N-Math.atan2(v.b,v.a)))>v7.PI?C-=v7.PI2:C<-v7.PI&&(C+=v7.PI2),C=N+(C+d)*r;I=Math.sqrt(b*b+_*_);v.c=Math.cos(C)*I,v.d=Math.sin(C)*I,y=!0}y&&(g.appliedValid=!1)}},t.prototype.applyRelativeWorld=function(){for(var t=this.rotateMix,e=this.translateMix,n=this.scaleMix,r=this.shearMix,i=this.target,s=i.matrix,a=s.a,o=s.c,l=s.b,h=s.d,u=a*h-o*l>0?v7.degRad:-v7.degRad,c=this.data.offsetRotation*u,d=this.data.offsetShearY*u,p=this.bones,f=0,m=p.length;f<m;f++){var g=p[f],y=!1,v=g.matrix;if(0!=t){var x=v.a,b=v.c,w=v.b,_=v.d;(k=Math.atan2(l,a)+c)>v7.PI?k-=v7.PI2:k<-v7.PI&&(k+=v7.PI2),k*=t;var T=Math.cos(k),E=Math.sin(k);v.a=T*x-E*w,v.c=T*b-E*_,v.b=E*x+T*w,v.d=E*b+T*_,y=!0}if(0!=e){var S=this.temp;i.localToWorld(S.set(this.data.offsetX,this.data.offsetY)),v.tx+=S.x*e,v.ty+=S.y*e,y=!0}if(n>0){var I=(Math.sqrt(a*a+l*l)-1+this.data.offsetScaleX)*n+1;v.a*=I,v.b*=I,I=(Math.sqrt(o*o+h*h)-1+this.data.offsetScaleY)*n+1,v.c*=I,v.d*=I,y=!0}if(r>0){var k;(k=Math.atan2(h,o)-Math.atan2(l,a))>v7.PI?k-=v7.PI2:k<-v7.PI&&(k+=v7.PI2);b=v.c,_=v.d;k=Math.atan2(_,b)+(k-v7.PI/2+d)*r;I=Math.sqrt(b*b+_*_);v.c=Math.cos(k)*I,v.d=Math.sin(k)*I,y=!0}y&&(g.appliedValid=!1)}},t.prototype.applyAbsoluteLocal=function(){var t=this.rotateMix,e=this.translateMix,n=this.scaleMix,r=this.shearMix,i=this.target;i.appliedValid||i.updateAppliedTransform();for(var s=this.bones,a=0,o=s.length;a<o;a++){var l=s[a];l.appliedValid||l.updateAppliedTransform();var h=l.arotation;if(0!=t){var u=i.arotation-h+this.data.offsetRotation;h+=(u-=360*(16384-(16384.499999999996-u/360|0)))*t}var c=l.ax,d=l.ay;0!=e&&(c+=(i.ax-c+this.data.offsetX)*e,d+=(i.ay-d+this.data.offsetY)*e);var p=l.ascaleX,f=l.ascaleY;n>0&&(p>1e-5&&(p=(p+(i.ascaleX-p+this.data.offsetScaleX)*n)/p),f>1e-5&&(f=(f+(i.ascaleY-f+this.data.offsetScaleY)*n)/f));var m=l.ashearY;if(r>0){u=i.ashearY-m+this.data.offsetShearY;u-=360*(16384-(16384.499999999996-u/360|0)),l.shearY+=u*r}l.updateWorldTransformWith(c,d,h,p,f,l.ashearX,m)}},t.prototype.applyRelativeLocal=function(){var t=this.rotateMix,e=this.translateMix,n=this.scaleMix,r=this.shearMix,i=this.target;i.appliedValid||i.updateAppliedTransform();for(var s=this.bones,a=0,o=s.length;a<o;a++){var l=s[a];l.appliedValid||l.updateAppliedTransform();var h=l.arotation;0!=t&&(h+=(i.arotation+this.data.offsetRotation)*t);var u=l.ax,c=l.ay;0!=e&&(u+=(i.ax+this.data.offsetX)*e,c+=(i.ay+this.data.offsetY)*e);var d=l.ascaleX,p=l.ascaleY;n>0&&(d>1e-5&&(d*=(i.ascaleX-1+this.data.offsetScaleX)*n+1),p>1e-5&&(p*=(i.ascaleY-1+this.data.offsetScaleY)*n+1));var f=l.ashearY;r>0&&(f+=(i.ashearY+this.data.offsetShearY)*r),l.updateWorldTransformWith(u,c,h,d,p,l.ashearX,f)}},t.prototype.getOrder=function(){return this.data.order},t}(),Uet=function(){function t(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(var e=0;e<t.bones.length;e++){var n=t.bones[e],r=void 0;if(null==n.parent)r=new Aet(n,this,null);else{var i=this.bones[n.parent.index];r=new Aet(n,this,i),i.children.push(r)}this.bones.push(r)}this.slots=new Array,this.drawOrder=new Array;for(e=0;e<t.slots.length;e++){var s=t.slots[e],a=(r=this.bones[s.boneData.index],new Bet(s,r));this.slots.push(a),this.drawOrder.push(a)}this.ikConstraints=new Array;for(e=0;e<t.ikConstraints.length;e++){var o=t.ikConstraints[e];this.ikConstraints.push(new Pet(o,this))}this.transformConstraints=new Array;for(e=0;e<t.transformConstraints.length;e++){var l=t.transformConstraints[e];this.transformConstraints.push(new $et(l,this))}this.pathConstraints=new Array;for(e=0;e<t.pathConstraints.length;e++){var h=t.pathConstraints[e];this.pathConstraints.push(new Let(h,this))}this.color=new y7(1,1,1,1),this.updateCache()}return t.prototype.updateCache=function(){this._updateCache.length=0,this.updateCacheReset.length=0;for(var t=this.bones,e=0,n=t.length;e<n;e++)t[e].sorted=!1;var r=this.ikConstraints,i=this.transformConstraints,s=this.pathConstraints,a=r.length,o=i.length,l=s.length,h=a+o+l;t:for(e=0;e<h;e++){for(var u=0;u<a;u++){if((c=r[u]).data.order==e){this.sortIkConstraint(c);continue t}}for(u=0;u<o;u++){if((c=i[u]).data.order==e){this.sortTransformConstraint(c);continue t}}for(u=0;u<l;u++){var c;if((c=s[u]).data.order==e){this.sortPathConstraint(c);continue t}}}for(e=0,n=t.length;e<n;e++)this.sortBone(t[e])},t.prototype.sortIkConstraint=function(t){var e=t.target;this.sortBone(e);var n=t.bones,r=n[0];if(this.sortBone(r),n.length>1){var i=n[n.length-1];this._updateCache.indexOf(i)>-1||this.updateCacheReset.push(i)}this._updateCache.push(t),this.sortReset(r.children),n[n.length-1].sorted=!0},t.prototype.sortPathConstraint=function(t){var e=t.target,n=e.data.index,r=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,n,r),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,n,r);for(var i=0,s=this.data.skins.length;i<s;i++)this.sortPathConstraintAttachment(this.data.skins[i],n,r);var a=e.getAttachment();a instanceof Ztt&&this.sortPathConstraintAttachmentWith(a,r);var o=t.bones,l=o.length;for(i=0;i<l;i++)this.sortBone(o[i]);this._updateCache.push(t);for(i=0;i<l;i++)this.sortReset(o[i].children);for(i=0;i<l;i++)o[i].sorted=!0},t.prototype.sortTransformConstraint=function(t){this.sortBone(t.target);var e=t.bones,n=e.length;if(t.data.local)for(var r=0;r<n;r++){var i=e[r];this.sortBone(i.parent),this._updateCache.indexOf(i)>-1||this.updateCacheReset.push(i)}else for(r=0;r<n;r++)this.sortBone(e[r]);this._updateCache.push(t);for(var s=0;s<n;s++)this.sortReset(e[s].children);for(s=0;s<n;s++)e[s].sorted=!0},t.prototype.sortPathConstraintAttachment=function(t,e,n){var r=t.attachments[e];if(r)for(var i in r)this.sortPathConstraintAttachmentWith(r[i],n)},t.prototype.sortPathConstraintAttachmentWith=function(t,e){if(t instanceof Ztt){var n=t.bones;if(null==n)this.sortBone(e);else for(var r=this.bones,i=0;i<n.length;)for(var s=n[i++],a=i+s;i<a;i++){var o=n[i];this.sortBone(r[o])}}},t.prototype.sortBone=function(t){if(!t.sorted){var e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}},t.prototype.sortReset=function(t){for(var e=0,n=t.length;e<n;e++){var r=t[e];r.sorted&&this.sortReset(r.children),r.sorted=!1}},t.prototype.updateWorldTransform=function(){for(var t=this.updateCacheReset,e=0,n=t.length;e<n;e++){var r=t[e];r.ax=r.x,r.ay=r.y,r.arotation=r.rotation,r.ascaleX=r.scaleX,r.ascaleY=r.scaleY,r.ashearX=r.shearX,r.ashearY=r.shearY,r.appliedValid=!0}var i=this._updateCache;for(e=0,n=i.length;e<n;e++)i[e].update()},t.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},t.prototype.setBonesToSetupPose=function(){for(var t=this.bones,e=0,n=t.length;e<n;e++)t[e].setToSetupPose();var r=this.ikConstraints;for(e=0,n=r.length;e<n;e++){(o=r[e]).bendDirection=o.data.bendDirection,o.mix=o.data.mix}var i=this.transformConstraints;for(e=0,n=i.length;e<n;e++){var s=(o=i[e]).data;o.rotateMix=s.rotateMix,o.translateMix=s.translateMix,o.scaleMix=s.scaleMix,o.shearMix=s.shearMix}var a=this.pathConstraints;for(e=0,n=a.length;e<n;e++){var o;s=(o=a[e]).data;o.position=s.position,o.spacing=s.spacing,o.rotateMix=s.rotateMix,o.translateMix=s.translateMix}},t.prototype.setSlotsToSetupPose=function(){var t=this.slots;w7.arrayCopy(t,0,this.drawOrder,0,t.length);for(var e=0,n=t.length;e<n;e++)t[e].setToSetupPose()},t.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},t.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,r=e.length;n<r;n++){var i=e[n];if(i.data.name==t)return i}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,r=e.length;n<r;n++)if(e[n].data.name==t)return n;return-1},t.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,r=e.length;n<r;n++){var i=e[n];if(i.data.name==t)return i}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,r=e.length;n<r;n++)if(e[n].data.name==t)return n;return-1},t.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)},t.prototype.setSkin=function(t){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,n=0,r=e.length;n<r;n++){var i=e[n],s=i.data.attachmentName;if(null!=s){var a=t.getAttachment(n,s);null!=a&&i.setAttachment(a)}}this.skin=t},t.prototype.getAttachmentByName=function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)},t.prototype.getAttachment=function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var n=this.skin.getAttachment(t,e);if(null!=n)return n}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},t.prototype.setAttachment=function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var n=this.slots,r=0,i=n.length;r<i;r++){var s=n[r];if(s.data.name==t){var a=null;if(null!=e&&null==(a=this.getAttachment(r,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void s.setAttachment(a)}}throw new Error("Slot not found: "+t)},t.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.data.name==t)return i}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.data.name==t)return i}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.data.name==t)return i}return null},t.prototype.getBounds=function(t,e,n){if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");for(var r=this.drawOrder,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,l=0,h=r.length;l<h;l++){var u=r[l],c=0,d=null,p=u.getAttachment();if(p instanceof Qtt)c=8,d=w7.setArraySize(n,c,0),p.computeWorldVertices(u.bone,d,0,2);else if(p instanceof Ktt){var f=p;c=f.worldVerticesLength,d=w7.setArraySize(n,c,0),f.computeWorldVertices(u,0,c,d,0,2)}if(null!=d)for(var m=0,g=d.length;m<g;m+=2){var y=d[m],v=d[m+1];i=Math.min(i,y),s=Math.min(s,v),a=Math.max(a,y),o=Math.max(o,v)}}t.set(i,s),e.set(a-i,o-s)},t.prototype.update=function(t){this.time+=t},Object.defineProperty(t.prototype,"flipX",{get:function(){return-1==this.scaleX},set:function(e){t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.scaleX=e?1:-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"flipY",{get:function(){return-1==this.scaleY},set:function(e){t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.scaleY=e?1:-1},enumerable:!1,configurable:!0}),t.deprecatedWarning1=!1,t}(),Vet=function(){function t(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new _7((function(){return w7.newFloatArray(16)}))}return t.prototype.update=function(t,e){if(null==t)throw new Error("skeleton cannot be null.");var n=this.boundingBoxes,r=this.polygons,i=this.polygonPool,s=t.slots,a=s.length;n.length=0,i.freeAll(r),r.length=0;for(var o=0;o<a;o++){var l=s[o],h=l.getAttachment();if(h instanceof jtt){var u=h;n.push(u);var c=i.obtain();c.length!=u.worldVerticesLength&&(c=w7.newFloatArray(u.worldVerticesLength)),r.push(c),u.computeWorldVertices(l,0,u.worldVerticesLength,c,0,2)}}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},t.prototype.aabbCompute=function(){for(var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=this.polygons,s=0,a=i.length;s<a;s++)for(var o=i[s],l=o,h=0,u=o.length;h<u;h+=2){var c=l[h],d=l[h+1];t=Math.min(t,c),e=Math.min(e,d),n=Math.max(n,c),r=Math.max(r,d)}this.minX=t,this.minY=e,this.maxX=n,this.maxY=r},t.prototype.aabbContainsPoint=function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},t.prototype.aabbIntersectsSegment=function(t,e,n,r){var i=this.minX,s=this.minY,a=this.maxX,o=this.maxY;if(t<=i&&n<=i||e<=s&&r<=s||t>=a&&n>=a||e>=o&&r>=o)return!1;var l=(r-e)/(n-t),h=l*(i-t)+e;if(h>s&&h<o)return!0;if((h=l*(a-t)+e)>s&&h<o)return!0;var u=(s-e)/l+t;return u>i&&u<a||(u=(o-e)/l+t)>i&&u<a},t.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},t.prototype.containsPoint=function(t,e){for(var n=this.polygons,r=0,i=n.length;r<i;r++)if(this.containsPointPolygon(n[r],t,e))return this.boundingBoxes[r];return null},t.prototype.containsPointPolygon=function(t,e,n){for(var r=t,i=t.length,s=i-2,a=!1,o=0;o<i;o+=2){var l=r[o+1],h=r[s+1];if(l<n&&h>=n||h<n&&l>=n){var u=r[o];u+(n-l)/(h-l)*(r[s]-u)<e&&(a=!a)}s=o}return a},t.prototype.intersectsSegment=function(t,e,n,r){for(var i=this.polygons,s=0,a=i.length;s<a;s++)if(this.intersectsSegmentPolygon(i[s],t,e,n,r))return this.boundingBoxes[s];return null},t.prototype.intersectsSegmentPolygon=function(t,e,n,r,i){for(var s=t,a=t.length,o=e-r,l=n-i,h=e*i-n*r,u=s[a-2],c=s[a-1],d=0;d<a;d+=2){var p=s[d],f=s[d+1],m=u*f-c*p,g=u-p,y=c-f,v=o*y-l*g,x=(h*g-o*m)/v;if((x>=u&&x<=p||x>=p&&x<=u)&&(x>=e&&x<=r||x>=r&&x<=e)){var b=(h*y-l*m)/v;if((b>=c&&b<=f||b>=f&&b<=c)&&(b>=n&&b<=i||b>=i&&b<=n))return!0}u=p,c=f}return!1},t.prototype.getPolygon=function(t){if(null==t)throw new Error("boundingBox cannot be null.");var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},t.prototype.getWidth=function(){return this.maxX-this.minX},t.prototype.getHeight=function(){return this.maxY-this.minY},t}(),zet=function(){function t(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}return t.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1},t.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1},t.prototype.findSkin=function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findEvent=function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findAnimation=function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findPathConstraintIndex=function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1},t}(),Get=function(t,e,n){if(this.color=new y7(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==n)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=n},Wet=function(t){if(this.order=0,this.bones=new Array,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1,null==t)throw new Error("name cannot be null.");this.name=t},Xet=function(){function t(t){if(this.attachments=new Array,null==t)throw new Error("name cannot be null.");this.name=t}return t.prototype.addAttachment=function(t,e,n){if(null==n)throw new Error("attachment cannot be null.");var r=this.attachments;t>=r.length&&(r.length=t+1),r[t]||(r[t]={}),r[t][e]=n},t.prototype.getAttachment=function(t,e){var n=this.attachments[t];return n?n[e]:null},t.prototype.attachAll=function(t,e){for(var n=0,r=0;r<t.slots.length;r++){var i=t.slots[r],s=i.getAttachment();if(s&&n<e.attachments.length){var a=e.attachments[n];for(var o in a){if(s==a[o]){var l=this.getAttachment(n,o);null!=l&&i.setAttachment(l);break}}}n++}},t}(),Het=function(){function t(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return t.prototype.readSkeletonData=function(e){var n=this.scale,r=new zet,i="string"==typeof e?JSON.parse(e):e,s=i.skeleton;if(null!=s&&(r.hash=s.hash,r.version=s.spine,r.width=s.width,r.height=s.height,r.fps=s.fps,r.imagesPath=s.images),i.bones)for(var a=0;a<i.bones.length;a++){var o=i.bones[a],l=null,h=this.getValue(o,"parent",null);if(null!=h&&null==(l=r.findBone(h)))throw new Error("Parent bone not found: "+h);(p=new Ret(r.bones.length,o.name,l)).length=this.getValue(o,"length",0)*n,p.x=this.getValue(o,"x",0)*n,p.y=this.getValue(o,"y",0)*n,p.rotation=this.getValue(o,"rotation",0),p.scaleX=this.getValue(o,"scaleX",1),p.scaleY=this.getValue(o,"scaleY",1),p.shearX=this.getValue(o,"shearX",0),p.shearY=this.getValue(o,"shearY",0),p.transformMode=t.transformModeFromString(this.getValue(o,"transform","normal")),r.bones.push(p)}if(i.slots)for(a=0;a<i.slots.length;a++){var u=(E=i.slots[a]).name,c=E.bone,d=r.findBone(c);if(null==d)throw new Error("Slot bone not found: "+c);var p=new Get(r.slots.length,u,d),f=this.getValue(E,"color",null);null!=f&&p.color.setFromString(f);var m=this.getValue(E,"dark",null);null!=m&&(p.darkColor=new y7(1,1,1,1),p.darkColor.setFromString(m)),p.attachmentName=this.getValue(E,"attachment",null),p.blendMode=t.blendModeFromString(this.getValue(E,"blend","normal")),r.slots.push(p)}if(i.ik)for(a=0;a<i.ik.length;a++){var g=i.ik[a];(p=new Det(g.name)).order=this.getValue(g,"order",0);for(var y=0;y<g.bones.length;y++){c=g.bones[y];if(null==(x=r.findBone(c)))throw new Error("IK bone not found: "+c);p.bones.push(x)}var v=g.target;if(p.target=r.findBone(v),null==p.target)throw new Error("IK target bone not found: "+v);p.bendDirection=this.getValue(g,"bendPositive",!0)?1:-1,p.mix=this.getValue(g,"mix",1),r.ikConstraints.push(p)}if(i.transform)for(a=0;a<i.transform.length;a++){g=i.transform[a];(p=new Wet(g.name)).order=this.getValue(g,"order",0);for(y=0;y<g.bones.length;y++){c=g.bones[y];if(null==(x=r.findBone(c)))throw new Error("Transform constraint bone not found: "+c);p.bones.push(x)}v=g.target;if(p.target=r.findBone(v),null==p.target)throw new Error("Transform constraint target bone not found: "+v);p.local=this.getValue(g,"local",!1),p.relative=this.getValue(g,"relative",!1),p.offsetRotation=this.getValue(g,"rotation",0),p.offsetX=this.getValue(g,"x",0)*n,p.offsetY=this.getValue(g,"y",0)*n,p.offsetScaleX=this.getValue(g,"scaleX",0),p.offsetScaleY=this.getValue(g,"scaleY",0),p.offsetShearY=this.getValue(g,"shearY",0),p.rotateMix=this.getValue(g,"rotateMix",1),p.translateMix=this.getValue(g,"translateMix",1),p.scaleMix=this.getValue(g,"scaleMix",1),p.shearMix=this.getValue(g,"shearMix",1),r.transformConstraints.push(p)}if(i.path)for(a=0;a<i.path.length;a++){g=i.path[a];(p=new Fet(g.name)).order=this.getValue(g,"order",0);for(y=0;y<g.bones.length;y++){var x;c=g.bones[y];if(null==(x=r.findBone(c)))throw new Error("Transform constraint bone not found: "+c);p.bones.push(x)}v=g.target;if(p.target=r.findSlot(v),null==p.target)throw new Error("Path target slot not found: "+v);p.positionMode=t.positionModeFromString(this.getValue(g,"positionMode","percent")),p.spacingMode=t.spacingModeFromString(this.getValue(g,"spacingMode","length")),p.rotateMode=t.rotateModeFromString(this.getValue(g,"rotateMode","tangent")),p.offsetRotation=this.getValue(g,"rotation",0),p.position=this.getValue(g,"position",0),p.positionMode==J9.Fixed&&(p.position*=n),p.spacing=this.getValue(g,"spacing",0),p.spacingMode!=Iet.Length&&p.spacingMode!=Iet.Fixed||(p.spacing*=n),p.rotateMix=this.getValue(g,"rotateMix",1),p.translateMix=this.getValue(g,"translateMix",1),r.pathConstraints.push(p)}if(i.skins)for(var b in i.skins){var w=i.skins[b],_=new Xet(b);for(var u in w){var T=r.findSlotIndex(u);if(-1==T)throw new Error("Slot not found: "+u);var E=w[u];for(var S in E){var I=this.readAttachment(E[S],_,T,S,r);null!=I&&_.addAttachment(T,S,I)}}r.skins.push(_),"default"==_.name&&(r.defaultSkin=_)}a=0;for(var k=this.linkedMeshes.length;a<k;a++){var C=this.linkedMeshes[a];if(null==(_=null==C.skin?r.defaultSkin:r.findSkin(C.skin)))throw new Error("Skin not found: "+C.skin);var N=_.getAttachment(C.slotIndex,C.parent);if(null==N)throw new Error("Parent mesh not found: "+C.parent);C.mesh.setParentMesh(N)}if(this.linkedMeshes.length=0,i.events)for(var A in i.events){var R=i.events[A];(p=new Oet(A)).intValue=this.getValue(R,"int",0),p.floatValue=this.getValue(R,"float",0),p.stringValue=this.getValue(R,"string",""),p.audioPath=this.getValue(R,"audio",null),null!=p.audioPath&&(p.volume=this.getValue(R,"volume",1),p.balance=this.getValue(R,"balance",0)),r.events.push(p)}if(i.animations)for(var M in i.animations){var O=i.animations[M];this.readAnimation(O,M,r)}return r},t.prototype.readAttachment=function(t,e,n,r,i){var s=this.scale;switch(r=this.getValue(t,"name",r),this.getValue(t,"type","region")){case"region":var a=this.getValue(t,"path",r),o=this.attachmentLoader.newRegionAttachment(e,r,a);return null==o?null:(o.path=a,o.x=this.getValue(t,"x",0)*s,o.y=this.getValue(t,"y",0)*s,o.scaleX=this.getValue(t,"scaleX",1),o.scaleY=this.getValue(t,"scaleY",1),o.rotation=this.getValue(t,"rotation",0),o.width=t.width*s,o.height=t.height*s,null!=(x=this.getValue(t,"color",null))&&o.color.setFromString(x),o);case"boundingbox":var l=this.attachmentLoader.newBoundingBoxAttachment(e,r);return null==l?null:(this.readVertices(t,l,t.vertexCount<<1),null!=(x=this.getValue(t,"color",null))&&l.color.setFromString(x),l);case"mesh":case"linkedmesh":a=this.getValue(t,"path",r);var h=this.attachmentLoader.newMeshAttachment(e,r,a);if(null==h)return null;h.path=a,null!=(x=this.getValue(t,"color",null))&&h.color.setFromString(x);var u=this.getValue(t,"parent",null);if(null!=u)return h.inheritDeform=this.getValue(t,"deform",!0),this.linkedMeshes.push(new Yet(h,this.getValue(t,"skin",null),n,u)),h;var c=t.uvs;return this.readVertices(t,h,c.length),h.triangles=t.triangles,h.regionUVs=new Float32Array(c),h.hullLength=2*this.getValue(t,"hull",0),h;case"path":if(null==(a=this.attachmentLoader.newPathAttachment(e,r)))return null;a.closed=this.getValue(t,"closed",!1),a.constantSpeed=this.getValue(t,"constantSpeed",!0);var d=t.vertexCount;this.readVertices(t,a,d<<1);for(var p=w7.newArray(d/3,0),f=0;f<t.lengths.length;f++)p[f]=t.lengths[f]*s;return a.lengths=p,null!=(x=this.getValue(t,"color",null))&&a.color.setFromString(x),a;case"point":var m=this.attachmentLoader.newPointAttachment(e,r);return null==m?null:(m.x=this.getValue(t,"x",0)*s,m.y=this.getValue(t,"y",0)*s,m.rotation=this.getValue(t,"rotation",0),null!=(x=this.getValue(t,"color",null))&&m.color.setFromString(x),m);case"clipping":var g=this.attachmentLoader.newClippingAttachment(e,r);if(null==g)return null;var y=this.getValue(t,"end",null);if(null!=y){var v=i.findSlot(y);if(null==v)throw new Error("Clipping end slot not found: "+y);g.endSlot=v}var x;d=t.vertexCount;return this.readVertices(t,g,d<<1),null!=(x=this.getValue(t,"color",null))&&g.color.setFromString(x),g}return null},t.prototype.readVertices=function(t,e,n){var r=this.scale;e.worldVerticesLength=n;var i=t.vertices;if(n!=i.length){var s=new Array,a=new Array;for(u=0,c=i.length;u<c;){var o=i[u++];a.push(o);for(var l=u+4*o;u<l;u+=4)a.push(i[u]),s.push(i[u+1]*r),s.push(i[u+2]*r),s.push(i[u+3])}e.bones=a,e.vertices=w7.toFloatArray(s)}else{var h=w7.toFloatArray(i);if(1!=r)for(var u=0,c=i.length;u<c;u++)h[u]*=r;e.vertices=h}},t.prototype.readAnimation=function(t,e,n){var r=this.scale,i=new Array,s=0;if(t.slots)for(var a in t.slots){var o=t.slots[a];if(-1==(j=n.findSlotIndex(a)))throw new Error("Slot not found: "+a);for(var l in o){var h=o[l];if("attachment"==l){(x=new det(h.length)).slotIndex=j;for(var u=0,c=0;c<h.length;c++){var d=h[c];x.setFrame(u++,d.time,d.name)}i.push(x),s=Math.max(s,x.frames[x.getFrameCount()-1])}else if("color"==l){(x=new uet(h.length)).slotIndex=j;for(u=0,c=0;c<h.length;c++){d=h[c];var p=new y7;p.setFromString(d.color||"ffffffff"),x.setFrame(u,d.time,p.r,p.g,p.b,p.a),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[(x.getFrameCount()-1)*uet.ENTRIES])}else{if("twoColor"!=l)throw new Error("Invalid timeline type for a slot: "+l+" ("+a+")");(x=new cet(h.length)).slotIndex=j;for(u=0,c=0;c<h.length;c++){d=h[c];var f=new y7,m=new y7;f.setFromString(d.light),m.setFromString(d.dark),x.setFrame(u,d.time,f.r,f.g,f.b,f.a,m.r,m.g,m.b),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[(x.getFrameCount()-1)*cet.ENTRIES])}}}if(t.bones)for(var g in t.bones){var y=t.bones[g],v=n.findBoneIndex(g);if(-1==v)throw new Error("Bone not found: "+g);for(var l in y){h=y[l];if("rotate"===l){(x=new set(h.length)).boneIndex=v;for(u=0,c=0;c<h.length;c++){d=h[c];x.setFrame(u,d.time,d.angle),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[(x.getFrameCount()-1)*set.ENTRIES])}else{if("translate"!==l&&"scale"!==l&&"shear"!==l)throw new Error("Invalid timeline type for a bone: "+l+" ("+g+")");var x=null,b=1;"scale"===l?x=new oet(h.length):"shear"===l?x=new het(h.length):(x=new aet(h.length),b=r),x.boneIndex=v;for(u=0,c=0;c<h.length;c++){d=h[c];var w=this.getValue(d,"x",0),_=this.getValue(d,"y",0);x.setFrame(u,d.time,w*b,_*b),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[(x.getFrameCount()-1)*aet.ENTRIES])}}}if(t.ik)for(var T in t.ik){var E=t.ik[T],S=n.findIkConstraint(T);(x=new yet(E.length)).ikConstraintIndex=n.ikConstraints.indexOf(S);for(u=0,c=0;c<E.length;c++){d=E[c];x.setFrame(u,d.time,this.getValue(d,"mix",1),this.getValue(d,"bendPositive",!0)?1:-1,this.getValue(d,"compress",!1),this.getValue(d,"stretch",!1)),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[(x.getFrameCount()-1)*yet.ENTRIES])}if(t.transform)for(var T in t.transform){E=t.transform[T],S=n.findTransformConstraint(T);(x=new vet(E.length)).transformConstraintIndex=n.transformConstraints.indexOf(S);for(u=0,c=0;c<E.length;c++){d=E[c];x.setFrame(u,d.time,this.getValue(d,"rotateMix",1),this.getValue(d,"translateMix",1),this.getValue(d,"scaleMix",1),this.getValue(d,"shearMix",1)),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[(x.getFrameCount()-1)*vet.ENTRIES])}if(t.paths)for(var T in t.paths){E=t.paths[T];var I=n.findPathConstraintIndex(T);if(-1==I)throw new Error("Path constraint not found: "+T);var k=n.pathConstraints[I];for(var l in E){h=E[l];if("position"===l||"spacing"===l){x=null,b=1;"spacing"===l?(x=new bet(h.length),k.spacingMode!=Iet.Length&&k.spacingMode!=Iet.Fixed||(b=r)):(x=new xet(h.length),k.positionMode==J9.Fixed&&(b=r)),x.pathConstraintIndex=I;for(u=0,c=0;c<h.length;c++){d=h[c];x.setFrame(u,d.time,this.getValue(d,l,0)*b),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[(x.getFrameCount()-1)*xet.ENTRIES])}else if("mix"===l){(x=new wet(h.length)).pathConstraintIndex=I;for(u=0,c=0;c<h.length;c++){d=h[c];x.setFrame(u,d.time,this.getValue(d,"rotateMix",1),this.getValue(d,"translateMix",1)),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[(x.getFrameCount()-1)*wet.ENTRIES])}}}if(t.deform)for(var C in t.deform){var N=t.deform[C],A=n.findSkin(C);if(null!=A)for(var a in N){o=N[a];if(-1==(j=n.findSlotIndex(a)))throw new Error("Slot not found: "+o.name);for(var l in o){h=o[l];var R=A.getAttachment(j,l);if(null==R)throw new Error("Deform attachment not found: "+h.name);var M=null!=R.bones,O=R.vertices,P=M?O.length/3*2:O.length;(x=new fet(h.length)).slotIndex=j,x.attachment=R;u=0;for(var D=0;D<h.length;D++){d=h[D];var F=void 0,L=this.getValue(d,"vertices",null);if(null==L)F=M?w7.newFloatArray(P):O;else{F=w7.newFloatArray(P);var B=this.getValue(d,"offset",0);if(w7.arrayCopy(L,0,F,B,L.length),1!=r)for(var $=(c=B)+L.length;c<$;c++)F[c]*=r;if(!M)for(c=0;c<P;c++)F[c]+=O[c]}x.setFrame(u,d.time,F),this.readCurve(d,x,u),u++}i.push(x),s=Math.max(s,x.frames[x.getFrameCount()-1])}}else if(S7)throw new Error("Skin not found: "+C)}var U=t.drawOrder;if(null==U&&(U=t.draworder),null!=U){x=new get(U.length);var V=n.slots.length;for(u=0,D=0;D<U.length;D++){var z=U[D],G=null,W=this.getValue(z,"offsets",null);if(null!=W){G=w7.newArray(V,-1);var X=w7.newArray(V-W.length,0),H=0,Y=0;for(c=0;c<W.length;c++){var j,q=W[c];if(-1==(j=n.findSlotIndex(q.slot)))throw new Error("Slot not found: "+q.slot);for(;H!=j;)X[Y++]=H++;G[H+q.offset]=H++}for(;H<V;)X[Y++]=H++;for(c=V-1;c>=0;c--)-1==G[c]&&(G[c]=X[--Y])}x.setFrame(u++,z.time,G)}i.push(x),s=Math.max(s,x.frames[x.getFrameCount()-1])}if(t.events){for(x=new met(t.events.length),u=0,c=0;c<t.events.length;c++){var K=t.events[c],Z=n.findEvent(K.name);if(null==Z)throw new Error("Event not found: "+K.name);var J=new Met(w7.toSinglePrecision(K.time),Z);J.intValue=this.getValue(K,"int",Z.intValue),J.floatValue=this.getValue(K,"float",Z.floatValue),J.stringValue=this.getValue(K,"string",Z.stringValue),null!=J.data.audioPath&&(J.volume=this.getValue(K,"volume",1),J.balance=this.getValue(K,"balance",0)),x.setFrame(u++,J)}i.push(x),s=Math.max(s,x.frames[x.getFrameCount()-1])}if(isNaN(s))throw new Error("Error while parsing animation, duration is NaN");n.animations.push(new net(e,i,s))},t.prototype.readCurve=function(t,e,n){if(t.curve)if("stepped"===t.curve)e.setStepped(n);else if("[object Array]"===Object.prototype.toString.call(t.curve)){var r=t.curve;e.setCurve(n,r[0],r[1],r[2],r[3])}},t.prototype.getValue=function(t,e,n){return void 0!==t[e]?t[e]:n},t.blendModeFromString=function(t){if("normal"==(t=t.toLowerCase()))return se.NORMAL;if("additive"==t)return se.ADD;if("multiply"==t)return se.MULTIPLY;if("screen"==t)return se.SCREEN;throw new Error("Unknown blend mode: "+t)},t.positionModeFromString=function(t){if("fixed"==(t=t.toLowerCase()))return J9.Fixed;if("percent"==t)return J9.Percent;throw new Error("Unknown position mode: "+t)},t.spacingModeFromString=function(t){if("length"==(t=t.toLowerCase()))return Iet.Length;if("fixed"==t)return Iet.Fixed;if("percent"==t)return Iet.Percent;throw new Error("Unknown position mode: "+t)},t.rotateModeFromString=function(t){if("tangent"==(t=t.toLowerCase()))return Q9.Tangent;if("chain"==t)return Q9.Chain;if("chainscale"==t)return Q9.ChainScale;throw new Error("Unknown rotate mode: "+t)},t.transformModeFromString=function(t){if("normal"==(t=t.toLowerCase()))return t7.Normal;if("onlytranslation"==t)return t7.OnlyTranslation;if("norotationorreflection"==t)return t7.NoRotationOrReflection;if("noscale"==t)return t7.NoScale;if("noscaleorreflection"==t)return t7.NoScaleOrReflection;throw new Error("Unknown transform mode: "+t)},t}(),Yet=function(t,e,n,r){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=r},jet=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Wtt(e,t),e.prototype.createSkeleton=function(t){this.skeleton=new Uet(t),this.skeleton.updateWorldTransform(),this.stateData=new Cet(t),this.state=new _et(this.stateData)},e}(R7),qet=function(t,e){return qet=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},qet(t,e)};function Ket(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}qet(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var Zet,Jet=function(t){if(!t)throw new Error("name cannot be null.");this.name=t},Qet=function(t){function e(n){var r=t.call(this,n)||this;return r.id=e.nextID++,r.worldVerticesLength=0,r.deformAttachment=r,r}return Ket(e,t),e.prototype.computeWorldVerticesOld=function(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)},e.prototype.computeWorldVertices=function(t,e,n,r,i,s){n=i+(n>>1)*s;var a=t.bone.skeleton,o=t.deform,l=this.vertices,h=this.bones;if(h){for(var u=0,c=0,d=0;d<e;d+=2){u+=(g=h[u])+1,c+=g}var p=a.bones;if(0==o.length)for(C=i,E=3*c;C<n;C+=s){var f=0,m=0,g=h[u++];for(g+=u;u<g;u++,E+=3){b=p[h[u]].matrix,N=l[E],A=l[E+1];var y=l[E+2];f+=(N*b.a+A*b.c+b.tx)*y,m+=(N*b.b+A*b.d+b.ty)*y}r[C]=f,r[C+1]=m}else for(var v=o,x=(C=i,E=3*c,c<<1);C<n;C+=s){f=0,m=0,g=h[u++];for(g+=u;u<g;u++,E+=3,x+=2){b=p[h[u]].matrix,N=l[E]+v[x],A=l[E+1]+v[x+1],y=l[E+2];f+=(N*b.a+A*b.c+b.tx)*y,m+=(N*b.b+A*b.d+b.ty)*y}r[C]=f,r[C+1]=m}}else{o.length>0&&(l=o);for(var b,w=(b=t.bone.matrix).tx,_=b.ty,T=b.a,E=b.c,S=b.b,I=b.d,k=e,C=i;C<n;k+=2,C+=s){var N=l[k],A=l[k+1];r[C]=N*T+A*E+w,r[C+1]=N*S+A*I+_}}},e.prototype.copyTo=function(t){this.bones?(t.bones=new Array(this.bones.length),w7.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,this.vertices?(t.vertices=w7.newFloatArray(this.vertices.length),w7.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment},e.nextID=0,e}(Jet),tnt=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.BoundingBox,n.color=new y7(1,1,1,1),n}return Ket(e,t),e.prototype.copy=function(){var t=new e(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t},e}(Qet),ent=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.Clipping,n.color=new y7(.2275,.2275,.8078,1),n}return Ket(e,t),e.prototype.copy=function(){var t=new e(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t},e}(Qet),nnt=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.Mesh,n.color=new y7(1,1,1,1),n.tempColor=new y7(0,0,0,0),n}return Ket(e,t),e.prototype.getParentMesh=function(){return this.parentMesh},e.prototype.setParentMesh=function(t){this.parentMesh=t,t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)},e.prototype.copy=function(){if(this.parentMesh)return this.newLinkedMesh();var t=new e(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Float32Array(this.regionUVs.length),w7.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.triangles=new Array(this.triangles.length),w7.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,this.edges&&(t.edges=new Array(this.edges.length),w7.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t},e.prototype.newLinkedMesh=function(){var t=new e(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(this.parentMesh?this.parentMesh:this),t},e}(Qet),rnt=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.Path,n.closed=!1,n.constantSpeed=!1,n.color=new y7(1,1,1,1),n}return Ket(e,t),e.prototype.copy=function(){var t=new e(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),w7.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t},e}(Qet),int=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.Point,n.color=new y7(.38,.94,0,1),n}return Ket(e,t),e.prototype.computeWorldPosition=function(t,e){var n=t.matrix;return e.x=this.x*n.a+this.y*n.c+t.worldX,e.y=this.x*n.b+this.y*n.d+t.worldY,e},e.prototype.computeWorldRotation=function(t){var e=t.matrix,n=v7.cosDeg(this.rotation),r=v7.sinDeg(this.rotation),i=n*e.a+r*e.c,s=n*e.b+r*e.d;return Math.atan2(s,i)*v7.radDeg},e.prototype.copy=function(){var t=new e(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t},e}(Qet),snt=function(t){function e(e){var n=t.call(this,e)||this;return n.type=$9.Region,n.x=0,n.y=0,n.scaleX=1,n.scaleY=1,n.rotation=0,n.width=0,n.height=0,n.color=new y7(1,1,1,1),n.offset=w7.newFloatArray(8),n.uvs=w7.newFloatArray(8),n.tempColor=new y7(1,1,1,1),n}return Ket(e,t),e.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX,n=this.height/this.region.originalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.region.offsetX*t,i=-this.height/2*this.scaleY+this.region.offsetY*n,s=r+this.region.width*t,a=i+this.region.height*n,o=this.rotation*Math.PI/180,l=Math.cos(o),h=Math.sin(o),u=r*l+this.x,c=r*h,d=i*l+this.y,p=i*h,f=s*l+this.x,m=s*h,g=a*l+this.y,y=a*h,v=this.offset;v[e.OX1]=u-p,v[e.OY1]=d+c,v[e.OX2]=u-y,v[e.OY2]=g+c,v[e.OX3]=f-y,v[e.OY3]=g+m,v[e.OX4]=f-p,v[e.OY4]=d+m},e.prototype.setRegion=function(t){this.region=t;var e=this.uvs;90==t.degrees?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)},e.prototype.computeWorldVertices=function(t,n,r,i){var s=this.offset,a=t.matrix,o=a.tx,l=a.ty,h=a.a,u=a.c,c=a.b,d=a.d,p=0,f=0;p=s[e.OX1],f=s[e.OY1],n[r]=p*h+f*u+o,n[r+1]=p*c+f*d+l,r+=i,p=s[e.OX2],f=s[e.OY2],n[r]=p*h+f*u+o,n[r+1]=p*c+f*d+l,r+=i,p=s[e.OX3],f=s[e.OY3],n[r]=p*h+f*u+o,n[r+1]=p*c+f*d+l,r+=i,p=s[e.OX4],f=s[e.OY4],n[r]=p*h+f*u+o,n[r+1]=p*c+f*d+l},e.prototype.copy=function(){var t=new e(this.name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,w7.arrayCopy(this.uvs,0,t.uvs,0,8),w7.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t},e.OX1=0,e.OY1=1,e.OX2=2,e.OY2=3,e.OX3=4,e.OY3=5,e.OX4=6,e.OY4=7,e.X1=0,e.Y1=1,e.C1R=2,e.C1G=3,e.C1B=4,e.C1A=5,e.U1=6,e.V1=7,e.X2=8,e.Y2=9,e.C2R=10,e.C2G=11,e.C2B=12,e.C2A=13,e.U2=14,e.V2=15,e.X3=16,e.Y3=17,e.C3R=18,e.C3G=19,e.C3B=20,e.C3A=21,e.U3=22,e.V3=23,e.X4=24,e.Y4=25,e.C4R=26,e.C4G=27,e.C4B=28,e.C4A=29,e.U4=30,e.V4=31,e}(Jet),ant=function(){function t(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}return t.prototype.begin=function(t){},t.prototype.transform=function(t,e,n,r){t.x+=v7.randomTriangular(-this.jitterX,this.jitterY),t.y+=v7.randomTriangular(-this.jitterX,this.jitterY)},t.prototype.end=function(){},t}(),ont=function(){function t(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}return t.prototype.begin=function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY},t.prototype.transform=function(e,n,r,i){var s=this.angle*v7.degreesToRadians,a=e.x-this.worldX,o=e.y-this.worldY,l=Math.sqrt(a*a+o*o);if(l<this.radius){var h=t.interpolation.apply(0,s,(this.radius-l)/this.radius),u=Math.cos(h),c=Math.sin(h);e.x=u*a-c*o+this.worldX,e.y=c*a+u*o+this.worldY}},t.prototype.end=function(){},t.interpolation=new b7(2),t}(),lnt=function(){function t(t,e,n){if(!t)throw new Error("name cannot be null.");this.name=t,this.setTimelines(e),this.duration=n}return t.prototype.setTimelines=function(t){if(!t)throw new Error("timelines cannot be null.");this.timelines=t,this.timelineIds=new g7;for(var e=0;e<t.length;e++)this.timelineIds.addAll(t[e].getPropertyIds())},t.prototype.hasTimeline=function(t){for(var e=0;e<t.length;e++)if(this.timelineIds.contains(t[e]))return!0;return!1},t.prototype.apply=function(t,e,n,r,i,s,a,o){if(!t)throw new Error("skeleton cannot be null.");r&&0!=this.duration&&(n%=this.duration,e>0&&(e%=this.duration));for(var l=this.timelines,h=0,u=l.length;h<u;h++)l[h].apply(t,e,n,i,s,a,o)},t}(),hnt=0,unt=1,cnt=2,dnt=3,pnt=4,fnt=5,mnt=6,gnt=7,ynt=8,vnt=9,xnt=10,bnt=11,wnt=12,_nt=13,Tnt=14,Ent=15,Snt=16,Int=17,knt=18,Cnt=function(){function t(t,e){this.propertyIds=e,this.frames=w7.newFloatArray(t*this.getFrameEntries())}return t.prototype.getPropertyIds=function(){return this.propertyIds},t.prototype.getFrameEntries=function(){return 1},t.prototype.getFrameCount=function(){return this.frames.length/this.getFrameEntries()},t.prototype.getDuration=function(){return this.frames[this.frames.length-this.getFrameEntries()]},t.search1=function(t,e){for(var n=t.length,r=1;r<n;r++)if(t[r]>e)return r-1;return n-1},t.search=function(t,e,n){for(var r=t.length,i=n;i<r;i+=n)if(t[i]>e)return i-n;return r-n},t}(),Nnt=function(t){function e(e,n,r){var i=t.call(this,e,r)||this;return i.curves=w7.newFloatArray(e+18*n),i.curves[e-1]=1,i}return Ket(e,t),e.prototype.setLinear=function(t){this.curves[t]=0},e.prototype.setStepped=function(t){this.curves[t]=1},e.prototype.shrink=function(t){var e=this.getFrameCount()+18*t;if(this.curves.length>e){var n=w7.newFloatArray(e);w7.arrayCopy(this.curves,0,n,0,e),this.curves=n}},e.prototype.setBezier=function(t,e,n,r,i,s,a,o,l,h,u){var c=this.curves,d=this.getFrameCount()+18*t;0==n&&(c[e]=2+d);for(var p=.03*(r-2*s+o),f=.03*(i-2*a+l),m=.006*(3*(s-o)-r+h),g=.006*(3*(a-l)-i+u),y=2*p+m,v=2*f+g,x=.3*(s-r)+p+.16666667*m,b=.3*(a-i)+f+.16666667*g,w=r+x,_=i+b,T=d+18;d<T;d+=2)c[d]=w,c[d+1]=_,x+=y,b+=v,y+=m,v+=g,w+=x,_+=b},e.prototype.getBezierValue=function(t,e,n,r){var i=this.curves;if(i[r]>t){var s=this.frames[e],a=this.frames[e+n];return a+(t-s)/(i[r]-s)*(i[r+1]-a)}var o=r+18;for(r+=2;r<o;r+=2)if(i[r]>=t){var l=i[r-2],h=i[r-1];return h+(t-l)/(i[r]-l)*(i[r+1]-h)}e+=this.getFrameEntries();var u=i[o-2],c=i[o-1];return c+(t-u)/(this.frames[e]-u)*(this.frames[e+n]-c)},e}(Cnt),Ant=function(t){function e(e,n,r){return t.call(this,e,n,[r])||this}return Ket(e,t),e.prototype.getFrameEntries=function(){return 2},e.prototype.setFrame=function(t,e,n){t<<=1,this.frames[t]=e,this.frames[t+1]=n},e.prototype.getCurveValue=function(t){for(var e=this.frames,n=e.length-2,r=2;r<=n;r+=2)if(e[r]>t){n=r-2;break}var i=this.curves[n>>1];switch(i){case 0:var s=e[n],a=e[n+1];return a+(t-s)/(e[n+2]-s)*(e[n+2+1]-a);case 1:return e[n+1]}return this.getBezierValue(t,n,1,i-2)},e}(Nnt),Rnt=function(t){function e(e,n,r,i){return t.call(this,e,n,[r,i])||this}return Ket(e,t),e.prototype.getFrameEntries=function(){return 3},e.prototype.setFrame=function(t,e,n,r){t*=3,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r},e}(Nnt),Mnt=function(t){function e(e,n,r){var i=t.call(this,e,n,hnt+"|"+r)||this;return i.boneIndex=0,i.boneIndex=r,i}return Ket(e,t),e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.bones[this.boneIndex];if(o.active)if(n<this.frames[0])switch(s){case K9.setup:return void(o.rotation=o.data.rotation);case K9.first:o.rotation+=(o.data.rotation-o.rotation)*i}else{var l=this.getCurveValue(n);switch(s){case K9.setup:o.rotation=o.data.rotation+l*i;break;case K9.first:case K9.replace:l+=o.data.rotation-o.rotation;case K9.add:o.rotation+=l*i}}},e}(Ant),Ont=function(t){function e(e,n,r){var i=t.call(this,e,n,unt+"|"+r,cnt+"|"+r)||this;return i.boneIndex=0,i.boneIndex=r,i}return Ket(e,t),e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.bones[this.boneIndex];if(o.active){var l=this.frames;if(n<l[0])switch(s){case K9.setup:return o.x=o.data.x,void(o.y=o.data.y);case K9.first:o.x+=(o.data.x-o.x)*i,o.y+=(o.data.y-o.y)*i}else{var h=0,u=0,c=Cnt.search(l,n,3),d=this.curves[c/3];switch(d){case 0:var p=l[c];h=l[c+1],u=l[c+2];var f=(n-p)/(l[c+3]-p);h+=(l[c+3+1]-h)*f,u+=(l[c+3+2]-u)*f;break;case 1:h=l[c+1],u=l[c+2];break;default:h=this.getBezierValue(n,c,1,d-2),u=this.getBezierValue(n,c,2,d+18-2)}switch(s){case K9.setup:o.x=o.data.x+h*i,o.y=o.data.y+u*i;break;case K9.first:case K9.replace:o.x+=(o.data.x+h-o.x)*i,o.y+=(o.data.y+u-o.y)*i;break;case K9.add:o.x+=h*i,o.y+=u*i}}}},e}(Rnt),Pnt=function(t){function e(e,n,r){var i=t.call(this,e,n,unt+"|"+r)||this;return i.boneIndex=0,i.boneIndex=r,i}return Ket(e,t),e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.bones[this.boneIndex];if(o.active)if(n<this.frames[0])switch(s){case K9.setup:return void(o.x=o.data.x);case K9.first:o.x+=(o.data.x-o.x)*i}else{var l=this.getCurveValue(n);switch(s){case K9.setup:o.x=o.data.x+l*i;break;case K9.first:case K9.replace:o.x+=(o.data.x+l-o.x)*i;break;case K9.add:o.x+=l*i}}},e}(Ant),Dnt=function(t){function e(e,n,r){var i=t.call(this,e,n,cnt+"|"+r)||this;return i.boneIndex=0,i.boneIndex=r,i}return Ket(e,t),e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.bones[this.boneIndex];if(o.active)if(n<this.frames[0])switch(s){case K9.setup:return void(o.y=o.data.y);case K9.first:o.y+=(o.data.y-o.y)*i}else{var l=this.getCurveValue(n);switch(s){case K9.setup:o.y=o.data.y+l*i;break;case K9.first:case K9.replace:o.y+=(o.data.y+l-o.y)*i;break;case K9.add:o.y+=l*i}}},e}(Ant),Fnt=function(t){function e(e,n,r){var i=t.call(this,e,n,dnt+"|"+r,pnt+"|"+r)||this;return i.boneIndex=0,i.boneIndex=r,i}return Ket(e,t),e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.bones[this.boneIndex];if(o.active){var l=this.frames;if(n<l[0])switch(s){case K9.setup:return o.scaleX=o.data.scaleX,void(o.scaleY=o.data.scaleY);case K9.first:o.scaleX+=(o.data.scaleX-o.scaleX)*i,o.scaleY+=(o.data.scaleY-o.scaleY)*i}else{var h,u,c=Cnt.search(l,n,3),d=this.curves[c/3];switch(d){case 0:var p=l[c];h=l[c+1],u=l[c+2];var f=(n-p)/(l[c+3]-p);h+=(l[c+3+1]-h)*f,u+=(l[c+3+2]-u)*f;break;case 1:h=l[c+1],u=l[c+2];break;default:h=this.getBezierValue(n,c,1,d-2),u=this.getBezierValue(n,c,2,d+18-2)}if(h*=o.data.scaleX,u*=o.data.scaleY,1==i)s==K9.add?(o.scaleX+=h-o.data.scaleX,o.scaleY+=u-o.data.scaleY):(o.scaleX=h,o.scaleY=u);else{var m=0,g=0;if(a==Z9.mixOut)switch(s){case K9.setup:m=o.data.scaleX,g=o.data.scaleY,o.scaleX=m+(Math.abs(h)*v7.signum(m)-m)*i,o.scaleY=g+(Math.abs(u)*v7.signum(g)-g)*i;break;case K9.first:case K9.replace:m=o.scaleX,g=o.scaleY,o.scaleX=m+(Math.abs(h)*v7.signum(m)-m)*i,o.scaleY=g+(Math.abs(u)*v7.signum(g)-g)*i;break;case K9.add:m=o.scaleX,g=o.scaleY,o.scaleX=m+(Math.abs(h)*v7.signum(m)-o.data.scaleX)*i,o.scaleY=g+(Math.abs(u)*v7.signum(g)-o.data.scaleY)*i}else switch(s){case K9.setup:m=Math.abs(o.data.scaleX)*v7.signum(h),g=Math.abs(o.data.scaleY)*v7.signum(u),o.scaleX=m+(h-m)*i,o.scaleY=g+(u-g)*i;break;case K9.first:case K9.replace:m=Math.abs(o.scaleX)*v7.signum(h),g=Math.abs(o.scaleY)*v7.signum(u),o.scaleX=m+(h-m)*i,o.scaleY=g+(u-g)*i;break;case K9.add:m=v7.signum(h),g=v7.signum(u),o.scaleX=Math.abs(o.scaleX)*m+(h-Math.abs(o.data.scaleX)*m)*i,o.scaleY=Math.abs(o.scaleY)*g+(u-Math.abs(o.data.scaleY)*g)*i}}}}},e}(Rnt),Lnt=function(t){function e(e,n,r){var i=t.call(this,e,n,dnt+"|"+r)||this;return i.boneIndex=0,i.boneIndex=r,i}return Ket(e,t),e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.bones[this.boneIndex];if(o.active)if(n<this.frames[0])switch(s){case K9.setup:return void(o.scaleX=o.data.scaleX);case K9.first:o.scaleX+=(o.data.scaleX-o.scaleX)*i}else{var l=this.getCurveValue(n)*o.data.scaleX;if(1==i)s==K9.add?o.scaleX+=l-o.data.scaleX:o.scaleX=l;else{var h=0;if(a==Z9.mixOut)switch(s){case K9.setup:h=o.data.scaleX,o.scaleX=h+(Math.abs(l)*v7.signum(h)-h)*i;break;case K9.first:case K9.replace:h=o.scaleX,o.scaleX=h+(Math.abs(l)*v7.signum(h)-h)*i;break;case K9.add:h=o.scaleX,o.scaleX=h+(Math.abs(l)*v7.signum(h)-o.data.scaleX)*i}else switch(s){case K9.setup:h=Math.abs(o.data.scaleX)*v7.signum(l),o.scaleX=h+(l-h)*i;break;case K9.first:case K9.replace:h=Math.abs(o.scaleX)*v7.signum(l),o.scaleX=h+(l-h)*i;break;case K9.add:h=v7.signum(l),o.scaleX=Math.abs(o.scaleX)*h+(l-Math.abs(o.data.scaleX)*h)*i}}}},e}(Ant),Bnt=function(t){function e(e,n,r){var i=t.call(this,e,n,pnt+"|"+r)||this;return i.boneIndex=0,i.boneIndex=r,i}return Ket(e,t),e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.bones[this.boneIndex];if(o.active)if(n<this.frames[0])switch(s){case K9.setup:return void(o.scaleY=o.data.scaleY);case K9.first:o.scaleY+=(o.data.scaleY-o.scaleY)*i}else{var l=this.getCurveValue(n)*o.data.scaleY;if(1==i)s==K9.add?o.scaleY+=l-o.data.scaleY:o.scaleY=l;else{var h=0;if(a==Z9.mixOut)switch(s){case K9.setup:h=o.data.scaleY,o.scaleY=h+(Math.abs(l)*v7.signum(h)-h)*i;break;case K9.first:case K9.replace:h=o.scaleY,o.scaleY=h+(Math.abs(l)*v7.signum(h)-h)*i;break;case K9.add:h=o.scaleY,o.scaleY=h+(Math.abs(l)*v7.signum(h)-o.data.scaleY)*i}else switch(s){case K9.setup:h=Math.abs(o.data.scaleY)*v7.signum(l),o.scaleY=h+(l-h)*i;break;case K9.first:case K9.replace:h=Math.abs(o.scaleY)*v7.signum(l),o.scaleY=h+(l-h)*i;break;case K9.add:h=v7.signum(l),o.scaleY=Math.abs(o.scaleY)*h+(l-Math.abs(o.data.scaleY)*h)*i}}}},e}(Ant),$nt=function(t){function e(e,n,r){var i=t.call(this,e,n,fnt+"|"+r,mnt+"|"+r)||this;return i.boneIndex=0,i.boneIndex=r,i}return Ket(e,t),e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.bones[this.boneIndex];if(o.active){var l=this.frames;if(n<l[0])switch(s){case K9.setup:return o.shearX=o.data.shearX,void(o.shearY=o.data.shearY);case K9.first:o.shearX+=(o.data.shearX-o.shearX)*i,o.shearY+=(o.data.shearY-o.shearY)*i}else{var h=0,u=0,c=Cnt.search(l,n,3),d=this.curves[c/3];switch(d){case 0:var p=l[c];h=l[c+1],u=l[c+2];var f=(n-p)/(l[c+3]-p);h+=(l[c+3+1]-h)*f,u+=(l[c+3+2]-u)*f;break;case 1:h=l[c+1],u=l[c+2];break;default:h=this.getBezierValue(n,c,1,d-2),u=this.getBezierValue(n,c,2,d+18-2)}switch(s){case K9.setup:o.shearX=o.data.shearX+h*i,o.shearY=o.data.shearY+u*i;break;case K9.first:case K9.replace:o.shearX+=(o.data.shearX+h-o.shearX)*i,o.shearY+=(o.data.shearY+u-o.shearY)*i;break;case K9.add:o.shearX+=h*i,o.shearY+=u*i}}}},e}(Rnt),Unt=function(t){function e(e,n,r){var i=t.call(this,e,n,fnt+"|"+r)||this;return i.boneIndex=0,i.boneIndex=r,i}return Ket(e,t),e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.bones[this.boneIndex];if(o.active)if(n<this.frames[0])switch(s){case K9.setup:return void(o.shearX=o.data.shearX);case K9.first:o.shearX+=(o.data.shearX-o.shearX)*i}else{var l=this.getCurveValue(n);switch(s){case K9.setup:o.shearX=o.data.shearX+l*i;break;case K9.first:case K9.replace:o.shearX+=(o.data.shearX+l-o.shearX)*i;break;case K9.add:o.shearX+=l*i}}},e}(Ant),Vnt=function(t){function e(e,n,r){var i=t.call(this,e,n,mnt+"|"+r)||this;return i.boneIndex=0,i.boneIndex=r,i}return Ket(e,t),e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.bones[this.boneIndex];if(o.active)if(n<this.frames[0])switch(s){case K9.setup:return void(o.shearY=o.data.shearY);case K9.first:o.shearY+=(o.data.shearY-o.shearY)*i}else{var l=this.getCurveValue(n);switch(s){case K9.setup:o.shearY=o.data.shearY+l*i;break;case K9.first:case K9.replace:o.shearY+=(o.data.shearY+l-o.shearY)*i;break;case K9.add:o.shearY+=l*i}}},e}(Ant),znt=function(t){function e(e,n,r){var i=t.call(this,e,n,[gnt+"|"+r,ynt+"|"+r])||this;return i.slotIndex=0,i.slotIndex=r,i}return Ket(e,t),e.prototype.getFrameEntries=function(){return 5},e.prototype.setFrame=function(t,e,n,r,i,s){t*=5,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r,this.frames[t+3]=i,this.frames[t+4]=s},e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.slots[this.slotIndex];if(o.bone.active){var l=this.frames,h=o.color;if(n<l[0]){var u=o.data.color;switch(s){case K9.setup:return void h.setFromColor(u);case K9.first:h.add((u.r-h.r)*i,(u.g-h.g)*i,(u.b-h.b)*i,(u.a-h.a)*i)}}else{var c=0,d=0,p=0,f=0,m=Cnt.search(l,n,5),g=this.curves[m/5];switch(g){case 0:var y=l[m];c=l[m+1],d=l[m+2],p=l[m+3],f=l[m+4];var v=(n-y)/(l[m+5]-y);c+=(l[m+5+1]-c)*v,d+=(l[m+5+2]-d)*v,p+=(l[m+5+3]-p)*v,f+=(l[m+5+4]-f)*v;break;case 1:c=l[m+1],d=l[m+2],p=l[m+3],f=l[m+4];break;default:c=this.getBezierValue(n,m,1,g-2),d=this.getBezierValue(n,m,2,g+18-2),p=this.getBezierValue(n,m,3,g+36-2),f=this.getBezierValue(n,m,4,g+54-2)}1==i?h.set(c,d,p,f):(s==K9.setup&&h.setFromColor(o.data.color),h.add((c-h.r)*i,(d-h.g)*i,(p-h.b)*i,(f-h.a)*i))}}},e}(Nnt),Gnt=function(t){function e(e,n,r){var i=t.call(this,e,n,[gnt+"|"+r])||this;return i.slotIndex=0,i.slotIndex=r,i}return Ket(e,t),e.prototype.getFrameEntries=function(){return 4},e.prototype.setFrame=function(t,e,n,r,i){t<<=2,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r,this.frames[t+3]=i},e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.slots[this.slotIndex];if(o.bone.active){var l=this.frames,h=o.color;if(n<l[0]){var u=o.data.color;switch(s){case K9.setup:return h.r=u.r,h.g=u.g,void(h.b=u.b);case K9.first:h.r+=(u.r-h.r)*i,h.g+=(u.g-h.g)*i,h.b+=(u.b-h.b)*i}}else{var c=0,d=0,p=0,f=Cnt.search(l,n,4),m=this.curves[f>>2];switch(m){case 0:var g=l[f];c=l[f+1],d=l[f+2],p=l[f+3];var y=(n-g)/(l[f+4]-g);c+=(l[f+4+1]-c)*y,d+=(l[f+4+2]-d)*y,p+=(l[f+4+3]-p)*y;break;case 1:c=l[f+1],d=l[f+2],p=l[f+3];break;default:c=this.getBezierValue(n,f,1,m-2),d=this.getBezierValue(n,f,2,m+18-2),p=this.getBezierValue(n,f,3,m+36-2)}if(1==i)h.r=c,h.g=d,h.b=p;else{if(s==K9.setup){u=o.data.color;h.r=u.r,h.g=u.g,h.b=u.b}h.r+=(c-h.r)*i,h.g+=(d-h.g)*i,h.b+=(p-h.b)*i}}}},e}(Nnt),Wnt=function(t){function e(e,n,r){var i=t.call(this,e,n,ynt+"|"+r)||this;return i.slotIndex=0,i.slotIndex=r,i}return Ket(e,t),e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.slots[this.slotIndex];if(o.bone.active){var l=o.color;if(n<this.frames[0]){var h=o.data.color;switch(s){case K9.setup:return void(l.a=h.a);case K9.first:l.a+=(h.a-l.a)*i}}else{var u=this.getCurveValue(n);1==i?l.a=u:(s==K9.setup&&(l.a=o.data.color.a),l.a+=(u-l.a)*i)}}},e}(Ant),Xnt=function(t){function e(e,n,r){var i=t.call(this,e,n,[gnt+"|"+r,ynt+"|"+r,vnt+"|"+r])||this;return i.slotIndex=0,i.slotIndex=r,i}return Ket(e,t),e.prototype.getFrameEntries=function(){return 8},e.prototype.setFrame=function(t,e,n,r,i,s,a,o,l){t<<=3,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r,this.frames[t+3]=i,this.frames[t+4]=s,this.frames[t+5]=a,this.frames[t+6]=o,this.frames[t+7]=l},e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.slots[this.slotIndex];if(o.bone.active){var l=this.frames,h=o.color,u=o.darkColor;if(n<l[0]){var c=o.data.color,d=o.data.darkColor;switch(s){case K9.setup:return h.setFromColor(c),u.r=d.r,u.g=d.g,void(u.b=d.b);case K9.first:h.add((c.r-h.r)*i,(c.g-h.g)*i,(c.b-h.b)*i,(c.a-h.a)*i),u.r+=(d.r-u.r)*i,u.g+=(d.g-u.g)*i,u.b+=(d.b-u.b)*i}}else{var p=0,f=0,m=0,g=0,y=0,v=0,x=0,b=Cnt.search(l,n,8),w=this.curves[b>>3];switch(w){case 0:var _=l[b];p=l[b+1],f=l[b+2],m=l[b+3],g=l[b+4],y=l[b+5],v=l[b+6],x=l[b+7];var T=(n-_)/(l[b+8]-_);p+=(l[b+8+1]-p)*T,f+=(l[b+8+2]-f)*T,m+=(l[b+8+3]-m)*T,g+=(l[b+8+4]-g)*T,y+=(l[b+8+5]-y)*T,v+=(l[b+8+6]-v)*T,x+=(l[b+8+7]-x)*T;break;case 1:p=l[b+1],f=l[b+2],m=l[b+3],g=l[b+4],y=l[b+5],v=l[b+6],x=l[b+7];break;default:p=this.getBezierValue(n,b,1,w-2),f=this.getBezierValue(n,b,2,w+18-2),m=this.getBezierValue(n,b,3,w+36-2),g=this.getBezierValue(n,b,4,w+54-2),y=this.getBezierValue(n,b,5,w+72-2),v=this.getBezierValue(n,b,6,w+90-2),x=this.getBezierValue(n,b,7,w+108-2)}if(1==i)h.set(p,f,m,g),u.r=y,u.g=v,u.b=x;else{if(s==K9.setup){h.setFromColor(o.data.color);d=o.data.darkColor;u.r=d.r,u.g=d.g,u.b=d.b}h.add((p-h.r)*i,(f-h.g)*i,(m-h.b)*i,(g-h.a)*i),u.r+=(y-u.r)*i,u.g+=(v-u.g)*i,u.b+=(x-u.b)*i}}}},e}(Nnt),Hnt=function(t){function e(e,n,r){var i=t.call(this,e,n,[gnt+"|"+r,vnt+"|"+r])||this;return i.slotIndex=0,i.slotIndex=r,i}return Ket(e,t),e.prototype.getFrameEntries=function(){return 7},e.prototype.setFrame=function(t,e,n,r,i,s,a,o){t*=7,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r,this.frames[t+3]=i,this.frames[t+4]=s,this.frames[t+5]=a,this.frames[t+6]=o},e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.slots[this.slotIndex];if(o.bone.active){var l=this.frames,h=o.color,u=o.darkColor;if(n<l[0]){var c=o.data.color,d=o.data.darkColor;switch(s){case K9.setup:return h.r=c.r,h.g=c.g,h.b=c.b,u.r=d.r,u.g=d.g,void(u.b=d.b);case K9.first:h.r+=(c.r-h.r)*i,h.g+=(c.g-h.g)*i,h.b+=(c.b-h.b)*i,u.r+=(d.r-u.r)*i,u.g+=(d.g-u.g)*i,u.b+=(d.b-u.b)*i}}else{var p=0,f=0,m=0,g=0,y=0,v=0,x=Cnt.search(l,n,7),b=this.curves[x/7];switch(b){case 0:var w=l[x];p=l[x+1],f=l[x+2],m=l[x+3],g=l[x+4],y=l[x+5],v=l[x+6];var _=(n-w)/(l[x+7]-w);p+=(l[x+7+1]-p)*_,f+=(l[x+7+2]-f)*_,m+=(l[x+7+3]-m)*_,g+=(l[x+7+4]-g)*_,y+=(l[x+7+5]-y)*_,v+=(l[x+7+6]-v)*_;break;case 1:p=l[x+1],f=l[x+2],m=l[x+3],g=l[x+4],y=l[x+5],v=l[x+6];break;default:p=this.getBezierValue(n,x,1,b-2),f=this.getBezierValue(n,x,2,b+18-2),m=this.getBezierValue(n,x,3,b+36-2),g=this.getBezierValue(n,x,4,b+54-2),y=this.getBezierValue(n,x,5,b+72-2),v=this.getBezierValue(n,x,6,b+90-2)}if(1==i)h.r=p,h.g=f,h.b=m,u.r=g,u.g=y,u.b=v;else{if(s==K9.setup){c=o.data.color,d=o.data.darkColor;h.r=c.r,h.g=c.g,h.b=c.b,u.r=d.r,u.g=d.g,u.b=d.b}h.r+=(p-h.r)*i,h.g+=(f-h.g)*i,h.b+=(m-h.b)*i,u.r+=(g-u.r)*i,u.g+=(y-u.g)*i,u.b+=(v-u.b)*i}}}},e}(Nnt),Ynt=function(t){function e(e,n){var r=t.call(this,e,[xnt+"|"+n])||this;return r.slotIndex=0,r.slotIndex=n,r.attachmentNames=new Array(e),r}return Ket(e,t),e.prototype.getFrameCount=function(){return this.frames.length},e.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.attachmentNames[t]=n},e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.slots[this.slotIndex];o.bone.active&&(a!=Z9.mixOut?n<this.frames[0]?s!=K9.setup&&s!=K9.first||this.setAttachment(t,o,o.data.attachmentName):this.setAttachment(t,o,this.attachmentNames[Cnt.search1(this.frames,n)]):s==K9.setup&&this.setAttachment(t,o,o.data.attachmentName))},e.prototype.setAttachment=function(t,e,n){e.setAttachment(n?t.getAttachment(this.slotIndex,n):null)},e}(Cnt),jnt=function(t){function e(e,n,r,i){var s=t.call(this,e,n,[bnt+"|"+r+"|"+i.id])||this;return s.slotIndex=0,s.slotIndex=r,s.attachment=i,s.vertices=new Array(e),s}return Ket(e,t),e.prototype.getFrameCount=function(){return this.frames.length},e.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.vertices[t]=n},e.prototype.setBezier=function(t,e,n,r,i,s,a,o,l,h,u){var c=this.curves,d=this.getFrameCount()+18*t;0==n&&(c[e]=2+d);for(var p=.03*(r-2*s+o),f=.03*l-.06*a,m=.006*(3*(s-o)-r+h),g=.018*(a-l+.33333333),y=2*p+m,v=2*f+g,x=.3*(s-r)+p+.16666667*m,b=.3*a+f+.16666667*g,w=r+x,_=b,T=d+18;d<T;d+=2)c[d]=w,c[d+1]=_,x+=y,b+=v,y+=m,v+=g,w+=x,_+=b},e.prototype.getCurvePercent=function(t,e){var n=this.curves,r=n[e];switch(r){case 0:var i=this.frames[e];return(t-i)/(this.frames[e+this.getFrameEntries()]-i);case 1:return 0}if(n[r-=2]>t){var s=this.frames[e];return n[r+1]*(t-s)/(n[r]-s)}var a=r+18;for(r+=2;r<a;r+=2)if(n[r]>=t){var o=n[r-2],l=n[r-1];return l+(t-o)/(n[r]-o)*(n[r+1]-l)}var h=n[a-2],u=n[a-1];return u+(1-u)*(t-h)/(this.frames[e+this.getFrameEntries()]-h)},e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.slots[this.slotIndex];if(o.bone.active){var l=o.getAttachment();if(l instanceof Qet&&l.deformAttachment==this.attachment){var h=o.deform;0==h.length&&(s=K9.setup);var u=this.vertices,c=u[0].length,d=this.frames;if(n<d[0]){var p=l;switch(s){case K9.setup:return void(h.length=0);case K9.first:if(1==i)return void(h.length=0);if(h.length=c,p.bones){i=1-i;for(m=0;m<c;m++)h[m]*=i}else for(var f=p.vertices,m=0;m<c;m++)h[m]+=(f[m]-h[m])*i}}else if(h.length=c,n>=d[d.length-1]){var g=u[d.length-1];if(1==i)if(s==K9.add)if((p=l).bones)for(var y=0;y<c;y++)h[y]+=g[y];else{f=p.vertices;for(var v=0;v<c;v++)h[v]+=g[v]-f[v]}else w7.arrayCopy(g,0,h,0,c);else switch(s){case K9.setup:var x=l;if(x.bones)for(var b=0;b<c;b++)h[b]=g[b]*i;else{f=x.vertices;for(var w=0;w<c;w++){var _=f[w];h[w]=_+(g[w]-_)*i}}break;case K9.first:case K9.replace:for(var T=0;T<c;T++)h[T]+=(g[T]-h[T])*i;break;case K9.add:if((p=l).bones)for(var E=0;E<c;E++)h[E]+=g[E]*i;else{f=p.vertices;for(var S=0;S<c;S++)h[S]+=(g[S]-f[S])*i}}}else{var I=Cnt.search1(d,n),k=this.getCurvePercent(n,I),C=u[I],N=u[I+1];if(1==i)if(s==K9.add)if((p=l).bones)for(var A=0;A<c;A++){M=C[A];h[A]+=M+(N[A]-M)*k}else{f=p.vertices;for(var R=0;R<c;R++){var M=C[R];h[R]+=M+(N[R]-M)*k-f[R]}}else for(var O=0;O<c;O++){M=C[O];h[O]=M+(N[O]-M)*k}else switch(s){case K9.setup:var P=l;if(P.bones)for(var D=0;D<c;D++){M=C[D];h[D]=(M+(N[D]-M)*k)*i}else{f=P.vertices;for(var F=0;F<c;F++){var M=C[F];_=f[F];h[F]=_+(M+(N[F]-M)*k-_)*i}}break;case K9.first:case K9.replace:for(var L=0;L<c;L++){M=C[L];h[L]+=(M+(N[L]-M)*k-h[L])*i}break;case K9.add:if((p=l).bones)for(var B=0;B<c;B++){M=C[B];h[B]+=(M+(N[B]-M)*k)*i}else{f=p.vertices;for(var $=0;$<c;$++){M=C[$];h[$]+=(M+(N[$]-M)*k-f[$])*i}}}}}}},e}(Nnt),qnt=function(t){function e(n){var r=t.call(this,n,e.propertyIds)||this;return r.events=new Array(n),r}return Ket(e,t),e.prototype.getFrameCount=function(){return this.frames.length},e.prototype.setFrame=function(t,e){this.frames[t]=e.time,this.events[t]=e},e.prototype.apply=function(t,e,n,r,i,s,a){if(r){var o=this.frames,l=this.frames.length;if(e>n)this.apply(t,e,Number.MAX_VALUE,r,i,s,a),e=-1;else if(e>=o[l-1])return;if(!(n<o[0])){var h=0;if(e<o[0])h=0;else for(var u=o[h=Cnt.search1(o,e)+1];h>0&&o[h-1]==u;)h--;for(;h<l&&n>=o[h];h++)r.push(this.events[h])}}},e.propertyIds=[""+wnt],e}(Cnt),Knt=function(t){function e(n){var r=t.call(this,n,e.propertyIds)||this;return r.drawOrders=new Array(n),r}return Ket(e,t),e.prototype.getFrameCount=function(){return this.frames.length},e.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.drawOrders[t]=n},e.prototype.apply=function(t,e,n,r,i,s,a){if(a!=Z9.mixOut)if(n<this.frames[0])s!=K9.setup&&s!=K9.first||w7.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);else{var o=this.drawOrders[Cnt.search1(this.frames,n)];if(o)for(var l=t.drawOrder,h=t.slots,u=0,c=o.length;u<c;u++)l[u]=h[o[u]];else w7.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)}else s==K9.setup&&w7.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)},e.propertyIds=[""+_nt],e}(Cnt),Znt=function(t){function e(e,n,r){var i=t.call(this,e,n,[Tnt+"|"+r])||this;return i.ikConstraintIndex=r,i}return Ket(e,t),e.prototype.getFrameEntries=function(){return 6},e.prototype.setFrame=function(t,e,n,r,i,s,a){t*=6,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r,this.frames[t+3]=i,this.frames[t+4]=s?1:0,this.frames[t+5]=a?1:0},e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.ikConstraints[this.ikConstraintIndex];if(o.active){var l=this.frames;if(n<l[0])switch(s){case K9.setup:return o.mix=o.data.mix,o.softness=o.data.softness,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,void(o.stretch=o.data.stretch);case K9.first:o.mix+=(o.data.mix-o.mix)*i,o.softness+=(o.data.softness-o.softness)*i,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch}else{var h=0,u=0,c=Cnt.search(l,n,6),d=this.curves[c/6];switch(d){case 0:var p=l[c];h=l[c+1],u=l[c+2];var f=(n-p)/(l[c+6]-p);h+=(l[c+6+1]-h)*f,u+=(l[c+6+2]-u)*f;break;case 1:h=l[c+1],u=l[c+2];break;default:h=this.getBezierValue(n,c,1,d-2),u=this.getBezierValue(n,c,2,d+18-2)}s==K9.setup?(o.mix=o.data.mix+(h-o.data.mix)*i,o.softness=o.data.softness+(u-o.data.softness)*i,a==Z9.mixOut?(o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch):(o.bendDirection=l[c+3],o.compress=0!=l[c+4],o.stretch=0!=l[c+5])):(o.mix+=(h-o.mix)*i,o.softness+=(u-o.softness)*i,a==Z9.mixIn&&(o.bendDirection=l[c+3],o.compress=0!=l[c+4],o.stretch=0!=l[c+5]))}}},e}(Nnt),Jnt=function(t){function e(e,n,r){var i=t.call(this,e,n,[Ent+"|"+r])||this;return i.transformConstraintIndex=r,i}return Ket(e,t),e.prototype.getFrameEntries=function(){return 7},e.prototype.setFrame=function(t,e,n,r,i,s,a,o){var l=this.frames;l[t*=7]=e,l[t+1]=n,l[t+2]=r,l[t+3]=i,l[t+4]=s,l[t+5]=a,l[t+6]=o},e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.transformConstraints[this.transformConstraintIndex];if(o.active){var l=this.frames;if(n<l[0]){var h=o.data;switch(s){case K9.setup:return o.mixRotate=h.mixRotate,o.mixX=h.mixX,o.mixY=h.mixY,o.mixScaleX=h.mixScaleX,o.mixScaleY=h.mixScaleY,void(o.mixShearY=h.mixShearY);case K9.first:o.mixRotate+=(h.mixRotate-o.mixRotate)*i,o.mixX+=(h.mixX-o.mixX)*i,o.mixY+=(h.mixY-o.mixY)*i,o.mixScaleX+=(h.mixScaleX-o.mixScaleX)*i,o.mixScaleY+=(h.mixScaleY-o.mixScaleY)*i,o.mixShearY+=(h.mixShearY-o.mixShearY)*i}}else{var u,c,d,p,f,m,g=Cnt.search(l,n,7),y=this.curves[g/7];switch(y){case 0:var v=l[g];u=l[g+1],c=l[g+2],d=l[g+3],p=l[g+4],f=l[g+5],m=l[g+6];var x=(n-v)/(l[g+7]-v);u+=(l[g+7+1]-u)*x,c+=(l[g+7+2]-c)*x,d+=(l[g+7+3]-d)*x,p+=(l[g+7+4]-p)*x,f+=(l[g+7+5]-f)*x,m+=(l[g+7+6]-m)*x;break;case 1:u=l[g+1],c=l[g+2],d=l[g+3],p=l[g+4],f=l[g+5],m=l[g+6];break;default:u=this.getBezierValue(n,g,1,y-2),c=this.getBezierValue(n,g,2,y+18-2),d=this.getBezierValue(n,g,3,y+36-2),p=this.getBezierValue(n,g,4,y+54-2),f=this.getBezierValue(n,g,5,y+72-2),m=this.getBezierValue(n,g,6,y+90-2)}if(s==K9.setup){h=o.data;o.mixRotate=h.mixRotate+(u-h.mixRotate)*i,o.mixX=h.mixX+(c-h.mixX)*i,o.mixY=h.mixY+(d-h.mixY)*i,o.mixScaleX=h.mixScaleX+(p-h.mixScaleX)*i,o.mixScaleY=h.mixScaleY+(f-h.mixScaleY)*i,o.mixShearY=h.mixShearY+(m-h.mixShearY)*i}else o.mixRotate+=(u-o.mixRotate)*i,o.mixX+=(c-o.mixX)*i,o.mixY+=(d-o.mixY)*i,o.mixScaleX+=(p-o.mixScaleX)*i,o.mixScaleY+=(f-o.mixScaleY)*i,o.mixShearY+=(m-o.mixShearY)*i}}},e}(Nnt),Qnt=function(t){function e(e,n,r){var i=t.call(this,e,n,Snt+"|"+r)||this;return i.pathConstraintIndex=r,i}return Ket(e,t),e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.pathConstraints[this.pathConstraintIndex];if(o.active)if(n<this.frames[0])switch(s){case K9.setup:return void(o.position=o.data.position);case K9.first:o.position+=(o.data.position-o.position)*i}else{var l=this.getCurveValue(n);s==K9.setup?o.position=o.data.position+(l-o.data.position)*i:o.position+=(l-o.position)*i}},e}(Ant),trt=function(t){function e(e,n,r){var i=t.call(this,e,n,Int+"|"+r)||this;return i.pathConstraintIndex=0,i.pathConstraintIndex=r,i}return Ket(e,t),e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.pathConstraints[this.pathConstraintIndex];if(o.active)if(n<this.frames[0])switch(s){case K9.setup:return void(o.spacing=o.data.spacing);case K9.first:o.spacing+=(o.data.spacing-o.spacing)*i}else{var l=this.getCurveValue(n);s==K9.setup?o.spacing=o.data.spacing+(l-o.data.spacing)*i:o.spacing+=(l-o.spacing)*i}},e}(Ant),ert=function(t){function e(e,n,r){var i=t.call(this,e,n,[knt+"|"+r])||this;return i.pathConstraintIndex=0,i.pathConstraintIndex=r,i}return Ket(e,t),e.prototype.getFrameEntries=function(){return 4},e.prototype.setFrame=function(t,e,n,r,i){var s=this.frames;s[t<<=2]=e,s[t+1]=n,s[t+2]=r,s[t+3]=i},e.prototype.apply=function(t,e,n,r,i,s,a){var o=t.pathConstraints[this.pathConstraintIndex];if(o.active){var l=this.frames;if(n<l[0])switch(s){case K9.setup:return o.mixRotate=o.data.mixRotate,o.mixX=o.data.mixX,void(o.mixY=o.data.mixY);case K9.first:o.mixRotate+=(o.data.mixRotate-o.mixRotate)*i,o.mixX+=(o.data.mixX-o.mixX)*i,o.mixY+=(o.data.mixY-o.mixY)*i}else{var h,u,c,d=Cnt.search(l,n,4),p=this.curves[d>>2];switch(p){case 0:var f=l[d];h=l[d+1],u=l[d+2],c=l[d+3];var m=(n-f)/(l[d+4]-f);h+=(l[d+4+1]-h)*m,u+=(l[d+4+2]-u)*m,c+=(l[d+4+3]-c)*m;break;case 1:h=l[d+1],u=l[d+2],c=l[d+3];break;default:h=this.getBezierValue(n,d,1,p-2),u=this.getBezierValue(n,d,2,p+18-2),c=this.getBezierValue(n,d,3,p+36-2)}if(s==K9.setup){var g=o.data;o.mixRotate=g.mixRotate+(h-g.mixRotate)*i,o.mixX=g.mixX+(u-g.mixX)*i,o.mixY=g.mixY+(c-g.mixY)*i}else o.mixRotate+=(h-o.mixRotate)*i,o.mixX+=(u-o.mixX)*i,o.mixY+=(c-o.mixY)*i}}},e}(Nnt),nrt=function(){function t(t){this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new irt(this),this.propertyIDs=new g7,this.animationsChanged=!1,this.trackEntryPool=new _7((function(){return new rrt})),this.data=t}return t.emptyAnimation=function(){return frt||(frt=new lnt("<empty>",[],0)),frt},t.prototype.update=function(t){t*=this.timeScale;for(var e=this.tracks,n=0,r=e.length;n<r;n++){var i=e[n];if(i){i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast;var s=t*i.timeScale;if(i.delay>0){if(i.delay-=s,i.delay>0)continue;s=-i.delay,i.delay=0}var a=i.next;if(a){var o=i.trackLast-a.delay;if(o>=0){for(a.delay=0,a.trackTime+=0==i.timeScale?0:(o/i.timeScale+t)*a.timeScale,i.trackTime+=s,this.setCurrent(n,a,!0);a.mixingFrom;)a.mixTime+=t,a=a.mixingFrom;continue}}else if(i.trackLast>=i.trackEnd&&!i.mixingFrom){e[n]=null,this.queue.end(i),this.clearNext(i);continue}if(i.mixingFrom&&this.updateMixingFrom(i,t)){var l=i.mixingFrom;for(i.mixingFrom=null,l&&(l.mixingTo=null);l;)this.queue.end(l),l=l.mixingFrom}i.trackTime+=s}}this.queue.drain()},t.prototype.updateMixingFrom=function(t,e){var n=t.mixingFrom;if(!n)return!0;var r=this.updateMixingFrom(n,e);return n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=n.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=n.mixingFrom,n.mixingFrom&&(n.mixingFrom.mixingTo=t),t.interruptAlpha=n.interruptAlpha,this.queue.end(n)),r):(n.trackTime+=e*n.timeScale,t.mixTime+=e,!1)},t.prototype.apply=function(t){if(!t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var e=this.events,n=this.tracks,r=!1,i=0,s=n.length;i<s;i++){var a=n[i];if(a&&!(a.delay>0)){r=!0;var o=0==i?K9.first:a.mixBlend,l=a.alpha;a.mixingFrom?l*=this.applyMixingFrom(a,t,o):a.trackTime>=a.trackEnd&&!a.next&&(l=0);var h=a.animationLast,u=a.getAnimationTime(),c=u,d=e;a.reverse&&(c=a.animation.duration-c,d=null);var p=a.animation.timelines,f=p.length;if(0==i&&1==l||o==K9.add)for(var m=0;m<f;m++){w7.webkit602BugfixHelper(l,o);var g=p[m];g instanceof Ynt?this.applyAttachmentTimeline(g,t,c,o,!0):g.apply(t,h,c,d,l,o,Z9.mixIn)}else{var y=a.timelineMode,v=a.timelinesRotation.length!=f<<1;v&&(a.timelinesRotation.length=f<<1);for(m=0;m<f;m++){var x=p[m],b=y[m]==ort?o:K9.setup;x instanceof Mnt?this.applyRotateTimeline(x,t,c,l,b,a.timelinesRotation,m<<1,v):x instanceof Ynt?this.applyAttachmentTimeline(x,t,c,o,!0):(w7.webkit602BugfixHelper(l,o),x.apply(t,h,c,d,l,b,Z9.mixIn))}}this.queueEvents(a,u),e.length=0,a.nextAnimationLast=u,a.nextTrackLast=a.trackTime}}for(var w=this.unkeyedState+drt,_=t.slots,T=0,E=t.slots.length;T<E;T++){var S=_[T];if(S.attachmentState==w){var I=S.data.attachmentName;S.setAttachment(I?t.getAttachment(S.data.index,I):null)}}return this.unkeyedState+=2,this.queue.drain(),r},t.prototype.applyMixingFrom=function(t,e,n){var r=t.mixingFrom;r.mixingFrom&&this.applyMixingFrom(r,e,n);var i=0;0==t.mixDuration?(i=1,n==K9.first&&(n=K9.setup)):((i=t.mixTime/t.mixDuration)>1&&(i=1),n!=K9.first&&(n=r.mixBlend));var s=i<r.attachmentThreshold,a=i<r.drawOrderThreshold,o=r.animation.timelines,l=o.length,h=r.alpha*t.interruptAlpha,u=h*(1-i),c=r.animationLast,d=r.getAnimationTime(),p=d,f=null;if(r.reverse?p=r.animation.duration-p:i<r.eventThreshold&&(f=this.events),n==K9.add)for(var m=0;m<l;m++)o[m].apply(e,c,p,f,u,n,Z9.mixOut);else{var g=r.timelineMode,y=r.timelineHoldMix,v=r.timelinesRotation.length!=l<<1;v&&(r.timelinesRotation.length=l<<1),r.totalAlpha=0;for(m=0;m<l;m++){var x=o[m],b=Z9.mixOut,w=void 0,_=0;switch(g[m]){case ort:if(!a&&x instanceof Knt)continue;w=n,_=u;break;case lrt:w=K9.setup,_=u;break;case hrt:w=n,_=h;break;case urt:w=K9.setup,_=h;break;default:w=K9.setup;var T=y[m];_=h*Math.max(0,1-T.mixTime/T.mixDuration)}r.totalAlpha+=_,x instanceof Mnt?this.applyRotateTimeline(x,e,p,_,w,r.timelinesRotation,m<<1,v):x instanceof Ynt?this.applyAttachmentTimeline(x,e,p,w,s):(w7.webkit602BugfixHelper(_,n),a&&x instanceof Knt&&w==K9.setup&&(b=Z9.mixIn),x.apply(e,c,p,f,_,w,b))}}return t.mixDuration>0&&this.queueEvents(r,d),this.events.length=0,r.nextAnimationLast=d,r.nextTrackLast=r.trackTime,i},t.prototype.applyAttachmentTimeline=function(t,e,n,r,i){var s=e.slots[t.slotIndex];s.bone.active&&(n<t.frames[0]?r!=K9.setup&&r!=K9.first||this.setAttachment(e,s,s.data.attachmentName,i):this.setAttachment(e,s,t.attachmentNames[Cnt.search1(t.frames,n)],i),s.attachmentState<=this.unkeyedState&&(s.attachmentState=this.unkeyedState+drt))},t.prototype.setAttachment=function(t,e,n,r){e.setAttachment(n?t.getAttachment(e.data.index,n):null),r&&(e.attachmentState=this.unkeyedState+prt)},t.prototype.applyRotateTimeline=function(t,e,n,r,i,s,a,o){if(o&&(s[a]=0),1!=r){var l=e.bones[t.boneIndex];if(l.active){var h=0,u=0;if(n<t.frames[0])switch(i){case K9.setup:l.rotation=l.data.rotation;default:return;case K9.first:h=l.rotation,u=l.data.rotation}else h=i==K9.setup?l.data.rotation:l.rotation,u=l.data.rotation+t.getCurveValue(n);var c=0,d=u-h;if(0==(d-=360*(16384-(16384.499999999996-d/360|0))))c=s[a];else{var p=0,f=0;o?(p=0,f=d):(p=s[a],f=s[a+1]);var m=d>0,g=p>=0;v7.signum(f)!=v7.signum(d)&&Math.abs(f)<=90&&(Math.abs(p)>180&&(p+=360*v7.signum(p)),g=m),c=d+p-p%360,g!=m&&(c+=360*v7.signum(p)),s[a]=c}s[a+1]=d,l.rotation=h+c*r}}else t.apply(e,0,n,null,1,i,Z9.mixIn)},t.prototype.queueEvents=function(t,e){for(var n=t.animationStart,r=t.animationEnd,i=r-n,s=t.trackLast%i,a=this.events,o=0,l=a.length;o<l;o++){var h=a[o];if(h.time<s)break;h.time>r||this.queue.event(t,h)}for((t.loop?0==i||s>t.trackTime%i:e>=r&&t.animationLast<r)&&this.queue.complete(t);o<l;o++){var u=a[o];u.time<n||this.queue.event(t,u)}},t.prototype.clearTracks=function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,n=this.tracks.length;e<n;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()},t.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(e){this.queue.end(e),this.clearNext(e);for(var n=e;;){var r=n.mixingFrom;if(!r)break;this.queue.end(r),n.mixingFrom=null,n.mixingTo=null,n=r}this.tracks[e.trackIndex]=null,this.queue.drain()}}},t.prototype.setCurrent=function(t,e,n){var r=this.expandToIndex(t);this.tracks[t]=e,e.previous=null,r&&(n&&this.queue.interrupt(r),e.mixingFrom=r,r.mixingTo=e,e.mixTime=0,r.mixingFrom&&r.mixDuration>0&&(e.interruptAlpha*=Math.min(1,r.mixTime/r.mixDuration)),r.timelinesRotation.length=0),this.queue.start(e)},t.prototype.setAnimation=function(t,e,n){void 0===n&&(n=!1);var r=this.data.skeletonData.findAnimation(e);if(!r)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,r,n)},t.prototype.setAnimationWith=function(t,e,n){if(void 0===n&&(n=!1),!e)throw new Error("animation cannot be null.");var r=!0,i=this.expandToIndex(t);i&&(-1==i.nextTrackLast?(this.tracks[t]=i.mixingFrom,this.queue.interrupt(i),this.queue.end(i),this.clearNext(i),i=i.mixingFrom,r=!1):this.clearNext(i));var s=this.trackEntry(t,e,n,i);return this.setCurrent(t,s,r),this.queue.drain(),s},t.prototype.addAnimation=function(t,e,n,r){void 0===n&&(n=!1),void 0===r&&(r=0);var i=this.data.skeletonData.findAnimation(e);if(!i)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,i,n,r)},t.prototype.addAnimationWith=function(t,e,n,r){if(void 0===n&&(n=!1),void 0===r&&(r=0),!e)throw new Error("animation cannot be null.");var i=this.expandToIndex(t);if(i)for(;i.next;)i=i.next;var s=this.trackEntry(t,e,n,i);return i?(i.next=s,s.previous=i,r<=0&&(r+=i.getTrackComplete()-s.mixDuration)):(this.setCurrent(t,s,!0),this.queue.drain()),s.delay=r,s},t.prototype.setEmptyAnimation=function(e,n){void 0===n&&(n=0);var r=this.setAnimationWith(e,t.emptyAnimation(),!1);return r.mixDuration=n,r.trackEnd=n,r},t.prototype.addEmptyAnimation=function(e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=this.addAnimationWith(e,t.emptyAnimation(),!1,r);return r<=0&&(i.delay+=i.mixDuration-n),i.mixDuration=n,i.trackEnd=n,i},t.prototype.setEmptyAnimations=function(t){void 0===t&&(t=0);var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var n=0,r=this.tracks.length;n<r;n++){var i=this.tracks[n];i&&this.setEmptyAnimation(i.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()},t.prototype.expandToIndex=function(t){return t<this.tracks.length?this.tracks[t]:(w7.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)},t.prototype.trackEntry=function(t,e,n,r){var i=this.trackEntryPool.obtain();return i.trackIndex=t,i.animation=e,i.loop=n,i.holdPrevious=!1,i.eventThreshold=0,i.attachmentThreshold=0,i.drawOrderThreshold=0,i.animationStart=0,i.animationEnd=e.duration,i.animationLast=-1,i.nextAnimationLast=-1,i.delay=0,i.trackTime=0,i.trackLast=-1,i.nextTrackLast=-1,i.trackEnd=Number.MAX_VALUE,i.timeScale=1,i.alpha=1,i.interruptAlpha=1,i.mixTime=0,i.mixDuration=r?this.data.getMix(r.animation,e):0,i.mixBlend=K9.replace,i},t.prototype.clearNext=function(t){for(var e=t.next;e;)this.queue.dispose(e),e=e.next;t.next=null},t.prototype._animationsChanged=function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var t=this.tracks,e=0,n=t.length;e<n;e++){var r=t[e];if(r){for(;r.mixingFrom;)r=r.mixingFrom;do{r.mixingTo&&r.mixBlend==K9.add||this.computeHold(r),r=r.mixingTo}while(r)}}},t.prototype.computeHold=function(t){var e=t.mixingTo,n=t.animation.timelines,r=t.animation.timelines.length,i=t.timelineMode;i.length=r;var s=t.timelineHoldMix;s.length=0;var a=this.propertyIDs;if(e&&e.holdPrevious)for(var o=0;o<r;o++)i[o]=a.addAll(n[o].getPropertyIds())?urt:hrt;else t:for(o=0;o<r;o++){var l=n[o],h=l.getPropertyIds();if(a.addAll(h))if(!e||l instanceof Ynt||l instanceof Knt||l instanceof qnt||!e.animation.hasTimeline(h))i[o]=lrt;else{for(var u=e.mixingTo;u;u=u.mixingTo)if(!u.animation.hasTimeline(h)){if(t.mixDuration>0){i[o]=crt,s[o]=u;continue t}break}i[o]=urt}else i[o]=ort}},t.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},t.prototype.addListener=function(t){if(!t)throw new Error("listener cannot be null.");this.listeners.push(t)},t.prototype.removeListener=function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)},t.prototype.clearListeners=function(){this.listeners.length=0},t.prototype.clearListenerNotifications=function(){this.queue.clear()},t.prototype.setAnimationByName=function(e,n,r){t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.setAnimation(e,n,r)},t.prototype.addAnimationByName=function(e,n,r,i){t.deprecatedWarning2||(t.deprecatedWarning2=!0),this.addAnimation(e,n,r,i)},t.prototype.hasAnimation=function(t){return null!==this.data.skeletonData.findAnimation(t)},t.prototype.hasAnimationByName=function(e){return t.deprecatedWarning3||(t.deprecatedWarning3=!0),this.hasAnimation(e)},t.deprecatedWarning1=!1,t.deprecatedWarning2=!1,t.deprecatedWarning3=!1,t}(),rrt=function(){function t(){this.mixBlend=K9.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}return t.prototype.reset=function(){this.previous=null,this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0},t.prototype.getAnimationTime=function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)},t.prototype.setAnimationLast=function(t){this.animationLast=t,this.nextAnimationLast=t},t.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},t.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0},t.prototype.getTrackComplete=function(){var t=this.animationEnd-this.animationStart;if(0!=t){if(this.loop)return t*(1+(this.trackTime/t|0));if(this.trackTime<t)return t}return this.trackTime},Object.defineProperty(t.prototype,"time",{get:function(){return t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.trackTime},set:function(e){t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.trackTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endTime",{get:function(){return t.deprecatedWarning2||(t.deprecatedWarning2=!0),this.trackTime},set:function(e){t.deprecatedWarning2||(t.deprecatedWarning2=!0),this.trackTime=e},enumerable:!1,configurable:!0}),t.prototype.loopsCount=function(){return Math.floor(this.trackTime/this.trackEnd)},t.deprecatedWarning1=!1,t.deprecatedWarning2=!1,t}(),irt=function(){function t(t){this.objects=[],this.drainDisabled=!1,this.animState=t}return t.prototype.start=function(t){this.objects.push(Zet.start),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.interrupt=function(t){this.objects.push(Zet.interrupt),this.objects.push(t)},t.prototype.end=function(t){this.objects.push(Zet.end),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.dispose=function(t){this.objects.push(Zet.dispose),this.objects.push(t)},t.prototype.complete=function(t){this.objects.push(Zet.complete),this.objects.push(t)},t.prototype.event=function(t,e){this.objects.push(Zet.event),this.objects.push(t),this.objects.push(e)},t.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,n=0;n<t.length;n+=2){var r=t[n],i=t[n+1];switch(r){case Zet.start:null!=i.listener&&i.listener.start&&i.listener.start(i);for(var s=0;s<e.length;s++)e[s].start&&e[s].start(i);break;case Zet.interrupt:null!=i.listener&&i.listener.interrupt&&i.listener.interrupt(i);for(s=0;s<e.length;s++)e[s].interrupt&&e[s].interrupt(i);break;case Zet.end:null!=i.listener&&i.listener.end&&i.listener.end(i);for(s=0;s<e.length;s++)e[s].end&&e[s].end(i);case Zet.dispose:null!=i.listener&&i.listener.dispose&&i.listener.dispose(i);for(s=0;s<e.length;s++)e[s].dispose&&e[s].dispose(i);this.animState.trackEntryPool.free(i);break;case Zet.complete:null!=i.listener&&i.listener.complete&&i.listener.complete(i);for(s=0;s<e.length;s++)e[s].complete&&e[s].complete(i);break;case Zet.event:var a=t[2+n++];null!=i.listener&&i.listener.event&&i.listener.event(i,a);for(s=0;s<e.length;s++)e[s].event&&e[s].event(i,a)}}this.clear(),this.drainDisabled=!1}},t.prototype.clear=function(){this.objects.length=0},t}();!function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(Zet||(Zet={}));var srt,art=function(){function t(){}return t.prototype.start=function(t){},t.prototype.interrupt=function(t){},t.prototype.end=function(t){},t.prototype.dispose=function(t){},t.prototype.complete=function(t){},t.prototype.event=function(t,e){},t}(),ort=0,lrt=1,hrt=2,urt=3,crt=4,drt=1,prt=2,frt=null,mrt=function(){function t(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}return t.prototype.setMix=function(t,e,n){var r=this.skeletonData.findAnimation(t);if(null==r)throw new Error("Animation not found: "+t);var i=this.skeletonData.findAnimation(e);if(null==i)throw new Error("Animation not found: "+e);this.setMixWith(r,i,n)},t.prototype.setMixWith=function(t,e,n){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");var r=t.name+"."+e.name;this.animationToMixTime[r]=n},t.prototype.getMix=function(t,e){var n=t.name+"."+e.name,r=this.animationToMixTime[n];return void 0===r?this.defaultMix:r},t}(),grt=function(){function t(t){this.atlas=t}return t.prototype.newRegionAttachment=function(t,e,n){var r=this.atlas.findRegion(n);if(null==r)throw new Error("Region not found in atlas: "+n+" (region attachment: "+e+")");var i=new snt(e);return i.region=r,i},t.prototype.newMeshAttachment=function(t,e,n){var r=this.atlas.findRegion(n);if(null==r)throw new Error("Region not found in atlas: "+n+" (mesh attachment: "+e+")");var i=new nnt(e);return i.region=r,i},t.prototype.newBoundingBoxAttachment=function(t,e){return new tnt(e)},t.prototype.newPathAttachment=function(t,e){return new rnt(e)},t.prototype.newPointAttachment=function(t,e){return new int(e)},t.prototype.newClippingAttachment=function(t,e){return new ent(e)},t}(),yrt=function(){function t(t,e,n){if(this.matrix=new In,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.sorted=!1,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=n,this.setToSetupPose()}return Object.defineProperty(t.prototype,"worldX",{get:function(){return this.matrix.tx},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldY",{get:function(){return this.matrix.ty},enumerable:!1,configurable:!0}),t.prototype.isActive=function(){return this.active},t.prototype.update=function(){this.updateWorldTransformWith(this.ax,this.ay,this.arotation,this.ascaleX,this.ascaleY,this.ashearX,this.ashearY)},t.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},t.prototype.updateWorldTransformWith=function(t,e,n,r,i,s,a){this.ax=t,this.ay=e,this.arotation=n,this.ascaleX=r,this.ascaleY=i,this.ashearX=s,this.ashearY=a;var o=this.parent,l=this.matrix,h=this.skeleton.scaleX,u=E7?-this.skeleton.scaleY:this.skeleton.scaleY;if(!o){var c=this.skeleton,d=n+90+a;return l.a=v7.cosDeg(n+s)*r*h,l.c=v7.cosDeg(d)*i*h,l.b=v7.sinDeg(n+s)*r*u,l.d=v7.sinDeg(d)*i*u,l.tx=t*h+c.x,void(l.ty=e*u+c.y)}var p=o.matrix.a,f=o.matrix.c,m=o.matrix.b,g=o.matrix.d;switch(l.tx=p*t+f*e+o.matrix.tx,l.ty=m*t+g*e+o.matrix.ty,this.data.transformMode){case t7.Normal:d=n+90+a;var y=v7.cosDeg(n+s)*r,v=v7.cosDeg(d)*i,x=v7.sinDeg(n+s)*r,b=v7.sinDeg(d)*i;return l.a=p*y+f*x,l.c=p*v+f*b,l.b=m*y+g*x,void(l.d=m*v+g*b);case t7.OnlyTranslation:d=n+90+a;l.a=v7.cosDeg(n+s)*r,l.c=v7.cosDeg(d)*i,l.b=v7.sinDeg(n+s)*r,l.d=v7.sinDeg(d)*i;break;case t7.NoRotationOrReflection:var w=0;(E=p*p+m*m)>1e-4?(E=Math.abs(p*g-f*m)/E,p/=this.skeleton.scaleX,f=(m/=this.skeleton.scaleY)*E,g=p*E,w=Math.atan2(m,p)*v7.radDeg):(p=0,m=0,w=90-Math.atan2(g,f)*v7.radDeg);var _=n+s-w,T=n+a-w+90;y=v7.cosDeg(_)*r,v=v7.cosDeg(T)*i,x=v7.sinDeg(_)*r,b=v7.sinDeg(T)*i;l.a=p*y-f*x,l.c=p*v-f*b,l.b=m*y+g*x,l.d=m*v+g*b;break;case t7.NoScale:case t7.NoScaleOrReflection:var E,S=v7.cosDeg(n),I=v7.sinDeg(n),k=(p*S+f*I)/h,C=(m*S+g*I)/u;(E=Math.sqrt(k*k+C*C))>1e-5&&(E=1/E),k*=E,C*=E,E=Math.sqrt(k*k+C*C),this.data.transformMode==t7.NoScale&&p*g-f*m<0!=(E7?this.skeleton.scaleX<0!=this.skeleton.scaleY>0:this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(E=-E);var N=Math.PI/2+Math.atan2(C,k),A=Math.cos(N)*E,R=Math.sin(N)*E;y=v7.cosDeg(s)*r,v=v7.cosDeg(90+a)*i,x=v7.sinDeg(s)*r,b=v7.sinDeg(90+a)*i;l.a=k*y+A*x,l.c=k*v+A*b,l.b=C*y+R*x,l.d=C*v+R*b}l.a*=h,l.c*=h,l.b*=u,l.d*=u},t.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY},t.prototype.getWorldRotationX=function(){return Math.atan2(this.matrix.b,this.matrix.a)*v7.radDeg},t.prototype.getWorldRotationY=function(){return Math.atan2(this.matrix.d,this.matrix.c)*v7.radDeg},t.prototype.getWorldScaleX=function(){var t=this.matrix;return Math.sqrt(t.a*t.a+t.b*t.b)},t.prototype.getWorldScaleY=function(){var t=this.matrix;return Math.sqrt(t.c*t.c+t.d*t.d)},t.prototype.updateAppliedTransform=function(){var t=this.parent,e=this.matrix;if(!t)return this.ax=e.tx,this.ay=e.ty,this.arotation=Math.atan2(e.b,e.a)*v7.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*v7.radDeg);var n=t.matrix,r=1/(n.a*n.d-n.b*n.c),i=e.tx-n.tx,s=e.ty-n.ty;this.ax=i*n.d*r-s*n.c*r,this.ay=s*n.a*r-i*n.b*r;var a=r*n.d,o=r*n.a,l=r*n.c,h=r*n.b,u=a*e.a-l*e.b,c=a*e.c-l*e.d,d=o*e.b-h*e.a,p=o*e.d-h*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(u*u+d*d),this.ascaleX>1e-4){var f=u*p-c*d;this.ascaleY=f/this.ascaleX,this.ashearY=Math.atan2(u*c+d*p,f)*v7.radDeg,this.arotation=Math.atan2(d,u)*v7.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(c*c+p*p),this.ashearY=0,this.arotation=90-Math.atan2(p,c)*v7.radDeg},t.prototype.worldToLocal=function(t){var e=this.matrix,n=e.a,r=e.c,i=e.b,s=e.d,a=1/(n*s-r*i),o=t.x-e.tx,l=t.y-e.ty;return t.x=o*s*a-l*r*a,t.y=l*n*a-o*i*a,t},t.prototype.localToWorld=function(t){var e=this.matrix,n=t.x,r=t.y;return t.x=n*e.a+r*e.c+e.tx,t.y=n*e.b+r*e.d+e.ty,t},t.prototype.worldToLocalRotation=function(t){var e=v7.sinDeg(t),n=v7.cosDeg(t),r=this.matrix;return Math.atan2(r.a*e-r.b*n,r.d*n-r.c*e)*v7.radDeg},t.prototype.localToWorldRotation=function(t){t-=this.rotation-this.shearX;var e=v7.sinDeg(t),n=v7.cosDeg(t),r=this.matrix;return Math.atan2(n*r.b+e*r.d,n*r.a+e*r.c)*v7.radDeg},t.prototype.rotateWorld=function(t){var e=this.matrix,n=e.a,r=e.c,i=e.b,s=e.d,a=v7.cosDeg(t),o=v7.sinDeg(t);e.a=a*n-o*i,e.c=a*r-o*s,e.b=o*n+a*i,e.d=o*r+a*s},t}(),vrt=function(t,e,n){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=t7.Normal,this.skinRequired=!1,this.color=new y7,t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=n},xrt=function(t,e,n){this.name=t,this.order=e,this.skinRequired=n},brt=function(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e},wrt=function(t){this.name=t},_rt=function(){function t(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(var n=0;n<t.bones.length;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)}return t.prototype.isActive=function(){return this.active},t.prototype.update=function(){if(0!=this.mix){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.data.uniform,this.softness,this.mix)}}},t.prototype.apply1=function(t,e,n,r,i,s,a){var o=t.parent.matrix,l=o.a,h=o.c,u=o.b,c=o.d,d=-t.ashearX-t.arotation,p=0,f=0;switch(t.data.transformMode){case t7.OnlyTranslation:p=e-t.worldX,f=n-t.worldY;break;case t7.NoRotationOrReflection:var m=Math.abs(l*c-h*u)/(l*l+u*u),g=l/t.skeleton.scaleX,y=u/t.skeleton.scaleY;h=-y*m*t.skeleton.scaleX,c=g*m*t.skeleton.scaleY,d+=Math.atan2(y,g)*v7.radDeg;default:var v=e-o.tx,x=n-o.ty,b=l*c-h*u;p=(v*c-x*h)/b-t.ax,f=(x*l-v*u)/b-t.ay}d+=Math.atan2(f,p)*v7.radDeg,t.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);var w=t.ascaleX,_=t.ascaleY;if(r||i){switch(t.data.transformMode){case t7.NoScale:case t7.NoScaleOrReflection:p=e-t.worldX,f=n-t.worldY}var T=t.data.length*w,E=Math.sqrt(p*p+f*f);if(r&&E<T||i&&E>T&&T>1e-4)w*=m=(E/T-1)*a+1,s&&(_*=m)}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+d*a,w,_,t.ashearX,t.ashearY)},t.prototype.apply2=function(t,e,n,r,i,s,a,o,l){var h=t.ax,u=t.ay,c=t.ascaleX,d=t.ascaleY,p=c,f=d,m=e.ascaleX,g=t.matrix,y=0,v=0,x=0;c<0?(c=-c,y=180,x=-1):(y=0,x=1),d<0&&(d=-d,x=-x),m<0?(m=-m,v=180):v=0;var b=e.ax,w=0,_=0,T=0,E=g.a,S=g.c,I=g.b,k=g.d,C=Math.abs(c-d)<=1e-4;!C||s?(w=0,_=E*b+g.tx,T=I*b+g.ty):(_=E*b+S*(w=e.ay)+g.tx,T=I*b+k*w+g.ty);var N=t.parent.matrix;E=N.a,S=N.c,I=N.b;var A,R,M=1/(E*(k=N.d)-S*I),O=_-N.tx,P=T-N.ty,D=(O*k-P*S)*M-h,F=(P*E-O*I)*M-u,L=Math.sqrt(D*D+F*F),B=e.data.length*m;if(L<1e-4)return this.apply1(t,n,r,!1,s,!1,l),void e.updateWorldTransformWith(b,w,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);var $=((O=n-N.tx)*k-(P=r-N.ty)*S)*M-h,U=(P*E-O*I)*M-u,V=$*$+U*U;if(0!=o){o*=c*(m+1)*.5;var z=Math.sqrt(V),G=z-L-B*c+o;if(G>0){var W=Math.min(1,G/(2*o))-1;V=($-=(W=(G-o*(1-W*W))/z)*$)*$+(U-=W*U)*U}}t:if(C){var X=(V-L*L-(B*=c)*B)/(2*L*B);X<-1?(X=-1,R=Math.PI*i):X>1?(X=1,R=0,s&&(p*=E=(Math.sqrt(V)/(L+B)-1)*l+1,a&&(f*=E))):R=Math.acos(X)*i,E=L+B*X,S=B*Math.sin(R),A=Math.atan2(U*E-$*S,$*E+U*S)}else{var H=(E=c*B)*E,Y=(S=d*B)*S,j=Math.atan2(U,$),q=-2*Y*L,K=Y-H;if((k=q*q-4*K*(I=Y*L*L+H*V-H*Y))>=0){var Z=Math.sqrt(k);q<0&&(Z=-Z);var J=(Z=.5*-(q+Z))/K,Q=I/Z,tt=Math.abs(J)<Math.abs(Q)?J:Q;if(tt*tt<=V){P=Math.sqrt(V-tt*tt)*i,A=j-Math.atan2(P,tt),R=Math.atan2(P/d,(tt-L)/c);break t}}var et=v7.PI,nt=L-E,rt=nt*nt,it=0,st=0,at=L+E,ot=at*at,lt=0;(I=-E*L/(H-Y))>=-1&&I<=1&&(I=Math.acos(I),(k=(O=E*Math.cos(I)+L)*O+(P=S*Math.sin(I))*P)<rt&&(et=I,rt=k,nt=O,it=P),k>ot&&(st=I,ot=k,at=O,lt=P)),V<=.5*(rt+ot)?(A=j-Math.atan2(it*i,nt),R=et*i):(A=j-Math.atan2(lt*i,at),R=st*i)}var ht=Math.atan2(w,b)*x,ut=t.arotation;(A=(A-ht)*v7.radDeg+y-ut)>180?A-=360:A<-180&&(A+=360),t.updateWorldTransformWith(h,u,ut+A*l,p,f,0,0),ut=e.arotation,(R=((R+ht)*v7.radDeg-e.ashearX)*x+v-ut)>180?R-=360:R<-180&&(R+=360),e.updateWorldTransformWith(b,w,ut+R*l,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)},t}(),Trt=function(t){function e(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n.bendDirection=1,n.compress=!1,n.stretch=!1,n.uniform=!1,n.mix=1,n.softness=0,n}return Ket(e,t),e}(xrt),Ert=function(t){function e(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n.mixRotate=0,n.mixX=0,n.mixY=0,n}return Ket(e,t),e}(xrt);!function(t){t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t[t.Proportional=3]="Proportional"}(srt||(srt={}));var Srt=function(){function t(t,e){if(this.position=0,this.spacing=0,this.mixRotate=0,this.mixX=0,this.mixY=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(var n=0,r=t.bones.length;n<r;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY}return t.prototype.isActive=function(){return this.active},t.prototype.update=function(){var e=this.target.getAttachment();if(e instanceof rnt){var n=this.mixRotate,r=this.mixX,i=this.mixY;if(0!=n||0!=r||0!=i){var s=this.data,a=s.rotateMode==Q9.Tangent,o=s.rotateMode==Q9.ChainScale,l=this.bones.length,h=a?l:l+1,u=this.bones,c=w7.setArraySize(this.spaces,h),d=o?this.lengths=w7.setArraySize(this.lengths,l):null,p=this.spacing;switch(s.spacingMode){case srt.Percent:if(o)for(var f=0,m=h-1;f<m;f++){if((w=(N=u[f]).data.length)<t.epsilon)d[f]=0;else{var g=w*N.matrix.a,y=w*N.matrix.b;d[f]=Math.sqrt(g*g+y*y)}}w7.arrayFill(c,1,h,p);break;case srt.Proportional:var v=0;for(f=0,m=h-1;f<m;){if((w=(N=u[f]).data.length)<t.epsilon)o&&(d[f]=0),c[++f]=p;else{g=w*N.matrix.a,y=w*N.matrix.b;var x=Math.sqrt(g*g+y*y);o&&(d[f]=x),c[++f]=x,v+=x}}if(v>0){v=h/v*p;for(f=1;f<h;f++)c[f]*=v}break;default:var b=s.spacingMode==srt.Length;for(f=0,m=h-1;f<m;){var w;if((w=(N=u[f]).data.length)<t.epsilon)o&&(d[f]=0),c[++f]=p;else{g=w*N.matrix.a,y=w*N.matrix.b;var _=Math.sqrt(g*g+y*y);o&&(d[f]=_),c[++f]=(b?w+p:p)*_/w}}}var T=this.computeWorldPositions(e,h,a),E=T[0],S=T[1],I=s.offsetRotation,k=!1;if(0==I)k=s.rotateMode==Q9.Chain;else k=!1,I*=(C=this.target.bone.matrix).a*C.d-C.b*C.c>0?v7.degRad:-v7.degRad;f=0;for(var C=3;f<l;f++,C+=3){var N,A=(N=u[f]).matrix;A.tx+=(E-A.tx)*r,A.ty+=(S-A.ty)*i;var R=(g=T[C])-E,M=(y=T[C+1])-S;if(o){var O=d[f];if(0!=O){var P=(Math.sqrt(R*R+M*M)/O-1)*n+1;A.a*=P,A.b*=P}}if(E=g,S=y,n>0){var D=A.a,F=A.c,L=A.b,B=A.d,$=0,U=0,V=0;if($=a?T[C-1]:0==c[f+1]?T[C+2]:Math.atan2(M,R),$-=Math.atan2(L,D),k){U=Math.cos($),V=Math.sin($);var z=N.data.length;E+=(z*(U*D-V*L)-R)*n,S+=(z*(V*D+U*L)-M)*n}else $+=I;$>v7.PI?$-=v7.PI2:$<-v7.PI&&($+=v7.PI2),$*=n,U=Math.cos($),V=Math.sin($),A.a=U*D-V*L,A.c=U*F-V*B,A.b=V*D+U*L,A.d=V*F+U*B}N.updateAppliedTransform()}}}},t.prototype.computeWorldPositions=function(e,n,r){var i=this.target,s=this.position,a=this.spaces,o=w7.setArraySize(this.positions,3*n+2),l=null,h=e.closed,u=e.worldVerticesLength,c=u/6,d=t.NONE;if(!e.constantSpeed){var p,f=e.lengths,m=f[c-=h?1:2];switch(this.data.positionMode==J9.Percent&&(s*=m),this.data.spacingMode){case srt.Percent:p=m;break;case srt.Proportional:p=m/n;break;default:p=1}l=w7.setArraySize(this.world,8);for(var g=0,y=0,v=0;g<n;g++,y+=3){var x=s+=W=a[g]*p;if(h)(x%=m)<0&&(x+=m),v=0;else{if(x<0){d!=t.BEFORE&&(d=t.BEFORE,e.computeWorldVertices(i,2,4,l,0,2)),this.addBeforePosition(x,l,0,o,y);continue}if(x>m){d!=t.AFTER&&(d=t.AFTER,e.computeWorldVertices(i,u-6,4,l,0,2)),this.addAfterPosition(x-m,l,0,o,y);continue}}for(;;v++){var b=f[v];if(!(x>b)){if(0==v)x/=b;else x=(x-(j=f[v-1]))/(b-j);break}}v!=d&&(d=v,h&&v==c?(e.computeWorldVertices(i,u-4,4,l,0,2),e.computeWorldVertices(i,0,4,l,4,2)):e.computeWorldVertices(i,6*v+2,8,l,0,2)),this.addCurvePosition(x,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],o,y,r||g>0&&0==W)}return o}h?(u+=2,l=w7.setArraySize(this.world,u),e.computeWorldVertices(i,2,u-4,l,0,2),e.computeWorldVertices(i,0,2,l,u-4,2),l[u-2]=l[0],l[u-1]=l[1]):(c--,u-=4,l=w7.setArraySize(this.world,u),e.computeWorldVertices(i,2,u,l,0,2));for(var w=w7.setArraySize(this.curves,c),_=0,T=l[0],E=l[1],S=0,I=0,k=0,C=0,N=0,A=0,R=0,M=0,O=0,P=0,D=0,F=0,L=0,B=0,$=(g=0,2);g<c;g++,$+=6)S=l[$],I=l[$+1],k=l[$+2],C=l[$+3],D=2*(R=.1875*(T-2*S+k))+(O=.09375*(3*(S-k)-T+(N=l[$+4]))),F=2*(M=.1875*(E-2*I+C))+(P=.09375*(3*(I-C)-E+(A=l[$+5]))),L=.75*(S-T)+R+.16666667*O,B=.75*(I-E)+M+.16666667*P,_+=Math.sqrt(L*L+B*B),L+=D,B+=F,D+=O,F+=P,_+=Math.sqrt(L*L+B*B),L+=D,B+=F,_+=Math.sqrt(L*L+B*B),L+=D+O,B+=F+P,_+=Math.sqrt(L*L+B*B),w[g]=_,T=N,E=A;this.data.positionMode==J9.Percent&&(s*=_);var U=0;switch(this.data.spacingMode){case srt.Percent:U=_;break;case srt.Proportional:U=_/n;break;default:U=1}for(var V=this.segments,z=0,G=(g=0,y=0,v=0,0);g<n;g++,y+=3){var W;x=s+=W=a[g]*U;if(h)(x%=_)<0&&(x+=_),v=0;else{if(x<0){this.addBeforePosition(x,l,0,o,y);continue}if(x>_){this.addAfterPosition(x-_,l,u-4,o,y);continue}}for(;;v++){var X=w[v];if(!(x>X)){if(0==v)x/=X;else x=(x-(j=w[v-1]))/(X-j);break}}if(v!=d){d=v;var H=6*v;for(T=l[H],E=l[H+1],S=l[H+2],I=l[H+3],k=l[H+4],C=l[H+5],D=2*(R=.03*(T-2*S+k))+(O=.006*(3*(S-k)-T+(N=l[H+6]))),F=2*(M=.03*(E-2*I+C))+(P=.006*(3*(I-C)-E+(A=l[H+7]))),L=.3*(S-T)+R+.16666667*O,B=.3*(I-E)+M+.16666667*P,z=Math.sqrt(L*L+B*B),V[0]=z,H=1;H<8;H++)L+=D,B+=F,D+=O,F+=P,z+=Math.sqrt(L*L+B*B),V[H]=z;L+=D,B+=F,z+=Math.sqrt(L*L+B*B),V[8]=z,L+=D+O,B+=F+P,z+=Math.sqrt(L*L+B*B),V[9]=z,G=0}for(x*=z;;G++){var Y=V[G];if(!(x>Y)){var j;if(0==G)x/=Y;else x=G+(x-(j=V[G-1]))/(Y-j);break}}this.addCurvePosition(.1*x,T,E,S,I,k,C,N,A,o,y,r||g>0&&0==W)}return o},t.prototype.addBeforePosition=function(t,e,n,r,i){var s=e[n],a=e[n+1],o=e[n+2]-s,l=e[n+3]-a,h=Math.atan2(l,o);r[i]=s+t*Math.cos(h),r[i+1]=a+t*Math.sin(h),r[i+2]=h},t.prototype.addAfterPosition=function(t,e,n,r,i){var s=e[n+2],a=e[n+3],o=s-e[n],l=a-e[n+1],h=Math.atan2(l,o);r[i]=s+t*Math.cos(h),r[i+1]=a+t*Math.sin(h),r[i+2]=h},t.prototype.addCurvePosition=function(t,e,n,r,i,s,a,o,l,h,u,c){if(0==t||isNaN(t))return h[u]=e,h[u+1]=n,void(h[u+2]=Math.atan2(i-n,r-e));var d=t*t,p=d*t,f=1-t,m=f*f,g=m*f,y=f*t,v=3*y,x=f*v,b=v*t,w=e*g+r*x+s*b+o*p,_=n*g+i*x+a*b+l*p;h[u]=w,h[u+1]=_,c&&(h[u+2]=t<.001?Math.atan2(i-n,r-e):Math.atan2(_-(n*m+i*y*2+a*d),w-(e*m+r*y*2+s*d)))},t.NONE=-1,t.BEFORE=-2,t.AFTER=-3,t.epsilon=1e-5,t}(),Irt=function(){function t(t,e){if(this.deform=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new y7,this.darkColor=null==t.darkColor?null:new y7,this.setToSetupPose(),this.blendMode=this.data.blendMode}return t.prototype.getSkeleton=function(){return this.bone.skeleton},t.prototype.getAttachment=function(){return this.attachment},t.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)},t.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t},t.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},t.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},t}(),krt=function(){function t(t,e){if(this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.temp=new T7,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY,this.mixScaleX=t.mixScaleX,this.mixScaleY=t.mixScaleY,this.mixShearY=t.mixShearY,this.bones=new Array;for(var n=0;n<t.bones.length;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)}return t.prototype.isActive=function(){return this.active},t.prototype.update=function(){0==this.mixRotate&&0==this.mixX&&0==this.mixY&&0==this.mixScaleX&&0==this.mixScaleX&&0==this.mixShearY||(this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld())},t.prototype.applyAbsoluteWorld=function(){for(var t=this.mixRotate,e=this.mixX,n=this.mixY,r=this.mixScaleX,i=this.mixScaleY,s=this.mixShearY,a=0!=e||0!=n,o=this.target,l=o.matrix,h=l.a,u=l.c,c=l.b,d=l.d,p=h*d-u*c>0?v7.degRad:-v7.degRad,f=this.data.offsetRotation*p,m=this.data.offsetShearY*p,g=this.bones,y=0,v=g.length;y<v;y++){var x=g[y],b=x.matrix;if(0!=t){var w=b.a,_=b.c,T=b.b,E=b.d;(C=Math.atan2(c,h)-Math.atan2(T,w)+f)>v7.PI?C-=v7.PI2:C<-v7.PI&&(C+=v7.PI2),C*=t;var S=Math.cos(C),I=Math.sin(C);b.a=S*w-I*T,b.c=S*_-I*E,b.b=I*w+S*T,b.d=I*_+S*E}if(a){var k=this.temp;o.localToWorld(k.set(this.data.offsetX,this.data.offsetY)),b.tx+=(k.x-b.tx)*e,b.ty+=(k.y-b.ty)*n}if(0!=r)0!=(A=Math.sqrt(b.a*b.a+b.b*b.b))&&(A=(A+(Math.sqrt(h*h+c*c)-A+this.data.offsetScaleX)*r)/A),b.a*=A,b.b*=A;if(0!=i)0!=(A=Math.sqrt(b.c*b.c+b.d*b.d))&&(A=(A+(Math.sqrt(u*u+d*d)-A+this.data.offsetScaleY)*i)/A),b.c*=A,b.d*=A;if(s>0){_=b.c,E=b.d;var C,N=Math.atan2(E,_);(C=Math.atan2(d,u)-Math.atan2(c,h)-(N-Math.atan2(b.b,b.a)))>v7.PI?C-=v7.PI2:C<-v7.PI&&(C+=v7.PI2),C=N+(C+m)*s;var A=Math.sqrt(_*_+E*E);b.c=Math.cos(C)*A,b.d=Math.sin(C)*A}x.updateAppliedTransform()}},t.prototype.applyRelativeWorld=function(){for(var t=this.mixRotate,e=this.mixX,n=this.mixY,r=this.mixScaleX,i=this.mixScaleY,s=this.mixShearY,a=0!=e||0!=n,o=this.target,l=o.matrix,h=l.a,u=l.c,c=l.b,d=l.d,p=h*d-u*c>0?v7.degRad:-v7.degRad,f=this.data.offsetRotation*p,m=this.data.offsetShearY*p,g=this.bones,y=0,v=g.length;y<v;y++){var x=g[y],b=x.matrix;if(0!=t){var w=b.a,_=b.c,T=b.b,E=b.d;(N=Math.atan2(c,h)+f)>v7.PI?N-=v7.PI2:N<-v7.PI&&(N+=v7.PI2),N*=t;var S=Math.cos(N),I=Math.sin(N);b.a=S*w-I*T,b.c=S*_-I*E,b.b=I*w+S*T,b.d=I*_+S*E}if(a){var k=this.temp;o.localToWorld(k.set(this.data.offsetX,this.data.offsetY)),b.tx+=k.x*e,b.ty+=k.y*n}if(0!=r){var C=(Math.sqrt(h*h+c*c)-1+this.data.offsetScaleX)*r+1;b.a*=C,b.b*=C}if(0!=i){C=(Math.sqrt(u*u+d*d)-1+this.data.offsetScaleY)*i+1;b.c*=C,b.d*=C}if(s>0){var N;(N=Math.atan2(d,u)-Math.atan2(c,h))>v7.PI?N-=v7.PI2:N<-v7.PI&&(N+=v7.PI2);_=b.c,E=b.d;N=Math.atan2(E,_)+(N-v7.PI/2+m)*s;C=Math.sqrt(_*_+E*E);b.c=Math.cos(N)*C,b.d=Math.sin(N)*C}x.updateAppliedTransform()}},t.prototype.applyAbsoluteLocal=function(){for(var t=this.mixRotate,e=this.mixX,n=this.mixY,r=this.mixScaleX,i=this.mixScaleY,s=this.mixShearY,a=this.target,o=this.bones,l=0,h=o.length;l<h;l++){var u=o[l],c=u.arotation;if(0!=t){var d=a.arotation-c+this.data.offsetRotation;c+=(d-=360*(16384-(16384.499999999996-d/360|0)))*t}var p=u.ax,f=u.ay;p+=(a.ax-p+this.data.offsetX)*e,f+=(a.ay-f+this.data.offsetY)*n;var m=u.ascaleX,g=u.ascaleY;0!=r&&0!=m&&(m=(m+(a.ascaleX-m+this.data.offsetScaleX)*r)/m),0!=i&&0!=g&&(g=(g+(a.ascaleY-g+this.data.offsetScaleY)*i)/g);var y=u.ashearY;if(0!=s){d=a.ashearY-y+this.data.offsetShearY;y+=(d-=360*(16384-(16384.499999999996-d/360|0)))*s}u.updateWorldTransformWith(p,f,c,m,g,u.ashearX,y)}},t.prototype.applyRelativeLocal=function(){for(var t=this.mixRotate,e=this.mixX,n=this.mixY,r=this.mixScaleX,i=this.mixScaleY,s=this.mixShearY,a=this.target,o=this.bones,l=0,h=o.length;l<h;l++){var u=o[l],c=u.arotation+(a.arotation+this.data.offsetRotation)*t,d=u.ax+(a.ax+this.data.offsetX)*e,p=u.ay+(a.ay+this.data.offsetY)*n,f=u.ascaleX*((a.ascaleX-1+this.data.offsetScaleX)*r)+1,m=u.ascaleY*((a.ascaleY-1+this.data.offsetScaleY)*i)+1,g=u.ashearY+(a.ashearY+this.data.offsetShearY)*s;u.updateWorldTransformWith(d,p,c,f,m,u.ashearX,g)}},t}(),Crt=function(){function t(t){if(this._updateCache=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,!t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(var e=0;e<t.bones.length;e++){var n=t.bones[e],r=void 0;if(n.parent){var i=this.bones[n.parent.index];r=new yrt(n,this,i),i.children.push(r)}else r=new yrt(n,this,null);this.bones.push(r)}this.slots=new Array,this.drawOrder=new Array;for(e=0;e<t.slots.length;e++){var s=t.slots[e],a=(r=this.bones[s.boneData.index],new Irt(s,r));this.slots.push(a),this.drawOrder.push(a)}this.ikConstraints=new Array;for(e=0;e<t.ikConstraints.length;e++){var o=t.ikConstraints[e];this.ikConstraints.push(new _rt(o,this))}this.transformConstraints=new Array;for(e=0;e<t.transformConstraints.length;e++){var l=t.transformConstraints[e];this.transformConstraints.push(new krt(l,this))}this.pathConstraints=new Array;for(e=0;e<t.pathConstraints.length;e++){var h=t.pathConstraints[e];this.pathConstraints.push(new Srt(h,this))}this.color=new y7(1,1,1,1),this.updateCache()}return t.prototype.updateCache=function(){this._updateCache.length=0;for(var t=this.bones,e=0,n=t.length;e<n;e++){(i=t[e]).sorted=i.data.skinRequired,i.active=!i.sorted}if(this.skin){var r=this.skin.bones;for(e=0,n=this.skin.bones.length;e<n;e++){var i=this.bones[r[e].index];do{i.sorted=!1,i.active=!0,i=i.parent}while(i)}}var s=this.ikConstraints,a=this.transformConstraints,o=this.pathConstraints,l=s.length,h=a.length,u=o.length,c=l+h+u;t:for(e=0;e<c;e++){for(var d=0;d<l;d++){if((p=s[d]).data.order==e){this.sortIkConstraint(p);continue t}}for(d=0;d<h;d++){if((p=a[d]).data.order==e){this.sortTransformConstraint(p);continue t}}for(d=0;d<u;d++){var p;if((p=o[d]).data.order==e){this.sortPathConstraint(p);continue t}}}for(e=0,n=t.length;e<n;e++)this.sortBone(t[e])},t.prototype.sortIkConstraint=function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&w7.contains(this.skin.constraints,t.data,!0)),t.active){var e=t.target;this.sortBone(e);var n=t.bones,r=n[0];if(this.sortBone(r),1==n.length)this._updateCache.push(t),this.sortReset(r.children);else{var i=n[n.length-1];this.sortBone(i),this._updateCache.push(t),this.sortReset(r.children),i.sorted=!0}}},t.prototype.sortPathConstraint=function(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||this.skin&&w7.contains(this.skin.constraints,t.data,!0)),t.active){var e=t.target,n=e.data.index,r=e.bone;this.skin&&this.sortPathConstraintAttachment(this.skin,n,r),this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,n,r);for(var i=0,s=this.data.skins.length;i<s;i++)this.sortPathConstraintAttachment(this.data.skins[i],n,r);var a=e.getAttachment();a instanceof rnt&&this.sortPathConstraintAttachmentWith(a,r);var o=t.bones,l=o.length;for(i=0;i<l;i++)this.sortBone(o[i]);this._updateCache.push(t);for(i=0;i<l;i++)this.sortReset(o[i].children);for(i=0;i<l;i++)o[i].sorted=!0}},t.prototype.sortTransformConstraint=function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&w7.contains(this.skin.constraints,t.data,!0)),t.active){this.sortBone(t.target);var e=t.bones,n=e.length;if(t.data.local)for(var r=0;r<n;r++){var i=e[r];this.sortBone(i.parent),this.sortBone(i)}else for(r=0;r<n;r++)this.sortBone(e[r]);this._updateCache.push(t);for(r=0;r<n;r++)this.sortReset(e[r].children);for(r=0;r<n;r++)e[r].sorted=!0}},t.prototype.sortPathConstraintAttachment=function(t,e,n){var r=t.attachments[e];if(r)for(var i in r)this.sortPathConstraintAttachmentWith(r[i],n)},t.prototype.sortPathConstraintAttachmentWith=function(t,e){if(t instanceof rnt){var n=t.bones;if(n)for(var r=this.bones,i=0,s=n.length;i<s;){var a=n[i++];for(a+=i;i<a;)this.sortBone(r[n[i++]])}else this.sortBone(e)}},t.prototype.sortBone=function(t){if(!t.sorted){var e=t.parent;e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}},t.prototype.sortReset=function(t){for(var e=0,n=t.length;e<n;e++){var r=t[e];r.active&&(r.sorted&&this.sortReset(r.children),r.sorted=!1)}},t.prototype.updateWorldTransform=function(){for(var t=this.bones,e=0,n=t.length;e<n;e++){var r=t[e];r.ax=r.x,r.ay=r.y,r.arotation=r.rotation,r.ascaleX=r.scaleX,r.ascaleY=r.scaleY,r.ashearX=r.shearX,r.ashearY=r.shearY}var i=this._updateCache;for(e=0,n=i.length;e<n;e++)i[e].update()},t.prototype.updateWorldTransformWith=function(t){var e=this.getRootBone(),n=t.matrix.a,r=t.matrix.c,i=t.matrix.b,s=t.matrix.d;e.matrix.tx=n*this.x+r*this.y+t.worldX,e.matrix.ty=i*this.x+s*this.y+t.worldY;var a=e.rotation+90+e.shearY,o=v7.cosDeg(e.rotation+e.shearX)*e.scaleX,l=v7.cosDeg(a)*e.scaleY,h=v7.sinDeg(e.rotation+e.shearX)*e.scaleX,u=v7.sinDeg(a)*e.scaleY,c=this.scaleX,d=E7?-this.scaleY:this.scaleY;e.matrix.a=(n*o+r*h)*c,e.matrix.c=(n*l+r*u)*c,e.matrix.b=(i*o+s*h)*d,e.matrix.d=(i*l+s*u)*d;for(var p=this._updateCache,f=0,m=p.length;f<m;f++){var g=p[f];g!=e&&g.update()}},t.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},t.prototype.setBonesToSetupPose=function(){for(var t=this.bones,e=0,n=t.length;e<n;e++)t[e].setToSetupPose();var r=this.ikConstraints;for(e=0,n=r.length;e<n;e++){(o=r[e]).mix=o.data.mix,o.softness=o.data.softness,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch}var i=this.transformConstraints;for(e=0,n=i.length;e<n;e++){var s=(o=i[e]).data;o.mixRotate=s.mixRotate,o.mixX=s.mixX,o.mixY=s.mixY,o.mixScaleX=s.mixScaleX,o.mixScaleY=s.mixScaleY,o.mixShearY=s.mixShearY}var a=this.pathConstraints;for(e=0,n=a.length;e<n;e++){var o;s=(o=a[e]).data;o.position=s.position,o.spacing=s.spacing,o.mixRotate=s.mixRotate,o.mixX=s.mixX,o.mixY=s.mixY}},t.prototype.setSlotsToSetupPose=function(){var t=this.slots;w7.arrayCopy(t,0,this.drawOrder,0,t.length);for(var e=0,n=t.length;e<n;e++)t[e].setToSetupPose()},t.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},t.prototype.findBone=function(t){if(!t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,r=e.length;n<r;n++){var i=e[n];if(i.data.name==t)return i}return null},t.prototype.findBoneIndex=function(t){if(!t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,r=e.length;n<r;n++)if(e[n].data.name==t)return n;return-1},t.prototype.findSlot=function(t){if(!t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,r=e.length;n<r;n++){var i=e[n];if(i.data.name==t)return i}return null},t.prototype.findSlotIndex=function(t){if(!t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,r=e.length;n<r;n++)if(e[n].data.name==t)return n;return-1},t.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(!e)throw new Error("Skin not found: "+t);this.setSkin(e)},t.prototype.setSkin=function(t){if(t!=this.skin){if(t)if(this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,n=0,r=e.length;n<r;n++){var i=e[n],s=i.data.attachmentName;if(s){var a=t.getAttachment(n,s);a&&i.setAttachment(a)}}this.skin=t,this.updateCache()}},t.prototype.getAttachmentByName=function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)},t.prototype.getAttachment=function(t,e){if(!e)throw new Error("attachmentName cannot be null.");if(this.skin){var n=this.skin.getAttachment(t,e);if(n)return n}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},t.prototype.setAttachment=function(t,e){if(!t)throw new Error("slotName cannot be null.");for(var n=this.slots,r=0,i=n.length;r<i;r++){var s=n[r];if(s.data.name==t){var a=null;if(e&&!(a=this.getAttachment(r,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void s.setAttachment(a)}}throw new Error("Slot not found: "+t)},t.prototype.findIkConstraint=function(t){if(!t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.data.name==t)return i}return null},t.prototype.findTransformConstraint=function(t){if(!t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.data.name==t)return i}return null},t.prototype.findPathConstraint=function(t){if(!t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.data.name==t)return i}return null},t.prototype.getBounds=function(t,e,n){if(void 0===n&&(n=new Array(2)),!t)throw new Error("offset cannot be null.");if(!e)throw new Error("size cannot be null.");for(var r=this.drawOrder,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,l=0,h=r.length;l<h;l++){var u=r[l];if(u.bone.active){var c=0,d=null,p=u.getAttachment();if(p instanceof snt)c=8,d=w7.setArraySize(n,c,0),p.computeWorldVertices(u.bone,d,0,2);else if(p instanceof nnt){var f=p;c=f.worldVerticesLength,d=w7.setArraySize(n,c,0),f.computeWorldVertices(u,0,c,d,0,2)}if(d)for(var m=0,g=d.length;m<g;m+=2){var y=d[m],v=d[m+1];i=Math.min(i,y),s=Math.min(s,v),a=Math.max(a,y),o=Math.max(o,v)}}}t.set(i,s),e.set(a-i,o-s)},t.prototype.update=function(t){this.time+=t},Object.defineProperty(t.prototype,"flipX",{get:function(){return-1==this.scaleX},set:function(e){t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.scaleX=e?1:-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"flipY",{get:function(){return-1==this.scaleY},set:function(e){t.deprecatedWarning1||(t.deprecatedWarning1=!0),this.scaleY=e?1:-1},enumerable:!1,configurable:!0}),t.deprecatedWarning1=!1,t}(),Nrt=function(){function t(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}return t.prototype.findBone=function(t){if(!t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findBoneIndex=function(t){if(!t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1},t.prototype.findSlot=function(t){if(!t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findSlotIndex=function(t){if(!t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1},t.prototype.findSkin=function(t){if(!t)throw new Error("skinName cannot be null.");for(var e=this.skins,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findEvent=function(t){if(!t)throw new Error("eventDataName cannot be null.");for(var e=this.events,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findAnimation=function(t){if(!t)throw new Error("animationName cannot be null.");for(var e=this.animations,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findIkConstraint=function(t){if(!t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findTransformConstraint=function(t){if(!t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findPathConstraint=function(t){if(!t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return i}return null},t.prototype.findPathConstraintIndex=function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1},t}(),Art=function(t,e,n){if(this.color=new y7(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");if(!n)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=n},Rrt=function(t){function e(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n.mixRotate=0,n.mixX=0,n.mixY=0,n.mixScaleX=0,n.mixScaleY=0,n.mixShearY=0,n.offsetRotation=0,n.offsetX=0,n.offsetY=0,n.offsetScaleX=0,n.offsetScaleY=0,n.offsetShearY=0,n.relative=!1,n.local=!1,n}return Ket(e,t),e}(xrt),Mrt=function(t,e,n){this.slotIndex=t,this.name=e,this.attachment=n},Ort=function(){function t(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,!t)throw new Error("name cannot be null.");this.name=t}return t.prototype.setAttachment=function(t,e,n){if(!n)throw new Error("attachment cannot be null.");var r=this.attachments;t>=r.length&&(r.length=t+1),r[t]||(r[t]={}),r[t][e]=n},t.prototype.addSkin=function(t){for(var e=0;e<t.bones.length;e++){for(var n=t.bones[e],r=!1,i=0;i<this.bones.length;i++)if(this.bones[i]==n){r=!0;break}r||this.bones.push(n)}for(e=0;e<t.constraints.length;e++){var s=t.constraints[e];for(r=!1,i=0;i<this.constraints.length;i++)if(this.constraints[i]==s){r=!0;break}r||this.constraints.push(s)}var a=t.getAttachments();for(e=0;e<a.length;e++){var o=a[e];this.setAttachment(o.slotIndex,o.name,o.attachment)}},t.prototype.copySkin=function(t){for(var e=0;e<t.bones.length;e++){for(var n=t.bones[e],r=!1,i=0;i<this.bones.length;i++)if(this.bones[i]==n){r=!0;break}r||this.bones.push(n)}for(e=0;e<t.constraints.length;e++){var s=t.constraints[e];for(r=!1,i=0;i<this.constraints.length;i++)if(this.constraints[i]==s){r=!0;break}r||this.constraints.push(s)}var a=t.getAttachments();for(e=0;e<a.length;e++){var o=a[e];o.attachment&&(o.attachment instanceof nnt?(o.attachment=o.attachment.newLinkedMesh(),this.setAttachment(o.slotIndex,o.name,o.attachment)):(o.attachment=o.attachment.copy(),this.setAttachment(o.slotIndex,o.name,o.attachment)))}},t.prototype.getAttachment=function(t,e){var n=this.attachments[t];return n?n[e]:null},t.prototype.removeAttachment=function(t,e){var n=this.attachments[t];n&&(n[e]=null)},t.prototype.getAttachments=function(){for(var t=new Array,e=0;e<this.attachments.length;e++){var n=this.attachments[e];if(n)for(var r in n){var i=n[r];i&&t.push(new Mrt(e,r,i))}}return t},t.prototype.getAttachmentsForSlot=function(t,e){var n=this.attachments[t];if(n)for(var r in n){var i=n[r];i&&e.push(new Mrt(t,r,i))}},t.prototype.clear=function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0},t.prototype.attachAll=function(t,e){for(var n=0,r=0;r<t.slots.length;r++){var i=t.slots[r],s=i.getAttachment();if(s&&n<e.attachments.length){var a=e.attachments[n];for(var o in a){if(s==a[o]){var l=this.getAttachment(n,o);l&&i.setAttachment(l);break}}}n++}},t}(),Prt=function(){function t(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return t.prototype.readSkeletonData=function(e){var n=this.scale,r=new Nrt;r.name="";var i=new e7(e),s=i.readInt32(),a=i.readInt32();if(r.hash=0==a&&0==s?null:a.toString(16)+s.toString(16),r.version=i.readString(),"4.0"!==r.version.substr(0,3))r.version;r.x=i.readFloat(),r.y=i.readFloat(),r.width=i.readFloat(),r.height=i.readFloat();var o=i.readBoolean();o&&(r.fps=i.readFloat(),r.imagesPath=i.readString(),r.audioPath=i.readString());var l=0;l=i.readInt(!0);for(var h=0;h<l;h++)i.strings.push(i.readString());l=i.readInt(!0);for(h=0;h<l;h++){var u=i.readString(),c=0==h?null:r.bones[i.readInt(!0)];(f=new vrt(h,u,c)).rotation=i.readFloat(),f.x=i.readFloat()*n,f.y=i.readFloat()*n,f.scaleX=i.readFloat(),f.scaleY=i.readFloat(),f.shearX=i.readFloat(),f.shearY=i.readFloat(),f.length=i.readFloat()*n,f.transformMode=i.readInt(!0),f.skinRequired=i.readBoolean(),o&&y7.rgba8888ToColor(f.color,i.readInt32()),r.bones.push(f)}l=i.readInt(!0);for(h=0;h<l;h++){var d=i.readString(),p=r.bones[i.readInt(!0)],f=new Art(h,d,p);y7.rgba8888ToColor(f.color,i.readInt32());var m=i.readInt32();-1!=m&&y7.rgb888ToColor(f.darkColor=new y7,m),f.attachmentName=i.readStringRef(),f.blendMode=t.BlendModeValues[i.readInt(!0)],r.slots.push(f)}l=i.readInt(!0);h=0;for(var g=void 0;h<l;h++){(f=new Trt(i.readString())).order=i.readInt(!0),f.skinRequired=i.readBoolean(),g=i.readInt(!0);for(var y=0;y<g;y++)f.bones.push(r.bones[i.readInt(!0)]);f.target=r.bones[i.readInt(!0)],f.mix=i.readFloat(),f.softness=i.readFloat()*n,f.bendDirection=i.readByte(),f.compress=i.readBoolean(),f.stretch=i.readBoolean(),f.uniform=i.readBoolean(),r.ikConstraints.push(f)}l=i.readInt(!0);for(h=0,g=void 0;h<l;h++){(f=new Rrt(i.readString())).order=i.readInt(!0),f.skinRequired=i.readBoolean(),g=i.readInt(!0);for(y=0;y<g;y++)f.bones.push(r.bones[i.readInt(!0)]);f.target=r.bones[i.readInt(!0)],f.local=i.readBoolean(),f.relative=i.readBoolean(),f.offsetRotation=i.readFloat(),f.offsetX=i.readFloat()*n,f.offsetY=i.readFloat()*n,f.offsetScaleX=i.readFloat(),f.offsetScaleY=i.readFloat(),f.offsetShearY=i.readFloat(),f.mixRotate=i.readFloat(),f.mixX=i.readFloat(),f.mixY=i.readFloat(),f.mixScaleX=i.readFloat(),f.mixScaleY=i.readFloat(),f.mixShearY=i.readFloat(),r.transformConstraints.push(f)}l=i.readInt(!0);for(h=0,g=void 0;h<l;h++){(f=new Ert(i.readString())).order=i.readInt(!0),f.skinRequired=i.readBoolean(),g=i.readInt(!0);for(y=0;y<g;y++)f.bones.push(r.bones[i.readInt(!0)]);f.target=r.slots[i.readInt(!0)],f.positionMode=i.readInt(!0),f.spacingMode=i.readInt(!0),f.rotateMode=i.readInt(!0),f.offsetRotation=i.readFloat(),f.position=i.readFloat(),f.positionMode==J9.Fixed&&(f.position*=n),f.spacing=i.readFloat(),f.spacingMode!=srt.Length&&f.spacingMode!=srt.Fixed||(f.spacing*=n),f.mixRotate=i.readFloat(),f.mixX=i.readFloat(),f.mixY=i.readFloat(),r.pathConstraints.push(f)}var v=this.readSkin(i,r,!0,o);v&&(r.defaultSkin=v,r.skins.push(v));h=r.skins.length;for(w7.setArraySize(r.skins,l=h+i.readInt(!0));h<l;h++)r.skins[h]=this.readSkin(i,r,!1,o);l=this.linkedMeshes.length;for(h=0;h<l;h++){var x=this.linkedMeshes[h],b=(x.skin?r.findSkin(x.skin):r.defaultSkin).getAttachment(x.slotIndex,x.parent);x.mesh.deformAttachment=x.inheritDeform?b:x.mesh,x.mesh.setParentMesh(b)}this.linkedMeshes.length=0,l=i.readInt(!0);for(h=0;h<l;h++){(f=new wrt(i.readStringRef())).intValue=i.readInt(!1),f.floatValue=i.readFloat(),f.stringValue=i.readString(),f.audioPath=i.readString(),f.audioPath&&(f.volume=i.readFloat(),f.balance=i.readFloat()),r.events.push(f)}l=i.readInt(!0);for(h=0;h<l;h++)r.animations.push(this.readAnimation(i,i.readString(),r));return r},t.prototype.readSkin=function(t,e,n,r){var i=null,s=0;if(n){if(0==(s=t.readInt(!0)))return null;i=new Ort("default")}else{(i=new Ort(t.readStringRef())).bones.length=t.readInt(!0);for(var a=0,o=i.bones.length;a<o;a++)i.bones[a]=e.bones[t.readInt(!0)];for(a=0,o=t.readInt(!0);a<o;a++)i.constraints.push(e.ikConstraints[t.readInt(!0)]);for(a=0,o=t.readInt(!0);a<o;a++)i.constraints.push(e.transformConstraints[t.readInt(!0)]);for(a=0,o=t.readInt(!0);a<o;a++)i.constraints.push(e.pathConstraints[t.readInt(!0)]);s=t.readInt(!0)}for(a=0;a<s;a++)for(var l=t.readInt(!0),h=0,u=t.readInt(!0);h<u;h++){var c=t.readStringRef(),d=this.readAttachment(t,e,i,l,c,r);d&&i.setAttachment(l,c,d)}return i},t.prototype.readAttachment=function(t,e,n,r,i,s){var a=this.scale,o=t.readStringRef();switch(o||(o=i),t.readByte()){case $9.Region:var l=t.readStringRef(),h=t.readFloat(),u=t.readFloat(),c=t.readFloat(),d=t.readFloat(),p=t.readFloat(),f=t.readFloat(),m=t.readFloat(),g=t.readInt32();l||(l=o);var y=this.attachmentLoader.newRegionAttachment(n,o,l);return y?(y.path=l,y.x=u*a,y.y=c*a,y.scaleX=d,y.scaleY=p,y.rotation=h,y.width=f*a,y.height=m*a,y7.rgba8888ToColor(y.color,g),y):null;case $9.BoundingBox:var v=t.readInt(!0),x=this.readVertices(t,v),b=(g=s?t.readInt32():0,this.attachmentLoader.newBoundingBoxAttachment(n,o));return b?(b.worldVerticesLength=v<<1,b.vertices=x.vertices,b.bones=x.bones,s&&y7.rgba8888ToColor(b.color,g),b):null;case $9.Mesh:l=t.readStringRef(),g=t.readInt32(),v=t.readInt(!0);var w=this.readFloatArray(t,v<<1,1),_=this.readShortArray(t),T=(x=this.readVertices(t,v),t.readInt(!0)),E=null;f=0,m=0;return s&&(E=this.readShortArray(t),f=t.readFloat(),m=t.readFloat()),l||(l=o),(S=this.attachmentLoader.newMeshAttachment(n,o,l))?(S.path=l,y7.rgba8888ToColor(S.color,g),S.bones=x.bones,S.vertices=x.vertices,S.worldVerticesLength=v<<1,S.triangles=_,S.regionUVs=new Float32Array(w),S.hullLength=T<<1,s&&(S.edges=E,S.width=f*a,S.height=m*a),S):null;case $9.LinkedMesh:l=t.readStringRef(),g=t.readInt32();var S,I=t.readStringRef(),k=t.readStringRef(),C=t.readBoolean();f=0,m=0;return s&&(f=t.readFloat(),m=t.readFloat()),l||(l=o),(S=this.attachmentLoader.newMeshAttachment(n,o,l))?(S.path=l,y7.rgba8888ToColor(S.color,g),s&&(S.width=f*a,S.height=m*a),this.linkedMeshes.push(new Drt(S,I,r,k,C)),S):null;case $9.Path:for(var N=t.readBoolean(),A=t.readBoolean(),R=(v=t.readInt(!0),x=this.readVertices(t,v),w7.newArray(v/3,0)),M=0,O=R.length;M<O;M++)R[M]=t.readFloat()*a;g=s?t.readInt32():0;return(l=this.attachmentLoader.newPathAttachment(n,o))?(l.closed=N,l.constantSpeed=A,l.worldVerticesLength=v<<1,l.vertices=x.vertices,l.bones=x.bones,l.lengths=R,s&&y7.rgba8888ToColor(l.color,g),l):null;case $9.Point:h=t.readFloat(),u=t.readFloat(),c=t.readFloat(),g=s?t.readInt32():0;var P=this.attachmentLoader.newPointAttachment(n,o);return P?(P.x=u*a,P.y=c*a,P.rotation=h,s&&y7.rgba8888ToColor(P.color,g),P):null;case $9.Clipping:var D=t.readInt(!0),F=(v=t.readInt(!0),x=this.readVertices(t,v),g=s?t.readInt32():0,this.attachmentLoader.newClippingAttachment(n,o));return F?(F.endSlot=e.slots[D],F.worldVerticesLength=v<<1,F.vertices=x.vertices,F.bones=x.bones,s&&y7.rgba8888ToColor(F.color,g),F):null}return null},t.prototype.readVertices=function(t,e){var n=this.scale,r=e<<1,i=new Frt;if(!t.readBoolean())return i.vertices=this.readFloatArray(t,r,n),i;for(var s=new Array,a=new Array,o=0;o<e;o++){var l=t.readInt(!0);a.push(l);for(var h=0;h<l;h++)a.push(t.readInt(!0)),s.push(t.readFloat()*n),s.push(t.readFloat()*n),s.push(t.readFloat())}return i.vertices=w7.toFloatArray(s),i.bones=a,i},t.prototype.readFloatArray=function(t,e,n){var r=new Array(e);if(1==n)for(var i=0;i<e;i++)r[i]=t.readFloat();else for(i=0;i<e;i++)r[i]=t.readFloat()*n;return r},t.prototype.readShortArray=function(t){for(var e=t.readInt(!0),n=new Array(e),r=0;r<e;r++)n[r]=t.readShort();return n},t.prototype.readAnimation=function(t,e,n){t.readInt(!0);for(var r=new Array,i=this.scale,s=0,a=t.readInt(!0);s<a;s++)for(var o=t.readInt(!0),l=0,h=t.readInt(!0);l<h;l++){var u=t.readByte(),c=(D=t.readInt(!0))-1;switch(u){case Krt:for(var d=new Ynt(D,o),p=0;p<D;p++)d.setFrame(p,t.readFloat(),t.readStringRef());r.push(d);break;case Zrt:for(var f=t.readInt(!0),m=(d=new znt(D,f,o),t.readFloat()),g=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255,v=t.readUnsignedByte()/255,x=t.readUnsignedByte()/255,b=(p=0,0);d.setFrame(p,m,g,y,v,x),p!=c;p++){var w=t.readFloat(),_=t.readUnsignedByte()/255,T=t.readUnsignedByte()/255,E=t.readUnsignedByte()/255,S=t.readUnsignedByte()/255;switch(t.readByte()){case sit:d.setStepped(p);break;case ait:$rt(t,d,b++,p,0,m,w,g,_,1),$rt(t,d,b++,p,1,m,w,y,T,1),$rt(t,d,b++,p,2,m,w,v,E,1),$rt(t,d,b++,p,3,m,w,x,S,1)}m=w,g=_,y=T,v=E,x=S}r.push(d);break;case Jrt:for(f=t.readInt(!0),d=new Gnt(D,f,o),m=t.readFloat(),g=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255,v=t.readUnsignedByte()/255,p=0,b=0;d.setFrame(p,m,g,y,v),p!=c;p++){w=t.readFloat(),_=t.readUnsignedByte()/255,T=t.readUnsignedByte()/255,E=t.readUnsignedByte()/255;switch(t.readByte()){case sit:d.setStepped(p);break;case ait:$rt(t,d,b++,p,0,m,w,g,_,1),$rt(t,d,b++,p,1,m,w,y,T,1),$rt(t,d,b++,p,2,m,w,v,E,1)}m=w,g=_,y=T,v=E}r.push(d);break;case Qrt:for(f=t.readInt(!0),d=new Xnt(D,f,o),m=t.readFloat(),g=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255,v=t.readUnsignedByte()/255,x=t.readUnsignedByte()/255,_=t.readUnsignedByte()/255,T=t.readUnsignedByte()/255,E=t.readUnsignedByte()/255,p=0,b=0;d.setFrame(p,m,g,y,v,x,_,T,E),p!=c;p++){w=t.readFloat();var I=t.readUnsignedByte()/255,k=t.readUnsignedByte()/255,C=t.readUnsignedByte()/255,N=t.readUnsignedByte()/255,A=t.readUnsignedByte()/255,R=t.readUnsignedByte()/255,M=t.readUnsignedByte()/255;switch(t.readByte()){case sit:d.setStepped(p);break;case ait:$rt(t,d,b++,p,0,m,w,g,I,1),$rt(t,d,b++,p,1,m,w,y,k,1),$rt(t,d,b++,p,2,m,w,v,C,1),$rt(t,d,b++,p,3,m,w,x,N,1),$rt(t,d,b++,p,4,m,w,_,A,1),$rt(t,d,b++,p,5,m,w,T,R,1),$rt(t,d,b++,p,6,m,w,E,M,1)}m=w,g=I,y=k,v=C,x=N,_=A,T=R,E=M}r.push(d);break;case tit:for(f=t.readInt(!0),d=new Hnt(D,f,o),m=t.readFloat(),g=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255,v=t.readUnsignedByte()/255,_=t.readUnsignedByte()/255,T=t.readUnsignedByte()/255,E=t.readUnsignedByte()/255,p=0,b=0;d.setFrame(p,m,g,y,v,_,T,E),p!=c;p++){w=t.readFloat(),I=t.readUnsignedByte()/255,k=t.readUnsignedByte()/255,C=t.readUnsignedByte()/255,A=t.readUnsignedByte()/255,R=t.readUnsignedByte()/255,M=t.readUnsignedByte()/255;switch(t.readByte()){case sit:d.setStepped(p);break;case ait:$rt(t,d,b++,p,0,m,w,g,I,1),$rt(t,d,b++,p,1,m,w,y,k,1),$rt(t,d,b++,p,2,m,w,v,C,1),$rt(t,d,b++,p,3,m,w,_,A,1),$rt(t,d,b++,p,4,m,w,T,R,1),$rt(t,d,b++,p,5,m,w,E,M,1)}m=w,g=I,y=k,v=C,_=A,T=R,E=M}r.push(d);break;case eit:for(d=new Wnt(D,t.readInt(!0),o),m=t.readFloat(),x=t.readUnsignedByte()/255,p=0,b=0;d.setFrame(p,m,x),p!=c;p++){w=t.readFloat(),S=t.readUnsignedByte()/255;switch(t.readByte()){case sit:d.setStepped(p);break;case ait:$rt(t,d,b++,p,0,m,w,x,S,1)}m=w,x=S}r.push(d)}}for(s=0,a=t.readInt(!0);s<a;s++){var O=t.readInt(!0);for(l=0,h=t.readInt(!0);l<h;l++){var P=t.readByte(),D=t.readInt(!0);f=t.readInt(!0);switch(P){case Urt:r.push(Lrt(t,new Mnt(D,f,O),1));break;case Vrt:r.push(Brt(t,new Ont(D,f,O),i));break;case zrt:r.push(Lrt(t,new Pnt(D,f,O),i));break;case Grt:r.push(Lrt(t,new Dnt(D,f,O),i));break;case Wrt:r.push(Brt(t,new Fnt(D,f,O),1));break;case Xrt:r.push(Lrt(t,new Lnt(D,f,O),1));break;case Hrt:r.push(Lrt(t,new Bnt(D,f,O),1));break;case Yrt:r.push(Brt(t,new $nt(D,f,O),1));break;case jrt:r.push(Lrt(t,new Unt(D,f,O),1));break;case qrt:r.push(Lrt(t,new Vnt(D,f,O),1))}}}for(s=0,a=t.readInt(!0);s<a;s++){var F=t.readInt(!0),L=(c=(D=t.readInt(!0))-1,d=new Znt(D,t.readInt(!0),F),m=t.readFloat(),t.readFloat()),B=t.readFloat()*i;for(p=0,b=0;d.setFrame(p,m,L,B,t.readByte(),t.readBoolean(),t.readBoolean()),p!=c;p++){w=t.readFloat();var $=t.readFloat(),U=t.readFloat()*i;switch(t.readByte()){case sit:d.setStepped(p);break;case ait:$rt(t,d,b++,p,0,m,w,L,$,1),$rt(t,d,b++,p,1,m,w,B,U,i)}m=w,L=$,B=U}r.push(d)}for(s=0,a=t.readInt(!0);s<a;s++){F=t.readInt(!0),c=(D=t.readInt(!0))-1,d=new Jnt(D,t.readInt(!0),F),m=t.readFloat();var V=t.readFloat(),z=t.readFloat(),G=t.readFloat(),W=t.readFloat(),X=t.readFloat(),H=t.readFloat();for(p=0,b=0;d.setFrame(p,m,V,z,G,W,X,H),p!=c;p++){w=t.readFloat();var Y=t.readFloat(),j=t.readFloat(),q=t.readFloat(),K=t.readFloat(),Z=t.readFloat(),J=t.readFloat();switch(t.readByte()){case sit:d.setStepped(p);break;case ait:$rt(t,d,b++,p,0,m,w,V,Y,1),$rt(t,d,b++,p,1,m,w,z,j,1),$rt(t,d,b++,p,2,m,w,G,q,1),$rt(t,d,b++,p,3,m,w,W,K,1),$rt(t,d,b++,p,4,m,w,X,Z,1),$rt(t,d,b++,p,5,m,w,H,J,1)}m=w,V=Y,z=j,G=q,W=K,X=Z,H=J}r.push(d)}for(s=0,a=t.readInt(!0);s<a;s++){F=t.readInt(!0);var Q=n.pathConstraints[F];for(l=0,h=t.readInt(!0);l<h;l++)switch(t.readByte()){case nit:r.push(Lrt(t,new Qnt(t.readInt(!0),t.readInt(!0),F),Q.positionMode==J9.Fixed?i:1));break;case rit:r.push(Lrt(t,new trt(t.readInt(!0),t.readInt(!0),F),Q.spacingMode==srt.Length||Q.spacingMode==srt.Fixed?i:1));break;case iit:for(d=new ert(t.readInt(!0),t.readInt(!0),F),m=t.readFloat(),V=t.readFloat(),z=t.readFloat(),G=t.readFloat(),p=0,b=0,c=d.getFrameCount()-1;d.setFrame(p,m,V,z,G),p!=c;p++){w=t.readFloat(),Y=t.readFloat(),j=t.readFloat(),q=t.readFloat();switch(t.readByte()){case sit:d.setStepped(p);break;case ait:$rt(t,d,b++,p,0,m,w,V,Y,1),$rt(t,d,b++,p,1,m,w,z,j,1),$rt(t,d,b++,p,2,m,w,G,q,1)}m=w,V=Y,z=j,G=q}r.push(d)}}for(s=0,a=t.readInt(!0);s<a;s++){var tt=n.skins[t.readInt(!0)];for(l=0,h=t.readInt(!0);l<h;l++){o=t.readInt(!0);for(var et=0,nt=t.readInt(!0);et<nt;et++){var rt=t.readStringRef(),it=tt.getAttachment(o,rt),st=it.bones,at=it.vertices,ot=st?at.length/3*2:at.length;for(c=(D=t.readInt(!0))-1,f=t.readInt(!0),d=new jnt(D,f,o,it),m=t.readFloat(),p=0,b=0;;p++){var lt=void 0,ht=t.readInt(!0);if(0==ht)lt=st?w7.newFloatArray(ot):at;else{lt=w7.newFloatArray(ot);var ut=t.readInt(!0);if(ht+=ut,1==i)for(var ct=ut;ct<ht;ct++)lt[ct]=t.readFloat();else for(ct=ut;ct<ht;ct++)lt[ct]=t.readFloat()*i;if(!st){ct=0;for(var dt=lt.length;ct<dt;ct++)lt[ct]+=at[ct]}}if(d.setFrame(p,m,lt),p==c)break;w=t.readFloat();switch(t.readByte()){case sit:d.setStepped(p);break;case ait:$rt(t,d,b++,p,0,m,w,0,1,1)}m=w}r.push(d)}}}var pt=t.readInt(!0);if(pt>0){d=new Knt(pt);var ft=n.slots.length;for(s=0;s<pt;s++){m=t.readFloat();var mt=t.readInt(!0),gt=w7.newArray(ft,0);for(l=ft-1;l>=0;l--)gt[l]=-1;var yt=w7.newArray(ft-mt,0),vt=0,xt=0;for(l=0;l<mt;l++){for(o=t.readInt(!0);vt!=o;)yt[xt++]=vt++;gt[vt+t.readInt(!0)]=vt++}for(;vt<ft;)yt[xt++]=vt++;for(l=ft-1;l>=0;l--)-1==gt[l]&&(gt[l]=yt[--xt]);d.setFrame(s,m,gt)}r.push(d)}var bt=t.readInt(!0);if(bt>0){for(d=new qnt(bt),s=0;s<bt;s++){m=t.readFloat();var wt=n.events[t.readInt(!0)],_t=new brt(m,wt);_t.intValue=t.readInt(!1),_t.floatValue=t.readFloat(),_t.stringValue=t.readBoolean()?t.readString():wt.stringValue,_t.data.audioPath&&(_t.volume=t.readFloat(),_t.balance=t.readFloat()),d.setFrame(s,_t)}r.push(d)}var Tt=0;for(s=0,a=r.length;s<a;s++)Tt=Math.max(Tt,r[s].getDuration());return new lnt(e,r,Tt)},t.BlendModeValues=[se.NORMAL,se.ADD,se.MULTIPLY,se.SCREEN],t}(),Drt=function(t,e,n,r,i){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=r,this.inheritDeform=i},Frt=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.bones=t,this.vertices=e};function Lrt(t,e,n){for(var r=t.readFloat(),i=t.readFloat()*n,s=0,a=0,o=e.getFrameCount()-1;e.setFrame(s,r,i),s!=o;s++){var l=t.readFloat(),h=t.readFloat()*n;switch(t.readByte()){case sit:e.setStepped(s);break;case ait:$rt(t,e,a++,s,0,r,l,i,h,n)}r=l,i=h}return e}function Brt(t,e,n){for(var r=t.readFloat(),i=t.readFloat()*n,s=t.readFloat()*n,a=0,o=0,l=e.getFrameCount()-1;e.setFrame(a,r,i,s),a!=l;a++){var h=t.readFloat(),u=t.readFloat()*n,c=t.readFloat()*n;switch(t.readByte()){case sit:e.setStepped(a);break;case ait:$rt(t,e,o++,a,0,r,h,i,u,n),$rt(t,e,o++,a,1,r,h,s,c,n)}r=h,i=u,s=c}return e}function $rt(t,e,n,r,i,s,a,o,l,h){e.setBezier(n,r,i,s,o,t.readFloat(),t.readFloat()*h,t.readFloat(),t.readFloat()*h,a,l)}var Urt=0,Vrt=1,zrt=2,Grt=3,Wrt=4,Xrt=5,Hrt=6,Yrt=7,jrt=8,qrt=9,Krt=0,Zrt=1,Jrt=2,Qrt=3,tit=4,eit=5,nit=0,rit=1,iit=2,sit=1,ait=2,oit=function(){function t(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new _7((function(){return w7.newFloatArray(16)}))}return t.prototype.update=function(t,e){if(null==t)throw new Error("skeleton cannot be null.");var n=this.boundingBoxes,r=this.polygons,i=this.polygonPool,s=t.slots,a=s.length;n.length=0,i.freeAll(r),r.length=0;for(var o=0;o<a;o++){var l=s[o];if(l.bone.active){var h=l.getAttachment();if(h instanceof tnt){var u=h;n.push(u);var c=i.obtain();c.length!=u.worldVerticesLength&&(c=w7.newFloatArray(u.worldVerticesLength)),r.push(c),u.computeWorldVertices(l,0,u.worldVerticesLength,c,0,2)}}}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},t.prototype.aabbCompute=function(){for(var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=this.polygons,s=0,a=i.length;s<a;s++)for(var o=i[s],l=o,h=0,u=o.length;h<u;h+=2){var c=l[h],d=l[h+1];t=Math.min(t,c),e=Math.min(e,d),n=Math.max(n,c),r=Math.max(r,d)}this.minX=t,this.minY=e,this.maxX=n,this.maxY=r},t.prototype.aabbContainsPoint=function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},t.prototype.aabbIntersectsSegment=function(t,e,n,r){var i=this.minX,s=this.minY,a=this.maxX,o=this.maxY;if(t<=i&&n<=i||e<=s&&r<=s||t>=a&&n>=a||e>=o&&r>=o)return!1;var l=(r-e)/(n-t),h=l*(i-t)+e;if(h>s&&h<o)return!0;if((h=l*(a-t)+e)>s&&h<o)return!0;var u=(s-e)/l+t;return u>i&&u<a||(u=(o-e)/l+t)>i&&u<a},t.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},t.prototype.containsPoint=function(t,e){for(var n=this.polygons,r=0,i=n.length;r<i;r++)if(this.containsPointPolygon(n[r],t,e))return this.boundingBoxes[r];return null},t.prototype.containsPointPolygon=function(t,e,n){for(var r=t,i=t.length,s=i-2,a=!1,o=0;o<i;o+=2){var l=r[o+1],h=r[s+1];if(l<n&&h>=n||h<n&&l>=n){var u=r[o];u+(n-l)/(h-l)*(r[s]-u)<e&&(a=!a)}s=o}return a},t.prototype.intersectsSegment=function(t,e,n,r){for(var i=this.polygons,s=0,a=i.length;s<a;s++)if(this.intersectsSegmentPolygon(i[s],t,e,n,r))return this.boundingBoxes[s];return null},t.prototype.intersectsSegmentPolygon=function(t,e,n,r,i){for(var s=t,a=t.length,o=e-r,l=n-i,h=e*i-n*r,u=s[a-2],c=s[a-1],d=0;d<a;d+=2){var p=s[d],f=s[d+1],m=u*f-c*p,g=u-p,y=c-f,v=o*y-l*g,x=(h*g-o*m)/v;if((x>=u&&x<=p||x>=p&&x<=u)&&(x>=e&&x<=r||x>=r&&x<=e)){var b=(h*y-l*m)/v;if((b>=c&&b<=f||b>=f&&b<=c)&&(b>=n&&b<=i||b>=i&&b<=n))return!0}u=p,c=f}return!1},t.prototype.getPolygon=function(t){if(null==t)throw new Error("boundingBox cannot be null.");var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},t.prototype.getWidth=function(){return this.maxX-this.minX},t.prototype.getHeight=function(){return this.maxY-this.minY},t}(),lit=function(){function t(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return t.prototype.readSkeletonData=function(e){var n=this.scale,r=new Nrt,i="string"==typeof e?JSON.parse(e):e,s=i.skeleton;if(s){if(r.hash=s.hash,r.version=s.spine,"4.0"!==r.version.substr(0,3))s.spine;r.x=s.x,r.y=s.y,r.width=s.width,r.height=s.height,r.fps=s.fps,r.imagesPath=s.images}if(i.bones)for(var a=0;a<i.bones.length;a++){var o=i.bones[a],l=null,h=pit(o,"parent",null);if(null!=h&&null==(l=r.findBone(h)))throw new Error("Parent bone not found: "+h);(f=new vrt(r.bones.length,o.name,l)).length=pit(o,"length",0)*n,f.x=pit(o,"x",0)*n,f.y=pit(o,"y",0)*n,f.rotation=pit(o,"rotation",0),f.scaleX=pit(o,"scaleX",1),f.scaleY=pit(o,"scaleY",1),f.shearX=pit(o,"shearX",0),f.shearY=pit(o,"shearY",0),f.transformMode=w7.enumValue(t7,pit(o,"transform","Normal")),f.skinRequired=pit(o,"skin",!1),(p=pit(o,"color",null))&&f.color.setFromString(p),r.bones.push(f)}if(i.slots)for(a=0;a<i.slots.length;a++){var u=(E=i.slots[a]).name,c=E.bone,d=r.findBone(c);if(null==d)throw new Error("Slot bone not found: "+c);var p,f=new Art(r.slots.length,u,d);(p=pit(E,"color",null))&&f.color.setFromString(p);var m=pit(E,"dark",null);m&&(f.darkColor=y7.fromString(m)),f.attachmentName=pit(E,"attachment",null),f.blendMode=t.blendModeFromString(pit(E,"blend","normal")),r.slots.push(f)}if(i.ik)for(a=0;a<i.ik.length;a++){var g=i.ik[a];(f=new Trt(g.name)).order=pit(g,"order",0),f.skinRequired=pit(g,"skin",!1);for(var y=0;y<g.bones.length;y++){c=g.bones[y];if(null==(w=r.findBone(c)))throw new Error("IK bone not found: "+c);f.bones.push(w)}f.target=r.findBone(g.target),f.mix=pit(g,"mix",1),f.softness=pit(g,"softness",0)*n,f.bendDirection=pit(g,"bendPositive",!0)?1:-1,f.compress=pit(g,"compress",!1),f.stretch=pit(g,"stretch",!1),f.uniform=pit(g,"uniform",!1),r.ikConstraints.push(f)}if(i.transform)for(a=0;a<i.transform.length;a++){g=i.transform[a];(f=new Rrt(g.name)).order=pit(g,"order",0),f.skinRequired=pit(g,"skin",!1);for(y=0;y<g.bones.length;y++){c=g.bones[y];if(null==(w=r.findBone(c)))throw new Error("Transform constraint bone not found: "+c);f.bones.push(w)}var v=g.target;if(f.target=r.findBone(v),null==f.target)throw new Error("Transform constraint target bone not found: "+v);f.local=pit(g,"local",!1),f.relative=pit(g,"relative",!1),f.offsetRotation=pit(g,"rotation",0),f.offsetX=pit(g,"x",0)*n,f.offsetY=pit(g,"y",0)*n,f.offsetScaleX=pit(g,"scaleX",0),f.offsetScaleY=pit(g,"scaleY",0),f.offsetShearY=pit(g,"shearY",0),f.mixRotate=pit(g,"mixRotate",1),f.mixX=pit(g,"mixX",1),f.mixY=pit(g,"mixY",f.mixX),f.mixScaleX=pit(g,"mixScaleX",1),f.mixScaleY=pit(g,"mixScaleY",f.mixScaleX),f.mixShearY=pit(g,"mixShearY",1),r.transformConstraints.push(f)}if(i.path)for(a=0;a<i.path.length;a++){g=i.path[a];(f=new Ert(g.name)).order=pit(g,"order",0),f.skinRequired=pit(g,"skin",!1);for(y=0;y<g.bones.length;y++){c=g.bones[y];if(null==(w=r.findBone(c)))throw new Error("Transform constraint bone not found: "+c);f.bones.push(w)}v=g.target;if(f.target=r.findSlot(v),null==f.target)throw new Error("Path target slot not found: "+v);f.positionMode=w7.enumValue(J9,pit(g,"positionMode","Percent")),f.spacingMode=w7.enumValue(srt,pit(g,"spacingMode","Length")),f.rotateMode=w7.enumValue(Q9,pit(g,"rotateMode","Tangent")),f.offsetRotation=pit(g,"rotation",0),f.position=pit(g,"position",0),f.positionMode==J9.Fixed&&(f.position*=n),f.spacing=pit(g,"spacing",0),f.spacingMode!=srt.Length&&f.spacingMode!=srt.Fixed||(f.spacing*=n),f.mixRotate=pit(g,"mixRotate",1),f.mixX=pit(g,"mixX",1),f.mixY=pit(g,"mixY",f.mixX),r.pathConstraints.push(f)}if(i.skins)for(a=0;a<i.skins.length;a++){var x=i.skins[a],b=new Ort(x.name);if(x.bones)for(y=0;y<x.bones.length;y++){var w;if(null==(w=r.findBone(x.bones[y])))throw new Error("Skin bone not found: "+x.bones[a]);b.bones.push(w)}if(x.ik)for(y=0;y<x.ik.length;y++){if(null==(_=r.findIkConstraint(x.ik[y])))throw new Error("Skin IK constraint not found: "+x.ik[a]);b.constraints.push(_)}if(x.transform)for(y=0;y<x.transform.length;y++){if(null==(_=r.findTransformConstraint(x.transform[y])))throw new Error("Skin transform constraint not found: "+x.transform[a]);b.constraints.push(_)}if(x.path)for(y=0;y<x.path.length;y++){var _;if(null==(_=r.findPathConstraint(x.path[y])))throw new Error("Skin path constraint not found: "+x.path[a]);b.constraints.push(_)}for(var u in x.attachments){var T=r.findSlot(u);if(null==T)throw new Error("Slot not found: "+u);var E=x.attachments[u];for(var S in E){var I=this.readAttachment(E[S],b,T.index,S,r);I&&b.setAttachment(T.index,S,I)}}r.skins.push(b),"default"==b.name&&(r.defaultSkin=b)}a=0;for(var k=this.linkedMeshes.length;a<k;a++){var C=this.linkedMeshes[a],N=(b=C.skin?r.findSkin(C.skin):r.defaultSkin).getAttachment(C.slotIndex,C.parent);C.mesh.deformAttachment=C.inheritDeform?N:C.mesh,C.mesh.setParentMesh(N)}if(this.linkedMeshes.length=0,i.events)for(var A in i.events){var R=i.events[A];(f=new wrt(A)).intValue=pit(R,"int",0),f.floatValue=pit(R,"float",0),f.stringValue=pit(R,"string",""),f.audioPath=pit(R,"audio",null),f.audioPath&&(f.volume=pit(R,"volume",1),f.balance=pit(R,"balance",0)),r.events.push(f)}if(i.animations)for(var M in i.animations){var O=i.animations[M];this.readAnimation(O,M,r)}return r},t.prototype.readAttachment=function(t,e,n,r,i){var s=this.scale;switch(r=pit(t,"name",r),pit(t,"type","region")){case"region":var a=pit(t,"path",r),o=this.attachmentLoader.newRegionAttachment(e,r,a);return o?(o.path=a,o.x=pit(t,"x",0)*s,o.y=pit(t,"y",0)*s,o.scaleX=pit(t,"scaleX",1),o.scaleY=pit(t,"scaleY",1),o.rotation=pit(t,"rotation",0),o.width=t.width*s,o.height=t.height*s,(x=pit(t,"color",null))&&o.color.setFromString(x),o):null;case"boundingbox":var l=this.attachmentLoader.newBoundingBoxAttachment(e,r);return l?(this.readVertices(t,l,t.vertexCount<<1),(x=pit(t,"color",null))&&l.color.setFromString(x),l):null;case"mesh":case"linkedmesh":a=pit(t,"path",r);var h=this.attachmentLoader.newMeshAttachment(e,r,a);if(!h)return null;h.path=a,(x=pit(t,"color",null))&&h.color.setFromString(x),h.width=pit(t,"width",0)*s,h.height=pit(t,"height",0)*s;var u=pit(t,"parent",null);if(u)return this.linkedMeshes.push(new hit(h,pit(t,"skin",null),n,u,pit(t,"deform",!0))),h;var c=t.uvs;return this.readVertices(t,h,c.length),h.triangles=t.triangles,h.regionUVs=new Float32Array(c),h.edges=pit(t,"edges",null),h.hullLength=2*pit(t,"hull",0),h;case"path":if(!(a=this.attachmentLoader.newPathAttachment(e,r)))return null;a.closed=pit(t,"closed",!1),a.constantSpeed=pit(t,"constantSpeed",!0);var d=t.vertexCount;this.readVertices(t,a,d<<1);for(var p=w7.newArray(d/3,0),f=0;f<t.lengths.length;f++)p[f]=t.lengths[f]*s;return a.lengths=p,(x=pit(t,"color",null))&&a.color.setFromString(x),a;case"point":var m=this.attachmentLoader.newPointAttachment(e,r);return m?(m.x=pit(t,"x",0)*s,m.y=pit(t,"y",0)*s,m.rotation=pit(t,"rotation",0),(x=pit(t,"color",null))&&m.color.setFromString(x),m):null;case"clipping":var g=this.attachmentLoader.newClippingAttachment(e,r);if(!g)return null;var y=pit(t,"end",null);if(null!=y){var v=i.findSlot(y);if(null==v)throw new Error("Clipping end slot not found: "+y);g.endSlot=v}var x;d=t.vertexCount;return this.readVertices(t,g,d<<1),(x=pit(t,"color",null))&&g.color.setFromString(x),g}return null},t.prototype.readVertices=function(t,e,n){var r=this.scale;e.worldVerticesLength=n;var i=t.vertices;if(n!=i.length){var s=new Array,a=new Array;for(u=0,c=i.length;u<c;){var o=i[u++];a.push(o);for(var l=u+4*o;u<l;u+=4)a.push(i[u]),s.push(i[u+1]*r),s.push(i[u+2]*r),s.push(i[u+3])}e.bones=a,e.vertices=w7.toFloatArray(s)}else{var h=w7.toFloatArray(i);if(1!=r)for(var u=0,c=i.length;u<c;u++)h[u]*=r;e.vertices=h}},t.prototype.readAnimation=function(t,e,n){var r=this.scale,i=new Array;if(t.slots)for(var s in t.slots){var a=t.slots[s];if(-1==(ct=n.findSlotIndex(s)))throw new Error("Slot not found: "+s);for(var o in a){if(W=a[o])if("attachment"==o){for(var l=new Ynt(W.length,ct),h=0;h<W.length;h++){var u=W[h];l.setFrame(h,pit(u,"time",0),u.name)}i.push(l)}else if("rgba"==o){l=new znt(W.length,W.length<<2,ct);for(var c=pit(u=W[0],"time",0),d=y7.fromString(u.color),p=(h=0,0);;h++){if(l.setFrame(h,c,d.r,d.g,d.b,d.a),!(q=W[h+1])){l.shrink(p);break}var f=pit(q,"time",0),m=y7.fromString(q.color);(et=u.curve)&&(p=dit(et,l,p,h,0,c,f,d.r,m.r,1),p=dit(et,l,p,h,1,c,f,d.g,m.g,1),p=dit(et,l,p,h,2,c,f,d.b,m.b,1),p=dit(et,l,p,h,3,c,f,d.a,m.a,1)),c=f,d=m,u=q}i.push(l)}else if("rgb"==o){for(l=new Gnt(W.length,3*W.length,ct),c=pit(u=W[0],"time",0),d=y7.fromString(u.color),h=0,p=0;;h++){if(l.setFrame(h,c,d.r,d.g,d.b),!(q=W[h+1])){l.shrink(p);break}f=pit(q,"time",0),m=y7.fromString(q.color);(et=u.curve)&&(p=dit(et,l,p,h,0,c,f,d.r,m.r,1),p=dit(et,l,p,h,1,c,f,d.g,m.g,1),p=dit(et,l,p,h,2,c,f,d.b,m.b,1)),c=f,d=m,u=q}i.push(l)}else if("alpha"==o)i.push(uit(W,new Wnt(W.length,W.length,ct),0,1));else if("rgba2"==o){l=new Xnt(W.length,7*W.length,ct),c=pit(u=W[0],"time",0),d=y7.fromString(u.light);var g=y7.fromString(u.dark);for(h=0,p=0;;h++){if(l.setFrame(h,c,d.r,d.g,d.b,d.a,g.r,g.g,g.b),!(q=W[h+1])){l.shrink(p);break}f=pit(q,"time",0),m=y7.fromString(q.light);var y=y7.fromString(q.dark);(et=u.curve)&&(p=dit(et,l,p,h,0,c,f,d.r,m.r,1),p=dit(et,l,p,h,1,c,f,d.g,m.g,1),p=dit(et,l,p,h,2,c,f,d.b,m.b,1),p=dit(et,l,p,h,3,c,f,d.a,m.a,1),p=dit(et,l,p,h,4,c,f,g.r,y.r,1),p=dit(et,l,p,h,5,c,f,g.g,y.g,1),p=dit(et,l,p,h,6,c,f,g.b,y.b,1)),c=f,d=m,g=y,u=q}i.push(l)}else{if("rgb2"!=o)throw new Error("Invalid timeline type for a slot: "+o+" ("+s+")");for(l=new Hnt(W.length,6*W.length,ct),c=pit(u=W[0],"time",0),d=y7.fromString(u.light),g=y7.fromString(u.dark),h=0,p=0;;h++){if(l.setFrame(h,c,d.r,d.g,d.b,g.r,g.g,g.b),!(q=W[h+1])){l.shrink(p);break}f=pit(q,"time",0),m=y7.fromString(q.light),y=y7.fromString(q.dark);(et=u.curve)&&(p=dit(et,l,p,h,0,c,f,d.r,m.r,1),p=dit(et,l,p,h,1,c,f,d.g,m.g,1),p=dit(et,l,p,h,2,c,f,d.b,m.b,1),p=dit(et,l,p,h,3,c,f,g.r,y.r,1),p=dit(et,l,p,h,4,c,f,g.g,y.g,1),p=dit(et,l,p,h,5,c,f,g.b,y.b,1)),c=f,d=m,g=y,u=q}i.push(l)}}}if(t.bones)for(var v in t.bones){var x=t.bones[v],b=n.findBoneIndex(v);if(-1==b)throw new Error("Bone not found: "+v);for(var o in x){if(0!=(W=x[o]).length)if("rotate"===o)i.push(uit(W,new Mnt(W.length,W.length,b),0,1));else if("translate"===o){l=new Ont(W.length,W.length<<1,b);i.push(cit(W,l,"x","y",0,r))}else if("translatex"===o){l=new Pnt(W.length,W.length,b);i.push(uit(W,l,0,r))}else if("translatey"===o){l=new Dnt(W.length,W.length,b);i.push(uit(W,l,0,r))}else if("scale"===o){l=new Fnt(W.length,W.length<<1,b);i.push(cit(W,l,"x","y",1,1))}else if("scalex"===o){l=new Lnt(W.length,W.length,b);i.push(uit(W,l,1,1))}else if("scaley"===o){l=new Bnt(W.length,W.length,b);i.push(uit(W,l,1,1))}else if("shear"===o){l=new $nt(W.length,W.length<<1,b);i.push(cit(W,l,"x","y",0,1))}else if("shearx"===o){l=new Unt(W.length,W.length,b);i.push(uit(W,l,0,1))}else if("sheary"===o){l=new Vnt(W.length,W.length,b);i.push(uit(W,l,0,1))}}}if(t.ik)for(var w in t.ik){if(u=(U=t.ik[w])[0]){var _=n.findIkConstraint(w),T=n.ikConstraints.indexOf(_),E=(l=new Znt(U.length,U.length<<1,T),c=pit(u,"time",0),pit(u,"mix",1)),S=pit(u,"softness",0)*r;for(h=0,p=0;;h++){if(l.setFrame(h,c,E,S,pit(u,"bendPositive",!0)?1:-1,pit(u,"compress",!1),pit(u,"stretch",!1)),!(q=U[h+1])){l.shrink(p);break}f=pit(q,"time",0);var I=pit(q,"mix",1),k=pit(q,"softness",0)*r;(et=u.curve)&&(p=dit(et,l,p,h,0,c,f,E,I,1),p=dit(et,l,p,h,1,c,f,S,k,r)),c=f,E=I,S=k,u=q}i.push(l)}}if(t.transform)for(var w in t.transform){if(u=(W=t.transform[w])[0]){_=n.findTransformConstraint(w),T=n.transformConstraints.indexOf(_),l=new Jnt(W.length,W.length<<2,T),c=pit(u,"time",0);var C=pit(u,"mixRotate",1),N=pit(u,"mixX",1),A=pit(u,"mixY",N),R=pit(u,"mixScaleX",1),M=pit(u,"mixScaleY",R),O=pit(u,"mixShearY",1);for(h=0,p=0;;h++){if(l.setFrame(h,c,C,N,A,R,M,O),!(q=W[h+1])){l.shrink(p);break}f=pit(q,"time",0);var P=pit(q,"mixRotate",1),D=pit(q,"mixX",1),F=pit(q,"mixY",D),L=pit(q,"mixScaleX",1),B=pit(q,"mixScaleY",L),$=pit(q,"mixShearY",1);(et=u.curve)&&(p=dit(et,l,p,h,0,c,f,C,P,1),p=dit(et,l,p,h,1,c,f,N,D,1),p=dit(et,l,p,h,2,c,f,A,F,1),p=dit(et,l,p,h,3,c,f,R,L,1),p=dit(et,l,p,h,4,c,f,M,B,1),p=dit(et,l,p,h,5,c,f,O,$,1)),c=f,C=P,N=D,A=F,R=L,M=B,R=L,u=q}i.push(l)}}if(t.path)for(var w in t.path){var U=t.path[w];if(-1==(T=n.findPathConstraintIndex(w)))throw new Error("Path constraint not found: "+w);_=n.pathConstraints[T];for(var o in U){if(u=(W=U[o])[0])if("position"===o){l=new Qnt(W.length,W.length,T);i.push(uit(W,l,0,_.positionMode==J9.Fixed?r:1))}else if("spacing"===o){l=new trt(W.length,W.length,T);i.push(uit(W,l,0,_.spacingMode==srt.Length||_.spacingMode==srt.Fixed?r:1))}else if("mix"===o){for(l=new ert(W.length,3*W.length,T),c=pit(u,"time",0),C=pit(u,"mixRotate",1),N=pit(u,"mixX",1),A=pit(u,"mixY",N),h=0,p=0;;h++){if(l.setFrame(h,c,C,N,A),!(q=W[h+1])){l.shrink(p);break}f=pit(q,"time",0),P=pit(q,"mixRotate",1),D=pit(q,"mixX",1),F=pit(q,"mixY",D);(et=u.curve)&&(p=dit(et,l,p,h,0,c,f,C,P,1),p=dit(et,l,p,h,1,c,f,N,D,1),p=dit(et,l,p,h,2,c,f,A,F,1)),c=f,C=P,N=D,A=F,u=q}i.push(l)}}}if(t.deform)for(var V in t.deform){var z=t.deform[V],G=n.findSkin(V);if(null!=G)for(var s in z){a=z[s];if(-1==(ct=n.findSlotIndex(s)))throw new Error("Slot not found: "+a.name);for(var o in a){var W;if(u=(W=a[o])[0]){var X=G.getAttachment(ct,o);if(null==X)throw new Error("Deform attachment not found: "+W.name);var H=null!=X.bones,Y=X.vertices,j=H?Y.length/3*2:Y.length;for(l=new jnt(W.length,W.length,ct,X),c=pit(u,"time",0),h=0,p=0;;h++){var q,K=void 0,Z=pit(u,"vertices",null);if(Z){K=w7.newFloatArray(j);var J=pit(u,"offset",0);if(w7.arrayCopy(Z,0,K,J,Z.length),1!=r)for(var Q=(tt=J)+Z.length;tt<Q;tt++)K[tt]*=r;if(!H)for(var tt=0;tt<j;tt++)K[tt]+=Y[tt]}else K=H?w7.newFloatArray(j):Y;if(l.setFrame(h,c,K),!(q=W[h+1])){l.shrink(p);break}var et;f=pit(q,"time",0);(et=u.curve)&&(p=dit(et,l,p,h,0,c,f,0,1,1)),c=f,u=q}i.push(l)}}}else if(S7)throw new Error("Skin not found: "+V)}if(t.drawOrder){l=new Knt(t.drawOrder.length);var nt=n.slots.length;for(h=0,tt=0;tt<t.drawOrder.length;tt++,h++){var rt=t.drawOrder[tt],it=null,st=pit(rt,"offsets",null);if(st){it=w7.newArray(nt,-1);for(var at=w7.newArray(nt-st.length,0),ot=0,lt=0,ht=0;ht<st.length;ht++){for(var ut=st[ht],ct=n.findSlotIndex(ut.slot);ot!=ct;)at[lt++]=ot++;it[ot+ut.offset]=ot++}for(;ot<nt;)at[lt++]=ot++;for(ht=nt-1;ht>=0;ht--)-1==it[ht]&&(it[ht]=at[--lt])}l.setFrame(h,pit(rt,"time",0),it)}i.push(l)}if(t.events){for(l=new qnt(t.events.length),h=0,tt=0;tt<t.events.length;tt++,h++){var dt=t.events[tt],pt=n.findEvent(dt.name),ft=new brt(w7.toSinglePrecision(pit(dt,"time",0)),pt);ft.intValue=pit(dt,"int",pt.intValue),ft.floatValue=pit(dt,"float",pt.floatValue),ft.stringValue=pit(dt,"string",pt.stringValue),ft.data.audioPath&&(ft.volume=pit(dt,"volume",1),ft.balance=pit(dt,"balance",0)),l.setFrame(h,ft)}i.push(l)}var mt=0;for(tt=0,Q=i.length;tt<Q;tt++)mt=Math.max(mt,i[tt].getDuration());if(isNaN(mt))throw new Error("Error while parsing animation, duration is NaN");n.animations.push(new lnt(e,i,mt))},t.blendModeFromString=function(t){if("normal"==(t=t.toLowerCase()))return se.NORMAL;if("additive"==t)return se.ADD;if("multiply"==t)return se.MULTIPLY;if("screen"==t)return se.SCREEN;throw new Error("Unknown blend mode: "+t)},t}(),hit=function(t,e,n,r,i){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=r,this.inheritDeform=i};function uit(t,e,n,r){for(var i=t[0],s=pit(i,"time",0),a=pit(i,"value",n)*r,o=0,l=0;;l++){e.setFrame(l,s,a);var h=t[l+1];if(!h)return e.shrink(o),e;var u=pit(h,"time",0),c=pit(h,"value",n)*r;i.curve&&(o=dit(i.curve,e,o,l,0,s,u,a,c,r)),s=u,a=c,i=h}}function cit(t,e,n,r,i,s){for(var a=t[0],o=pit(a,"time",0),l=pit(a,n,i)*s,h=pit(a,r,i)*s,u=0,c=0;;c++){e.setFrame(c,o,l,h);var d=t[c+1];if(!d)return e.shrink(u),e;var p=pit(d,"time",0),f=pit(d,n,i)*s,m=pit(d,r,i)*s,g=a.curve;g&&(u=dit(g,e,u,c,0,o,p,l,f,s),u=dit(g,e,u,c,1,o,p,h,m,s)),o=p,l=f,h=m,a=d}}function dit(t,e,n,r,i,s,a,o,l,h){if("stepped"==t)return e.setStepped(r),n;var u=i<<2,c=t[u],d=t[u+1]*h,p=t[u+2],f=t[u+3]*h;return e.setBezier(n,r,i,s,o,c,d,p,f,a,l),n+1}function pit(t,e,n){return void 0!==t[e]?t[e]:n}var fit,mit=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ket(e,t),e.prototype.createSkeleton=function(t){this.skeleton=new Crt(t),this.skeleton.updateWorldTransform(),this.stateData=new mrt(t),this.state=new nrt(this.stateData)},e}(R7),git=function(t,e){return git=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},git(t,e)};function yit(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}git(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function vit(t){var e=t.substr(0,3),n=Math.floor(10*+e+.001);return"3.7"===e?fit.VER37:"3.8"===e?fit.VER38:"4.0"===e?fit.VER40:n<fit.VER37?fit.VER37:fit.UNKNOWN}!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.VER37=37]="VER37",t[t.VER38=38]="VER38",t[t.VER40=40]="VER40"}(fit||(fit={}));var xit=function(){function t(){this.scale=1}return t.prototype.readSkeletonData=function(t,e){var n=new e7(e);n.readString();var r=n.readString(),i=vit(r),s=null;if(i===fit.VER38&&(s=new Ftt(new vtt(t))),(n=new e7(e)).readInt32(),n.readInt32(),(i=vit(r=n.readString()))===fit.VER40&&(s=new Prt(new grt(t))),!s);return s.scale=this.scale,s.readSkeletonData(e)},t}(),bit=function(){function t(){this.scale=1}return t.prototype.readSkeletonData=function(t,e){var n=e.skeleton.spine,r=vit(n),i=null;if(r===fit.VER37&&(i=new Het(new Net(t))),r===fit.VER38&&(i=new Utt(new vtt(t))),r===fit.VER40&&(i=new lit(new grt(t))),!i);return i.scale=this.scale,i.readSkeletonData(e)},t}(),wit=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return yit(e,t),e.prototype.createBinaryParser=function(){return new xit},e.prototype.createJsonParser=function(){return new bit},e.prototype.parseData=function(t,e,n,r){var i=e;t.spineData=i.readSkeletonData(n,r),t.spineAtlas=n},e.registerLoaderPlugin=function(){fa.registerPlugin(e)},e.use=(new e).genMiddleware().use,e}(M7),_it=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return yit(e,t),e.prototype.createSkeleton=function(t){var e=vit(t.version),n=null;if(e===fit.VER37&&(n=Z),e===fit.VER38&&(n=K),e===fit.VER40&&(n=J),!n)t.version;this.skeleton=new n.Skeleton(t),this.skeleton.updateWorldTransform(),this.stateData=new n.AnimationStateData(t),this.state=new n.AnimationState(this.stateData)},e}(R7);wit.registerLoaderPlugin();class Tit extends or{constructor(){super(),this.n=0;let t=fa.shared.resources;this.animations=[];for(const e in t.spine.data.animations)this.animations.push(e);let e=t.spine.spineData;this.spine=new _it(e),this.spine.x=h8.width/2,this.spine.y=h8.height/2,this.spine.scale.set(2),this.addChild(this.spine),this.spine.interactive=!0,this.spine.buttonMode=!0,this.spine.on("pointertap",this.animation,this),this.spine.state.hasAnimation(this.animations[this.n])&&(this.spine.state.setAnimation(0,this.animations[this.n],!0),this.spine.state.timeScale=1)}animation(){this.spine.state.setAnimation(0,this.animations[this.n],!0),this.n+=1,this.n>=this.animations.length&&(this.n=0)}}class Eit extends u8{constructor(){super();let t=new est,e=new nst,n=new Qit("赤壁区-"+Eit.data.nick+"(10001)");h8.backgroundColor(65844),this.scrollbox=new J8({boxWidth:h8.width-2*e.left.width,boxHeight:h8.height+500});const r=new Qo(Yr.WHITE);r.alpha=0,r.width=h8.width-2*e.left.width,r.height=h8.height+300,r.height=h8.height,this.scrollbox.content.addChild(r),this.spine(),this.infos(),this.scrollbox.update(),this.scrollbox.y=t.height,this.scrollbox.x=e.left.width,this.addChild(this.scrollbox),this.addChild(e,t,n,new ast(Hit))}infos(){var t=Eit.data,e=4*t.lv-t.attr_atk-t.attr_hp-t.attr_mp-t.attr_spd;let n=[[{type:"text",name:"职业",value:t.lv+"级"+{1:"武士",2:"文人",3:"异人"}[t.j],style:{},calllback:()=>{}}],[{type:"text",name:"经验",value:"还需"+t.exp+"经验升级",style:{},calllback:()=>{}}],[{type:"text",name:"称号",value:"独孤求败",style:{fill:"#D4AF37"},calllback:()=>{}}],[{type:"text",name:"教派",value:"兄弟会",style:{},calllback:()=>{}}],[{type:"text",name:"魅力",value:"520000",style:{fill:"#FF6699"},calllback:()=>{}}],[{type:"text",name:"气血",value:t.struct.d.x,style:{stroke:"#d3393c",strokeThickness:8},calllback:()=>{}}],[{type:"text",name:"精力",value:t.struct.d.j,style:{stroke:"#346eed",strokeThickness:8},calllback:()=>{}}],[{type:"text",name:"攻击",value:t.struct.d.g,style:!1,calllback:()=>{}},{type:"text",name:"防御",value:"3200",style:!1,calllback:()=>{}}],[{type:"text",name:"速度",value:t.struct.d.s,style:!1,calllback:()=>{}}],[{type:"text",name:"属性点",value:e,style:!1,calllback:()=>{}},{type:"button",name:e>0?"分配":"查看",value:"",style:{butColor:e>0?16711680:5132469},calllback:()=>h8.changeScene(new Sit)}],[{type:"button",name:"查看技能",value:"",style:!1,calllback:()=>h8.changeScene(new Iit)}]];for(const t in n)for(const e in n[t]){let i=n[t][e];var r=null;if("text"==i.type){let t=Object.assign({fontSize:40},i.style);r=new rst(i.name+" : "+i.value,t)}else r=new sst(i.name,!1,i.style.butColor?i.style.butColor:5132469);r.x=30+300*Number(e),r.y=100+80*Number(t),r.on("pointertap",(()=>i.calllback()),this),this.scrollbox.content.addChild(r)}}spine(){let t=new Tit;t.x=-t.width,t.x=-200,t.y=250,t.scale.x=-1,this.addChild(t),em.to(t,{duration:1,ease:"power2.out",x:.99*h8.width})}}class Sit extends u8{constructor(){super(),this.attr={},this.attr_num=0;var t=Eit.data;Sit.data=t;let e=new est,n=new nst,r=new Qit("分配属性点");this.infos();var i=new sst("确认分配",{},16711680,(()=>{}),!0);i.x=72,i.y=.86*h8.height,this.addChild(i),i.on("pointertap",(()=>ost.send({route:["User","setAttr"],attr:this.attr})));var s=new sst("重新分配",{},5132469,(()=>{}),!0);s.x=i.x+i.width+50,s.y=i.y,this.addChild(s),s.on("pointertap",(()=>h8.changeScene(new Sit))),this.addChild(n,e,r,new ast(Eit))}structure(t){let e=new or;for(const r in t){let i=0,s=new or;for(const e in t[r]){let a=t[r][e];var n=null;if("text"==a.type){let t=Object.assign({fontSize:40},a.style);n=new rst(a.name+" "+a.value,t)}else n=new sst(a.name,a.style,a.color,(()=>{}),!1);n.x="x"in a.style?Number(a.style.x):i+Number(e),n.y=70*Number(r),i+=n.width+6,n.on("pointertap",(()=>a.calllback(n)),this),s.addChild(n)}e.addChild(s)}return e.x=80,e.y=200,e}infos(){var t=Sit.data;this.attr_num=4*t.lv-t.attr_atk-t.attr_hp-t.attr_mp-t.attr_spd,this.attr={attr_hp:0,attr_mp:0,attr_atk:0,attr_spd:0};let e=[[{type:"text",name:"目前剩于点数",value:this.attr_num,style:{fill:16185344},color:14591232,calllback:()=>{}}],[{type:"text",name:"气血",value:t.struct.d.x,style:{},color:14591232,calllback:()=>{}}],[{type:"text",name:`体质点:${t.attr_hp}`,value:"",style:{},color:14591232,calllback:()=>{}},{type:"text",name:"+",value:this.attr.attr_hp,style:{},color:14591232,calllback:()=>{}},{type:"button",name:"分配全部",value:"",style:{x:350},color:11486211,calllback:t=>this.actionAttr(t,this.attr_num,"hp")}],[{type:"button",name:" +1 ",value:0,style:{},color:5132469,calllback:t=>this.actionAttr(t,1,"hp")},{type:"button",name:" +3 ",value:0,style:{},color:5132469,calllback:t=>this.actionAttr(t,3,"hp")},{type:"button",name:" -1 ",value:0,style:{x:350},color:5132469,calllback:t=>this.actionAttr(t,-1,"hp")},{type:"button",name:" -3 ",value:0,style:{x:468},color:5132469,calllback:t=>this.actionAttr(t,-3,"hp")}],[{type:"text",name:"精力",value:t.struct.d.x,style:{},color:14591232,calllback:()=>{}}],[{type:"text",name:`智力点:${t.attr_mp}`,value:"",style:{},color:14591232,calllback:()=>{}},{type:"text",name:"+",value:this.attr.attr_mp,style:{},color:14591232,calllback:()=>{}},{type:"button",name:"分配全部",value:"",style:{x:350},color:11486211,calllback:t=>this.actionAttr(t,this.attr_num,"mp")}],[{type:"button",name:" +1 ",value:0,style:{},color:5132469,calllback:t=>this.actionAttr(t,1,"mp")},{type:"button",name:" +3 ",value:0,style:{},color:5132469,calllback:t=>this.actionAttr(t,3,"mp")},{type:"button",name:" -1 ",value:0,style:{x:350},color:5132469,calllback:t=>this.actionAttr(t,-1,"mp")},{type:"button",name:" -3 ",value:0,style:{x:468},color:5132469,calllback:t=>this.actionAttr(t,-3,"mp")}],[{type:"text",name:"攻击",value:t.struct.d.g,style:{},color:14591232,calllback:()=>{}}],[{type:"text",name:`力量点:${t.attr_atk}`,value:"",style:{},color:14591232,calllback:()=>{}},{type:"text",name:"+",value:this.attr.attr_atk,style:{},color:14591232,calllback:()=>{}},{type:"button",name:"分配全部",value:"",style:{x:350},color:11486211,calllback:t=>this.actionAttr(t,this.attr_num,"atk")}],[{type:"button",name:" +1 ",value:0,style:{},color:5132469,calllback:t=>this.actionAttr(t,1,"atk")},{type:"button",name:" +3 ",value:0,style:{},color:5132469,calllback:t=>this.actionAttr(t,3,"atk")},{type:"button",name:" -1 ",value:0,style:{x:350},color:5132469,calllback:t=>this.actionAttr(t,-1,"atk")},{type:"button",name:" -3 ",value:0,style:{x:468},color:5132469,calllback:t=>this.actionAttr(t,-3,"atk")}],[{type:"text",name:"速度",value:t.struct.d.s,style:{},color:14591232,calllback:()=>{}}],[{type:"text",name:`敏捷点:${t.attr_spd}`,value:"",style:{},color:14591232,calllback:()=>{}},{type:"text",name:"+",value:this.attr.attr_spd,style:{},color:14591232,calllback:()=>{}},{type:"button",name:"分配全部",value:"",style:{x:350},color:11486211,calllback:t=>this.actionAttr(t,this.attr_num,"spd")}],[{type:"button",name:" +1 ",value:0,style:{},color:5132469,calllback:t=>this.actionAttr(t,1,"spd")},{type:"button",name:" +3 ",value:0,style:{},color:5132469,calllback:t=>this.actionAttr(t,3,"spd")},{type:"button",name:" -1 ",value:0,style:{x:350},color:5132469,calllback:t=>this.actionAttr(t,-1,"spd")},{type:"button",name:" -3 ",value:0,style:{x:468},color:5132469,calllback:t=>this.actionAttr(t,-3,"spd")}]];this.addChild(this.structure(e))}actionAttr(t,e,n){this.attr_num-e<0||this.attr["attr_"+n]+e<0||(this.attr["attr_"+n]+=e,t.parent.parent.children[{hp:2,mp:5,atk:8,spd:11}[n]].children[1].text.text="+ "+this.attr["attr_"+n],this.attr_num-=e,t.parent.parent.children[0].children[0].children[0].text="目前剩于点数 "+this.attr_num)}}class Iit extends u8{constructor(){super();var t=Eit.data;Iit.data=t;let e=new est,n=new nst,r=new Qit("技能");this.lists(),this.addChild(n,e,r,new ast(Eit))}structure(t){let e=new or;for(const r in t){let i=0;for(const s in t[r]){let a=t[r][s];var n=null;if("text"==a.type){let t=Object.assign({fontSize:37},a.style);n=new rst(a.name+""+a.value,t)}else n=new sst(a.name,a.style,a.color,(()=>{}),!1);n.x="x"in a.style?Number(a.style.x):i+Number(s),n.y="y"in a.style?Number(a.style.y)*Number(r):86*Number(r)+6,i+=n.width+6,n.on("pointertap",(()=>a.calllback()),this),e.addChild(n)}}return e.x=80,e.y=200,e}lists(){var t=Iit.data.struct,e=[];for(let r=0;r<t.skill.length;r++){var n=t.skill[r];let i=[{type:"text",name:n.skill_name,value:`(${n.lv})级`,style:{},color:12976323,calllback:()=>{}},{type:"text",name:"熟练度:",value:n.sld,style:{},color:12976323,calllback:()=>{}},{type:"button",name:n.sld/6e3>=n.lv?"升级":"提高",value:"",style:{x:480,y:78},color:n.sld/6e3>=n.lv?16711680:5132469,calllback:()=>{var e=t.skill[r];this.addChild(new ist("确定使用"+{1:"一",2:"二",3:"三",4:"四",5:"五"}[e.lv]+"级技能书?",(()=>{ost.send({route:["goods","useVaria"],id:e.id,type:2,num:1})})))}}];e.push(i)}e.push([{type:"button",name:"学习技能",value:"",style:{},color:5132469,calllback:()=>{this.addChild(new ist("确定学习新技能?",(()=>{ost.send({route:["user","skillStudy"]})})))}}]),this.addChild(this.structure(e))}}class kit extends u8{constructor(){super();let t=new est,e=new nst;h8.backgroundColor(65844);let n=new Qit("装备");this.addChild(n);const r=new J8({boxWidth:.85*h8.width,boxHeight:h8.height}),i=r.content.addChild(new Qo(Yr.WHITE));i.width=.85*h8.width,i.height=h8.height+200,i.tint=65844;var s=new sst("我的装备");s.x=20,s.y=40,r.content.addChild(s),s.on("pointertap",(()=>{}));var a=20;["药品","装备","矿石","杂物"].forEach(((t,e)=>{var n=new sst(t,{fontSize:46,fill:6488157},14591232,(t=>{t.butWidth*=1.2}));n.x=a,n.y=120,a+=n.width+10,r.content.addChild(n),n.on("pointertap",(()=>$it.to(kit,{route:["Goods","list"],type:e})))}));let o=new Yo;o.beginFill(16777215,.8).drawRect(20,0,.8*h8.width,6),o.endFill(),o.y=200,r.content.addChild(o),this.list(r),r.update(),this.addChild(r),r.y=t.height+n.height+10,r.x=h8.width/2-r.width/2,this.addChild(e,t,new ast(Hit))}list(t){var e=new or;for(let t=0;t<kit.data.length;t++){var n=new or;n.x=20,n.y=250+70*t;let r=new rst(kit.data[t].name,{fontSize:40,fill:"#F7EDCA",stroke:"#D3393C",strokeThickness:6,lineJoin:"round"}),i=new rst("("+kit.data[t].num+")",{fontSize:40});i.x=r.width;let s=new sst("使用",{fontSize:42});s.x=450;let a=new Yo;a.beginFill(16777215,.2).drawRect(-6,-8,.8*h8.width,70),a.endFill(),t%2==0&&n.addChild(a),n.addChild(r,i,s),e.addChild(n)}t.content.addChild(e)}}class Cit{constructor(){}static fg(){let t=fa.shared.resources.fg.data.animations.fg;const e=[];for(let n=0;n<t.length;n++)e.push(Yr.from(t[n]));const n=new yu(e);return n.texture.baseTexture.scaleMode=ce.NEAREST,n.anchor.set(.5),n.animationSpeed=.3,n.loop=!1,n.play(),n.onComplete=function(){n.destroy()},n}static th(){let t=fa.shared.resources.th.data.animations.th;const e=[];for(let n=0;n<t.length;n++)e.push(Yr.from(t[n]));const n=new yu(e);return n.texture.baseTexture.scaleMode=ce.NEAREST,n.scale.set(.8),n.anchor.set(.5),n.animationSpeed=.1,n.loop=!0,n.play(),n}static tit(t){let e=fa.shared.resources.tit_m.data.animations[t];const n=[];for(let t=0;t<e.length;t++)n.push(Yr.from(e[t]));const r=new yu(n);return r.texture.baseTexture.scaleMode=ce.NEAREST,r.scale.set(.8),r.anchor.set(.5),r.animationSpeed=.1,r.loop=!0,r.play(),r}static npc_jt(){let t=fa.shared.resources.npc_jt.data.animations.npc_jt;const e=[];for(let n=0;n<t.length;n++)e.push(Yr.from(t[n]));const n=new yu(e);return n.texture.baseTexture.scaleMode=ce.NEAREST,n.scale.set(.8),n.anchor.set(.5),n.animationSpeed=.1,n.loop=!0,n.play(),n}static blood(){let t=fa.shared.resources.blood.data.animations.blood;const e=[];for(let n=0;n<t.length;n++)e.push(Yr.from(t[n]));const n=new yu(e);return n.texture.baseTexture.scaleMode=ce.NEAREST,n.scale.x=n.scale.y=1.3,n.anchor.set(.5),n.animationSpeed=.23,n.loop=!1,n.play(),n.onComplete=function(){n.destroy()},n}static bloodNumAnimation(t="P1",e=-1){var n=e.toString();const r=new or;if(e>0)var i={P2:{max:-30,min:-15},P1:{max:-5,min:-4}};else i={P2:{max:-35,min:-15},P1:{max:-10,min:-4}};r.x=i[t].min+-Math.abs(i[t].max-i[t].min)/6*n.length,r.y=-6;for(let t=0;t<n.length;t++){let i=Qo.from((e>0?"+":"-")+n[t]);i.scale.x=i.scale.y=.2,i.x=7.5*t,i.y=0;let s=em.timeline();s.to(i,{y:-8,duration:.05*t}),s.to(i,{y:-4,duration:.05*t}),s.to({},{duration:.45}).eventCallback("onComplete",(()=>{r.destroy()})),r.addChild(i)}return r}static wlhd(){let t=fa.shared.resources.skill_wlhd.data.animations.skill_wlhd;const e=[];for(let n=0;n<t.length;n++)e.push(Yr.from(t[n]));const n=new yu(e);return n.texture.baseTexture.scaleMode=ce.NEAREST,n.scale.x=n.scale.y=.8,n.anchor.set(.5),n.animationSpeed=.2,n.loop=!1,n.play(),n.onComplete=function(){n.destroy()},n}static hfhy(){let t=fa.shared.resources.skill_hfhy.data.animations.skill_hfhy;const e=[];for(let n=0;n<t.length;n++)e.push(Yr.from(t[n]));const n=new yu(e);return n.texture.baseTexture.scaleMode=ce.NEAREST,n.scale.x=n.scale.y=2,n.anchor.set(.5),n.animationSpeed=.2,n.loop=!1,n.play(),n.onComplete=function(){n.destroy()},n}static psdh(){let t=fa.shared.resources.skill_psdh.data.animations.psdh;const e=[];for(let n=0;n<t.length;n++)e.push(Yr.from(t[n]));const n=new yu(e);return n.texture.baseTexture.scaleMode=ce.NEAREST,n.scale.x=3,n.scale.y=3.5,n.anchor.set(.5),n.animationSpeed=.3,n.loop=!1,n.play(),n.onComplete=function(){n.destroy()},n}static lphs(){let t=fa.shared.resources.skill_pi.data.animations.pi;const e=[];for(let n=0;n<t.length;n++)e.push(Yr.from(t[n]));const n=new yu(e);return n.texture.baseTexture.scaleMode=ce.NEAREST,n.scale.x=n.scale.y=1,n.anchor.set(.5),n.animationSpeed=.2,n.loop=!1,n.play(),n.onComplete=function(){n.destroy()},n}static map_zz(){let t=fa.shared.resources.map_zz.data.animations.map_zz;const e=[];for(let n=0;n<t.length;n++)e.push(Yr.from(t[n]));const n=new yu(e);return n.texture.baseTexture.scaleMode=ce.NEAREST,n.scale.set(1),n.anchor.set(.5),n.animationSpeed=.2,n.loop=!0,n.play(),n.x=26,n.y=26,n}static dead(t="P1"){let e=fa.shared.resources.dead_fl.data.animations.dead_fl;const n=[];for(let t=0;t<e.length;t++)n.push(Yr.from(e[t]));const r=new yu(n);return r.texture.baseTexture.scaleMode=ce.NEAREST,r.scale.x=r.scale.y=1,r.anchor.set(.5),r.animationSpeed=.33333,r.loop=!1,r.play(),r.x="P1"==t?10:-10,r.y=20,r.onComplete=function(){r.destroy()},r}static dead_all(t="P1"){let e=fa.shared.resources.dead_all.data.animations.dead_all;const n=[];for(let t=0;t<e.length;t++)n.push(Yr.from(e[t]));const r=new yu(n);return r.texture.baseTexture.scaleMode=ce.NEAREST,r.scale.x=r.scale.y=.85,r.anchor.set(.5),r.animationSpeed=.5,r.loop=!1,r.play(),r.x="P1"==t?10:-10,r.y=20,r.onComplete=function(){r.destroy()},r}static fg_3(){let t=fa.shared.resources.fg_3.data.animations.fg_3;const e=[];for(let n=0;n<t.length;n++)e.push(Yr.from(t[n]));const n=new yu(e);return n.texture.baseTexture.scaleMode=ce.NEAREST,n.scale.x=n.scale.y=1,n.anchor.set(.5),n.animationSpeed=.3,n.loop=!1,n.play(),n.onComplete=function(){n.destroy()},n}static fg_2(){let t=fa.shared.resources.fg_2.data.animations.fg_2;const e=[];for(let n=0;n<t.length;n++)e.push(Yr.from(t[n]));const n=new yu(e);return n.texture.baseTexture.scaleMode=ce.NEAREST,n.scale.x=n.scale.y=1,n.anchor.set(.5),n.animationSpeed=.3,n.loop=!1,n.play(),n.onComplete=function(){n.destroy()},n}}class Nit{constructor(t){switch(this.tl=em.timeline(),this.data=t,parseInt(t.sk)){case 0:this.ptgj();break;case 1:this.psdh();break;case 2:this.smyj();break;case 3:case 4:case 5:this.fg3();break;case 6:this.wlhd();break;case 7:case 71:this.wgjd();break;case 8:this.hfhy();break;case 9:this.lphs();break;case 10:case 11:case 12:case 13:this.fg2()}return this.resetStage(),this}timeline(){return this.tl}static getStartX(t){let e=t.pk_g.p.toLocaleUpperCase();var n=0;return-1==[0,71].indexOf(parseInt(t.sk))&&(n=(h8.width/2-100)*("P1"==e?1:-1)),n}resetStage(){let t=Mit.T;this.tl.add(em.to(t,{duration:1e-5,x:0}).eventCallback("onComplete",(()=>{Mit.GameBg.display(!0),this.bloodAnimation(this.data.pk_s),this.bloodAnimation(this.data.pk_g)}))),this.tl.add(em.to({},{duration:.35}))}static skillBuff(t){var e={3:0,4:3,5:1,7:4,10:7,11:6};return t in e?e[t]:0}bloodAnimation(t){let e=Mit.T;for(const i in t.ps){var n=t.ps[i];let s=t.p.toLocaleUpperCase();if(0!=n.blood_hurt&&e.PP[s][n.n].addChild(Cit.bloodNumAnimation(s,n.blood_hurt)),n.blood_end<=0){if(e.PP[s][n.n].setVisible(!1),e.PP[s][n.n].addChild(Cit.dead_all(s)),"NPC"==Mit.gameType&&"P1"==s)var r=Qo.from("dead_2");else r=Qo.from("dead_"+(0==n.n?"1":"2"));"P1"==s&&(r.position.x=0-r.width/2,r.scale.x*=-1),r.x=24*("P1"==s?1:-1),r.y=25,r.texture.baseTexture.scaleMode=ce.NEAREST,e.PP[s][n.n].addChild(r)}}}static shock(t=em.timeline(),e=.04){t.add(em.to({},{duration:e}).eventCallback("onComplete",(()=>{h8.currentScene.y+=6}))),t.add(em.to({},{duration:e}).eventCallback("onComplete",(()=>{h8.currentScene.y-=6})))}static bgShock(t=em.timeline(),e=.06){t.add(em.to({},{duration:.02}).eventCallback("onComplete",(()=>{Mit.GameBg.display(!0,"bg")}))),t.add(em.to({},{duration:e}).eventCallback("onComplete",(()=>{Mit.GameBg.display(!1,"bg")})))}static skillStart(t,e){let n=e.pk_g.p.toLocaleUpperCase(),r=e.pk_g.n;var i=Mit.T,s=em.timeline();return s.add(em.to({},{duration:1e-5}).eventCallback("onComplete",(()=>{em.to(i,{duration:.4,ease:"none",x:t}),em.to({},{delay:e.sk in Nit.sikllWait?.3:.4,duration:1e-5}).eventCallback("onComplete",(()=>{let t=Cit.fg();t.y=18,t.x="P1"==n?10:-10,t.zIndex=10,i.PP[n][r].addChild(t),Nit.bgShock()}))}))),s.add(em.to({},{duration:e.sk in Nit.sikllWait?.5:.9})),s}ptgj(){let t=Mit.T,e=this.data,n="P1"==e.pk_g.p.toLocaleUpperCase()?1:-1,r=t.PP[e.pk_g.p.toLocaleUpperCase()][e.pk_g.n],i=t.PP[e.pk_s.p.toLocaleUpperCase()][e.pk_s.n],s=r.x,a=r.y;this.tl.add(em.to({},{duration:.02}).eventCallback("onComplete",(()=>{r.struct.foot.texture=Yr.from(r.data.pe.foot+"_run")}))),this.tl.add(em.to(r,{duration:Math.abs(i.x+125-i.x)/600,x:i.x+125*-n,y:i.y,ease:"none"}).eventCallback("onComplete",(()=>{r.struct.body.texture=Yr.from(r.data.pe.body+"_run"),i.struct.header.x+=2*n}))),this.tl.add(em.to({},{duration:.02}).eventCallback("onComplete",(()=>{let t=Cit.blood();t.y=18,t.scale.x=n,i.addChild(t)}))),this.tl.add(em.to({},{duration:.25}).eventCallback("onComplete",(()=>{r.struct.body.texture=Yr.from(r.data.pe.body),i.struct.header.x-=2*n}))),this.tl.add(em.to(r,{duration:1e-5}).eventCallback("onComplete",(()=>{em.to(r,{duration:.25,x:s,y:a,ease:"none"}),em.to(r,{duration:.2}).eventCallback("onComplete",(()=>{r.struct.foot.texture=Yr.from(r.data.pe.foot)}))})))}wgjd(){let t=Mit.T,e=this.data,n="P1"==e.pk_g.p.toLocaleUpperCase()?1:-1;Mit.GameBg.display(!1,"bg"),7==parseInt(e.sk)&&(this.tl.add(em.to({},{duration:.02}).eventCallback("onComplete",(()=>{h8.backgroundColor(21248)}))),this.tl.add(em.to({},{duration:.5}).eventCallback("onComplete",(()=>{h8.backgroundColor(16717568)}))),this.tl.add(em.to({},{duration:.02}).eventCallback("onComplete",(()=>{h8.backgroundColor(14605535)})))),this.tl.add(em.to({},{duration:.02}).eventCallback("onComplete",(()=>{7==parseInt(e.sk)&&h8.backgroundColor(21248);for(const i in this.data.pk_s.ps){var r=this.data.pk_s.ps[i];let s=t.PP[e.pk_s.p.toLocaleUpperCase()][r.n];s.struct.header.x+=2*-n,s.struct.body.x-=2*-n}}))),this.tl.add(em.to({},{duration:.5}).eventCallback("onComplete",(()=>{h8.backgroundColor(0)}))),this.tl.add(em.to({},{duration:0}).eventCallback("onComplete",(()=>{for(const i in this.data.pk_s.ps){var r=this.data.pk_s.ps[i];let s=t.PP[e.pk_s.p.toLocaleUpperCase()][r.n];s.struct.header.x-=2*-n,s.struct.body.x+=2*-n}})))}hfhy(){let t=Mit.T,e=this.data,n="P1"==e.pk_g.p.toLocaleUpperCase()?1:-1;this.tl.add(em.to({},{duration:.1}).eventCallback("onComplete",(()=>{}))),this.tl.add(em.to({},{duration:0}).eventCallback("onComplete",(()=>{let r=Cit.hfhy();r.x=1==n?300:380,r.scale.x*=-n,r.y=400,h8.currentScene.addChild(r);for(const r in this.data.pk_s.ps){var i=this.data.pk_s.ps[r];t.PP[e.pk_s.p.toLocaleUpperCase()][i.n].struct.header.x+=2*n}}))),this.tl.add(em.to({},{duration:.02}).eventCallback("onComplete",(()=>{for(const i in this.data.pk_s.ps){var r=this.data.pk_s.ps[i];let s=t.PP[e.pk_s.p.toLocaleUpperCase()][r.n],a=Cit.blood();a.y=14,a.x=20*-n,a.scale.x=-n,s.addChild(a)}}))),this.tl.add(em.to({},{duration:.68})),this.tl.add(em.to({},{duration:0}).eventCallback("onComplete",(()=>{for(const i in this.data.pk_s.ps){var r=this.data.pk_s.ps[i];t.PP[e.pk_s.p.toLocaleUpperCase()][r.n].struct.header.x-=2*n}})))}fg2(){let t=Mit.T,e=this.data,n="P1"==e.pk_g.p.toLocaleUpperCase()?1:-1;this.tl.add(em.to({},{duration:.02}).eventCallback("onComplete",(()=>{for(const i in this.data.pk_s.ps){var r=this.data.pk_s.ps[i];let s=t.PP[e.pk_s.p.toLocaleUpperCase()][r.n],a=Cit.fg_2();a.x=10*n,a.y=30,s.addChild(a)}}))),this.tl.add(em.to({},{duration:.5}))}fg3(){let t=Mit.T,e=this.data;this.tl.add(em.to({},{duration:.02}).eventCallback("onComplete",(()=>{for(const r in this.data.pk_s.ps){var n=this.data.pk_s.ps[r];let i=t.PP[e.pk_s.p.toLocaleUpperCase()][n.n],s=Cit.fg_3();s.x=10,s.y=30,i.addChild(s)}}))),this.tl.add(em.to({},{duration:.6}))}smyj(){let t=Mit.T,e=this.data,n="P1"==e.pk_g.p.toLocaleUpperCase()?1:-1,r=t.PP[e.pk_g.p.toLocaleUpperCase()][e.pk_g.n],i=t.PP[e.pk_s.p.toLocaleUpperCase()][e.pk_s.n],s=i.x,a=i.y;var o=new Yo;o.beginFill(11447470),o.drawRect(0,0,200,6),o.endFill(),o.scale.x=-.2*n,o.scale.y=-.2*n,o.x=-30*n,o.y=19,this.tl.add(em.to({},{duration:.001}).eventCallback("onComplete",(()=>{i.addChild(o)}))),this.tl.add(em.to(o,{x:74*n,ease:"power4.in",alpha:.8,duration:.1})),this.tl.add(em.to({},{duration:.03}).eventCallback("onComplete",(()=>{Mit.GameBg.display(!0,"bg")}))),this.tl.add(em.to(o,{alpha:.4,duration:.05}).eventCallback("onComplete",(()=>{o.destroy()}),[o])),this.tl.add(em.to({},{duration:.06}).eventCallback("onComplete",(()=>{Mit.GameBg.display(!1,"bg")})));let l=r.x,h=r.y;this.tl.add(em.to({},{duration:0}).eventCallback("onComplete",(()=>{r.x=s+180*n,r.y=a,r.struct.body.texture=Yr.from(r.data.pe.body+"_run"),r.struct.foot.texture=Yr.from(r.data.pe.foot+"_run"),i.struct.header.x-=5*n}))),this.tl.add(em.to({},{duration:.02}).eventCallback("onComplete",(()=>{let t=Cit.blood();t.y=18,t.scale.x=n,i.addChild(t);let e=Cit.blood();e.y=18,e.scale.x=-1*n,r.addChild(e)}))),this.tl.add(em.to({},{duration:.68})),this.tl.add(em.to({},{duration:0}).eventCallback("onComplete",(()=>{r.x=l,r.y=h,r.struct.body.texture=Yr.from(r.data.pe.body),r.struct.foot.texture=Yr.from(r.data.pe.foot),i.struct.header.x+=5*n})))}lphs(){let t=Mit.T,e=this.data,n="P1"==e.pk_g.p.toLocaleUpperCase()?1:-1,r=t.PP[e.pk_g.p.toLocaleUpperCase()][e.pk_g.n],i=t.PP[e.pk_s.p.toLocaleUpperCase()][e.pk_s.n],s=r.x,a=r.y;this.tl.add(em.to({},{duration:.1})),this.tl.add(em.to({},{duration:0}).eventCallback("onComplete",(()=>{let t=Cit.lphs();t.x=1==n?16:40,t.y=25,i.addChild(t),r.visible=!1,Nit.shock(em.timeline(),.08),Nit.bgShock(em.timeline())}))),this.tl.add(em.to({},{duration:.1}).eventCallback("onComplete",(()=>{r.visible=!0,r.x=i.x-100*n,r.y=i.y,r.struct.foot.texture=Yr.from(r.data.pe.foot+"_run"),r.struct.foot.x+=8*n}))),this.tl.add(em.to(r,{duration:.5,x:i.x-500*n,ease:"none"})),this.tl.add(em.to({},{duration:.02}).eventCallback("onComplete",(()=>{r.x=s,r.y=a,r.struct.foot.texture=Yr.from(r.data.pe.foot),r.struct.foot.x-=8*n})))}psdh(){let t=Mit.T,e=this.data,n="P1"==e.pk_g.p.toLocaleUpperCase()?1:-1;this.tl.add(em.to({},{duration:.1}).eventCallback("onComplete",(()=>{}))),this.tl.add(em.to({},{duration:0}).eventCallback("onComplete",(()=>{let r=Cit.psdh();r.x=1==n?300:380,r.scale.x*=-n,r.y=500,h8.currentScene.addChild(r);for(const r in this.data.pk_s.ps){var i=this.data.pk_s.ps[r];let s=t.PP[e.pk_s.p.toLocaleUpperCase()][i.n];s.struct.header.x+=2*n,em.to(s.struct.header,{duration:.05,x:s.struct.header.x-4*n,ease:"none",repeat:5,yoyo:!0}).eventCallback("onComplete",(()=>{s.struct.header.x-=2*n}))}}))),this.tl.add(em.to({},{duration:.02}).eventCallback("onComplete",(()=>{for(const i in this.data.pk_s.ps){var r=this.data.pk_s.ps[i];let s=t.PP[e.pk_s.p.toLocaleUpperCase()][r.n],a=Cit.blood();a.y=14,a.x=20*-n,a.scale.x=-n,s.addChild(a)}}))),this.tl.add(em.to({},{duration:.68}))}wlhd(){let t=Mit.T,e=this.data,n="P1"==e.pk_g.p.toLocaleUpperCase()?1:-1,r=t.PP[e.pk_s.p.toLocaleUpperCase()][e.pk_s.n],i=[{t:1e-4,x:10*n*-1,y:10},{t:.2,x:28*n*-1,y:-15},{t:.16,x:28*n*-1,y:10},{t:.3,x:-8*n*-1,y:15},{t:.18,x:28*n*-1,y:10}];for(let t=0;t<i.length;t++)this.tl.add(em.to({},{duration:i[t].t}).eventCallback("onComplete",(()=>{let e=Cit.wlhd();if(e.x=i[t].x,e.y=i[t].y,r.addChild(e),r.struct.header.x=t%2==0?2:-2,0==t){let t=em.timeline();for(let e=0;e<3;e++)Nit.shock(t)}})));this.tl.add(em.to(r.struct.header,{duration:1e-5,x:0})),this.tl.add(em.to({},{duration:.3}))}}Nit.skillSpend={6:.55,8:.4,10:null,11:null,12:null},Nit.sikllWait={6:0,8:0};class Ait extends or{constructor(t,e={}){super(),this.struct={body:Qo,header:Qo,foot:Qo,bloodBg:Qo,hp:Qo,mp:Qo},this.zoom=3.5,this.run=!1,this.alive=!0,this.buff=new or,this.HMPLEN=150,this.data=t,this.struct=[];for(const[e,n]of Object.entries(this.data.pe))this.struct[e]=this.from(n,t.scale),this.addChild(this.struct[e]);this.struct.body.y=this.struct.header.height,this.addChild(this.bloodContainer(t.scale)),this.setBuffContainer(),this.scale.x*=this.zoom,this.scale.y*=this.zoom;const n=new Yo;n.beginFill(65535),n.drawRect(0,0,30,40),n.endFill(),n.alpha=0,n.x="P1"==this.data.T?-4:-26,this.addChild(n),n.interactive=!0,n.on("pointertap",(()=>e.onSelected(this.data)),this)}from(t,e){let n=Qo.from(t);return n.scale.x*=e,n.texture.baseTexture.scaleMode=ce.NEAREST,n}bloodContainer(t){let e=new or;return e.addChild(this.bloodBg()),e.addChild(this.hp()),e.addChild(this.mp()),e.scale.x*=t,e.x=-8*t,e.y=-12,this.blood=e,e}setBuffContainer(){this.buff=new or,this.buff.scale.set(.8),em.to(this.buff,{duration:.25,y:this.buff.y+3,ease:"none",repeat:1e5,yoyo:!0}),this.addChild(this.buff)}bloodBg(){let t=Qo.from("hpmp_bg");return t.scale.x=.4,t.scale.y=.5,t.texture.baseTexture.scaleMode=ce.NEAREST,this.struct.bloodBg=t,t}hp(){let t=Qo.from("home_hp");return t.scale.x=.216,t.scale.y=.28,t.y=3,t.x=.3,t.texture.baseTexture.scaleMode=ce.NEAREST,t.mask=this.HPMask=this.getHPMask(1),t.addChild(t.mask),this.struct.hp=t,t}setHPMask(t){this.HPMask.destroy(),this.struct.hp.mask=this.HPMask=this.getHPMask(t),this.struct.hp.addChild(this.struct.hp.mask)}getHPMask(t){let e=new Yo;return e.beginFill(16711680),e.drawRect(0,0,this.HMPLEN*t,12.5),e.endFill(),e.y=1.1,e}mp(){let t=Qo.from("home_mp");t.scale.x=.216,t.scale.y=.32,t.y=6.86,t.x=3.1,t.texture.baseTexture.scaleMode=ce.NEAREST;let e=new Yo;return e.beginFill(255),e.drawRect(0,0,this.HMPLEN,12.05),e.endFill(),e.y=1.5,t.mask=e,t.addChild(e),this.struct.mp=t,t}setVisible(t){this.alive=t;for(const e in this.struct)this.struct[e].visible=t}}class Rit extends or{constructor(t,e){super(),this.PP={P1:[],P2:[]},this.GameScene=t,this.sortableChildren=!0;let n="back.Out",r=120,i=Rit.edgeX+10;var s=[{x:i,y:0},{x:i+r,y:80},{x:i,y:160},{x:i+r,y:240}];for(const r in e.P1){let i=e.P1[r],a=new Ait({sex:1,n:Number(r),T:"P1",scale:1,pe:{header:i+"_h",foot:i+"_f",body:i+"_b"}},t);a.x=s[Number(r)].x-200,a.y=80*Number(r)+50,this.PP.P1[r]=a,this.addChild(a),setTimeout((()=>{em.to(a,{duration:.3,ease:n,x:s[Number(r)].x})}),10),em.to(a.struct.body.scale,{duration:.25,y:1.2*a.struct.body.scale.y,ease:"none",repeat:1e5,yoyo:!0})}let a=h8.width-Rit.edgeX;var o=[{x:a-r,y:0},{x:a,y:80},{x:a-r,y:160},{x:a,y:240}];for(const r in e.P2){let i=e.P2[r],s=new Ait({sex:1,n:Number(r),T:"P2",scale:-1,pe:{header:i+"_h",foot:i+"_f",body:i+"_b"}},t);s.x=o[Number(r)].x+200,s.y=80*Number(r)+50,this.PP.P2[r]=s,this.addChild(s),setTimeout((()=>{em.to(s,{duration:.3,ease:n,x:o[Number(r)].x})}),10),em.to(s.struct.body.scale,{duration:.25,y:1.2*s.struct.body.scale.y,ease:"none",repeat:1e5,yoyo:!0})}}}Rit.edgeX=30;class Mit extends u8{constructor(t){super(),this.team_data={},this.current_select_action_index=0,this.current_select_skill_index=0,this.current_select_skill_no=0,this.current_select_person_index=0,this.current_select_person_p="P1",this.selectedPersonContainer=new or,this.current_select_skill={},this.select_skills=[],this.backButton=Qo.from("but"),this.skillContainer=new or,this.menuContainer=new or,this.runData={startX:0,startDuration:0},this.addChild(Mit.GameBg=new Oit),this.addChild(Mit.GameHeader=new Pit),this.addChild(this.back()),this.addChild(this.menu()),this.addChild(h8.chat),Mit.map_zz=Cit.map_zz(),Mit.f_jt=Qo.from("f_jt"),Mit.f_jt.position.x=0-Mit.f_jt.width/2,Mit.f_jt.scale.x*=-.2,Mit.f_jt.scale.y*=.2,Mit.f_jt.y=10,this.team_data=t;var e={P1:[],P2:[]};for(const t in this.team_data){var n=[];for(let e=0;e<this.team_data[t].length;e++){var r=this.team_data[t][e];r.z&&(r.lv=""),n.push(r.c+r.j+r.sex+r.z+r.lv)}e[t.toLocaleUpperCase()]=n}let i=new Rit(this,e);Mit.T=i,i.y=200,this.addChild(i),Mit.T.PP.P2[this.current_select_action_index].addChild(Mit.f_jt),em.to({},{duration:.2}).eventCallback("onComplete",(()=>{}));let s=new sst("test");s.x=50,s.y=.92*h8.height;var a=!0;s.on("pointertap",(()=>{var t=Mit.T;for(let n=0;n<t.PP.P2.length;n++){var e=t.PP.P2[n];e.struct.foot.texture=Yr.from(e.data.pe.foot+(a?"_run":"")),e.struct.body.texture=Yr.from(e.data.pe.body+(a?"_run":"")),e.struct.header.x+=5*(a?-1:1)}a=!a}),this);let o=new sst("TL");o.x=280,o.y=.92*h8.height,o.on("pointertap",(()=>{this.playGame()}),this)}getSkillP(t){var e="P1";switch(t){case 10:case 11:case 12:case 13:e="P2"}return e}selectPeople(){var t=this.current_select_skill;this.skillContainer.visible=!1,this.selectedPersonContainer.destroy(),this.selectedPersonContainer=new or,this.selectedPersonContainer.interactive=!0,this.selectedPersonContainer.on("pointertap",(()=>this.ConfirmSelection())),this.current_select_skill_no=t.sk;var e=this.team_data[this.current_select_person_p.toLocaleLowerCase()][this.current_select_person_index].d;let n=Qo.from("row_skill");var r;n.texture.baseTexture.scaleMode=ce.NEAREST,n.scale.x=n.scale.y=1.1,this.selectedPersonContainer.addChild(n),(r=new rst(t.skill_name,{fontSize:36,fill:16776960})).x=this.selectedPersonContainer.width/2-r.width/2,r.y=30,this.selectedPersonContainer.addChild(r),(r=new rst("独孤求败",{fontSize:36,fill:16777215})).x=this.selectedPersonContainer.width/2-r.width/2,r.y=70,this.selectedPersonContainer.addChild(r),(r=new rst("血: "+e.x,{fontSize:36,fill:16711680})).x=25,r.y=130,this.selectedPersonContainer.addChild(r),(r=new rst("精: "+e.j,{fontSize:36,fill:97983})).x=25,r.y=176,this.selectedPersonContainer.addChild(r),(r=new rst("速度: "+e.s,{fontSize:36,fill:9055202})).x=25,r.y=222,this.selectedPersonContainer.addChild(r),Mit.map_zz.visible=!0,Mit.map_zz.x="P1"==this.current_select_person_p?26:-30,Mit.map_zz.scale.x="P1"==this.current_select_person_p?1:-1,Mit.T.PP[this.current_select_person_p][this.current_select_person_index].addChild(Mit.map_zz),this.bloodBarOne(this.current_select_person_p,this.current_select_person_index),this.selectedPersonContainer.x=h8.width/2-this.selectedPersonContainer.width/2,this.selectedPersonContainer.y=270,this.addChild(this.selectedPersonContainer)}onSelected(t){1!=Mit.Playing&&null!=Mit.selectedFunctionIndex&&(t.n==this.current_select_person_index?this.ConfirmSelection():(this.current_select_person_index=t.n,this.selectPeople()))}getAliveIndex(t){if("P2"==t.toLocaleUpperCase())return 0;for(var e in this.team_data.p1)if(this.team_data.p1[e].d.x>0)return Number(e);return 0}ConfirmSelection(){if(this.select_skills.push({index:this.current_select_person_index,sikll:this.current_select_skill_no}),Mit.selectedFunctionIndex=null,this.backButton.visible=!1,this.select_skills.length>=this.team_data.p2.length){this.selectedPersonContainer.visible=!1;let t=[],e=[];for(let n=0;n<this.select_skills.length;n++){let r=this.select_skills[n];t.push(r.index.toString()),e.push(r.sikll.toString())}let n={NPC:["Npc","actionGame"],GAME:["User","actionGame"]};ost.send({route:n[Mit.gameType],data:t,skill:e})}else this.current_select_action_index++,this.team_data.p2[this.current_select_action_index].d.x<=0?this.ConfirmSelection():(Mit.T.PP.P2[this.current_select_action_index].addChild(Mit.f_jt),this.bloodBarAll(!0),this.selectedPersonContainer.visible=!1,this.selectedPersonContainer.destroy(),this.menuContainer.visible=!0,Mit.map_zz.visible=!1)}back(){this.backButton.x=20,this.backButton.y=630,this.backButton.scale.set(1.2),this.backButton.visible=!1;let t=new rst("返回",{fill:[0],fontSize:34});return t.x=10,t.y=8,this.backButton.addChild(t),this.backButton.interactive=!0,this.backButton.on("pointertap",(()=>{Mit.T.PP.P2[this.current_select_action_index].addChild(Mit.f_jt),this.bloodBarAll(!0),this.selectedPersonContainer.visible=!1,this.selectedPersonContainer.destroy(),this.menuContainer.visible=!0,Mit.map_zz.visible=!1,this.skillContainer.visible=!1,this.backButton.visible=!1})),this.backButton}skill(){this.menuContainer.visible=!1,this.bloodBarAll(!1),this.skillContainer=new or;let t=Qo.from("select_skill");t.scale.x=1.7,t.scale.y=2.2,t.texture.baseTexture.scaleMode=ce.NEAREST,this.skillContainer.addChild(t);var e=this.team_data;let n=new rst("选择技能",{fontSize:32,fill:16750899});n.x=t.width/2-n.width/2,n.y=24;var r=[];for(let n=0;n<e.p2[this.current_select_action_index].skill.length;n++){let i=e.p2[this.current_select_action_index].skill[n],s=new rst(i.skill_name,{fontSize:42,fill:16776960});s.x=t.width/2-s.width/2,s.y=70+60*n,s.on("pointertap",(()=>{Mit.selectedFunctionIndex=1,this.current_select_skill_index=n,this.current_select_skill=i,this.current_select_person_p=this.getSkillP(i.sk),this.current_select_person_index=this.getAliveIndex(this.current_select_person_p),this.selectPeople()})),r.push(s)}this.skillContainer.addChild(n,...r),this.skillContainer.x=h8.width/2-this.skillContainer.width/2-10,this.skillContainer.y=240,this.addChild(this.skillContainer)}menu(){var t=["攻击","技能","招降","物品","招将","逃跑","防御"];for(let e=0;e<t.length;e++){let n=new or;n.interactive=!0,n.x=e%2==0?-10:78,n.y=46*e;let r=Qo.from("home_button");r.scale.x=1.2,r.scale.y=1.2;let i=new rst(t[e],{fontSize:35});i.x=10,i.y=24,n.addChild(r,i),n.on("pointertap",(()=>{switch(this.backButton.visible=!0,e){case 0:this.menuContainer.visible=!1,Mit.selectedFunctionIndex=0,this.current_select_person_p=this.getSkillP(-1),this.current_select_person_index=this.getAliveIndex(this.current_select_person_p),this.current_select_skill={sk:0,skill_name:"普通攻击"},this.selectPeople();break;case 1:this.skill();break;case 6:this.current_select_skill_no=-1,this.ConfirmSelection()}})),this.menuContainer.addChild(n)}return this.menuContainer.x=300,this.menuContainer.y=230,this.menuContainer}static bloodRate(){let t=h8.currentScene.team_data;for(const n in t)for(var e=0;e<t[n].length;e++){let r=t[n][e];Mit.T.PP[n.toLocaleUpperCase()][e].setHPMask(r.d.x/r.d.x_)}}bloodBarAll(t=!1){for(const e in Mit.T.PP)for(let n=0;n<Mit.T.PP[e].length;n++)Mit.T.PP[e][n].blood.visible=t}bloodBarOne(t,e=0,n=!0){this.bloodBarAll(),Mit.T.PP[t][e].blood.visible=n}buff(t=!0){for(const e in this.team_data)for(let n=0;n<this.team_data[e].length;n++){let r=this.team_data[e][n];if(em.killTweensOf(Mit.T.PP[e.toLocaleUpperCase()][n].buff),Mit.T.PP[e.toLocaleUpperCase()][n].buff.destroy(),0!=t){Mit.T.PP[e.toLocaleUpperCase()][n].setBuffContainer();for(const t in r.buff){let i=Qo.from("buff"+Nit.skillBuff(r.buff[t].sk));"p2"==e?(i.scale.x=-1,i.x=5+12*Number(t)):(i.scale.x=1,i.x=-8-12*Number(t)),Mit.T.PP[e.toLocaleUpperCase()][n].buff.addChild(i)}}}}playGame(){Mit.Playing=!0;let t=Mit.T;var e=em.timeline();this.menuContainer.visible=!1,this.bloodBarAll(!1);for(let r=0;r<Mit.round.length;r++){let i=Mit.round[r];e.add(em.to({},{duration:1e-5}).eventCallback("onComplete",(()=>{i.sk>0&&Mit.GameBg.display(!1),Mit.GameHeader.updateTitle(i.sk_name)}))),this.runData.startX=Nit.getStartX(i),-1==[0,71].indexOf(parseInt(i.sk))&&e.add(Nit.skillStart(this.runData.startX,i));var n=Nit.skillSpend[i.sk];null!==n&&e.add(em.to(t,{duration:n,ease:"none",x:-1*this.runData.startX})),e.add(new Nit(i).timeline())}e.add(em.to({},{duration:.1}).eventCallback("onComplete",(()=>{Mit.Playing=!1,this.readyNextRound()})))}readyRunGame(){this.current_select_action_index=0,Mit.f_jt.visible=!1,Mit.map_zz.visible=!1,Mit.GameHeader.StopCountDown(),this.buff(!1),this.select_skills=[]}readyNextRound(){Mit.f_jt.visible=!0,Mit.T.PP.P2[this.current_select_action_index].addChild(Mit.f_jt),this.menuContainer.visible=!0,this.bloodBarAll(!0),this.buff(),Mit.GameHeader.startCountDown(30),"end"==Mit.GameOver&&h8.changeScene(new Dit)}}Mit.selectedFunctionIndex=null,Mit.round={};class Oit extends or{constructor(){super(),this.addChild(this.bg=this.background()),this.addChild(this.steed())}display(t,e=""){if("bg"===e)this.bg.visible=t;else this.bg.visible=t,this.visible=t}steed(){let t=Qo.from("m_1");return t.scale.x=3.2,t.scale.y=2.94,t.y=200,t.x=h8.width-t.width,t.texture.baseTexture.scaleMode=ce.NEAREST,t}background(){let t=Qo.from("bg10");return t.y=92,t.scale.x=3.2,t.scale.y=2.94,t.texture.baseTexture.scaleMode=ce.NEAREST,t}}class Pit extends or{constructor(){super(),this.backgroud(),this.address(),this.nick();let t=new rst("东方不败-出招(60)",{fontSize:28,align:"center",wordWrap:!0,wordWrapWidth:300});t.text.anchor.x=.5,t.x=h8.width/2-t.width/2+t.width/2,t.y=48,this.title=t,this.addChild(this.title),this.startCountDown()}backgroud(){let t=Qo.from("game_title");t.scale.x=1.18,t.scale.y=1.18,this.addChild(t);let e=Qo.from("title_name");e.scale.y=1.6,e.x=h8.width/2-e.width/2,e.y=45,this.addChild(e)}address(){let t=new rst("许昌",{fontSize:30});t.x=h8.width/2-t.width/2,t.y=8,this.addChild(t)}startCountDown(t=60){this.updateTitle(`东方不败-出招(${t})`),this.countDown=em.to(this.title,{duration:1,ease:"none",repeat:t}).eventCallback("onRepeat",(()=>{t--,this.updateTitle(`东方不败-出招(${t})`)}))}StopCountDown(){this.countDown.kill()}updateTitle(t){this.title.text.text=t}nick(){let t=new rst(Mit.gameUser[0].nick,{fontSize:30});t.text.anchor.x=.5,t.x=90,t.y=52,this.addChild(t);let e=new rst(Mit.gameUser[1].nick,{fontSize:30});e.text.anchor.x=.5,e.x=h8.width-90,e.y=52,this.addChild(e)}}class Dit extends u8{constructor(){super();let t=new est,e=new nst,n=new Qit("按任意键返回");n.y=.7*h8.height;let r={color:6184798,image:"game_fail"};Mit.isWin>0&&(r={color:14596467,image:"game_win"}),h8.backgroundColor(r.color);let i=Qo.from(r.image);i.anchor.set(.5),i.scale.set(.3),i.alpha=.5,i.y=250,i.x=h8.width/2,em.to(i,{duration:.35,pixi:{scaleX:.7,scaleY:.7,alpha:1},ease:"back.out(1.7)"});let s=new or,a=Mit.T.PP.P2;for(let t=0;t<a.length;t++){let e=new or;e.y=135*t;let n=Qo.from("game_row");a[t].x=0,e.addChild(n),s.addChild(e)}s.y=420,s.x=h8.width/2-s.width/2,this.interactive=!0,this.hitArea=new xn(0,0,h8.width,h8.height),this.on("pointertap",(()=>h8.changeScene(new Hit))),this.addChild(e,t,n,i,s)}}class Fit extends u8{constructor(){super();let t=new est,e=new nst,n=new Qit("娱乐场>赤壁斗");h8.backgroundColor(3538995),this.nav();let r=new Yo;r.beginFill(16777215,.8).drawRect(70,220,.8*h8.width,6),r.beginFill(16777215,.8).drawRect(70,740,.8*h8.width,6),r.endFill(),this.addChild(r),this.play();let i=new sst("刷新",{fontSize:40,fill:16777215});i.x=70,i.y=670,this.addChild(i),i.on("pointertap",(()=>{h8.changeScene(new Fit)})),this.succor(),this.Votes=new rst("",{fontSize:36,fill:16113464,wordWrap:!0,wordWrapWidth:.82*h8.width,breakWords:!0}),this.Votes.x=70,this.Votes.y=260,this.addChild(this.Votes);let s=new rst("已增援蜀军1000金100000银",{fontSize:36,fill:16777215,wordWrap:!0,wordWrapWidth:.85*h8.width,breakWords:!0});s.x=70,s.y=850,this.addChild(s),this.Last=new rst("",{fontSize:36,fill:16113464,wordWrap:!0,wordWrapWidth:.82*h8.width,breakWords:!0}),this.Last.x=70,this.Last.y=910,this.addChild(this.Last);let a=new sst("战利品排行",{fontSize:40,fill:16777215});a.x=360,a.y=900,this.addChild(a),a.on("pointertap",(()=>{h8.changeScene(new Fit)})),this.addChild(a),this.content(),this.addChild(e,t,n,new ast(Hit))}succor(){let t=new sst("增援金砖",{fontSize:40,fill:16777215},15032832);t.x=70,t.y=770,this.addChild(t),t.on("pointertap",(()=>{h8.changeScene(new Lit)}));let e=new sst("增援银两",{fontSize:40,fill:16777215},15032832);e.x=300,e.y=770,this.addChild(e),e.on("pointertap",(()=>{h8.changeScene(new Fit)}))}content(){let t=Fit.data,e=`第${t.count}次赤壁斗进行中,还有${t.time}秒决出胜负,请求增援! \n魏军使用调虎离山计,吴军中计损兵`;this.Votes.text.text=e;let n=`上次战事${["魏","蜀","吴"][t.last]}军胜`;this.Last.text.text=n}play(){let t=["魏军目前军资1000金100000银","蜀军目前军资1000金100000银","吴军目前军资1000金100000银"];for(let e in t){let n=new rst(t[e],{fontSize:36,fill:16777215,wordWrap:!0,wordWrapWidth:.85*h8.width,breakWords:!0});n.x=70,n.y=420+80*Number(e),this.addChild(n)}}nav(){var t=70;["猜猜猜","赤壁斗","猜拳"].forEach((e=>{var n=new sst(e,{fontSize:42,fill:16777215},7439615,(t=>{t.butWidth*=1.2}));n.x=t,n.y=156,t+=n.width+10,this.addChild(n),n.on("pointertap",(()=>{h8.changeScene(new Fit)}))}))}}class Lit extends u8{constructor(){super();let t=new est,e=new nst,n=new Qit("娱乐场>赤壁斗");h8.backgroundColor(3538995),this.nav();let r=new Yo;r.beginFill(16777215,.8).drawRect(70,220,.8*h8.width,6),r.beginFill(16777215,.8).drawRect(70,740,.8*h8.width,6),r.endFill(),this.addChild(r),this.content(),this.play();let i=new sst("刷新",{fontSize:40,fill:16777215});i.x=70,i.y=670,this.addChild(i),i.on("pointertap",(()=>{h8.changeScene(new Fit)})),this.succor();let s=new rst("已增援蜀军1000金100000银",{fontSize:36,fill:16777215,wordWrap:!0,wordWrapWidth:.85*h8.width,breakWords:!0});s.x=70,s.y=850,this.addChild(s),this.last(),this.addChild(e,t,n,new ast(Hit))}last(){let t=new rst("上次战事魏军胜",{fontSize:36,fill:16113464,wordWrap:!0,wordWrapWidth:.82*h8.width,breakWords:!0});t.x=70,t.y=910,this.addChild(t);let e=new sst("战利品排行",{fontSize:40,fill:16777215});e.x=360,e.y=900,this.addChild(e),e.on("pointertap",(()=>{h8.changeScene(new Fit)}))}succor(){let t=new sst("增援金砖",{fontSize:40,fill:16777215},15032832);t.x=70,t.y=770,this.addChild(t),t.on("pointertap",(()=>{h8.changeScene(new Lit)}));let e=new sst("增援银两",{fontSize:40,fill:16777215},15032832);e.x=300,e.y=770,this.addChild(e),e.on("pointertap",(()=>{h8.changeScene(new Lit)}))}content(){let t="第100000次赤壁斗进行中,还有10秒决出胜负,请求增援!";t+="\n魏军使用调虎离山计,吴军中计损兵";let e=new rst("第100000次赤壁斗进行中,还有10秒决出胜负,请求增援!\n魏军使用调虎离山计,吴军中计损兵",{fontSize:36,fill:16113464,wordWrap:!0,wordWrapWidth:.82*h8.width,breakWords:!0});e.x=70,e.y=260,this.addChild(e)}play(){let t=["魏军: 1000","蜀军: 1000","吴军: 1000"];for(let e in t){let n=new rst(t[e],{fontSize:36,fill:16777215,wordWrap:!0,wordWrapWidth:.85*h8.width,breakWords:!0});n.x=70,n.y=420+80*Number(e);let r=new sst("增援");r.on("pointertap",(()=>{ost.send({route:["Square","play"],index:e}),h8.changeScene(new Fit)})),r.x=500,r.y=420+80*Number(e),this.addChild(n,r)}}nav(){var t=70;["猜猜猜","赤壁斗","猜拳"].forEach((e=>{var n=new sst(e,{fontSize:42,fill:16777215},7439615,(t=>{t.butWidth*=1.2}));n.x=t,n.y=156,t+=n.width+10,this.addChild(n),n.on("pointertap",(()=>{h8.changeScene(new Fit)}))}))}}class Bit{constructor(t,e){switch(e[0]){case"chat":let i=new Date(1e3*t.time+288e5).toJSON().substr(11,5).replace("T"," ");h8.chat.message(i,t.data.msg,t.data.user.nick);break;case"login":Eit.data=t.data,lst.removeInput(),h8.changeScene(new Hit);break;case"notify":h8.notify=t.data,h8.header.notify(),ost.send({route:["User","user"]});break;case"map":Hit.mapData=t.data,h8.currentScene.changeNavPage(Hit.currentNavIndex);break;case"square":switch(e[1]){case"play":h8.changeScene(new Fit);break;case"notify":Fit.data=t.data,"Square"==h8.currentScene.constructor.name&&h8.currentScene.content()}break;case"plot":h8.currentScene.dialogue.setData(t.data),h8.currentScene.dialogue.textAction(),h8.currentScene.dialogue.textPlot();break;case"user":switch(e[1]){case"sort":V9.data=t.data,$it.to(V9);break;case"user":Eit.data=t.data;break;case"attr":Eit.data=t.data,h8.changeScene(new Sit);break;case"Upsld":case"skillStudy":Eit.data.struct.skill=t.data,h8.changeScene(new Iit)}break;case"slave":switch(e[1]){case"list":X9.data=t.data,$it.to(X9);break;case"del":$it.to(X9,{route:["slave","list"]});break;case"slave":G9.data=t.data,$it.to(G9);break;case"exp":H9.data=t.data,X9.data.list[H9.selectedIndex]=t.data,h8.changeScene(new H9);break;case"attr":H9.data=t.data,X9.data.list[H9.selectedIndex]=t.data,h8.changeScene(new j9);break;case"Upsld":case"skillStudy":X9.data.list[H9.selectedIndex].skill=t.data,h8.changeScene(new Y9)}break;case"goods":if("list"===e[1])kit.data=t.data,$it.to(kit);break;case"game":switch(e[1]){case"start":Mit.gameUser=t.data.user,Mit.gameType=t.data.game.type.toLocaleUpperCase();var n=new Mit(t.data.team);h8.changeScene(n);break;case"row":var r=h8.currentScene;r.team_data=t.data.team,Eit.data.user==t.data.user[0].user&&(r.team_data={p1:t.data.team.p2,p2:t.data.team.p1}),Mit.bloodRate();break;case"run":case"end":Mit.GameOver=e[1],Mit.isWin=t.msg,h8.currentScene.readyRunGame(),Mit.round=t.data,h8.currentScene.playGame()}}}}class $it{static to(t,e){e?ost.send(e):h8.changeScene(new t)}}class Uit extends u8{constructor(){super();let t=new est,e=new nst,n=new Qit("擂台");h8.backgroundColor(3538995),this.addChild(e,t,n,new ast(Hit))}}class Vit extends u8{constructor(){super();let t=new est,e=new nst;var n=Vit.data;let r=new Qit("副将:"+n.slave.name);this.addChild(e,t,r,new ast(Hit))}}Vit.selectedIndex=0;class zit extends u8{constructor(){super();let t=new est,e=new nst,n=new Qit("剧情任务");h8.backgroundColor(3538995),ost.send({route:["Task","list"],id:3}),this.interactive=!0,this.on("pointertap",(()=>{})),this.addChild(e,t,n,new ast(Hit))}}class Git extends u8{constructor(){super();let t=new est,e=new nst,n=new Qit("好友(56/100)");h8.backgroundColor(3538995);var r=20,i=new or;i.x=50,i.y=100,["好友","最近","亲人","仇人"].forEach((t=>{var e=new sst(t,{fontSize:46},14591232);e.x=r,e.y=120,r+=e.width+10,i.addChild(e),e.on("pointertap",(()=>h8.changeScene(new Git)))})),this.addChild(i);let s=new Yo;s.beginFill(16777215,.8).drawRect(20,0,.8*h8.width,6),s.endFill(),s.y=300,s.x=50,this.addChild(s),this.addChild(e,t,n,new ast(Hit))}}class Wit extends u8{constructor(){super();let t=new est,e=new nst;var n=Wit.data;let r=new Qit("副将:"+n.slave.name);this.addChild(e,t,r,new ast(Hit))}}Wit.selectedIndex=0;class Xit extends or{constructor(){super(),this.currentIndex=0,this.messageContainer=new or,this.messageList=[],this.currentChatSprite=new Qo,this.act={down:0,up:0,full:!1},this.y=700,this.zIndex=1e3,this.sortableChildren=!0,this.background(),this.currentChat(),this.bar(),this.chatInput(),this.scrollbox=new Zit,this.setScrollbox()}static getInstance(){return this.instance||(this.instance=new Xit),this.instance}message(t,e,n=""){let r=new or,i=new rst(String(t)),s=new rst(" "+String(n)+" ",{fill:["#FFFF33"]});s.x=i.width;let a=new rst(e);a.x=i.width+s.width,r.addChild(i,s,a),this.push(r)}push(t){t.y=-50,this.messageList.push(t),this.scrollbox.content.addChild(t);for(let t=0;t<this.messageList.length;t++)em.to(this.messageList[t],{duration:.5,y:50*(this.messageList.length-t-1)}).eventCallback("onComplete",(()=>{if(t>100)try{this.messageList.shift().visible=!1}catch(t){}}))}setScrollbox(){this.scrollbox.overflow="hidden",this.scrollbox.y=52,this.scrollbox.setHeight(436),this.scrollbox.setWidth(h8.width),this.scrollbox.sprite.alpha=0,this.scrollbox.sprite.height=0,this.addChild(this.scrollbox)}chatInput(){var t=Qo.from("chat_input_bg");t.x=0,t.y=h8.height-this.y-t.height-60,t.scale.set(1.17);var e=Qo.from("chat_input");e.y=6,e.scale.set(1.17);var n=Qo.from("chat_send");n.scale.set(1.17),n.x=t.width/1.17-n.width,n.y=6,t.addChild(e,n),this.addChild(t),this.inputBg=t,e.interactive=!0,e.on("pointertap",(()=>{n.interactive=!0;let t=document.createElement("input");t.placeholder="内容...",t.type="text",t.style.display="block",t.style.opacity="0.8",t.style.width="90%",t.style.margin="auto",t.style.marginTop="200px",this.input=t,document.body.appendChild(t),t.focus(),t.onkeydown=e=>{13==e.keyCode&&(ost.send({route:["Chat","chat"],msg:t.value}),this.removeInput())},t.onblur=()=>{this.removeInput()},n.on("pointertap",(()=>{ost.send({route:["Chat","chat"],msg:t.value}),this.removeInput()}))}))}removeInput(){try{this.input.interactive=!1,document.body.removeChild(this.input)}catch(t){}}currentChat(){var t=Qo.from("chat_current");t.x=344+50*this.currentIndex,t.scale.x=1.17,this.currentChatSprite=t,this.addChild(t)}bar(){var t=new or;return t.x=380,t.y=5,fa.shared.resources.chat_bar.data.animations.chat_bar.forEach(((e,n)=>{var r=Qo.from(e);r.scale.set(.6),r.x=102*n,r.interactive=!0,r.on("pointertap",(()=>{this.currentIndex=n,this.currentChatSprite.x=344+100*this.currentIndex})),t.addChild(r)})),this.addChild(t),t}background(){let t=Qo.from("home_chat");t.scale.x=1.17,this.addChild(t),this.backgroundSprite=t}chatFull(t,e){this.act[e]=t.data.global.y,this.act.full?(h8.currentScene.alpha=1,em.to(this.inputBg,{duration:.3,y:h8.height-700-this.inputBg.height}),em.to(this,{duration:.3,y:700}),this.scrollbox.setHeight(436)):(em.to(this.inputBg,{duration:.3,y:this.backgroundSprite.height-this.inputBg.height}),em.to(this,{duration:.3,y:h8.height-this.backgroundSprite.height}),this.scrollbox.setHeight(this.backgroundSprite.height-this.inputBg.height)),this.act.full=!this.act.full}}em.registerPlugin(U9),U9.registerPIXI(e);class Hit extends u8{constructor(){super(),this.navPageContainer=new or,this.navColumnContainer=new or,this.sortableChildren=!0,this.user(),this.navigation(),this.changeNavPage(Hit.currentNavIndex),h8.backgroundColor(0),ost.send({route:["Map","map"],index:1}),this.addChild(h8.chat=Xit.getInstance())}navigation(){let t=[];for(let e=0;e<=3;e++){let n="";e==Hit.currentNavIndex&&(n="_on");let r=Qo.from("home_nav"+String(e)+n);r.scale.x=1.172,r.scale.y=1.2,r.x=187*e,r.y=526,t.push(r),r.interactive=!0,r.on("pointertap",(()=>{Hit.currentNavIndex=e,t.forEach(((t,e)=>{t.texture=Yr.from("home_nav"+String(e))})),t[e].texture=Yr.from("home_nav"+String(e)+"_on"),this.navColumnContainer.destroy(),this.addChild(this.nav_column(e)),this.changeNavPage(e)}))}this.addChild(this.nav_column(Hit.currentNavIndex)),this.addChild(new or,...t)}changeNavPage(t=0){if(this.navPageContainer.destroy(),Hit.mapData){switch(t){case 0:this.navPageContainer=this.nav_people();break;case 1:this.navPageContainer=this.nav_facilities();break;case 2:this.navPageContainer=this.nav_map();break;case 3:this.navPageContainer=this.nav_function()}this.navPageContainer.zIndex=0,this.addChild(Hit.header=new est(Hit.mapData.name)),this.addChild(this.navPageContainer)}}nav_facilities(){var t=new or;t.x=390,t.y=100;var e=[{name:"医馆",calllback:()=>{}},{name:"钱庄",calllback:()=>{}},{name:"驿馆",calllback:()=>{}},{name:"市场",calllback:()=>{}},{name:"广场",calllback:()=>{h8.changeScene(new Fit)}},{name:"官府",calllback:()=>{}},{name:"战场",calllback:()=>{}},{name:"管家",calllback:()=>{}}];let n=[];return e.forEach(((r,i)=>{n[i]=new rst(e[i].name,{}),n[i].x=50+i%2*180+20,n[i].y=70*Math.floor(i/2);let s=Qo.from("ss_"+(i+1));s.x=i%2*180,s.y=70*Math.floor(i/2)-10,s.scale.set(.7,.7),n[i].on("pointertap",(()=>r.calllback()),this),t.addChild(s,n[i])})),t}nav_map(){var t=new or;if(t.x=380,t.y=90,!Hit.mapData)return t;for(const e in Hit.mapData.nearby){let n=Hit.mapData.nearby[e],r=new or,i=new rst(n[1]);i.x=160,i.y=16;let s=Qo.from("map_"+n[2]);s.x=80,s.scale.set(.6);let a=Qo.from("fx_"+e);a.scale.set(.8),r.addChild(a,s,i),r.y=70*t.children.length,t.addChild(r),r.interactive=!0,r.on("pointertap",(()=>{ost.send({route:["Map","map"],index:n[0],msg:"移动位置"})}))}return t}nav_function(){var t=new or;t.x=390,t.y=100;var e=[{name:"状态",calllback:()=>{h8.changeScene(new Eit)}},{name:"物品",calllback:()=>{$it.to(kit,{route:["Goods","list"],type:0})}},{name:"副将",calllback:()=>{$it.to(X9,{route:["Slave","list"]})}},{name:"组队",calllback:()=>{}},{name:"排行",calllback:()=>{$it.to(V9,{route:["User","sort"]})}},{name:"好友",calllback:()=>{h8.changeScene(new Git)}},{name:"邮件",calllback:()=>{}},{name:"任务",calllback:()=>{h8.changeScene(new zit)}},{name:"擂台",calllback:()=>{h8.changeScene(new Uit)}},{name:"教派",calllback:()=>{document.getElementById("stats").setAttribute("style","display:none")}},{name:"训练",calllback:()=>{}},{name:"宝库",calllback:()=>{h8.changeScene(new z9)}},{name:"公告",calllback:()=>{ost.close()}},{name:"VIP",calllback:()=>{}},{name:"登出",calllback:()=>{Hit.currentNavIndex=0,ost.action="ACTIVE",h8.changeScene(new lst)}}];let n=[];return e.forEach(((r,i)=>{n[i]=new rst(e[i].name,{}),n[i].x=i%3*120,n[i].y=70*Math.floor(i/3);let s=Qo.from("button_yun");s.x=i%3*114+10,s.y=70*Math.floor(i/3)-10,s.scale.set(.7,.7),n[i].on("pointertap",(()=>r.calllback()),this),t.addChild(s,n[i])})),t}nav_people(){var t=new or;if(!Hit.mapData)return t;var e=Hit.mapData;for(const r in e.npc){let i=new rst(e.npc[r].name,{fontSize:36});i.x=380,i.y=100+50*Number(r),t.addChild(i);let s=Qo.from("home_button");s.interactive=!0,s.y=80+50*Number(r),s.x=580+(Number(r)%2?70:0);var n=Cit.th();n.y=38,e.npc[r].tip&&s.addChild(n),t.addChild(s);let a=new rst("",{fontSize:30});switch(a.x=6,a.y=16,e.npc[r].type){case"PLOT":a.text.text="对话",a.text.style.stroke="#0000FF",a.text.style.strokeThickness=10;break;case"PVP":case"PVE":a.text.text="战斗",a.text.style.stroke="#FF0000",a.text.style.strokeThickness=10}s.addChild(a),s.on("pointertap",(()=>{var t=new Kit;t.zIndex=10;var n=this.dialogue=new qit(Hit.header.height);switch(e.npc[r].type){case"PLOT":n.submit({route:["Task","commit"],data:{taskId:e.npc[r].taskId}}),this.addChild(n);break;case"PVP":this.addChild(t),setTimeout((()=>{ost.send({route:["User","joinGame"]})}),500+1e3*Math.random());break;case"PVE":this.addChild(t),setTimeout((()=>{ost.send({route:["Npc","join"]})}),500+1e3*Math.random())}}))}return t}nav_column(t){var e=new or;e.x=354,e.y=80;let n=Qo.from("home_"+(0==t?"columns":"column"));n.scale.x=1.1,n.scale.y=1.12,e.x=354,e.y=80;var r=Qo.from("home_nav"+t+"_txt");return r.y=370,em.to(r,{duration:.3,x:140}),e.addChild(n,r),this.navColumnContainer=e,e}user(){let t=Qo.from("home_bg");t.x=0,t.y=80,this.addChild(t);let e=Qo.from("home_avatar");e.x=t.width/2-e.width/2,e.y=120,this.addChild(e);let n=new rst(Eit.data.nick,{fontSize:38});n.text.anchor.x=.5,n.x=215,n.y=100,this.addChild(n);let r=Qo.from("q");r.x=44,r.y=118,r.scale.x=r.scale.y=2.5,this.addChild(r),em.to(r,{duration:.5,repeat:-1,yoyo:!0,pixi:{tint:"red"}}),[e,n,r].forEach((t=>{t.interactive=!0,t.on("pointertap",(()=>{h8.changeScene(new Eit)}))}));let i=Qo.from("home_hp");i.x=118,i.y=144,i.scale.x=1.31,i.scale.y=1,this.addChild(i);let s=Qo.from("home_mp");s.x=118,s.y=167,s.scale.x=1.31,s.scale.y=1,this.addChild(s);let a=Qo.from("home_slave");a.scale.x=1.1,a.scale.y=1.1,a.x=t.width/2-a.width/2,a.y=210,a.interactive=!0,this.addChild(a),a.on("pointertap",(()=>{$it.to(X9,{route:["Slave","list"]})}));let o=Qo.from("home_data");o.x=t.width/2-o.width/2,o.y=290,this.addChild(o);let l=[{name:"职业: "+Eit.data.lv+{1:"武士",2:"文人",3:"异人"}[Eit.data.j],style:{}},{name:"金: "+Eit.data.gold,style:{fill:"#FFFF00"}},{name:"银: "+Eit.data.silver,style:{}},{name:"升级还需经验: ",style:{}},{name:String(Eit.data.exp),style:{}}];for(const t in l){let e=Object.assign({fontSize:30},l[t].style),n=new rst(l[t].name,e);n.x=4==Number(t)?100:60,n.y=310+36*Number(t),this.addChild(n)}}}Hit.currentNavIndex=0,Hit.header=null;class Yit extends u8{constructor(){super(),h8.backgroundColor(3538995);let t=new est,e=new nst;this.addChild(e,t,new ast(Hit))}}var jit="inherit";class qit extends or{constructor(t=0){super(),this.task=[],this.zIndex=2e3,this.sortableChildren=!0;var e=this.getBackgroup(-1);em.to(e,{duration:.5,y:e.height+t}),(e=this.getBackgroup()).y=h8.height,em.to(e,{duration:.5,y:h8.height-e.height-150});const n=this.graphics=new Yo;n.beginFill(1326),n.drawRect(0,0,h8.width,566),n.endFill(),n.lineStyle(4,10526880,1),n.beginFill(0),n.drawRect(.03*h8.width/2,6,.97*h8.width,550),n.endFill(),n.pivot.x=n.width/2,n.pivot.y=n.height/2,n.x=n.width/2,n.y=t+n.height/2+e.height,n.scale.y=0,em.to(n.scale,{duration:.5,y:1}).eventCallback("onComplete",(()=>{n.lineStyle(4,10526880,.8),n.beginFill(1326),n.drawRect(.03*h8.width/2,460,.97*h8.width,100),n.endFill(),this.avatar()})),this.interactive=!0,this.on("pointertap",(()=>{this.textPlot()})),this.addChild(n)}setData(t){this.data=t,this.task=t.Task}submit(t){setTimeout((()=>{ost.send(t)}),500)}avatar(){this.addChild(new Jit({avatar:"npc_1",y:152},(t=>{t.x=-130,t.toX=50})));let t=new rst("跑环使者",Object.assign({fontSize:36,fill:"#F7EDCA",stroke:"#d3393c",strokeThickness:10,lineJoin:"round"}));t.x=200,t.y=150,this.addChild(t),this.addChild(new Jit({avatar:"5",y:152},(t=>{t.toX=h8.width-170})));let e=new rst("三国新人",Object.assign({fontSize:36,fill:"#F7EDCA",stroke:"#d3393c",strokeThickness:10,lineJoin:"round"}));e.x=h8.width-340,e.y=240,this.addChild(e)}textPlot(){if(0==this.task.plot.length)return h8.changeScene(new Hit),void(!this.task.next&&this.data.Complete&&h8.currentScene.addChild(new ist(`恭喜您完成${this.task.name}`,(t=>{t.destroy()}))));let t=this.task.plot.shift();this.updateText(t)}updateText(t){this.content.text.text=t}textAction(){var t=this.content=new rst("",{wordWrap:!0,wordWrapWidth:.96*h8.width,breakWords:!0});t.x=16,t.y=10;var e=new rst("继续",{fill:"#e8dd13"});e.x=h8.width/2-e.width/2,e.y=490,this.graphics.addChild(t,e);var n=Cit.npc_jt();n.x=-26,n.y=18,e.addChild(n)}getBackgroup(t=1){var e=new or,n=Qo.from("chat_bg");n.x=h8.width,n.scale.x=-.7,n.scale.y=.7*t;var r=Qo.from("chat_bg");return r.scale.x=.7,r.scale.y=.7*t,e.addChild(r,n),this.addChild(e),e}}class Kit extends or{constructor(){super();let t=new Yo;t.beginFill(0,1e-5).drawRect(0,0,h8.width,h8.height),t.endFill(),t.interactive=!0,t.zIndex=1,this.addChild(t);var e=new or;e.y=340,this.addChild(e);var n=.2;let r=new Yo;r.beginFill(723208,n).drawRect(0,0,h8.width,180),r.beginFill(16777215,.6).drawRect(0,6,h8.width,4),r.beginFill(16777215,.6).drawRect(0,174,h8.width,4),r.endFill();let i=em.to({},{duration:.1,repeat:3e4}).eventCallback("onRepeat",(()=>{n>=1&&i.pause(),r.clear(),r.beginFill(723208,n).drawRect(0,0,h8.width,180),r.beginFill(16777215,.6).drawRect(0,6,h8.width,4),r.beginFill(16777215,.6).drawRect(0,174,h8.width,4),r.endFill(),n+=.2}));e.addChild(r);let s=new rst("准备中,请稍后...",{fontSize:32,stroke:"#FFF",lineJoin:"round"});s.y=20,s.x=h8.width/2-s.width/2,e.addChild(s);var a=.8,o=this.getGrd();o.y=100;var l=this.getGrd();l.y=112,em.to(o,{duration:a,x:h8.width-o.width,ease:"none",repeat:3e3}),em.to(l,{duration:a,x:h8.width-l.width,ease:"none",repeat:3e3}),e.addChild(o,l);var h=this.getGrd();h.y=100,h.scale.x=-1,h.x=h8.width;var u=this.getGrd();u.y=112,u.scale.x=-1,u.x=h8.width,em.to(h,{duration:a,x:0+h.width,ease:"none",repeat:3e3}),em.to(u,{duration:a,x:0+u.width,ease:"none",repeat:3e3}),e.addChild(h,u)}getGrd(){var t=new Qo;const e=document.createElement("canvas");e.width=100,e.height=8;var n=e.getContext("2d");if(n){const r=n.createLinearGradient(0,0,100,0);r.addColorStop(0,"rgba(255, 100, 100, 0)"),r.addColorStop(.6,"rgba(255, 50, 50, 1.0)"),r.addColorStop(1,"rgba(255, 0, 0, 1.0)"),n.fillStyle=r,n.fillRect(0,0,100,100);t=Qo.from(Yr.from(e))}return t}}class Zit extends J8{constructor(){super(),this.boxWidth=.85*h8.width,this.boxHeight=h8.height,this.sprite=this.content.addChild(new Qo(Yr.WHITE)),this.sprite.width=.85*h8.width,this.sprite.height=h8.height+1e3,this.sprite.tint=3538995,this.update()}setWidth(t){this.boxWidth=t,this.sprite.width=t}setHeight(t){this.boxHeight=t}setbackgroud(t){this.sprite.tint=t}}class Jit extends or{constructor(t,e=(t=>{})){super();var n=Qo.from("avatar");n.scale.set(.57);var r=this.avatar=Qo.from(`./avatar/${t.avatar}.png`);this.y=t.y,this.x=h8.width,this.alpha=.5,this.toX=500,e(this),this.addChild(n,r),em.to(this,{duration:.3,alpha:1,x:this.toX})}}class Qit extends or{constructor(t,e){super();let n=new rst(t,Object.assign({fontSize:40,fill:"#F7EDCA",stroke:"#d3393c",strokeThickness:10,lineJoin:"round"},e));n.y=100,n.x=h8.width/2-n.width/2,this.text=n,this.addChild(n)}}class tst extends Yo{constructor(){super(),this.beginFill(16777215,.8).drawRect(0,0,.8*h8.width,6),this.endFill(),this.y=200}}class est extends or{constructor(t="许昌",e=!0){super(),this.data=[],this.zIndex=3e3,this.sortableChildren=!0;let n=Qo.from("home_title");n.scale.x=1.2,n.scale.y=1.2,this.addChild(n);let r=this.text=new rst(t,{fill:"#FFF",fontSize:32});r.x=h8.width/2-r.width/2,r.y=n.height/2-r.height/2-5,this.addChild(r);let i=Qo.from("home_map");i.scale.x=.8,i.scale.y=.8,i.x=e?-i.width:0,this.addChild(i),em.to(i,{duration:.5,x:0}),i.interactive=!0,i.on("pointertap",(()=>h8.changeScene(new Hit)),this),h8.header=this,this.notify()}notify(){if(!(h8.notify.length<=0)){var t=Cit.tit("xt");t.y=this.height/2,t.x=h8.width-30,t.interactive=!0,t.on("pointertap",(()=>{h8.notify=[],h8.changeScene(new Yit)}),this),this.addChild(t)}}}class nst extends or{constructor(){super(),this.left=Qo.from("edge"),this.left.scale.y=24,this.left.x=-this.left.width,this.addChild(this.left),em.to(this.left,{duration:.5,x:0}),this.right=Qo.from("edge"),this.right.scale.y=26,this.right.scale.x=-1,this.right.x=h8.width+this.right.width,this.addChild(this.right),this.zIndex=900,em.to(this.right,{duration:.5,x:this.right.x-this.right.width})}}class rst extends or{constructor(t="",e){super(),e=Object.assign({fontFamily:jit,fontWeight:"bold",fontSize:40,fill:"#ffffeb",lineJoin:"round",breakWords:!0},e),this.text=new cl(t,e),this.interactive=!0,this.addChild(this.text)}}class ist extends or{constructor(t="",e=(()=>{}),n=(()=>{}),r){super();let i=new Yo;i.beginFill(0,.8).drawRect(0,0,h8.width,h8.height),i.endFill(),i.interactive=!0,i.zIndex=1,i.on("pointertap",(()=>this.destroy()));let s=Qo.from("confirm_box");s.y=500,s.zIndex=2,s.x=h8.width/2,s.interactive=!0;r=Object.assign({fontFamily:jit,fontWeight:"bold",fontSize:38,fill:"#ffffeb"},r),this.text=new cl(t,r),this.text.y=-70,this.text.x=-this.text.width/2;var a=new sst("取消",{fontSize:46},14591232);a.x=-s.width/2+a.width,a.y=s.height/2-80,a.on("pointertap",(()=>{this.destroy(),n(this)}));var o=new sst("确定",{fontSize:46},14591232);o.x=s.width/2-2*o.width,o.y=s.height/2-80,o.on("pointertap",(()=>e(this))),this.zIndex=2e3,this.addChild(i,s),s.addChild(this.text),s.addChild(a,o),s.alpha=.5,s.anchor.set(.5),s.scale.set(.8),em.to(s,{duration:.3,alpha:1,ease:"back.out(2)"}),em.to(s.scale,{duration:.3,x:1,y:1,ease:"back.out(2)"})}}class sst extends or{constructor(t,e,n=12976323,r=(()=>{}),i=!0){super(),this.butColor=12976323,this.butWidth=110,this.butHeight=60,this.butBorder=4,this.butAlpha=.55,this.action="",this.isFlicker=!1;let s=new rl({fontFamily:jit,fontSize:40,fill:["#ffffff"],lineJoin:"round"});"string"!=typeof t?this.text=t:(this.text=new cl(t,Object.assign(s,e)),this.butWidth=this.text.width+26,this.butHeight=this.text.height+6,this.text.x=this.butWidth/2-this.text.width/2,this.text.y=this.butHeight/2-this.text.height/2),this.butColor=n,r(this),this.graphics=new Yo,this.up(),this.addChild(this.graphics,this.text),this.interactive=!0,this.on("pointerdown",this.down,this),this.on("pointerupoutside",this.up,this),this.on("pointerup",i?this.flicker:this.up,this)}flicker(){"up"==this.action||this.isFlicker||(this.isFlicker=!0,em.to({},{duration:.035,repeat:1e5}).eventCallback("onRepeat",(()=>{var t="#ffffff"==this.text.style.fill?"#ae87a0":"#ffffff";this.text.style.fill=t})))}up(){if("up"==this.action)return;this.action="up";let t=this.butWidth,e=this.butHeight,n=this.butBorder,r=this.butAlpha;this.graphics.beginFill(this.butColor).drawRect(0,0,t,e),this.graphics.beginFill(16777215,r).drawRect(0,0,t,n),this.graphics.beginFill(16777215,r).drawRect(0,n,n,e-n),this.graphics.beginFill(0,r).drawRect(t-n,n,n,e-n-n),this.graphics.beginFill(0,r).drawRect(n,e-n,t-n,n)}down(){if("down"==this.action)return;this.action="down";let t=this.butWidth,e=this.butHeight,n=this.butBorder,r=this.butAlpha;this.graphics.beginFill(0,r).drawRect(0,0,t,e),this.graphics.beginFill(0,r).drawRect(0,0,t,n),this.graphics.beginFill(0,r).drawRect(0,n,n,e-n),this.graphics.beginFill(16777215,r).drawRect(t-n,n,n,e-n-n),this.graphics.beginFill(16777215,r).drawRect(n,e-n,t-n,n)}on(t,e,n){return super.on(t,e,n),this}}class ast extends or{constructor(t,e=(()=>{}),n=(()=>{})){super(),this.zIndex=950,this.alpha=.3,this.button=new sst("返回"),this.backgroup=Qo.from("leg"),this.backgroup.visible=!1,this.addChild(this.backgroup,this.button),this.backgroup.height=h8.width/this.backgroup.width*2.2*this.backgroup.height,this.backgroup.width=2.2*h8.width,this.button.x=h8.width-this.button.width-20,this.button.y=this.height/2-this.button.height/2,this.scene=t,this.callback=e,this.button.on("pointertap",this.doBack,this),this.y=h8.height,em.to(this,{duration:.3,y:h8.height-this.height-100,alpha:1}).eventCallback("onComplete",(()=>{n&&n(this)}))}doBack(){this.callback&&this.callback(),h8.changeScene(new this.scene)}}class ost{constructor(){}static connect(t=""){if(ost.close(),"hxsg"===window.location.host.split(".")[0])t="ws://47.100.109.35:8950";ost.websocket=new WebSocket(t||ost.url),ost.websocket.onopen=ost.onOpen,ost.websocket.onmessage=ost.onMessage,ost.websocket.onerror=ost.onError,ost.websocket.onclose=ost.onClose}static send(t){if(1!=ost.websocket.readyState)return ost.reConnect();ost.websocket.send(JSON.stringify(t))}static close(){try{ost.websocket.close()}catch(t){}}static onOpen(){}static onMessage(t){var e=JSON.parse(t.data);void 0!==e.code&&(ost.data=e.data,new Bit(e,e.route)),"ping"==e.type&&ost.websocket.send(JSON.stringify({route:["Tool","pong"]}))}static onClose(){ost.reConnect()}static onError(){ost.reConnect("服务器未响应")}static reConnect(t="已断开连接,是否重新连接?"){this.confirmBox&&this.confirmBox.destroy(),h8.currentScene.addChild(this.confirmBox=new ist(t,(()=>ost.connect()),(()=>h8.changeScene(new lst)))),ost.action="AUTO"}}ost.url="ws://"+location.hostname+":8950",ost.action="AUTO";class lst extends u8{constructor(){super(),h8.backgroundColor(6737151);let t=new Tit;t.x=-t.width,t.y=200,t.scale.x=1,t.scale.y=1,this.addChild(t),em.to(t,{duration:.5,ease:"power2.out",x:.1*h8.width});const e=new rl({fontFamily:"9pxDemo",dropShadow:!0,dropShadowAlpha:.8,dropShadowAngle:2.1,dropShadowBlur:4,dropShadowColor:"0xdc8fc2",dropShadowDistance:10,fill:["#ffffff"],stroke:"#fb7299",fontSize:80,fontWeight:"lighter",lineJoin:"round",strokeThickness:12}),n=new cl("PixiGame",e);n.alpha=.8,n.anchor.set(.5,.5),n.x=h8.width/2,n.y=.12*h8.height,this.addChild(n),lst.username=document.createElement("input"),lst.username.placeholder="账号...",lst.username.value="744783",lst.username.type="tel",lst.username.style.position="fixed",lst.username.style.display="block",lst.username.style.opacity="0.5",lst.username.style.left="50%",lst.username.style.width="230px",lst.username.style.marginLeft="-126px",lst.username.style.marginTop="380px",lst.username.autocapitalize="on",lst.password=document.createElement("input"),lst.password.placeholder="密码...",lst.password.value="123456",lst.password.style.position="fixed",lst.password.type="password",lst.password.style.display="block",lst.password.style.opacity="0.5",lst.password.style.left="50%",lst.password.style.width="230px",lst.password.style.marginLeft="-126px",lst.password.style.marginTop="440px",document.body.appendChild(lst.username),document.body.appendChild(lst.password),this.button=new sst("登录游戏"),this.button.x=h8.width/2-this.button.width/2,this.button.y=.76*h8.height,this.addChild(this.button),this.button.on("pointertap",this.login,this);let r=new sst("游客登录");r.x=h8.width/2-this.button.width/2,r.y=.82*h8.height,this.addChild(r),r.on("pointertap",(()=>{lst.removeInput(),h8.changeScene(new Hit)})),"AUTO"==ost.action&&this.login()}login(){ost.action="ACTIVE",ost.connect()}static removeInput(){try{document.body.removeChild(lst.username),document.body.removeChild(lst.password)}catch(t){}}}h8.initialize(750,1334);const hst=new class extends or{constructor(){super(),this.stars=[],this.starAmount=1e3,this.cameraZ=0,this.fov=20,this.baseSpeed=.025,this.speed=0,this.warpSpeed=0,this.starStretch=5,this.starBaseSize=.05,this.tl=em.timeline();const t=1*h8.width;this.loaderBarFill=new Yo,this.loaderBarFill.beginFill(16478873,1),this.loaderBarFill.drawRect(0,0,t,50),this.loaderBarFill.endFill(),this.loaderBarFill.scale.x=0,this.loaderBar=new or,this.loaderBar.addChild(this.loaderBarFill),this.loaderBar.position.y=.9*h8.height,this.text=new cl("资源加载中...0",{fill:["#ffffff"]}),this.text.y=this.loaderBar.height/2-this.text.height/2,this.text.x=h8.width/2-this.text.width/2,this.loaderBar.addChild(this.text),this.addChild(this.loaderBar),fa.shared.add(d8),fa.shared.onProgress.add(this.downloadProgress,this),fa.shared.onComplete.once(this.gameLoaded,this),fa.shared.load();const e=Yr.from("./images/star.png");for(let t=0;t<this.starAmount;t++){const t={sprite:new Qo(e),z:0,x:0,y:0};t.sprite.anchor.x=.5,t.sprite.anchor.y=.7,this.randomizeStar(t,!0),this.addChild(t.sprite),this.stars.push(t)}}downloadProgress(t){const e=t.progress/100;this.loaderBarFill.scale.x=e,this.text.text="资源加载中..."+(100*e).toFixed(0)+"%",this.warpSpeed=e}gameLoaded(){em.to(this.loaderBar,{duration:.1}).eventCallback("onComplete",(()=>{h8.changeScene(new lst)}))}randomizeStar(t,e=null){t.z=e?2e3*Math.random():this.cameraZ+1e3*Math.random()+2e3;const n=Math.random()*Math.PI*2,r=50*Math.random()+1;t.x=Math.cos(n)*r,t.y=Math.sin(n)*r}update(t){this.speed+=(this.warpSpeed-this.speed)/20,this.cameraZ+=10*t*(this.speed+this.baseSpeed);for(let t=0;t<this.starAmount;t++){const e=this.stars[t];e.z<this.cameraZ&&this.randomizeStar(e);const n=e.z-this.cameraZ;e.sprite.x=e.x*(this.fov/n)*h8.width+h8.width/2,e.sprite.y=e.y*(this.fov/n)*h8.width+h8.height/2;const r=e.sprite.x-h8.width/2,i=e.sprite.y-h8.height/2,s=Math.sqrt(r*r+i*i),a=Math.max(0,(2e3-n)/2e3);e.sprite.scale.x=a*this.starBaseSize,e.sprite.scale.y=a*this.starBaseSize+a*this.speed*this.starStretch*s/h8.width,e.sprite.rotation=Math.atan2(i,r)+Math.PI/2}}};h8.changeScene(hst)})()})();